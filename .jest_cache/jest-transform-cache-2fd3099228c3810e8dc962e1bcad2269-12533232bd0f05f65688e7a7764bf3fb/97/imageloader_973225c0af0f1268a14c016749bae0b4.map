{"file":"/Users/danilonovais/_danilonov_portfolio/src/lib/supabase/image-loader.ts","mappings":"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","names":[],"sources":["/Users/danilonovais/_danilonov_portfolio/src/lib/supabase/image-loader.ts"],"sourcesContent":["interface SupabaseLoaderProps {\n  src: string;\n  width: number;\n  quality?: number;\n}\n\nconst DEFAULT_SUPABASE_URL = 'https://aymuvxysygrwoicsjgxj.supabase.co';\nconst IMAGE_EXTENSIONS = ['.png', '.jpg', '.jpeg', '.webp', '.avif'];\nconst NON_TRANSFORM_EXTENSIONS = [\n  '.svg',\n  '.mp4',\n  '.webm',\n  '.mov',\n  '.m4v',\n  '.gif',\n];\n\nexport default function supabaseLoader({\n  src,\n  width,\n  quality,\n}: SupabaseLoaderProps): string {\n  const normalizedSrc = src.split('?')[0].toLowerCase();\n\n  const appendParams = (url: string, w: number, q: number) => {\n    const separator = url.includes('?') ? '&' : '?';\n    return `${url}${separator}width=${w}&quality=${q || 75}`;\n  };\n\n  // If the image is already a full URL, we need to extract the path or modify it.\n\n  // 1. Handle local images (starting with /). Return as-is to avoid breaking them.\n  // Next.js default loader would handle these if we weren't using a custom loader globally.\n  // Since we are, returning src essentially serves the original asset.\n  if (src.startsWith('/')) {\n    return src;\n  }\n\n  // Skip transformation for non-image formats (videos, SVGs, GIFs)\n  if (NON_TRANSFORM_EXTENSIONS.some((ext) => normalizedSrc.endsWith(ext))) {\n    return src;\n  }\n\n  let projectId = '';\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n  if (supabaseUrl) {\n    try {\n      const url = new URL(supabaseUrl);\n      const parts = url.hostname.split('.');\n      if (parts.length > 0) {\n        projectId = parts[0];\n      }\n    } catch (e) {\n      console.error('Invalid NEXT_PUBLIC_SUPABASE_URL', e);\n    }\n  }\n\n  // Fallback if env var is missing or we want to parse from src\n  if (!projectId && src.includes('supabase.co')) {\n    try {\n      const url = new URL(src);\n      const parts = url.hostname.split('.');\n      if (parts.length > 0) {\n        projectId = parts[0];\n      }\n    } catch {\n      // ignore\n    }\n  }\n\n  if (src.includes('/storage/v1/object/public/')) {\n    const base = src.startsWith('http')\n      ? src\n      : `${DEFAULT_SUPABASE_URL}${src.startsWith('/') ? '' : '/'}${src}`;\n\n    const isImage = IMAGE_EXTENSIONS.some((ext) => normalizedSrc.endsWith(ext));\n\n    // Only apply Supabase image renderer for supported image extensions\n    if (isImage) {\n      const newSrc = base.replace(\n        '/storage/v1/object/public/',\n        '/storage/v1/render/image/public/'\n      );\n      return appendParams(newSrc, width, quality || 75);\n    }\n\n    // For other file types (e.g., video), serve the object URL untouched\n    return base;\n  }\n\n  // If it matches the render/image pattern already, just append params\n  if (src.includes('/storage/v1/render/image/public/')) {\n    return appendParams(src, width, quality || 75);\n  }\n\n  // For relative paths (if any) that are NOT local paths (already handled),\n  // construct the full Supabase URL.\n  // This path is hit if `src` is something like 'my-bucket/image.png' (not starting with /)\n  if (!src.startsWith('http') && projectId) {\n    const isImage = IMAGE_EXTENSIONS.some((ext) => normalizedSrc.endsWith(ext));\n    const prefix = isImage\n      ? '/storage/v1/render/image/public/'\n      : '/storage/v1/object/public/';\n    const full = `https://${projectId}.supabase.co${prefix}${src}`;\n    return isImage ? appendParams(full, width, quality || 75) : full;\n  }\n\n  // Fallback for non-Supabase images (return original)\n  return src;\n}\n"],"version":3}