7639487dcc9497f4c69287ce14108b6d
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = supabaseLoader;
const DEFAULT_SUPABASE_URL = 'https://aymuvxysygrwoicsjgxj.supabase.co';
const IMAGE_EXTENSIONS = ['.png', '.jpg', '.jpeg', '.webp', '.avif'];
const NON_TRANSFORM_EXTENSIONS = [
    '.svg',
    '.mp4',
    '.webm',
    '.mov',
    '.m4v',
    '.gif',
];
function supabaseLoader({ src, width, quality, }) {
    const normalizedSrc = src.split('?')[0].toLowerCase();
    const appendParams = (url, w, q) => {
        const separator = url.includes('?') ? '&' : '?';
        return `${url}${separator}width=${w}&quality=${q || 75}`;
    };
    // If the image is already a full URL, we need to extract the path or modify it.
    // 1. Handle local images (starting with /). Return as-is to avoid breaking them.
    // Next.js default loader would handle these if we weren't using a custom loader globally.
    // Since we are, returning src essentially serves the original asset.
    if (src.startsWith('/')) {
        return src;
    }
    // Skip transformation for non-image formats (videos, SVGs, GIFs)
    if (NON_TRANSFORM_EXTENSIONS.some((ext) => normalizedSrc.endsWith(ext))) {
        return src;
    }
    let projectId = '';
    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
    if (supabaseUrl) {
        try {
            const url = new URL(supabaseUrl);
            const parts = url.hostname.split('.');
            if (parts.length > 0) {
                projectId = parts[0];
            }
        }
        catch (e) {
            console.error('Invalid NEXT_PUBLIC_SUPABASE_URL', e);
        }
    }
    // Fallback if env var is missing or we want to parse from src
    if (!projectId && src.includes('supabase.co')) {
        try {
            const url = new URL(src);
            const parts = url.hostname.split('.');
            if (parts.length > 0) {
                projectId = parts[0];
            }
        }
        catch {
            // ignore
        }
    }
    if (src.includes('/storage/v1/object/public/')) {
        const base = src.startsWith('http')
            ? src
            : `${DEFAULT_SUPABASE_URL}${src.startsWith('/') ? '' : '/'}${src}`;
        const isImage = IMAGE_EXTENSIONS.some((ext) => normalizedSrc.endsWith(ext));
        // Only apply Supabase image renderer for supported image extensions
        if (isImage) {
            const newSrc = base.replace('/storage/v1/object/public/', '/storage/v1/render/image/public/');
            return appendParams(newSrc, width, quality || 75);
        }
        // For other file types (e.g., video), serve the object URL untouched
        return base;
    }
    // If it matches the render/image pattern already, just append params
    if (src.includes('/storage/v1/render/image/public/')) {
        return appendParams(src, width, quality || 75);
    }
    // For relative paths (if any) that are NOT local paths (already handled),
    // construct the full Supabase URL.
    // This path is hit if `src` is something like 'my-bucket/image.png' (not starting with /)
    if (!src.startsWith('http') && projectId) {
        const isImage = IMAGE_EXTENSIONS.some((ext) => normalizedSrc.endsWith(ext));
        const prefix = isImage
            ? '/storage/v1/render/image/public/'
            : '/storage/v1/object/public/';
        const full = `https://${projectId}.supabase.co${prefix}${src}`;
        return isImage ? appendParams(full, width, quality || 75) : full;
    }
    // Fallback for non-Supabase images (return original)
    return src;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2Rhbmlsb25vdmFpcy9fZGFuaWxvbm92X3BvcnRmb2xpby9zcmMvbGliL3N1cGFiYXNlL2ltYWdlLWxvYWRlci50cyIsIm1hcHBpbmdzIjoiOztBQWlCQSxpQ0E0RkM7QUF2R0QsTUFBTSxvQkFBb0IsR0FBRywwQ0FBMEMsQ0FBQztBQUN4RSxNQUFNLGdCQUFnQixHQUFHLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ3JFLE1BQU0sd0JBQXdCLEdBQUc7SUFDL0IsTUFBTTtJQUNOLE1BQU07SUFDTixPQUFPO0lBQ1AsTUFBTTtJQUNOLE1BQU07SUFDTixNQUFNO0NBQ1AsQ0FBQztBQUVGLFNBQXdCLGNBQWMsQ0FBQyxFQUNyQyxHQUFHLEVBQ0gsS0FBSyxFQUNMLE9BQU8sR0FDYTtJQUNwQixNQUFNLGFBQWEsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBRXRELE1BQU0sWUFBWSxHQUFHLENBQUMsR0FBVyxFQUFFLENBQVMsRUFBRSxDQUFTLEVBQUUsRUFBRTtRQUN6RCxNQUFNLFNBQVMsR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztRQUNoRCxPQUFPLEdBQUcsR0FBRyxHQUFHLFNBQVMsU0FBUyxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDO0lBQzNELENBQUMsQ0FBQztJQUVGLGdGQUFnRjtJQUVoRixpRkFBaUY7SUFDakYsMEZBQTBGO0lBQzFGLHFFQUFxRTtJQUNyRSxJQUFJLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUN4QixPQUFPLEdBQUcsQ0FBQztJQUNiLENBQUM7SUFFRCxpRUFBaUU7SUFDakUsSUFBSSx3QkFBd0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLEVB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QUFhLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDNUUsTUFBTSxNQUFNLEdBQUcsT0FBTztZQUNwQixDQUFDLENBQUMsa0NBQWtDO1lBQ3BDLENBQUMsQ0FBQyw0QkFBNEIsQ0FBQztRQUNqQyxNQUFNLElBQUksR0FBRyxXQUFXLFNBQVMsZUFBZSxNQUFNLEdBQUcsR0FBRyxFQUFFLENBQUM7UUFDL0QsT0FBTyxPQUFPLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU8sSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ25FLENBQUM7SUFFRCxxREFBcUQ7SUFDckQsT0FBTyxHQUFHLENBQUM7QUFDYixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYW5pbG9ub3ZhaXMvX2Rhbmlsb25vdl9wb3J0Zm9saW8vc3JjL2xpYi9zdXBhYmFzZS9pbWFnZS1sb2FkZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW50ZXJmYWNlIFN1cGFiYXNlTG9hZGVyUHJvcHMge1xuICBzcmM6IHN0cmluZztcbiAgd2lkdGg6IG51bWJlcjtcbiAgcXVhbGl0eT86IG51bWJlcjtcbn1cblxuY29uc3QgREVGQVVMVF9TVVBBQkFTRV9VUkwgPSAnaHR0cHM6Ly9heW11dnh5c3lncndvaWNzamd4ai5zdXBhYmFzZS5jbyc7XG5jb25zdCBJTUFHRV9FWFRFTlNJT05TID0gWycucG5nJywgJy5qcGcnLCAnLmpwZWcnLCAnLndlYnAnLCAnLmF2aWYnXTtcbmNvbnN0IE5PTl9UUkFOU0ZPUk1fRVhURU5TSU9OUyA9IFtcbiAgJy5zdmcnLFxuICAnLm1wNCcsXG4gICcud2VibScsXG4gICcubW92JyxcbiAgJy5tNHYnLFxuICAnLmdpZicsXG5dO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBzdXBhYmFzZUxvYWRlcih7XG4gIHNyYyxcbiAgd2lkdGgsXG4gIHF1YWxpdHksXG59OiBTdXBhYmFzZUxvYWRlclByb3BzKTogc3RyaW5nIHtcbiAgY29uc3Qgbm9ybWFsaXplZFNyYyA9IHNyYy5zcGxpdCgnPycpWzBdLnRvTG93ZXJDYXNlKCk7XG5cbiAgY29uc3QgYXBwZW5kUGFyYW1zID0gKHVybDogc3RyaW5nLCB3OiBudW1iZXIsIHE6IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IHNlcGFyYXRvciA9IHVybC5pbmNsdWRlcygnPycpID8gJyYnIDogJz8nO1xuICAgIHJldHVybiBgJHt1cmx9JHtzZXBhcmF0b3J9d2lkdGg9JHt3fSZxdWFsaXR5PSR7cSB8fCA3NX1gO1xuICB9O1xuXG4gIC8vIElmIHRoZSBpbWFnZSBpcyBhbHJlYWR5IGEgZnVsbCBVUkwsIHdlIG5lZWQgdG8gZXh0cmFjdCB0aGUgcGF0aCBvciBtb2RpZnkgaXQuXG5cbiAgLy8gMS4gSGFuZGxlIGxvY2FsIGltYWdlcyAoc3RhcnRpbmcgd2l0aCAvKS4gUmV0dXJuIGFzLWlzIHRvIGF2b2lkIGJyZWFraW5nIHRoZW0uXG4gIC8vIE5leHQuanMgZGVmYXVsdCBsb2FkZXIgd291bGQgaGFuZGxlIHRoZXNlIGlmIHdlIHdlcmVuJ3QgdXNpbmcgYSBjdXN0b20gbG9hZGVyIGdsb2JhbGx5LlxuICAvLyBTaW5jZSB3ZSBhcmUsIHJldHVybmluZyBzcmMgZXNzZW50aWFsbHkgc2VydmVzIHRoZSBvcmlnaW5hbCBhc3NldC5cbiAgaWYgKHNyYy5zdGFydHNXaXRoKCcvJykpIHtcbiAgICByZXR1cm4gc3JjO1xuICB9XG5cbiAgLy8gU2tpcCB0cmFuc2Zvcm1hdGlvbiBmb3Igbm9uLWltYWdlIGZvcm1hdHMgKHZpZGVvcywgU1ZHcywgR0lGcylcbiAgaWYgKE5PTl9UUkFOU0ZPUk1fRVhURU5TSU9OUy5zb21lKChleHQpID0+IG5vcm1hbGl6ZWRTcmMuZW5kc1dpdGgoZXh0KSkpIHtcbiAgICByZXR1cm4gc3JjO1xuICB9XG5cbiAgbGV0IHByb2plY3RJZCA9ICcnO1xuICBjb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbiAgaWYgKHN1cGFiYXNlVXJsKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoc3VwYWJhc2VVcmwpO1xuICAgICAgY29uc3QgcGFydHMgPSB1cmwuaG9zdG5hbWUuc3BsaXQoJy4nKTtcbiAgICAgIGlmIChwYXJ0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHByb2plY3RJZCA9IHBhcnRzWzBdO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMJywgZSk7XG4gICAgfVxuICB9XG5cbiAgLy8gRmFsbGJhY2sgaWYgZW52IHZhciBpcyBtaXNzaW5nIG9yIHdlIHdhbnQgdG8gcGFyc2UgZnJvbSBzcmNcbiAgaWYgKCFwcm9qZWN0SWQgJiYgc3JjLmluY2x1ZGVzKCdzdXBhYmFzZS5jbycpKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoc3JjKTtcbiAgICAgIGNvbnN0IHBhcnRzID0gdXJsLmhvc3RuYW1lLnNwbGl0KCcuJyk7XG4gICAgICBpZiAocGFydHMubGVuZ3RoID4gMCkge1xuICAgICAgICBwcm9qZWN0SWQgPSBwYXJ0c1swXTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vIGlnbm9yZVxuICAgIH1cbiAgfVxuXG4gIGlmIChzcmMuaW5jbHVkZXMoJy9zdG9yYWdlL3YxL29iamVjdC9wdWJsaWMvJykpIHtcbiAgICBjb25zdCBiYXNlID0gc3JjLnN0YXJ0c1dpdGgoJ2h0dHAnKVxuICAgICAgPyBzcmNcbiAgICAgIDogYCR7REVGQVVMVF9TVVBBQkFTRV9VUkx9JHtzcmMuc3RhcnRzV2l0aCgnLycpID8gJycgOiAnLyd9JHtzcmN9YDtcblxuICAgIGNvbnN0IGlzSW1hZ2UgPSBJTUFHRV9FWFRFTlNJT05TLnNvbWUoKGV4dCkgPT4gbm9ybWFsaXplZFNyYy5lbmRzV2l0aChleHQpKTtcblxuICAgIC8vIE9ubHkgYXBwbHkgU3VwYWJhc2UgaW1hZ2UgcmVuZGVyZXIgZm9yIHN1cHBvcnRlZCBpbWFnZSBleHRlbnNpb25zXG4gICAgaWYgKGlzSW1hZ2UpIHtcbiAgICAgIGNvbnN0IG5ld1NyYyA9IGJhc2UucmVwbGFjZShcbiAgICAgICAgJy9zdG9yYWdlL3YxL29iamVjdC9wdWJsaWMvJyxcbiAgICAgICAgJy9zdG9yYWdlL3YxL3JlbmRlci9pbWFnZS9wdWJsaWMvJ1xuICAgICAgKTtcbiAgICAgIHJldHVybiBhcHBlbmRQYXJhbXMobmV3U3JjLCB3aWR0aCwgcXVhbGl0eSB8fCA3NSk7XG4gICAgfVxuXG4gICAgLy8gRm9yIG90aGVyIGZpbGUgdHlwZXMgKGUuZy4sIHZpZGVvKSwgc2VydmUgdGhlIG9iamVjdCBVUkwgdW50b3VjaGVkXG4gICAgcmV0dXJuIGJhc2U7XG4gIH1cblxuICAvLyBJZiBpdCBtYXRjaGVzIHRoZSByZW5kZXIvaW1hZ2UgcGF0dGVybiBhbHJlYWR5LCBqdXN0IGFwcGVuZCBwYXJhbXNcbiAgaWYgKHNyYy5pbmNsdWRlcygnL3N0b3JhZ2UvdjEvcmVuZGVyL2ltYWdlL3B1YmxpYy8nKSkge1xuICAgIHJldHVybiBhcHBlbmRQYXJhbXMoc3JjLCB3aWR0aCwgcXVhbGl0eSB8fCA3NSk7XG4gIH1cblxuICAvLyBGb3IgcmVsYXRpdmUgcGF0aHMgKGlmIGFueSkgdGhhdCBhcmUgTk9UIGxvY2FsIHBhdGhzIChhbHJlYWR5IGhhbmRsZWQpLFxuICAvLyBjb25zdHJ1Y3QgdGhlIGZ1bGwgU3VwYWJhc2UgVVJMLlxuICAvLyBUaGlzIHBhdGggaXMgaGl0IGlmIGBzcmNgIGlzIHNvbWV0aGluZyBsaWtlICdteS1idWNrZXQvaW1hZ2UucG5nJyAobm90IHN0YXJ0aW5nIHdpdGggLylcbiAgaWYgKCFzcmMuc3RhcnRzV2l0aCgnaHR0cCcpICYmIHByb2plY3RJZCkge1xuICAgIGNvbnN0IGlzSW1hZ2UgPSBJTUFHRV9FWFRFTlNJT05TLnNvbWUoKGV4dCkgPT4gbm9ybWFsaXplZFNyYy5lbmRzV2l0aChleHQpKTtcbiAgICBjb25zdCBwcmVmaXggPSBpc0ltYWdlXG4gICAgICA/ICcvc3RvcmFnZS92MS9yZW5kZXIvaW1hZ2UvcHVibGljLydcbiAgICAgIDogJy9zdG9yYWdlL3YxL29iamVjdC9wdWJsaWMvJztcbiAgICBjb25zdCBmdWxsID0gYGh0dHBzOi8vJHtwcm9qZWN0SWR9LnN1cGFiYXNlLmNvJHtwcmVmaXh9JHtzcmN9YDtcbiAgICByZXR1cm4gaXNJbWFnZSA/IGFwcGVuZFBhcmFtcyhmdWxsLCB3aWR0aCwgcXVhbGl0eSB8fCA3NSkgOiBmdWxsO1xuICB9XG5cbiAgLy8gRmFsbGJhY2sgZm9yIG5vbi1TdXBhYmFzZSBpbWFnZXMgKHJldHVybiBvcmlnaW5hbClcbiAgcmV0dXJuIHNyYztcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==