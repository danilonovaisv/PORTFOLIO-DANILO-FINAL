{"file":"/Users/danilonovais/_danilonov_portfolio/test/unit/project-mapper.test.ts","mappings":"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","names":[],"sources":["/Users/danilonovais/_danilonov_portfolio/test/unit/project-mapper.test.ts"],"sourcesContent":["import { mapDbProjectToPortfolioProject } from '@/lib/portfolio/project-mappers';\nimport { buildSupabaseStorageUrl } from '@/lib/supabase/urls';\n\ndescribe('buildSupabaseStorageUrl', () => {\n  beforeEach(() => {\n    process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co/';\n  });\n\n  it('returns null when file path is missing', () => {\n    expect(buildSupabaseStorageUrl('bucket', '')).toBeNull();\n  });\n\n  it('builds a public object URL', () => {\n    const url = buildSupabaseStorageUrl(\n      'portfolio-media',\n      'projects/thumb.png'\n    );\n    expect(url).toBe(\n      'https://test.supabase.co/storage/v1/object/public/portfolio-media/projects/thumb.png'\n    );\n  });\n\n  it('normalizes paths that include the bucket prefix', () => {\n    const url = buildSupabaseStorageUrl(\n      'site-assets',\n      'site-assets/global/logos/logo.svg'\n    );\n    expect(url).toBe(\n      'https://test.supabase.co/storage/v1/object/public/site-assets/global/logos/logo.svg'\n    );\n  });\n\n  it('normalizes full Supabase URLs to the current project base URL', () => {\n    const url = buildSupabaseStorageUrl(\n      'site-assets',\n      'https://old-project.supabase.co/storage/v1/object/public/site-assets/global/fonts/font.woff2'\n    );\n    // Agora preservamos a origem quando jÃ¡ vem completa de outro projeto Supabase\n    expect(url).toBe(\n      'https://old-project.supabase.co/storage/v1/object/public/site-assets/global/fonts/font.woff2'\n    );\n  });\n\n  it('keeps external URLs untouched', () => {\n    const external = 'https://example.com/image.png';\n    expect(buildSupabaseStorageUrl('site-assets', external)).toBe(external);\n  });\n});\n\ndescribe('mapDbProjectToPortfolioProject', () => {\n  beforeEach(() => {\n    process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\n  });\n\n  it('maps database records into presentation models', () => {\n    const dbProject = {\n      id: 'proj-1',\n      slug: 'test-project',\n      title: 'Test Project',\n      client_name: 'Client',\n      brand_name: null,\n      year: 2024,\n      project_type: 'Motion & Video',\n      short_label: 'Motion',\n      description: 'Desc',\n      thumbnail_path: 'projects/test/thumb.jpg',\n      hero_image_path: null,\n      gallery: [{ path: 'projects/test/gallery/hero.jpg' }],\n      featured_on_home: true,\n      featured_on_portfolio: false,\n      is_published: true,\n      created_at: null,\n      updated_at: null,\n    };\n\n    const mapped = mapDbProjectToPortfolioProject(dbProject as any, 0);\n\n    expect(mapped.id).toBe(dbProject.id);\n    expect(mapped.image).toContain(\n      '/storage/v1/object/public/portfolio-media/projects/test/thumb.jpg'\n    );\n    expect(mapped.category).toBe('motion');\n    expect(mapped.tags).toEqual([]);\n    expect(mapped.detail?.gallery?.[0]).toContain(\n      '/storage/v1/object/public/portfolio-media/projects/test/gallery/hero.jpg'\n    );\n    expect(mapped.featuredOnHome).toBe(true);\n    expect(mapped.type).toBe('A');\n  });\n});\n"],"version":3}