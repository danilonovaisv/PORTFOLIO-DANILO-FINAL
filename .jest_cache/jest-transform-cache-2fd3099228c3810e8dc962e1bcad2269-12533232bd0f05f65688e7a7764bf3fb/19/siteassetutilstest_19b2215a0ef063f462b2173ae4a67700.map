{"file":"/Users/danilonovais/_danilonov_portfolio/test/unit/site-asset-utils.test.ts","mappings":"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","names":[],"sources":["/Users/danilonovais/_danilonov_portfolio/test/unit/site-asset-utils.test.ts"],"sourcesContent":["import { randomUUID } from 'crypto';\nimport type { DbAsset } from '@/types/admin';\nimport {\n  normalizeAssetList,\n  normalizeAssetRecord,\n} from '@/lib/supabase/site-asset-utils';\n\ndescribe('normalizeAssetRecord', () => {\n  beforeEach(() => {\n    process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\n  });\n\n  const baseAsset: DbAsset = {\n    id: 'asset-1',\n    key: 'home.hero_video',\n    bucket: 'site-assets',\n    file_path: 'site-assets/home/home.hero_video.mp4',\n    asset_type: 'video',\n    page: null,\n    description: null,\n    is_active: true,\n    sort_order: null,\n    created_at: null,\n    updated_at: null,\n  };\n\n  it('normalizes bucket, path and page, and builds public URL', () => {\n    const normalized = normalizeAssetRecord(baseAsset);\n    expect(normalized.bucket).toBe('site-assets');\n    expect(normalized.file_path).toBe('home/home.hero_video.mp4');\n    expect(normalized.page).toBe('home');\n    expect(normalized.resolvedPage).toBe('home');\n    expect(normalized.publicUrl).toBe(\n      'https://test.supabase.co/storage/v1/object/public/site-assets/home/home.hero_video.mp4'\n    );\n  });\n\n  it('sanitizes noisy keys', () => {\n    const noisy: DbAsset = {\n      ...baseAsset,\n      key: 'key: about.hero.about.hero.desktop_video',\n      file_path: 'about/hero/about.hero.desktop_video.mp4',\n      page: 'about.hero.about.hero.desktop_video.mp4',\n    };\n    const normalized = normalizeAssetRecord(noisy);\n    expect(normalized.key).toBe('about.hero.about.hero.desktop_video');\n    expect(normalized.page).toBe('about');\n  });\n});\n\ndescribe('normalizeAssetList', () => {\n  beforeEach(() => {\n    process.env.NEXT_PUBLIC_SUPABASE_URL = 'https://test.supabase.co';\n  });\n\n  const asset = (overrides: Partial<DbAsset> = {}): DbAsset => ({\n    id: randomUUID(),\n    key: 'hero',\n    bucket: 'site-assets',\n    file_path: 'home/hero.mp4',\n    asset_type: 'video',\n    page: 'home',\n    description: null,\n    is_active: true,\n    sort_order: null,\n    created_at: null,\n    updated_at: null,\n    ...overrides,\n  });\n\n  it('filters invalid rows and prefers active entries when deduping', () => {\n    const results = normalizeAssetList([\n      asset({ key: 'updated_at: 2026-01-14' }),\n      asset({ key: 'hero', is_active: false }),\n      asset({ key: 'hero', id: 'hero-active' }),\n      asset({ key: 'missing-path', file_path: '', id: 'no-path' }),\n    ]);\n\n    expect(results.find((item) => item.key === 'hero')?.id).toBe('hero-active');\n    expect(results.find((item) => item.key.startsWith('updated_at'))).toBe(\n      undefined\n    );\n    expect(results.find((item) => item.id === 'no-path')).toBeUndefined();\n  });\n});\n"],"version":3}