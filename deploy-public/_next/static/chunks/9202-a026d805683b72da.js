(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9202],{3091:(e,t,l)=>{"use strict";l.d(t,{_:()=>s,r:()=>a});let a="legacy-blocks",s="master-project-v1"},28713:(e,t,l)=>{"use strict";l.d(t,{i:()=>i});var a=l(57716),s=l(87358);let r=null;function i(){if(s.env.PLAYWRIGHT_TEST){let e={eq:()=>e,order:()=>e,limit:()=>e,returns:()=>Promise.resolve({data:[],error:null}),select:()=>e,single:()=>Promise.resolve({data:null,error:null})};return{from:()=>e,auth:{getSession:()=>Promise.resolve({data:{session:null},error:null}),onAuthStateChange:()=>({data:{subscription:{unsubscribe:()=>{}}}})},storage:{from:()=>({getPublicUrl:()=>({data:{publicUrl:""}})})}}}if(r)return r;let e="https://umkmwbkwvulxtdodzmzf.supabase.co",t=s.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_DEFAULT_KEY??"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVta213Ymt3dnVseHRkb2R6bXpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNDE4MzcsImV4cCI6MjA4MzkxNzgzN30.wssvD9W-yzRyLpq8aMCw57E4wNz7OnQ58ujLzYmF6CA";if(!e)throw Error("NEXT_PUBLIC_SUPABASE_URL n\xe3o est\xe1 definida.");if(!t)throw Error("Defina NEXT_PUBLIC_SUPABASE_PUBLISHABLE_DEFAULT_KEY ou NEXT_PUBLIC_SUPABASE_ANON_KEY.");return r=(0,a.createBrowserClient)(e,t,{cookieOptions:{name:"__session",sameSite:"lax",secure:!0}})}},58520:(e,t,l)=>{"use strict";function a(e,t){if(!e)return null;let l=t?.replace(/^\/+|\/+$/g,""),a=e.trim();return a=(a=(a=(a=(a=(a=(a=(a=(a=a.replace(/^file_path:\s*/i,"")).replace(/^key:\s*/i,"")).replace(/^"+|"+$/g,"")).replace(/^'+|'+$/g,"")).replace(/,+$/g,"")).replace(/\s+$/g,"")).replace(/^https?:\/\/[^/]+\/storage\/v1\/(?:render\/image|object)\/public\//,"")).replace(/^\/?storage\/v1\/(?:render\/image|object)\/public\//,"")).replace(/^\/+/,""),l&&a.startsWith(`${l}/`)&&(a=a.slice(l.length+1)),a}function s(e,t){if(!t)return null;let l=t.startsWith("http://")||t.startsWith("https://"),s=t.includes("/storage/v1/");if(l&&!s)try{let e=new URL(t);if("https:"!==e.protocol)return console.warn(`Protocolo inseguro detectado: ${t}`),null;return t}catch{return console.error(`URL inv\xe1lida: ${t}`),null}let r=e.replace(/^\/+|\/+$/g,""),i=a(t,r);if(!i)return t.startsWith("http")?t:null;if(l&&s)try{let e=new URL(t),l=`${e.protocol}//${e.host}`;return`${l}/storage/v1/object/public/${r}/${i}`}catch{}let n=function(){let e="https://umkmwbkwvulxtdodzmzf.supabase.co";if(!e)throw Error("Supabase URL n\xe3o definida. Configure NEXT_PUBLIC_SUPABASE_URL ou SUPABASE_URL.");try{return e.replace(/\/+$/,"")}catch{return e}}();return n?`${n}/storage/v1/object/public/${r}/${i}`:t.startsWith("http")?t:null}function r(e){if(!e)return null;let t=e.trim();if(!t)return null;try{let l=new URL(t);if(["https:","http:"].includes(l.protocol))return l.toString();return console.warn(`Link externo inseguro bloqueado: ${e}`),null}catch{if(t.startsWith("/")||t.startsWith("#"))return t;if(t.startsWith("//"))try{return new URL(`https:${t}`).toString()}catch{}return console.error(`URL externa inv\xe1lida: ${e}`),null}}l.d(t,{VV:()=>s,WZ:()=>a,j7:()=>r})},58719:(e,t,l)=>{"use strict";l.d(t,{ProjectForm:()=>m});var a=l(95155),s=l(12115),r=l(73321),i=l(33546),n=l(99003),o=l(86443),c=l(28713),d=l(85580),p=l(3091);let u=o.Ikc({title:o.YjP().min(3),slug:o.YjP().min(3),client_name:o.YjP().min(2),brand_name:o.YjP().optional(),year:o.auy.number().int().optional(),project_type:o.YjP().min(2),short_label:o.YjP().optional(),description:o.YjP().optional(),featured_on_home:o.zMY().optional(),featured_on_portfolio:o.zMY().optional(),featured_home_order:o.auy.number().int().optional().nullable(),featured_portfolio_order:o.auy.number().int().optional().nullable(),is_published:o.zMY().optional(),landing_page_id:o.YjP().optional().nullable(),tags:o.YOg(o.YjP()).optional()});function m({project:e,tags:t,landingPages:l,selectedTagIds:o=[]}){let[m,x]=(0,s.useState)(null),[h,g]=(0,s.useState)(null),[b,f]=(0,s.useState)([]),[_,j]=(0,s.useState)(null),[N,y]=(0,s.useTransition)(),w=(0,r.useRouter)(),v=(0,n.mN)({resolver:(0,i.u)(u),defaultValues:{title:e?.title??"",slug:e?.slug??"",client_name:e?.client_name??"",brand_name:e?.brand_name??"",year:e?.year??void 0,project_type:e?.project_type??"Branding & Identity",short_label:e?.short_label??"",description:e?.description??"",featured_on_home:e?.featured_on_home??!1,featured_on_portfolio:e?.featured_on_portfolio??!1,featured_home_order:e?.featured_home_order??void 0,featured_portfolio_order:e?.featured_portfolio_order??void 0,is_published:e?.is_published??!0,landing_page_id:e?.landing_page_id??"",tags:o}}),P=v.watch("tags")||[],$=(0,s.useMemo)(()=>l.map(e=>{let t=e.content&&"object"==typeof e.content&&"template"in e.content&&e.content.template===p._?p._:p.r;return{...e,template:t}}),[l]);return(0,a.jsxs)("form",{className:"space-y-6",onSubmit:v.handleSubmit(t=>{j(null),y(async()=>{try{let l=(0,c.i)(),a=e?.thumbnail_path??null,s=e?.hero_image_path??null,r=Array.isArray(e?.gallery)?e?.gallery?.map(e=>({path:e.path})):[];if(m&&(a=await (0,d.b)("portfolio-media",`projects/${t.slug}`,"thumb",m)),h&&(s=await (0,d.b)("portfolio-media",`projects/${t.slug}`,"hero",h)),b.length>0)for(let e of b){let l=await (0,d.b)("portfolio-media",`projects/${t.slug}/gallery`,e.name.replace(/\W+/g,"-"),e);l&&r.push({path:l})}let{tags:i=[],...n}=t;""===n.landing_page_id&&(n.landing_page_id=null);let{data:o,error:p}=await l.from("portfolio_projects").upsert({id:e?.id,...n,gallery:r,thumbnail_path:a,hero_image_path:s},{onConflict:"id"}).select().single();if(p)throw p;if(o?.id){await l.from("portfolio_project_tags").delete().eq("project_id",o.id);let e=i.length>0?i:P;e.length>0&&await l.from("portfolio_project_tags").insert(e.map(e=>({project_id:o.id,tag_id:e})))}w.push("/admin/trabalhos"),w.refresh()}catch(e){j(e instanceof Error?e.message:"Ocorreu um erro desconhecido")}})}),children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-slate-300",children:"T\xedtulo"}),(0,a.jsx)("input",{className:"rounded-md bg-slate-900/60 border border-white/10 px-3 py-2 text-sm",...v.register("title")})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-slate-300",children:"Slug"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[t.length>0&&(0,a.jsxs)("select",{className:"rounded-md bg-slate-900/60 border border-white/10 px-3 py-2 text-sm text-slate-200",defaultValue:"",onChange:e=>{let t=e.target.value;t&&v.setValue("slug",t)},children:[(0,a.jsx)("option",{value:"",children:"Usar slug das tags existentes"}),t.map(e=>(0,a.jsxs)("option",{value:e.slug,children:[e.label," â€” ",e.slug]},e.id))]}),(0,a.jsx)("input",{className:"rounded-md bg-slate-900/60 border border-white/10 px-3 py-2 text-sm",...v.register("slug")})]})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-slate-300",children:"Cliente"}),(0,a.jsx)("input",{className:"rounded-md bg-slate-900/60 border border-white/10 px-3 py-2 text-sm",...v.register("client_name")})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-slate-300",children:"Marca"}),(0,a.jsx)("input",{className:"rounded-md bg-slate-900/60 border border-white/10 px-3 py-2 text-sm",...v.register("brand_name")})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-slate-300",children:"Ano"}),(0,a.jsx)("input",{type:"number",className:"rounded-md bg-slate-900/60 border border-white/10 px-3 py-2 text-sm",...v.register("year")})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-slate-300",children:"Tipo de projeto"}),(0,a.jsxs)("select",{className:"rounded-md bg-slate-900/60 border border-white/10 px-3 py-2 text-sm",...v.register("project_type"),children:[(0,a.jsx)("option",{children:"Branding & Identity"}),(0,a.jsx)("option",{children:"Campanhas & Advertising"}),(0,a.jsx)("option",{children:"Web & Digital"}),(0,a.jsx)("option",{children:"Motion & Video"}),(0,a.jsx)("option",{children:"Institucional & Retail"})]})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,a.jsx)("span",{className:"text-sm text-slate-300",children:"Short label"}),(0,a.jsx)("input",{className:"rounded-md bg-slate-900/60 border border-white/10 px-3 py-2 text-sm",...v.register("short_label")})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 md:col-span-2",children:[(0,a.jsx)("span",{className:"text-sm text-slate-300",children:"Descri\xe7\xe3o"}),(0,a.jsx)("textarea",{rows:4,className:"rounded-md bg-slate-900/60 border border-white/10 px-3 py-2 text-sm",...v.register("description")})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[(0,a.jsx)("input",{type:"checkbox",...v.register("featured_on_home")}),"Destaque Home"]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[(0,a.jsx)("input",{type:"checkbox",...v.register("featured_on_portfolio")}),"Destaque Portf\xf3lio"]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-300",children:[(0,a.jsx)("input",{type:"checkbox",...v.register("is_published")}),"Publicado"]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-slate-300",children:"Ordem Home"}),(0,a.jsx)("input",{type:"number",className:"rounded-md bg-slate-900/60 border border-white/10 px-3 py-2 text-sm",...v.register("featured_home_order")})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-slate-300",children:"Ordem Portf\xf3lio"}),(0,a.jsx)("input",{type:"number",className:"rounded-md bg-slate-900/60 border border-white/10 px-3 py-2 text-sm",...v.register("featured_portfolio_order")})]})]}),(0,a.jsxs)("div",{className:"p-6 bg-blue-600/5 border border-blue-600/10 rounded-xl space-y-4",children:[(0,a.jsx)("h3",{className:"text-sm font-bold uppercase tracking-widest text-blue-400",children:"P\xe1gina de Destino (Link Interno)"}),(0,a.jsxs)("label",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-xs text-slate-400",children:"Selecione uma Landing Page para este trabalho"}),(0,a.jsxs)("select",{className:"rounded-md bg-slate-900 border border-white/10 px-3 py-2 text-sm text-white",...v.register("landing_page_id"),children:[(0,a.jsx)("option",{value:"",children:"Nenhuma (Default)"}),$.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.title," (/",e.slug,") \xb7"," ",e.template===p._?"Template Mestre":"Legacy"]},e.id))]}),(0,a.jsx)("p",{className:"text-[10px] text-slate-500 italic",children:"Quando vinculado, o clique no trabalho abrir\xe1 a Landing Page customizada em vez de uma visualiza\xe7\xe3o padr\xe3o."})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-slate-300",children:"Thumbnail"}),(0,a.jsx)("input",{type:"file",accept:"image/*,video/*",onChange:e=>x(e.target.files?.[0]??null)}),e?.thumbnail_path&&(0,a.jsx)("span",{className:"text-xs text-slate-400 break-all",children:e.thumbnail_path})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-slate-300",children:"Hero image"}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>g(e.target.files?.[0]??null)}),e?.hero_image_path&&(0,a.jsx)("span",{className:"text-xs text-slate-400 break-all",children:e.hero_image_path})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-slate-300",children:"Galeria"}),(0,a.jsx)("input",{type:"file",accept:"image/*,video/*",multiple:!0,onChange:e=>f(Array.from(e.target.files??[]))}),Array.isArray(e?.gallery)&&e.gallery.length>0&&(0,a.jsxs)("span",{className:"text-xs text-slate-400",children:[e.gallery.length," itens j\xe1 cadastrados"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-slate-300 mb-2",children:"Tags"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-3",children:t.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-200",children:[(0,a.jsx)("input",{type:"checkbox",value:e.id,checked:P.includes(e.id),onChange:e=>{let{checked:t,value:l}=e.target;t?v.setValue("tags",[...P,l]):v.setValue("tags",P.filter(e=>e!==l))}}),e.label]},e.id))})]}),_&&(0,a.jsx)("div",{className:"text-sm text-red-400",children:_}),(0,a.jsx)("button",{type:"submit",className:"inline-flex items-center justify-center rounded-md bg-blue-500 px-4 py-2 text-sm font-semibold text-white shadow transition hover:bg-blue-600 disabled:opacity-50",disabled:N,children:N?"Salvando...":"Salvar projeto"})]})}},85580:(e,t,l)=>{"use strict";l.d(t,{h:()=>n,b:()=>i});var a=l(28713);let s=/[^a-z0-9._-]/g;var r=l(58520);async function i(e,t,l,s){let i,n,o=(0,a.i)(),c=s.name.split(".").pop(),d=c?`${l}.${c}`:l,p=(n=(i=t.replace(/\/+$/g,"").replace(/^\/+/g,""))?`${i}`:"")?`${n}/${d}`:d,{data:u,error:m}=await o.storage.from(e).upload(p,s,{cacheControl:"3600",upsert:!0});if(m)throw m;return(0,r.WZ)(u.path,e)}async function n({file:e,key:t,page:l,subPath:i,bucket:n="site-assets"}){let o=(0,a.i)(),c=function({page:e,key:t,subPath:l,extension:a}){let r=[e&&e.trim().length>0?e.trim():"global"];l&&r.push(l.trim().replace(/^\/+|\/+$/g,""));let i=t.trim().toLowerCase().replace(/\s+/g,"_").replace(s,""),n=a.toLowerCase().replace(/^\.+/,"")||"bin",o=`${i}.${n}`;return`${r.join("/")}/${o}`}({page:l,key:t,subPath:i,extension:e.name.split(".").pop()??"bin"}),{data:d,error:p}=await o.storage.from(n).upload(c,e,{cacheControl:"3600",upsert:!0});if(p)throw p;return(0,r.WZ)(d.path,n)}},89202:(e,t,l)=>{Promise.resolve().then(l.bind(l,58719))}}]);