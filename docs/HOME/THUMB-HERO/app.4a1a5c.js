"use strict";(self.webpackChunk_roots_bud_sage=self.webpackChunk_roots_bud_sage||[]).push([[524],{"./styles/app.scss":()=>{},"./scripts/app.js":(t,e,n)=>{var i={};n.r(i),n.d(i,{IzY:()=>vM,$Kf:()=>y_,UtB:()=>eM,NRn:()=>Km,BND:()=>gM,iNn:()=>ny,THS:()=>Tv,LoY:()=>Nv,SUR:()=>FS,i7d:()=>ly,WTh:()=>fM,GOR:()=>q_,ghU:()=>bp,Q1f:()=>pv,qFE:()=>mw,hy7:()=>fp,xFO:()=>mp,b4q:()=>my,Om:()=>yp,Z0B:()=>iw,s0K:()=>rw,jGm:()=>uw,Ho_:()=>fw,GYF:()=>x_,GxU:()=>wv,ZyN:()=>kS,PFK:()=>uM,nEu:()=>vw,$EB:()=>Ud,Vnu:()=>nm,S20:()=>$_,O9p:()=>Ig,Qev:()=>am,QCA:()=>Xw,Y9S:()=>_S,qtW:()=>Cv,RQf:()=>Ip,jUj:()=>p_,Wdf:()=>im,YJl:()=>i_,ix0:()=>zp,dth:()=>TS,WBB:()=>Yw,uWO:()=>S_,CmU:()=>BS,ZLX:()=>O_,nzx:()=>pw,veJ:()=>MS,cZY:()=>rM,mrM:()=>D_,GZZ:()=>sw,VnP:()=>aw,DXC:()=>G_,k6q:()=>Tp,Zr2:()=>Bf,aHM:()=>yS,kBv:()=>Rd,cj9:()=>vm,dwI:()=>xm,kn4:()=>Mg,eaF:()=>ty,V9B:()=>vv,hxR:()=>wp,NTi:()=>kd,B69:()=>Kg,qUd:()=>By,QP0:()=>Dd,wAk:()=>dw,ubm:()=>dy,Zcv:()=>by,bdM:()=>Ey,HiM:()=>NS,F1l:()=>oM,dAo:()=>ow,PTz:()=>Xm,GWd:()=>jp,c90:()=>Kp,HIg:()=>Vp,paN:()=>Yp,D$Q:()=>tS,RlV:()=>Sg,tBo:()=>ZS,VT0:()=>Xp,er$:()=>kf,Z58:()=>f_,vxI:()=>Ay,zkh:()=>Py,BKk:()=>oy,ypk:()=>yw,MSw:()=>Zw,Ld9:()=>yM,xJ6:()=>Gw,EAD:()=>w_,iyt:()=>mg,Gu$:()=>Kw,YHV:()=>QS,xfg:()=>cw,nCl:()=>OS,Fpm:()=>aM,wtR:()=>Od,gPd:()=>Vm,Tap:()=>SS,O3Y:()=>Jw,UPV:()=>Qw,lMl:()=>lv,MW4:()=>Av,nc$:()=>$S,fCn:()=>Cy,LlO:()=>ay,bkx:()=>Lp,I9Y:()=>ym,Pq0:()=>$m,IUQ:()=>jm,Nv2:()=>W_,AT1:()=>xM,nWS:()=>Gm,JeP:()=>d_});var r={};n.r(r);const s=t=>{window.requestAnimationFrame((async function e(){document.body?await t():window.requestAnimationFrame(e)}))};window.jQuery;function a(t,e,n){return Math.max(t,Math.min(e,n))}class o{constructor(){this.isRunning=!1,this.value=0,this.from=0,this.to=0,this.currentTime=0}advance(t){var e;if(!this.isRunning)return;let n=!1;if(this.duration&&this.easing){this.currentTime+=t;const e=a(0,this.currentTime/this.duration,1);n=e>=1;const i=n?1:this.easing(e);this.value=this.from+(this.to-this.from)*i}else this.lerp?(this.value=function(t,e,n,i){return function(t,e,n){return(1-n)*t+n*e}(t,e,1-Math.exp(-n*i))}(this.value,this.to,60*this.lerp,t),Math.round(this.value)===this.to&&(this.value=this.to,n=!0)):(this.value=this.to,n=!0);n&&this.stop(),null===(e=this.onUpdate)||void 0===e||e.call(this,this.value,n)}stop(){this.isRunning=!1}fromTo(t,e,{lerp:n,duration:i,easing:r,onStart:s,onUpdate:a}){this.from=this.value=t,this.to=e,this.lerp=n,this.duration=i,this.easing=r,this.currentTime=0,this.isRunning=!0,null==s||s(),this.onUpdate=a}}class l{constructor(t,e,{autoResize:n=!0,debounce:i=250}={}){this.wrapper=t,this.content=e,this.width=0,this.height=0,this.scrollHeight=0,this.scrollWidth=0,this.resize=()=>{this.onWrapperResize(),this.onContentResize()},this.onWrapperResize=()=>{this.wrapper instanceof Window?(this.width=window.innerWidth,this.height=window.innerHeight):(this.width=this.wrapper.clientWidth,this.height=this.wrapper.clientHeight)},this.onContentResize=()=>{this.wrapper instanceof Window?(this.scrollHeight=this.content.scrollHeight,this.scrollWidth=this.content.scrollWidth):(this.scrollHeight=this.wrapper.scrollHeight,this.scrollWidth=this.wrapper.scrollWidth)},n&&(this.debouncedResize=function(t,e){let n;return function(...i){let r=this;clearTimeout(n),n=setTimeout((()=>{n=void 0,t.apply(r,i)}),e)}}(this.resize,i),this.wrapper instanceof Window?window.addEventListener("resize",this.debouncedResize,!1):(this.wrapperResizeObserver=new ResizeObserver(this.debouncedResize),this.wrapperResizeObserver.observe(this.wrapper)),this.contentResizeObserver=new ResizeObserver(this.debouncedResize),this.contentResizeObserver.observe(this.content)),this.resize()}destroy(){var t,e;null===(t=this.wrapperResizeObserver)||void 0===t||t.disconnect(),null===(e=this.contentResizeObserver)||void 0===e||e.disconnect(),this.wrapper===window&&this.debouncedResize&&window.removeEventListener("resize",this.debouncedResize,!1)}get limit(){return{x:this.scrollWidth-this.width,y:this.scrollHeight-this.height}}}class c{constructor(){this.events={}}emit(t,...e){var n;let i=this.events[t]||[];for(let t=0,r=i.length;t<r;t++)null===(n=i[t])||void 0===n||n.call(i,...e)}on(t,e){var n;return(null===(n=this.events[t])||void 0===n?void 0:n.push(e))||(this.events[t]=[e]),()=>{var n;this.events[t]=null===(n=this.events[t])||void 0===n?void 0:n.filter((t=>e!==t))}}off(t,e){var n;this.events[t]=null===(n=this.events[t])||void 0===n?void 0:n.filter((t=>e!==t))}destroy(){this.events={}}}const h=100/6,u={passive:!1};class d{constructor(t,e={wheelMultiplier:1,touchMultiplier:1}){this.element=t,this.options=e,this.touchStart={x:0,y:0},this.lastDelta={x:0,y:0},this.window={width:0,height:0},this.emitter=new c,this.onTouchStart=t=>{const{clientX:e,clientY:n}=t.targetTouches?t.targetTouches[0]:t;this.touchStart.x=e,this.touchStart.y=n,this.lastDelta={x:0,y:0},this.emitter.emit("scroll",{deltaX:0,deltaY:0,event:t})},this.onTouchMove=t=>{const{clientX:e,clientY:n}=t.targetTouches?t.targetTouches[0]:t,i=-(e-this.touchStart.x)*this.options.touchMultiplier,r=-(n-this.touchStart.y)*this.options.touchMultiplier;this.touchStart.x=e,this.touchStart.y=n,this.lastDelta={x:i,y:r},this.emitter.emit("scroll",{deltaX:i,deltaY:r,event:t})},this.onTouchEnd=t=>{this.emitter.emit("scroll",{deltaX:this.lastDelta.x,deltaY:this.lastDelta.y,event:t})},this.onWheel=t=>{let{deltaX:e,deltaY:n,deltaMode:i}=t;e*=1===i?h:2===i?this.window.width:1,n*=1===i?h:2===i?this.window.height:1,e*=this.options.wheelMultiplier,n*=this.options.wheelMultiplier,this.emitter.emit("scroll",{deltaX:e,deltaY:n,event:t})},this.onWindowResize=()=>{this.window={width:window.innerWidth,height:window.innerHeight}},window.addEventListener("resize",this.onWindowResize,!1),this.onWindowResize(),this.element.addEventListener("wheel",this.onWheel,u),this.element.addEventListener("touchstart",this.onTouchStart,u),this.element.addEventListener("touchmove",this.onTouchMove,u),this.element.addEventListener("touchend",this.onTouchEnd,u)}on(t,e){return this.emitter.on(t,e)}destroy(){this.emitter.destroy(),window.removeEventListener("resize",this.onWindowResize,!1),this.element.removeEventListener("wheel",this.onWheel,u),this.element.removeEventListener("touchstart",this.onTouchStart,u),this.element.removeEventListener("touchmove",this.onTouchMove,u),this.element.removeEventListener("touchend",this.onTouchEnd,u)}}class p{constructor({wrapper:t=window,content:e=document.documentElement,eventsTarget:n=t,smoothWheel:i=!0,syncTouch:r=!1,syncTouchLerp:s=.075,touchInertiaMultiplier:a=35,duration:h,easing:u=(t=>Math.min(1,1.001-Math.pow(2,-10*t))),lerp:p=.1,infinite:f=!1,orientation:m="vertical",gestureOrientation:g="vertical",touchMultiplier:v=1,wheelMultiplier:y=1,autoResize:x=!0,prevent:b,virtualScroll:_,__experimental__naiveDimensions:w=!1}={}){this._isScrolling=!1,this._isStopped=!1,this._isLocked=!1,this._preventNextNativeScrollEvent=!1,this._resetVelocityTimeout=null,this.time=0,this.userData={},this.lastVelocity=0,this.velocity=0,this.direction=0,this.animate=new o,this.emitter=new c,this.onPointerDown=t=>{1===t.button&&this.reset()},this.onVirtualScroll=t=>{if("function"==typeof this.options.virtualScroll&&!1===this.options.virtualScroll(t))return;const{deltaX:e,deltaY:n,event:i}=t;if(this.emitter.emit("virtual-scroll",{deltaX:e,deltaY:n,event:i}),i.ctrlKey)return;const r=i.type.includes("touch"),s=i.type.includes("wheel");if(this.isTouching="touchstart"===i.type||"touchmove"===i.type,this.options.syncTouch&&r&&"touchstart"===i.type&&!this.isStopped&&!this.isLocked)return void this.reset();const a=0===e&&0===n,o="vertical"===this.options.gestureOrientation&&0===n||"horizontal"===this.options.gestureOrientation&&0===e;if(a||o)return;let l=i.composedPath();l=l.slice(0,l.indexOf(this.rootElement));const c=this.options.prevent;if(l.find((t=>{var e,n,i,a,o;return t instanceof HTMLElement&&("function"==typeof c&&(null==c?void 0:c(t))||(null===(e=t.hasAttribute)||void 0===e?void 0:e.call(t,"data-lenis-prevent"))||r&&(null===(n=t.hasAttribute)||void 0===n?void 0:n.call(t,"data-lenis-prevent-touch"))||s&&(null===(i=t.hasAttribute)||void 0===i?void 0:i.call(t,"data-lenis-prevent-wheel"))||(null===(a=t.classList)||void 0===a?void 0:a.contains("lenis"))&&!(null===(o=t.classList)||void 0===o?void 0:o.contains("lenis-stopped")))})))return;if(this.isStopped||this.isLocked)return void i.preventDefault();if(!(this.options.syncTouch&&r||this.options.smoothWheel&&s))return this.isScrolling="native",void this.animate.stop();i.preventDefault();let h=n;"both"===this.options.gestureOrientation?h=Math.abs(n)>Math.abs(e)?n:e:"horizontal"===this.options.gestureOrientation&&(h=e);const u=r&&this.options.syncTouch,d=r&&"touchend"===i.type&&Math.abs(h)>5;d&&(h=this.velocity*this.options.touchInertiaMultiplier),this.scrollTo(this.targetScroll+h,Object.assign({programmatic:!1},u?{lerp:d?this.options.syncTouchLerp:1}:{lerp:this.options.lerp,duration:this.options.duration,easing:this.options.easing}))},this.onNativeScroll=()=>{if(null!==this._resetVelocityTimeout&&(clearTimeout(this._resetVelocityTimeout),this._resetVelocityTimeout=null),this._preventNextNativeScrollEvent)this._preventNextNativeScrollEvent=!1;else if(!1===this.isScrolling||"native"===this.isScrolling){const t=this.animatedScroll;this.animatedScroll=this.targetScroll=this.actualScroll,this.lastVelocity=this.velocity,this.velocity=this.animatedScroll-t,this.direction=Math.sign(this.animatedScroll-t),this.isScrolling="native",this.emit(),0!==this.velocity&&(this._resetVelocityTimeout=setTimeout((()=>{this.lastVelocity=this.velocity,this.velocity=0,this.isScrolling=!1,this.emit()}),400))}},window.lenisVersion="1.1.13",t&&t!==document.documentElement&&t!==document.body||(t=window),this.options={wrapper:t,content:e,eventsTarget:n,smoothWheel:i,syncTouch:r,syncTouchLerp:s,touchInertiaMultiplier:a,duration:h,easing:u,lerp:p,infinite:f,gestureOrientation:g,orientation:m,touchMultiplier:v,wheelMultiplier:y,autoResize:x,prevent:b,virtualScroll:_,__experimental__naiveDimensions:w},this.dimensions=new l(t,e,{autoResize:x}),this.updateClassName(),this.targetScroll=this.animatedScroll=this.actualScroll,this.options.wrapper.addEventListener("scroll",this.onNativeScroll,!1),this.options.wrapper.addEventListener("pointerdown",this.onPointerDown,!1),this.virtualScroll=new d(n,{touchMultiplier:v,wheelMultiplier:y}),this.virtualScroll.on("scroll",this.onVirtualScroll)}destroy(){this.emitter.destroy(),this.options.wrapper.removeEventListener("scroll",this.onNativeScroll,!1),this.options.wrapper.removeEventListener("pointerdown",this.onPointerDown,!1),this.virtualScroll.destroy(),this.dimensions.destroy(),this.cleanUpClassName()}on(t,e){return this.emitter.on(t,e)}off(t,e){return this.emitter.off(t,e)}setScroll(t){this.isHorizontal?this.rootElement.scrollLeft=t:this.rootElement.scrollTop=t}resize(){this.dimensions.resize(),this.animatedScroll=this.targetScroll=this.actualScroll,this.emit()}emit(){this.emitter.emit("scroll",this)}reset(){this.isLocked=!1,this.isScrolling=!1,this.animatedScroll=this.targetScroll=this.actualScroll,this.lastVelocity=this.velocity=0,this.animate.stop()}start(){this.isStopped&&(this.isStopped=!1,this.reset())}stop(){this.isStopped||(this.isStopped=!0,this.animate.stop(),this.reset())}raf(t){const e=t-(this.time||t);this.time=t,this.animate.advance(.001*e)}scrollTo(t,{offset:e=0,immediate:n=!1,lock:i=!1,duration:r=this.options.duration,easing:s=this.options.easing,lerp:o=this.options.lerp,onStart:l,onComplete:c,force:h=!1,programmatic:u=!0,userData:d}={}){if(!this.isStopped&&!this.isLocked||h){if("string"==typeof t&&["top","left","start"].includes(t))t=0;else if("string"==typeof t&&["bottom","right","end"].includes(t))t=this.limit;else{let n;if("string"==typeof t?n=document.querySelector(t):t instanceof HTMLElement&&(null==t?void 0:t.nodeType)&&(n=t),n){if(this.options.wrapper!==window){const t=this.rootElement.getBoundingClientRect();e-=this.isHorizontal?t.left:t.top}const i=n.getBoundingClientRect();t=(this.isHorizontal?i.left:i.top)+this.animatedScroll}}if("number"==typeof t){if(t+=e,t=Math.round(t),this.options.infinite?u&&(this.targetScroll=this.animatedScroll=this.scroll):t=a(0,t,this.limit),t===this.targetScroll)return null==l||l(this),void(null==c||c(this));if(this.userData=null!=d?d:{},n)return this.animatedScroll=this.targetScroll=t,this.setScroll(this.scroll),this.reset(),this.preventNextNativeScrollEvent(),this.emit(),null==c||c(this),void(this.userData={});u||(this.targetScroll=t),this.animate.fromTo(this.animatedScroll,t,{duration:r,easing:s,lerp:o,onStart:()=>{i&&(this.isLocked=!0),this.isScrolling="smooth",null==l||l(this)},onUpdate:(t,e)=>{this.isScrolling="smooth",this.lastVelocity=this.velocity,this.velocity=t-this.animatedScroll,this.direction=Math.sign(this.velocity),this.animatedScroll=t,this.setScroll(this.scroll),u&&(this.targetScroll=t),e||this.emit(),e&&(this.reset(),this.emit(),null==c||c(this),this.userData={},this.preventNextNativeScrollEvent())}})}}}preventNextNativeScrollEvent(){this._preventNextNativeScrollEvent=!0,requestAnimationFrame((()=>{this._preventNextNativeScrollEvent=!1}))}get rootElement(){return this.options.wrapper===window?document.documentElement:this.options.wrapper}get limit(){return this.options.__experimental__naiveDimensions?this.isHorizontal?this.rootElement.scrollWidth-this.rootElement.clientWidth:this.rootElement.scrollHeight-this.rootElement.clientHeight:this.dimensions.limit[this.isHorizontal?"x":"y"]}get isHorizontal(){return"horizontal"===this.options.orientation}get actualScroll(){return this.isHorizontal?this.rootElement.scrollLeft:this.rootElement.scrollTop}get scroll(){return this.options.infinite?function(t,e){return(t%e+e)%e}(this.animatedScroll,this.limit):this.animatedScroll}get progress(){return 0===this.limit?1:this.scroll/this.limit}get isScrolling(){return this._isScrolling}set isScrolling(t){this._isScrolling!==t&&(this._isScrolling=t,this.updateClassName())}get isStopped(){return this._isStopped}set isStopped(t){this._isStopped!==t&&(this._isStopped=t,this.updateClassName())}get isLocked(){return this._isLocked}set isLocked(t){this._isLocked!==t&&(this._isLocked=t,this.updateClassName())}get isSmooth(){return"smooth"===this.isScrolling}get className(){let t="lenis";return this.isStopped&&(t+=" lenis-stopped"),this.isLocked&&(t+=" lenis-locked"),this.isScrolling&&(t+=" lenis-scrolling"),"smooth"===this.isScrolling&&(t+=" lenis-smooth"),t}updateClassName(){this.cleanUpClassName(),this.rootElement.className=`${this.rootElement.className} ${this.className}`.trim()}cleanUpClassName(){this.rootElement.className=this.rootElement.className.replace(/lenis(-\w+)?/g,"").trim()}}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var g,v,y,x,b,_,w,S,M,T,E,A={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},C={duration:.5,overwrite:!1,delay:0},P=1e8,R=1e-8,O=2*Math.PI,D=O/4,L=0,I=Math.sqrt,z=Math.cos,N=Math.sin,U=function(t){return"string"==typeof t},k=function(t){return"function"==typeof t},B=function(t){return"number"==typeof t},F=function(t){return void 0===t},V=function(t){return"object"==typeof t},j=function(t){return!1!==t},H=function(){return"undefined"!=typeof window},G=function(t){return k(t)||U(t)},W="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},q=Array.isArray,X=/(?:-?\.?\d|\.)+/gi,Y=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Z=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,K=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,J=/[+-]=-?[.\d]+/,Q=/[^,'"\[\]\s]+/gi,tt=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,et={},nt={},it=function(t){return(nt=Dt(t,et))&&In},rt=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},st=function(t,e){return!e&&console.warn(t)},at=function(t,e){return t&&(et[t]=e)&&nt&&(nt[t]=e)||et},ot=function(){return 0},lt={suppressEvents:!0,isStart:!0,kill:!1},ct={suppressEvents:!0,kill:!1},ht={suppressEvents:!0},ut={},dt=[],pt={},ft={},mt={},gt=30,vt=[],yt="",xt=function(t){var e,n,i=t[0];if(V(i)||k(i)||(t=[t]),!(e=(i._gsap||{}).harness)){for(n=vt.length;n--&&!vt[n].targetTest(i););e=vt[n]}for(n=t.length;n--;)t[n]&&(t[n]._gsap||(t[n]._gsap=new Xe(t[n],e)))||t.splice(n,1);return t},bt=function(t){return t._gsap||xt(he(t))[0]._gsap},_t=function(t,e,n){return(n=t[e])&&k(n)?t[e]():F(n)&&t.getAttribute&&t.getAttribute(e)||n},wt=function(t,e){return(t=t.split(",")).forEach(e)||t},St=function(t){return Math.round(1e5*t)/1e5||0},Mt=function(t){return Math.round(1e7*t)/1e7||0},Tt=function(t,e){var n=e.charAt(0),i=parseFloat(e.substr(2));return t=parseFloat(t),"+"===n?t+i:"-"===n?t-i:"*"===n?t*i:t/i},Et=function(t,e){for(var n=e.length,i=0;t.indexOf(e[i])<0&&++i<n;);return i<n},At=function(){var t,e,n=dt.length,i=dt.slice(0);for(pt={},dt.length=0,t=0;t<n;t++)(e=i[t])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},Ct=function(t,e,n,i){dt.length&&!v&&At(),t.render(e,n,i||v&&e<0&&(t._initted||t._startAt)),dt.length&&!v&&At()},Pt=function(t){var e=parseFloat(t);return(e||0===e)&&(t+"").match(Q).length<2?e:U(t)?t.trim():t},Rt=function(t){return t},Ot=function(t,e){for(var n in e)n in t||(t[n]=e[n]);return t},Dt=function(t,e){for(var n in e)t[n]=e[n];return t},Lt=function t(e,n){for(var i in n)"__proto__"!==i&&"constructor"!==i&&"prototype"!==i&&(e[i]=V(n[i])?t(e[i]||(e[i]={}),n[i]):n[i]);return e},It=function(t,e){var n,i={};for(n in t)n in e||(i[n]=t[n]);return i},zt=function(t){var e,n=t.parent||x,i=t.keyframes?(e=q(t.keyframes),function(t,n){for(var i in n)i in t||"duration"===i&&e||"ease"===i||(t[i]=n[i])}):Ot;if(j(t.inherit))for(;n;)i(t,n.vars.defaults),n=n.parent||n._dp;return t},Nt=function(t,e,n,i,r){void 0===n&&(n="_first"),void 0===i&&(i="_last");var s,a=t[i];if(r)for(s=e[r];a&&a[r]>s;)a=a._prev;return a?(e._next=a._next,a._next=e):(e._next=t[n],t[n]=e),e._next?e._next._prev=e:t[i]=e,e._prev=a,e.parent=e._dp=t,e},Ut=function(t,e,n,i){void 0===n&&(n="_first"),void 0===i&&(i="_last");var r=e._prev,s=e._next;r?r._next=s:t[n]===e&&(t[n]=s),s?s._prev=r:t[i]===e&&(t[i]=r),e._next=e._prev=e.parent=null},kt=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove&&t.parent.remove(t),t._act=0},Bt=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var n=t;n;)n._dirty=1,n=n.parent;return t},Ft=function(t,e,n,i){return t._startAt&&(v?t._startAt.revert(ct):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,i))},Vt=function t(e){return!e||e._ts&&t(e.parent)},jt=function(t){return t._repeat?Ht(t._tTime,t=t.duration()+t._rDelay)*t:0},Ht=function(t,e){var n=Math.floor(t/=e);return t&&n===t?n-1:n},Gt=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},Wt=function(t){return t._end=Mt(t._start+(t._tDur/Math.abs(t._ts||t._rts||R)||0))},qt=function(t,e){var n=t._dp;return n&&n.smoothChildTiming&&t._ts&&(t._start=Mt(n._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),Wt(t),n._dirty||Bt(n,t)),t},Xt=function(t,e){var n;if((e._time||!e._dur&&e._initted||e._start<t._time&&(e._dur||!e.add))&&(n=Gt(t.rawTime(),e),(!e._dur||se(0,e.totalDuration(),n)-e._tTime>R)&&e.render(n,!0)),Bt(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(n=t;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;t._zTime=-1e-8}},$t=function(t,e,n,i){return e.parent&&kt(e),e._start=Mt((B(n)?n:n||t!==x?ne(t,n,e):t._time)+e._delay),e._end=Mt(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),Nt(t,e,"_first","_last",t._sort?"_start":0),Jt(e)||(t._recent=e),i||Xt(t,e),t._ts<0&&qt(t,t._tTime),t},Yt=function(t,e){return(et.ScrollTrigger||rt("scrollTrigger",e))&&et.ScrollTrigger.create(e,t)},Zt=function(t,e,n,i,r){return en(t,e,r),t._initted?!n&&t._pt&&!v&&(t._dur&&!1!==t.vars.lazy||!t._dur&&t.vars.lazy)&&M!==Ie.frame?(dt.push(t),t._lazy=[r,i],1):void 0:1},Kt=function t(e){var n=e.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||t(n))},Jt=function(t){var e=t.data;return"isFromStart"===e||"isStart"===e},Qt=function(t,e,n,i){var r=t._repeat,s=Mt(e)||0,a=t._tTime/t._tDur;return a&&!i&&(t._time*=s/t._dur),t._dur=s,t._tDur=r?r<0?1e10:Mt(s*(r+1)+t._rDelay*r):s,a>0&&!i&&qt(t,t._tTime=t._tDur*a),t.parent&&Wt(t),n||Bt(t.parent,t),t},te=function(t){return t instanceof Ye?Bt(t):Qt(t,t._dur)},ee={_start:0,endTime:ot,totalDuration:ot},ne=function t(e,n,i){var r,s,a,o=e.labels,l=e._recent||ee,c=e.duration()>=P?l.endTime(!1):e._dur;return U(n)&&(isNaN(n)||n in o)?(s=n.charAt(0),a="%"===n.substr(-1),r=n.indexOf("="),"<"===s||">"===s?(r>=0&&(n=n.replace(/=/,"")),("<"===s?l._start:l.endTime(l._repeat>=0))+(parseFloat(n.substr(1))||0)*(a?(r<0?l:i).totalDuration()/100:1)):r<0?(n in o||(o[n]=c),o[n]):(s=parseFloat(n.charAt(r-1)+n.substr(r+1)),a&&i&&(s=s/100*(q(i)?i[0]:i).totalDuration()),r>1?t(e,n.substr(0,r-1),i)+s:c+s)):null==n?c:+n},ie=function(t,e,n){var i,r,s=B(e[1]),a=(s?2:1)+(t<2?0:1),o=e[a];if(s&&(o.duration=e[1]),o.parent=n,t){for(i=o,r=n;r&&!("immediateRender"in i);)i=r.vars.defaults||{},r=j(r.vars.inherit)&&r.parent;o.immediateRender=j(i.immediateRender),t<2?o.runBackwards=1:o.startAt=e[a-1]}return new on(e[0],o,e[a+1])},re=function(t,e){return t||0===t?e(t):e},se=function(t,e,n){return n<t?t:n>e?e:n},ae=function(t,e){return U(t)&&(e=tt.exec(t))?e[1]:""},oe=[].slice,le=function(t,e){return t&&V(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&V(t[0]))&&!t.nodeType&&t!==b},ce=function(t,e,n){return void 0===n&&(n=[]),t.forEach((function(t){var i;return U(t)&&!e||le(t,1)?(i=n).push.apply(i,he(t)):n.push(t)}))||n},he=function(t,e,n){return y&&!e&&y.selector?y.selector(t):!U(t)||n||!_&&ze()?q(t)?ce(t,n):le(t)?oe.call(t,0):t?[t]:[]:oe.call((e||w).querySelectorAll(t),0)},ue=function(t){return t=he(t)[0]||st("Invalid scope")||{},function(e){var n=t.current||t.nativeElement||t;return he(e,n.querySelectorAll?n:n===t?st("Invalid scope")||w.createElement("div"):t)}},de=function(t){return t.sort((function(){return.5-Math.random()}))},pe=function(t){if(k(t))return t;var e=V(t)?t:{each:t},n=je(e.ease),i=e.from||0,r=parseFloat(e.base)||0,s={},a=i>0&&i<1,o=isNaN(i)||a,l=e.axis,c=i,h=i;return U(i)?c=h={center:.5,edges:.5,end:1}[i]||0:!a&&o&&(c=i[0],h=i[1]),function(t,a,u){var d,p,f,m,g,v,y,x,b,_=(u||e).length,w=s[_];if(!w){if(!(b="auto"===e.grid?0:(e.grid||[1,P])[1])){for(y=-P;y<(y=u[b++].getBoundingClientRect().left)&&b<_;);b<_&&b--}for(w=s[_]=[],d=o?Math.min(b,_)*c-.5:i%b,p=b===P?0:o?_*h/b-.5:i/b|0,y=0,x=P,v=0;v<_;v++)f=v%b-d,m=p-(v/b|0),w[v]=g=l?Math.abs("y"===l?m:f):I(f*f+m*m),g>y&&(y=g),g<x&&(x=g);"random"===i&&de(w),w.max=y-x,w.min=x,w.v=_=(parseFloat(e.amount)||parseFloat(e.each)*(b>_?_-1:l?"y"===l?_/b:b:Math.max(b,_/b))||0)*("edges"===i?-1:1),w.b=_<0?r-_:r,w.u=ae(e.amount||e.each)||0,n=n&&_<0?Fe(n):n}return _=(w[t]-w.min)/w.max||0,Mt(w.b+(n?n(_):_)*w.v)+w.u}},fe=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(n){var i=Mt(Math.round(parseFloat(n)/t)*t*e);return(i-i%1)/e+(B(n)?0:ae(n))}},me=function(t,e){var n,i,r=q(t);return!r&&V(t)&&(n=r=t.radius||P,t.values?(t=he(t.values),(i=!B(t[0]))&&(n*=n)):t=fe(t.increment)),re(e,r?k(t)?function(e){return i=t(e),Math.abs(i-e)<=n?i:e}:function(e){for(var r,s,a=parseFloat(i?e.x:e),o=parseFloat(i?e.y:0),l=P,c=0,h=t.length;h--;)(r=i?(r=t[h].x-a)*r+(s=t[h].y-o)*s:Math.abs(t[h]-a))<l&&(l=r,c=h);return c=!n||l<=n?t[c]:e,i||c===e||B(e)?c:c+ae(e)}:fe(t))},ge=function(t,e,n,i){return re(q(t)?!e:!0===n?!!(n=0):!i,(function(){return q(t)?t[~~(Math.random()*t.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((t-n/2+Math.random()*(e-t+.99*n))/n)*n*i)/i}))},ve=function(t,e,n){return re(n,(function(n){return t[~~e(n)]}))},ye=function(t){for(var e,n,i,r,s=0,a="";~(e=t.indexOf("random(",s));)i=t.indexOf(")",e),r="["===t.charAt(e+7),n=t.substr(e+7,i-e-7).match(r?Q:X),a+=t.substr(s,e-s)+ge(r?n:+n[0],r?0:+n[1],+n[2]||1e-5),s=i+1;return a+t.substr(s,t.length-s)},xe=function(t,e,n,i,r){var s=e-t,a=i-n;return re(r,(function(e){return n+((e-t)/s*a||0)}))},be=function(t,e,n){var i,r,s,a=t.labels,o=P;for(i in a)(r=a[i]-e)<0==!!n&&r&&o>(r=Math.abs(r))&&(s=i,o=r);return s},_e=function(t,e,n){var i,r,s,a=t.vars,o=a[e],l=y,c=t._ctx;if(o)return i=a[e+"Params"],r=a.callbackScope||t,n&&dt.length&&At(),c&&(y=c),s=i?o.apply(r,i):o.call(r),y=l,s},we=function(t){return kt(t),t.scrollTrigger&&t.scrollTrigger.kill(!!v),t.progress()<1&&_e(t,"onInterrupt"),t},Se=[],Me=function(t){if(t)if(t=!t.name&&t.default||t,H()||t.headless){var e=t.name,n=k(t),i=e&&!n&&t.init?function(){this._props=[]}:t,r={init:ot,render:gn,add:Qe,kill:yn,modifier:vn,rawVars:0},s={targetTest:0,get:0,getSetter:dn,aliases:{},register:0};if(ze(),t!==i){if(ft[e])return;Ot(i,Ot(It(t,r),s)),Dt(i.prototype,Dt(r,It(t,s))),ft[i.prop=e]=i,t.targetTest&&(vt.push(i),ut[e]=1),e=("css"===e?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}at(e,i),t.register&&t.register(In,i,_n)}else Se.push(t)},Te=255,Ee={aqua:[0,Te,Te],lime:[0,Te,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Te],navy:[0,0,128],white:[Te,Te,Te],olive:[128,128,0],yellow:[Te,Te,0],orange:[Te,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Te,0,0],pink:[Te,192,203],cyan:[0,Te,Te],transparent:[Te,Te,Te,0]},Ae=function(t,e,n){return(6*(t+=t<0?1:t>1?-1:0)<1?e+(n-e)*t*6:t<.5?n:3*t<2?e+(n-e)*(2/3-t)*6:e)*Te+.5|0},Ce=function(t,e,n){var i,r,s,a,o,l,c,h,u,d,p=t?B(t)?[t>>16,t>>8&Te,t&Te]:0:Ee.black;if(!p){if(","===t.substr(-1)&&(t=t.substr(0,t.length-1)),Ee[t])p=Ee[t];else if("#"===t.charAt(0)){if(t.length<6&&(i=t.charAt(1),r=t.charAt(2),s=t.charAt(3),t="#"+i+i+r+r+s+s+(5===t.length?t.charAt(4)+t.charAt(4):"")),9===t.length)return[(p=parseInt(t.substr(1,6),16))>>16,p>>8&Te,p&Te,parseInt(t.substr(7),16)/255];p=[(t=parseInt(t.substr(1),16))>>16,t>>8&Te,t&Te]}else if("hsl"===t.substr(0,3))if(p=d=t.match(X),e){if(~t.indexOf("="))return p=t.match(Y),n&&p.length<4&&(p[3]=1),p}else a=+p[0]%360/360,o=+p[1]/100,i=2*(l=+p[2]/100)-(r=l<=.5?l*(o+1):l+o-l*o),p.length>3&&(p[3]*=1),p[0]=Ae(a+1/3,i,r),p[1]=Ae(a,i,r),p[2]=Ae(a-1/3,i,r);else p=t.match(X)||Ee.transparent;p=p.map(Number)}return e&&!d&&(i=p[0]/Te,r=p[1]/Te,s=p[2]/Te,l=((c=Math.max(i,r,s))+(h=Math.min(i,r,s)))/2,c===h?a=o=0:(u=c-h,o=l>.5?u/(2-c-h):u/(c+h),a=c===i?(r-s)/u+(r<s?6:0):c===r?(s-i)/u+2:(i-r)/u+4,a*=60),p[0]=~~(a+.5),p[1]=~~(100*o+.5),p[2]=~~(100*l+.5)),n&&p.length<4&&(p[3]=1),p},Pe=function(t){var e=[],n=[],i=-1;return t.split(Oe).forEach((function(t){var r=t.match(Z)||[];e.push.apply(e,r),n.push(i+=r.length+1)})),e.c=n,e},Re=function(t,e,n){var i,r,s,a,o="",l=(t+o).match(Oe),c=e?"hsla(":"rgba(",h=0;if(!l)return t;if(l=l.map((function(t){return(t=Ce(t,e,1))&&c+(e?t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]:t.join(","))+")"})),n&&(s=Pe(t),(i=n.c).join(o)!==s.c.join(o)))for(a=(r=t.replace(Oe,"1").split(Z)).length-1;h<a;h++)o+=r[h]+(~i.indexOf(h)?l.shift()||c+"0,0,0,0)":(s.length?s:l.length?l:n).shift());if(!r)for(a=(r=t.split(Oe)).length-1;h<a;h++)o+=r[h]+l[h];return o+r[a]},Oe=function(){var t,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(t in Ee)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),De=/hsl[a]?\(/,Le=function(t){var e,n=t.join(" ");if(Oe.lastIndex=0,Oe.test(n))return e=De.test(n),t[1]=Re(t[1],e),t[0]=Re(t[0],e,Pe(t[1])),!0},Ie=function(){var t,e,n,i,r,s,a=Date.now,o=500,l=33,c=a(),h=c,u=1e3/240,d=u,p=[],f=function n(f){var m,g,v,y,x=a()-h,b=!0===f;if((x>o||x<0)&&(c+=x-l),((m=(v=(h+=x)-c)-d)>0||b)&&(y=++i.frame,r=v-1e3*i.time,i.time=v/=1e3,d+=m+(m>=u?4:u-m),g=1),b||(t=e(n)),g)for(s=0;s<p.length;s++)p[s](v,r,y,f)};return i={time:0,frame:0,tick:function(){f(!0)},deltaRatio:function(t){return r/(1e3/(t||60))},wake:function(){S&&(!_&&H()&&(b=_=window,w=b.document||{},et.gsap=In,(b.gsapVersions||(b.gsapVersions=[])).push(In.version),it(nt||b.GreenSockGlobals||!b.gsap&&b||{}),Se.forEach(Me)),n="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame,t&&i.sleep(),e=n||function(t){return setTimeout(t,d-1e3*i.time+1|0)},E=1,f(2))},sleep:function(){(n?cancelAnimationFrame:clearTimeout)(t),E=0,e=ot},lagSmoothing:function(t,e){o=t||1/0,l=Math.min(e||33,o)},fps:function(t){u=1e3/(t||240),d=1e3*i.time+u},add:function(t,e,n){var r=e?function(e,n,s,a){t(e,n,s,a),i.remove(r)}:t;return i.remove(t),p[n?"unshift":"push"](r),ze(),r},remove:function(t,e){~(e=p.indexOf(t))&&p.splice(e,1)&&s>=e&&s--},_listeners:p},i}(),ze=function(){return!E&&Ie.wake()},Ne={},Ue=/^[\d.\-M][\d.\-,\s]/,ke=/["']/g,Be=function(t){for(var e,n,i,r={},s=t.substr(1,t.length-3).split(":"),a=s[0],o=1,l=s.length;o<l;o++)n=s[o],e=o!==l-1?n.lastIndexOf(","):n.length,i=n.substr(0,e),r[a]=isNaN(i)?i.replace(ke,"").trim():+i,a=n.substr(e+1).trim();return r},Fe=function(t){return function(e){return 1-t(1-e)}},Ve=function t(e,n){for(var i,r=e._first;r;)r instanceof Ye?t(r,n):!r.vars.yoyoEase||r._yoyo&&r._repeat||r._yoyo===n||(r.timeline?t(r.timeline,n):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=n)),r=r._next},je=function(t,e){return t&&(k(t)?t:Ne[t]||function(t){var e,n,i,r,s=(t+"").split("("),a=Ne[s[0]];return a&&s.length>1&&a.config?a.config.apply(null,~t.indexOf("{")?[Be(s[1])]:(e=t,n=e.indexOf("(")+1,i=e.indexOf(")"),r=e.indexOf("(",n),e.substring(n,~r&&r<i?e.indexOf(")",i+1):i)).split(",").map(Pt)):Ne._CE&&Ue.test(t)?Ne._CE("",t):a}(t))||e},He=function(t,e,n,i){void 0===n&&(n=function(t){return 1-e(1-t)}),void 0===i&&(i=function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2});var r,s={easeIn:e,easeOut:n,easeInOut:i};return wt(t,(function(t){for(var e in Ne[t]=et[t]=s,Ne[r=t.toLowerCase()]=n,s)Ne[r+("easeIn"===e?".in":"easeOut"===e?".out":".inOut")]=Ne[t+"."+e]=s[e]})),s},Ge=function(t){return function(e){return e<.5?(1-t(1-2*e))/2:.5+t(2*(e-.5))/2}},We=function t(e,n,i){var r=n>=1?n:1,s=(i||(e?.3:.45))/(n<1?n:1),a=s/O*(Math.asin(1/r)||0),o=function(t){return 1===t?1:r*Math.pow(2,-10*t)*N((t-a)*s)+1},l="out"===e?o:"in"===e?function(t){return 1-o(1-t)}:Ge(o);return s=O/s,l.config=function(n,i){return t(e,n,i)},l},qe=function t(e,n){void 0===n&&(n=1.70158);var i=function(t){return t?--t*t*((n+1)*t+n)+1:0},r="out"===e?i:"in"===e?function(t){return 1-i(1-t)}:Ge(i);return r.config=function(n){return t(e,n)},r};wt("Linear,Quad,Cubic,Quart,Quint,Strong",(function(t,e){var n=e<5?e+1:e;He(t+",Power"+(n-1),e?function(t){return Math.pow(t,n)}:function(t){return t},(function(t){return 1-Math.pow(1-t,n)}),(function(t){return t<.5?Math.pow(2*t,n)/2:1-Math.pow(2*(1-t),n)/2}))})),Ne.Linear.easeNone=Ne.none=Ne.Linear.easeIn,He("Elastic",We("in"),We("out"),We()),function(t,e){var n=1/e,i=2*n,r=2.5*n,s=function(s){return s<n?t*s*s:s<i?t*Math.pow(s-1.5/e,2)+.75:s<r?t*(s-=2.25/e)*s+.9375:t*Math.pow(s-2.625/e,2)+.984375};He("Bounce",(function(t){return 1-s(1-t)}),s)}(7.5625,2.75),He("Expo",(function(t){return t?Math.pow(2,10*(t-1)):0})),He("Circ",(function(t){return-(I(1-t*t)-1)})),He("Sine",(function(t){return 1===t?1:1-z(t*D)})),He("Back",qe("in"),qe("out"),qe()),Ne.SteppedEase=Ne.steps=et.SteppedEase={config:function(t,e){void 0===t&&(t=1);var n=1/t,i=t+(e?0:1),r=e?1:0;return function(t){return((i*se(0,.99999999,t)|0)+r)*n}}},C.ease=Ne["quad.out"],wt("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(t){return yt+=t+","+t+"Params,"}));var Xe=function(t,e){this.id=L++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:_t,this.set=e?e.getSetter:dn},$e=function(){function t(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Qt(this,+t.duration,1,1),this.data=t.data,y&&(this._ctx=y,y.data.push(this)),E||Ie.wake()}var e=t.prototype;return e.delay=function(t){return t||0===t?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,Qt(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,e){if(ze(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(qt(this,t),!n._dp||n.parent||Xt(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&$t(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!e||this._initted&&Math.abs(this._zTime)===R||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),Ct(this,t,e)),this},e.time=function(t,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+jt(this))%(this._dur+this._rDelay)||(t?this._dur:0),e):this._time},e.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+jt(this),e):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(t,e){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*n,e):this._repeat?Ht(this._tTime,n)+1:1},e.timeScale=function(t,e){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===t)return this;var n=this.parent&&this._ts?Gt(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||-1e-8===t?0:this._rts,this.totalTime(se(-Math.abs(this._delay),this._tDur,n),!1!==e),Wt(this),function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t}(this)},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(ze(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==R&&(this._tTime-=R)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var e=this.parent||this._dp;return e&&(e._sort||!this.parent)&&$t(e,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(j(t)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(t){var e=this.parent||this._dp;return e?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Gt(e.rawTime(t),this):this._tTime:this._tTime},e.revert=function(t){void 0===t&&(t=ht);var e=v;return v=t,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(t),this.totalTime(-.01,t.suppressEvents)),"nested"!==this.data&&!1!==t.kill&&this.kill(),v=e,this},e.globalTime=function(t){for(var e=this,n=arguments.length?t:e.rawTime();e;)n=e._start+n/(Math.abs(e._ts)||1),e=e._dp;return!this.parent&&this._sat?this._sat.globalTime(t):n},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,te(this)):-2===this._repeat?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var e=this._time;return this._rDelay=t,te(this),e?this.time(e):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,e){return this.totalTime(ne(this,t),j(e))},e.restart=function(t,e){return this.play().totalTime(t?-this._delay:0,j(e))},e.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},e.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},e.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var t,e=this.parent||this._dp,n=this._start;return!(e&&!(this._ts&&this._initted&&e.isActive()&&(t=e.rawTime(!0))>=n&&t<this.endTime(!0)-R))},e.eventCallback=function(t,e,n){var i=this.vars;return arguments.length>1?(e?(i[t]=e,n&&(i[t+"Params"]=n),"onUpdate"===t&&(this._onUpdate=e)):delete i[t],this):i[t]},e.then=function(t){var e=this;return new Promise((function(n){var i=k(t)?t:Rt,r=function(){var t=e.then;e.then=null,k(i)&&(i=i(e))&&(i.then||i===e)&&(e.then=t),n(i),e.then=t};e._initted&&1===e.totalProgress()&&e._ts>=0||!e._tTime&&e._ts<0?r():e._prom=r}))},e.kill=function(){we(this)},t}();Ot($e.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var Ye=function(t){function e(e,n){var i;return void 0===e&&(e={}),(i=t.call(this,e)||this).labels={},i.smoothChildTiming=!!e.smoothChildTiming,i.autoRemoveChildren=!!e.autoRemoveChildren,i._sort=j(e.sortChildren),x&&$t(e.parent||x,f(i),n),e.reversed&&i.reverse(),e.paused&&i.paused(!0),e.scrollTrigger&&Yt(f(i),e.scrollTrigger),i}m(e,t);var n=e.prototype;return n.to=function(t,e,n){return ie(0,arguments,this),this},n.from=function(t,e,n){return ie(1,arguments,this),this},n.fromTo=function(t,e,n,i){return ie(2,arguments,this),this},n.set=function(t,e,n){return e.duration=0,e.parent=this,zt(e).repeatDelay||(e.repeat=0),e.immediateRender=!!e.immediateRender,new on(t,e,ne(this,n),1),this},n.call=function(t,e,n){return $t(this,on.delayedCall(0,t,e),n)},n.staggerTo=function(t,e,n,i,r,s,a){return n.duration=e,n.stagger=n.stagger||i,n.onComplete=s,n.onCompleteParams=a,n.parent=this,new on(t,n,ne(this,r)),this},n.staggerFrom=function(t,e,n,i,r,s,a){return n.runBackwards=1,zt(n).immediateRender=j(n.immediateRender),this.staggerTo(t,e,n,i,r,s,a)},n.staggerFromTo=function(t,e,n,i,r,s,a,o){return i.startAt=n,zt(i).immediateRender=j(i.immediateRender),this.staggerTo(t,e,i,r,s,a,o)},n.render=function(t,e,n){var i,r,s,a,o,l,c,h,u,d,p,f,m=this._time,g=this._dirty?this.totalDuration():this._tDur,y=this._dur,b=t<=0?0:Mt(t),_=this._zTime<0!=t<0&&(this._initted||!y);if(this!==x&&b>g&&t>=0&&(b=g),b!==this._tTime||n||_){if(m!==this._time&&y&&(b+=this._time-m,t+=this._time-m),i=b,u=this._start,l=!(h=this._ts),_&&(y||(m=this._zTime),(t||!e)&&(this._zTime=t)),this._repeat){if(p=this._yoyo,o=y+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*o+t,e,n);if(i=Mt(b%o),b===g?(a=this._repeat,i=y):((a=~~(b/o))&&a===b/o&&(i=y,a--),i>y&&(i=y)),d=Ht(this._tTime,o),!m&&this._tTime&&d!==a&&this._tTime-d*o-this._dur<=0&&(d=a),p&&1&a&&(i=y-i,f=1),a!==d&&!this._lock){var w=p&&1&d,S=w===(p&&1&a);if(a<d&&(w=!w),m=w?0:b%y?y:b,this._lock=1,this.render(m||(f?0:Mt(a*o)),e,!y)._lock=0,this._tTime=b,!e&&this.parent&&_e(this,"onRepeat"),this.vars.repeatRefresh&&!f&&(this.invalidate()._lock=1),m&&m!==this._time||l!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(y=this._dur,g=this._tDur,S&&(this._lock=2,m=w?y:-1e-4,this.render(m,!0),this.vars.repeatRefresh&&!f&&this.invalidate()),this._lock=0,!this._ts&&!l)return this;Ve(this,f)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(c=function(t,e,n){var i;if(n>e)for(i=t._first;i&&i._start<=n;){if("isPause"===i.data&&i._start>e)return i;i=i._next}else for(i=t._last;i&&i._start>=n;){if("isPause"===i.data&&i._start<e)return i;i=i._prev}}(this,Mt(m),Mt(i)),c&&(b-=i-(i=c._start))),this._tTime=b,this._time=i,this._act=!h,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=t,m=0),!m&&i&&!e&&!a&&(_e(this,"onStart"),this._tTime!==b))return this;if(i>=m&&t>=0)for(r=this._first;r;){if(s=r._next,(r._act||i>=r._start)&&r._ts&&c!==r){if(r.parent!==this)return this.render(t,e,n);if(r.render(r._ts>0?(i-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(i-r._start)*r._ts,e,n),i!==this._time||!this._ts&&!l){c=0,s&&(b+=this._zTime=-1e-8);break}}r=s}else{r=this._last;for(var M=t<0?t:i;r;){if(s=r._prev,(r._act||M<=r._end)&&r._ts&&c!==r){if(r.parent!==this)return this.render(t,e,n);if(r.render(r._ts>0?(M-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(M-r._start)*r._ts,e,n||v&&(r._initted||r._startAt)),i!==this._time||!this._ts&&!l){c=0,s&&(b+=this._zTime=M?-1e-8:R);break}}r=s}}if(c&&!e&&(this.pause(),c.render(i>=m?0:-1e-8)._zTime=i>=m?1:-1,this._ts))return this._start=u,Wt(this),this.render(t,e,n);this._onUpdate&&!e&&_e(this,"onUpdate",!0),(b===g&&this._tTime>=this.totalDuration()||!b&&m)&&(u!==this._start&&Math.abs(h)===Math.abs(this._ts)||this._lock||((t||!y)&&(b===g&&this._ts>0||!b&&this._ts<0)&&kt(this,1),e||t<0&&!m||!b&&!m&&g||(_e(this,b===g&&t>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(b<g&&this.timeScale()>0)&&this._prom())))}return this},n.add=function(t,e){var n=this;if(B(e)||(e=ne(this,e,t)),!(t instanceof $e)){if(q(t))return t.forEach((function(t){return n.add(t,e)})),this;if(U(t))return this.addLabel(t,e);if(!k(t))return this;t=on.delayedCall(0,t)}return this!==t?$t(this,t,e):this},n.getChildren=function(t,e,n,i){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===n&&(n=!0),void 0===i&&(i=-P);for(var r=[],s=this._first;s;)s._start>=i&&(s instanceof on?e&&r.push(s):(n&&r.push(s),t&&r.push.apply(r,s.getChildren(!0,e,n)))),s=s._next;return r},n.getById=function(t){for(var e=this.getChildren(1,1,1),n=e.length;n--;)if(e[n].vars.id===t)return e[n]},n.remove=function(t){return U(t)?this.removeLabel(t):k(t)?this.killTweensOf(t):(Ut(this,t),t===this._recent&&(this._recent=this._last),Bt(this))},n.totalTime=function(e,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Mt(Ie.time-(this._ts>0?e/this._ts:(this.totalDuration()-e)/-this._ts))),t.prototype.totalTime.call(this,e,n),this._forcing=0,this):this._tTime},n.addLabel=function(t,e){return this.labels[t]=ne(this,e),this},n.removeLabel=function(t){return delete this.labels[t],this},n.addPause=function(t,e,n){var i=on.delayedCall(0,e||ot,n);return i.data="isPause",this._hasPause=1,$t(this,i,ne(this,t))},n.removePause=function(t){var e=this._first;for(t=ne(this,t);e;)e._start===t&&"isPause"===e.data&&kt(e),e=e._next},n.killTweensOf=function(t,e,n){for(var i=this.getTweensOf(t,n),r=i.length;r--;)Ze!==i[r]&&i[r].kill(t,e);return this},n.getTweensOf=function(t,e){for(var n,i=[],r=he(t),s=this._first,a=B(e);s;)s instanceof on?Et(s._targets,r)&&(a?(!Ze||s._initted&&s._ts)&&s.globalTime(0)<=e&&s.globalTime(s.totalDuration())>e:!e||s.isActive())&&i.push(s):(n=s.getTweensOf(r,e)).length&&i.push.apply(i,n),s=s._next;return i},n.tweenTo=function(t,e){e=e||{};var n,i=this,r=ne(i,t),s=e,a=s.startAt,o=s.onStart,l=s.onStartParams,c=s.immediateRender,h=on.to(i,Ot({ease:e.ease||"none",lazy:!1,immediateRender:!1,time:r,overwrite:"auto",duration:e.duration||Math.abs((r-(a&&"time"in a?a.time:i._time))/i.timeScale())||R,onStart:function(){if(i.pause(),!n){var t=e.duration||Math.abs((r-(a&&"time"in a?a.time:i._time))/i.timeScale());h._dur!==t&&Qt(h,t,0,1).render(h._time,!0,!0),n=1}o&&o.apply(h,l||[])}},e));return c?h.render(0):h},n.tweenFromTo=function(t,e,n){return this.tweenTo(e,Ot({startAt:{time:ne(this,t)}},n))},n.recent=function(){return this._recent},n.nextLabel=function(t){return void 0===t&&(t=this._time),be(this,ne(this,t))},n.previousLabel=function(t){return void 0===t&&(t=this._time),be(this,ne(this,t),1)},n.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.previousLabel(this._time+R)},n.shiftChildren=function(t,e,n){void 0===n&&(n=0);for(var i,r=this._first,s=this.labels;r;)r._start>=n&&(r._start+=t,r._end+=t),r=r._next;if(e)for(i in s)s[i]>=n&&(s[i]+=t);return Bt(this)},n.invalidate=function(e){var n=this._first;for(this._lock=0;n;)n.invalidate(e),n=n._next;return t.prototype.invalidate.call(this,e)},n.clear=function(t){void 0===t&&(t=!0);for(var e,n=this._first;n;)e=n._next,this.remove(n),n=e;return this._dp&&(this._time=this._tTime=this._pTime=0),t&&(this.labels={}),Bt(this)},n.totalDuration=function(t){var e,n,i,r=0,s=this,a=s._last,o=P;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-t:t));if(s._dirty){for(i=s.parent;a;)e=a._prev,a._dirty&&a.totalDuration(),(n=a._start)>o&&s._sort&&a._ts&&!s._lock?(s._lock=1,$t(s,a,n-a._delay,1)._lock=0):o=n,n<0&&a._ts&&(r-=n,(!i&&!s._dp||i&&i.smoothChildTiming)&&(s._start+=n/s._ts,s._time-=n,s._tTime-=n),s.shiftChildren(-n,!1,-Infinity),o=0),a._end>r&&a._ts&&(r=a._end),a=e;Qt(s,s===x&&s._time>r?s._time:r,1,1),s._dirty=0}return s._tDur},e.updateRoot=function(t){if(x._ts&&(Ct(x,Gt(t,x)),M=Ie.frame),Ie.frame>=gt){gt+=A.autoSleep||120;var e=x._first;if((!e||!e._ts)&&A.autoSleep&&Ie._listeners.length<2){for(;e&&!e._ts;)e=e._next;e||Ie.sleep()}}},e}($e);Ot(Ye.prototype,{_lock:0,_hasPause:0,_forcing:0});var Ze,Ke,Je=function(t,e,n,i,r,s,a){var o,l,c,h,u,d,p,f,m=new _n(this._pt,t,e,0,1,mn,null,r),g=0,v=0;for(m.b=n,m.e=i,n+="",(p=~(i+="").indexOf("random("))&&(i=ye(i)),s&&(s(f=[n,i],t,e),n=f[0],i=f[1]),l=n.match(K)||[];o=K.exec(i);)h=o[0],u=i.substring(g,o.index),c?c=(c+1)%5:"rgba("===u.substr(-5)&&(c=1),h!==l[v++]&&(d=parseFloat(l[v-1])||0,m._pt={_next:m._pt,p:u||1===v?u:",",s:d,c:"="===h.charAt(1)?Tt(d,h)-d:parseFloat(h)-d,m:c&&c<4?Math.round:0},g=K.lastIndex);return m.c=g<i.length?i.substring(g,i.length):"",m.fp=a,(J.test(i)||p)&&(m.e=0),this._pt=m,m},Qe=function(t,e,n,i,r,s,a,o,l,c){k(i)&&(i=i(r||0,t,s));var h,u=t[e],d="get"!==n?n:k(u)?l?t[e.indexOf("set")||!k(t["get"+e.substr(3)])?e:"get"+e.substr(3)](l):t[e]():u,p=k(u)?l?hn:cn:ln;if(U(i)&&(~i.indexOf("random(")&&(i=ye(i)),"="===i.charAt(1)&&((h=Tt(d,i)+(ae(d)||0))||0===h)&&(i=h)),!c||d!==i||Ke)return isNaN(d*i)||""===i?(!u&&!(e in t)&&rt(e,i),Je.call(this,t,e,d,i,p,o||A.stringFilter,l)):(h=new _n(this._pt,t,e,+d||0,i-(d||0),"boolean"==typeof u?fn:pn,0,p),l&&(h.fp=l),a&&h.modifier(a,this,t),this._pt=h)},tn=function(t,e,n,i,r,s){var a,o,l,c;if(ft[t]&&!1!==(a=new ft[t]).init(r,a.rawVars?e[t]:function(t,e,n,i,r){if(k(t)&&(t=rn(t,r,e,n,i)),!V(t)||t.style&&t.nodeType||q(t)||W(t))return U(t)?rn(t,r,e,n,i):t;var s,a={};for(s in t)a[s]=rn(t[s],r,e,n,i);return a}(e[t],i,r,s,n),n,i,s)&&(n._pt=o=new _n(n._pt,r,t,0,1,a.render,a,0,a.priority),n!==T))for(l=n._ptLookup[n._targets.indexOf(r)],c=a._props.length;c--;)l[a._props[c]]=o;return a},en=function t(e,n,i){var r,s,a,o,l,c,h,u,d,p,f,m,y,b=e.vars,_=b.ease,w=b.startAt,S=b.immediateRender,M=b.lazy,T=b.onUpdate,E=b.runBackwards,A=b.yoyoEase,O=b.keyframes,D=b.autoRevert,L=e._dur,I=e._startAt,z=e._targets,N=e.parent,U=N&&"nested"===N.data?N.vars.targets:z,k="auto"===e._overwrite&&!g,B=e.timeline;if(B&&(!O||!_)&&(_="none"),e._ease=je(_,C.ease),e._yEase=A?Fe(je(!0===A?_:A,C.ease)):0,A&&e._yoyo&&!e._repeat&&(A=e._yEase,e._yEase=e._ease,e._ease=A),e._from=!B&&!!b.runBackwards,!B||O&&!b.stagger){if(m=(u=z[0]?bt(z[0]).harness:0)&&b[u.prop],r=It(b,ut),I&&(I._zTime<0&&I.progress(1),n<0&&E&&S&&!D?I.render(-1,!0):I.revert(E&&L?ct:lt),I._lazy=0),w){if(kt(e._startAt=on.set(z,Ot({data:"isStart",overwrite:!1,parent:N,immediateRender:!0,lazy:!I&&j(M),startAt:null,delay:0,onUpdate:T&&function(){return _e(e,"onUpdate")},stagger:0},w))),e._startAt._dp=0,e._startAt._sat=e,n<0&&(v||!S&&!D)&&e._startAt.revert(ct),S&&L&&n<=0&&i<=0)return void(n&&(e._zTime=n))}else if(E&&L&&!I)if(n&&(S=!1),a=Ot({overwrite:!1,data:"isFromStart",lazy:S&&!I&&j(M),immediateRender:S,stagger:0,parent:N},r),m&&(a[u.prop]=m),kt(e._startAt=on.set(z,a)),e._startAt._dp=0,e._startAt._sat=e,n<0&&(v?e._startAt.revert(ct):e._startAt.render(-1,!0)),e._zTime=n,S){if(!n)return}else t(e._startAt,R,R);for(e._pt=e._ptCache=0,M=L&&j(M)||M&&!L,s=0;s<z.length;s++){if(h=(l=z[s])._gsap||xt(z)[s]._gsap,e._ptLookup[s]=p={},pt[h.id]&&dt.length&&At(),f=U===z?s:U.indexOf(l),u&&!1!==(d=new u).init(l,m||r,e,f,U)&&(e._pt=o=new _n(e._pt,l,d.name,0,1,d.render,d,0,d.priority),d._props.forEach((function(t){p[t]=o})),d.priority&&(c=1)),!u||m)for(a in r)ft[a]&&(d=tn(a,r,e,f,l,U))?d.priority&&(c=1):p[a]=o=Qe.call(e,l,a,"get",r[a],f,U,0,b.stringFilter);e._op&&e._op[s]&&e.kill(l,e._op[s]),k&&e._pt&&(Ze=e,x.killTweensOf(l,p,e.globalTime(n)),y=!e.parent,Ze=0),e._pt&&M&&(pt[h.id]=1)}c&&bn(e),e._onInit&&e._onInit(e)}e._onUpdate=T,e._initted=(!e._op||e._pt)&&!y,O&&n<=0&&B.render(P,!0,!0)},nn=function(t,e,n,i){var r,s,a=e.ease||i||"power1.inOut";if(q(e))s=n[t]||(n[t]=[]),e.forEach((function(t,n){return s.push({t:n/(e.length-1)*100,v:t,e:a})}));else for(r in e)s=n[r]||(n[r]=[]),"ease"===r||s.push({t:parseFloat(t),v:e[r],e:a})},rn=function(t,e,n,i,r){return k(t)?t.call(e,n,i,r):U(t)&&~t.indexOf("random(")?ye(t):t},sn=yt+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",an={};wt(sn+",id,stagger,delay,duration,paused,scrollTrigger",(function(t){return an[t]=1}));var on=function(t){function e(e,n,i,r){var s;"number"==typeof n&&(i.duration=n,n=i,i=null);var a,o,l,c,h,u,d,p,m=(s=t.call(this,r?n:zt(n))||this).vars,v=m.duration,y=m.delay,b=m.immediateRender,_=m.stagger,w=m.overwrite,S=m.keyframes,M=m.defaults,T=m.scrollTrigger,E=m.yoyoEase,C=n.parent||x,P=(q(e)||W(e)?B(e[0]):"length"in n)?[e]:he(e);if(s._targets=P.length?xt(P):st("GSAP target "+e+" not found. https://gsap.com",!A.nullTargetWarn)||[],s._ptLookup=[],s._overwrite=w,S||_||G(v)||G(y)){if(n=s.vars,(a=s.timeline=new Ye({data:"nested",defaults:M||{},targets:C&&"nested"===C.data?C.vars.targets:P})).kill(),a.parent=a._dp=f(s),a._start=0,_||G(v)||G(y)){if(c=P.length,d=_&&pe(_),V(_))for(h in _)~sn.indexOf(h)&&(p||(p={}),p[h]=_[h]);for(o=0;o<c;o++)(l=It(n,an)).stagger=0,E&&(l.yoyoEase=E),p&&Dt(l,p),u=P[o],l.duration=+rn(v,f(s),o,u,P),l.delay=(+rn(y,f(s),o,u,P)||0)-s._delay,!_&&1===c&&l.delay&&(s._delay=y=l.delay,s._start+=y,l.delay=0),a.to(u,l,d?d(o,u,P):0),a._ease=Ne.none;a.duration()?v=y=0:s.timeline=0}else if(S){zt(Ot(a.vars.defaults,{ease:"none"})),a._ease=je(S.ease||n.ease||"none");var R,O,D,L=0;if(q(S))S.forEach((function(t){return a.to(P,t,">")})),a.duration();else{for(h in l={},S)"ease"===h||"easeEach"===h||nn(h,S[h],l,S.easeEach);for(h in l)for(R=l[h].sort((function(t,e){return t.t-e.t})),L=0,o=0;o<R.length;o++)(D={ease:(O=R[o]).e,duration:(O.t-(o?R[o-1].t:0))/100*v})[h]=O.v,a.to(P,D,L),L+=D.duration;a.duration()<v&&a.to({},{duration:v-a.duration()})}}v||s.duration(v=a.duration())}else s.timeline=0;return!0!==w||g||(Ze=f(s),x.killTweensOf(P),Ze=0),$t(C,f(s),i),n.reversed&&s.reverse(),n.paused&&s.paused(!0),(b||!v&&!S&&s._start===Mt(C._time)&&j(b)&&Vt(f(s))&&"nested"!==C.data)&&(s._tTime=-1e-8,s.render(Math.max(0,-y)||0)),T&&Yt(f(s),T),s}m(e,t);var n=e.prototype;return n.render=function(t,e,n){var i,r,s,a,o,l,c,h,u,d=this._time,p=this._tDur,f=this._dur,m=t<0,g=t>p-R&&!m?p:t<R?0:t;if(f){if(g!==this._tTime||!t||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==m){if(i=g,h=this.timeline,this._repeat){if(a=f+this._rDelay,this._repeat<-1&&m)return this.totalTime(100*a+t,e,n);if(i=Mt(g%a),g===p?(s=this._repeat,i=f):((s=~~(g/a))&&s===Mt(g/a)&&(i=f,s--),i>f&&(i=f)),(l=this._yoyo&&1&s)&&(u=this._yEase,i=f-i),o=Ht(this._tTime,a),i===d&&!n&&this._initted&&s===o)return this._tTime=g,this;s!==o&&(h&&this._yEase&&Ve(h,l),this.vars.repeatRefresh&&!l&&!this._lock&&this._time!==a&&this._initted&&(this._lock=n=1,this.render(Mt(a*s),!0).invalidate()._lock=0))}if(!this._initted){if(Zt(this,m?t:i,n,e,g))return this._tTime=0,this;if(!(d===this._time||n&&this.vars.repeatRefresh&&s!==o))return this;if(f!==this._dur)return this.render(t,e,n)}if(this._tTime=g,this._time=i,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=c=(u||this._ease)(i/f),this._from&&(this.ratio=c=1-c),i&&!d&&!e&&!s&&(_e(this,"onStart"),this._tTime!==g))return this;for(r=this._pt;r;)r.r(c,r.d),r=r._next;h&&h.render(t<0?t:h._dur*h._ease(i/this._dur),e,n)||this._startAt&&(this._zTime=t),this._onUpdate&&!e&&(m&&Ft(this,t,0,n),_e(this,"onUpdate")),this._repeat&&s!==o&&this.vars.onRepeat&&!e&&this.parent&&_e(this,"onRepeat"),g!==this._tDur&&g||this._tTime!==g||(m&&!this._onUpdate&&Ft(this,t,0,!0),(t||!f)&&(g===this._tDur&&this._ts>0||!g&&this._ts<0)&&kt(this,1),e||m&&!d||!(g||d||l)||(_e(this,g===p?"onComplete":"onReverseComplete",!0),this._prom&&!(g<p&&this.timeScale()>0)&&this._prom()))}}else!function(t,e,n,i){var r,s,a,o=t.ratio,l=e<0||!e&&(!t._start&&Kt(t)&&(t._initted||!Jt(t))||(t._ts<0||t._dp._ts<0)&&!Jt(t))?0:1,c=t._rDelay,h=0;if(c&&t._repeat&&(h=se(0,t._tDur,e),s=Ht(h,c),t._yoyo&&1&s&&(l=1-l),s!==Ht(t._tTime,c)&&(o=1-l,t.vars.repeatRefresh&&t._initted&&t.invalidate())),l!==o||v||i||t._zTime===R||!e&&t._zTime){if(!t._initted&&Zt(t,e,i,n,h))return;for(a=t._zTime,t._zTime=e||(n?R:0),n||(n=e&&!a),t.ratio=l,t._from&&(l=1-l),t._time=0,t._tTime=h,r=t._pt;r;)r.r(l,r.d),r=r._next;e<0&&Ft(t,e,0,!0),t._onUpdate&&!n&&_e(t,"onUpdate"),h&&t._repeat&&!n&&t.parent&&_e(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===l&&(l&&kt(t,1),n||v||(_e(t,l?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)}(this,t,e,n);return this},n.targets=function(){return this._targets},n.invalidate=function(e){return(!e||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(e),t.prototype.invalidate.call(this,e)},n.resetTo=function(t,e,n,i,r){E||Ie.wake(),this._ts||this.play();var s=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||en(this,s),function(t,e,n,i,r,s,a,o){var l,c,h,u,d=(t._pt&&t._ptCache||(t._ptCache={}))[e];if(!d)for(d=t._ptCache[e]=[],h=t._ptLookup,u=t._targets.length;u--;){if((l=h[u][e])&&l.d&&l.d._pt)for(l=l.d._pt;l&&l.p!==e&&l.fp!==e;)l=l._next;if(!l)return Ke=1,t.vars[e]="+=0",en(t,a),Ke=0,o?st(e+" not eligible for reset"):1;d.push(l)}for(u=d.length;u--;)(l=(c=d[u])._pt||c).s=!i&&0!==i||r?l.s+(i||0)+s*l.c:i,l.c=n-l.s,c.e&&(c.e=St(n)+ae(c.e)),c.b&&(c.b=l.s+ae(c.b))}(this,t,e,n,i,this._ease(s/this._dur),s,r)?this.resetTo(t,e,n,i,1):(qt(this,0),this.parent||Nt(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},n.kill=function(t,e){if(void 0===e&&(e="all"),!(t||e&&"all"!==e))return this._lazy=this._pt=0,this.parent?we(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(t,e,Ze&&!0!==Ze.vars.overwrite)._first||we(this),this.parent&&n!==this.timeline.totalDuration()&&Qt(this,this._dur*this.timeline._tDur/n,0,1),this}var i,r,s,a,o,l,c,h=this._targets,u=t?he(t):h,d=this._ptLookup,p=this._pt;if((!e||"all"===e)&&function(t,e){for(var n=t.length,i=n===e.length;i&&n--&&t[n]===e[n];);return n<0}(h,u))return"all"===e&&(this._pt=0),we(this);for(i=this._op=this._op||[],"all"!==e&&(U(e)&&(o={},wt(e,(function(t){return o[t]=1})),e=o),e=function(t,e){var n,i,r,s,a=t[0]?bt(t[0]).harness:0,o=a&&a.aliases;if(!o)return e;for(i in n=Dt({},e),o)if(i in n)for(r=(s=o[i].split(",")).length;r--;)n[s[r]]=n[i];return n}(h,e)),c=h.length;c--;)if(~u.indexOf(h[c]))for(o in r=d[c],"all"===e?(i[c]=e,a=r,s={}):(s=i[c]=i[c]||{},a=e),a)(l=r&&r[o])&&("kill"in l.d&&!0!==l.d.kill(o)||Ut(this,l,"_pt"),delete r[o]),"all"!==s&&(s[o]=1);return this._initted&&!this._pt&&p&&we(this),this},e.to=function(t,n){return new e(t,n,arguments[2])},e.from=function(t,e){return ie(1,arguments)},e.delayedCall=function(t,n,i,r){return new e(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:t,onComplete:n,onReverseComplete:n,onCompleteParams:i,onReverseCompleteParams:i,callbackScope:r})},e.fromTo=function(t,e,n){return ie(2,arguments)},e.set=function(t,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new e(t,n)},e.killTweensOf=function(t,e,n){return x.killTweensOf(t,e,n)},e}($e);Ot(on.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),wt("staggerTo,staggerFrom,staggerFromTo",(function(t){on[t]=function(){var e=new Ye,n=oe.call(arguments,0);return n.splice("staggerFromTo"===t?5:4,0,0),e[t].apply(e,n)}}));var ln=function(t,e,n){return t[e]=n},cn=function(t,e,n){return t[e](n)},hn=function(t,e,n,i){return t[e](i.fp,n)},un=function(t,e,n){return t.setAttribute(e,n)},dn=function(t,e){return k(t[e])?cn:F(t[e])&&t.setAttribute?un:ln},pn=function(t,e){return e.set(e.t,e.p,Math.round(1e6*(e.s+e.c*t))/1e6,e)},fn=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},mn=function(t,e){var n=e._pt,i="";if(!t&&e.b)i=e.b;else if(1===t&&e.e)i=e.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*t):Math.round(1e4*(n.s+n.c*t))/1e4)+i,n=n._next;i+=e.c}e.set(e.t,e.p,i,e)},gn=function(t,e){for(var n=e._pt;n;)n.r(t,n.d),n=n._next},vn=function(t,e,n,i){for(var r,s=this._pt;s;)r=s._next,s.p===i&&s.modifier(t,e,n),s=r},yn=function(t){for(var e,n,i=this._pt;i;)n=i._next,i.p===t&&!i.op||i.op===t?Ut(this,i,"_pt"):i.dep||(e=1),i=n;return!e},xn=function(t,e,n,i){i.mSet(t,e,i.m.call(i.tween,n,i.mt),i)},bn=function(t){for(var e,n,i,r,s=t._pt;s;){for(e=s._next,n=i;n&&n.pr>s.pr;)n=n._next;(s._prev=n?n._prev:r)?s._prev._next=s:i=s,(s._next=n)?n._prev=s:r=s,s=e}t._pt=i},_n=function(){function t(t,e,n,i,r,s,a,o,l){this.t=e,this.s=i,this.c=r,this.p=n,this.r=s||pn,this.d=a||this,this.set=o||ln,this.pr=l||0,this._next=t,t&&(t._prev=this)}return t.prototype.modifier=function(t,e,n){this.mSet=this.mSet||this.set,this.set=xn,this.m=t,this.mt=n,this.tween=e},t}();wt(yt+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(t){return ut[t]=1})),et.TweenMax=et.TweenLite=on,et.TimelineLite=et.TimelineMax=Ye,x=new Ye({sortChildren:!1,defaults:C,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),A.stringFilter=Le;var wn=[],Sn={},Mn=[],Tn=0,En=0,An=function(t){return(Sn[t]||Mn).map((function(t){return t()}))},Cn=function(){var t=Date.now(),e=[];t-Tn>2&&(An("matchMediaInit"),wn.forEach((function(t){var n,i,r,s,a=t.queries,o=t.conditions;for(i in a)(n=b.matchMedia(a[i]).matches)&&(r=1),n!==o[i]&&(o[i]=n,s=1);s&&(t.revert(),r&&e.push(t))})),An("matchMediaRevert"),e.forEach((function(t){return t.onMatch(t,(function(e){return t.add(null,e)}))})),Tn=t,An("matchMedia"))},Pn=function(){function t(t,e){this.selector=e&&ue(e),this.data=[],this._r=[],this.isReverted=!1,this.id=En++,t&&this.add(t)}var e=t.prototype;return e.add=function(t,e,n){k(t)&&(n=e,e=t,t=k);var i=this,r=function(){var t,r=y,s=i.selector;return r&&r!==i&&r.data.push(i),n&&(i.selector=ue(n)),y=i,t=e.apply(i,arguments),k(t)&&i._r.push(t),y=r,i.selector=s,i.isReverted=!1,t};return i.last=r,t===k?r(i,(function(t){return i.add(null,t)})):t?i[t]=r:r},e.ignore=function(t){var e=y;y=null,t(this),y=e},e.getTweens=function(){var e=[];return this.data.forEach((function(n){return n instanceof t?e.push.apply(e,n.getTweens()):n instanceof on&&!(n.parent&&"nested"===n.parent.data)&&e.push(n)})),e},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(t,e){var n=this;if(t?function(){for(var e,i=n.getTweens(),r=n.data.length;r--;)"isFlip"===(e=n.data[r]).data&&(e.revert(),e.getChildren(!0,!0,!1).forEach((function(t){return i.splice(i.indexOf(t),1)})));for(i.map((function(t){return{g:t._dur||t._delay||t._sat&&!t._sat.vars.immediateRender?t.globalTime(0):-1/0,t}})).sort((function(t,e){return e.g-t.g||-1/0})).forEach((function(e){return e.t.revert(t)})),r=n.data.length;r--;)(e=n.data[r])instanceof Ye?"nested"!==e.data&&(e.scrollTrigger&&e.scrollTrigger.revert(),e.kill()):!(e instanceof on)&&e.revert&&e.revert(t);n._r.forEach((function(e){return e(t,n)})),n.isReverted=!0}():this.data.forEach((function(t){return t.kill&&t.kill()})),this.clear(),e)for(var i=wn.length;i--;)wn[i].id===this.id&&wn.splice(i,1)},e.revert=function(t){this.kill(t||{})},t}(),Rn=function(){function t(t){this.contexts=[],this.scope=t,y&&y.data.push(this)}var e=t.prototype;return e.add=function(t,e,n){V(t)||(t={matches:t});var i,r,s,a=new Pn(0,n||this.scope),o=a.conditions={};for(r in y&&!a.selector&&(a.selector=y.selector),this.contexts.push(a),e=a.add("onMatch",e),a.queries=t,t)"all"===r?s=1:(i=b.matchMedia(t[r]))&&(wn.indexOf(a)<0&&wn.push(a),(o[r]=i.matches)&&(s=1),i.addListener?i.addListener(Cn):i.addEventListener("change",Cn));return s&&e(a,(function(t){return a.add(null,t)})),this},e.revert=function(t){this.kill(t||{})},e.kill=function(t){this.contexts.forEach((function(e){return e.kill(t,!0)}))},t}(),On={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((function(t){return Me(t)}))},timeline:function(t){return new Ye(t)},getTweensOf:function(t,e){return x.getTweensOf(t,e)},getProperty:function(t,e,n,i){U(t)&&(t=he(t)[0]);var r=bt(t||{}).get,s=n?Rt:Pt;return"native"===n&&(n=""),t?e?s((ft[e]&&ft[e].get||r)(t,e,n,i)):function(e,n,i){return s((ft[e]&&ft[e].get||r)(t,e,n,i))}:t},quickSetter:function(t,e,n){if((t=he(t)).length>1){var i=t.map((function(t){return In.quickSetter(t,e,n)})),r=i.length;return function(t){for(var e=r;e--;)i[e](t)}}t=t[0]||{};var s=ft[e],a=bt(t),o=a.harness&&(a.harness.aliases||{})[e]||e,l=s?function(e){var i=new s;T._pt=0,i.init(t,n?e+n:e,T,0,[t]),i.render(1,i),T._pt&&gn(1,T)}:a.set(t,o);return s?l:function(e){return l(t,o,n?e+n:e,a,1)}},quickTo:function(t,e,n){var i,r=In.to(t,Dt(((i={})[e]="+=0.1",i.paused=!0,i),n||{})),s=function(t,n,i){return r.resetTo(e,t,n,i)};return s.tween=r,s},isTweening:function(t){return x.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=je(t.ease,C.ease)),Lt(C,t||{})},config:function(t){return Lt(A,t||{})},registerEffect:function(t){var e=t.name,n=t.effect,i=t.plugins,r=t.defaults,s=t.extendTimeline;(i||"").split(",").forEach((function(t){return t&&!ft[t]&&!et[t]&&st(e+" effect requires "+t+" plugin.")})),mt[e]=function(t,e,i){return n(he(t),Ot(e||{},r),i)},s&&(Ye.prototype[e]=function(t,n,i){return this.add(mt[e](t,V(n)?n:(i=n)&&{},this),i)})},registerEase:function(t,e){Ne[t]=je(e)},parseEase:function(t,e){return arguments.length?je(t,e):Ne},getById:function(t){return x.getById(t)},exportRoot:function(t,e){void 0===t&&(t={});var n,i,r=new Ye(t);for(r.smoothChildTiming=j(t.smoothChildTiming),x.remove(r),r._dp=0,r._time=r._tTime=x._time,n=x._first;n;)i=n._next,!e&&!n._dur&&n instanceof on&&n.vars.onComplete===n._targets[0]||$t(r,n,n._start-n._delay),n=i;return $t(x,r,0),r},context:function(t,e){return t?new Pn(t,e):y},matchMedia:function(t){return new Rn(t)},matchMediaRefresh:function(){return wn.forEach((function(t){var e,n,i=t.conditions;for(n in i)i[n]&&(i[n]=!1,e=1);e&&t.revert()}))||Cn()},addEventListener:function(t,e){var n=Sn[t]||(Sn[t]=[]);~n.indexOf(e)||n.push(e)},removeEventListener:function(t,e){var n=Sn[t],i=n&&n.indexOf(e);i>=0&&n.splice(i,1)},utils:{wrap:function t(e,n,i){var r=n-e;return q(e)?ve(e,t(0,e.length),n):re(i,(function(t){return(r+(t-e)%r)%r+e}))},wrapYoyo:function t(e,n,i){var r=n-e,s=2*r;return q(e)?ve(e,t(0,e.length-1),n):re(i,(function(t){return e+((t=(s+(t-e)%s)%s||0)>r?s-t:t)}))},distribute:pe,random:ge,snap:me,normalize:function(t,e,n){return xe(t,e,0,1,n)},getUnit:ae,clamp:function(t,e,n){return re(n,(function(n){return se(t,e,n)}))},splitColor:Ce,toArray:he,selector:ue,mapRange:xe,pipe:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.reduce((function(t,e){return e(t)}),t)}},unitize:function(t,e){return function(n){return t(parseFloat(n))+(e||ae(n))}},interpolate:function t(e,n,i,r){var s=isNaN(e+n)?0:function(t){return(1-t)*e+t*n};if(!s){var a,o,l,c,h,u=U(e),d={};if(!0===i&&(r=1)&&(i=null),u)e={p:e},n={p:n};else if(q(e)&&!q(n)){for(l=[],c=e.length,h=c-2,o=1;o<c;o++)l.push(t(e[o-1],e[o]));c--,s=function(t){t*=c;var e=Math.min(h,~~t);return l[e](t-e)},i=n}else r||(e=Dt(q(e)?[]:{},e));if(!l){for(a in n)Qe.call(d,e,a,"get",n[a]);s=function(t){return gn(t,d)||(u?e.p:e)}}}return re(i,s)},shuffle:de},install:it,effects:mt,ticker:Ie,updateRoot:Ye.updateRoot,plugins:ft,globalTimeline:x,core:{PropTween:_n,globals:at,Tween:on,Timeline:Ye,Animation:$e,getCache:bt,_removeLinkedListItem:Ut,reverting:function(){return v},context:function(t){return t&&y&&(y.data.push(t),t._ctx=y),y},suppressOverwrites:function(t){return g=t}}};wt("to,from,fromTo,delayedCall,set,killTweensOf",(function(t){return On[t]=on[t]})),Ie.add(Ye.updateRoot),T=On.to({},{duration:0});var Dn=function(t,e){for(var n=t._pt;n&&n.p!==e&&n.op!==e&&n.fp!==e;)n=n._next;return n},Ln=function(t,e){return{name:t,rawVars:1,init:function(t,n,i){i._onInit=function(t){var i,r;if(U(n)&&(i={},wt(n,(function(t){return i[t]=1})),n=i),e){for(r in i={},n)i[r]=e(n[r]);n=i}!function(t,e){var n,i,r,s=t._targets;for(n in e)for(i=s.length;i--;)(r=t._ptLookup[i][n])&&(r=r.d)&&(r._pt&&(r=Dn(r,n)),r&&r.modifier&&r.modifier(e[n],t,s[i],n))}(t,n)}}}},In=On.registerPlugin({name:"attr",init:function(t,e,n,i,r){var s,a,o;for(s in this.tween=n,e)o=t.getAttribute(s)||"",(a=this.add(t,"setAttribute",(o||0)+"",e[s],i,r,0,0,s)).op=s,a.b=o,this._props.push(s)},render:function(t,e){for(var n=e._pt;n;)v?n.set(n.t,n.p,n.b,n):n.r(t,n.d),n=n._next}},{name:"endArray",init:function(t,e){for(var n=e.length;n--;)this.add(t,n,t[n]||0,e[n],0,0,0,0,0,1)}},Ln("roundProps",fe),Ln("modifiers"),Ln("snap",me))||On;on.version=Ye.version=In.version="3.12.5",S=1,H()&&ze();Ne.Power0,Ne.Power1,Ne.Power2,Ne.Power3,Ne.Power4,Ne.Linear,Ne.Quad,Ne.Cubic,Ne.Quart,Ne.Quint,Ne.Strong,Ne.Elastic,Ne.Back,Ne.SteppedEase,Ne.Bounce,Ne.Sine,Ne.Expo,Ne.Circ;var zn,Nn,Un,kn,Bn,Fn,Vn,jn,Hn={},Gn=180/Math.PI,Wn=Math.PI/180,qn=Math.atan2,Xn=/([A-Z])/g,$n=/(left|right|width|margin|padding|x)/i,Yn=/[\s,\(]\S/,Zn={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Kn=function(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},Jn=function(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},Qn=function(t,e){return e.set(e.t,e.p,t?Math.round(1e4*(e.s+e.c*t))/1e4+e.u:e.b,e)},ti=function(t,e){var n=e.s+e.c*t;e.set(e.t,e.p,~~(n+(n<0?-.5:.5))+e.u,e)},ei=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},ni=function(t,e){return e.set(e.t,e.p,1!==t?e.b:e.e,e)},ii=function(t,e,n){return t.style[e]=n},ri=function(t,e,n){return t.style.setProperty(e,n)},si=function(t,e,n){return t._gsap[e]=n},ai=function(t,e,n){return t._gsap.scaleX=t._gsap.scaleY=n},oi=function(t,e,n,i,r){var s=t._gsap;s.scaleX=s.scaleY=n,s.renderTransform(r,s)},li=function(t,e,n,i,r){var s=t._gsap;s[e]=n,s.renderTransform(r,s)},ci="transform",hi=ci+"Origin",ui=function t(e,n){var i=this,r=this.target,s=r.style,a=r._gsap;if(e in Hn&&s){if(this.tfm=this.tfm||{},"transform"===e)return Zn.transform.split(",").forEach((function(e){return t.call(i,e,n)}));if(~(e=Zn[e]||e).indexOf(",")?e.split(",").forEach((function(t){return i.tfm[t]=Pi(r,t)})):this.tfm[e]=a.x?a[e]:Pi(r,e),e===hi&&(this.tfm.zOrigin=a.zOrigin),this.props.indexOf(ci)>=0)return;a.svg&&(this.svgo=r.getAttribute("data-svg-origin"),this.props.push(hi,n,"")),e=ci}(s||n)&&this.props.push(e,n,s[e])},di=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},pi=function(){var t,e,n=this.props,i=this.target,r=i.style,s=i._gsap;for(t=0;t<n.length;t+=3)n[t+1]?i[n[t]]=n[t+2]:n[t+2]?r[n[t]]=n[t+2]:r.removeProperty("--"===n[t].substr(0,2)?n[t]:n[t].replace(Xn,"-$1").toLowerCase());if(this.tfm){for(e in this.tfm)s[e]=this.tfm[e];s.svg&&(s.renderTransform(),i.setAttribute("data-svg-origin",this.svgo||"")),(t=Vn())&&t.isStart||r[ci]||(di(r),s.zOrigin&&r[hi]&&(r[hi]+=" "+s.zOrigin+"px",s.zOrigin=0,s.renderTransform()),s.uncache=1)}},fi=function(t,e){var n={target:t,props:[],revert:pi,save:ui};return t._gsap||In.core.getCache(t),e&&e.split(",").forEach((function(t){return n.save(t)})),n},mi=function(t,e){var n=Nn.createElementNS?Nn.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):Nn.createElement(t);return n&&n.style?n:Nn.createElement(t)},gi=function t(e,n,i){var r=getComputedStyle(e);return r[n]||r.getPropertyValue(n.replace(Xn,"-$1").toLowerCase())||r.getPropertyValue(n)||!i&&t(e,yi(n)||n,1)||""},vi="O,Moz,ms,Ms,Webkit".split(","),yi=function(t,e,n){var i=(e||Bn).style,r=5;if(t in i&&!n)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);r--&&!(vi[r]+t in i););return r<0?null:(3===r?"ms":r>=0?vi[r]:"")+t},xi=function(){"undefined"!=typeof window&&window.document&&(zn=window,Nn=zn.document,Un=Nn.documentElement,Bn=mi("div")||{style:{}},mi("div"),ci=yi(ci),hi=ci+"Origin",Bn.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",jn=!!yi("perspective"),Vn=In.core.reverting,kn=1)},bi=function t(e){var n,i=mi("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=this.parentNode,s=this.nextSibling,a=this.style.cssText;if(Un.appendChild(i),i.appendChild(this),this.style.display="block",e)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=t}catch(t){}else this._gsapBBox&&(n=this._gsapBBox());return r&&(s?r.insertBefore(this,s):r.appendChild(this)),Un.removeChild(i),this.style.cssText=a,n},_i=function(t,e){for(var n=e.length;n--;)if(t.hasAttribute(e[n]))return t.getAttribute(e[n])},wi=function(t){var e;try{e=t.getBBox()}catch(n){e=bi.call(t,!0)}return e&&(e.width||e.height)||t.getBBox===bi||(e=bi.call(t,!0)),!e||e.width||e.x||e.y?e:{x:+_i(t,["x","cx","x1"])||0,y:+_i(t,["y","cy","y1"])||0,width:0,height:0}},Si=function(t){return!(!t.getCTM||t.parentNode&&!t.ownerSVGElement||!wi(t))},Mi=function(t,e){if(e){var n,i=t.style;e in Hn&&e!==hi&&(e=ci),i.removeProperty?("ms"!==(n=e.substr(0,2))&&"webkit"!==e.substr(0,6)||(e="-"+e),i.removeProperty("--"===n?e:e.replace(Xn,"-$1").toLowerCase())):i.removeAttribute(e)}},Ti=function(t,e,n,i,r,s){var a=new _n(t._pt,e,n,0,1,s?ni:ei);return t._pt=a,a.b=i,a.e=r,t._props.push(n),a},Ei={deg:1,rad:1,turn:1},Ai={grid:1,flex:1},Ci=function t(e,n,i,r){var s,a,o,l,c=parseFloat(i)||0,h=(i+"").trim().substr((c+"").length)||"px",u=Bn.style,d=$n.test(n),p="svg"===e.tagName.toLowerCase(),f=(p?"client":"offset")+(d?"Width":"Height"),m=100,g="px"===r,v="%"===r;if(r===h||!c||Ei[r]||Ei[h])return c;if("px"!==h&&!g&&(c=t(e,n,i,"px")),l=e.getCTM&&Si(e),(v||"%"===h)&&(Hn[n]||~n.indexOf("adius")))return s=l?e.getBBox()[d?"width":"height"]:e[f],St(v?c/s*m:c/100*s);if(u[d?"width":"height"]=m+(g?h:r),a=~n.indexOf("adius")||"em"===r&&e.appendChild&&!p?e:e.parentNode,l&&(a=(e.ownerSVGElement||{}).parentNode),a&&a!==Nn&&a.appendChild||(a=Nn.body),(o=a._gsap)&&v&&o.width&&d&&o.time===Ie.time&&!o.uncache)return St(c/o.width*m);if(!v||"height"!==n&&"width"!==n)(v||"%"===h)&&!Ai[gi(a,"display")]&&(u.position=gi(e,"position")),a===e&&(u.position="static"),a.appendChild(Bn),s=Bn[f],a.removeChild(Bn),u.position="absolute";else{var y=e.style[n];e.style[n]=m+r,s=e[f],y?e.style[n]=y:Mi(e,n)}return d&&v&&((o=bt(a)).time=Ie.time,o.width=a[f]),St(g?s*c/m:s&&c?m/s*c:0)},Pi=function(t,e,n,i){var r;return kn||xi(),e in Zn&&"transform"!==e&&~(e=Zn[e]).indexOf(",")&&(e=e.split(",")[0]),Hn[e]&&"transform"!==e?(r=Fi(t,i),r="transformOrigin"!==e?r[e]:r.svg?r.origin:Vi(gi(t,hi))+" "+r.zOrigin+"px"):(!(r=t.style[e])||"auto"===r||i||~(r+"").indexOf("calc("))&&(r=Li[e]&&Li[e](t,e,n)||gi(t,e)||_t(t,e)||("opacity"===e?1:0)),n&&!~(r+"").trim().indexOf(" ")?Ci(t,e,r,n)+n:r},Ri=function(t,e,n,i){if(!n||"none"===n){var r=yi(e,t,1),s=r&&gi(t,r,1);s&&s!==n?(e=r,n=s):"borderColor"===e&&(n=gi(t,"borderTopColor"))}var a,o,l,c,h,u,d,p,f,m,g,v=new _n(this._pt,t.style,e,0,1,mn),y=0,x=0;if(v.b=n,v.e=i,n+="","auto"===(i+="")&&(u=t.style[e],t.style[e]=i,i=gi(t,e)||i,u?t.style[e]=u:Mi(t,e)),Le(a=[n,i]),i=a[1],l=(n=a[0]).match(Z)||[],(i.match(Z)||[]).length){for(;o=Z.exec(i);)d=o[0],f=i.substring(y,o.index),h?h=(h+1)%5:"rgba("!==f.substr(-5)&&"hsla("!==f.substr(-5)||(h=1),d!==(u=l[x++]||"")&&(c=parseFloat(u)||0,g=u.substr((c+"").length),"="===d.charAt(1)&&(d=Tt(c,d)+g),p=parseFloat(d),m=d.substr((p+"").length),y=Z.lastIndex-m.length,m||(m=m||A.units[e]||g,y===i.length&&(i+=m,v.e+=m)),g!==m&&(c=Ci(t,e,u,m)||0),v._pt={_next:v._pt,p:f||1===x?f:",",s:c,c:p-c,m:h&&h<4||"zIndex"===e?Math.round:0});v.c=y<i.length?i.substring(y,i.length):""}else v.r="display"===e&&"none"===i?ni:ei;return J.test(i)&&(v.e=0),this._pt=v,v},Oi={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Di=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var n,i,r,s=e.t,a=s.style,o=e.u,l=s._gsap;if("all"===o||!0===o)a.cssText="",i=1;else for(r=(o=o.split(",")).length;--r>-1;)n=o[r],Hn[n]&&(i=1,n="transformOrigin"===n?hi:ci),Mi(s,n);i&&(Mi(s,ci),l&&(l.svg&&s.removeAttribute("transform"),Fi(s,1),l.uncache=1,di(a)))}},Li={clearProps:function(t,e,n,i,r){if("isFromStart"!==r.data){var s=t._pt=new _n(t._pt,e,n,0,0,Di);return s.u=i,s.pr=-10,s.tween=r,t._props.push(n),1}}},Ii=[1,0,0,1,0,0],zi={},Ni=function(t){return"matrix(1, 0, 0, 1, 0, 0)"===t||"none"===t||!t},Ui=function(t){var e=gi(t,ci);return Ni(e)?Ii:e.substr(7).match(Y).map(St)},ki=function(t,e){var n,i,r,s,a=t._gsap||bt(t),o=t.style,l=Ui(t);return a.svg&&t.getAttribute("transform")?"1,0,0,1,0,0"===(l=[(r=t.transform.baseVal.consolidate().matrix).a,r.b,r.c,r.d,r.e,r.f]).join(",")?Ii:l:(l!==Ii||t.offsetParent||t===Un||a.svg||(r=o.display,o.display="block",(n=t.parentNode)&&t.offsetParent||(s=1,i=t.nextElementSibling,Un.appendChild(t)),l=Ui(t),r?o.display=r:Mi(t,"display"),s&&(i?n.insertBefore(t,i):n?n.appendChild(t):Un.removeChild(t))),e&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},Bi=function(t,e,n,i,r,s){var a,o,l,c=t._gsap,h=r||ki(t,!0),u=c.xOrigin||0,d=c.yOrigin||0,p=c.xOffset||0,f=c.yOffset||0,m=h[0],g=h[1],v=h[2],y=h[3],x=h[4],b=h[5],_=e.split(" "),w=parseFloat(_[0])||0,S=parseFloat(_[1])||0;n?h!==Ii&&(o=m*y-g*v)&&(l=w*(-g/o)+S*(m/o)-(m*b-g*x)/o,w=w*(y/o)+S*(-v/o)+(v*b-y*x)/o,S=l):(w=(a=wi(t)).x+(~_[0].indexOf("%")?w/100*a.width:w),S=a.y+(~(_[1]||_[0]).indexOf("%")?S/100*a.height:S)),i||!1!==i&&c.smooth?(x=w-u,b=S-d,c.xOffset=p+(x*m+b*v)-x,c.yOffset=f+(x*g+b*y)-b):c.xOffset=c.yOffset=0,c.xOrigin=w,c.yOrigin=S,c.smooth=!!i,c.origin=e,c.originIsAbsolute=!!n,t.style[hi]="0px 0px",s&&(Ti(s,c,"xOrigin",u,w),Ti(s,c,"yOrigin",d,S),Ti(s,c,"xOffset",p,c.xOffset),Ti(s,c,"yOffset",f,c.yOffset)),t.setAttribute("data-svg-origin",w+" "+S)},Fi=function(t,e){var n=t._gsap||new Xe(t);if("x"in n&&!e&&!n.uncache)return n;var i,r,s,a,o,l,c,h,u,d,p,f,m,g,v,y,x,b,_,w,S,M,T,E,C,P,R,O,D,L,I,z,N=t.style,U=n.scaleX<0,k="px",B="deg",F=getComputedStyle(t),V=gi(t,hi)||"0";return i=r=s=l=c=h=u=d=p=0,a=o=1,n.svg=!(!t.getCTM||!Si(t)),F.translate&&("none"===F.translate&&"none"===F.scale&&"none"===F.rotate||(N[ci]=("none"!==F.translate?"translate3d("+(F.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==F.rotate?"rotate("+F.rotate+") ":"")+("none"!==F.scale?"scale("+F.scale.split(" ").join(",")+") ":"")+("none"!==F[ci]?F[ci]:"")),N.scale=N.rotate=N.translate="none"),g=ki(t,n.svg),n.svg&&(n.uncache?(C=t.getBBox(),V=n.xOrigin-C.x+"px "+(n.yOrigin-C.y)+"px",E=""):E=!e&&t.getAttribute("data-svg-origin"),Bi(t,E||V,!!E||n.originIsAbsolute,!1!==n.smooth,g)),f=n.xOrigin||0,m=n.yOrigin||0,g!==Ii&&(b=g[0],_=g[1],w=g[2],S=g[3],i=M=g[4],r=T=g[5],6===g.length?(a=Math.sqrt(b*b+_*_),o=Math.sqrt(S*S+w*w),l=b||_?qn(_,b)*Gn:0,(u=w||S?qn(w,S)*Gn+l:0)&&(o*=Math.abs(Math.cos(u*Wn))),n.svg&&(i-=f-(f*b+m*w),r-=m-(f*_+m*S))):(z=g[6],L=g[7],R=g[8],O=g[9],D=g[10],I=g[11],i=g[12],r=g[13],s=g[14],c=(v=qn(z,D))*Gn,v&&(E=M*(y=Math.cos(-v))+R*(x=Math.sin(-v)),C=T*y+O*x,P=z*y+D*x,R=M*-x+R*y,O=T*-x+O*y,D=z*-x+D*y,I=L*-x+I*y,M=E,T=C,z=P),h=(v=qn(-w,D))*Gn,v&&(y=Math.cos(-v),I=S*(x=Math.sin(-v))+I*y,b=E=b*y-R*x,_=C=_*y-O*x,w=P=w*y-D*x),l=(v=qn(_,b))*Gn,v&&(E=b*(y=Math.cos(v))+_*(x=Math.sin(v)),C=M*y+T*x,_=_*y-b*x,T=T*y-M*x,b=E,M=C),c&&Math.abs(c)+Math.abs(l)>359.9&&(c=l=0,h=180-h),a=St(Math.sqrt(b*b+_*_+w*w)),o=St(Math.sqrt(T*T+z*z)),v=qn(M,T),u=Math.abs(v)>2e-4?v*Gn:0,p=I?1/(I<0?-I:I):0),n.svg&&(E=t.getAttribute("transform"),n.forceCSS=t.setAttribute("transform","")||!Ni(gi(t,ci)),E&&t.setAttribute("transform",E))),Math.abs(u)>90&&Math.abs(u)<270&&(U?(a*=-1,u+=l<=0?180:-180,l+=l<=0?180:-180):(o*=-1,u+=u<=0?180:-180)),e=e||n.uncache,n.x=i-((n.xPercent=i&&(!e&&n.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-i)?-50:0)))?t.offsetWidth*n.xPercent/100:0)+k,n.y=r-((n.yPercent=r&&(!e&&n.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-r)?-50:0)))?t.offsetHeight*n.yPercent/100:0)+k,n.z=s+k,n.scaleX=St(a),n.scaleY=St(o),n.rotation=St(l)+B,n.rotationX=St(c)+B,n.rotationY=St(h)+B,n.skewX=u+B,n.skewY=d+B,n.transformPerspective=p+k,(n.zOrigin=parseFloat(V.split(" ")[2])||!e&&n.zOrigin||0)&&(N[hi]=Vi(V)),n.xOffset=n.yOffset=0,n.force3D=A.force3D,n.renderTransform=n.svg?$i:jn?Xi:Hi,n.uncache=0,n},Vi=function(t){return(t=t.split(" "))[0]+" "+t[1]},ji=function(t,e,n){var i=ae(e);return St(parseFloat(e)+parseFloat(Ci(t,"x",n+"px",i)))+i},Hi=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,Xi(t,e)},Gi="0deg",Wi="0px",qi=") ",Xi=function(t,e){var n=e||this,i=n.xPercent,r=n.yPercent,s=n.x,a=n.y,o=n.z,l=n.rotation,c=n.rotationY,h=n.rotationX,u=n.skewX,d=n.skewY,p=n.scaleX,f=n.scaleY,m=n.transformPerspective,g=n.force3D,v=n.target,y=n.zOrigin,x="",b="auto"===g&&t&&1!==t||!0===g;if(y&&(h!==Gi||c!==Gi)){var _,w=parseFloat(c)*Wn,S=Math.sin(w),M=Math.cos(w);w=parseFloat(h)*Wn,_=Math.cos(w),s=ji(v,s,S*_*-y),a=ji(v,a,-Math.sin(w)*-y),o=ji(v,o,M*_*-y+y)}m!==Wi&&(x+="perspective("+m+qi),(i||r)&&(x+="translate("+i+"%, "+r+"%) "),(b||s!==Wi||a!==Wi||o!==Wi)&&(x+=o!==Wi||b?"translate3d("+s+", "+a+", "+o+") ":"translate("+s+", "+a+qi),l!==Gi&&(x+="rotate("+l+qi),c!==Gi&&(x+="rotateY("+c+qi),h!==Gi&&(x+="rotateX("+h+qi),u===Gi&&d===Gi||(x+="skew("+u+", "+d+qi),1===p&&1===f||(x+="scale("+p+", "+f+qi),v.style[ci]=x||"translate(0, 0)"},$i=function(t,e){var n,i,r,s,a,o=e||this,l=o.xPercent,c=o.yPercent,h=o.x,u=o.y,d=o.rotation,p=o.skewX,f=o.skewY,m=o.scaleX,g=o.scaleY,v=o.target,y=o.xOrigin,x=o.yOrigin,b=o.xOffset,_=o.yOffset,w=o.forceCSS,S=parseFloat(h),M=parseFloat(u);d=parseFloat(d),p=parseFloat(p),(f=parseFloat(f))&&(p+=f=parseFloat(f),d+=f),d||p?(d*=Wn,p*=Wn,n=Math.cos(d)*m,i=Math.sin(d)*m,r=Math.sin(d-p)*-g,s=Math.cos(d-p)*g,p&&(f*=Wn,a=Math.tan(p-f),r*=a=Math.sqrt(1+a*a),s*=a,f&&(a=Math.tan(f),n*=a=Math.sqrt(1+a*a),i*=a)),n=St(n),i=St(i),r=St(r),s=St(s)):(n=m,s=g,i=r=0),(S&&!~(h+"").indexOf("px")||M&&!~(u+"").indexOf("px"))&&(S=Ci(v,"x",h,"px"),M=Ci(v,"y",u,"px")),(y||x||b||_)&&(S=St(S+y-(y*n+x*r)+b),M=St(M+x-(y*i+x*s)+_)),(l||c)&&(a=v.getBBox(),S=St(S+l/100*a.width),M=St(M+c/100*a.height)),a="matrix("+n+","+i+","+r+","+s+","+S+","+M+")",v.setAttribute("transform",a),w&&(v.style[ci]=a)},Yi=function(t,e,n,i,r){var s,a,o=360,l=U(r),c=parseFloat(r)*(l&&~r.indexOf("rad")?Gn:1)-i,h=i+c+"deg";return l&&("short"===(s=r.split("_")[1])&&(c%=o)!==c%180&&(c+=c<0?o:-360),"cw"===s&&c<0?c=(c+36e9)%o-~~(c/o)*o:"ccw"===s&&c>0&&(c=(c-36e9)%o-~~(c/o)*o)),t._pt=a=new _n(t._pt,e,n,i,c,Jn),a.e=h,a.u="deg",t._props.push(n),a},Zi=function(t,e){for(var n in e)t[n]=e[n];return t},Ki=function(t,e,n){var i,r,s,a,o,l,c,h=Zi({},n._gsap),u=n.style;for(r in h.svg?(s=n.getAttribute("transform"),n.setAttribute("transform",""),u[ci]=e,i=Fi(n,1),Mi(n,ci),n.setAttribute("transform",s)):(s=getComputedStyle(n)[ci],u[ci]=e,i=Fi(n,1),u[ci]=s),Hn)(s=h[r])!==(a=i[r])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(r)<0&&(o=ae(s)!==(c=ae(a))?Ci(n,r,s,c):parseFloat(s),l=parseFloat(a),t._pt=new _n(t._pt,i,r,o,l-o,Kn),t._pt.u=c||0,t._props.push(r));Zi(i,h)};wt("padding,margin,Width,Radius",(function(t,e){var n="Top",i="Right",r="Bottom",s="Left",a=(e<3?[n,i,r,s]:[n+s,n+i,r+i,r+s]).map((function(n){return e<2?t+n:"border"+n+t}));Li[e>1?"border"+t:t]=function(t,e,n,i,r){var s,o;if(arguments.length<4)return s=a.map((function(e){return Pi(t,e,n)})),5===(o=s.join(" ")).split(s[0]).length?s[0]:o;s=(i+"").split(" "),o={},a.forEach((function(t,e){return o[t]=s[e]=s[e]||s[(e-1)/2|0]})),t.init(e,o,r)}}));var Ji,Qi,tr,er={name:"css",register:xi,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,n,i,r){var s,a,o,l,c,h,u,d,p,f,m,g,v,y,x,b,_,w,S,M,T=this._props,E=t.style,C=n.vars.startAt;for(u in kn||xi(),this.styles=this.styles||fi(t),b=this.styles.props,this.tween=n,e)if("autoRound"!==u&&(a=e[u],!ft[u]||!tn(u,e,n,i,t,r)))if(c=typeof a,h=Li[u],"function"===c&&(c=typeof(a=a.call(n,i,t,r))),"string"===c&&~a.indexOf("random(")&&(a=ye(a)),h)h(this,t,u,a,n)&&(x=1);else if("--"===u.substr(0,2))s=(getComputedStyle(t).getPropertyValue(u)+"").trim(),a+="",Oe.lastIndex=0,Oe.test(s)||(d=ae(s),p=ae(a)),p?d!==p&&(s=Ci(t,u,s,p)+p):d&&(a+=d),this.add(E,"setProperty",s,a,i,r,0,0,u),T.push(u),b.push(u,0,E[u]);else if("undefined"!==c){if(C&&u in C?(s="function"==typeof C[u]?C[u].call(n,i,t,r):C[u],U(s)&&~s.indexOf("random(")&&(s=ye(s)),ae(s+"")||"auto"===s||(s+=A.units[u]||ae(Pi(t,u))||""),"="===(s+"").charAt(1)&&(s=Pi(t,u))):s=Pi(t,u),l=parseFloat(s),(f="string"===c&&"="===a.charAt(1)&&a.substr(0,2))&&(a=a.substr(2)),o=parseFloat(a),u in Zn&&("autoAlpha"===u&&(1===l&&"hidden"===Pi(t,"visibility")&&o&&(l=0),b.push("visibility",0,E.visibility),Ti(this,E,"visibility",l?"inherit":"hidden",o?"inherit":"hidden",!o)),"scale"!==u&&"transform"!==u&&~(u=Zn[u]).indexOf(",")&&(u=u.split(",")[0])),m=u in Hn)if(this.styles.save(u),g||((v=t._gsap).renderTransform&&!e.parseTransform||Fi(t,e.parseTransform),y=!1!==e.smoothOrigin&&v.smooth,(g=this._pt=new _n(this._pt,E,ci,0,1,v.renderTransform,v,0,-1)).dep=1),"scale"===u)this._pt=new _n(this._pt,v,"scaleY",v.scaleY,(f?Tt(v.scaleY,f+o):o)-v.scaleY||0,Kn),this._pt.u=0,T.push("scaleY",u),u+="X";else{if("transformOrigin"===u){b.push(hi,0,E[hi]),w=void 0,S=void 0,M=void 0,w=(_=a).split(" "),S=w[0],M=w[1]||"50%","top"!==S&&"bottom"!==S&&"left"!==M&&"right"!==M||(_=S,S=M,M=_),w[0]=Oi[S]||S,w[1]=Oi[M]||M,a=w.join(" "),v.svg?Bi(t,a,0,y,0,this):((p=parseFloat(a.split(" ")[2])||0)!==v.zOrigin&&Ti(this,v,"zOrigin",v.zOrigin,p),Ti(this,E,u,Vi(s),Vi(a)));continue}if("svgOrigin"===u){Bi(t,a,1,y,0,this);continue}if(u in zi){Yi(this,v,u,l,f?Tt(l,f+a):a);continue}if("smoothOrigin"===u){Ti(this,v,"smooth",v.smooth,a);continue}if("force3D"===u){v[u]=a;continue}if("transform"===u){Ki(this,a,t);continue}}else u in E||(u=yi(u)||u);if(m||(o||0===o)&&(l||0===l)&&!Yn.test(a)&&u in E)o||(o=0),(d=(s+"").substr((l+"").length))!==(p=ae(a)||(u in A.units?A.units[u]:d))&&(l=Ci(t,u,s,p)),this._pt=new _n(this._pt,m?v:E,u,l,(f?Tt(l,f+o):o)-l,m||"px"!==p&&"zIndex"!==u||!1===e.autoRound?Kn:ti),this._pt.u=p||0,d!==p&&"%"!==p&&(this._pt.b=s,this._pt.r=Qn);else if(u in E)Ri.call(this,t,u,s,f?f+a:a);else if(u in t)this.add(t,u,s||t[u],f?f+a:a,i,r);else if("parseTransform"!==u){rt(u,a);continue}m||(u in E?b.push(u,0,E[u]):b.push(u,1,s||t[u])),T.push(u)}x&&bn(this)},render:function(t,e){if(e.tween._time||!Vn())for(var n=e._pt;n;)n.r(t,n.d),n=n._next;else e.styles.revert()},get:Pi,aliases:Zn,getSetter:function(t,e,n){var i=Zn[e];return i&&i.indexOf(",")<0&&(e=i),e in Hn&&e!==hi&&(t._gsap.x||Pi(t,"x"))?n&&Fn===n?"scale"===e?ai:si:(Fn=n||{})&&("scale"===e?oi:li):t.style&&!F(t.style[e])?ii:~e.indexOf("-")?ri:dn(t,e)},core:{_removeProperty:Mi,_getMatrix:ki}};In.utils.checkPrefix=yi,In.core.getStyleSaver=fi,tr=wt((Ji="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(Qi="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(t){Hn[t]=1})),wt(Qi,(function(t){A.units[t]="deg",zi[t]=1})),Zn[tr[13]]=Ji+","+Qi,wt("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(t){var e=t.split(":");Zn[e[1]]=tr[e[0]]})),wt("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(t){A.units[t]="px"})),In.registerPlugin(er);var nr=In.registerPlugin(er)||In;nr.core.Tween;function ir(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var rr,sr,ar,or,lr,cr,hr,ur,dr,pr,fr,mr,gr,vr=function(){return rr||"undefined"!=typeof window&&(rr=window.gsap)&&rr.registerPlugin&&rr},yr=1,xr=[],br=[],_r=[],wr=Date.now,Sr=function(t,e){return e},Mr=function(t,e){return~_r.indexOf(t)&&_r[_r.indexOf(t)+1][e]},Tr=function(t){return!!~pr.indexOf(t)},Er=function(t,e,n,i,r){return t.addEventListener(e,n,{passive:!1!==i,capture:!!r})},Ar=function(t,e,n,i){return t.removeEventListener(e,n,!!i)},Cr="scrollLeft",Pr="scrollTop",Rr=function(){return fr&&fr.isPressed||br.cache++},Or=function(t,e){var n=function n(i){if(i||0===i){yr&&(ar.history.scrollRestoration="manual");var r=fr&&fr.isPressed;i=n.v=Math.round(i)||(fr&&fr.iOS?1:0),t(i),n.cacheID=br.cache,r&&Sr("ss",i)}else(e||br.cache!==n.cacheID||Sr("ref"))&&(n.cacheID=br.cache,n.v=t());return n.v+n.offset};return n.offset=0,t&&n},Dr={s:Cr,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:Or((function(t){return arguments.length?ar.scrollTo(t,Lr.sc()):ar.pageXOffset||or[Cr]||lr[Cr]||cr[Cr]||0}))},Lr={s:Pr,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:Dr,sc:Or((function(t){return arguments.length?ar.scrollTo(Dr.sc(),t):ar.pageYOffset||or[Pr]||lr[Pr]||cr[Pr]||0}))},Ir=function(t,e){return(e&&e._ctx&&e._ctx.selector||rr.utils.toArray)(t)[0]||("string"==typeof t&&!1!==rr.config().nullTargetWarn?console.warn("Element not found:",t):null)},zr=function(t,e){var n=e.s,i=e.sc;Tr(t)&&(t=or.scrollingElement||lr);var r=br.indexOf(t),s=i===Lr.sc?1:2;!~r&&(r=br.push(t)-1),br[r+s]||Er(t,"scroll",Rr);var a=br[r+s],o=a||(br[r+s]=Or(Mr(t,n),!0)||(Tr(t)?i:Or((function(e){return arguments.length?t[n]=e:t[n]}))));return o.target=t,a||(o.smooth="smooth"===rr.getProperty(t,"scrollBehavior")),o},Nr=function(t,e,n){var i=t,r=t,s=wr(),a=s,o=e||50,l=Math.max(500,3*o),c=function(t,e){var l=wr();e||l-s>o?(r=i,i=t,a=s,s=l):n?i+=t:i=r+(t-r)/(l-a)*(s-a)};return{update:c,reset:function(){r=i=n?0:i,a=s=0},getVelocity:function(t){var e=a,o=r,h=wr();return(t||0===t)&&t!==i&&c(t),s===a||h-a>l?0:(i+(n?o:-o))/((n?h:s)-e)*1e3}}},Ur=function(t,e){return e&&!t._gsapAllow&&t.preventDefault(),t.changedTouches?t.changedTouches[0]:t},kr=function(t){var e=Math.max.apply(Math,t),n=Math.min.apply(Math,t);return Math.abs(e)>=Math.abs(n)?e:n},Br=function(){(dr=rr.core.globals().ScrollTrigger)&&dr.core&&function(){var t=dr.core,e=t.bridge||{},n=t._scrollers,i=t._proxies;n.push.apply(n,br),i.push.apply(i,_r),br=n,_r=i,Sr=function(t,n){return e[t](n)}}()},Fr=function(t){return rr=t||vr(),!sr&&rr&&"undefined"!=typeof document&&document.body&&(ar=window,or=document,lr=or.documentElement,cr=or.body,pr=[ar,or,lr,cr],rr.utils.clamp,gr=rr.core.context||function(){},ur="onpointerenter"in cr?"pointer":"mouse",hr=Vr.isTouch=ar.matchMedia&&ar.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in ar||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,mr=Vr.eventTypes=("ontouchstart"in lr?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in lr?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout((function(){return yr=0}),500),Br(),sr=1),sr};Dr.op=Lr,br.cache=0;var Vr=function(){function t(t){this.init(t)}var e,n,i;return t.prototype.init=function(t){sr||Fr(rr)||console.warn("Please gsap.registerPlugin(Observer)"),dr||Br();var e=t.tolerance,n=t.dragMinimum,i=t.type,r=t.target,s=t.lineHeight,a=t.debounce,o=t.preventDefault,l=t.onStop,c=t.onStopDelay,h=t.ignore,u=t.wheelSpeed,d=t.event,p=t.onDragStart,f=t.onDragEnd,m=t.onDrag,g=t.onPress,v=t.onRelease,y=t.onRight,x=t.onLeft,b=t.onUp,_=t.onDown,w=t.onChangeX,S=t.onChangeY,M=t.onChange,T=t.onToggleX,E=t.onToggleY,A=t.onHover,C=t.onHoverEnd,P=t.onMove,R=t.ignoreCheck,O=t.isNormalizer,D=t.onGestureStart,L=t.onGestureEnd,I=t.onWheel,z=t.onEnable,N=t.onDisable,U=t.onClick,k=t.scrollSpeed,B=t.capture,F=t.allowClicks,V=t.lockAxis,j=t.onLockAxis;this.target=r=Ir(r)||lr,this.vars=t,h&&(h=rr.utils.toArray(h)),e=e||1e-9,n=n||0,u=u||1,k=k||1,i=i||"wheel,touch,pointer",a=!1!==a,s||(s=parseFloat(ar.getComputedStyle(cr).lineHeight)||22);var H,G,W,q,X,$,Y,Z=this,K=0,J=0,Q=t.passive||!o,tt=zr(r,Dr),et=zr(r,Lr),nt=tt(),it=et(),rt=~i.indexOf("touch")&&!~i.indexOf("pointer")&&"pointerdown"===mr[0],st=Tr(r),at=r.ownerDocument||or,ot=[0,0,0],lt=[0,0,0],ct=0,ht=function(){return ct=wr()},ut=function(t,e){return(Z.event=t)&&h&&~h.indexOf(t.target)||e&&rt&&"touch"!==t.pointerType||R&&R(t,e)},dt=function(){var t=Z.deltaX=kr(ot),n=Z.deltaY=kr(lt),i=Math.abs(t)>=e,r=Math.abs(n)>=e;M&&(i||r)&&M(Z,t,n,ot,lt),i&&(y&&Z.deltaX>0&&y(Z),x&&Z.deltaX<0&&x(Z),w&&w(Z),T&&Z.deltaX<0!=K<0&&T(Z),K=Z.deltaX,ot[0]=ot[1]=ot[2]=0),r&&(_&&Z.deltaY>0&&_(Z),b&&Z.deltaY<0&&b(Z),S&&S(Z),E&&Z.deltaY<0!=J<0&&E(Z),J=Z.deltaY,lt[0]=lt[1]=lt[2]=0),(q||W)&&(P&&P(Z),W&&(m(Z),W=!1),q=!1),$&&!($=!1)&&j&&j(Z),X&&(I(Z),X=!1),H=0},pt=function(t,e,n){ot[n]+=t,lt[n]+=e,Z._vx.update(t),Z._vy.update(e),a?H||(H=requestAnimationFrame(dt)):dt()},ft=function(t,e){V&&!Y&&(Z.axis=Y=Math.abs(t)>Math.abs(e)?"x":"y",$=!0),"y"!==Y&&(ot[2]+=t,Z._vx.update(t,!0)),"x"!==Y&&(lt[2]+=e,Z._vy.update(e,!0)),a?H||(H=requestAnimationFrame(dt)):dt()},mt=function(t){if(!ut(t,1)){var e=(t=Ur(t,o)).clientX,i=t.clientY,r=e-Z.x,s=i-Z.y,a=Z.isDragging;Z.x=e,Z.y=i,(a||Math.abs(Z.startX-e)>=n||Math.abs(Z.startY-i)>=n)&&(m&&(W=!0),a||(Z.isDragging=!0),ft(r,s),a||p&&p(Z))}},gt=Z.onPress=function(t){ut(t,1)||t&&t.button||(Z.axis=Y=null,G.pause(),Z.isPressed=!0,t=Ur(t),K=J=0,Z.startX=Z.x=t.clientX,Z.startY=Z.y=t.clientY,Z._vx.reset(),Z._vy.reset(),Er(O?r:at,mr[1],mt,Q,!0),Z.deltaX=Z.deltaY=0,g&&g(Z))},vt=Z.onRelease=function(t){if(!ut(t,1)){Ar(O?r:at,mr[1],mt,!0);var e=!isNaN(Z.y-Z.startY),n=Z.isDragging,i=n&&(Math.abs(Z.x-Z.startX)>3||Math.abs(Z.y-Z.startY)>3),s=Ur(t);!i&&e&&(Z._vx.reset(),Z._vy.reset(),o&&F&&rr.delayedCall(.08,(function(){if(wr()-ct>300&&!t.defaultPrevented)if(t.target.click)t.target.click();else if(at.createEvent){var e=at.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,ar,1,s.screenX,s.screenY,s.clientX,s.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(e)}}))),Z.isDragging=Z.isGesturing=Z.isPressed=!1,l&&n&&!O&&G.restart(!0),f&&n&&f(Z),v&&v(Z,i)}},yt=function(t){return t.touches&&t.touches.length>1&&(Z.isGesturing=!0)&&D(t,Z.isDragging)},xt=function(){return(Z.isGesturing=!1)||L(Z)},bt=function(t){if(!ut(t)){var e=tt(),n=et();pt((e-nt)*k,(n-it)*k,1),nt=e,it=n,l&&G.restart(!0)}},_t=function(t){if(!ut(t)){t=Ur(t,o),I&&(X=!0);var e=(1===t.deltaMode?s:2===t.deltaMode?ar.innerHeight:1)*u;pt(t.deltaX*e,t.deltaY*e,0),l&&!O&&G.restart(!0)}},wt=function(t){if(!ut(t)){var e=t.clientX,n=t.clientY,i=e-Z.x,r=n-Z.y;Z.x=e,Z.y=n,q=!0,l&&G.restart(!0),(i||r)&&ft(i,r)}},St=function(t){Z.event=t,A(Z)},Mt=function(t){Z.event=t,C(Z)},Tt=function(t){return ut(t)||Ur(t,o)&&U(Z)};G=Z._dc=rr.delayedCall(c||.25,(function(){Z._vx.reset(),Z._vy.reset(),G.pause(),l&&l(Z)})).pause(),Z.deltaX=Z.deltaY=0,Z._vx=Nr(0,50,!0),Z._vy=Nr(0,50,!0),Z.scrollX=tt,Z.scrollY=et,Z.isDragging=Z.isGesturing=Z.isPressed=!1,gr(this),Z.enable=function(t){return Z.isEnabled||(Er(st?at:r,"scroll",Rr),i.indexOf("scroll")>=0&&Er(st?at:r,"scroll",bt,Q,B),i.indexOf("wheel")>=0&&Er(r,"wheel",_t,Q,B),(i.indexOf("touch")>=0&&hr||i.indexOf("pointer")>=0)&&(Er(r,mr[0],gt,Q,B),Er(at,mr[2],vt),Er(at,mr[3],vt),F&&Er(r,"click",ht,!0,!0),U&&Er(r,"click",Tt),D&&Er(at,"gesturestart",yt),L&&Er(at,"gestureend",xt),A&&Er(r,ur+"enter",St),C&&Er(r,ur+"leave",Mt),P&&Er(r,ur+"move",wt)),Z.isEnabled=!0,t&&t.type&&gt(t),z&&z(Z)),Z},Z.disable=function(){Z.isEnabled&&(xr.filter((function(t){return t!==Z&&Tr(t.target)})).length||Ar(st?at:r,"scroll",Rr),Z.isPressed&&(Z._vx.reset(),Z._vy.reset(),Ar(O?r:at,mr[1],mt,!0)),Ar(st?at:r,"scroll",bt,B),Ar(r,"wheel",_t,B),Ar(r,mr[0],gt,B),Ar(at,mr[2],vt),Ar(at,mr[3],vt),Ar(r,"click",ht,!0),Ar(r,"click",Tt),Ar(at,"gesturestart",yt),Ar(at,"gestureend",xt),Ar(r,ur+"enter",St),Ar(r,ur+"leave",Mt),Ar(r,ur+"move",wt),Z.isEnabled=Z.isPressed=Z.isDragging=!1,N&&N(Z))},Z.kill=Z.revert=function(){Z.disable();var t=xr.indexOf(Z);t>=0&&xr.splice(t,1),fr===Z&&(fr=0)},xr.push(Z),O&&Tr(r)&&(fr=Z),Z.enable(d)},e=t,(n=[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}])&&ir(e.prototype,n),i&&ir(e,i),t}();Vr.version="3.12.5",Vr.create=function(t){return new Vr(t)},Vr.register=Fr,Vr.getAll=function(){return xr.slice()},Vr.getById=function(t){return xr.filter((function(e){return e.vars.id===t}))[0]},vr()&&rr.registerPlugin(Vr);var jr,Hr,Gr,Wr,qr,Xr,$r,Yr,Zr,Kr,Jr,Qr,ts,es,ns,is,rs,ss,as,os,ls,cs,hs,us,ds,ps,fs,ms,gs,vs,ys,xs,bs,_s,ws,Ss,Ms,Ts,Es=1,As=Date.now,Cs=As(),Ps=0,Rs=0,Os=function(t,e,n){var i=Ws(t)&&("clamp("===t.substr(0,6)||t.indexOf("max")>-1);return n["_"+e+"Clamp"]=i,i?t.substr(6,t.length-7):t},Ds=function(t,e){return!e||Ws(t)&&"clamp("===t.substr(0,6)?t:"clamp("+t+")"},Ls=function t(){return Rs&&requestAnimationFrame(t)},Is=function(){return es=1},zs=function(){return es=0},Ns=function(t){return t},Us=function(t){return Math.round(1e5*t)/1e5||0},ks=function(){return"undefined"!=typeof window},Bs=function(){return jr||ks()&&(jr=window.gsap)&&jr.registerPlugin&&jr},Fs=function(t){return!!~$r.indexOf(t)},Vs=function(t){return("Height"===t?ys:Gr["inner"+t])||qr["client"+t]||Xr["client"+t]},js=function(t){return Mr(t,"getBoundingClientRect")||(Fs(t)?function(){return eo.width=Gr.innerWidth,eo.height=ys,eo}:function(){return fa(t)})},Hs=function(t,e){var n=e.s,i=e.d2,r=e.d,s=e.a;return Math.max(0,(n="scroll"+i)&&(s=Mr(t,n))?s()-js(t)()[r]:Fs(t)?(qr[n]||Xr[n])-Vs(i):t[n]-t["offset"+i])},Gs=function(t,e){for(var n=0;n<as.length;n+=3)(!e||~e.indexOf(as[n+1]))&&t(as[n],as[n+1],as[n+2])},Ws=function(t){return"string"==typeof t},qs=function(t){return"function"==typeof t},Xs=function(t){return"number"==typeof t},$s=function(t){return"object"==typeof t},Ys=function(t,e,n){return t&&t.progress(e?0:1)&&n&&t.pause()},Zs=function(t,e){if(t.enabled){var n=t._ctx?t._ctx.add((function(){return e(t)})):e(t);n&&n.totalTime&&(t.callbackAnimation=n)}},Ks=Math.abs,Js="left",Qs="right",ta="bottom",ea="width",na="height",ia="Right",ra="Left",sa="Top",aa="Bottom",oa="padding",la="margin",ca="Width",ha="Height",ua="px",da=function(t){return Gr.getComputedStyle(t)},pa=function(t,e){for(var n in e)n in t||(t[n]=e[n]);return t},fa=function(t,e){var n=e&&"matrix(1, 0, 0, 1, 0, 0)"!==da(t)[ns]&&jr.to(t,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),i=t.getBoundingClientRect();return n&&n.progress(0).kill(),i},ma=function(t,e){var n=e.d2;return t["offset"+n]||t["client"+n]||0},ga=function(t){var e,n=[],i=t.labels,r=t.duration();for(e in i)n.push(i[e]/r);return n},va=function(t){var e=jr.utils.snap(t),n=Array.isArray(t)&&t.slice(0).sort((function(t,e){return t-e}));return n?function(t,i,r){var s;if(void 0===r&&(r=.001),!i)return e(t);if(i>0){for(t-=r,s=0;s<n.length;s++)if(n[s]>=t)return n[s];return n[s-1]}for(s=n.length,t+=r;s--;)if(n[s]<=t)return n[s];return n[0]}:function(n,i,r){void 0===r&&(r=.001);var s=e(n);return!i||Math.abs(s-n)<r||s-n<0==i<0?s:e(i<0?n-t:n+t)}},ya=function(t,e,n,i){return n.split(",").forEach((function(n){return t(e,n,i)}))},xa=function(t,e,n,i,r){return t.addEventListener(e,n,{passive:!i,capture:!!r})},ba=function(t,e,n,i){return t.removeEventListener(e,n,!!i)},_a=function(t,e,n){(n=n&&n.wheelHandler)&&(t(e,"wheel",n),t(e,"touchmove",n))},wa={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},Sa={toggleActions:"play",anticipatePin:0},Ma={top:0,left:0,center:.5,bottom:1,right:1},Ta=function(t,e){if(Ws(t)){var n=t.indexOf("="),i=~n?+(t.charAt(n-1)+1)*parseFloat(t.substr(n+1)):0;~n&&(t.indexOf("%")>n&&(i*=e/100),t=t.substr(0,n-1)),t=i+(t in Ma?Ma[t]*e:~t.indexOf("%")?parseFloat(t)*e/100:parseFloat(t)||0)}return t},Ea=function(t,e,n,i,r,s,a,o){var l=r.startColor,c=r.endColor,h=r.fontSize,u=r.indent,d=r.fontWeight,p=Wr.createElement("div"),f=Fs(n)||"fixed"===Mr(n,"pinType"),m=-1!==t.indexOf("scroller"),g=f?Xr:n,v=-1!==t.indexOf("start"),y=v?l:c,x="border-color:"+y+";font-size:"+h+";color:"+y+";font-weight:"+d+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return x+="position:"+((m||o)&&f?"fixed;":"absolute;"),(m||o||!f)&&(x+=(i===Lr?Qs:ta)+":"+(s+parseFloat(u))+"px;"),a&&(x+="box-sizing:border-box;text-align:left;width:"+a.offsetWidth+"px;"),p._isStart=v,p.setAttribute("class","gsap-marker-"+t+(e?" marker-"+e:"")),p.style.cssText=x,p.innerText=e||0===e?t+"-"+e:t,g.children[0]?g.insertBefore(p,g.children[0]):g.appendChild(p),p._offset=p["offset"+i.op.d2],Aa(p,0,i,v),p},Aa=function(t,e,n,i){var r={display:"block"},s=n[i?"os2":"p2"],a=n[i?"p2":"os2"];t._isFlipped=i,r[n.a+"Percent"]=i?-100:0,r[n.a]=i?"1px":0,r["border"+s+ca]=1,r["border"+a+ca]=0,r[n.p]=e+"px",jr.set(t,r)},Ca=[],Pa={},Ra=function(){return As()-Ps>34&&(ws||(ws=requestAnimationFrame($a)))},Oa=function(){(!hs||!hs.isPressed||hs.startX>Xr.clientWidth)&&(br.cache++,hs?ws||(ws=requestAnimationFrame($a)):$a(),Ps||Ua("scrollStart"),Ps=As())},Da=function(){ps=Gr.innerWidth,ds=Gr.innerHeight},La=function(){br.cache++,!ts&&!cs&&!Wr.fullscreenElement&&!Wr.webkitFullscreenElement&&(!us||ps!==Gr.innerWidth||Math.abs(Gr.innerHeight-ds)>.25*Gr.innerHeight)&&Yr.restart(!0)},Ia={},za=[],Na=function t(){return ba(lo,"scrollEnd",t)||Wa(!0)},Ua=function(t){return Ia[t]&&Ia[t].map((function(t){return t()}))||za},ka=[],Ba=function(t){for(var e=0;e<ka.length;e+=5)(!t||ka[e+4]&&ka[e+4].query===t)&&(ka[e].style.cssText=ka[e+1],ka[e].getBBox&&ka[e].setAttribute("transform",ka[e+2]||""),ka[e+3].uncache=1)},Fa=function(t,e){var n;for(is=0;is<Ca.length;is++)!(n=Ca[is])||e&&n._ctx!==e||(t?n.kill(1):n.revert(!0,!0));xs=!0,e&&Ba(e),e||Ua("revert")},Va=function(t,e){br.cache++,(e||!Ss)&&br.forEach((function(t){return qs(t)&&t.cacheID++&&(t.rec=0)})),Ws(t)&&(Gr.history.scrollRestoration=gs=t)},ja=0,Ha=function(){Xr.appendChild(vs),ys=!hs&&vs.offsetHeight||Gr.innerHeight,Xr.removeChild(vs)},Ga=function(t){return Zr(".gsap-marker-start, .gsap-marker-end, .gsap-marker-scroller-start, .gsap-marker-scroller-end").forEach((function(e){return e.style.display=t?"none":"block"}))},Wa=function(t,e){if(!Ps||t||xs){Ha(),Ss=lo.isRefreshing=!0,br.forEach((function(t){return qs(t)&&++t.cacheID&&(t.rec=t())}));var n=Ua("refreshInit");os&&lo.sort(),e||Fa(),br.forEach((function(t){qs(t)&&(t.smooth&&(t.target.style.scrollBehavior="auto"),t(0))})),Ca.slice(0).forEach((function(t){return t.refresh()})),xs=!1,Ca.forEach((function(t){if(t._subPinOffset&&t.pin){var e=t.vars.horizontal?"offsetWidth":"offsetHeight",n=t.pin[e];t.revert(!0,1),t.adjustPinSpacing(t.pin[e]-n),t.refresh()}})),bs=1,Ga(!0),Ca.forEach((function(t){var e=Hs(t.scroller,t._dir),n="max"===t.vars.end||t._endClamp&&t.end>e,i=t._startClamp&&t.start>=e;(n||i)&&t.setPositions(i?e-1:t.start,n?Math.max(i?e:t.start+1,e):t.end,!0)})),Ga(!1),bs=0,n.forEach((function(t){return t&&t.render&&t.render(-1)})),br.forEach((function(t){qs(t)&&(t.smooth&&requestAnimationFrame((function(){return t.target.style.scrollBehavior="smooth"})),t.rec&&t(t.rec))})),Va(gs,1),Yr.pause(),ja++,Ss=2,$a(2),Ca.forEach((function(t){return qs(t.vars.onRefresh)&&t.vars.onRefresh(t)})),Ss=lo.isRefreshing=!1,Ua("refresh")}else xa(lo,"scrollEnd",Na)},qa=0,Xa=1,$a=function(t){if(2===t||!Ss&&!xs){lo.isUpdating=!0,Ts&&Ts.update(0);var e=Ca.length,n=As(),i=n-Cs>=50,r=e&&Ca[0].scroll();if(Xa=qa>r?-1:1,Ss||(qa=r),i&&(Ps&&!es&&n-Ps>200&&(Ps=0,Ua("scrollEnd")),Jr=Cs,Cs=n),Xa<0){for(is=e;is-- >0;)Ca[is]&&Ca[is].update(0,i);Xa=1}else for(is=0;is<e;is++)Ca[is]&&Ca[is].update(0,i);lo.isUpdating=!1}ws=0},Ya=[Js,"top",ta,Qs,la+aa,la+ia,la+sa,la+ra,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],Za=Ya.concat([ea,na,"boxSizing","max"+ca,"max"+ha,"position",la,oa,oa+sa,oa+ia,oa+aa,oa+ra]),Ka=function(t,e,n,i){if(!t._gsap.swappedIn){for(var r,s=Ya.length,a=e.style,o=t.style;s--;)a[r=Ya[s]]=n[r];a.position="absolute"===n.position?"absolute":"relative","inline"===n.display&&(a.display="inline-block"),o[ta]=o[Qs]="auto",a.flexBasis=n.flexBasis||"auto",a.overflow="visible",a.boxSizing="border-box",a[ea]=ma(t,Dr)+ua,a[na]=ma(t,Lr)+ua,a[oa]=o[la]=o.top=o[Js]="0",Qa(i),o[ea]=o["max"+ca]=n[ea],o[na]=o["max"+ha]=n[na],o[oa]=n[oa],t.parentNode!==e&&(t.parentNode.insertBefore(e,t),e.appendChild(t)),t._gsap.swappedIn=!0}},Ja=/([A-Z])/g,Qa=function(t){if(t){var e,n,i=t.t.style,r=t.length,s=0;for((t.t._gsap||jr.core.getCache(t.t)).uncache=1;s<r;s+=2)n=t[s+1],e=t[s],n?i[e]=n:i[e]&&i.removeProperty(e.replace(Ja,"-$1").toLowerCase())}},to=function(t){for(var e=Za.length,n=t.style,i=[],r=0;r<e;r++)i.push(Za[r],n[Za[r]]);return i.t=t,i},eo={left:0,top:0},no=function(t,e,n,i,r,s,a,o,l,c,h,u,d,p){qs(t)&&(t=t(o)),Ws(t)&&"max"===t.substr(0,3)&&(t=u+("="===t.charAt(4)?Ta("0"+t.substr(3),n):0));var f,m,g,v=d?d.time():0;if(d&&d.seek(0),isNaN(t)||(t=+t),Xs(t))d&&(t=jr.utils.mapRange(d.scrollTrigger.start,d.scrollTrigger.end,0,u,t)),a&&Aa(a,n,i,!0);else{qs(e)&&(e=e(o));var y,x,b,_,w=(t||"0").split(" ");g=Ir(e,o)||Xr,(y=fa(g)||{})&&(y.left||y.top)||"none"!==da(g).display||(_=g.style.display,g.style.display="block",y=fa(g),_?g.style.display=_:g.style.removeProperty("display")),x=Ta(w[0],y[i.d]),b=Ta(w[1]||"0",n),t=y[i.p]-l[i.p]-c+x+r-b,a&&Aa(a,b,i,n-b<20||a._isStart&&b>20),n-=n-b}if(p&&(o[p]=t||-.001,t<0&&(t=0)),s){var S=t+n,M=s._isStart;f="scroll"+i.d2,Aa(s,S,i,M&&S>20||!M&&(h?Math.max(Xr[f],qr[f]):s.parentNode[f])<=S+1),h&&(l=fa(a),h&&(s.style[i.op.p]=l[i.op.p]-i.op.m-s._offset+ua))}return d&&g&&(f=fa(g),d.seek(u),m=fa(g),d._caScrollDist=f[i.p]-m[i.p],t=t/d._caScrollDist*u),d&&d.seek(v),d?t:Math.round(t)},io=/(webkit|moz|length|cssText|inset)/i,ro=function(t,e,n,i){if(t.parentNode!==e){var r,s,a=t.style;if(e===Xr){for(r in t._stOrig=a.cssText,s=da(t))+r||io.test(r)||!s[r]||"string"!=typeof a[r]||"0"===r||(a[r]=s[r]);a.top=n,a.left=i}else a.cssText=t._stOrig;jr.core.getCache(t).uncache=1,e.appendChild(t)}},so=function(t,e,n){var i=e,r=i;return function(e){var s=Math.round(t());return s!==i&&s!==r&&Math.abs(s-i)>3&&Math.abs(s-r)>3&&(e=s,n&&n()),r=i,i=e,e}},ao=function(t,e,n){var i={};i[e.p]="+="+n,jr.set(t,i)},oo=function(t,e){var n=zr(t,e),i="_scroll"+e.p2,r=function e(r,s,a,o,l){var c=e.tween,h=s.onComplete,u={};a=a||n();var d=so(n,a,(function(){c.kill(),e.tween=0}));return l=o&&l||0,o=o||r-a,c&&c.kill(),s[i]=r,s.inherit=!1,s.modifiers=u,u[i]=function(){return d(a+o*c.ratio+l*c.ratio*c.ratio)},s.onUpdate=function(){br.cache++,e.tween&&$a()},s.onComplete=function(){e.tween=0,h&&h.call(c)},c=e.tween=jr.to(t,s)};return t[i]=n,n.wheelHandler=function(){return r.tween&&r.tween.kill()&&(r.tween=0)},xa(t,"wheel",n.wheelHandler),lo.isTouch&&xa(t,"touchmove",n.wheelHandler),r},lo=function(){function t(e,n){Hr||t.register(jr)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),ms(this),this.init(e,n)}return t.prototype.init=function(e,n){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),Rs){var i,r,s,a,o,l,c,h,u,d,p,f,m,g,v,y,x,b,_,w,S,M,T,E,A,C,P,R,O,D,L,I,z,N,U,k,B,F,V,j,H,G,W=e=pa(Ws(e)||Xs(e)||e.nodeType?{trigger:e}:e,Sa),q=W.onUpdate,X=W.toggleClass,$=W.id,Y=W.onToggle,Z=W.onRefresh,K=W.scrub,J=W.trigger,Q=W.pin,tt=W.pinSpacing,et=W.invalidateOnRefresh,nt=W.anticipatePin,it=W.onScrubComplete,rt=W.onSnapComplete,st=W.once,at=W.snap,ot=W.pinReparent,lt=W.pinSpacer,ct=W.containerAnimation,ht=W.fastScrollEnd,ut=W.preventOverlaps,dt=e.horizontal||e.containerAnimation&&!1!==e.horizontal?Dr:Lr,pt=!K&&0!==K,ft=Ir(e.scroller||Gr),mt=jr.core.getCache(ft),gt=Fs(ft),vt="fixed"===("pinType"in e?e.pinType:Mr(ft,"pinType")||gt&&"fixed"),yt=[e.onEnter,e.onLeave,e.onEnterBack,e.onLeaveBack],xt=pt&&e.toggleActions.split(" "),bt="markers"in e?e.markers:Sa.markers,_t=gt?0:parseFloat(da(ft)["border"+dt.p2+ca])||0,wt=this,St=e.onRefreshInit&&function(){return e.onRefreshInit(wt)},Mt=function(t,e,n){var i=n.d,r=n.d2,s=n.a;return(s=Mr(t,"getBoundingClientRect"))?function(){return s()[i]}:function(){return(e?Vs(r):t["client"+r])||0}}(ft,gt,dt),Tt=function(t,e){return!e||~_r.indexOf(t)?js(t):function(){return eo}}(ft,gt),Et=0,At=0,Ct=0,Pt=zr(ft,dt);if(wt._startClamp=wt._endClamp=!1,wt._dir=dt,nt*=45,wt.scroller=ft,wt.scroll=ct?ct.time.bind(ct):Pt,a=Pt(),wt.vars=e,n=n||e.animation,"refreshPriority"in e&&(os=1,-9999===e.refreshPriority&&(Ts=wt)),mt.tweenScroll=mt.tweenScroll||{top:oo(ft,Lr),left:oo(ft,Dr)},wt.tweenTo=i=mt.tweenScroll[dt.p],wt.scrubDuration=function(t){(z=Xs(t)&&t)?I?I.duration(t):I=jr.to(n,{ease:"expo",totalProgress:"+=0",inherit:!1,duration:z,paused:!0,onComplete:function(){return it&&it(wt)}}):(I&&I.progress(1).kill(),I=0)},n&&(n.vars.lazy=!1,n._initted&&!wt.isReverted||!1!==n.vars.immediateRender&&!1!==e.immediateRender&&n.duration()&&n.render(0,!0,!0),wt.animation=n.pause(),n.scrollTrigger=wt,wt.scrubDuration(K),D=0,$||($=n.vars.id)),at&&($s(at)&&!at.push||(at={snapTo:at}),"scrollBehavior"in Xr.style&&jr.set(gt?[Xr,qr]:ft,{scrollBehavior:"auto"}),br.forEach((function(t){return qs(t)&&t.target===(gt?Wr.scrollingElement||qr:ft)&&(t.smooth=!1)})),s=qs(at.snapTo)?at.snapTo:"labels"===at.snapTo?function(t){return function(e){return jr.utils.snap(ga(t),e)}}(n):"labelsDirectional"===at.snapTo?(j=n,function(t,e){return va(ga(j))(t,e.direction)}):!1!==at.directional?function(t,e){return va(at.snapTo)(t,As()-At<500?0:e.direction)}:jr.utils.snap(at.snapTo),N=at.duration||{min:.1,max:2},N=$s(N)?Kr(N.min,N.max):Kr(N,N),U=jr.delayedCall(at.delay||z/2||.1,(function(){var t=Pt(),e=As()-At<500,r=i.tween;if(!(e||Math.abs(wt.getVelocity())<10)||r||es||Et===t)wt.isActive&&Et!==t&&U.restart(!0);else{var a,o,h=(t-l)/g,u=n&&!pt?n.totalProgress():h,d=e?0:(u-L)/(As()-Jr)*1e3||0,p=jr.utils.clamp(-h,1-h,Ks(d/2)*d/.185),f=h+(!1===at.inertia?0:p),m=at,v=m.onStart,y=m.onInterrupt,x=m.onComplete;if(a=s(f,wt),Xs(a)||(a=f),o=Math.round(l+a*g),t<=c&&t>=l&&o!==t){if(r&&!r._initted&&r.data<=Ks(o-t))return;!1===at.inertia&&(p=a-h),i(o,{duration:N(Ks(.185*Math.max(Ks(f-u),Ks(a-u))/d/.05||0)),ease:at.ease||"power3",data:Ks(o-t),onInterrupt:function(){return U.restart(!0)&&y&&y(wt)},onComplete:function(){wt.update(),Et=Pt(),n&&(I?I.resetTo("totalProgress",a,n._tTime/n._tDur):n.progress(a)),D=L=n&&!pt?n.totalProgress():wt.progress,rt&&rt(wt),x&&x(wt)}},t,p*g,o-t-p*g),v&&v(wt,i.tween)}}})).pause()),$&&(Pa[$]=wt),(V=(J=wt.trigger=Ir(J||!0!==Q&&Q))&&J._gsap&&J._gsap.stRevert)&&(V=V(wt)),Q=!0===Q?J:Ir(Q),Ws(X)&&(X={targets:J,className:X}),Q&&(!1===tt||tt===la||(tt=!(!tt&&Q.parentNode&&Q.parentNode.style&&"flex"===da(Q.parentNode).display)&&oa),wt.pin=Q,(r=jr.core.getCache(Q)).spacer?v=r.pinState:(lt&&((lt=Ir(lt))&&!lt.nodeType&&(lt=lt.current||lt.nativeElement),r.spacerIsNative=!!lt,lt&&(r.spacerState=to(lt))),r.spacer=b=lt||Wr.createElement("div"),b.classList.add("pin-spacer"),$&&b.classList.add("pin-spacer-"+$),r.pinState=v=to(Q)),!1!==e.force3D&&jr.set(Q,{force3D:!0}),wt.spacer=b=r.spacer,O=da(Q),E=O[tt+dt.os2],w=jr.getProperty(Q),S=jr.quickSetter(Q,dt.a,ua),Ka(Q,b,O),x=to(Q)),bt){f=$s(bt)?pa(bt,wa):wa,d=Ea("scroller-start",$,ft,dt,f,0),p=Ea("scroller-end",$,ft,dt,f,0,d),_=d["offset"+dt.op.d2];var Rt=Ir(Mr(ft,"content")||ft);h=this.markerStart=Ea("start",$,Rt,dt,f,_,0,ct),u=this.markerEnd=Ea("end",$,Rt,dt,f,_,0,ct),ct&&(F=jr.quickSetter([h,u],dt.a,ua)),vt||_r.length&&!0===Mr(ft,"fixedMarkers")||(G=da(H=gt?Xr:ft).position,H.style.position="absolute"===G||"fixed"===G?G:"relative",jr.set([d,p],{force3D:!0}),C=jr.quickSetter(d,dt.a,ua),R=jr.quickSetter(p,dt.a,ua))}if(ct){var Ot=ct.vars.onUpdate,Dt=ct.vars.onUpdateParams;ct.eventCallback("onUpdate",(function(){wt.update(0,0,1),Ot&&Ot.apply(ct,Dt||[])}))}if(wt.previous=function(){return Ca[Ca.indexOf(wt)-1]},wt.next=function(){return Ca[Ca.indexOf(wt)+1]},wt.revert=function(t,e){if(!e)return wt.kill(!0);var i=!1!==t||!wt.enabled,r=ts;i!==wt.isReverted&&(i&&(k=Math.max(Pt(),wt.scroll.rec||0),Ct=wt.progress,B=n&&n.progress()),h&&[h,u,d,p].forEach((function(t){return t.style.display=i?"none":"block"})),i&&(ts=wt,wt.update(i)),!Q||ot&&wt.isActive||(i?function(t,e,n){Qa(n);var i=t._gsap;if(i.spacerIsNative)Qa(i.spacerState);else if(t._gsap.swappedIn){var r=e.parentNode;r&&(r.insertBefore(t,e),r.removeChild(e))}t._gsap.swappedIn=!1}(Q,b,v):Ka(Q,b,da(Q),A)),i||wt.update(i),ts=r,wt.isReverted=i)},wt.refresh=function(r,s,f,_){if(!ts&&wt.enabled||s)if(Q&&r&&Ps)xa(t,"scrollEnd",Na);else{!Ss&&St&&St(wt),ts=wt,i.tween&&!f&&(i.tween.kill(),i.tween=0),I&&I.pause(),et&&n&&n.revert({kill:!1}).invalidate(),wt.isReverted||wt.revert(!0,!0),wt._subPinOffset=!1;var S,E,C,R,O,D,L,z,N,F,V,j,H,G=Mt(),W=Tt(),q=ct?ct.duration():Hs(ft,dt),X=g<=.01,$=0,Y=_||0,K=$s(f)?f.end:e.end,nt=e.endTrigger||J,it=$s(f)?f.start:e.start||(0!==e.start&&J?Q?"0 0":"0 100%":0),rt=wt.pinnedContainer=e.pinnedContainer&&Ir(e.pinnedContainer,wt),st=J&&Math.max(0,Ca.indexOf(wt))||0,at=st;for(bt&&$s(f)&&(j=jr.getProperty(d,dt.p),H=jr.getProperty(p,dt.p));at--;)(D=Ca[at]).end||D.refresh(0,1)||(ts=wt),!(L=D.pin)||L!==J&&L!==Q&&L!==rt||D.isReverted||(F||(F=[]),F.unshift(D),D.revert(!0,!0)),D!==Ca[at]&&(st--,at--);for(qs(it)&&(it=it(wt)),it=Os(it,"start",wt),l=no(it,J,G,dt,Pt(),h,d,wt,W,_t,vt,q,ct,wt._startClamp&&"_startClamp")||(Q?-.001:0),qs(K)&&(K=K(wt)),Ws(K)&&!K.indexOf("+=")&&(~K.indexOf(" ")?K=(Ws(it)?it.split(" ")[0]:"")+K:($=Ta(K.substr(2),G),K=Ws(it)?it:(ct?jr.utils.mapRange(0,ct.duration(),ct.scrollTrigger.start,ct.scrollTrigger.end,l):l)+$,nt=J)),K=Os(K,"end",wt),c=Math.max(l,no(K||(nt?"100% 0":q),nt,G,dt,Pt()+$,u,p,wt,W,_t,vt,q,ct,wt._endClamp&&"_endClamp"))||-.001,$=0,at=st;at--;)(L=(D=Ca[at]).pin)&&D.start-D._pinPush<=l&&!ct&&D.end>0&&(S=D.end-(wt._startClamp?Math.max(0,D.start):D.start),(L===J&&D.start-D._pinPush<l||L===rt)&&isNaN(it)&&($+=S*(1-D.progress)),L===Q&&(Y+=S));if(l+=$,c+=$,wt._startClamp&&(wt._startClamp+=$),wt._endClamp&&!Ss&&(wt._endClamp=c||-.001,c=Math.min(c,Hs(ft,dt))),g=c-l||(l-=.01)&&.001,X&&(Ct=jr.utils.clamp(0,1,jr.utils.normalize(l,c,k))),wt._pinPush=Y,h&&$&&((S={})[dt.a]="+="+$,rt&&(S[dt.p]="-="+Pt()),jr.set([h,u],S)),!Q||bs&&wt.end>=Hs(ft,dt)){if(J&&Pt()&&!ct)for(E=J.parentNode;E&&E!==Xr;)E._pinOffset&&(l-=E._pinOffset,c-=E._pinOffset),E=E.parentNode}else S=da(Q),R=dt===Lr,C=Pt(),M=parseFloat(w(dt.a))+Y,!q&&c>1&&(V={style:V=(gt?Wr.scrollingElement||qr:ft).style,value:V["overflow"+dt.a.toUpperCase()]},gt&&"scroll"!==da(Xr)["overflow"+dt.a.toUpperCase()]&&(V.style["overflow"+dt.a.toUpperCase()]="scroll")),Ka(Q,b,S),x=to(Q),E=fa(Q,!0),z=vt&&zr(ft,R?Dr:Lr)(),tt?((A=[tt+dt.os2,g+Y+ua]).t=b,(at=tt===oa?ma(Q,dt)+g+Y:0)&&(A.push(dt.d,at+ua),"auto"!==b.style.flexBasis&&(b.style.flexBasis=at+ua)),Qa(A),rt&&Ca.forEach((function(t){t.pin===rt&&!1!==t.vars.pinSpacing&&(t._subPinOffset=!0)})),vt&&Pt(k)):(at=ma(Q,dt))&&"auto"!==b.style.flexBasis&&(b.style.flexBasis=at+ua),vt&&((O={top:E.top+(R?C-l:z)+ua,left:E.left+(R?z:C-l)+ua,boxSizing:"border-box",position:"fixed"})[ea]=O["max"+ca]=Math.ceil(E.width)+ua,O[na]=O["max"+ha]=Math.ceil(E.height)+ua,O[la]=O[la+sa]=O[la+ia]=O[la+aa]=O[la+ra]="0",O[oa]=S[oa],O[oa+sa]=S[oa+sa],O[oa+ia]=S[oa+ia],O[oa+aa]=S[oa+aa],O[oa+ra]=S[oa+ra],y=function(t,e,n){for(var i,r=[],s=t.length,a=n?8:0;a<s;a+=2)i=t[a],r.push(i,i in e?e[i]:t[a+1]);return r.t=t.t,r}(v,O,ot),Ss&&Pt(0)),n?(N=n._initted,ls(1),n.render(n.duration(),!0,!0),T=w(dt.a)-M+g+Y,P=Math.abs(g-T)>1,vt&&P&&y.splice(y.length-2,2),n.render(0,!0,!0),N||n.invalidate(!0),n.parent||n.totalTime(n.totalTime()),ls(0)):T=g,V&&(V.value?V.style["overflow"+dt.a.toUpperCase()]=V.value:V.style.removeProperty("overflow-"+dt.a));F&&F.forEach((function(t){return t.revert(!1,!0)})),wt.start=l,wt.end=c,a=o=Ss?k:Pt(),ct||Ss||(a<k&&Pt(k),wt.scroll.rec=0),wt.revert(!1,!0),At=As(),U&&(Et=-1,U.restart(!0)),ts=0,n&&pt&&(n._initted||B)&&n.progress()!==B&&n.progress(B||0,!0).render(n.time(),!0,!0),(X||Ct!==wt.progress||ct||et)&&(n&&!pt&&n.totalProgress(ct&&l<-.001&&!Ct?jr.utils.normalize(l,c,0):Ct,!0),wt.progress=X||(a-l)/g===Ct?0:Ct),Q&&tt&&(b._pinOffset=Math.round(wt.progress*T)),I&&I.invalidate(),isNaN(j)||(j-=jr.getProperty(d,dt.p),H-=jr.getProperty(p,dt.p),ao(d,dt,j),ao(h,dt,j-(_||0)),ao(p,dt,H),ao(u,dt,H-(_||0))),X&&!Ss&&wt.update(),!Z||Ss||m||(m=!0,Z(wt),m=!1)}},wt.getVelocity=function(){return(Pt()-o)/(As()-Jr)*1e3||0},wt.endAnimation=function(){Ys(wt.callbackAnimation),n&&(I?I.progress(1):n.paused()?pt||Ys(n,wt.direction<0,1):Ys(n,n.reversed()))},wt.labelToScroll=function(t){return n&&n.labels&&(l||wt.refresh()||l)+n.labels[t]/n.duration()*g||0},wt.getTrailing=function(t){var e=Ca.indexOf(wt),n=wt.direction>0?Ca.slice(0,e).reverse():Ca.slice(e+1);return(Ws(t)?n.filter((function(e){return e.vars.preventOverlaps===t})):n).filter((function(t){return wt.direction>0?t.end<=l:t.start>=c}))},wt.update=function(t,e,r){if(!ct||r||t){var s,h,u,p,f,m,v,_=!0===Ss?k:wt.scroll(),w=t?0:(_-l)/g,A=w<0?0:w>1?1:w||0,O=wt.progress;if(e&&(o=a,a=ct?Pt():_,at&&(L=D,D=n&&!pt?n.totalProgress():A)),nt&&Q&&!ts&&!Es&&Ps&&(!A&&l<_+(_-o)/(As()-Jr)*nt?A=1e-4:1===A&&c>_+(_-o)/(As()-Jr)*nt&&(A=.9999)),A!==O&&wt.enabled){if(p=(f=(s=wt.isActive=!!A&&A<1)!==(!!O&&O<1))||!!A!=!!O,wt.direction=A>O?1:-1,wt.progress=A,p&&!ts&&(h=A&&!O?0:1===A?1:1===O?2:3,pt&&(u=!f&&"none"!==xt[h+1]&&xt[h+1]||xt[h],v=n&&("complete"===u||"reset"===u||u in n))),ut&&(f||v)&&(v||K||!n)&&(qs(ut)?ut(wt):wt.getTrailing(ut).forEach((function(t){return t.endAnimation()}))),pt||(!I||ts||Es?n&&n.totalProgress(A,!(!ts||!At&&!t)):(I._dp._time-I._start!==I._time&&I.render(I._dp._time-I._start),I.resetTo?I.resetTo("totalProgress",A,n._tTime/n._tDur):(I.vars.totalProgress=A,I.invalidate().restart()))),Q)if(t&&tt&&(b.style[tt+dt.os2]=E),vt){if(p){if(m=!t&&A>O&&c+1>_&&_+1>=Hs(ft,dt),ot)if(t||!s&&!m)ro(Q,b);else{var z=fa(Q,!0),N=_-l;ro(Q,Xr,z.top+(dt===Lr?N:0)+ua,z.left+(dt===Lr?0:N)+ua)}Qa(s||m?y:x),P&&A<1&&s||S(M+(1!==A||m?0:T))}}else S(Us(M+T*A));at&&!i.tween&&!ts&&!Es&&U.restart(!0),X&&(f||st&&A&&(A<1||!_s))&&Zr(X.targets).forEach((function(t){return t.classList[s||st?"add":"remove"](X.className)})),q&&!pt&&!t&&q(wt),p&&!ts?(pt&&(v&&("complete"===u?n.pause().totalProgress(1):"reset"===u?n.restart(!0).pause():"restart"===u?n.restart(!0):n[u]()),q&&q(wt)),!f&&_s||(Y&&f&&Zs(wt,Y),yt[h]&&Zs(wt,yt[h]),st&&(1===A?wt.kill(!1,1):yt[h]=0),f||yt[h=1===A?1:3]&&Zs(wt,yt[h])),ht&&!s&&Math.abs(wt.getVelocity())>(Xs(ht)?ht:2500)&&(Ys(wt.callbackAnimation),I?I.progress(1):Ys(n,"reverse"===u?1:!A,1))):pt&&q&&!ts&&q(wt)}if(R){var B=ct?_/ct.duration()*(ct._caScrollDist||0):_;C(B+(d._isFlipped?1:0)),R(B)}F&&F(-_/ct.duration()*(ct._caScrollDist||0))}},wt.enable=function(e,n){wt.enabled||(wt.enabled=!0,xa(ft,"resize",La),gt||xa(ft,"scroll",Oa),St&&xa(t,"refreshInit",St),!1!==e&&(wt.progress=Ct=0,a=o=Et=Pt()),!1!==n&&wt.refresh())},wt.getTween=function(t){return t&&i?i.tween:I},wt.setPositions=function(t,e,n,i){if(ct){var r=ct.scrollTrigger,s=ct.duration(),a=r.end-r.start;t=r.start+a*t/s,e=r.start+a*e/s}wt.refresh(!1,!1,{start:Ds(t,n&&!!wt._startClamp),end:Ds(e,n&&!!wt._endClamp)},i),wt.update()},wt.adjustPinSpacing=function(t){if(A&&t){var e=A.indexOf(dt.d)+1;A[e]=parseFloat(A[e])+t+ua,A[1]=parseFloat(A[1])+t+ua,Qa(A)}},wt.disable=function(e,n){if(wt.enabled&&(!1!==e&&wt.revert(!0,!0),wt.enabled=wt.isActive=!1,n||I&&I.pause(),k=0,r&&(r.uncache=1),St&&ba(t,"refreshInit",St),U&&(U.pause(),i.tween&&i.tween.kill()&&(i.tween=0)),!gt)){for(var s=Ca.length;s--;)if(Ca[s].scroller===ft&&Ca[s]!==wt)return;ba(ft,"resize",La),gt||ba(ft,"scroll",Oa)}},wt.kill=function(t,i){wt.disable(t,i),I&&!i&&I.kill(),$&&delete Pa[$];var s=Ca.indexOf(wt);s>=0&&Ca.splice(s,1),s===is&&Xa>0&&is--,s=0,Ca.forEach((function(t){return t.scroller===wt.scroller&&(s=1)})),s||Ss||(wt.scroll.rec=0),n&&(n.scrollTrigger=null,t&&n.revert({kill:!1}),i||n.kill()),h&&[h,u,d,p].forEach((function(t){return t.parentNode&&t.parentNode.removeChild(t)})),Ts===wt&&(Ts=0),Q&&(r&&(r.uncache=1),s=0,Ca.forEach((function(t){return t.pin===Q&&s++})),s||(r.spacer=0)),e.onKill&&e.onKill(wt)},Ca.push(wt),wt.enable(!1,!1),V&&V(wt),n&&n.add&&!g){var Lt=wt.update;wt.update=function(){wt.update=Lt,l||c||wt.refresh()},jr.delayedCall(.01,wt.update),g=.01,l=c=0}else wt.refresh();Q&&function(){if(Ms!==ja){var t=Ms=ja;requestAnimationFrame((function(){return t===ja&&Wa(!0)}))}}()}else this.update=this.refresh=this.kill=Ns},t.register=function(e){return Hr||(jr=e||Bs(),ks()&&window.document&&t.enable(),Hr=Rs),Hr},t.defaults=function(t){if(t)for(var e in t)Sa[e]=t[e];return Sa},t.disable=function(t,e){Rs=0,Ca.forEach((function(n){return n[e?"kill":"disable"](t)})),ba(Gr,"wheel",Oa),ba(Wr,"scroll",Oa),clearInterval(Qr),ba(Wr,"touchcancel",Ns),ba(Xr,"touchstart",Ns),ya(ba,Wr,"pointerdown,touchstart,mousedown",Is),ya(ba,Wr,"pointerup,touchend,mouseup",zs),Yr.kill(),Gs(ba);for(var n=0;n<br.length;n+=3)_a(ba,br[n],br[n+1]),_a(ba,br[n],br[n+2])},t.enable=function(){if(Gr=window,Wr=document,qr=Wr.documentElement,Xr=Wr.body,jr&&(Zr=jr.utils.toArray,Kr=jr.utils.clamp,ms=jr.core.context||Ns,ls=jr.core.suppressOverwrites||Ns,gs=Gr.history.scrollRestoration||"auto",qa=Gr.pageYOffset,jr.core.globals("ScrollTrigger",t),Xr)){Rs=1,(vs=document.createElement("div")).style.height="100vh",vs.style.position="absolute",Ha(),Ls(),Vr.register(jr),t.isTouch=Vr.isTouch,fs=Vr.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),us=1===Vr.isTouch,xa(Gr,"wheel",Oa),$r=[Gr,Wr,qr,Xr],jr.matchMedia?(t.matchMedia=function(t){var e,n=jr.matchMedia();for(e in t)n.add(e,t[e]);return n},jr.addEventListener("matchMediaInit",(function(){return Fa()})),jr.addEventListener("matchMediaRevert",(function(){return Ba()})),jr.addEventListener("matchMedia",(function(){Wa(0,1),Ua("matchMedia")})),jr.matchMedia("(orientation: portrait)",(function(){return Da(),Da}))):console.warn("Requires GSAP 3.11.0 or later"),Da(),xa(Wr,"scroll",Oa);var e,n,i=Xr.style,r=i.borderTopStyle,s=jr.core.Animation.prototype;for(s.revert||Object.defineProperty(s,"revert",{value:function(){return this.time(-.01,!0)}}),i.borderTopStyle="solid",e=fa(Xr),Lr.m=Math.round(e.top+Lr.sc())||0,Dr.m=Math.round(e.left+Dr.sc())||0,r?i.borderTopStyle=r:i.removeProperty("border-top-style"),Qr=setInterval(Ra,250),jr.delayedCall(.5,(function(){return Es=0})),xa(Wr,"touchcancel",Ns),xa(Xr,"touchstart",Ns),ya(xa,Wr,"pointerdown,touchstart,mousedown",Is),ya(xa,Wr,"pointerup,touchend,mouseup",zs),ns=jr.utils.checkPrefix("transform"),Za.push(ns),Hr=As(),Yr=jr.delayedCall(.2,Wa).pause(),as=[Wr,"visibilitychange",function(){var t=Gr.innerWidth,e=Gr.innerHeight;Wr.hidden?(rs=t,ss=e):rs===t&&ss===e||La()},Wr,"DOMContentLoaded",Wa,Gr,"load",Wa,Gr,"resize",La],Gs(xa),Ca.forEach((function(t){return t.enable(0,1)})),n=0;n<br.length;n+=3)_a(ba,br[n],br[n+1]),_a(ba,br[n],br[n+2])}},t.config=function(e){"limitCallbacks"in e&&(_s=!!e.limitCallbacks);var n=e.syncInterval;n&&clearInterval(Qr)||(Qr=n)&&setInterval(Ra,n),"ignoreMobileResize"in e&&(us=1===t.isTouch&&e.ignoreMobileResize),"autoRefreshEvents"in e&&(Gs(ba)||Gs(xa,e.autoRefreshEvents||"none"),cs=-1===(e.autoRefreshEvents+"").indexOf("resize"))},t.scrollerProxy=function(t,e){var n=Ir(t),i=br.indexOf(n),r=Fs(n);~i&&br.splice(i,r?6:2),e&&(r?_r.unshift(Gr,e,Xr,e,qr,e):_r.unshift(n,e))},t.clearMatchMedia=function(t){Ca.forEach((function(e){return e._ctx&&e._ctx.query===t&&e._ctx.kill(!0,!0)}))},t.isInViewport=function(t,e,n){var i=(Ws(t)?Ir(t):t).getBoundingClientRect(),r=i[n?ea:na]*e||0;return n?i.right-r>0&&i.left+r<Gr.innerWidth:i.bottom-r>0&&i.top+r<Gr.innerHeight},t.positionInViewport=function(t,e,n){Ws(t)&&(t=Ir(t));var i=t.getBoundingClientRect(),r=i[n?ea:na],s=null==e?r/2:e in Ma?Ma[e]*r:~e.indexOf("%")?parseFloat(e)*r/100:parseFloat(e)||0;return n?(i.left+s)/Gr.innerWidth:(i.top+s)/Gr.innerHeight},t.killAll=function(t){if(Ca.slice(0).forEach((function(t){return"ScrollSmoother"!==t.vars.id&&t.kill()})),!0!==t){var e=Ia.killAll||[];Ia={},e.forEach((function(t){return t()}))}},t}();lo.version="3.12.5",lo.saveStyles=function(t){return t?Zr(t).forEach((function(t){if(t&&t.style){var e=ka.indexOf(t);e>=0&&ka.splice(e,5),ka.push(t,t.style.cssText,t.getBBox&&t.getAttribute("transform"),jr.core.getCache(t),ms())}})):ka},lo.revert=function(t,e){return Fa(!t,e)},lo.create=function(t,e){return new lo(t,e)},lo.refresh=function(t){return t?La():(Hr||lo.register())&&Wa(!0)},lo.update=function(t){return++br.cache&&$a(!0===t?2:0)},lo.clearScrollMemory=Va,lo.maxScroll=function(t,e){return Hs(t,e?Dr:Lr)},lo.getScrollFunc=function(t,e){return zr(Ir(t),e?Dr:Lr)},lo.getById=function(t){return Pa[t]},lo.getAll=function(){return Ca.filter((function(t){return"ScrollSmoother"!==t.vars.id}))},lo.isScrolling=function(){return!!Ps},lo.snapDirectional=va,lo.addEventListener=function(t,e){var n=Ia[t]||(Ia[t]=[]);~n.indexOf(e)||n.push(e)},lo.removeEventListener=function(t,e){var n=Ia[t],i=n&&n.indexOf(e);i>=0&&n.splice(i,1)},lo.batch=function(t,e){var n,i=[],r={},s=e.interval||.016,a=e.batchMax||1e9,o=function(t,e){var n=[],i=[],r=jr.delayedCall(s,(function(){e(n,i),n=[],i=[]})).pause();return function(t){n.length||r.restart(!0),n.push(t.trigger),i.push(t),a<=n.length&&r.progress(1)}};for(n in e)r[n]="on"===n.substr(0,2)&&qs(e[n])&&"onRefreshInit"!==n?o(0,e[n]):e[n];return qs(a)&&(a=a(),xa(lo,"refresh",(function(){return a=e.batchMax()}))),Zr(t).forEach((function(t){var e={};for(n in r)e[n]=r[n];e.trigger=t,i.push(lo.create(e))})),i};var co,ho=function(t,e,n,i){return e>i?t(i):e<0&&t(0),n>i?(i-e)/(n-e):n<0?e/(e-n):1},uo=function t(e,n){!0===n?e.style.removeProperty("touch-action"):e.style.touchAction=!0===n?"auto":n?"pan-"+n+(Vr.isTouch?" pinch-zoom":""):"none",e===qr&&t(Xr,n)},po={auto:1,scroll:1},fo=function(t){var e,n=t.event,i=t.target,r=t.axis,s=(n.changedTouches?n.changedTouches[0]:n).target,a=s._gsap||jr.core.getCache(s),o=As();if(!a._isScrollT||o-a._isScrollT>2e3){for(;s&&s!==Xr&&(s.scrollHeight<=s.clientHeight&&s.scrollWidth<=s.clientWidth||!po[(e=da(s)).overflowY]&&!po[e.overflowX]);)s=s.parentNode;a._isScroll=s&&s!==i&&!Fs(s)&&(po[(e=da(s)).overflowY]||po[e.overflowX]),a._isScrollT=o}(a._isScroll||"x"===r)&&(n.stopPropagation(),n._gsapAllow=!0)},mo=function(t,e,n,i){return Vr.create({target:t,capture:!0,debounce:!1,lockAxis:!0,type:e,onWheel:i=i&&fo,onPress:i,onDrag:i,onScroll:i,onEnable:function(){return n&&xa(Wr,Vr.eventTypes[0],vo,!1,!0)},onDisable:function(){return ba(Wr,Vr.eventTypes[0],vo,!0)}})},go=/(input|label|select|textarea)/i,vo=function(t){var e=go.test(t.target.tagName);(e||co)&&(t._gsapAllow=!0,co=e)},yo=function(t){$s(t)||(t={}),t.preventDefault=t.isNormalizer=t.allowClicks=!0,t.type||(t.type="wheel,touch"),t.debounce=!!t.debounce,t.id=t.id||"normalizer";var e,n,i,r,s,a,o,l,c=t,h=c.normalizeScrollX,u=c.momentum,d=c.allowNestedScroll,p=c.onRelease,f=Ir(t.target)||qr,m=jr.core.globals().ScrollSmoother,g=m&&m.get(),v=fs&&(t.content&&Ir(t.content)||g&&!1!==t.content&&!g.smooth()&&g.content()),y=zr(f,Lr),x=zr(f,Dr),b=1,_=(Vr.isTouch&&Gr.visualViewport?Gr.visualViewport.scale*Gr.visualViewport.width:Gr.outerWidth)/Gr.innerWidth,w=0,S=qs(u)?function(){return u(e)}:function(){return u||2.8},M=mo(f,t.type,!0,d),T=function(){return r=!1},E=Ns,A=Ns,C=function(){n=Hs(f,Lr),A=Kr(fs?1:0,n),h&&(E=Kr(0,Hs(f,Dr))),i=ja},P=function(){v._gsap.y=Us(parseFloat(v._gsap.y)+y.offset)+"px",v.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(v._gsap.y)+", 0, 1)",y.offset=y.cacheID=0},R=function(){C(),s.isActive()&&s.vars.scrollY>n&&(y()>n?s.progress(1)&&y(n):s.resetTo("scrollY",n))};return v&&jr.set(v,{y:"+=0"}),t.ignoreCheck=function(t){return fs&&"touchmove"===t.type&&function(){if(r){requestAnimationFrame(T);var t=Us(e.deltaY/2),n=A(y.v-t);if(v&&n!==y.v+y.offset){y.offset=n-y.v;var i=Us((parseFloat(v&&v._gsap.y)||0)-y.offset);v.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+i+", 0, 1)",v._gsap.y=i+"px",y.cacheID=br.cache,$a()}return!0}y.offset&&P(),r=!0}()||b>1.05&&"touchstart"!==t.type||e.isGesturing||t.touches&&t.touches.length>1},t.onPress=function(){r=!1;var t=b;b=Us((Gr.visualViewport&&Gr.visualViewport.scale||1)/_),s.pause(),t!==b&&uo(f,b>1.01||!h&&"x"),a=x(),o=y(),C(),i=ja},t.onRelease=t.onGestureStart=function(t,e){if(y.offset&&P(),e){br.cache++;var i,r,a=S();h&&(r=(i=x())+.05*a*-t.velocityX/.227,a*=ho(x,i,r,Hs(f,Dr)),s.vars.scrollX=E(r)),r=(i=y())+.05*a*-t.velocityY/.227,a*=ho(y,i,r,Hs(f,Lr)),s.vars.scrollY=A(r),s.invalidate().duration(a).play(.01),(fs&&s.vars.scrollY>=n||i>=n-1)&&jr.to({},{onUpdate:R,duration:a})}else l.restart(!0);p&&p(t)},t.onWheel=function(){s._ts&&s.pause(),As()-w>1e3&&(i=0,w=As())},t.onChange=function(t,e,n,r,s){if(ja!==i&&C(),e&&h&&x(E(r[2]===e?a+(t.startX-t.x):x()+e-r[1])),n){y.offset&&P();var l=s[2]===n,c=l?o+t.startY-t.y:y()+n-s[1],u=A(c);l&&c!==u&&(o+=u-c),y(u)}(n||e)&&$a()},t.onEnable=function(){uo(f,!h&&"x"),lo.addEventListener("refresh",R),xa(Gr,"resize",R),y.smooth&&(y.target.style.scrollBehavior="auto",y.smooth=x.smooth=!1),M.enable()},t.onDisable=function(){uo(f,!0),ba(Gr,"resize",R),lo.removeEventListener("refresh",R),M.kill()},t.lockAxis=!1!==t.lockAxis,(e=new Vr(t)).iOS=fs,fs&&!y()&&y(1),fs&&jr.ticker.add(Ns),l=e._dc,s=jr.to(e,{ease:"power4",paused:!0,inherit:!1,scrollX:h?"+=0.1":"+=0",scrollY:"+=0.1",modifiers:{scrollY:so(y,y(),(function(){return s.pause()}))},onUpdate:$a,onComplete:l.vars.onComplete}),e};lo.sort=function(t){return Ca.sort(t||function(t,e){return-1e6*(t.vars.refreshPriority||0)+t.start-(e.start+-1e6*(e.vars.refreshPriority||0))})},lo.observe=function(t){return new Vr(t)},lo.normalizeScroll=function(t){if(void 0===t)return hs;if(!0===t&&hs)return hs.enable();if(!1===t)return hs&&hs.kill(),void(hs=t);var e=t instanceof Vr?t:yo(t);return hs&&hs.target===e.target&&hs.kill(),Fs(e.target)&&(hs=e),e},lo.core={_getVelocityProp:Nr,_inputObserver:mo,_scrollers:br,_proxies:_r,bridge:{ss:function(){Ps||Ua("scrollStart"),Ps=As()},ref:function(){return ts}}},Bs()&&jr.registerPlugin(lo),nr.registerPlugin(lo);var xo=jQuery;if(!document.body.classList.contains("stop-common")){const Hq=new p({lerp:.2,touchMultiplier:1,smoothTouch:!1,prevent:function(t){return t.classList.contains("freeze")}});function Gq(t){Hq.raf(t),requestAnimationFrame(Gq)}window.lenis=Hq,requestAnimationFrame(Gq),xo(document).on("ready",(function(){document.querySelector(":root").style.setProperty("--vh",window.innerHeight/100+"px"),document.querySelector(":root").style.setProperty("--vhinit",window.innerHeight/100+"px"),xo(window).resize((function(){document.querySelector(":root").style.setProperty("--vh",window.innerHeight/100+"px")}));let t=window.scrollY;window.addEventListener("scroll",(()=>{const e=window.scrollY;Math.abs(e-t)<5||(e>t&&e>0?(Alpine.store("showIsland",!1),xo("body").hasClass("home")?Alpine.store("showSiteTitle",!0):Alpine.store("showSiteTitle",!1)):e<t&&(Alpine.store("showSiteTitle",!0),e<=200&&xo("body").hasClass("single-work")?Alpine.store("showIsland",!1):Alpine.store("showIsland",!0)),t=e)})),setTimeout((()=>{xo(".cky-preference-body-wrapper").attr("data-lenis-prevent","true")}),2e3)}))}var bo,_o,wo,So,Mo=!1,To=!1,Eo=[],Ao=-1;function Co(t){!function(t){Eo.includes(t)||Eo.push(t);To||Mo||(Mo=!0,queueMicrotask(Ro))}(t)}function Po(t){let e=Eo.indexOf(t);-1!==e&&e>Ao&&Eo.splice(e,1)}function Ro(){Mo=!1,To=!0;for(let t=0;t<Eo.length;t++)Eo[t](),Ao=t;Eo.length=0,Ao=-1,To=!1}var Oo=!0;function Do(t){_o=t}function Lo(t,e){let n,i=!0,r=_o((()=>{let r=t();JSON.stringify(r),i?n=r:queueMicrotask((()=>{e(r,n),n=r})),i=!1}));return()=>wo(r)}var Io=[],zo=[],No=[];function Uo(t,e){"function"==typeof e?(t._x_cleanups||(t._x_cleanups=[]),t._x_cleanups.push(e)):(e=t,zo.push(e))}function ko(t){Io.push(t)}function Bo(t,e,n){t._x_attributeCleanups||(t._x_attributeCleanups={}),t._x_attributeCleanups[e]||(t._x_attributeCleanups[e]=[]),t._x_attributeCleanups[e].push(n)}function Fo(t,e){t._x_attributeCleanups&&Object.entries(t._x_attributeCleanups).forEach((([n,i])=>{(void 0===e||e.includes(n))&&(i.forEach((t=>t())),delete t._x_attributeCleanups[n])}))}var Vo=new MutationObserver(Yo),jo=!1;function Ho(){Vo.observe(document,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0}),jo=!0}function Go(){!function(){let t=Vo.takeRecords();Wo.push((()=>t.length>0&&Yo(t)));let e=Wo.length;queueMicrotask((()=>{if(Wo.length===e)for(;Wo.length>0;)Wo.shift()()}))}(),Vo.disconnect(),jo=!1}var Wo=[];function qo(t){if(!jo)return t();Go();let e=t();return Ho(),e}var Xo=!1,$o=[];function Yo(t){if(Xo)return void($o=$o.concat(t));let e=new Set,n=new Set,i=new Map,r=new Map;for(let s=0;s<t.length;s++)if(!t[s].target._x_ignoreMutationObserver&&("childList"===t[s].type&&(t[s].addedNodes.forEach((t=>1===t.nodeType&&e.add(t))),t[s].removedNodes.forEach((t=>1===t.nodeType&&n.add(t)))),"attributes"===t[s].type)){let e=t[s].target,n=t[s].attributeName,a=t[s].oldValue,o=()=>{i.has(e)||i.set(e,[]),i.get(e).push({name:n,value:e.getAttribute(n)})},l=()=>{r.has(e)||r.set(e,[]),r.get(e).push(n)};e.hasAttribute(n)&&null===a?o():e.hasAttribute(n)?(l(),o()):l()}r.forEach(((t,e)=>{Fo(e,t)})),i.forEach(((t,e)=>{Io.forEach((n=>n(e,t)))}));for(let t of n)e.has(t)||zo.forEach((e=>e(t)));e.forEach((t=>{t._x_ignoreSelf=!0,t._x_ignore=!0}));for(let t of e)n.has(t)||t.isConnected&&(delete t._x_ignoreSelf,delete t._x_ignore,No.forEach((e=>e(t))),t._x_ignore=!0,t._x_ignoreSelf=!0);e.forEach((t=>{delete t._x_ignoreSelf,delete t._x_ignore})),e=null,n=null,i=null,r=null}function Zo(t){return Qo(Jo(t))}function Ko(t,e,n){return t._x_dataStack=[e,...Jo(n||t)],()=>{t._x_dataStack=t._x_dataStack.filter((t=>t!==e))}}function Jo(t){return t._x_dataStack?t._x_dataStack:"function"==typeof ShadowRoot&&t instanceof ShadowRoot?Jo(t.host):t.parentNode?Jo(t.parentNode):[]}function Qo(t){return new Proxy({objects:t},tl)}var tl={ownKeys:({objects:t})=>Array.from(new Set(t.flatMap((t=>Object.keys(t))))),has:({objects:t},e)=>e!=Symbol.unscopables&&t.some((t=>Object.prototype.hasOwnProperty.call(t,e)||Reflect.has(t,e))),get:({objects:t},e,n)=>"toJSON"==e?el:Reflect.get(t.find((t=>Reflect.has(t,e)))||{},e,n),set({objects:t},e,n,i){const r=t.find((t=>Object.prototype.hasOwnProperty.call(t,e)))||t[t.length-1],s=Object.getOwnPropertyDescriptor(r,e);return s?.set&&s?.get?s.set.call(i,n)||!0:Reflect.set(r,e,n)}};function el(){return Reflect.ownKeys(this).reduce(((t,e)=>(t[e]=Reflect.get(this,e),t)),{})}function nl(t){let e=(n,i="")=>{Object.entries(Object.getOwnPropertyDescriptors(n)).forEach((([r,{value:s,enumerable:a}])=>{if(!1===a||void 0===s)return;if("object"==typeof s&&null!==s&&s.__v_skip)return;let o=""===i?r:`${i}.${r}`;var l;"object"==typeof s&&null!==s&&s._x_interceptor?n[r]=s.initialize(t,o,r):"object"!=typeof(l=s)||Array.isArray(l)||null===l||s===n||s instanceof Element||e(s,o)}))};return e(t)}function il(t,e=(()=>{})){let n={initialValue:void 0,_x_interceptor:!0,initialize(e,n,i){return t(this.initialValue,(()=>function(t,e){return e.split(".").reduce(((t,e)=>t[e]),t)}(e,n)),(t=>rl(e,n,t)),n,i)}};return e(n),t=>{if("object"==typeof t&&null!==t&&t._x_interceptor){let e=n.initialize.bind(n);n.initialize=(i,r,s)=>{let a=t.initialize(i,r,s);return n.initialValue=a,e(i,r,s)}}else n.initialValue=t;return n}}function rl(t,e,n){if("string"==typeof e&&(e=e.split(".")),1!==e.length){if(0===e.length)throw error;return t[e[0]]||(t[e[0]]={}),rl(t[e[0]],e.slice(1),n)}t[e[0]]=n}var sl={};function al(t,e){sl[t]=e}function ol(t,e){return Object.entries(sl).forEach((([n,i])=>{let r=null;Object.defineProperty(t,`$${n}`,{get:()=>i(e,function(){if(r)return r;{let[t,n]=Al(e);return r={interceptor:il,...t},Uo(e,n),r}}()),enumerable:!1})})),t}function ll(t,e,n,...i){try{return n(...i)}catch(n){cl(n,t,e)}}function cl(t,e,n=void 0){t=Object.assign(t??{message:"No error message given."},{el:e,expression:n}),console.warn(`Alpine Expression Error: ${t.message}\n\n${n?'Expression: "'+n+'"\n\n':""}`,e),setTimeout((()=>{throw t}),0)}var hl=!0;function ul(t){let e=hl;hl=!1;let n=t();return hl=e,n}function dl(t,e,n={}){let i;return pl(t,e)((t=>i=t),n),i}function pl(...t){return fl(...t)}var fl=ml;function ml(t,e){let n={};ol(n,t);let i=[n,...Jo(t)],r="function"==typeof e?function(t,e){return(n=(()=>{}),{scope:i={},params:r=[]}={})=>{vl(n,e.apply(Qo([i,...t]),r))}}(i,e):function(t,e,n){let i=function(t,e){if(gl[t])return gl[t];let n=Object.getPrototypeOf((async function(){})).constructor,i=/^[\n\s]*if.*\(.*\)/.test(t.trim())||/^(let|const)\s/.test(t.trim())?`(async()=>{ ${t} })()`:t;const r=()=>{try{let e=new n(["__self","scope"],`with (scope) { __self.result = ${i} }; __self.finished = true; return __self.result;`);return Object.defineProperty(e,"name",{value:`[Alpine] ${t}`}),e}catch(n){return cl(n,e,t),Promise.resolve()}};let s=r();return gl[t]=s,s}(e,n);return(r=(()=>{}),{scope:s={},params:a=[]}={})=>{i.result=void 0,i.finished=!1;let o=Qo([s,...t]);if("function"==typeof i){let t=i(i,o).catch((t=>cl(t,n,e)));i.finished?(vl(r,i.result,o,a,n),i.result=void 0):t.then((t=>{vl(r,t,o,a,n)})).catch((t=>cl(t,n,e))).finally((()=>i.result=void 0))}}}(i,e,t);return ll.bind(null,t,e,r)}var gl={};function vl(t,e,n,i,r){if(hl&&"function"==typeof e){let s=e.apply(n,i);s instanceof Promise?s.then((e=>vl(t,e,n,i))).catch((t=>cl(t,r,e))):t(s)}else"object"==typeof e&&e instanceof Promise?e.then((e=>t(e))):t(e)}var yl="x-";function xl(t=""){return yl+t}var bl={};function _l(t,e){return bl[t]=e,{before(e){if(!bl[e])return void console.warn(String.raw`Cannot find directive \`${e}\`. \`${t}\` will use the default order of execution`);const n=zl.indexOf(e);zl.splice(n>=0?n:zl.indexOf("DEFAULT"),0,t)}}}function wl(t,e,n){if(e=Array.from(e),t._x_virtualDirectives){let n=Object.entries(t._x_virtualDirectives).map((([t,e])=>({name:t,value:e}))),i=Sl(n);n=n.map((t=>i.find((e=>e.name===t.name))?{name:`x-bind:${t.name}`,value:`"${t.value}"`}:t)),e=e.concat(n)}let i={},r=e.map(Pl(((t,e)=>i[t]=e))).filter(Dl).map(function(t,e){return({name:n,value:i})=>{let r=n.match(Ll()),s=n.match(/:([a-zA-Z0-9\-_:]+)/),a=n.match(/\.[^.\]]+(?=[^\]]*$)/g)||[],o=e||t[n]||n;return{type:r?r[1]:null,value:s?s[1]:null,modifiers:a.map((t=>t.replace(".",""))),expression:i,original:o}}}(i,n)).sort(Nl);return r.map((e=>function(t,e){let n=()=>{},i=bl[e.type]||n,[r,s]=Al(t);Bo(t,e.original,s);let a=()=>{t._x_ignore||t._x_ignoreSelf||(i.inline&&i.inline(t,e,r),i=i.bind(i,t,e,r),Ml?Tl.get(El).push(i):i())};return a.runCleanups=s,a}(t,e)))}function Sl(t){return Array.from(t).map(Pl()).filter((t=>!Dl(t)))}var Ml=!1,Tl=new Map,El=Symbol();function Al(t){let e=[],[n,i]=function(t){let e=()=>{};return[n=>{let i=_o(n);return t._x_effects||(t._x_effects=new Set,t._x_runEffects=()=>{t._x_effects.forEach((t=>t()))}),t._x_effects.add(i),e=()=>{void 0!==i&&(t._x_effects.delete(i),wo(i))},i},()=>{e()}]}(t);e.push(i);return[{Alpine:Dc,effect:n,cleanup:t=>e.push(t),evaluateLater:pl.bind(pl,t),evaluate:dl.bind(dl,t)},()=>e.forEach((t=>t()))]}var Cl=(t,e)=>({name:n,value:i})=>(n.startsWith(t)&&(n=n.replace(t,e)),{name:n,value:i});function Pl(t=(()=>{})){return({name:e,value:n})=>{let{name:i,value:r}=Rl.reduce(((t,e)=>e(t)),{name:e,value:n});return i!==e&&t(i,e),{name:i,value:r}}}var Rl=[];function Ol(t){Rl.push(t)}function Dl({name:t}){return Ll().test(t)}var Ll=()=>new RegExp(`^${yl}([^:^.]+)\\b`);var Il="DEFAULT",zl=["ignore","ref","data","id","anchor","bind","init","for","model","modelable","transition","show","if",Il,"teleport"];function Nl(t,e){let n=-1===zl.indexOf(t.type)?Il:t.type,i=-1===zl.indexOf(e.type)?Il:e.type;return zl.indexOf(n)-zl.indexOf(i)}function Ul(t,e,n={}){t.dispatchEvent(new CustomEvent(e,{detail:n,bubbles:!0,composed:!0,cancelable:!0}))}function kl(t,e){if("function"==typeof ShadowRoot&&t instanceof ShadowRoot)return void Array.from(t.children).forEach((t=>kl(t,e)));let n=!1;if(e(t,(()=>n=!0)),n)return;let i=t.firstElementChild;for(;i;)kl(i,e),i=i.nextElementSibling}function Bl(t,...e){console.warn(`Alpine Warning: ${t}`,...e)}var Fl=!1;var Vl=[],jl=[];function Hl(){return Vl.map((t=>t()))}function Gl(){return Vl.concat(jl).map((t=>t()))}function Wl(t){Vl.push(t)}function ql(t){jl.push(t)}function Xl(t,e=!1){return $l(t,(t=>{if((e?Gl():Hl()).some((e=>t.matches(e))))return!0}))}function $l(t,e){if(t){if(e(t))return t;if(t._x_teleportBack&&(t=t._x_teleportBack),t.parentElement)return $l(t.parentElement,e)}}var Yl=[];function Zl(t,e=kl,n=(()=>{})){!function(t){Ml=!0;let e=Symbol();El=e,Tl.set(e,[]);let n=()=>{for(;Tl.get(e).length;)Tl.get(e).shift()();Tl.delete(e)};t(n),Ml=!1,n()}((()=>{e(t,((t,e)=>{n(t,e),Yl.forEach((n=>n(t,e))),wl(t,t.attributes).forEach((t=>t())),t._x_ignore&&e()}))}))}function Kl(t,e=kl){e(t,(t=>{Fo(t),function(t){if(t._x_cleanups)for(;t._x_cleanups.length;)t._x_cleanups.pop()()}(t)}))}var Jl=[],Ql=!1;function tc(t=(()=>{})){return queueMicrotask((()=>{Ql||setTimeout((()=>{ec()}))})),new Promise((e=>{Jl.push((()=>{t(),e()}))}))}function ec(){for(Ql=!1;Jl.length;)Jl.shift()()}function nc(t,e){return Array.isArray(e)?ic(t,e.join(" ")):"object"==typeof e&&null!==e?function(t,e){let n=t=>t.split(" ").filter(Boolean),i=Object.entries(e).flatMap((([t,e])=>!!e&&n(t))).filter(Boolean),r=Object.entries(e).flatMap((([t,e])=>!e&&n(t))).filter(Boolean),s=[],a=[];return r.forEach((e=>{t.classList.contains(e)&&(t.classList.remove(e),a.push(e))})),i.forEach((e=>{t.classList.contains(e)||(t.classList.add(e),s.push(e))})),()=>{a.forEach((e=>t.classList.add(e))),s.forEach((e=>t.classList.remove(e)))}}(t,e):"function"==typeof e?nc(t,e()):ic(t,e)}function ic(t,e){return e=!0===e?e="":e||"",(e=>(t.classList.add(...e),()=>{t.classList.remove(...e)}))(e.split(" ").filter((e=>!t.classList.contains(e))).filter(Boolean))}function rc(t,e){return"object"==typeof e&&null!==e?function(t,e){let n={};return Object.entries(e).forEach((([e,i])=>{n[e]=t.style[e],e.startsWith("--")||(e=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()),t.style.setProperty(e,i)})),setTimeout((()=>{0===t.style.length&&t.removeAttribute("style")})),()=>{rc(t,n)}}(t,e):function(t,e){let n=t.getAttribute("style",e);return t.setAttribute("style",e),()=>{t.setAttribute("style",n||"")}}(t,e)}function sc(t,e=(()=>{})){let n=!1;return function(){n?e.apply(this,arguments):(n=!0,t.apply(this,arguments))}}function ac(t,e,n={}){t._x_transition||(t._x_transition={enter:{during:n,start:n,end:n},leave:{during:n,start:n,end:n},in(n=(()=>{}),i=(()=>{})){lc(t,e,{during:this.enter.during,start:this.enter.start,end:this.enter.end},n,i)},out(n=(()=>{}),i=(()=>{})){lc(t,e,{during:this.leave.during,start:this.leave.start,end:this.leave.end},n,i)}})}function oc(t){let e=t.parentNode;if(e)return e._x_hidePromise?e:oc(e)}function lc(t,e,{during:n,start:i,end:r}={},s=(()=>{}),a=(()=>{})){if(t._x_transitioning&&t._x_transitioning.cancel(),0===Object.keys(n).length&&0===Object.keys(i).length&&0===Object.keys(r).length)return s(),void a();let o,l,c;!function(t,e){let n,i,r,s=sc((()=>{qo((()=>{n=!0,i||e.before(),r||(e.end(),ec()),e.after(),t.isConnected&&e.cleanup(),delete t._x_transitioning}))}));t._x_transitioning={beforeCancels:[],beforeCancel(t){this.beforeCancels.push(t)},cancel:sc((function(){for(;this.beforeCancels.length;)this.beforeCancels.shift()();s()})),finish:s},qo((()=>{e.start(),e.during()})),Ql=!0,requestAnimationFrame((()=>{if(n)return;let s=1e3*Number(getComputedStyle(t).transitionDuration.replace(/,.*/,"").replace("s","")),a=1e3*Number(getComputedStyle(t).transitionDelay.replace(/,.*/,"").replace("s",""));0===s&&(s=1e3*Number(getComputedStyle(t).animationDuration.replace("s",""))),qo((()=>{e.before()})),i=!0,requestAnimationFrame((()=>{n||(qo((()=>{e.end()})),ec(),setTimeout(t._x_transitioning.finish,s+a),r=!0)}))}))}(t,{start(){o=e(t,i)},during(){l=e(t,n)},before:s,end(){o(),c=e(t,r)},after:a,cleanup(){l(),c()}})}function cc(t,e,n){if(-1===t.indexOf(e))return n;const i=t[t.indexOf(e)+1];if(!i)return n;if("scale"===e&&isNaN(i))return n;if("duration"===e||"delay"===e){let t=i.match(/([0-9]+)ms/);if(t)return t[1]}return"origin"===e&&["top","right","left","center","bottom"].includes(t[t.indexOf(e)+2])?[i,t[t.indexOf(e)+2]].join(" "):i}_l("transition",((t,{value:e,modifiers:n,expression:i},{evaluate:r})=>{"function"==typeof i&&(i=r(i)),!1!==i&&(i&&"boolean"!=typeof i?function(t,e,n){ac(t,nc,"");let i={enter:e=>{t._x_transition.enter.during=e},"enter-start":e=>{t._x_transition.enter.start=e},"enter-end":e=>{t._x_transition.enter.end=e},leave:e=>{t._x_transition.leave.during=e},"leave-start":e=>{t._x_transition.leave.start=e},"leave-end":e=>{t._x_transition.leave.end=e}};i[n](e)}(t,i,e):function(t,e,n){ac(t,rc);let i=!e.includes("in")&&!e.includes("out")&&!n,r=i||e.includes("in")||["enter"].includes(n),s=i||e.includes("out")||["leave"].includes(n);e.includes("in")&&!i&&(e=e.filter(((t,n)=>n<e.indexOf("out"))));e.includes("out")&&!i&&(e=e.filter(((t,n)=>n>e.indexOf("out"))));let a=!e.includes("opacity")&&!e.includes("scale"),o=a||e.includes("opacity"),l=a||e.includes("scale"),c=o?0:1,h=l?cc(e,"scale",95)/100:1,u=cc(e,"delay",0)/1e3,d=cc(e,"origin","center"),p="opacity, transform",f=cc(e,"duration",150)/1e3,m=cc(e,"duration",75)/1e3,g="cubic-bezier(0.4, 0.0, 0.2, 1)";r&&(t._x_transition.enter.during={transformOrigin:d,transitionDelay:`${u}s`,transitionProperty:p,transitionDuration:`${f}s`,transitionTimingFunction:g},t._x_transition.enter.start={opacity:c,transform:`scale(${h})`},t._x_transition.enter.end={opacity:1,transform:"scale(1)"});s&&(t._x_transition.leave.during={transformOrigin:d,transitionDelay:`${u}s`,transitionProperty:p,transitionDuration:`${m}s`,transitionTimingFunction:g},t._x_transition.leave.start={opacity:1,transform:"scale(1)"},t._x_transition.leave.end={opacity:c,transform:`scale(${h})`})}(t,n,e))})),window.Element.prototype._x_toggleAndCascadeWithTransitions=function(t,e,n,i){const r="visible"===document.visibilityState?requestAnimationFrame:setTimeout;let s=()=>r(n);e?t._x_transition&&(t._x_transition.enter||t._x_transition.leave)?t._x_transition.enter&&(Object.entries(t._x_transition.enter.during).length||Object.entries(t._x_transition.enter.start).length||Object.entries(t._x_transition.enter.end).length)?t._x_transition.in(n):s():t._x_transition?t._x_transition.in(n):s():(t._x_hidePromise=t._x_transition?new Promise(((e,n)=>{t._x_transition.out((()=>{}),(()=>e(i))),t._x_transitioning&&t._x_transitioning.beforeCancel((()=>n({isFromCancelledTransition:!0})))})):Promise.resolve(i),queueMicrotask((()=>{let e=oc(t);e?(e._x_hideChildren||(e._x_hideChildren=[]),e._x_hideChildren.push(t)):r((()=>{let e=t=>{let n=Promise.all([t._x_hidePromise,...(t._x_hideChildren||[]).map(e)]).then((([t])=>t?.()));return delete t._x_hidePromise,delete t._x_hideChildren,n};e(t).catch((t=>{if(!t.isFromCancelledTransition)throw t}))}))})))};var hc=!1;function uc(t,e=(()=>{})){return(...n)=>hc?e(...n):t(...n)}var dc=[];function pc(t){dc.push(t)}var fc=!1;function mc(t){let e=_o;Do(((t,n)=>{let i=e(t);return wo(i),()=>{}})),t(),Do(e)}function gc(t,e,n,i=[]){switch(t._x_bindings||(t._x_bindings=bo({})),t._x_bindings[e]=n,e=i.includes("camel")?e.toLowerCase().replace(/-(\w)/g,((t,e)=>e.toUpperCase())):e){case"value":!function(t,e){if("radio"===t.type)void 0===t.attributes.value&&(t.value=e),window.fromModel&&(t.checked="boolean"==typeof e?xc(t.value)===e:yc(t.value,e));else if("checkbox"===t.type)Number.isInteger(e)?t.value=e:Array.isArray(e)||"boolean"==typeof e||[null,void 0].includes(e)?Array.isArray(e)?t.checked=e.some((e=>yc(e,t.value))):t.checked=!!e:t.value=String(e);else if("SELECT"===t.tagName)!function(t,e){const n=[].concat(e).map((t=>t+""));Array.from(t.options).forEach((t=>{t.selected=n.includes(t.value)}))}(t,e);else{if(t.value===e)return;t.value=void 0===e?"":e}}(t,n);break;case"style":!function(t,e){t._x_undoAddedStyles&&t._x_undoAddedStyles();t._x_undoAddedStyles=rc(t,e)}(t,n);break;case"class":!function(t,e){t._x_undoAddedClasses&&t._x_undoAddedClasses();t._x_undoAddedClasses=nc(t,e)}(t,n);break;case"selected":case"checked":!function(t,e,n){vc(t,e,n),function(t,e,n){t[e]!==n&&(t[e]=n)}(t,e,n)}(t,e,n);break;default:vc(t,e,n)}}function vc(t,e,n){[null,void 0,!1].includes(n)&&function(t){return!["aria-pressed","aria-checked","aria-expanded","aria-selected"].includes(t)}(e)?t.removeAttribute(e):(bc(e)&&(n=e),function(t,e,n){t.getAttribute(e)!=n&&t.setAttribute(e,n)}(t,e,n))}function yc(t,e){return t==e}function xc(t){return!![1,"1","true","on","yes",!0].includes(t)||![0,"0","false","off","no",!1].includes(t)&&(t?Boolean(t):null)}function bc(t){return["disabled","checked","required","readonly","open","selected","autofocus","itemscope","multiple","novalidate","allowfullscreen","allowpaymentrequest","formnovalidate","autoplay","controls","loop","muted","playsinline","default","ismap","reversed","async","defer","nomodule"].includes(t)}function _c(t,e,n){let i=t.getAttribute(e);return null===i?"function"==typeof n?n():n:""===i||(bc(e)?!![e,"true"].includes(i):i)}function wc(t,e){var n;return function(){var i=this,r=arguments;clearTimeout(n),n=setTimeout((function(){n=null,t.apply(i,r)}),e)}}function Sc(t,e){let n;return function(){let i=this,r=arguments;n||(t.apply(i,r),n=!0,setTimeout((()=>n=!1),e))}}function Mc({get:t,set:e},{get:n,set:i}){let r,s,a=!0,o=_o((()=>{let o=t(),l=n();if(a)i(Tc(o)),a=!1;else{let t=JSON.stringify(o),n=JSON.stringify(l);t!==r?i(Tc(o)):t!==n&&e(Tc(l))}r=JSON.stringify(t()),s=JSON.stringify(n())}));return()=>{wo(o)}}function Tc(t){return"object"==typeof t?JSON.parse(JSON.stringify(t)):t}var Ec={},Ac=!1;var Cc={};function Pc(t,e,n){let i=[];for(;i.length;)i.pop()();let r=Object.entries(e).map((([t,e])=>({name:t,value:e}))),s=Sl(r);return r=r.map((t=>s.find((e=>e.name===t.name))?{name:`x-bind:${t.name}`,value:`"${t.value}"`}:t)),wl(t,r,n).map((t=>{i.push(t.runCleanups),t()})),()=>{for(;i.length;)i.pop()()}}var Rc={};var Oc={get reactive(){return bo},get release(){return wo},get effect(){return _o},get raw(){return So},version:"3.14.1",flushAndStopDeferringMutations:function(){Xo=!1,Yo($o),$o=[]},dontAutoEvaluateFunctions:ul,disableEffectScheduling:function(t){Oo=!1,t(),Oo=!0},startObservingMutations:Ho,stopObservingMutations:Go,setReactivityEngine:function(t){bo=t.reactive,wo=t.release,_o=e=>t.effect(e,{scheduler:t=>{Oo?Co(t):t()}}),So=t.raw},onAttributeRemoved:Bo,onAttributesAdded:ko,closestDataStack:Jo,skipDuringClone:uc,onlyDuringClone:function(t){return(...e)=>hc&&t(...e)},addRootSelector:Wl,addInitSelector:ql,interceptClone:pc,addScopeToNode:Ko,deferMutations:function(){Xo=!0},mapAttributes:Ol,evaluateLater:pl,interceptInit:function(t){Yl.push(t)},setEvaluator:function(t){fl=t},mergeProxies:Qo,extractProp:function(t,e,n,i=!0){if(t._x_bindings&&void 0!==t._x_bindings[e])return t._x_bindings[e];if(t._x_inlineBindings&&void 0!==t._x_inlineBindings[e]){let n=t._x_inlineBindings[e];return n.extract=i,ul((()=>dl(t,n.expression)))}return _c(t,e,n)},findClosest:$l,onElRemoved:Uo,closestRoot:Xl,destroyTree:Kl,interceptor:il,transition:lc,setStyles:rc,mutateDom:qo,directive:_l,entangle:Mc,throttle:Sc,debounce:wc,evaluate:dl,initTree:Zl,nextTick:tc,prefixed:xl,prefix:function(t){yl=t},plugin:function(t){(Array.isArray(t)?t:[t]).forEach((t=>t(Dc)))},magic:al,store:function(t,e){if(Ac||(Ec=bo(Ec),Ac=!0),void 0===e)return Ec[t];Ec[t]=e,"object"==typeof e&&null!==e&&e.hasOwnProperty("init")&&"function"==typeof e.init&&Ec[t].init(),nl(Ec[t])},start:function(){var t;Fl&&Bl("Alpine has already been initialized on this page. Calling Alpine.start() more than once can cause problems."),Fl=!0,document.body||Bl("Unable to initialize. Trying to load Alpine before `<body>` is available. Did you forget to add `defer` in Alpine's `<script>` tag?"),Ul(document,"alpine:init"),Ul(document,"alpine:initializing"),Ho(),t=t=>Zl(t,kl),No.push(t),Uo((t=>Kl(t))),ko(((t,e)=>{wl(t,e).forEach((t=>t()))})),Array.from(document.querySelectorAll(Gl().join(","))).filter((t=>!Xl(t.parentElement,!0))).forEach((t=>{Zl(t)})),Ul(document,"alpine:initialized"),setTimeout((()=>{[["ui","dialog",["[x-dialog], [x-popover]"]],["anchor","anchor",["[x-anchor]"]],["sort","sort",["[x-sort]"]]].forEach((([t,e,n])=>{var i;i=e,Object.keys(bl).includes(i)||n.some((e=>{if(document.querySelector(e))return Bl(`found "${e}", but missing ${t} plugin`),!0}))}))}))},clone:function(t,e){e._x_dataStack||(e._x_dataStack=t._x_dataStack),hc=!0,fc=!0,mc((()=>{!function(t){let e=!1;Zl(t,((t,n)=>{kl(t,((t,i)=>{if(e&&function(t){return Hl().some((e=>t.matches(e)))}(t))return i();e=!0,n(t,i)}))}))}(e)})),hc=!1,fc=!1},cloneNode:function(t,e){dc.forEach((n=>n(t,e))),hc=!0,mc((()=>{Zl(e,((t,e)=>{e(t,(()=>{}))}))})),hc=!1},bound:function(t,e,n){return t._x_bindings&&void 0!==t._x_bindings[e]?t._x_bindings[e]:_c(t,e,n)},$data:Zo,watch:Lo,walk:kl,data:function(t,e){Rc[t]=e},bind:function(t,e){let n="function"!=typeof e?()=>e:e;return t instanceof Element?Pc(t,n()):(Cc[t]=n,()=>{})}},Dc=Oc;function Lc(t,e){const n=Object.create(null),i=t.split(",");for(let t=0;t<i.length;t++)n[i[t]]=!0;return e?t=>!!n[t.toLowerCase()]:t=>!!n[t]}var Ic,zc=Object.freeze({}),Nc=(Object.freeze([]),Object.prototype.hasOwnProperty),Uc=(t,e)=>Nc.call(t,e),kc=Array.isArray,Bc=t=>"[object Map]"===Hc(t),Fc=t=>"symbol"==typeof t,Vc=t=>null!==t&&"object"==typeof t,jc=Object.prototype.toString,Hc=t=>jc.call(t),Gc=t=>Hc(t).slice(8,-1),Wc=t=>"string"==typeof t&&"NaN"!==t&&"-"!==t[0]&&""+parseInt(t,10)===t,qc=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},Xc=/-(\w)/g,$c=(qc((t=>t.replace(Xc,((t,e)=>e?e.toUpperCase():"")))),/\B([A-Z])/g),Yc=(qc((t=>t.replace($c,"-$1").toLowerCase())),qc((t=>t.charAt(0).toUpperCase()+t.slice(1)))),Zc=(qc((t=>t?`on${Yc(t)}`:"")),(t,e)=>t!==e&&(t==t||e==e)),Kc=new WeakMap,Jc=[],Qc=Symbol("iterate"),th=Symbol("Map key iterate");var eh=0;function nh(t){const{deps:e}=t;if(e.length){for(let n=0;n<e.length;n++)e[n].delete(t);e.length=0}}var ih=!0,rh=[];function sh(){const t=rh.pop();ih=void 0===t||t}function ah(t,e,n){if(!ih||void 0===Ic)return;let i=Kc.get(t);i||Kc.set(t,i=new Map);let r=i.get(n);r||i.set(n,r=new Set),r.has(Ic)||(r.add(Ic),Ic.deps.push(r),Ic.options.onTrack&&Ic.options.onTrack({effect:Ic,target:t,type:e,key:n}))}function oh(t,e,n,i,r,s){const a=Kc.get(t);if(!a)return;const o=new Set,l=t=>{t&&t.forEach((t=>{(t!==Ic||t.allowRecurse)&&o.add(t)}))};if("clear"===e)a.forEach(l);else if("length"===n&&kc(t))a.forEach(((t,e)=>{("length"===e||e>=i)&&l(t)}));else switch(void 0!==n&&l(a.get(n)),e){case"add":kc(t)?Wc(n)&&l(a.get("length")):(l(a.get(Qc)),Bc(t)&&l(a.get(th)));break;case"delete":kc(t)||(l(a.get(Qc)),Bc(t)&&l(a.get(th)));break;case"set":Bc(t)&&l(a.get(Qc))}o.forEach((a=>{a.options.onTrigger&&a.options.onTrigger({effect:a,target:t,key:n,type:e,newValue:i,oldValue:r,oldTarget:s}),a.options.scheduler?a.options.scheduler(a):a()}))}var lh=Lc("__proto__,__v_isRef,__isVue"),ch=new Set(Object.getOwnPropertyNames(Symbol).map((t=>Symbol[t])).filter(Fc)),hh=fh(),uh=fh(!0),dh=ph();function ph(){const t={};return["includes","indexOf","lastIndexOf"].forEach((e=>{t[e]=function(...t){const n=$h(this);for(let t=0,e=this.length;t<e;t++)ah(n,"get",t+"");const i=n[e](...t);return-1===i||!1===i?n[e](...t.map($h)):i}})),["push","pop","shift","unshift","splice"].forEach((e=>{t[e]=function(...t){rh.push(ih),ih=!1;const n=$h(this)[e].apply(this,t);return sh(),n}})),t}function fh(t=!1,e=!1){return function(n,i,r){if("__v_isReactive"===i)return!t;if("__v_isReadonly"===i)return t;if("__v_raw"===i&&r===(t?e?Gh:Hh:e?jh:Vh).get(n))return n;const s=kc(n);if(!t&&s&&Uc(dh,i))return Reflect.get(dh,i,r);const a=Reflect.get(n,i,r);if(Fc(i)?ch.has(i):lh(i))return a;if(t||ah(n,"get",i),e)return a;if(Yh(a)){return!s||!Wc(i)?a.value:a}return Vc(a)?t?qh(a):Wh(a):a}}function mh(t=!1){return function(e,n,i,r){let s=e[n];if(!t&&(i=$h(i),s=$h(s),!kc(e)&&Yh(s)&&!Yh(i)))return s.value=i,!0;const a=kc(e)&&Wc(n)?Number(n)<e.length:Uc(e,n),o=Reflect.set(e,n,i,r);return e===$h(r)&&(a?Zc(i,s)&&oh(e,"set",n,i,s):oh(e,"add",n,i)),o}}var gh={get:hh,set:mh(),deleteProperty:function(t,e){const n=Uc(t,e),i=t[e],r=Reflect.deleteProperty(t,e);return r&&n&&oh(t,"delete",e,void 0,i),r},has:function(t,e){const n=Reflect.has(t,e);return Fc(e)&&ch.has(e)||ah(t,"has",e),n},ownKeys:function(t){return ah(t,"iterate",kc(t)?"length":Qc),Reflect.ownKeys(t)}},vh={get:uh,set:(t,e)=>(console.warn(`Set operation on key "${String(e)}" failed: target is readonly.`,t),!0),deleteProperty:(t,e)=>(console.warn(`Delete operation on key "${String(e)}" failed: target is readonly.`,t),!0)},yh=t=>Vc(t)?Wh(t):t,xh=t=>Vc(t)?qh(t):t,bh=t=>t,_h=t=>Reflect.getPrototypeOf(t);function wh(t,e,n=!1,i=!1){const r=$h(t=t.__v_raw),s=$h(e);e!==s&&!n&&ah(r,"get",e),!n&&ah(r,"get",s);const{has:a}=_h(r),o=i?bh:n?xh:yh;return a.call(r,e)?o(t.get(e)):a.call(r,s)?o(t.get(s)):void(t!==r&&t.get(e))}function Sh(t,e=!1){const n=this.__v_raw,i=$h(n),r=$h(t);return t!==r&&!e&&ah(i,"has",t),!e&&ah(i,"has",r),t===r?n.has(t):n.has(t)||n.has(r)}function Mh(t,e=!1){return t=t.__v_raw,!e&&ah($h(t),"iterate",Qc),Reflect.get(t,"size",t)}function Th(t){t=$h(t);const e=$h(this);return _h(e).has.call(e,t)||(e.add(t),oh(e,"add",t,t)),this}function Eh(t,e){e=$h(e);const n=$h(this),{has:i,get:r}=_h(n);let s=i.call(n,t);s?Fh(n,i,t):(t=$h(t),s=i.call(n,t));const a=r.call(n,t);return n.set(t,e),s?Zc(e,a)&&oh(n,"set",t,e,a):oh(n,"add",t,e),this}function Ah(t){const e=$h(this),{has:n,get:i}=_h(e);let r=n.call(e,t);r?Fh(e,n,t):(t=$h(t),r=n.call(e,t));const s=i?i.call(e,t):void 0,a=e.delete(t);return r&&oh(e,"delete",t,void 0,s),a}function Ch(){const t=$h(this),e=0!==t.size,n=Bc(t)?new Map(t):new Set(t),i=t.clear();return e&&oh(t,"clear",void 0,void 0,n),i}function Ph(t,e){return function(n,i){const r=this,s=r.__v_raw,a=$h(s),o=e?bh:t?xh:yh;return!t&&ah(a,"iterate",Qc),s.forEach(((t,e)=>n.call(i,o(t),o(e),r)))}}function Rh(t,e,n){return function(...i){const r=this.__v_raw,s=$h(r),a=Bc(s),o="entries"===t||t===Symbol.iterator&&a,l="keys"===t&&a,c=r[t](...i),h=n?bh:e?xh:yh;return!e&&ah(s,"iterate",l?th:Qc),{next(){const{value:t,done:e}=c.next();return e?{value:t,done:e}:{value:o?[h(t[0]),h(t[1])]:h(t),done:e}},[Symbol.iterator](){return this}}}}function Oh(t){return function(...e){{const n=e[0]?`on key "${e[0]}" `:"";console.warn(`${Yc(t)} operation ${n}failed: target is readonly.`,$h(this))}return"delete"!==t&&this}}function Dh(){const t={get(t){return wh(this,t)},get size(){return Mh(this)},has:Sh,add:Th,set:Eh,delete:Ah,clear:Ch,forEach:Ph(!1,!1)},e={get(t){return wh(this,t,!1,!0)},get size(){return Mh(this)},has:Sh,add:Th,set:Eh,delete:Ah,clear:Ch,forEach:Ph(!1,!0)},n={get(t){return wh(this,t,!0)},get size(){return Mh(this,!0)},has(t){return Sh.call(this,t,!0)},add:Oh("add"),set:Oh("set"),delete:Oh("delete"),clear:Oh("clear"),forEach:Ph(!0,!1)},i={get(t){return wh(this,t,!0,!0)},get size(){return Mh(this,!0)},has(t){return Sh.call(this,t,!0)},add:Oh("add"),set:Oh("set"),delete:Oh("delete"),clear:Oh("clear"),forEach:Ph(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach((r=>{t[r]=Rh(r,!1,!1),n[r]=Rh(r,!0,!1),e[r]=Rh(r,!1,!0),i[r]=Rh(r,!0,!0)})),[t,n,e,i]}var[Lh,Ih,zh,Nh]=Dh();function Uh(t,e){const n=e?t?Nh:zh:t?Ih:Lh;return(e,i,r)=>"__v_isReactive"===i?!t:"__v_isReadonly"===i?t:"__v_raw"===i?e:Reflect.get(Uc(n,i)&&i in e?n:e,i,r)}var kh={get:Uh(!1,!1)},Bh={get:Uh(!0,!1)};function Fh(t,e,n){const i=$h(n);if(i!==n&&e.call(t,i)){const e=Gc(t);console.warn(`Reactive ${e} contains both the raw and reactive versions of the same object${"Map"===e?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}var Vh=new WeakMap,jh=new WeakMap,Hh=new WeakMap,Gh=new WeakMap;function Wh(t){return t&&t.__v_isReadonly?t:Xh(t,!1,gh,kh,Vh)}function qh(t){return Xh(t,!0,vh,Bh,Hh)}function Xh(t,e,n,i,r){if(!Vc(t))return console.warn(`value cannot be made reactive: ${String(t)}`),t;if(t.__v_raw&&(!e||!t.__v_isReactive))return t;const s=r.get(t);if(s)return s;const a=(o=t).__v_skip||!Object.isExtensible(o)?0:function(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(Gc(o));var o;if(0===a)return t;const l=new Proxy(t,2===a?i:n);return r.set(t,l),l}function $h(t){return t&&$h(t.__v_raw)||t}function Yh(t){return Boolean(t&&!0===t.__v_isRef)}al("nextTick",(()=>tc)),al("dispatch",(t=>Ul.bind(Ul,t))),al("watch",((t,{evaluateLater:e,cleanup:n})=>(t,i)=>{let r=e(t),s=Lo((()=>{let t;return r((e=>t=e)),t}),i);n(s)})),al("store",(function(){return Ec})),al("data",(t=>Zo(t))),al("root",(t=>Xl(t))),al("refs",(t=>(t._x_refs_proxy||(t._x_refs_proxy=Qo(function(t){let e=[];return $l(t,(t=>{t._x_refs&&e.push(t._x_refs)})),e}(t))),t._x_refs_proxy)));var Zh={};function Kh(t){return Zh[t]||(Zh[t]=0),++Zh[t]}function Jh(t,e,n){al(e,(i=>Bl(`You can't use [$${e}] without first installing the "${t}" plugin here: https://alpinejs.dev/plugins/${n}`,i)))}al("id",((t,{cleanup:e})=>(n,i=null)=>function(t,e,n,i){t._x_id||(t._x_id={});if(t._x_id[e])return t._x_id[e];let r=i();return t._x_id[e]=r,n((()=>{delete t._x_id[e]})),r}(t,`${n}${i?`-${i}`:""}`,e,(()=>{let e=function(t,e){return $l(t,(t=>{if(t._x_ids&&t._x_ids[e])return!0}))}(t,n),r=e?e._x_ids[n]:Kh(n);return i?`${n}-${r}-${i}`:`${n}-${r}`})))),pc(((t,e)=>{t._x_id&&(e._x_id=t._x_id)})),al("el",(t=>t)),Jh("Focus","focus","focus"),Jh("Persist","persist","persist"),_l("modelable",((t,{expression:e},{effect:n,evaluateLater:i,cleanup:r})=>{let s=i(e),a=()=>{let t;return s((e=>t=e)),t},o=i(`${e} = __placeholder`),l=t=>o((()=>{}),{scope:{__placeholder:t}}),c=a();l(c),queueMicrotask((()=>{if(!t._x_model)return;t._x_removeModelListeners.default();let e=t._x_model.get,n=t._x_model.set,i=Mc({get:()=>e(),set(t){n(t)}},{get:()=>a(),set(t){l(t)}});r(i)}))})),_l("teleport",((t,{modifiers:e,expression:n},{cleanup:i})=>{"template"!==t.tagName.toLowerCase()&&Bl("x-teleport can only be used on a <template> tag",t);let r=tu(n),s=t.content.cloneNode(!0).firstElementChild;t._x_teleport=s,s._x_teleportBack=t,t.setAttribute("data-teleport-template",!0),s.setAttribute("data-teleport-target",!0),t._x_forwardEvents&&t._x_forwardEvents.forEach((e=>{s.addEventListener(e,(e=>{e.stopPropagation(),t.dispatchEvent(new e.constructor(e.type,e))}))})),Ko(s,{},t);let a=(t,e,n)=>{n.includes("prepend")?e.parentNode.insertBefore(t,e):n.includes("append")?e.parentNode.insertBefore(t,e.nextSibling):e.appendChild(t)};qo((()=>{a(s,r,e),uc((()=>{Zl(s),s._x_ignore=!0}))()})),t._x_teleportPutBack=()=>{let i=tu(n);qo((()=>{a(t._x_teleport,i,e)}))},i((()=>s.remove()))}));var Qh=document.createElement("div");function tu(t){let e=uc((()=>document.querySelector(t)),(()=>Qh))();return e||Bl(`Cannot find x-teleport element for selector: "${t}"`),e}var eu=()=>{};function nu(t,e,n,i){let r=t,s=t=>i(t),a={},o=(t,e)=>n=>e(t,n);if(n.includes("dot")&&(e=e.replace(/-/g,".")),n.includes("camel")&&(e=function(t){return t.toLowerCase().replace(/-(\w)/g,((t,e)=>e.toUpperCase()))}(e)),n.includes("passive")&&(a.passive=!0),n.includes("capture")&&(a.capture=!0),n.includes("window")&&(r=window),n.includes("document")&&(r=document),n.includes("debounce")){let t=n[n.indexOf("debounce")+1]||"invalid-wait",e=iu(t.split("ms")[0])?Number(t.split("ms")[0]):250;s=wc(s,e)}if(n.includes("throttle")){let t=n[n.indexOf("throttle")+1]||"invalid-wait",e=iu(t.split("ms")[0])?Number(t.split("ms")[0]):250;s=Sc(s,e)}return n.includes("prevent")&&(s=o(s,((t,e)=>{e.preventDefault(),t(e)}))),n.includes("stop")&&(s=o(s,((t,e)=>{e.stopPropagation(),t(e)}))),n.includes("once")&&(s=o(s,((t,n)=>{t(n),r.removeEventListener(e,s,a)}))),(n.includes("away")||n.includes("outside"))&&(r=document,s=o(s,((e,n)=>{t.contains(n.target)||!1!==n.target.isConnected&&(t.offsetWidth<1&&t.offsetHeight<1||!1!==t._x_isShown&&e(n))}))),n.includes("self")&&(s=o(s,((e,n)=>{n.target===t&&e(n)}))),(function(t){return["keydown","keyup"].includes(t)}(e)||ru(e))&&(s=o(s,((t,e)=>{(function(t,e){let n=e.filter((t=>!["window","document","prevent","stop","once","capture","self","away","outside","passive"].includes(t)));if(n.includes("debounce")){let t=n.indexOf("debounce");n.splice(t,iu((n[t+1]||"invalid-wait").split("ms")[0])?2:1)}if(n.includes("throttle")){let t=n.indexOf("throttle");n.splice(t,iu((n[t+1]||"invalid-wait").split("ms")[0])?2:1)}if(0===n.length)return!1;if(1===n.length&&su(t.key).includes(n[0]))return!1;const i=["ctrl","shift","alt","meta","cmd","super"].filter((t=>n.includes(t)));if(n=n.filter((t=>!i.includes(t))),i.length>0){if(i.filter((e=>("cmd"!==e&&"super"!==e||(e="meta"),t[`${e}Key`]))).length===i.length){if(ru(t.type))return!1;if(su(t.key).includes(n[0]))return!1}}return!0})(e,n)||t(e)}))),r.addEventListener(e,s,a),()=>{r.removeEventListener(e,s,a)}}function iu(t){return!Array.isArray(t)&&!isNaN(t)}function ru(t){return["contextmenu","click","mouse"].some((e=>t.includes(e)))}function su(t){if(!t)return[];var e;t=[" ","_"].includes(e=t)?e:e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[_\s]/,"-").toLowerCase();let n={ctrl:"control",slash:"/",space:" ",spacebar:" ",cmd:"meta",esc:"escape",up:"arrow-up",down:"arrow-down",left:"arrow-left",right:"arrow-right",period:".",comma:",",equal:"=",minus:"-",underscore:"_"};return n[t]=t,Object.keys(n).map((e=>{if(n[e]===t)return e})).filter((t=>t))}function au(t,e,n,i){return qo((()=>{if(n instanceof CustomEvent&&void 0!==n.detail)return null!==n.detail&&void 0!==n.detail?n.detail:n.target.value;if("checkbox"===t.type){if(Array.isArray(i)){let t=null;return t=e.includes("number")?ou(n.target.value):e.includes("boolean")?xc(n.target.value):n.target.value,n.target.checked?i.includes(t)?i:i.concat([t]):i.filter((e=>!(e==t)))}return n.target.checked}if("select"===t.tagName.toLowerCase()&&t.multiple)return e.includes("number")?Array.from(n.target.selectedOptions).map((t=>ou(t.value||t.text))):e.includes("boolean")?Array.from(n.target.selectedOptions).map((t=>xc(t.value||t.text))):Array.from(n.target.selectedOptions).map((t=>t.value||t.text));{let r;return r="radio"===t.type?n.target.checked?n.target.value:i:n.target.value,e.includes("number")?ou(r):e.includes("boolean")?xc(r):e.includes("trim")?r.trim():r}}))}function ou(t){let e=t?parseFloat(t):null;return n=e,Array.isArray(n)||isNaN(n)?t:e;var n}function lu(t){return null!==t&&"object"==typeof t&&"function"==typeof t.get&&"function"==typeof t.set}eu.inline=(t,{modifiers:e},{cleanup:n})=>{e.includes("self")?t._x_ignoreSelf=!0:t._x_ignore=!0,n((()=>{e.includes("self")?delete t._x_ignoreSelf:delete t._x_ignore}))},_l("ignore",eu),_l("effect",uc(((t,{expression:e},{effect:n})=>{n(pl(t,e))}))),_l("model",((t,{modifiers:e,expression:n},{effect:i,cleanup:r})=>{let s=t;e.includes("parent")&&(s=t.parentNode);let a,o=pl(s,n);a="string"==typeof n?pl(s,`${n} = __placeholder`):"function"==typeof n&&"string"==typeof n()?pl(s,`${n()} = __placeholder`):()=>{};let l=()=>{let t;return o((e=>t=e)),lu(t)?t.get():t},c=t=>{let e;o((t=>e=t)),lu(e)?e.set(t):a((()=>{}),{scope:{__placeholder:t}})};"string"==typeof n&&"radio"===t.type&&qo((()=>{t.hasAttribute("name")||t.setAttribute("name",n)}));var h="select"===t.tagName.toLowerCase()||["checkbox","radio"].includes(t.type)||e.includes("lazy")?"change":"input";let u=hc?()=>{}:nu(t,h,e,(n=>{c(au(t,e,n,l()))}));if(e.includes("fill")&&([void 0,null,""].includes(l())||"checkbox"===t.type&&Array.isArray(l())||"select"===t.tagName.toLowerCase()&&t.multiple)&&c(au(t,e,{target:t},l())),t._x_removeModelListeners||(t._x_removeModelListeners={}),t._x_removeModelListeners.default=u,r((()=>t._x_removeModelListeners.default())),t.form){let n=nu(t.form,"reset",[],(n=>{tc((()=>t._x_model&&t._x_model.set(au(t,e,{target:t},l()))))}));r((()=>n()))}t._x_model={get:()=>l(),set(t){c(t)}},t._x_forceModelUpdate=e=>{void 0===e&&"string"==typeof n&&n.match(/\./)&&(e=""),window.fromModel=!0,qo((()=>gc(t,"value",e))),delete window.fromModel},i((()=>{let n=l();e.includes("unintrusive")&&document.activeElement.isSameNode(t)||t._x_forceModelUpdate(n)}))})),_l("cloak",(t=>queueMicrotask((()=>qo((()=>t.removeAttribute(xl("cloak")))))))),ql((()=>`[${xl("init")}]`)),_l("init",uc(((t,{expression:e},{evaluate:n})=>"string"==typeof e?!!e.trim()&&n(e,{},!1):n(e,{},!1)))),_l("text",((t,{expression:e},{effect:n,evaluateLater:i})=>{let r=i(e);n((()=>{r((e=>{qo((()=>{t.textContent=e}))}))}))})),_l("html",((t,{expression:e},{effect:n,evaluateLater:i})=>{let r=i(e);n((()=>{r((e=>{qo((()=>{t.innerHTML=e,t._x_ignoreSelf=!0,Zl(t),delete t._x_ignoreSelf}))}))}))})),Ol(Cl(":",xl("bind:")));var cu=(t,{value:e,modifiers:n,expression:i,original:r},{effect:s,cleanup:a})=>{if(!e){let e={};return o=e,Object.entries(Cc).forEach((([t,e])=>{Object.defineProperty(o,t,{get:()=>(...t)=>e(...t)})})),void pl(t,i)((e=>{Pc(t,e,r)}),{scope:e})}var o;if("key"===e)return function(t,e){t._x_keyExpression=e}(t,i);if(t._x_inlineBindings&&t._x_inlineBindings[e]&&t._x_inlineBindings[e].extract)return;let l=pl(t,i);s((()=>l((r=>{void 0===r&&"string"==typeof i&&i.match(/\./)&&(r=""),qo((()=>gc(t,e,r,n)))})))),a((()=>{t._x_undoAddedClasses&&t._x_undoAddedClasses(),t._x_undoAddedStyles&&t._x_undoAddedStyles()}))};function hu(t,e,n,i){let r={};if(/^\[.*\]$/.test(t.item)&&Array.isArray(e)){let n=t.item.replace("[","").replace("]","").split(",").map((t=>t.trim()));n.forEach(((t,n)=>{r[t]=e[n]}))}else if(/^\{.*\}$/.test(t.item)&&!Array.isArray(e)&&"object"==typeof e){let n=t.item.replace("{","").replace("}","").split(",").map((t=>t.trim()));n.forEach((t=>{r[t]=e[t]}))}else r[t.item]=e;return t.index&&(r[t.index]=n),t.collection&&(r[t.collection]=i),r}function uu(){}function du(t,e,n){_l(e,(i=>Bl(`You can't use [x-${e}] without first installing the "${t}" plugin here: https://alpinejs.dev/plugins/${n}`,i)))}cu.inline=(t,{value:e,modifiers:n,expression:i})=>{e&&(t._x_inlineBindings||(t._x_inlineBindings={}),t._x_inlineBindings[e]={expression:i,extract:!1})},_l("bind",cu),Wl((()=>`[${xl("data")}]`)),_l("data",((t,{expression:e},{cleanup:n})=>{if(function(t){return!!hc&&(!!fc||t.hasAttribute("data-has-alpine-state"))}(t))return;e=""===e?"{}":e;let i={};ol(i,t);let r={};var s,a;s=r,a=i,Object.entries(Rc).forEach((([t,e])=>{Object.defineProperty(s,t,{get:()=>(...t)=>e.bind(a)(...t),enumerable:!1})}));let o=dl(t,e,{scope:r});void 0!==o&&!0!==o||(o={}),ol(o,t);let l=bo(o);nl(l);let c=Ko(t,l);l.init&&dl(t,l.init),n((()=>{l.destroy&&dl(t,l.destroy),c()}))})),pc(((t,e)=>{t._x_dataStack&&(e._x_dataStack=t._x_dataStack,e.setAttribute("data-has-alpine-state",!0))})),_l("show",((t,{modifiers:e,expression:n},{effect:i})=>{let r=pl(t,n);t._x_doHide||(t._x_doHide=()=>{qo((()=>{t.style.setProperty("display","none",e.includes("important")?"important":void 0)}))}),t._x_doShow||(t._x_doShow=()=>{qo((()=>{1===t.style.length&&"none"===t.style.display?t.removeAttribute("style"):t.style.removeProperty("display")}))});let s,a=()=>{t._x_doHide(),t._x_isShown=!1},o=()=>{t._x_doShow(),t._x_isShown=!0},l=()=>setTimeout(o),c=sc((t=>t?o():a()),(e=>{"function"==typeof t._x_toggleAndCascadeWithTransitions?t._x_toggleAndCascadeWithTransitions(t,e,o,a):e?l():a()})),h=!0;i((()=>r((t=>{(h||t!==s)&&(e.includes("immediate")&&(t?l():a()),c(t),s=t,h=!1)}))))})),_l("for",((t,{expression:e},{effect:n,cleanup:i})=>{let r=function(t){let e=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,n=/^\s*\(|\)\s*$/g,i=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,r=t.match(i);if(!r)return;let s={};s.items=r[2].trim();let a=r[1].replace(n,"").trim(),o=a.match(e);o?(s.item=a.replace(e,"").trim(),s.index=o[1].trim(),o[2]&&(s.collection=o[2].trim())):s.item=a;return s}(e),s=pl(t,r.items),a=pl(t,t._x_keyExpression||"index");t._x_prevKeys=[],t._x_lookup={},n((()=>function(t,e,n,i){let r=t=>"object"==typeof t&&!Array.isArray(t),s=t;n((n=>{var a;a=n,!Array.isArray(a)&&!isNaN(a)&&n>=0&&(n=Array.from(Array(n).keys(),(t=>t+1))),void 0===n&&(n=[]);let o=t._x_lookup,l=t._x_prevKeys,c=[],h=[];if(r(n))n=Object.entries(n).map((([r,s])=>{let a=hu(e,s,r,n);i((e=>{h.includes(e)&&Bl("Duplicate key on x-for",t),h.push(e)}),{scope:{index:r,...a}}),c.push(a)}));else for(let r=0;r<n.length;r++){let s=hu(e,n[r],r,n);i((e=>{h.includes(e)&&Bl("Duplicate key on x-for",t),h.push(e)}),{scope:{index:r,...s}}),c.push(s)}let u=[],d=[],p=[],f=[];for(let t=0;t<l.length;t++){let e=l[t];-1===h.indexOf(e)&&p.push(e)}l=l.filter((t=>!p.includes(t)));let m="template";for(let t=0;t<h.length;t++){let e=h[t],n=l.indexOf(e);if(-1===n)l.splice(t,0,e),u.push([m,t]);else if(n!==t){let e=l.splice(t,1)[0],i=l.splice(n-1,1)[0];l.splice(t,0,i),l.splice(n,0,e),d.push([e,i])}else f.push(e);m=e}for(let t=0;t<p.length;t++){let e=p[t];o[e]._x_effects&&o[e]._x_effects.forEach(Po),o[e].remove(),o[e]=null,delete o[e]}for(let t=0;t<d.length;t++){let[e,n]=d[t],i=o[e],r=o[n],a=document.createElement("div");qo((()=>{r||Bl('x-for ":key" is undefined or invalid',s,n,o),r.after(a),i.after(r),r._x_currentIfEl&&r.after(r._x_currentIfEl),a.before(i),i._x_currentIfEl&&i.after(i._x_currentIfEl),a.remove()})),r._x_refreshXForScope(c[h.indexOf(n)])}for(let t=0;t<u.length;t++){let[e,n]=u[t],i="template"===e?s:o[e];i._x_currentIfEl&&(i=i._x_currentIfEl);let r=c[n],a=h[n],l=document.importNode(s.content,!0).firstElementChild,d=bo(r);Ko(l,d,s),l._x_refreshXForScope=t=>{Object.entries(t).forEach((([t,e])=>{d[t]=e}))},qo((()=>{i.after(l),uc((()=>Zl(l)))()})),"object"==typeof a&&Bl("x-for key cannot be an object, it must be a string or an integer",s),o[a]=l}for(let t=0;t<f.length;t++)o[f[t]]._x_refreshXForScope(c[h.indexOf(f[t])]);s._x_prevKeys=h}))}(t,r,s,a))),i((()=>{Object.values(t._x_lookup).forEach((t=>t.remove())),delete t._x_prevKeys,delete t._x_lookup}))})),uu.inline=(t,{expression:e},{cleanup:n})=>{let i=Xl(t);i._x_refs||(i._x_refs={}),i._x_refs[e]=t,n((()=>delete i._x_refs[e]))},_l("ref",uu),_l("if",((t,{expression:e},{effect:n,cleanup:i})=>{"template"!==t.tagName.toLowerCase()&&Bl("x-if can only be used on a <template> tag",t);let r=pl(t,e);n((()=>r((e=>{e?(()=>{if(t._x_currentIfEl)return t._x_currentIfEl;let e=t.content.cloneNode(!0).firstElementChild;Ko(e,{},t),qo((()=>{t.after(e),uc((()=>Zl(e)))()})),t._x_currentIfEl=e,t._x_undoIf=()=>{kl(e,(t=>{t._x_effects&&t._x_effects.forEach(Po)})),e.remove(),delete t._x_currentIfEl}})():t._x_undoIf&&(t._x_undoIf(),delete t._x_undoIf)})))),i((()=>t._x_undoIf&&t._x_undoIf()))})),_l("id",((t,{expression:e},{evaluate:n})=>{n(e).forEach((e=>function(t,e){t._x_ids||(t._x_ids={}),t._x_ids[e]||(t._x_ids[e]=Kh(e))}(t,e)))})),pc(((t,e)=>{t._x_ids&&(e._x_ids=t._x_ids)})),Ol(Cl("@",xl("on:"))),_l("on",uc(((t,{value:e,modifiers:n,expression:i},{cleanup:r})=>{let s=i?pl(t,i):()=>{};"template"===t.tagName.toLowerCase()&&(t._x_forwardEvents||(t._x_forwardEvents=[]),t._x_forwardEvents.includes(e)||t._x_forwardEvents.push(e));let a=nu(t,e,n,(t=>{s((()=>{}),{scope:{$event:t},params:[t]})}));r((()=>a()))}))),du("Collapse","collapse","collapse"),du("Intersect","intersect","intersect"),du("Focus","trap","focus"),du("Mask","mask","mask"),Dc.setEvaluator(ml),Dc.setReactivityEngine({reactive:Wh,effect:function(t,e=zc){(function(t){return t&&!0===t._isEffect})(t)&&(t=t.raw);const n=function(t,e){const n=function(){if(!n.active)return t();if(!Jc.includes(n)){nh(n);try{return rh.push(ih),ih=!0,Jc.push(n),Ic=n,t()}finally{Jc.pop(),sh(),Ic=Jc[Jc.length-1]}}};return n.id=eh++,n.allowRecurse=!!e.allowRecurse,n._isEffect=!0,n.active=!0,n.raw=t,n.deps=[],n.options=e,n}(t,e);return e.lazy||n(),n},release:function(t){t.active&&(nh(t),t.options.onStop&&t.options.onStop(),t.active=!1)},raw:$h});var pu=Dc;function fu(t,e,n){if(-1===t.indexOf(e))return n;const i=t[t.indexOf(e)+1];if(!i)return n;if("duration"===e){let t=i.match(/([0-9]+)ms/);if(t)return t[1]}if("min"===e){let t=i.match(/([0-9]+)px/);if(t)return t[1]}return i}var mu=function(t){function e(e,{modifiers:n}){let i=fu(n,"duration",250)/1e3,r=fu(n,"min",0),s=!n.includes("min");e._x_isShown||(e.style.height=`${r}px`),!e._x_isShown&&s&&(e.hidden=!0),e._x_isShown||(e.style.overflow="hidden");let a=(e,n)=>{let i=t.setStyles(e,n);return n.height?()=>{}:i},o={transitionProperty:"height",transitionDuration:`${i}s`,transitionTimingFunction:"cubic-bezier(0.4, 0.0, 0.2, 1)"};e._x_transition={in(n=(()=>{}),i=(()=>{})){s&&(e.hidden=!1),s&&(e.style.display=null);let a=e.getBoundingClientRect().height;e.style.height="auto";let l=e.getBoundingClientRect().height;a===l&&(a=r),t.transition(e,t.setStyles,{during:o,start:{height:a+"px"},end:{height:l+"px"}},(()=>e._x_isShown=!0),(()=>{Math.abs(e.getBoundingClientRect().height-l)<1&&(e.style.overflow=null)}))},out(n=(()=>{}),i=(()=>{})){let l=e.getBoundingClientRect().height;t.transition(e,a,{during:o,start:{height:l+"px"},end:{height:r+"px"}},(()=>e.style.overflow="hidden"),(()=>{e._x_isShown=!1,e.style.height==`${r}px`&&s&&(e.style.display="none",e.hidden=!0)}))}}}t.directive("collapse",e),e.inline=(t,{modifiers:e})=>{e.includes("min")&&(t._x_doShow=()=>{},t._x_doHide=()=>{})}};function gu(t){return null!==t&&"object"==typeof t&&"constructor"in t&&t.constructor===Object}function vu(t,e){void 0===t&&(t={}),void 0===e&&(e={}),Object.keys(e).forEach((n=>{void 0===t[n]?t[n]=e[n]:gu(e[n])&&gu(t[n])&&Object.keys(e[n]).length>0&&vu(t[n],e[n])}))}const yu={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector:()=>null,querySelectorAll:()=>[],getElementById:()=>null,createEvent:()=>({initEvent(){}}),createElement:()=>({children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName:()=>[]}),createElementNS:()=>({}),importNode:()=>null,location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function xu(){const t="undefined"!=typeof document?document:{};return vu(t,yu),t}const bu={document:yu,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle:()=>({getPropertyValue:()=>""}),Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia:()=>({}),requestAnimationFrame:t=>"undefined"==typeof setTimeout?(t(),null):setTimeout(t,0),cancelAnimationFrame(t){"undefined"!=typeof setTimeout&&clearTimeout(t)}};function _u(){const t="undefined"!=typeof window?window:{};return vu(t,bu),t}function wu(t,e){return void 0===e&&(e=0),setTimeout(t,e)}function Su(){return Date.now()}function Mu(t,e){void 0===e&&(e="x");const n=_u();let i,r,s;const a=function(t){const e=_u();let n;return e.getComputedStyle&&(n=e.getComputedStyle(t,null)),!n&&t.currentStyle&&(n=t.currentStyle),n||(n=t.style),n}(t);return n.WebKitCSSMatrix?(r=a.transform||a.webkitTransform,r.split(",").length>6&&(r=r.split(", ").map((t=>t.replace(",","."))).join(", ")),s=new n.WebKitCSSMatrix("none"===r?"":r)):(s=a.MozTransform||a.OTransform||a.MsTransform||a.msTransform||a.transform||a.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),i=s.toString().split(",")),"x"===e&&(r=n.WebKitCSSMatrix?s.m41:16===i.length?parseFloat(i[12]):parseFloat(i[4])),"y"===e&&(r=n.WebKitCSSMatrix?s.m42:16===i.length?parseFloat(i[13]):parseFloat(i[5])),r||0}function Tu(t){return"object"==typeof t&&null!==t&&t.constructor&&"Object"===Object.prototype.toString.call(t).slice(8,-1)}function Eu(){const t=Object(arguments.length<=0?void 0:arguments[0]),e=["__proto__","constructor","prototype"];for(let i=1;i<arguments.length;i+=1){const r=i<0||arguments.length<=i?void 0:arguments[i];if(null!=r&&(n=r,!("undefined"!=typeof window&&void 0!==window.HTMLElement?n instanceof HTMLElement:n&&(1===n.nodeType||11===n.nodeType)))){const n=Object.keys(Object(r)).filter((t=>e.indexOf(t)<0));for(let e=0,i=n.length;e<i;e+=1){const i=n[e],s=Object.getOwnPropertyDescriptor(r,i);void 0!==s&&s.enumerable&&(Tu(t[i])&&Tu(r[i])?r[i].__swiper__?t[i]=r[i]:Eu(t[i],r[i]):!Tu(t[i])&&Tu(r[i])?(t[i]={},r[i].__swiper__?t[i]=r[i]:Eu(t[i],r[i])):t[i]=r[i])}}}var n;return t}function Au(t,e,n){t.style.setProperty(e,n)}function Cu(t){let{swiper:e,targetPosition:n,side:i}=t;const r=_u(),s=-e.translate;let a,o=null;const l=e.params.speed;e.wrapperEl.style.scrollSnapType="none",r.cancelAnimationFrame(e.cssModeFrameID);const c=n>s?"next":"prev",h=(t,e)=>"next"===c&&t>=e||"prev"===c&&t<=e,u=()=>{a=(new Date).getTime(),null===o&&(o=a);const t=Math.max(Math.min((a-o)/l,1),0),c=.5-Math.cos(t*Math.PI)/2;let d=s+c*(n-s);if(h(d,n)&&(d=n),e.wrapperEl.scrollTo({[i]:d}),h(d,n))return e.wrapperEl.style.overflow="hidden",e.wrapperEl.style.scrollSnapType="",setTimeout((()=>{e.wrapperEl.style.overflow="",e.wrapperEl.scrollTo({[i]:d})})),void r.cancelAnimationFrame(e.cssModeFrameID);e.cssModeFrameID=r.requestAnimationFrame(u)};u()}function Pu(t){return t.querySelector(".swiper-slide-transform")||t.shadowRoot&&t.shadowRoot.querySelector(".swiper-slide-transform")||t}function Ru(t,e){return void 0===e&&(e=""),[...t.children].filter((t=>t.matches(e)))}function Ou(t){try{return void console.warn(t)}catch(t){}}function Du(t,e){void 0===e&&(e=[]);const n=document.createElement(t);return n.classList.add(...Array.isArray(e)?e:function(t){return void 0===t&&(t=""),t.trim().split(" ").filter((t=>!!t.trim()))}(e)),n}function Lu(t,e){return _u().getComputedStyle(t,null).getPropertyValue(e)}function Iu(t){let e,n=t;if(n){for(e=0;null!==(n=n.previousSibling);)1===n.nodeType&&(e+=1);return e}}function zu(t,e){const n=[];let i=t.parentElement;for(;i;)e?i.matches(e)&&n.push(i):n.push(i),i=i.parentElement;return n}function Nu(t,e){e&&t.addEventListener("transitionend",(function n(i){i.target===t&&(e.call(t,i),t.removeEventListener("transitionend",n))}))}function Uu(t,e,n){const i=_u();return n?t["width"===e?"offsetWidth":"offsetHeight"]+parseFloat(i.getComputedStyle(t,null).getPropertyValue("width"===e?"margin-right":"margin-top"))+parseFloat(i.getComputedStyle(t,null).getPropertyValue("width"===e?"margin-left":"margin-bottom")):t.offsetWidth}function ku(t){return(Array.isArray(t)?t:[t]).filter((t=>!!t))}let Bu,Fu,Vu;function ju(){return Bu||(Bu=function(){const t=_u(),e=xu();return{smoothScroll:e.documentElement&&e.documentElement.style&&"scrollBehavior"in e.documentElement.style,touch:!!("ontouchstart"in t||t.DocumentTouch&&e instanceof t.DocumentTouch)}}()),Bu}function Hu(t){return void 0===t&&(t={}),Fu||(Fu=function(t){let{userAgent:e}=void 0===t?{}:t;const n=ju(),i=_u(),r=i.navigator.platform,s=e||i.navigator.userAgent,a={ios:!1,android:!1},o=i.screen.width,l=i.screen.height,c=s.match(/(Android);?[\s\/]+([\d.]+)?/);let h=s.match(/(iPad).*OS\s([\d_]+)/);const u=s.match(/(iPod)(.*OS\s([\d_]+))?/),d=!h&&s.match(/(iPhone\sOS|iOS)\s([\d_]+)/),p="Win32"===r;let f="MacIntel"===r;return!h&&f&&n.touch&&["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"].indexOf(`${o}x${l}`)>=0&&(h=s.match(/(Version)\/([\d.]+)/),h||(h=[0,1,"13_0_0"]),f=!1),c&&!p&&(a.os="android",a.android=!0),(h||d||u)&&(a.os="ios",a.ios=!0),a}(t)),Fu}function Gu(){return Vu||(Vu=function(){const t=_u(),e=Hu();let n=!1;function i(){const e=t.navigator.userAgent.toLowerCase();return e.indexOf("safari")>=0&&e.indexOf("chrome")<0&&e.indexOf("android")<0}if(i()){const e=String(t.navigator.userAgent);if(e.includes("Version/")){const[t,i]=e.split("Version/")[1].split(" ")[0].split(".").map((t=>Number(t)));n=t<16||16===t&&i<2}}const r=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(t.navigator.userAgent),s=i();return{isSafari:n||s,needPerspectiveFix:n,need3dFix:s||r&&e.ios,isWebView:r}}()),Vu}var Wu={on(t,e,n){const i=this;if(!i.eventsListeners||i.destroyed)return i;if("function"!=typeof e)return i;const r=n?"unshift":"push";return t.split(" ").forEach((t=>{i.eventsListeners[t]||(i.eventsListeners[t]=[]),i.eventsListeners[t][r](e)})),i},once(t,e,n){const i=this;if(!i.eventsListeners||i.destroyed)return i;if("function"!=typeof e)return i;function r(){i.off(t,r),r.__emitterProxy&&delete r.__emitterProxy;for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];e.apply(i,s)}return r.__emitterProxy=e,i.on(t,r,n)},onAny(t,e){const n=this;if(!n.eventsListeners||n.destroyed)return n;if("function"!=typeof t)return n;const i=e?"unshift":"push";return n.eventsAnyListeners.indexOf(t)<0&&n.eventsAnyListeners[i](t),n},offAny(t){const e=this;if(!e.eventsListeners||e.destroyed)return e;if(!e.eventsAnyListeners)return e;const n=e.eventsAnyListeners.indexOf(t);return n>=0&&e.eventsAnyListeners.splice(n,1),e},off(t,e){const n=this;return!n.eventsListeners||n.destroyed?n:n.eventsListeners?(t.split(" ").forEach((t=>{void 0===e?n.eventsListeners[t]=[]:n.eventsListeners[t]&&n.eventsListeners[t].forEach(((i,r)=>{(i===e||i.__emitterProxy&&i.__emitterProxy===e)&&n.eventsListeners[t].splice(r,1)}))})),n):n},emit(){const t=this;if(!t.eventsListeners||t.destroyed)return t;if(!t.eventsListeners)return t;let e,n,i;for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];"string"==typeof s[0]||Array.isArray(s[0])?(e=s[0],n=s.slice(1,s.length),i=t):(e=s[0].events,n=s[0].data,i=s[0].context||t),n.unshift(i);return(Array.isArray(e)?e:e.split(" ")).forEach((e=>{t.eventsAnyListeners&&t.eventsAnyListeners.length&&t.eventsAnyListeners.forEach((t=>{t.apply(i,[e,...n])})),t.eventsListeners&&t.eventsListeners[e]&&t.eventsListeners[e].forEach((t=>{t.apply(i,n)}))})),t}};const qu=(t,e,n)=>{e&&!t.classList.contains(n)?t.classList.add(n):!e&&t.classList.contains(n)&&t.classList.remove(n)};const Xu=(t,e,n)=>{e&&!t.classList.contains(n)?t.classList.add(n):!e&&t.classList.contains(n)&&t.classList.remove(n)};const $u=(t,e)=>{if(!t||t.destroyed||!t.params)return;const n=e.closest(t.isElement?"swiper-slide":`.${t.params.slideClass}`);if(n){let e=n.querySelector(`.${t.params.lazyPreloaderClass}`);!e&&t.isElement&&(n.shadowRoot?e=n.shadowRoot.querySelector(`.${t.params.lazyPreloaderClass}`):requestAnimationFrame((()=>{n.shadowRoot&&(e=n.shadowRoot.querySelector(`.${t.params.lazyPreloaderClass}`),e&&e.remove())}))),e&&e.remove()}},Yu=(t,e)=>{if(!t.slides[e])return;const n=t.slides[e].querySelector('[loading="lazy"]');n&&n.removeAttribute("loading")},Zu=t=>{if(!t||t.destroyed||!t.params)return;let e=t.params.lazyPreloadPrevNext;const n=t.slides.length;if(!n||!e||e<0)return;e=Math.min(e,n);const i="auto"===t.params.slidesPerView?t.slidesPerViewDynamic():Math.ceil(t.params.slidesPerView),r=t.activeIndex;if(t.params.grid&&t.params.grid.rows>1){const n=r,s=[n-e];return s.push(...Array.from({length:e}).map(((t,e)=>n+i+e))),void t.slides.forEach(((e,n)=>{s.includes(e.column)&&Yu(t,n)}))}const s=r+i-1;if(t.params.rewind||t.params.loop)for(let i=r-e;i<=s+e;i+=1){const e=(i%n+n)%n;(e<r||e>s)&&Yu(t,e)}else for(let i=Math.max(r-e,0);i<=Math.min(s+e,n-1);i+=1)i!==r&&(i>s||i<r)&&Yu(t,i)};var Ku={updateSize:function(){const t=this;let e,n;const i=t.el;e=void 0!==t.params.width&&null!==t.params.width?t.params.width:i.clientWidth,n=void 0!==t.params.height&&null!==t.params.height?t.params.height:i.clientHeight,0===e&&t.isHorizontal()||0===n&&t.isVertical()||(e=e-parseInt(Lu(i,"padding-left")||0,10)-parseInt(Lu(i,"padding-right")||0,10),n=n-parseInt(Lu(i,"padding-top")||0,10)-parseInt(Lu(i,"padding-bottom")||0,10),Number.isNaN(e)&&(e=0),Number.isNaN(n)&&(n=0),Object.assign(t,{width:e,height:n,size:t.isHorizontal()?e:n}))},updateSlides:function(){const t=this;function e(e,n){return parseFloat(e.getPropertyValue(t.getDirectionLabel(n))||0)}const n=t.params,{wrapperEl:i,slidesEl:r,size:s,rtlTranslate:a,wrongRTL:o}=t,l=t.virtual&&n.virtual.enabled,c=l?t.virtual.slides.length:t.slides.length,h=Ru(r,`.${t.params.slideClass}, swiper-slide`),u=l?t.virtual.slides.length:h.length;let d=[];const p=[],f=[];let m=n.slidesOffsetBefore;"function"==typeof m&&(m=n.slidesOffsetBefore.call(t));let g=n.slidesOffsetAfter;"function"==typeof g&&(g=n.slidesOffsetAfter.call(t));const v=t.snapGrid.length,y=t.slidesGrid.length;let x=n.spaceBetween,b=-m,_=0,w=0;if(void 0===s)return;"string"==typeof x&&x.indexOf("%")>=0?x=parseFloat(x.replace("%",""))/100*s:"string"==typeof x&&(x=parseFloat(x)),t.virtualSize=-x,h.forEach((t=>{a?t.style.marginLeft="":t.style.marginRight="",t.style.marginBottom="",t.style.marginTop=""})),n.centeredSlides&&n.cssMode&&(Au(i,"--swiper-centered-offset-before",""),Au(i,"--swiper-centered-offset-after",""));const S=n.grid&&n.grid.rows>1&&t.grid;let M;S?t.grid.initSlides(h):t.grid&&t.grid.unsetSlides();const T="auto"===n.slidesPerView&&n.breakpoints&&Object.keys(n.breakpoints).filter((t=>void 0!==n.breakpoints[t].slidesPerView)).length>0;for(let i=0;i<u;i+=1){let r;if(M=0,h[i]&&(r=h[i]),S&&t.grid.updateSlide(i,r,h),!h[i]||"none"!==Lu(r,"display")){if("auto"===n.slidesPerView){T&&(h[i].style[t.getDirectionLabel("width")]="");const s=getComputedStyle(r),a=r.style.transform,o=r.style.webkitTransform;if(a&&(r.style.transform="none"),o&&(r.style.webkitTransform="none"),n.roundLengths)M=t.isHorizontal()?Uu(r,"width",!0):Uu(r,"height",!0);else{const t=e(s,"width"),n=e(s,"padding-left"),i=e(s,"padding-right"),a=e(s,"margin-left"),o=e(s,"margin-right"),l=s.getPropertyValue("box-sizing");if(l&&"border-box"===l)M=t+a+o;else{const{clientWidth:e,offsetWidth:s}=r;M=t+n+i+a+o+(s-e)}}a&&(r.style.transform=a),o&&(r.style.webkitTransform=o),n.roundLengths&&(M=Math.floor(M))}else M=(s-(n.slidesPerView-1)*x)/n.slidesPerView,n.roundLengths&&(M=Math.floor(M)),h[i]&&(h[i].style[t.getDirectionLabel("width")]=`${M}px`);h[i]&&(h[i].swiperSlideSize=M),f.push(M),n.centeredSlides?(b=b+M/2+_/2+x,0===_&&0!==i&&(b=b-s/2-x),0===i&&(b=b-s/2-x),Math.abs(b)<.001&&(b=0),n.roundLengths&&(b=Math.floor(b)),w%n.slidesPerGroup==0&&d.push(b),p.push(b)):(n.roundLengths&&(b=Math.floor(b)),(w-Math.min(t.params.slidesPerGroupSkip,w))%t.params.slidesPerGroup==0&&d.push(b),p.push(b),b=b+M+x),t.virtualSize+=M+x,_=M,w+=1}}if(t.virtualSize=Math.max(t.virtualSize,s)+g,a&&o&&("slide"===n.effect||"coverflow"===n.effect)&&(i.style.width=`${t.virtualSize+x}px`),n.setWrapperSize&&(i.style[t.getDirectionLabel("width")]=`${t.virtualSize+x}px`),S&&t.grid.updateWrapperSize(M,d),!n.centeredSlides){const e=[];for(let i=0;i<d.length;i+=1){let r=d[i];n.roundLengths&&(r=Math.floor(r)),d[i]<=t.virtualSize-s&&e.push(r)}d=e,Math.floor(t.virtualSize-s)-Math.floor(d[d.length-1])>1&&d.push(t.virtualSize-s)}if(l&&n.loop){const e=f[0]+x;if(n.slidesPerGroup>1){const i=Math.ceil((t.virtual.slidesBefore+t.virtual.slidesAfter)/n.slidesPerGroup),r=e*n.slidesPerGroup;for(let t=0;t<i;t+=1)d.push(d[d.length-1]+r)}for(let i=0;i<t.virtual.slidesBefore+t.virtual.slidesAfter;i+=1)1===n.slidesPerGroup&&d.push(d[d.length-1]+e),p.push(p[p.length-1]+e),t.virtualSize+=e}if(0===d.length&&(d=[0]),0!==x){const e=t.isHorizontal()&&a?"marginLeft":t.getDirectionLabel("marginRight");h.filter(((t,e)=>!(n.cssMode&&!n.loop)||e!==h.length-1)).forEach((t=>{t.style[e]=`${x}px`}))}if(n.centeredSlides&&n.centeredSlidesBounds){let t=0;f.forEach((e=>{t+=e+(x||0)})),t-=x;const e=t-s;d=d.map((t=>t<=0?-m:t>e?e+g:t))}if(n.centerInsufficientSlides){let t=0;f.forEach((e=>{t+=e+(x||0)})),t-=x;const e=(n.slidesOffsetBefore||0)+(n.slidesOffsetAfter||0);if(t+e<s){const n=(s-t-e)/2;d.forEach(((t,e)=>{d[e]=t-n})),p.forEach(((t,e)=>{p[e]=t+n}))}}if(Object.assign(t,{slides:h,snapGrid:d,slidesGrid:p,slidesSizesGrid:f}),n.centeredSlides&&n.cssMode&&!n.centeredSlidesBounds){Au(i,"--swiper-centered-offset-before",-d[0]+"px"),Au(i,"--swiper-centered-offset-after",t.size/2-f[f.length-1]/2+"px");const e=-t.snapGrid[0],n=-t.slidesGrid[0];t.snapGrid=t.snapGrid.map((t=>t+e)),t.slidesGrid=t.slidesGrid.map((t=>t+n))}if(u!==c&&t.emit("slidesLengthChange"),d.length!==v&&(t.params.watchOverflow&&t.checkOverflow(),t.emit("snapGridLengthChange")),p.length!==y&&t.emit("slidesGridLengthChange"),n.watchSlidesProgress&&t.updateSlidesOffset(),t.emit("slidesUpdated"),!(l||n.cssMode||"slide"!==n.effect&&"fade"!==n.effect)){const e=`${n.containerModifierClass}backface-hidden`,i=t.el.classList.contains(e);u<=n.maxBackfaceHiddenSlides?i||t.el.classList.add(e):i&&t.el.classList.remove(e)}},updateAutoHeight:function(t){const e=this,n=[],i=e.virtual&&e.params.virtual.enabled;let r,s=0;"number"==typeof t?e.setTransition(t):!0===t&&e.setTransition(e.params.speed);const a=t=>i?e.slides[e.getSlideIndexByData(t)]:e.slides[t];if("auto"!==e.params.slidesPerView&&e.params.slidesPerView>1)if(e.params.centeredSlides)(e.visibleSlides||[]).forEach((t=>{n.push(t)}));else for(r=0;r<Math.ceil(e.params.slidesPerView);r+=1){const t=e.activeIndex+r;if(t>e.slides.length&&!i)break;n.push(a(t))}else n.push(a(e.activeIndex));for(r=0;r<n.length;r+=1)if(void 0!==n[r]){const t=n[r].offsetHeight;s=t>s?t:s}(s||0===s)&&(e.wrapperEl.style.height=`${s}px`)},updateSlidesOffset:function(){const t=this,e=t.slides,n=t.isElement?t.isHorizontal()?t.wrapperEl.offsetLeft:t.wrapperEl.offsetTop:0;for(let i=0;i<e.length;i+=1)e[i].swiperSlideOffset=(t.isHorizontal()?e[i].offsetLeft:e[i].offsetTop)-n-t.cssOverflowAdjustment()},updateSlidesProgress:function(t){void 0===t&&(t=this&&this.translate||0);const e=this,n=e.params,{slides:i,rtlTranslate:r,snapGrid:s}=e;if(0===i.length)return;void 0===i[0].swiperSlideOffset&&e.updateSlidesOffset();let a=-t;r&&(a=t),e.visibleSlidesIndexes=[],e.visibleSlides=[];let o=n.spaceBetween;"string"==typeof o&&o.indexOf("%")>=0?o=parseFloat(o.replace("%",""))/100*e.size:"string"==typeof o&&(o=parseFloat(o));for(let t=0;t<i.length;t+=1){const l=i[t];let c=l.swiperSlideOffset;n.cssMode&&n.centeredSlides&&(c-=i[0].swiperSlideOffset);const h=(a+(n.centeredSlides?e.minTranslate():0)-c)/(l.swiperSlideSize+o),u=(a-s[0]+(n.centeredSlides?e.minTranslate():0)-c)/(l.swiperSlideSize+o),d=-(a-c),p=d+e.slidesSizesGrid[t],f=d>=0&&d<=e.size-e.slidesSizesGrid[t],m=d>=0&&d<e.size-1||p>1&&p<=e.size||d<=0&&p>=e.size;m&&(e.visibleSlides.push(l),e.visibleSlidesIndexes.push(t)),qu(l,m,n.slideVisibleClass),qu(l,f,n.slideFullyVisibleClass),l.progress=r?-h:h,l.originalProgress=r?-u:u}},updateProgress:function(t){const e=this;if(void 0===t){const n=e.rtlTranslate?-1:1;t=e&&e.translate&&e.translate*n||0}const n=e.params,i=e.maxTranslate()-e.minTranslate();let{progress:r,isBeginning:s,isEnd:a,progressLoop:o}=e;const l=s,c=a;if(0===i)r=0,s=!0,a=!0;else{r=(t-e.minTranslate())/i;const n=Math.abs(t-e.minTranslate())<1,o=Math.abs(t-e.maxTranslate())<1;s=n||r<=0,a=o||r>=1,n&&(r=0),o&&(r=1)}if(n.loop){const n=e.getSlideIndexByData(0),i=e.getSlideIndexByData(e.slides.length-1),r=e.slidesGrid[n],s=e.slidesGrid[i],a=e.slidesGrid[e.slidesGrid.length-1],l=Math.abs(t);o=l>=r?(l-r)/a:(l+a-s)/a,o>1&&(o-=1)}Object.assign(e,{progress:r,progressLoop:o,isBeginning:s,isEnd:a}),(n.watchSlidesProgress||n.centeredSlides&&n.autoHeight)&&e.updateSlidesProgress(t),s&&!l&&e.emit("reachBeginning toEdge"),a&&!c&&e.emit("reachEnd toEdge"),(l&&!s||c&&!a)&&e.emit("fromEdge"),e.emit("progress",r)},updateSlidesClasses:function(){const t=this,{slides:e,params:n,slidesEl:i,activeIndex:r}=t,s=t.virtual&&n.virtual.enabled,a=t.grid&&n.grid&&n.grid.rows>1,o=t=>Ru(i,`.${n.slideClass}${t}, swiper-slide${t}`)[0];let l,c,h;if(s)if(n.loop){let e=r-t.virtual.slidesBefore;e<0&&(e=t.virtual.slides.length+e),e>=t.virtual.slides.length&&(e-=t.virtual.slides.length),l=o(`[data-swiper-slide-index="${e}"]`)}else l=o(`[data-swiper-slide-index="${r}"]`);else a?(l=e.filter((t=>t.column===r))[0],h=e.filter((t=>t.column===r+1))[0],c=e.filter((t=>t.column===r-1))[0]):l=e[r];l&&(a||(h=function(t,e){const n=[];for(;t.nextElementSibling;){const i=t.nextElementSibling;e?i.matches(e)&&n.push(i):n.push(i),t=i}return n}(l,`.${n.slideClass}, swiper-slide`)[0],n.loop&&!h&&(h=e[0]),c=function(t,e){const n=[];for(;t.previousElementSibling;){const i=t.previousElementSibling;e?i.matches(e)&&n.push(i):n.push(i),t=i}return n}(l,`.${n.slideClass}, swiper-slide`)[0],n.loop&&0===!c&&(c=e[e.length-1]))),e.forEach((t=>{Xu(t,t===l,n.slideActiveClass),Xu(t,t===h,n.slideNextClass),Xu(t,t===c,n.slidePrevClass)})),t.emitSlidesClasses()},updateActiveIndex:function(t){const e=this,n=e.rtlTranslate?e.translate:-e.translate,{snapGrid:i,params:r,activeIndex:s,realIndex:a,snapIndex:o}=e;let l,c=t;const h=t=>{let n=t-e.virtual.slidesBefore;return n<0&&(n=e.virtual.slides.length+n),n>=e.virtual.slides.length&&(n-=e.virtual.slides.length),n};if(void 0===c&&(c=function(t){const{slidesGrid:e,params:n}=t,i=t.rtlTranslate?t.translate:-t.translate;let r;for(let t=0;t<e.length;t+=1)void 0!==e[t+1]?i>=e[t]&&i<e[t+1]-(e[t+1]-e[t])/2?r=t:i>=e[t]&&i<e[t+1]&&(r=t+1):i>=e[t]&&(r=t);return n.normalizeSlideIndex&&(r<0||void 0===r)&&(r=0),r}(e)),i.indexOf(n)>=0)l=i.indexOf(n);else{const t=Math.min(r.slidesPerGroupSkip,c);l=t+Math.floor((c-t)/r.slidesPerGroup)}if(l>=i.length&&(l=i.length-1),c===s&&!e.params.loop)return void(l!==o&&(e.snapIndex=l,e.emit("snapIndexChange")));if(c===s&&e.params.loop&&e.virtual&&e.params.virtual.enabled)return void(e.realIndex=h(c));const u=e.grid&&r.grid&&r.grid.rows>1;let d;if(e.virtual&&r.virtual.enabled&&r.loop)d=h(c);else if(u){const t=e.slides.filter((t=>t.column===c))[0];let n=parseInt(t.getAttribute("data-swiper-slide-index"),10);Number.isNaN(n)&&(n=Math.max(e.slides.indexOf(t),0)),d=Math.floor(n/r.grid.rows)}else if(e.slides[c]){const t=e.slides[c].getAttribute("data-swiper-slide-index");d=t?parseInt(t,10):c}else d=c;Object.assign(e,{previousSnapIndex:o,snapIndex:l,previousRealIndex:a,realIndex:d,previousIndex:s,activeIndex:c}),e.initialized&&Zu(e),e.emit("activeIndexChange"),e.emit("snapIndexChange"),(e.initialized||e.params.runCallbacksOnInit)&&(a!==d&&e.emit("realIndexChange"),e.emit("slideChange"))},updateClickedSlide:function(t,e){const n=this,i=n.params;let r=t.closest(`.${i.slideClass}, swiper-slide`);!r&&n.isElement&&e&&e.length>1&&e.includes(t)&&[...e.slice(e.indexOf(t)+1,e.length)].forEach((t=>{!r&&t.matches&&t.matches(`.${i.slideClass}, swiper-slide`)&&(r=t)}));let s,a=!1;if(r)for(let t=0;t<n.slides.length;t+=1)if(n.slides[t]===r){a=!0,s=t;break}if(!r||!a)return n.clickedSlide=void 0,void(n.clickedIndex=void 0);n.clickedSlide=r,n.virtual&&n.params.virtual.enabled?n.clickedIndex=parseInt(r.getAttribute("data-swiper-slide-index"),10):n.clickedIndex=s,i.slideToClickedSlide&&void 0!==n.clickedIndex&&n.clickedIndex!==n.activeIndex&&n.slideToClickedSlide()}};var Ju={getTranslate:function(t){void 0===t&&(t=this.isHorizontal()?"x":"y");const{params:e,rtlTranslate:n,translate:i,wrapperEl:r}=this;if(e.virtualTranslate)return n?-i:i;if(e.cssMode)return i;let s=Mu(r,t);return s+=this.cssOverflowAdjustment(),n&&(s=-s),s||0},setTranslate:function(t,e){const n=this,{rtlTranslate:i,params:r,wrapperEl:s,progress:a}=n;let o,l=0,c=0;n.isHorizontal()?l=i?-t:t:c=t,r.roundLengths&&(l=Math.floor(l),c=Math.floor(c)),n.previousTranslate=n.translate,n.translate=n.isHorizontal()?l:c,r.cssMode?s[n.isHorizontal()?"scrollLeft":"scrollTop"]=n.isHorizontal()?-l:-c:r.virtualTranslate||(n.isHorizontal()?l-=n.cssOverflowAdjustment():c-=n.cssOverflowAdjustment(),s.style.transform=`translate3d(${l}px, ${c}px, 0px)`);const h=n.maxTranslate()-n.minTranslate();o=0===h?0:(t-n.minTranslate())/h,o!==a&&n.updateProgress(t),n.emit("setTranslate",n.translate,e)},minTranslate:function(){return-this.snapGrid[0]},maxTranslate:function(){return-this.snapGrid[this.snapGrid.length-1]},translateTo:function(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=this.params.speed),void 0===n&&(n=!0),void 0===i&&(i=!0);const s=this,{params:a,wrapperEl:o}=s;if(s.animating&&a.preventInteractionOnTransition)return!1;const l=s.minTranslate(),c=s.maxTranslate();let h;if(h=i&&t>l?l:i&&t<c?c:t,s.updateProgress(h),a.cssMode){const t=s.isHorizontal();if(0===e)o[t?"scrollLeft":"scrollTop"]=-h;else{if(!s.support.smoothScroll)return Cu({swiper:s,targetPosition:-h,side:t?"left":"top"}),!0;o.scrollTo({[t?"left":"top"]:-h,behavior:"smooth"})}return!0}return 0===e?(s.setTransition(0),s.setTranslate(h),n&&(s.emit("beforeTransitionStart",e,r),s.emit("transitionEnd"))):(s.setTransition(e),s.setTranslate(h),n&&(s.emit("beforeTransitionStart",e,r),s.emit("transitionStart")),s.animating||(s.animating=!0,s.onTranslateToWrapperTransitionEnd||(s.onTranslateToWrapperTransitionEnd=function(t){s&&!s.destroyed&&t.target===this&&(s.wrapperEl.removeEventListener("transitionend",s.onTranslateToWrapperTransitionEnd),s.onTranslateToWrapperTransitionEnd=null,delete s.onTranslateToWrapperTransitionEnd,s.animating=!1,n&&s.emit("transitionEnd"))}),s.wrapperEl.addEventListener("transitionend",s.onTranslateToWrapperTransitionEnd))),!0}};function Qu(t){let{swiper:e,runCallbacks:n,direction:i,step:r}=t;const{activeIndex:s,previousIndex:a}=e;let o=i;if(o||(o=s>a?"next":s<a?"prev":"reset"),e.emit(`transition${r}`),n&&s!==a){if("reset"===o)return void e.emit(`slideResetTransition${r}`);e.emit(`slideChangeTransition${r}`),"next"===o?e.emit(`slideNextTransition${r}`):e.emit(`slidePrevTransition${r}`)}}var td={slideTo:function(t,e,n,i,r){void 0===t&&(t=0),void 0===n&&(n=!0),"string"==typeof t&&(t=parseInt(t,10));const s=this;let a=t;a<0&&(a=0);const{params:o,snapGrid:l,slidesGrid:c,previousIndex:h,activeIndex:u,rtlTranslate:d,wrapperEl:p,enabled:f}=s;if(!f&&!i&&!r||s.destroyed||s.animating&&o.preventInteractionOnTransition)return!1;void 0===e&&(e=s.params.speed);const m=Math.min(s.params.slidesPerGroupSkip,a);let g=m+Math.floor((a-m)/s.params.slidesPerGroup);g>=l.length&&(g=l.length-1);const v=-l[g];if(o.normalizeSlideIndex)for(let t=0;t<c.length;t+=1){const e=-Math.floor(100*v),n=Math.floor(100*c[t]),i=Math.floor(100*c[t+1]);void 0!==c[t+1]?e>=n&&e<i-(i-n)/2?a=t:e>=n&&e<i&&(a=t+1):e>=n&&(a=t)}if(s.initialized&&a!==u){if(!s.allowSlideNext&&(d?v>s.translate&&v>s.minTranslate():v<s.translate&&v<s.minTranslate()))return!1;if(!s.allowSlidePrev&&v>s.translate&&v>s.maxTranslate()&&(u||0)!==a)return!1}let y;if(a!==(h||0)&&n&&s.emit("beforeSlideChangeStart"),s.updateProgress(v),y=a>u?"next":a<u?"prev":"reset",d&&-v===s.translate||!d&&v===s.translate)return s.updateActiveIndex(a),o.autoHeight&&s.updateAutoHeight(),s.updateSlidesClasses(),"slide"!==o.effect&&s.setTranslate(v),"reset"!==y&&(s.transitionStart(n,y),s.transitionEnd(n,y)),!1;if(o.cssMode){const t=s.isHorizontal(),n=d?v:-v;if(0===e){const e=s.virtual&&s.params.virtual.enabled;e&&(s.wrapperEl.style.scrollSnapType="none",s._immediateVirtual=!0),e&&!s._cssModeVirtualInitialSet&&s.params.initialSlide>0?(s._cssModeVirtualInitialSet=!0,requestAnimationFrame((()=>{p[t?"scrollLeft":"scrollTop"]=n}))):p[t?"scrollLeft":"scrollTop"]=n,e&&requestAnimationFrame((()=>{s.wrapperEl.style.scrollSnapType="",s._immediateVirtual=!1}))}else{if(!s.support.smoothScroll)return Cu({swiper:s,targetPosition:n,side:t?"left":"top"}),!0;p.scrollTo({[t?"left":"top"]:n,behavior:"smooth"})}return!0}return s.setTransition(e),s.setTranslate(v),s.updateActiveIndex(a),s.updateSlidesClasses(),s.emit("beforeTransitionStart",e,i),s.transitionStart(n,y),0===e?s.transitionEnd(n,y):s.animating||(s.animating=!0,s.onSlideToWrapperTransitionEnd||(s.onSlideToWrapperTransitionEnd=function(t){s&&!s.destroyed&&t.target===this&&(s.wrapperEl.removeEventListener("transitionend",s.onSlideToWrapperTransitionEnd),s.onSlideToWrapperTransitionEnd=null,delete s.onSlideToWrapperTransitionEnd,s.transitionEnd(n,y))}),s.wrapperEl.addEventListener("transitionend",s.onSlideToWrapperTransitionEnd)),!0},slideToLoop:function(t,e,n,i){if(void 0===t&&(t=0),void 0===n&&(n=!0),"string"==typeof t){t=parseInt(t,10)}const r=this;if(r.destroyed)return;void 0===e&&(e=r.params.speed);const s=r.grid&&r.params.grid&&r.params.grid.rows>1;let a=t;if(r.params.loop)if(r.virtual&&r.params.virtual.enabled)a+=r.virtual.slidesBefore;else{let t;if(s){const e=a*r.params.grid.rows;t=r.slides.filter((t=>1*t.getAttribute("data-swiper-slide-index")===e))[0].column}else t=r.getSlideIndexByData(a);const e=s?Math.ceil(r.slides.length/r.params.grid.rows):r.slides.length,{centeredSlides:n}=r.params;let o=r.params.slidesPerView;"auto"===o?o=r.slidesPerViewDynamic():(o=Math.ceil(parseFloat(r.params.slidesPerView,10)),n&&o%2==0&&(o+=1));let l=e-t<o;if(n&&(l=l||t<Math.ceil(o/2)),i&&n&&"auto"!==r.params.slidesPerView&&!s&&(l=!1),l){const i=n?t<r.activeIndex?"prev":"next":t-r.activeIndex-1<r.params.slidesPerView?"next":"prev";r.loopFix({direction:i,slideTo:!0,activeSlideIndex:"next"===i?t+1:t-e+1,slideRealIndex:"next"===i?r.realIndex:void 0})}if(s){const t=a*r.params.grid.rows;a=r.slides.filter((e=>1*e.getAttribute("data-swiper-slide-index")===t))[0].column}else a=r.getSlideIndexByData(a)}return requestAnimationFrame((()=>{r.slideTo(a,e,n,i)})),r},slideNext:function(t,e,n){void 0===e&&(e=!0);const i=this,{enabled:r,params:s,animating:a}=i;if(!r||i.destroyed)return i;void 0===t&&(t=i.params.speed);let o=s.slidesPerGroup;"auto"===s.slidesPerView&&1===s.slidesPerGroup&&s.slidesPerGroupAuto&&(o=Math.max(i.slidesPerViewDynamic("current",!0),1));const l=i.activeIndex<s.slidesPerGroupSkip?1:o,c=i.virtual&&s.virtual.enabled;if(s.loop){if(a&&!c&&s.loopPreventsSliding)return!1;if(i.loopFix({direction:"next"}),i._clientLeft=i.wrapperEl.clientLeft,i.activeIndex===i.slides.length-1&&s.cssMode)return requestAnimationFrame((()=>{i.slideTo(i.activeIndex+l,t,e,n)})),!0}return s.rewind&&i.isEnd?i.slideTo(0,t,e,n):i.slideTo(i.activeIndex+l,t,e,n)},slidePrev:function(t,e,n){void 0===e&&(e=!0);const i=this,{params:r,snapGrid:s,slidesGrid:a,rtlTranslate:o,enabled:l,animating:c}=i;if(!l||i.destroyed)return i;void 0===t&&(t=i.params.speed);const h=i.virtual&&r.virtual.enabled;if(r.loop){if(c&&!h&&r.loopPreventsSliding)return!1;i.loopFix({direction:"prev"}),i._clientLeft=i.wrapperEl.clientLeft}function u(t){return t<0?-Math.floor(Math.abs(t)):Math.floor(t)}const d=u(o?i.translate:-i.translate),p=s.map((t=>u(t)));let f=s[p.indexOf(d)-1];if(void 0===f&&r.cssMode){let t;s.forEach(((e,n)=>{d>=e&&(t=n)})),void 0!==t&&(f=s[t>0?t-1:t])}let m=0;if(void 0!==f&&(m=a.indexOf(f),m<0&&(m=i.activeIndex-1),"auto"===r.slidesPerView&&1===r.slidesPerGroup&&r.slidesPerGroupAuto&&(m=m-i.slidesPerViewDynamic("previous",!0)+1,m=Math.max(m,0))),r.rewind&&i.isBeginning){const r=i.params.virtual&&i.params.virtual.enabled&&i.virtual?i.virtual.slides.length-1:i.slides.length-1;return i.slideTo(r,t,e,n)}return r.loop&&0===i.activeIndex&&r.cssMode?(requestAnimationFrame((()=>{i.slideTo(m,t,e,n)})),!0):i.slideTo(m,t,e,n)},slideReset:function(t,e,n){void 0===e&&(e=!0);const i=this;if(!i.destroyed)return void 0===t&&(t=i.params.speed),i.slideTo(i.activeIndex,t,e,n)},slideToClosest:function(t,e,n,i){void 0===e&&(e=!0),void 0===i&&(i=.5);const r=this;if(r.destroyed)return;void 0===t&&(t=r.params.speed);let s=r.activeIndex;const a=Math.min(r.params.slidesPerGroupSkip,s),o=a+Math.floor((s-a)/r.params.slidesPerGroup),l=r.rtlTranslate?r.translate:-r.translate;if(l>=r.snapGrid[o]){const t=r.snapGrid[o];l-t>(r.snapGrid[o+1]-t)*i&&(s+=r.params.slidesPerGroup)}else{const t=r.snapGrid[o-1];l-t<=(r.snapGrid[o]-t)*i&&(s-=r.params.slidesPerGroup)}return s=Math.max(s,0),s=Math.min(s,r.slidesGrid.length-1),r.slideTo(s,t,e,n)},slideToClickedSlide:function(){const t=this;if(t.destroyed)return;const{params:e,slidesEl:n}=t,i="auto"===e.slidesPerView?t.slidesPerViewDynamic():e.slidesPerView;let r,s=t.clickedIndex;const a=t.isElement?"swiper-slide":`.${e.slideClass}`;if(e.loop){if(t.animating)return;r=parseInt(t.clickedSlide.getAttribute("data-swiper-slide-index"),10),e.centeredSlides?s<t.loopedSlides-i/2||s>t.slides.length-t.loopedSlides+i/2?(t.loopFix(),s=t.getSlideIndex(Ru(n,`${a}[data-swiper-slide-index="${r}"]`)[0]),wu((()=>{t.slideTo(s)}))):t.slideTo(s):s>t.slides.length-i?(t.loopFix(),s=t.getSlideIndex(Ru(n,`${a}[data-swiper-slide-index="${r}"]`)[0]),wu((()=>{t.slideTo(s)}))):t.slideTo(s)}else t.slideTo(s)}};var ed={loopCreate:function(t){const e=this,{params:n,slidesEl:i}=e;if(!n.loop||e.virtual&&e.params.virtual.enabled)return;const r=()=>{Ru(i,`.${n.slideClass}, swiper-slide`).forEach(((t,e)=>{t.setAttribute("data-swiper-slide-index",e)}))},s=e.grid&&n.grid&&n.grid.rows>1,a=n.slidesPerGroup*(s?n.grid.rows:1),o=e.slides.length%a!=0,l=s&&e.slides.length%n.grid.rows!=0,c=t=>{for(let i=0;i<t;i+=1){const t=e.isElement?Du("swiper-slide",[n.slideBlankClass]):Du("div",[n.slideClass,n.slideBlankClass]);e.slidesEl.append(t)}};if(o){if(n.loopAddBlankSlides){c(a-e.slides.length%a),e.recalcSlides(),e.updateSlides()}else Ou("Swiper Loop Warning: The number of slides is not even to slidesPerGroup, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");r()}else if(l){if(n.loopAddBlankSlides){c(n.grid.rows-e.slides.length%n.grid.rows),e.recalcSlides(),e.updateSlides()}else Ou("Swiper Loop Warning: The number of slides is not even to grid.rows, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");r()}else r();e.loopFix({slideRealIndex:t,direction:n.centeredSlides?void 0:"next"})},loopFix:function(t){let{slideRealIndex:e,slideTo:n=!0,direction:i,setTranslate:r,activeSlideIndex:s,byController:a,byMousewheel:o}=void 0===t?{}:t;const l=this;if(!l.params.loop)return;l.emit("beforeLoopFix");const{slides:c,allowSlidePrev:h,allowSlideNext:u,slidesEl:d,params:p}=l,{centeredSlides:f}=p;if(l.allowSlidePrev=!0,l.allowSlideNext=!0,l.virtual&&p.virtual.enabled)return n&&(p.centeredSlides||0!==l.snapIndex?p.centeredSlides&&l.snapIndex<p.slidesPerView?l.slideTo(l.virtual.slides.length+l.snapIndex,0,!1,!0):l.snapIndex===l.snapGrid.length-1&&l.slideTo(l.virtual.slidesBefore,0,!1,!0):l.slideTo(l.virtual.slides.length,0,!1,!0)),l.allowSlidePrev=h,l.allowSlideNext=u,void l.emit("loopFix");let m=p.slidesPerView;"auto"===m?m=l.slidesPerViewDynamic():(m=Math.ceil(parseFloat(p.slidesPerView,10)),f&&m%2==0&&(m+=1));const g=p.slidesPerGroupAuto?m:p.slidesPerGroup;let v=g;v%g!=0&&(v+=g-v%g),v+=p.loopAdditionalSlides,l.loopedSlides=v;const y=l.grid&&p.grid&&p.grid.rows>1;c.length<m+v?Ou("Swiper Loop Warning: The number of slides is not enough for loop mode, it will be disabled and not function properly. You need to add more slides (or make duplicates) or lower the values of slidesPerView and slidesPerGroup parameters"):y&&"row"===p.grid.fill&&Ou("Swiper Loop Warning: Loop mode is not compatible with grid.fill = `row`");const x=[],b=[];let _=l.activeIndex;void 0===s?s=l.getSlideIndex(c.filter((t=>t.classList.contains(p.slideActiveClass)))[0]):_=s;const w="next"===i||!i,S="prev"===i||!i;let M=0,T=0;const E=y?Math.ceil(c.length/p.grid.rows):c.length,A=(y?c[s].column:s)+(f&&void 0===r?-m/2+.5:0);if(A<v){M=Math.max(v-A,g);for(let t=0;t<v-A;t+=1){const e=t-Math.floor(t/E)*E;if(y){const t=E-e-1;for(let e=c.length-1;e>=0;e-=1)c[e].column===t&&x.push(e)}else x.push(E-e-1)}}else if(A+m>E-v){T=Math.max(A-(E-2*v),g);for(let t=0;t<T;t+=1){const e=t-Math.floor(t/E)*E;y?c.forEach(((t,n)=>{t.column===e&&b.push(n)})):b.push(e)}}if(l.__preventObserver__=!0,requestAnimationFrame((()=>{l.__preventObserver__=!1})),S&&x.forEach((t=>{c[t].swiperLoopMoveDOM=!0,d.prepend(c[t]),c[t].swiperLoopMoveDOM=!1})),w&&b.forEach((t=>{c[t].swiperLoopMoveDOM=!0,d.append(c[t]),c[t].swiperLoopMoveDOM=!1})),l.recalcSlides(),"auto"===p.slidesPerView?l.updateSlides():y&&(x.length>0&&S||b.length>0&&w)&&l.slides.forEach(((t,e)=>{l.grid.updateSlide(e,t,l.slides)})),p.watchSlidesProgress&&l.updateSlidesOffset(),n)if(x.length>0&&S){if(void 0===e){const t=l.slidesGrid[_],e=l.slidesGrid[_+M]-t;o?l.setTranslate(l.translate-e):(l.slideTo(_+Math.ceil(M),0,!1,!0),r&&(l.touchEventsData.startTranslate=l.touchEventsData.startTranslate-e,l.touchEventsData.currentTranslate=l.touchEventsData.currentTranslate-e))}else if(r){const t=y?x.length/p.grid.rows:x.length;l.slideTo(l.activeIndex+t,0,!1,!0),l.touchEventsData.currentTranslate=l.translate}}else if(b.length>0&&w)if(void 0===e){const t=l.slidesGrid[_],e=l.slidesGrid[_-T]-t;o?l.setTranslate(l.translate-e):(l.slideTo(_-T,0,!1,!0),r&&(l.touchEventsData.startTranslate=l.touchEventsData.startTranslate-e,l.touchEventsData.currentTranslate=l.touchEventsData.currentTranslate-e))}else{const t=y?b.length/p.grid.rows:b.length;l.slideTo(l.activeIndex-t,0,!1,!0)}if(l.allowSlidePrev=h,l.allowSlideNext=u,l.controller&&l.controller.control&&!a){const t={slideRealIndex:e,direction:i,setTranslate:r,activeSlideIndex:s,byController:!0};Array.isArray(l.controller.control)?l.controller.control.forEach((e=>{!e.destroyed&&e.params.loop&&e.loopFix({...t,slideTo:e.params.slidesPerView===p.slidesPerView&&n})})):l.controller.control instanceof l.constructor&&l.controller.control.params.loop&&l.controller.control.loopFix({...t,slideTo:l.controller.control.params.slidesPerView===p.slidesPerView&&n})}l.emit("loopFix")},loopDestroy:function(){const t=this,{params:e,slidesEl:n}=t;if(!e.loop||t.virtual&&t.params.virtual.enabled)return;t.recalcSlides();const i=[];t.slides.forEach((t=>{const e=void 0===t.swiperSlideIndex?1*t.getAttribute("data-swiper-slide-index"):t.swiperSlideIndex;i[e]=t})),t.slides.forEach((t=>{t.removeAttribute("data-swiper-slide-index")})),i.forEach((t=>{n.append(t)})),t.recalcSlides(),t.slideTo(t.realIndex,0)}};function nd(t,e,n){const i=_u(),{params:r}=t,s=r.edgeSwipeDetection,a=r.edgeSwipeThreshold;return!s||!(n<=a||n>=i.innerWidth-a)||"prevent"===s&&(e.preventDefault(),!0)}function id(t){const e=this,n=xu();let i=t;i.originalEvent&&(i=i.originalEvent);const r=e.touchEventsData;if("pointerdown"===i.type){if(null!==r.pointerId&&r.pointerId!==i.pointerId)return;r.pointerId=i.pointerId}else"touchstart"===i.type&&1===i.targetTouches.length&&(r.touchId=i.targetTouches[0].identifier);if("touchstart"===i.type)return void nd(e,i,i.targetTouches[0].pageX);const{params:s,touches:a,enabled:o}=e;if(!o)return;if(!s.simulateTouch&&"mouse"===i.pointerType)return;if(e.animating&&s.preventInteractionOnTransition)return;!e.animating&&s.cssMode&&s.loop&&e.loopFix();let l=i.target;if("wrapper"===s.touchEventsTarget&&!e.wrapperEl.contains(l))return;if("which"in i&&3===i.which)return;if("button"in i&&i.button>0)return;if(r.isTouched&&r.isMoved)return;const c=!!s.noSwipingClass&&""!==s.noSwipingClass,h=i.composedPath?i.composedPath():i.path;c&&i.target&&i.target.shadowRoot&&h&&(l=h[0]);const u=s.noSwipingSelector?s.noSwipingSelector:`.${s.noSwipingClass}`,d=!(!i.target||!i.target.shadowRoot);if(s.noSwiping&&(d?function(t,e){return void 0===e&&(e=this),function e(n){if(!n||n===xu()||n===_u())return null;n.assignedSlot&&(n=n.assignedSlot);const i=n.closest(t);return i||n.getRootNode?i||e(n.getRootNode().host):null}(e)}(u,l):l.closest(u)))return void(e.allowClick=!0);if(s.swipeHandler&&!l.closest(s.swipeHandler))return;a.currentX=i.pageX,a.currentY=i.pageY;const p=a.currentX,f=a.currentY;if(!nd(e,i,p))return;Object.assign(r,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),a.startX=p,a.startY=f,r.touchStartTime=Su(),e.allowClick=!0,e.updateSize(),e.swipeDirection=void 0,s.threshold>0&&(r.allowThresholdMove=!1);let m=!0;l.matches(r.focusableElements)&&(m=!1,"SELECT"===l.nodeName&&(r.isTouched=!1)),n.activeElement&&n.activeElement.matches(r.focusableElements)&&n.activeElement!==l&&n.activeElement.blur();const g=m&&e.allowTouchMove&&s.touchStartPreventDefault;!s.touchStartForcePreventDefault&&!g||l.isContentEditable||i.preventDefault(),s.freeMode&&s.freeMode.enabled&&e.freeMode&&e.animating&&!s.cssMode&&e.freeMode.onTouchStart(),e.emit("touchStart",i)}function rd(t){const e=xu(),n=this,i=n.touchEventsData,{params:r,touches:s,rtlTranslate:a,enabled:o}=n;if(!o)return;if(!r.simulateTouch&&"mouse"===t.pointerType)return;let l,c=t;if(c.originalEvent&&(c=c.originalEvent),"pointermove"===c.type){if(null!==i.touchId)return;if(c.pointerId!==i.pointerId)return}if("touchmove"===c.type){if(l=[...c.changedTouches].filter((t=>t.identifier===i.touchId))[0],!l||l.identifier!==i.touchId)return}else l=c;if(!i.isTouched)return void(i.startMoving&&i.isScrolling&&n.emit("touchMoveOpposite",c));const h=l.pageX,u=l.pageY;if(c.preventedByNestedSwiper)return s.startX=h,void(s.startY=u);if(!n.allowTouchMove)return c.target.matches(i.focusableElements)||(n.allowClick=!1),void(i.isTouched&&(Object.assign(s,{startX:h,startY:u,currentX:h,currentY:u}),i.touchStartTime=Su()));if(r.touchReleaseOnEdges&&!r.loop)if(n.isVertical()){if(u<s.startY&&n.translate<=n.maxTranslate()||u>s.startY&&n.translate>=n.minTranslate())return i.isTouched=!1,void(i.isMoved=!1)}else if(h<s.startX&&n.translate<=n.maxTranslate()||h>s.startX&&n.translate>=n.minTranslate())return;if(e.activeElement&&c.target===e.activeElement&&c.target.matches(i.focusableElements))return i.isMoved=!0,void(n.allowClick=!1);i.allowTouchCallbacks&&n.emit("touchMove",c),s.previousX=s.currentX,s.previousY=s.currentY,s.currentX=h,s.currentY=u;const d=s.currentX-s.startX,p=s.currentY-s.startY;if(n.params.threshold&&Math.sqrt(d**2+p**2)<n.params.threshold)return;if(void 0===i.isScrolling){let t;n.isHorizontal()&&s.currentY===s.startY||n.isVertical()&&s.currentX===s.startX?i.isScrolling=!1:d*d+p*p>=25&&(t=180*Math.atan2(Math.abs(p),Math.abs(d))/Math.PI,i.isScrolling=n.isHorizontal()?t>r.touchAngle:90-t>r.touchAngle)}if(i.isScrolling&&n.emit("touchMoveOpposite",c),void 0===i.startMoving&&(s.currentX===s.startX&&s.currentY===s.startY||(i.startMoving=!0)),i.isScrolling||"touchmove"===c.type&&i.preventTouchMoveFromPointerMove)return void(i.isTouched=!1);if(!i.startMoving)return;n.allowClick=!1,!r.cssMode&&c.cancelable&&c.preventDefault(),r.touchMoveStopPropagation&&!r.nested&&c.stopPropagation();let f=n.isHorizontal()?d:p,m=n.isHorizontal()?s.currentX-s.previousX:s.currentY-s.previousY;r.oneWayMovement&&(f=Math.abs(f)*(a?1:-1),m=Math.abs(m)*(a?1:-1)),s.diff=f,f*=r.touchRatio,a&&(f=-f,m=-m);const g=n.touchesDirection;n.swipeDirection=f>0?"prev":"next",n.touchesDirection=m>0?"prev":"next";const v=n.params.loop&&!r.cssMode,y="next"===n.touchesDirection&&n.allowSlideNext||"prev"===n.touchesDirection&&n.allowSlidePrev;if(!i.isMoved){if(v&&y&&n.loopFix({direction:n.swipeDirection}),i.startTranslate=n.getTranslate(),n.setTransition(0),n.animating){const t=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0,detail:{bySwiperTouchMove:!0}});n.wrapperEl.dispatchEvent(t)}i.allowMomentumBounce=!1,!r.grabCursor||!0!==n.allowSlideNext&&!0!==n.allowSlidePrev||n.setGrabCursor(!0),n.emit("sliderFirstMove",c)}if((new Date).getTime(),i.isMoved&&i.allowThresholdMove&&g!==n.touchesDirection&&v&&y&&Math.abs(f)>=1)return Object.assign(s,{startX:h,startY:u,currentX:h,currentY:u,startTranslate:i.currentTranslate}),i.loopSwapReset=!0,void(i.startTranslate=i.currentTranslate);n.emit("sliderMove",c),i.isMoved=!0,i.currentTranslate=f+i.startTranslate;let x=!0,b=r.resistanceRatio;if(r.touchReleaseOnEdges&&(b=0),f>0?(v&&y&&i.allowThresholdMove&&i.currentTranslate>(r.centeredSlides?n.minTranslate()-n.slidesSizesGrid[n.activeIndex+1]:n.minTranslate())&&n.loopFix({direction:"prev",setTranslate:!0,activeSlideIndex:0}),i.currentTranslate>n.minTranslate()&&(x=!1,r.resistance&&(i.currentTranslate=n.minTranslate()-1+(-n.minTranslate()+i.startTranslate+f)**b))):f<0&&(v&&y&&i.allowThresholdMove&&i.currentTranslate<(r.centeredSlides?n.maxTranslate()+n.slidesSizesGrid[n.slidesSizesGrid.length-1]:n.maxTranslate())&&n.loopFix({direction:"next",setTranslate:!0,activeSlideIndex:n.slides.length-("auto"===r.slidesPerView?n.slidesPerViewDynamic():Math.ceil(parseFloat(r.slidesPerView,10)))}),i.currentTranslate<n.maxTranslate()&&(x=!1,r.resistance&&(i.currentTranslate=n.maxTranslate()+1-(n.maxTranslate()-i.startTranslate-f)**b))),x&&(c.preventedByNestedSwiper=!0),!n.allowSlideNext&&"next"===n.swipeDirection&&i.currentTranslate<i.startTranslate&&(i.currentTranslate=i.startTranslate),!n.allowSlidePrev&&"prev"===n.swipeDirection&&i.currentTranslate>i.startTranslate&&(i.currentTranslate=i.startTranslate),n.allowSlidePrev||n.allowSlideNext||(i.currentTranslate=i.startTranslate),r.threshold>0){if(!(Math.abs(f)>r.threshold||i.allowThresholdMove))return void(i.currentTranslate=i.startTranslate);if(!i.allowThresholdMove)return i.allowThresholdMove=!0,s.startX=s.currentX,s.startY=s.currentY,i.currentTranslate=i.startTranslate,void(s.diff=n.isHorizontal()?s.currentX-s.startX:s.currentY-s.startY)}r.followFinger&&!r.cssMode&&((r.freeMode&&r.freeMode.enabled&&n.freeMode||r.watchSlidesProgress)&&(n.updateActiveIndex(),n.updateSlidesClasses()),r.freeMode&&r.freeMode.enabled&&n.freeMode&&n.freeMode.onTouchMove(),n.updateProgress(i.currentTranslate),n.setTranslate(i.currentTranslate))}function sd(t){const e=this,n=e.touchEventsData;let i,r=t;r.originalEvent&&(r=r.originalEvent);if("touchend"===r.type||"touchcancel"===r.type){if(i=[...r.changedTouches].filter((t=>t.identifier===n.touchId))[0],!i||i.identifier!==n.touchId)return}else{if(null!==n.touchId)return;if(r.pointerId!==n.pointerId)return;i=r}if(["pointercancel","pointerout","pointerleave","contextmenu"].includes(r.type)){if(!(["pointercancel","contextmenu"].includes(r.type)&&(e.browser.isSafari||e.browser.isWebView)))return}n.pointerId=null,n.touchId=null;const{params:s,touches:a,rtlTranslate:o,slidesGrid:l,enabled:c}=e;if(!c)return;if(!s.simulateTouch&&"mouse"===r.pointerType)return;if(n.allowTouchCallbacks&&e.emit("touchEnd",r),n.allowTouchCallbacks=!1,!n.isTouched)return n.isMoved&&s.grabCursor&&e.setGrabCursor(!1),n.isMoved=!1,void(n.startMoving=!1);s.grabCursor&&n.isMoved&&n.isTouched&&(!0===e.allowSlideNext||!0===e.allowSlidePrev)&&e.setGrabCursor(!1);const h=Su(),u=h-n.touchStartTime;if(e.allowClick){const t=r.path||r.composedPath&&r.composedPath();e.updateClickedSlide(t&&t[0]||r.target,t),e.emit("tap click",r),u<300&&h-n.lastClickTime<300&&e.emit("doubleTap doubleClick",r)}if(n.lastClickTime=Su(),wu((()=>{e.destroyed||(e.allowClick=!0)})),!n.isTouched||!n.isMoved||!e.swipeDirection||0===a.diff&&!n.loopSwapReset||n.currentTranslate===n.startTranslate&&!n.loopSwapReset)return n.isTouched=!1,n.isMoved=!1,void(n.startMoving=!1);let d;if(n.isTouched=!1,n.isMoved=!1,n.startMoving=!1,d=s.followFinger?o?e.translate:-e.translate:-n.currentTranslate,s.cssMode)return;if(s.freeMode&&s.freeMode.enabled)return void e.freeMode.onTouchEnd({currentPos:d});const p=d>=-e.maxTranslate()&&!e.params.loop;let f=0,m=e.slidesSizesGrid[0];for(let t=0;t<l.length;t+=t<s.slidesPerGroupSkip?1:s.slidesPerGroup){const e=t<s.slidesPerGroupSkip-1?1:s.slidesPerGroup;void 0!==l[t+e]?(p||d>=l[t]&&d<l[t+e])&&(f=t,m=l[t+e]-l[t]):(p||d>=l[t])&&(f=t,m=l[l.length-1]-l[l.length-2])}let g=null,v=null;s.rewind&&(e.isBeginning?v=s.virtual&&s.virtual.enabled&&e.virtual?e.virtual.slides.length-1:e.slides.length-1:e.isEnd&&(g=0));const y=(d-l[f])/m,x=f<s.slidesPerGroupSkip-1?1:s.slidesPerGroup;if(u>s.longSwipesMs){if(!s.longSwipes)return void e.slideTo(e.activeIndex);"next"===e.swipeDirection&&(y>=s.longSwipesRatio?e.slideTo(s.rewind&&e.isEnd?g:f+x):e.slideTo(f)),"prev"===e.swipeDirection&&(y>1-s.longSwipesRatio?e.slideTo(f+x):null!==v&&y<0&&Math.abs(y)>s.longSwipesRatio?e.slideTo(v):e.slideTo(f))}else{if(!s.shortSwipes)return void e.slideTo(e.activeIndex);e.navigation&&(r.target===e.navigation.nextEl||r.target===e.navigation.prevEl)?r.target===e.navigation.nextEl?e.slideTo(f+x):e.slideTo(f):("next"===e.swipeDirection&&e.slideTo(null!==g?g:f+x),"prev"===e.swipeDirection&&e.slideTo(null!==v?v:f))}}function ad(){const t=this,{params:e,el:n}=t;if(n&&0===n.offsetWidth)return;e.breakpoints&&t.setBreakpoint();const{allowSlideNext:i,allowSlidePrev:r,snapGrid:s}=t,a=t.virtual&&t.params.virtual.enabled;t.allowSlideNext=!0,t.allowSlidePrev=!0,t.updateSize(),t.updateSlides(),t.updateSlidesClasses();const o=a&&e.loop;!("auto"===e.slidesPerView||e.slidesPerView>1)||!t.isEnd||t.isBeginning||t.params.centeredSlides||o?t.params.loop&&!a?t.slideToLoop(t.realIndex,0,!1,!0):t.slideTo(t.activeIndex,0,!1,!0):t.slideTo(t.slides.length-1,0,!1,!0),t.autoplay&&t.autoplay.running&&t.autoplay.paused&&(clearTimeout(t.autoplay.resizeTimeout),t.autoplay.resizeTimeout=setTimeout((()=>{t.autoplay&&t.autoplay.running&&t.autoplay.paused&&t.autoplay.resume()}),500)),t.allowSlidePrev=r,t.allowSlideNext=i,t.params.watchOverflow&&s!==t.snapGrid&&t.checkOverflow()}function od(t){const e=this;e.enabled&&(e.allowClick||(e.params.preventClicks&&t.preventDefault(),e.params.preventClicksPropagation&&e.animating&&(t.stopPropagation(),t.stopImmediatePropagation())))}function ld(){const t=this,{wrapperEl:e,rtlTranslate:n,enabled:i}=t;if(!i)return;let r;t.previousTranslate=t.translate,t.isHorizontal()?t.translate=-e.scrollLeft:t.translate=-e.scrollTop,0===t.translate&&(t.translate=0),t.updateActiveIndex(),t.updateSlidesClasses();const s=t.maxTranslate()-t.minTranslate();r=0===s?0:(t.translate-t.minTranslate())/s,r!==t.progress&&t.updateProgress(n?-t.translate:t.translate),t.emit("setTranslate",t.translate,!1)}function cd(t){const e=this;$u(e,t.target),e.params.cssMode||"auto"!==e.params.slidesPerView&&!e.params.autoHeight||e.update()}function hd(){const t=this;t.documentTouchHandlerProceeded||(t.documentTouchHandlerProceeded=!0,t.params.touchReleaseOnEdges&&(t.el.style.touchAction="auto"))}const ud=(t,e)=>{const n=xu(),{params:i,el:r,wrapperEl:s,device:a}=t,o=!!i.nested,l="on"===e?"addEventListener":"removeEventListener",c=e;r&&"string"!=typeof r&&(n[l]("touchstart",t.onDocumentTouchStart,{passive:!1,capture:o}),r[l]("touchstart",t.onTouchStart,{passive:!1}),r[l]("pointerdown",t.onTouchStart,{passive:!1}),n[l]("touchmove",t.onTouchMove,{passive:!1,capture:o}),n[l]("pointermove",t.onTouchMove,{passive:!1,capture:o}),n[l]("touchend",t.onTouchEnd,{passive:!0}),n[l]("pointerup",t.onTouchEnd,{passive:!0}),n[l]("pointercancel",t.onTouchEnd,{passive:!0}),n[l]("touchcancel",t.onTouchEnd,{passive:!0}),n[l]("pointerout",t.onTouchEnd,{passive:!0}),n[l]("pointerleave",t.onTouchEnd,{passive:!0}),n[l]("contextmenu",t.onTouchEnd,{passive:!0}),(i.preventClicks||i.preventClicksPropagation)&&r[l]("click",t.onClick,!0),i.cssMode&&s[l]("scroll",t.onScroll),i.updateOnWindowResize?t[c](a.ios||a.android?"resize orientationchange observerUpdate":"resize observerUpdate",ad,!0):t[c]("observerUpdate",ad,!0),r[l]("load",t.onLoad,{capture:!0}))};const dd=(t,e)=>t.grid&&e.grid&&e.grid.rows>1;var pd={setBreakpoint:function(){const t=this,{realIndex:e,initialized:n,params:i,el:r}=t,s=i.breakpoints;if(!s||s&&0===Object.keys(s).length)return;const a=t.getBreakpoint(s,t.params.breakpointsBase,t.el);if(!a||t.currentBreakpoint===a)return;const o=(a in s?s[a]:void 0)||t.originalParams,l=dd(t,i),c=dd(t,o),h=t.params.grabCursor,u=o.grabCursor,d=i.enabled;l&&!c?(r.classList.remove(`${i.containerModifierClass}grid`,`${i.containerModifierClass}grid-column`),t.emitContainerClasses()):!l&&c&&(r.classList.add(`${i.containerModifierClass}grid`),(o.grid.fill&&"column"===o.grid.fill||!o.grid.fill&&"column"===i.grid.fill)&&r.classList.add(`${i.containerModifierClass}grid-column`),t.emitContainerClasses()),h&&!u?t.unsetGrabCursor():!h&&u&&t.setGrabCursor(),["navigation","pagination","scrollbar"].forEach((e=>{if(void 0===o[e])return;const n=i[e]&&i[e].enabled,r=o[e]&&o[e].enabled;n&&!r&&t[e].disable(),!n&&r&&t[e].enable()}));const p=o.direction&&o.direction!==i.direction,f=i.loop&&(o.slidesPerView!==i.slidesPerView||p),m=i.loop;p&&n&&t.changeDirection(),Eu(t.params,o);const g=t.params.enabled,v=t.params.loop;Object.assign(t,{allowTouchMove:t.params.allowTouchMove,allowSlideNext:t.params.allowSlideNext,allowSlidePrev:t.params.allowSlidePrev}),d&&!g?t.disable():!d&&g&&t.enable(),t.currentBreakpoint=a,t.emit("_beforeBreakpoint",o),n&&(f?(t.loopDestroy(),t.loopCreate(e),t.updateSlides()):!m&&v?(t.loopCreate(e),t.updateSlides()):m&&!v&&t.loopDestroy()),t.emit("breakpoint",o)},getBreakpoint:function(t,e,n){if(void 0===e&&(e="window"),!t||"container"===e&&!n)return;let i=!1;const r=_u(),s="window"===e?r.innerHeight:n.clientHeight,a=Object.keys(t).map((t=>{if("string"==typeof t&&0===t.indexOf("@")){const e=parseFloat(t.substr(1));return{value:s*e,point:t}}return{value:t,point:t}}));a.sort(((t,e)=>parseInt(t.value,10)-parseInt(e.value,10)));for(let t=0;t<a.length;t+=1){const{point:s,value:o}=a[t];"window"===e?r.matchMedia(`(min-width: ${o}px)`).matches&&(i=s):o<=n.clientWidth&&(i=s)}return i||"max"}};var fd={addClasses:function(){const t=this,{classNames:e,params:n,rtl:i,el:r,device:s}=t,a=function(t,e){const n=[];return t.forEach((t=>{"object"==typeof t?Object.keys(t).forEach((i=>{t[i]&&n.push(e+i)})):"string"==typeof t&&n.push(e+t)})),n}(["initialized",n.direction,{"free-mode":t.params.freeMode&&n.freeMode.enabled},{autoheight:n.autoHeight},{rtl:i},{grid:n.grid&&n.grid.rows>1},{"grid-column":n.grid&&n.grid.rows>1&&"column"===n.grid.fill},{android:s.android},{ios:s.ios},{"css-mode":n.cssMode},{centered:n.cssMode&&n.centeredSlides},{"watch-progress":n.watchSlidesProgress}],n.containerModifierClass);e.push(...a),r.classList.add(...e),t.emitContainerClasses()},removeClasses:function(){const{el:t,classNames:e}=this;t&&"string"!=typeof t&&(t.classList.remove(...e),this.emitContainerClasses())}};var md={init:!0,direction:"horizontal",oneWayMovement:!1,swiperElementNodeName:"SWIPER-CONTAINER",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,eventsPrefix:"swiper",enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:5,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,loop:!1,loopAddBlankSlides:!0,loopAdditionalSlides:0,loopPreventsSliding:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-blank",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideFullyVisibleClass:"swiper-slide-fully-visible",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",lazyPreloaderClass:"swiper-lazy-preloader",lazyPreloadPrevNext:0,runCallbacksOnInit:!0,_emitClasses:!1};function gd(t,e){return function(n){void 0===n&&(n={});const i=Object.keys(n)[0],r=n[i];"object"==typeof r&&null!==r?(!0===t[i]&&(t[i]={enabled:!0}),"navigation"===i&&t[i]&&t[i].enabled&&!t[i].prevEl&&!t[i].nextEl&&(t[i].auto=!0),["pagination","scrollbar"].indexOf(i)>=0&&t[i]&&t[i].enabled&&!t[i].el&&(t[i].auto=!0),i in t&&"enabled"in r?("object"!=typeof t[i]||"enabled"in t[i]||(t[i].enabled=!0),t[i]||(t[i]={enabled:!1}),Eu(e,n)):Eu(e,n)):Eu(e,n)}}const vd={eventsEmitter:Wu,update:Ku,translate:Ju,transition:{setTransition:function(t,e){const n=this;n.params.cssMode||(n.wrapperEl.style.transitionDuration=`${t}ms`,n.wrapperEl.style.transitionDelay=0===t?"0ms":""),n.emit("setTransition",t,e)},transitionStart:function(t,e){void 0===t&&(t=!0);const n=this,{params:i}=n;i.cssMode||(i.autoHeight&&n.updateAutoHeight(),Qu({swiper:n,runCallbacks:t,direction:e,step:"Start"}))},transitionEnd:function(t,e){void 0===t&&(t=!0);const n=this,{params:i}=n;n.animating=!1,i.cssMode||(n.setTransition(0),Qu({swiper:n,runCallbacks:t,direction:e,step:"End"}))}},slide:td,loop:ed,grabCursor:{setGrabCursor:function(t){const e=this;if(!e.params.simulateTouch||e.params.watchOverflow&&e.isLocked||e.params.cssMode)return;const n="container"===e.params.touchEventsTarget?e.el:e.wrapperEl;e.isElement&&(e.__preventObserver__=!0),n.style.cursor="move",n.style.cursor=t?"grabbing":"grab",e.isElement&&requestAnimationFrame((()=>{e.__preventObserver__=!1}))},unsetGrabCursor:function(){const t=this;t.params.watchOverflow&&t.isLocked||t.params.cssMode||(t.isElement&&(t.__preventObserver__=!0),t["container"===t.params.touchEventsTarget?"el":"wrapperEl"].style.cursor="",t.isElement&&requestAnimationFrame((()=>{t.__preventObserver__=!1})))}},events:{attachEvents:function(){const t=this,{params:e}=t;t.onTouchStart=id.bind(t),t.onTouchMove=rd.bind(t),t.onTouchEnd=sd.bind(t),t.onDocumentTouchStart=hd.bind(t),e.cssMode&&(t.onScroll=ld.bind(t)),t.onClick=od.bind(t),t.onLoad=cd.bind(t),ud(t,"on")},detachEvents:function(){ud(this,"off")}},breakpoints:pd,checkOverflow:{checkOverflow:function(){const t=this,{isLocked:e,params:n}=t,{slidesOffsetBefore:i}=n;if(i){const e=t.slides.length-1,n=t.slidesGrid[e]+t.slidesSizesGrid[e]+2*i;t.isLocked=t.size>n}else t.isLocked=1===t.snapGrid.length;!0===n.allowSlideNext&&(t.allowSlideNext=!t.isLocked),!0===n.allowSlidePrev&&(t.allowSlidePrev=!t.isLocked),e&&e!==t.isLocked&&(t.isEnd=!1),e!==t.isLocked&&t.emit(t.isLocked?"lock":"unlock")}},classes:fd},yd={};class xd{constructor(){let t,e;for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];1===i.length&&i[0].constructor&&"Object"===Object.prototype.toString.call(i[0]).slice(8,-1)?e=i[0]:[t,e]=i,e||(e={}),e=Eu({},e),t&&!e.el&&(e.el=t);const s=xu();if(e.el&&"string"==typeof e.el&&s.querySelectorAll(e.el).length>1){const t=[];return s.querySelectorAll(e.el).forEach((n=>{const i=Eu({},e,{el:n});t.push(new xd(i))})),t}const a=this;a.__swiper__=!0,a.support=ju(),a.device=Hu({userAgent:e.userAgent}),a.browser=Gu(),a.eventsListeners={},a.eventsAnyListeners=[],a.modules=[...a.__modules__],e.modules&&Array.isArray(e.modules)&&a.modules.push(...e.modules);const o={};a.modules.forEach((t=>{t({params:e,swiper:a,extendParams:gd(e,o),on:a.on.bind(a),once:a.once.bind(a),off:a.off.bind(a),emit:a.emit.bind(a)})}));const l=Eu({},md,o);return a.params=Eu({},l,yd,e),a.originalParams=Eu({},a.params),a.passedParams=Eu({},e),a.params&&a.params.on&&Object.keys(a.params.on).forEach((t=>{a.on(t,a.params.on[t])})),a.params&&a.params.onAny&&a.onAny(a.params.onAny),Object.assign(a,{enabled:a.params.enabled,el:t,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal:()=>"horizontal"===a.params.direction,isVertical:()=>"vertical"===a.params.direction,activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:a.params.allowSlideNext,allowSlidePrev:a.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:a.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,pointerId:null,touchId:null},allowClick:!0,allowTouchMove:a.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),a.emit("_swiper"),a.params.init&&a.init(),a}getDirectionLabel(t){return this.isHorizontal()?t:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[t]}getSlideIndex(t){const{slidesEl:e,params:n}=this,i=Iu(Ru(e,`.${n.slideClass}, swiper-slide`)[0]);return Iu(t)-i}getSlideIndexByData(t){return this.getSlideIndex(this.slides.filter((e=>1*e.getAttribute("data-swiper-slide-index")===t))[0])}recalcSlides(){const{slidesEl:t,params:e}=this;this.slides=Ru(t,`.${e.slideClass}, swiper-slide`)}enable(){const t=this;t.enabled||(t.enabled=!0,t.params.grabCursor&&t.setGrabCursor(),t.emit("enable"))}disable(){const t=this;t.enabled&&(t.enabled=!1,t.params.grabCursor&&t.unsetGrabCursor(),t.emit("disable"))}setProgress(t,e){const n=this;t=Math.min(Math.max(t,0),1);const i=n.minTranslate(),r=(n.maxTranslate()-i)*t+i;n.translateTo(r,void 0===e?0:e),n.updateActiveIndex(),n.updateSlidesClasses()}emitContainerClasses(){const t=this;if(!t.params._emitClasses||!t.el)return;const e=t.el.className.split(" ").filter((e=>0===e.indexOf("swiper")||0===e.indexOf(t.params.containerModifierClass)));t.emit("_containerClasses",e.join(" "))}getSlideClasses(t){const e=this;return e.destroyed?"":t.className.split(" ").filter((t=>0===t.indexOf("swiper-slide")||0===t.indexOf(e.params.slideClass))).join(" ")}emitSlidesClasses(){const t=this;if(!t.params._emitClasses||!t.el)return;const e=[];t.slides.forEach((n=>{const i=t.getSlideClasses(n);e.push({slideEl:n,classNames:i}),t.emit("_slideClass",n,i)})),t.emit("_slideClasses",e)}slidesPerViewDynamic(t,e){void 0===t&&(t="current"),void 0===e&&(e=!1);const{params:n,slides:i,slidesGrid:r,slidesSizesGrid:s,size:a,activeIndex:o}=this;let l=1;if("number"==typeof n.slidesPerView)return n.slidesPerView;if(n.centeredSlides){let t,e=i[o]?Math.ceil(i[o].swiperSlideSize):0;for(let n=o+1;n<i.length;n+=1)i[n]&&!t&&(e+=Math.ceil(i[n].swiperSlideSize),l+=1,e>a&&(t=!0));for(let n=o-1;n>=0;n-=1)i[n]&&!t&&(e+=i[n].swiperSlideSize,l+=1,e>a&&(t=!0))}else if("current"===t)for(let t=o+1;t<i.length;t+=1){(e?r[t]+s[t]-r[o]<a:r[t]-r[o]<a)&&(l+=1)}else for(let t=o-1;t>=0;t-=1){r[o]-r[t]<a&&(l+=1)}return l}update(){const t=this;if(!t||t.destroyed)return;const{snapGrid:e,params:n}=t;function i(){const e=t.rtlTranslate?-1*t.translate:t.translate,n=Math.min(Math.max(e,t.maxTranslate()),t.minTranslate());t.setTranslate(n),t.updateActiveIndex(),t.updateSlidesClasses()}let r;if(n.breakpoints&&t.setBreakpoint(),[...t.el.querySelectorAll('[loading="lazy"]')].forEach((e=>{e.complete&&$u(t,e)})),t.updateSize(),t.updateSlides(),t.updateProgress(),t.updateSlidesClasses(),n.freeMode&&n.freeMode.enabled&&!n.cssMode)i(),n.autoHeight&&t.updateAutoHeight();else{if(("auto"===n.slidesPerView||n.slidesPerView>1)&&t.isEnd&&!n.centeredSlides){const e=t.virtual&&n.virtual.enabled?t.virtual.slides:t.slides;r=t.slideTo(e.length-1,0,!1,!0)}else r=t.slideTo(t.activeIndex,0,!1,!0);r||i()}n.watchOverflow&&e!==t.snapGrid&&t.checkOverflow(),t.emit("update")}changeDirection(t,e){void 0===e&&(e=!0);const n=this,i=n.params.direction;return t||(t="horizontal"===i?"vertical":"horizontal"),t===i||"horizontal"!==t&&"vertical"!==t||(n.el.classList.remove(`${n.params.containerModifierClass}${i}`),n.el.classList.add(`${n.params.containerModifierClass}${t}`),n.emitContainerClasses(),n.params.direction=t,n.slides.forEach((e=>{"vertical"===t?e.style.width="":e.style.height=""})),n.emit("changeDirection"),e&&n.update()),n}changeLanguageDirection(t){const e=this;e.rtl&&"rtl"===t||!e.rtl&&"ltr"===t||(e.rtl="rtl"===t,e.rtlTranslate="horizontal"===e.params.direction&&e.rtl,e.rtl?(e.el.classList.add(`${e.params.containerModifierClass}rtl`),e.el.dir="rtl"):(e.el.classList.remove(`${e.params.containerModifierClass}rtl`),e.el.dir="ltr"),e.update())}mount(t){const e=this;if(e.mounted)return!0;let n=t||e.params.el;if("string"==typeof n&&(n=document.querySelector(n)),!n)return!1;n.swiper=e,n.parentNode&&n.parentNode.host&&n.parentNode.host.nodeName===e.params.swiperElementNodeName.toUpperCase()&&(e.isElement=!0);const i=()=>`.${(e.params.wrapperClass||"").trim().split(" ").join(".")}`;let r=(()=>{if(n&&n.shadowRoot&&n.shadowRoot.querySelector){return n.shadowRoot.querySelector(i())}return Ru(n,i())[0]})();return!r&&e.params.createElements&&(r=Du("div",e.params.wrapperClass),n.append(r),Ru(n,`.${e.params.slideClass}`).forEach((t=>{r.append(t)}))),Object.assign(e,{el:n,wrapperEl:r,slidesEl:e.isElement&&!n.parentNode.host.slideSlots?n.parentNode.host:r,hostEl:e.isElement?n.parentNode.host:n,mounted:!0,rtl:"rtl"===n.dir.toLowerCase()||"rtl"===Lu(n,"direction"),rtlTranslate:"horizontal"===e.params.direction&&("rtl"===n.dir.toLowerCase()||"rtl"===Lu(n,"direction")),wrongRTL:"-webkit-box"===Lu(r,"display")}),!0}init(t){const e=this;if(e.initialized)return e;if(!1===e.mount(t))return e;e.emit("beforeInit"),e.params.breakpoints&&e.setBreakpoint(),e.addClasses(),e.updateSize(),e.updateSlides(),e.params.watchOverflow&&e.checkOverflow(),e.params.grabCursor&&e.enabled&&e.setGrabCursor(),e.params.loop&&e.virtual&&e.params.virtual.enabled?e.slideTo(e.params.initialSlide+e.virtual.slidesBefore,0,e.params.runCallbacksOnInit,!1,!0):e.slideTo(e.params.initialSlide,0,e.params.runCallbacksOnInit,!1,!0),e.params.loop&&e.loopCreate(),e.attachEvents();const n=[...e.el.querySelectorAll('[loading="lazy"]')];return e.isElement&&n.push(...e.hostEl.querySelectorAll('[loading="lazy"]')),n.forEach((t=>{t.complete?$u(e,t):t.addEventListener("load",(t=>{$u(e,t.target)}))})),Zu(e),e.initialized=!0,Zu(e),e.emit("init"),e.emit("afterInit"),e}destroy(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0);const n=this,{params:i,el:r,wrapperEl:s,slides:a}=n;return void 0===n.params||n.destroyed||(n.emit("beforeDestroy"),n.initialized=!1,n.detachEvents(),i.loop&&n.loopDestroy(),e&&(n.removeClasses(),r&&"string"!=typeof r&&r.removeAttribute("style"),s&&s.removeAttribute("style"),a&&a.length&&a.forEach((t=>{t.classList.remove(i.slideVisibleClass,i.slideFullyVisibleClass,i.slideActiveClass,i.slideNextClass,i.slidePrevClass),t.removeAttribute("style"),t.removeAttribute("data-swiper-slide-index")}))),n.emit("destroy"),Object.keys(n.eventsListeners).forEach((t=>{n.off(t)})),!1!==t&&(n.el&&"string"!=typeof n.el&&(n.el.swiper=null),function(t){const e=t;Object.keys(e).forEach((t=>{try{e[t]=null}catch(t){}try{delete e[t]}catch(t){}}))}(n)),n.destroyed=!0),null}static extendDefaults(t){Eu(yd,t)}static get extendedDefaults(){return yd}static get defaults(){return md}static installModule(t){xd.prototype.__modules__||(xd.prototype.__modules__=[]);const e=xd.prototype.__modules__;"function"==typeof t&&e.indexOf(t)<0&&e.push(t)}static use(t){return Array.isArray(t)?(t.forEach((t=>xd.installModule(t))),xd):(xd.installModule(t),xd)}}function bd(t,e,n,i){return t.params.createElements&&Object.keys(i).forEach((r=>{if(!n[r]&&!0===n.auto){let s=Ru(t.el,`.${i[r]}`)[0];s||(s=Du("div",i[r]),s.className=i[r],t.el.append(s)),n[r]=s,e[r]=s}})),n}function _d(t){return void 0===t&&(t=""),`.${t.trim().replace(/([\.:!+\/])/g,"\\$1").replace(/ /g,".")}`}function wd(t){const{effect:e,swiper:n,on:i,setTranslate:r,setTransition:s,overwriteParams:a,perspective:o,recreateShadows:l,getEffectParams:c}=t;let h;i("beforeInit",(()=>{if(n.params.effect!==e)return;n.classNames.push(`${n.params.containerModifierClass}${e}`),o&&o()&&n.classNames.push(`${n.params.containerModifierClass}3d`);const t=a?a():{};Object.assign(n.params,t),Object.assign(n.originalParams,t)})),i("setTranslate",(()=>{n.params.effect===e&&r()})),i("setTransition",((t,i)=>{n.params.effect===e&&s(i)})),i("transitionEnd",(()=>{if(n.params.effect===e&&l){if(!c||!c().slideShadows)return;n.slides.forEach((t=>{t.querySelectorAll(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").forEach((t=>t.remove()))})),l()}})),i("virtualUpdate",(()=>{n.params.effect===e&&(n.slides.length||(h=!0),requestAnimationFrame((()=>{h&&n.slides&&n.slides.length&&(r(),h=!1)})))}))}function Sd(t,e){const n=Pu(e);return n!==e&&(n.style.backfaceVisibility="hidden",n.style["-webkit-backface-visibility"]="hidden"),n}function Md(t){let{swiper:e,duration:n,transformElements:i,allSlides:r}=t;const{activeIndex:s}=e;if(e.params.virtualTranslate&&0!==n){let t,n=!1;t=r?i:i.filter((t=>{const n=t.classList.contains("swiper-slide-transform")?(t=>{if(!t.parentElement)return e.slides.filter((e=>e.shadowRoot&&e.shadowRoot===t.parentNode))[0];return t.parentElement})(t):t;return e.getSlideIndex(n)===s})),t.forEach((t=>{Nu(t,(()=>{if(n)return;if(!e||e.destroyed)return;n=!0,e.animating=!1;const t=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0});e.wrapperEl.dispatchEvent(t)}))}))}}function Td(t,e,n){const i=`swiper-slide-shadow${n?`-${n}`:""}${t?` swiper-slide-shadow-${t}`:""}`,r=Pu(e);let s=r.querySelector(`.${i.split(" ").join(".")}`);return s||(s=Du("div",i.split(" ")),r.append(s)),s}Object.keys(vd).forEach((t=>{Object.keys(vd[t]).forEach((e=>{xd.prototype[e]=vd[t][e]}))})),xd.use([function(t){let{swiper:e,on:n,emit:i}=t;const r=_u();let s=null,a=null;const o=()=>{e&&!e.destroyed&&e.initialized&&(i("beforeResize"),i("resize"))},l=()=>{e&&!e.destroyed&&e.initialized&&i("orientationchange")};n("init",(()=>{e.params.resizeObserver&&void 0!==r.ResizeObserver?e&&!e.destroyed&&e.initialized&&(s=new ResizeObserver((t=>{a=r.requestAnimationFrame((()=>{const{width:n,height:i}=e;let r=n,s=i;t.forEach((t=>{let{contentBoxSize:n,contentRect:i,target:a}=t;a&&a!==e.el||(r=i?i.width:(n[0]||n).inlineSize,s=i?i.height:(n[0]||n).blockSize)})),r===n&&s===i||o()}))})),s.observe(e.el)):(r.addEventListener("resize",o),r.addEventListener("orientationchange",l))})),n("destroy",(()=>{a&&r.cancelAnimationFrame(a),s&&s.unobserve&&e.el&&(s.unobserve(e.el),s=null),r.removeEventListener("resize",o),r.removeEventListener("orientationchange",l)}))},function(t){let{swiper:e,extendParams:n,on:i,emit:r}=t;const s=[],a=_u(),o=function(t,n){void 0===n&&(n={});const i=new(a.MutationObserver||a.WebkitMutationObserver)((t=>{if(e.__preventObserver__)return;if(1===t.length)return void r("observerUpdate",t[0]);const n=function(){r("observerUpdate",t[0])};a.requestAnimationFrame?a.requestAnimationFrame(n):a.setTimeout(n,0)}));i.observe(t,{attributes:void 0===n.attributes||n.attributes,childList:e.isElement||(void 0===n.childList||n).childList,characterData:void 0===n.characterData||n.characterData}),s.push(i)};n({observer:!1,observeParents:!1,observeSlideChildren:!1}),i("init",(()=>{if(e.params.observer){if(e.params.observeParents){const t=zu(e.hostEl);for(let e=0;e<t.length;e+=1)o(t[e])}o(e.hostEl,{childList:e.params.observeSlideChildren}),o(e.wrapperEl,{attributes:!1})}})),i("destroy",(()=>{s.forEach((t=>{t.disconnect()})),s.splice(0,s.length)}))}]);const Ed=768,Ad=1024,Cd=window.matchMedia(`(min-width: ${Ed}px)`).matches,Pd="166",Rd={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Od={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Dd=1,Ld=2,Id=3,zd=0,Nd=1,Ud=2,kd=1,Bd=100,Fd=101,Vd=102,jd=200,Hd=201,Gd=202,Wd=203,qd=204,Xd=205,$d=206,Yd=207,Zd=208,Kd=209,Jd=210,Qd=211,tp=212,ep=213,np=214,ip=0,rp=1,sp=2,ap=0,op=1,lp=2,cp=3,hp=4,up=5,dp=6,pp=7,fp=301,mp=302,gp=303,vp=304,yp=306,xp=1e3,bp=1001,_p=1002,wp=1003,Sp=1004,Mp=1005,Tp=1006,Ep=1007,Ap=1008,Cp=1009,Pp=1010,Rp=1011,Op=1012,Dp=1013,Lp=1014,Ip=1015,zp=1016,Np=1017,Up=1018,kp=1020,Bp=35902,Fp=1021,Vp=1022,jp=1023,Hp=1024,Gp=1025,Wp=1026,qp=1027,Xp=1028,$p=1029,Yp=1030,Zp=1031,Kp=1033,Jp=33776,Qp=33777,tf=33778,ef=33779,nf=35840,rf=35841,sf=35842,af=35843,of=36196,lf=37492,cf=37496,hf=37808,uf=37809,df=37810,pf=37811,ff=37812,mf=37813,gf=37814,vf=37815,yf=37816,xf=37817,bf=37818,_f=37819,wf=37820,Sf=37821,Mf=36492,Tf=36494,Ef=36495,Af=36283,Cf=36284,Pf=36285,Rf=36286,Of=2300,Df=2301,Lf=2302,If=2400,zf=2401,Nf=2402,Uf="",kf="srgb",Bf="srgb-linear",Ff="display-p3",Vf="display-p3-linear",jf="linear",Hf="srgb",Gf="rec709",Wf="p3",qf=7680,Xf=512,$f=513,Yf=514,Zf=515,Kf=516,Jf=517,Qf=518,tm=519,em=35044,nm=35048,im="300 es",rm=2e3,sm=2001;class am{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t);t.target=null}}}const om=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let lm=1234567;const cm=Math.PI/180,hm=180/Math.PI;function um(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(om[255&t]+om[t>>8&255]+om[t>>16&255]+om[t>>24&255]+"-"+om[255&e]+om[e>>8&255]+"-"+om[e>>16&15|64]+om[e>>24&255]+"-"+om[63&n|128]+om[n>>8&255]+"-"+om[n>>16&255]+om[n>>24&255]+om[255&i]+om[i>>8&255]+om[i>>16&255]+om[i>>24&255]).toLowerCase()}function dm(t,e,n){return Math.max(e,Math.min(n,t))}function pm(t,e){return(t%e+e)%e}function fm(t,e,n){return(1-n)*t+n*e}function mm(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function gm(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const vm={DEG2RAD:cm,RAD2DEG:hm,generateUUID:um,clamp:dm,euclideanModulo:pm,mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:fm,damp:function(t,e,n,i){return fm(t,e,1-Math.exp(-n*i))},pingpong:function(t,e=1){return e-Math.abs(pm(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(lm=t);let e=lm+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*cm},radToDeg:function(t){return t*hm},isPowerOfTwo:function(t){return!(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,i,r){const s=Math.cos,a=Math.sin,o=s(n/2),l=a(n/2),c=s((e+i)/2),h=a((e+i)/2),u=s((e-i)/2),d=a((e-i)/2),p=s((i-e)/2),f=a((i-e)/2);switch(r){case"XYX":t.set(o*h,l*u,l*d,o*c);break;case"YZY":t.set(l*d,o*h,l*u,o*c);break;case"ZXZ":t.set(l*u,l*d,o*h,o*c);break;case"XZX":t.set(o*h,l*f,l*p,o*c);break;case"YXY":t.set(l*p,o*h,l*f,o*c);break;case"ZYZ":t.set(l*f,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:gm,denormalize:mm};class ym{constructor(t=0,e=0){ym.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(dm(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*i+t.x,this.y=r*i+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class xm{constructor(t,e,n,i,r,s,a,o,l){xm.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,s,a,o,l)}set(t,e,n,i,r,s,a,o,l){const c=this.elements;return c[0]=t,c[1]=i,c[2]=a,c[3]=e,c[4]=r,c[5]=o,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],c=n[4],h=n[7],u=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],x=i[7],b=i[2],_=i[5],w=i[8];return r[0]=s*f+a*v+o*b,r[3]=s*m+a*y+o*_,r[6]=s*g+a*x+o*w,r[1]=l*f+c*v+h*b,r[4]=l*m+c*y+h*_,r[7]=l*g+c*x+h*w,r[2]=u*f+d*v+p*b,r[5]=u*m+d*y+p*_,r[8]=u*g+d*x+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8];return e*s*c-e*a*l-n*r*c+n*a*o+i*r*l-i*s*o}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=c*s-a*l,u=a*o-c*r,d=l*r-s*o,p=e*h+n*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return t[0]=h*f,t[1]=(i*l-c*n)*f,t[2]=(a*n-i*s)*f,t[3]=u*f,t[4]=(c*e-i*o)*f,t[5]=(i*r-a*e)*f,t[6]=d*f,t[7]=(n*o-l*e)*f,t[8]=(s*e-n*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(n*o,n*l,-n*(o*s+l*a)+s+t,-i*l,i*o,-i*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(bm.makeScale(t,e)),this}rotate(t){return this.premultiply(bm.makeRotation(-t)),this}translate(t,e){return this.premultiply(bm.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const bm=new xm;function _m(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const wm={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Sm(t,e){return new wm[t](e)}function Mm(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Tm(){const t=Mm("canvas");return t.style.display="block",t}const Em={};function Am(t){t in Em||(Em[t]=!0,console.warn(t))}const Cm=(new xm).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Pm=(new xm).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Rm={[Bf]:{transfer:jf,primaries:Gf,toReference:t=>t,fromReference:t=>t},[kf]:{transfer:Hf,primaries:Gf,toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[Vf]:{transfer:jf,primaries:Wf,toReference:t=>t.applyMatrix3(Pm),fromReference:t=>t.applyMatrix3(Cm)},[Ff]:{transfer:Hf,primaries:Wf,toReference:t=>t.convertSRGBToLinear().applyMatrix3(Pm),fromReference:t=>t.applyMatrix3(Cm).convertLinearToSRGB()}},Om=new Set([Bf,Vf]),Dm={enabled:!0,_workingColorSpace:Bf,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!Om.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,n){if(!1===this.enabled||e===n||!e||!n)return t;const i=Rm[e].toReference;return(0,Rm[n].fromReference)(i(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return Rm[t].primaries},getTransfer:function(t){return t===Uf?jf:Rm[t].transfer}};function Lm(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Im(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let zm;class Nm{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===zm&&(zm=Mm("canvas")),zm.width=t.width,zm.height=t.height;const n=zm.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=zm}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=Mm("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),r=i.data;for(let t=0;t<r.length;t++)r[t]=255*Lm(r[t]/255);return n.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Lm(e[t]/255)):e[t]=Lm(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Um=0;class km{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Um++}),this.uuid=um(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(Bm(i[e].image)):t.push(Bm(i[e]))}else t=Bm(i);n.url=t}return e||(t.images[this.uuid]=n),n}}function Bm(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Nm.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Fm=0;class Vm extends am{constructor(t=Vm.DEFAULT_IMAGE,e=Vm.DEFAULT_MAPPING,n=bp,i=bp,r=Tp,s=1008,a=jp,o=Cp,l=Vm.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Fm++}),this.uuid=um(),this.name="",this.source=new km(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new ym(0,0),this.repeat=new ym(1,1),this.center=new ym(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new xm,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case xp:t.x=t.x-Math.floor(t.x);break;case bp:t.x=t.x<0?0:1;break;case _p:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case xp:t.y=t.y-Math.floor(t.y);break;case bp:t.y=t.y<0?0:1;break;case _p:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}Vm.DEFAULT_IMAGE=null,Vm.DEFAULT_MAPPING=300,Vm.DEFAULT_ANISOTROPY=1;class jm{constructor(t=0,e=0,n=0,i=1){jm.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*e+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*e+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*e+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const s=.01,a=.1,o=t.elements,l=o[0],c=o[4],h=o[8],u=o[1],d=o[5],p=o[9],f=o[2],m=o[6],g=o[10];if(Math.abs(c-u)<s&&Math.abs(h-f)<s&&Math.abs(p-m)<s){if(Math.abs(c+u)<a&&Math.abs(h+f)<a&&Math.abs(p+m)<a&&Math.abs(l+d+g-3)<a)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,o=(d+1)/2,v=(g+1)/2,y=(c+u)/4,x=(h+f)/4,b=(p+m)/4;return t>o&&t>v?t<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(t),i=y/n,r=x/n):o>v?o<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(o),n=y/i,r=b/i):v<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=x/r,i=b/r),this.set(n,i,r,e),this}let v=Math.sqrt((m-p)*(m-p)+(h-f)*(h-f)+(u-c)*(u-c));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(h-f)/v,this.z=(u-c)/v,this.w=Math.acos((l+d+g-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Hm extends am{constructor(t=1,e=1,n={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new jm(0,0,t,e),this.scissorTest=!1,this.viewport=new jm(0,0,t,e);const i={width:t,height:e,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Tp,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const r=new Vm(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);r.flipY=!1,r.generateMipmaps=n.generateMipmaps,r.internalFormat=n.internalFormat,this.textures=[];const s=n.count;for(let t=0;t<s;t++)this.textures[t]=r.clone(),this.textures[t].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let i=0,r=this.textures.length;i<r;i++)this.textures[i].image.width=t,this.textures[i].image.height=e,this.textures[i].image.depth=n;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,n=t.textures.length;e<n;e++)this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new km(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Gm extends Hm{constructor(t=1,e=1,n={}){super(t,e,n),this.isWebGLRenderTarget=!0}}class Wm extends Vm{constructor(t=null,e=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=wp,this.minFilter=wp,this.wrapR=bp,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class qm extends Vm{constructor(t=null,e=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=wp,this.minFilter=wp,this.wrapR=bp,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Xm{constructor(t=0,e=0,n=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,r,s,a){let o=n[i+0],l=n[i+1],c=n[i+2],h=n[i+3];const u=r[s+0],d=r[s+1],p=r[s+2],f=r[s+3];if(0===a)return t[e+0]=o,t[e+1]=l,t[e+2]=c,void(t[e+3]=h);if(1===a)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=f);if(h!==f||o!==u||l!==d||c!==p){let t=1-a;const e=o*u+l*d+c*p+h*f,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,e*n);t=Math.sin(t*s)/r,a=Math.sin(a*s)/r}const r=a*n;if(o=o*t+u*r,l=l*t+d*r,c=c*t+p*r,h=h*t+f*r,t===1-a){const t=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=t,l*=t,c*=t,h*=t}}t[e]=o,t[e+1]=l,t[e+2]=c,t[e+3]=h}static multiplyQuaternionsFlat(t,e,n,i,r,s){const a=n[i],o=n[i+1],l=n[i+2],c=n[i+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=a*p+c*h+o*d-l*u,t[e+1]=o*p+c*u+l*h-a*d,t[e+2]=l*p+c*d+a*u-o*h,t[e+3]=c*p-a*h-o*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,i=t._y,r=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(n/2),c=a(i/2),h=a(r/2),u=o(n/2),d=o(i/2),p=o(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],s=e[1],a=e[5],o=e[9],l=e[2],c=e[6],h=e[10],u=n+a+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(c-o)*t,this._y=(r-l)*t,this._z=(s-i)*t}else if(n>a&&n>h){const t=2*Math.sqrt(1+n-a-h);this._w=(c-o)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(r+l)/t}else if(a>h){const t=2*Math.sqrt(1+a-n-h);this._w=(r-l)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(o+c)/t}else{const t=2*Math.sqrt(1+h-n-a);this._w=(s-i)/t,this._x=(r+l)/t,this._y=(o+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(dm(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,s=t._w,a=e._x,o=e._y,l=e._z,c=e._w;return this._x=n*c+s*a+i*l-r*o,this._y=i*c+s*o+r*a-n*l,this._z=r*c+s*l+n*o-i*a,this._w=s*c-n*a-i*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,s=this._w;let a=s*t._w+n*t._x+i*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this}const l=Math.sqrt(o),c=Math.atan2(l,a),h=Math.sin((1-e)*c)/l,u=Math.sin(e*c)/l;return this._w=s*h+this._w*u,this._x=n*h+this._x*u,this._y=i*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),r=Math.sqrt(n);return this.set(i*Math.sin(t),i*Math.cos(t),r*Math.sin(e),r*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class $m{constructor(t=0,e=0,n=0){$m.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Zm.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Zm.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,s=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,a=t.z,o=t.w,l=2*(s*i-a*n),c=2*(a*e-r*i),h=2*(r*n-s*e);return this.x=e+o*l+s*h-a*c,this.y=n+o*c+a*l-r*h,this.z=i+o*h+r*c-s*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=i*o-r*a,this.y=r*s-n*o,this.z=n*a-i*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Ym.copy(this).projectOnVector(t),this.sub(Ym)}reflect(t){return this.sub(Ym.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(dm(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ym=new $m,Zm=new Xm;class Km{constructor(t=new $m(1/0,1/0,1/0),e=new $m(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(Qm.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(Qm.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Qm.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n){const i=n.getAttribute("position");if(!0===e&&void 0!==i&&!0!==t.isInstancedMesh)for(let e=0,n=i.count;e<n;e++)!0===t.isMesh?t.getVertexPosition(e,Qm):Qm.fromBufferAttribute(i,e),Qm.applyMatrix4(t.matrixWorld),this.expandByPoint(Qm);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),tg.copy(t.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),tg.copy(n.boundingBox)),tg.applyMatrix4(t.matrixWorld),this.union(tg)}const i=t.children;for(let t=0,n=i.length;t<n;t++)this.expandByObject(i[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Qm),Qm.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(og),lg.subVectors(this.max,og),eg.subVectors(t.a,og),ng.subVectors(t.b,og),ig.subVectors(t.c,og),rg.subVectors(ng,eg),sg.subVectors(ig,ng),ag.subVectors(eg,ig);let e=[0,-rg.z,rg.y,0,-sg.z,sg.y,0,-ag.z,ag.y,rg.z,0,-rg.x,sg.z,0,-sg.x,ag.z,0,-ag.x,-rg.y,rg.x,0,-sg.y,sg.x,0,-ag.y,ag.x,0];return!!ug(e,eg,ng,ig,lg)&&(e=[1,0,0,0,1,0,0,0,1],!!ug(e,eg,ng,ig,lg)&&(cg.crossVectors(rg,sg),e=[cg.x,cg.y,cg.z],ug(e,eg,ng,ig,lg)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Qm).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(Qm).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Jm[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Jm[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Jm[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Jm[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Jm[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Jm[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Jm[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Jm[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Jm)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Jm=[new $m,new $m,new $m,new $m,new $m,new $m,new $m,new $m],Qm=new $m,tg=new Km,eg=new $m,ng=new $m,ig=new $m,rg=new $m,sg=new $m,ag=new $m,og=new $m,lg=new $m,cg=new $m,hg=new $m;function ug(t,e,n,i,r){for(let s=0,a=t.length-3;s<=a;s+=3){hg.fromArray(t,s);const a=r.x*Math.abs(hg.x)+r.y*Math.abs(hg.y)+r.z*Math.abs(hg.z),o=e.dot(hg),l=n.dot(hg),c=i.dot(hg);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}const dg=new Km,pg=new $m,fg=new $m;class mg{constructor(t=new $m,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):dg.setFromPoints(t).getCenter(n);let i=0;for(let e=0,r=t.length;e<r;e++)i=Math.max(i,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;pg.subVectors(t,this.center);const e=pg.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.addScaledVector(pg,n/t),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(fg.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(pg.copy(t.center).add(fg)),this.expandByPoint(pg.copy(t.center).sub(fg))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const gg=new $m,vg=new $m,yg=new $m,xg=new $m,bg=new $m,_g=new $m,wg=new $m;class Sg{constructor(t=new $m,e=new $m(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,gg)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=gg.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(gg.copy(this.origin).addScaledVector(this.direction,e),gg.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){vg.copy(t).add(e).multiplyScalar(.5),yg.copy(e).sub(t).normalize(),xg.copy(this.origin).sub(vg);const r=.5*t.distanceTo(e),s=-this.direction.dot(yg),a=xg.dot(this.direction),o=-xg.dot(yg),l=xg.lengthSq(),c=Math.abs(1-s*s);let h,u,d,p;if(c>0)if(h=s*o-a,u=s*a-o,p=r*c,h>=0)if(u>=-p)if(u<=p){const t=1/c;h*=t,u*=t,d=h*(h+s*u+2*a)+u*(s*h+u+2*o)+l}else u=r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u=-r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u<=-p?(h=Math.max(0,-(-s*r+a)),u=h>0?-r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l):u<=p?(h=0,u=Math.min(Math.max(-r,-o),r),d=u*(u+2*o)+l):(h=Math.max(0,-(s*r+a)),u=h>0?r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l);else u=s>0?-r:r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(vg).addScaledVector(yg,u),d}intersectSphere(t,e){gg.subVectors(t.center,this.origin);const n=gg.dot(this.direction),i=gg.dot(gg)-n*n,r=t.radius*t.radius;if(i>r)return null;const s=Math.sqrt(r-i),a=n-s,o=n+s;return o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,r,s,a,o;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(n=(t.min.x-u.x)*l,i=(t.max.x-u.x)*l):(n=(t.max.x-u.x)*l,i=(t.min.x-u.x)*l),c>=0?(r=(t.min.y-u.y)*c,s=(t.max.y-u.y)*c):(r=(t.max.y-u.y)*c,s=(t.min.y-u.y)*c),n>s||r>i?null:((r>n||isNaN(n))&&(n=r),(s<i||isNaN(i))&&(i=s),h>=0?(a=(t.min.z-u.z)*h,o=(t.max.z-u.z)*h):(a=(t.max.z-u.z)*h,o=(t.min.z-u.z)*h),n>o||a>i?null:((a>n||n!=n)&&(n=a),(o<i||i!=i)&&(i=o),i<0?null:this.at(n>=0?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,gg)}intersectTriangle(t,e,n,i,r){bg.subVectors(e,t),_g.subVectors(n,t),wg.crossVectors(bg,_g);let s,a=this.direction.dot(wg);if(a>0){if(i)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}xg.subVectors(this.origin,t);const o=s*this.direction.dot(_g.crossVectors(xg,_g));if(o<0)return null;const l=s*this.direction.dot(bg.cross(xg));if(l<0)return null;if(o+l>a)return null;const c=-s*xg.dot(wg);return c<0?null:this.at(c/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Mg{constructor(t,e,n,i,r,s,a,o,l,c,h,u,d,p,f,m){Mg.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,n,i,r,s,a,o,l,c,h,u,d,p,f,m)}set(t,e,n,i,r,s,a,o,l,c,h,u,d,p,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Mg).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/Tg.setFromMatrixColumn(t,0).length(),r=1/Tg.setFromMatrixColumn(t,1).length(),s=1/Tg.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,i=t.y,r=t.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){const t=s*c,n=s*h,i=a*c,r=a*h;e[0]=o*c,e[4]=-o*h,e[8]=l,e[1]=n+i*l,e[5]=t-r*l,e[9]=-a*o,e[2]=r-t*l,e[6]=i+n*l,e[10]=s*o}else if("YXZ"===t.order){const t=o*c,n=o*h,i=l*c,r=l*h;e[0]=t+r*a,e[4]=i*a-n,e[8]=s*l,e[1]=s*h,e[5]=s*c,e[9]=-a,e[2]=n*a-i,e[6]=r+t*a,e[10]=s*o}else if("ZXY"===t.order){const t=o*c,n=o*h,i=l*c,r=l*h;e[0]=t-r*a,e[4]=-s*h,e[8]=i+n*a,e[1]=n+i*a,e[5]=s*c,e[9]=r-t*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){const t=s*c,n=s*h,i=a*c,r=a*h;e[0]=o*c,e[4]=i*l-n,e[8]=t*l+r,e[1]=o*h,e[5]=r*l+t,e[9]=n*l-i,e[2]=-l,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){const t=s*o,n=s*l,i=a*o,r=a*l;e[0]=o*c,e[4]=r-t*h,e[8]=i*h+n,e[1]=h,e[5]=s*c,e[9]=-a*c,e[2]=-l*c,e[6]=n*h+i,e[10]=t-r*h}else if("XZY"===t.order){const t=s*o,n=s*l,i=a*o,r=a*l;e[0]=o*c,e[4]=-h,e[8]=l*c,e[1]=t*h+r,e[5]=s*c,e[9]=n*h-i,e[2]=i*h-n,e[6]=a*c,e[10]=r*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ag,t,Cg)}lookAt(t,e,n){const i=this.elements;return Og.subVectors(t,e),0===Og.lengthSq()&&(Og.z=1),Og.normalize(),Pg.crossVectors(n,Og),0===Pg.lengthSq()&&(1===Math.abs(n.z)?Og.x+=1e-4:Og.z+=1e-4,Og.normalize(),Pg.crossVectors(n,Og)),Pg.normalize(),Rg.crossVectors(Og,Pg),i[0]=Pg.x,i[4]=Rg.x,i[8]=Og.x,i[1]=Pg.y,i[5]=Rg.y,i[9]=Og.y,i[2]=Pg.z,i[6]=Rg.z,i[10]=Og.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],c=n[1],h=n[5],u=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],b=n[15],_=i[0],w=i[4],S=i[8],M=i[12],T=i[1],E=i[5],A=i[9],C=i[13],P=i[2],R=i[6],O=i[10],D=i[14],L=i[3],I=i[7],z=i[11],N=i[15];return r[0]=s*_+a*T+o*P+l*L,r[4]=s*w+a*E+o*R+l*I,r[8]=s*S+a*A+o*O+l*z,r[12]=s*M+a*C+o*D+l*N,r[1]=c*_+h*T+u*P+d*L,r[5]=c*w+h*E+u*R+d*I,r[9]=c*S+h*A+u*O+d*z,r[13]=c*M+h*C+u*D+d*N,r[2]=p*_+f*T+m*P+g*L,r[6]=p*w+f*E+m*R+g*I,r[10]=p*S+f*A+m*O+g*z,r[14]=p*M+f*C+m*D+g*N,r[3]=v*_+y*T+x*P+b*L,r[7]=v*w+y*E+x*R+b*I,r[11]=v*S+y*A+x*O+b*z,r[15]=v*M+y*C+x*D+b*N,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],s=t[1],a=t[5],o=t[9],l=t[13],c=t[2],h=t[6],u=t[10],d=t[14];return t[3]*(+r*o*h-i*l*h-r*a*u+n*l*u+i*a*d-n*o*d)+t[7]*(+e*o*d-e*l*u+r*s*u-i*s*d+i*l*c-r*o*c)+t[11]*(+e*l*h-e*a*d-r*s*h+n*s*d+r*a*c-n*l*c)+t[15]*(-i*a*c-e*o*h+e*a*u+i*s*h-n*s*u+n*o*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=h*m*l-f*u*l+f*o*d-a*m*d-h*o*g+a*u*g,y=p*u*l-c*m*l-p*o*d+s*m*d+c*o*g-s*u*g,x=c*f*l-p*h*l+p*a*d-s*f*d-c*a*g+s*h*g,b=p*h*o-c*f*o-p*a*u+s*f*u+c*a*m-s*h*m,_=e*v+n*y+i*x+r*b;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/_;return t[0]=v*w,t[1]=(f*u*r-h*m*r-f*i*d+n*m*d+h*i*g-n*u*g)*w,t[2]=(a*m*r-f*o*r+f*i*l-n*m*l-a*i*g+n*o*g)*w,t[3]=(h*o*r-a*u*r-h*i*l+n*u*l+a*i*d-n*o*d)*w,t[4]=y*w,t[5]=(c*m*r-p*u*r+p*i*d-e*m*d-c*i*g+e*u*g)*w,t[6]=(p*o*r-s*m*r-p*i*l+e*m*l+s*i*g-e*o*g)*w,t[7]=(s*u*r-c*o*r+c*i*l-e*u*l-s*i*d+e*o*d)*w,t[8]=x*w,t[9]=(p*h*r-c*f*r-p*n*d+e*f*d+c*n*g-e*h*g)*w,t[10]=(s*f*r-p*a*r+p*n*l-e*f*l-s*n*g+e*a*g)*w,t[11]=(c*a*r-s*h*r-c*n*l+e*h*l+s*n*d-e*a*d)*w,t[12]=b*w,t[13]=(c*f*i-p*h*i+p*n*u-e*f*u-c*n*m+e*h*m)*w,t[14]=(p*a*i-s*f*i-p*n*o+e*f*o+s*n*m-e*a*m)*w,t[15]=(s*h*i-c*a*i+c*n*o-e*h*o-s*n*u+e*a*u)*w,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,a=t.y,o=t.z,l=r*s,c=r*a;return this.set(l*s+n,l*a-i*o,l*o+i*a,0,l*a+i*o,c*a+n,c*o-i*s,0,l*o-i*a,c*o+i*s,r*o*o+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,s){return this.set(1,n,r,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,l=r+r,c=s+s,h=a+a,u=r*l,d=r*c,p=r*h,f=s*c,m=s*h,g=a*h,v=o*l,y=o*c,x=o*h,b=n.x,_=n.y,w=n.z;return i[0]=(1-(f+g))*b,i[1]=(d+x)*b,i[2]=(p-y)*b,i[3]=0,i[4]=(d-x)*_,i[5]=(1-(u+g))*_,i[6]=(m+v)*_,i[7]=0,i[8]=(p+y)*w,i[9]=(m-v)*w,i[10]=(1-(u+f))*w,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=Tg.set(i[0],i[1],i[2]).length();const s=Tg.set(i[4],i[5],i[6]).length(),a=Tg.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],Eg.copy(this);const o=1/r,l=1/s,c=1/a;return Eg.elements[0]*=o,Eg.elements[1]*=o,Eg.elements[2]*=o,Eg.elements[4]*=l,Eg.elements[5]*=l,Eg.elements[6]*=l,Eg.elements[8]*=c,Eg.elements[9]*=c,Eg.elements[10]*=c,e.setFromRotationMatrix(Eg),n.x=r,n.y=s,n.z=a,this}makePerspective(t,e,n,i,r,s,a=2e3){const o=this.elements,l=2*r/(e-t),c=2*r/(n-i),h=(e+t)/(e-t),u=(n+i)/(n-i);let d,p;if(a===rm)d=-(s+r)/(s-r),p=-2*s*r/(s-r);else{if(a!==sm)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);d=-s/(s-r),p=-s*r/(s-r)}return o[0]=l,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=c,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,i,r,s,a=2e3){const o=this.elements,l=1/(e-t),c=1/(n-i),h=1/(s-r),u=(e+t)*l,d=(n+i)*c;let p,f;if(a===rm)p=(s+r)*h,f=-2*h;else{if(a!==sm)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=r*h,f=-1*h}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=f,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const Tg=new $m,Eg=new Mg,Ag=new $m(0,0,0),Cg=new $m(1,1,1),Pg=new $m,Rg=new $m,Og=new $m,Dg=new Mg,Lg=new Xm;class Ig{constructor(t=0,e=0,n=0,i=Ig.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,r=i[0],s=i[4],a=i[8],o=i[1],l=i[5],c=i[9],h=i[2],u=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(dm(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-dm(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(dm(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-dm(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(dm(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-dm(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Dg.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Dg,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Lg.setFromEuler(this),this.setFromQuaternion(Lg,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ig.DEFAULT_ORDER="XYZ";class zg{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let Ng=0;const Ug=new $m,kg=new Xm,Bg=new Mg,Fg=new $m,Vg=new $m,jg=new $m,Hg=new Xm,Gg=new $m(1,0,0),Wg=new $m(0,1,0),qg=new $m(0,0,1),Xg={type:"added"},$g={type:"removed"},Yg={type:"childadded",child:null},Zg={type:"childremoved",child:null};class Kg extends am{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ng++}),this.uuid=um(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Kg.DEFAULT_UP.clone();const t=new $m,e=new Ig,n=new Xm,i=new $m(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Mg},normalMatrix:{value:new xm}}),this.matrix=new Mg,this.matrixWorld=new Mg,this.matrixAutoUpdate=Kg.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Kg.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new zg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return kg.setFromAxisAngle(t,e),this.quaternion.multiply(kg),this}rotateOnWorldAxis(t,e){return kg.setFromAxisAngle(t,e),this.quaternion.premultiply(kg),this}rotateX(t){return this.rotateOnAxis(Gg,t)}rotateY(t){return this.rotateOnAxis(Wg,t)}rotateZ(t){return this.rotateOnAxis(qg,t)}translateOnAxis(t,e){return Ug.copy(t).applyQuaternion(this.quaternion),this.position.add(Ug.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Gg,t)}translateY(t){return this.translateOnAxis(Wg,t)}translateZ(t){return this.translateOnAxis(qg,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Bg.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?Fg.copy(t):Fg.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Vg.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Bg.lookAt(Vg,Fg,this.up):Bg.lookAt(Fg,Vg,this.up),this.quaternion.setFromRotationMatrix(Bg),i&&(Bg.extractRotation(i.matrixWorld),kg.setFromRotationMatrix(Bg),this.quaternion.premultiply(kg.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Xg),Yg.child=t,this.dispatchEvent(Yg),Yg.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent($g),Zg.child=t,this.dispatchEvent(Zg),Zg.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Bg.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Bg.multiply(t.parent.matrixWorld)),t.applyMatrix4(Bg),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Xg),Yg.child=t,this.dispatchEvent(Yg),Yg.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vg,t,jg),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vg,Hg,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++){e[n].updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++){t[e].updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];i.animations.push(r(t.animations,n))}}if(e){const e=s(t.geometries),i=s(t.materials),r=s(t.textures),a=s(t.images),o=s(t.shapes),l=s(t.skeletons),c=s(t.animations),h=s(t.nodes);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c),h.length>0&&(n.nodes=h)}return n.object=i,n;function s(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}Kg.DEFAULT_UP=new $m(0,1,0),Kg.DEFAULT_MATRIX_AUTO_UPDATE=!0,Kg.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Jg=new $m,Qg=new $m,tv=new $m,ev=new $m,nv=new $m,iv=new $m,rv=new $m,sv=new $m,av=new $m,ov=new $m;class lv{constructor(t=new $m,e=new $m,n=new $m){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),Jg.subVectors(t,e),i.cross(Jg);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){Jg.subVectors(i,e),Qg.subVectors(n,e),tv.subVectors(t,e);const s=Jg.dot(Jg),a=Jg.dot(Qg),o=Jg.dot(tv),l=Qg.dot(Qg),c=Qg.dot(tv),h=s*l-a*a;if(0===h)return r.set(0,0,0),null;const u=1/h,d=(l*o-a*c)*u,p=(s*c-a*o)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,n,i){return null!==this.getBarycoord(t,e,n,i,ev)&&(ev.x>=0&&ev.y>=0&&ev.x+ev.y<=1)}static getInterpolation(t,e,n,i,r,s,a,o){return null===this.getBarycoord(t,e,n,i,ev)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,ev.x),o.addScaledVector(s,ev.y),o.addScaledVector(a,ev.z),o)}static isFrontFacing(t,e,n,i){return Jg.subVectors(n,e),Qg.subVectors(t,e),Jg.cross(Qg).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Jg.subVectors(this.c,this.b),Qg.subVectors(this.a,this.b),.5*Jg.cross(Qg).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return lv.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return lv.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,n,i,r){return lv.getInterpolation(t,this.a,this.b,this.c,e,n,i,r)}containsPoint(t){return lv.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return lv.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,r=this.c;let s,a;nv.subVectors(i,n),iv.subVectors(r,n),sv.subVectors(t,n);const o=nv.dot(sv),l=iv.dot(sv);if(o<=0&&l<=0)return e.copy(n);av.subVectors(t,i);const c=nv.dot(av),h=iv.dot(av);if(c>=0&&h<=c)return e.copy(i);const u=o*h-c*l;if(u<=0&&o>=0&&c<=0)return s=o/(o-c),e.copy(n).addScaledVector(nv,s);ov.subVectors(t,r);const d=nv.dot(ov),p=iv.dot(ov);if(p>=0&&d<=p)return e.copy(r);const f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),e.copy(n).addScaledVector(iv,a);const m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return rv.subVectors(r,i),a=(h-c)/(h-c+(d-p)),e.copy(i).addScaledVector(rv,a);const g=1/(m+f+u);return s=f*g,a=u*g,e.copy(n).addScaledVector(nv,s).addScaledVector(iv,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const cv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},hv={h:0,s:0,l:0},uv={h:0,s:0,l:0};function dv(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}class pv{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(void 0===e&&void 0===n){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=kf){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Dm.toWorkingColorSpace(this,e),this}setRGB(t,e,n,i=Dm.workingColorSpace){return this.r=t,this.g=e,this.b=n,Dm.toWorkingColorSpace(this,i),this}setHSL(t,e,n,i=Dm.workingColorSpace){if(t=pm(t,1),e=dm(e,0,1),n=dm(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=dv(r,i,t+1/3),this.g=dv(r,i,t),this.b=dv(r,i,t-1/3)}return Dm.toWorkingColorSpace(this,i),this}setStyle(t,e=kf){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let r;const s=i[1],a=i[2];switch(s){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,e);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=i[1],r=n.length;if(3===r)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(6===r)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=kf){const n=cv[t.toLowerCase()];return void 0!==n?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Lm(t.r),this.g=Lm(t.g),this.b=Lm(t.b),this}copyLinearToSRGB(t){return this.r=Im(t.r),this.g=Im(t.g),this.b=Im(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=kf){return Dm.fromWorkingColorSpace(fv.copy(this),t),65536*Math.round(dm(255*fv.r,0,255))+256*Math.round(dm(255*fv.g,0,255))+Math.round(dm(255*fv.b,0,255))}getHexString(t=kf){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Dm.workingColorSpace){Dm.fromWorkingColorSpace(fv.copy(this),e);const n=fv.r,i=fv.g,r=fv.b,s=Math.max(n,i,r),a=Math.min(n,i,r);let o,l;const c=(a+s)/2;if(a===s)o=0,l=0;else{const t=s-a;switch(l=c<=.5?t/(s+a):t/(2-s-a),s){case n:o=(i-r)/t+(i<r?6:0);break;case i:o=(r-n)/t+2;break;case r:o=(n-i)/t+4}o/=6}return t.h=o,t.s=l,t.l=c,t}getRGB(t,e=Dm.workingColorSpace){return Dm.fromWorkingColorSpace(fv.copy(this),e),t.r=fv.r,t.g=fv.g,t.b=fv.b,t}getStyle(t=kf){Dm.fromWorkingColorSpace(fv.copy(this),t);const e=fv.r,n=fv.g,i=fv.b;return t!==kf?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*i)})`}offsetHSL(t,e,n){return this.getHSL(hv),this.setHSL(hv.h+t,hv.s+e,hv.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(hv),t.getHSL(uv);const n=fm(hv.h,uv.h,e),i=fm(hv.s,uv.s,e),r=fm(hv.l,uv.l,e);return this.setHSL(n,i,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,i=this.b,r=t.elements;return this.r=r[0]*e+r[3]*n+r[6]*i,this.g=r[1]*e+r[4]*n+r[7]*i,this.b=r[2]*e+r[5]*n+r[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const fv=new pv;pv.NAMES=cv;let mv=0;class gv extends am{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:mv++}),this.uuid=um(),this.name="",this.type="Material",this.blending=kd,this.side=zd,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=Bd,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new pv(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=qf,this.stencilZFail=qf,this.stencilZPass=qf,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==kd&&(n.blending=this.blending),this.side!==zd&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),204!==this.blendSrc&&(n.blendSrc=this.blendSrc),205!==this.blendDst&&(n.blendDst=this.blendDst),this.blendEquation!==Bd&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==qf&&(n.stencilFail=this.stencilFail),this.stencilZFail!==qf&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==qf&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}onBeforeRender(){console.warn("Material: onBeforeRender() has been removed.")}}class vv extends gv{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new pv(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ig,this.combine=ip,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const yv=xv();function xv(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),i=new Uint32Array(512),r=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(i[t]=0,i[256|t]=32768,r[t]=24,r[256|t]=24):e<-14?(i[t]=1024>>-e-14,i[256|t]=1024>>-e-14|32768,r[t]=-e-1,r[256|t]=-e-1):e<=15?(i[t]=e+15<<10,i[256|t]=e+15<<10|32768,r[t]=13,r[256|t]=13):e<128?(i[t]=31744,i[256|t]=64512,r[t]=24,r[256|t]=24):(i[t]=31744,i[256|t]=64512,r[t]=13,r[256|t]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,n=0;for(;!(8388608&e);)e<<=1,n-=8388608;e&=-8388609,n+=947912704,s[t]=e|n}for(let t=1024;t<2048;++t)s[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)a[t]=t<<23;a[31]=1199570944,a[32]=2147483648;for(let t=33;t<63;++t)a[t]=2147483648+(t-32<<23);a[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(o[t]=1024);return{floatView:e,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}function bv(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=dm(t,-65504,65504),yv.floatView[0]=t;const e=yv.uint32View[0],n=e>>23&511;return yv.baseTable[n]+((8388607&e)>>yv.shiftTable[n])}function _v(t){const e=t>>10;return yv.uint32View[0]=yv.mantissaTable[yv.offsetTable[e]+(1023&t)]+yv.exponentTable[e],yv.floatView[0]}const wv={toHalfFloat:bv,fromHalfFloat:_v},Sv=new $m,Mv=new ym;class Tv{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n,this.usage=em,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Ip,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return Am("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)Mv.fromBufferAttribute(this,e),Mv.applyMatrix3(t),this.setXY(e,Mv.x,Mv.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)Sv.fromBufferAttribute(this,e),Sv.applyMatrix3(t),this.setXYZ(e,Sv.x,Sv.y,Sv.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)Sv.fromBufferAttribute(this,e),Sv.applyMatrix4(t),this.setXYZ(e,Sv.x,Sv.y,Sv.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Sv.fromBufferAttribute(this,e),Sv.applyNormalMatrix(t),this.setXYZ(e,Sv.x,Sv.y,Sv.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Sv.fromBufferAttribute(this,e),Sv.transformDirection(t),this.setXYZ(e,Sv.x,Sv.y,Sv.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=mm(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=gm(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=mm(e,this.array)),e}setX(t,e){return this.normalized&&(e=gm(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=mm(e,this.array)),e}setY(t,e){return this.normalized&&(e=gm(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=mm(e,this.array)),e}setZ(t,e){return this.normalized&&(e=gm(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=mm(e,this.array)),e}setW(t,e){return this.normalized&&(e=gm(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=gm(e,this.array),n=gm(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=gm(e,this.array),n=gm(n,this.array),i=gm(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=gm(e,this.array),n=gm(n,this.array),i=gm(i,this.array),r=gm(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==em&&(t.usage=this.usage),t}}class Ev extends Tv{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class Av extends Tv{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class Cv extends Tv{constructor(t,e,n){super(new Float32Array(t),e,n)}}let Pv=0;const Rv=new Mg,Ov=new Kg,Dv=new $m,Lv=new Km,Iv=new Km,zv=new $m;class Nv extends am{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Pv++}),this.uuid=um(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(_m(t)?Av:Ev)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new xm).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Rv.makeRotationFromQuaternion(t),this.applyMatrix4(Rv),this}rotateX(t){return Rv.makeRotationX(t),this.applyMatrix4(Rv),this}rotateY(t){return Rv.makeRotationY(t),this.applyMatrix4(Rv),this}rotateZ(t){return Rv.makeRotationZ(t),this.applyMatrix4(Rv),this}translate(t,e,n){return Rv.makeTranslation(t,e,n),this.applyMatrix4(Rv),this}scale(t,e,n){return Rv.makeScale(t,e,n),this.applyMatrix4(Rv),this}lookAt(t){return Ov.lookAt(t),Ov.updateMatrix(),this.applyMatrix4(Ov.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Dv).negate(),this.translate(Dv.x,Dv.y,Dv.z),this}setFromPoints(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Cv(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Km);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new $m(-1/0,-1/0,-1/0),new $m(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Lv.setFromBufferAttribute(n),this.morphTargetsRelative?(zv.addVectors(this.boundingBox.min,Lv.min),this.boundingBox.expandByPoint(zv),zv.addVectors(this.boundingBox.max,Lv.max),this.boundingBox.expandByPoint(zv)):(this.boundingBox.expandByPoint(Lv.min),this.boundingBox.expandByPoint(Lv.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new mg);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new $m,1/0);if(t){const n=this.boundingSphere.center;if(Lv.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Iv.setFromBufferAttribute(n),this.morphTargetsRelative?(zv.addVectors(Lv.min,Iv.min),Lv.expandByPoint(zv),zv.addVectors(Lv.max,Iv.max),Lv.expandByPoint(zv)):(Lv.expandByPoint(Iv.min),Lv.expandByPoint(Iv.max))}Lv.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)zv.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(zv));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],a=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)zv.fromBufferAttribute(s,e),a&&(Dv.fromBufferAttribute(t,e),zv.add(Dv)),i=Math.max(i,n.distanceToSquared(zv))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.position,i=e.normal,r=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Tv(new Float32Array(4*n.count),4));const s=this.getAttribute("tangent"),a=[],o=[];for(let t=0;t<n.count;t++)a[t]=new $m,o[t]=new $m;const l=new $m,c=new $m,h=new $m,u=new ym,d=new ym,p=new ym,f=new $m,m=new $m;function g(t,e,i){l.fromBufferAttribute(n,t),c.fromBufferAttribute(n,e),h.fromBufferAttribute(n,i),u.fromBufferAttribute(r,t),d.fromBufferAttribute(r,e),p.fromBufferAttribute(r,i),c.sub(l),h.sub(l),d.sub(u),p.sub(u);const s=1/(d.x*p.y-p.x*d.y);isFinite(s)&&(f.copy(c).multiplyScalar(p.y).addScaledVector(h,-d.y).multiplyScalar(s),m.copy(h).multiplyScalar(d.x).addScaledVector(c,-p.x).multiplyScalar(s),a[t].add(f),a[e].add(f),a[i].add(f),o[t].add(m),o[e].add(m),o[i].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:t.count}]);for(let e=0,n=v.length;e<n;++e){const n=v[e],i=n.start;for(let e=i,r=i+n.count;e<r;e+=3)g(t.getX(e+0),t.getX(e+1),t.getX(e+2))}const y=new $m,x=new $m,b=new $m,_=new $m;function w(t){b.fromBufferAttribute(i,t),_.copy(b);const e=a[t];y.copy(e),y.sub(b.multiplyScalar(b.dot(e))).normalize(),x.crossVectors(_,e);const n=x.dot(o[t])<0?-1:1;s.setXYZW(t,y.x,y.y,y.z,n)}for(let e=0,n=v.length;e<n;++e){const n=v[e],i=n.start;for(let e=i,r=i+n.count;e<r;e+=3)w(t.getX(e+0)),w(t.getX(e+1)),w(t.getX(e+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new Tv(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new $m,r=new $m,s=new $m,a=new $m,o=new $m,l=new $m,c=new $m,h=new $m;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),f=t.getX(u+2);i.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,f),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),a.fromBufferAttribute(n,d),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),a.add(c),o.add(c),l.add(c),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let t=0,a=e.count;t<a;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,r),h.subVectors(i,r),c.cross(h),n.setXYZ(t+0,c.x,c.y,c.z),n.setXYZ(t+1,c.x,c.y,c.z),n.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)zv.fromBufferAttribute(t,e),zv.normalize(),t.setXYZ(e,zv.x,zv.y,zv.z)}toNonIndexed(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,s=new n.constructor(e.length*i);let a=0,o=0;for(let r=0,l=e.length;r<l;r++){a=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*i;for(let t=0;t<i;t++)s[o++]=n[a++]}return new Tv(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Nv,n=this.index.array,i=this.attributes;for(const r in i){const s=t(i[r],n);e.setAttribute(r,s)}const r=this.morphAttributes;for(const i in r){const s=[],a=r[i];for(let e=0,i=a.length;e<i;e++){const i=t(a[e],n);s.push(i)}e.morphAttributes[i]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.addGroup(n.start,n.count,n.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const i=n[e];t.data.attributes[e]=i.toJSON(t.data)}const i={};let r=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,i=n.length;e<i;e++){const i=n[e];s.push(i.toJSON(t.data))}s.length>0&&(i[e]=s,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const i=t.attributes;for(const t in i){const n=i[t];this.setAttribute(t,n.clone(e))}const r=t.morphAttributes;for(const t in r){const n=[],i=r[t];for(let t=0,r=i.length;t<r;t++)n.push(i[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Uv=new Mg,kv=new Sg,Bv=new mg,Fv=new $m,Vv=new $m,jv=new $m,Hv=new $m,Gv=new $m,Wv=new $m,qv=new ym,Xv=new ym,$v=new ym,Yv=new $m,Zv=new $m,Kv=new $m,Jv=new $m,Qv=new $m;class ty extends Kg{constructor(t=new Nv,e=new vv){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,s=n.morphTargetsRelative;e.fromBufferAttribute(i,t);const a=this.morphTargetInfluences;if(r&&a){Wv.set(0,0,0);for(let n=0,i=r.length;n<i;n++){const i=a[n],o=r[n];0!==i&&(Gv.fromBufferAttribute(o,t),s?Wv.addScaledVector(Gv,i):Wv.addScaledVector(Gv.sub(e),i))}e.add(Wv)}return e}raycast(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i){if(null===n.boundingSphere&&n.computeBoundingSphere(),Bv.copy(n.boundingSphere),Bv.applyMatrix4(r),kv.copy(t.ray).recast(t.near),!1===Bv.containsPoint(kv.origin)){if(null===kv.intersectSphere(Bv,Fv))return;if(kv.origin.distanceToSquared(Fv)>(t.far-t.near)**2)return}Uv.copy(r).invert(),kv.copy(t.ray).applyMatrix4(Uv),null!==n.boundingBox&&!1===kv.intersectsBox(n.boundingBox)||this._computeIntersections(t,e,kv)}}_computeIntersections(t,e,n){let i;const r=this.geometry,s=this.material,a=r.index,o=r.attributes.position,l=r.attributes.uv,c=r.attributes.uv1,h=r.attributes.normal,u=r.groups,d=r.drawRange;if(null!==a)if(Array.isArray(s))for(let r=0,o=u.length;r<o;r++){const o=u[r],p=s[o.materialIndex];for(let r=Math.max(o.start,d.start),s=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));r<s;r+=3){i=ey(this,p,t,n,l,c,h,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=o.materialIndex,e.push(i))}}else{for(let r=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);r<o;r+=3){i=ey(this,s,t,n,l,c,h,a.getX(r),a.getX(r+1),a.getX(r+2)),i&&(i.faceIndex=Math.floor(r/3),e.push(i))}}else if(void 0!==o)if(Array.isArray(s))for(let r=0,a=u.length;r<a;r++){const a=u[r],p=s[a.materialIndex];for(let r=Math.max(a.start,d.start),s=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));r<s;r+=3){i=ey(this,p,t,n,l,c,h,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),i.face.materialIndex=a.materialIndex,e.push(i))}}else{for(let r=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);r<a;r+=3){i=ey(this,s,t,n,l,c,h,r,r+1,r+2),i&&(i.faceIndex=Math.floor(r/3),e.push(i))}}}}function ey(t,e,n,i,r,s,a,o,l,c){t.getVertexPosition(o,Vv),t.getVertexPosition(l,jv),t.getVertexPosition(c,Hv);const h=function(t,e,n,i,r,s,a,o){let l;if(l=e.side===Nd?i.intersectTriangle(a,s,r,!0,o):i.intersectTriangle(r,s,a,e.side===zd,o),null===l)return null;Qv.copy(o),Qv.applyMatrix4(t.matrixWorld);const c=n.ray.origin.distanceTo(Qv);return c<n.near||c>n.far?null:{distance:c,point:Qv.clone(),object:t}}(t,e,n,i,Vv,jv,Hv,Jv);if(h){r&&(qv.fromBufferAttribute(r,o),Xv.fromBufferAttribute(r,l),$v.fromBufferAttribute(r,c),h.uv=lv.getInterpolation(Jv,Vv,jv,Hv,qv,Xv,$v,new ym)),s&&(qv.fromBufferAttribute(s,o),Xv.fromBufferAttribute(s,l),$v.fromBufferAttribute(s,c),h.uv1=lv.getInterpolation(Jv,Vv,jv,Hv,qv,Xv,$v,new ym)),a&&(Yv.fromBufferAttribute(a,o),Zv.fromBufferAttribute(a,l),Kv.fromBufferAttribute(a,c),h.normal=lv.getInterpolation(Jv,Vv,jv,Hv,Yv,Zv,Kv,new $m),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const t={a:o,b:l,c,normal:new $m,materialIndex:0};lv.getNormal(Vv,jv,Hv,t.normal),h.face=t}return h}class ny extends Nv{constructor(t=1,e=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const a=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],c=[],h=[];let u=0,d=0;function p(t,e,n,i,r,s,p,f,m,g,v){const y=s/m,x=p/g,b=s/2,_=p/2,w=f/2,S=m+1,M=g+1;let T=0,E=0;const A=new $m;for(let s=0;s<M;s++){const a=s*x-_;for(let o=0;o<S;o++){const u=o*y-b;A[t]=u*i,A[e]=a*r,A[n]=w,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[n]=f>0?1:-1,c.push(A.x,A.y,A.z),h.push(o/m),h.push(1-s/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const n=u+e+S*t,i=u+e+S*(t+1),r=u+(e+1)+S*(t+1),s=u+(e+1)+S*t;o.push(n,i,s),o.push(i,r,s),E+=6}a.addGroup(d,E,v),d+=E,u+=T}p("z","y","x",-1,-1,n,e,t,s,r,0),p("z","y","x",1,-1,n,e,-t,s,r,1),p("x","z","y",1,1,t,n,e,i,s,2),p("x","z","y",1,-1,t,n,-e,i,s,3),p("x","y","z",1,-1,t,e,n,i,r,4),p("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(o),this.setAttribute("position",new Cv(l,3)),this.setAttribute("normal",new Cv(c,3)),this.setAttribute("uv",new Cv(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ny(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function iy(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][i]=null):e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function ry(t){const e={};for(let n=0;n<t.length;n++){const i=iy(t[n]);for(const t in i)e[t]=i[t]}return e}function sy(t){const e=t.getRenderTarget();return null===e?t.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:Dm.workingColorSpace}const ay={clone:iy,merge:ry};class oy extends gv{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=iy(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}class ly extends Kg{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Mg,this.projectionMatrix=new Mg,this.projectionMatrixInverse=new Mg,this.coordinateSystem=rm}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const cy=new $m,hy=new ym,uy=new ym;class dy extends ly{constructor(t=50,e=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*hm*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*cm*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*hm*Math.atan(Math.tan(.5*cm*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){cy.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(cy.x,cy.y).multiplyScalar(-t/cy.z),cy.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(cy.x,cy.y).multiplyScalar(-t/cy.z)}getViewSize(t,e){return this.getViewBounds(t,hy,uy),e.subVectors(uy,hy)}setViewOffset(t,e,n,i,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*cm*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,a=s.fullHeight;r+=s.offsetX*i/t,e-=s.offsetY*n/a,i*=s.width/t,n*=s.height/a}const a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const py=-90;class fy extends Kg{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new dy(py,1,t,e);i.layers=this.layers,this.add(i);const r=new dy(py,1,t,e);r.layers=this.layers,this.add(r);const s=new dy(py,1,t,e);s.layers=this.layers,this.add(s);const a=new dy(py,1,t,e);a.layers=this.layers,this.add(a);const o=new dy(py,1,t,e);o.layers=this.layers,this.add(o);const l=new dy(py,1,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,i,r,s,a,o]=e;for(const t of e)this.remove(t);if(t===rm)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(t!==sm)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const t of e)this.add(t),t.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[r,s,a,o,l,c]=this.children,h=t.getRenderTarget(),u=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,i),t.render(e,r),t.setRenderTarget(n,1,i),t.render(e,s),t.setRenderTarget(n,2,i),t.render(e,a),t.setRenderTarget(n,3,i),t.render(e,o),t.setRenderTarget(n,4,i),t.render(e,l),n.texture.generateMipmaps=f,t.setRenderTarget(n,5,i),t.render(e,c),t.setRenderTarget(h,u,d),t.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class my extends Vm{constructor(t,e,n,i,r,s,a,o,l,c){super(t=void 0!==t?t:[],e=void 0!==e?e:fp,n,i,r,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class gy extends Gm{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];this.texture=new my(i,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:Tp}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new ny(5,5,5),r=new oy({name:"CubemapFromEquirect",uniforms:iy(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Nd,blending:0});r.uniforms.tEquirect.value=e;const s=new ty(i,r),a=e.minFilter;e.minFilter===Ap&&(e.minFilter=Tp);return new fy(1,10,this).update(t,s),e.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,i){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,n,i);t.setRenderTarget(r)}}const vy=new $m,yy=new $m,xy=new xm;class by{constructor(t=new $m(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=vy.subVectors(n,e).cross(yy.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(vy),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(t.start).addScaledVector(n,r)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||xy.getNormalMatrix(t),i=this.coplanarPoint(vy).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const _y=new mg,wy=new $m;class Sy{constructor(t=new by,e=new by,n=new by,i=new by,r=new by,s=new by){this.planes=[t,e,n,i,r,s]}set(t,e,n,i,r,s){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=2e3){const n=this.planes,i=t.elements,r=i[0],s=i[1],a=i[2],o=i[3],l=i[4],c=i[5],h=i[6],u=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],x=i[15];if(n[0].setComponents(o-r,u-l,m-d,x-g).normalize(),n[1].setComponents(o+r,u+l,m+d,x+g).normalize(),n[2].setComponents(o+s,u+c,m+p,x+v).normalize(),n[3].setComponents(o-s,u-c,m-p,x-v).normalize(),n[4].setComponents(o-a,u-h,m-f,x-y).normalize(),e===rm)n[5].setComponents(o+a,u+h,m+f,x+y).normalize();else{if(e!==sm)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);n[5].setComponents(a,h,f,y).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),_y.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),_y.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(_y)}intersectsSprite(t){return _y.center.set(0,0,0),_y.radius=.7071067811865476,_y.applyMatrix4(t.matrixWorld),this.intersectsSphere(_y)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(n)<i)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(wy.x=i.normal.x>0?t.max.x:t.min.x,wy.y=i.normal.y>0?t.max.y:t.min.y,wy.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(wy)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function My(){let t=null,e=!1,n=null,i=null;function r(e,s){n(e,s),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Ty(t){const e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const i=e.get(n);i&&(t.deleteBuffer(i.buffer),e.delete(n))},update:function(n,i){if(n.isGLBufferAttribute){const t=e.get(n);return void((!t||t.version<n.version)&&e.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}n.isInterleavedBufferAttribute&&(n=n.data);const r=e.get(n);if(void 0===r)e.set(n,function(e,n){const i=e.array,r=e.usage,s=i.byteLength,a=t.createBuffer();let o;if(t.bindBuffer(n,a),t.bufferData(n,i,r),e.onUploadCallback(),i instanceof Float32Array)o=t.FLOAT;else if(i instanceof Uint16Array)o=e.isFloat16BufferAttribute?t.HALF_FLOAT:t.UNSIGNED_SHORT;else if(i instanceof Int16Array)o=t.SHORT;else if(i instanceof Uint32Array)o=t.UNSIGNED_INT;else if(i instanceof Int32Array)o=t.INT;else if(i instanceof Int8Array)o=t.BYTE;else if(i instanceof Uint8Array)o=t.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);o=t.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version,size:s}}(n,i));else if(r.version<n.version){if(r.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(e,n,i){const r=n.array,s=n._updateRange,a=n.updateRanges;if(t.bindBuffer(i,e),-1===s.count&&0===a.length&&t.bufferSubData(i,0,r),0!==a.length){for(let e=0,n=a.length;e<n;e++){const n=a[e];t.bufferSubData(i,n.start*r.BYTES_PER_ELEMENT,r,n.start,n.count)}n.clearUpdateRanges()}-1!==s.count&&(t.bufferSubData(i,s.offset*r.BYTES_PER_ELEMENT,r,s.offset,s.count),s.count=-1),n.onUploadCallback()}(r.buffer,n,i),r.version=n.version}}}}class Ey extends Nv{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=t/2,s=e/2,a=Math.floor(n),o=Math.floor(i),l=a+1,c=o+1,h=t/a,u=e/o,d=[],p=[],f=[],m=[];for(let t=0;t<c;t++){const e=t*u-s;for(let n=0;n<l;n++){const i=n*h-r;p.push(i,-e,0),f.push(0,0,1),m.push(n/a),m.push(1-t/o)}}for(let t=0;t<o;t++)for(let e=0;e<a;e++){const n=e+l*t,i=e+l*(t+1),r=e+1+l*(t+1),s=e+1+l*t;d.push(n,i,s),d.push(i,r,s)}this.setIndex(d),this.setAttribute("position",new Cv(p,3)),this.setAttribute("normal",new Cv(f,3)),this.setAttribute("uv",new Cv(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ey(t.width,t.height,t.widthSegments,t.heightSegments)}}const Ay={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Cy={common:{diffuse:{value:new pv(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new xm},alphaMap:{value:null},alphaMapTransform:{value:new xm},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new xm}},envmap:{envMap:{value:null},envMapRotation:{value:new xm},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new xm}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new xm}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new xm},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new xm},normalScale:{value:new ym(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new xm},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new xm}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new xm}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new xm}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new pv(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new pv(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new xm},alphaTest:{value:0},uvTransform:{value:new xm}},sprite:{diffuse:{value:new pv(16777215)},opacity:{value:1},center:{value:new ym(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new xm},alphaMap:{value:null},alphaMapTransform:{value:new xm},alphaTest:{value:0}}},Py={basic:{uniforms:ry([Cy.common,Cy.specularmap,Cy.envmap,Cy.aomap,Cy.lightmap,Cy.fog]),vertexShader:Ay.meshbasic_vert,fragmentShader:Ay.meshbasic_frag},lambert:{uniforms:ry([Cy.common,Cy.specularmap,Cy.envmap,Cy.aomap,Cy.lightmap,Cy.emissivemap,Cy.bumpmap,Cy.normalmap,Cy.displacementmap,Cy.fog,Cy.lights,{emissive:{value:new pv(0)}}]),vertexShader:Ay.meshlambert_vert,fragmentShader:Ay.meshlambert_frag},phong:{uniforms:ry([Cy.common,Cy.specularmap,Cy.envmap,Cy.aomap,Cy.lightmap,Cy.emissivemap,Cy.bumpmap,Cy.normalmap,Cy.displacementmap,Cy.fog,Cy.lights,{emissive:{value:new pv(0)},specular:{value:new pv(1118481)},shininess:{value:30}}]),vertexShader:Ay.meshphong_vert,fragmentShader:Ay.meshphong_frag},standard:{uniforms:ry([Cy.common,Cy.envmap,Cy.aomap,Cy.lightmap,Cy.emissivemap,Cy.bumpmap,Cy.normalmap,Cy.displacementmap,Cy.roughnessmap,Cy.metalnessmap,Cy.fog,Cy.lights,{emissive:{value:new pv(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ay.meshphysical_vert,fragmentShader:Ay.meshphysical_frag},toon:{uniforms:ry([Cy.common,Cy.aomap,Cy.lightmap,Cy.emissivemap,Cy.bumpmap,Cy.normalmap,Cy.displacementmap,Cy.gradientmap,Cy.fog,Cy.lights,{emissive:{value:new pv(0)}}]),vertexShader:Ay.meshtoon_vert,fragmentShader:Ay.meshtoon_frag},matcap:{uniforms:ry([Cy.common,Cy.bumpmap,Cy.normalmap,Cy.displacementmap,Cy.fog,{matcap:{value:null}}]),vertexShader:Ay.meshmatcap_vert,fragmentShader:Ay.meshmatcap_frag},points:{uniforms:ry([Cy.points,Cy.fog]),vertexShader:Ay.points_vert,fragmentShader:Ay.points_frag},dashed:{uniforms:ry([Cy.common,Cy.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ay.linedashed_vert,fragmentShader:Ay.linedashed_frag},depth:{uniforms:ry([Cy.common,Cy.displacementmap]),vertexShader:Ay.depth_vert,fragmentShader:Ay.depth_frag},normal:{uniforms:ry([Cy.common,Cy.bumpmap,Cy.normalmap,Cy.displacementmap,{opacity:{value:1}}]),vertexShader:Ay.meshnormal_vert,fragmentShader:Ay.meshnormal_frag},sprite:{uniforms:ry([Cy.sprite,Cy.fog]),vertexShader:Ay.sprite_vert,fragmentShader:Ay.sprite_frag},background:{uniforms:{uvTransform:{value:new xm},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ay.background_vert,fragmentShader:Ay.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new xm}},vertexShader:Ay.backgroundCube_vert,fragmentShader:Ay.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ay.cube_vert,fragmentShader:Ay.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ay.equirect_vert,fragmentShader:Ay.equirect_frag},distanceRGBA:{uniforms:ry([Cy.common,Cy.displacementmap,{referencePosition:{value:new $m},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ay.distanceRGBA_vert,fragmentShader:Ay.distanceRGBA_frag},shadow:{uniforms:ry([Cy.lights,Cy.fog,{color:{value:new pv(0)},opacity:{value:1}}]),vertexShader:Ay.shadow_vert,fragmentShader:Ay.shadow_frag}};Py.physical={uniforms:ry([Py.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new xm},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new xm},clearcoatNormalScale:{value:new ym(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new xm},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new xm},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new xm},sheen:{value:0},sheenColor:{value:new pv(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new xm},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new xm},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new xm},transmissionSamplerSize:{value:new ym},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new xm},attenuationDistance:{value:0},attenuationColor:{value:new pv(0)},specularColor:{value:new pv(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new xm},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new xm},anisotropyVector:{value:new ym},anisotropyMap:{value:null},anisotropyMapTransform:{value:new xm}}]),vertexShader:Ay.meshphysical_vert,fragmentShader:Ay.meshphysical_frag};const Ry={r:0,b:0,g:0},Oy=new Ig,Dy=new Mg;function Ly(t,e,n,i,r,s,a){const o=new pv(0);let l,c,h=!0===s?0:1,u=null,d=0,p=null;function f(t){let i=!0===t.isScene?t.background:null;if(i&&i.isTexture){i=(t.backgroundBlurriness>0?n:e).get(i)}return i}function m(e,n){e.getRGB(Ry,sy(t)),i.buffers.color.setClear(Ry.r,Ry.g,Ry.b,n,a)}return{getClearColor:function(){return o},setClearColor:function(t,e=1){o.set(t),h=e,m(o,h)},getClearAlpha:function(){return h},setClearAlpha:function(t){h=t,m(o,h)},render:function(e){let n=!1;const r=f(e);null===r?m(o,h):r&&r.isColor&&(m(r,1),n=!0);const s=t.xr.getEnvironmentBlendMode();"additive"===s?i.buffers.color.setClear(0,0,0,1,a):"alpha-blend"===s&&i.buffers.color.setClear(0,0,0,0,a),(t.autoClear||n)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))},addToRenderList:function(e,n){const i=f(n);i&&(i.isCubeTexture||i.mapping===yp)?(void 0===c&&(c=new ty(new ny(1,1,1),new oy({name:"BackgroundCubeMaterial",uniforms:iy(Py.backgroundCube.uniforms),vertexShader:Py.backgroundCube.vertexShader,fragmentShader:Py.backgroundCube.fragmentShader,side:Nd,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),Oy.copy(n.backgroundRotation),Oy.x*=-1,Oy.y*=-1,Oy.z*=-1,i.isCubeTexture&&!1===i.isRenderTargetTexture&&(Oy.y*=-1,Oy.z*=-1),c.material.uniforms.envMap.value=i,c.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,c.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(Dy.makeRotationFromEuler(Oy)),c.material.toneMapped=Dm.getTransfer(i.colorSpace)!==Hf,u===i&&d===i.version&&p===t.toneMapping||(c.material.needsUpdate=!0,u=i,d=i.version,p=t.toneMapping),c.layers.enableAll(),e.unshift(c,c.geometry,c.material,0,0,null)):i&&i.isTexture&&(void 0===l&&(l=new ty(new Ey(2,2),new oy({name:"BackgroundMaterial",uniforms:iy(Py.background.uniforms),vertexShader:Py.background.vertexShader,fragmentShader:Py.background.fragmentShader,side:zd,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=i,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=Dm.getTransfer(i.colorSpace)!==Hf,!0===i.matrixAutoUpdate&&i.updateMatrix(),l.material.uniforms.uvTransform.value.copy(i.matrix),u===i&&d===i.version&&p===t.toneMapping||(l.material.needsUpdate=!0,u=i,d=i.version,p=t.toneMapping),l.layers.enableAll(),e.unshift(l,l.geometry,l.material,0,0,null))}}}function Iy(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),i={},r=c(null);let s=r,a=!1;function o(e){return t.bindVertexArray(e)}function l(e){return t.deleteVertexArray(e)}function c(t){const e=[],i=[],r=[];for(let t=0;t<n;t++)e[t]=0,i[t]=0,r[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:r,object:t,attributes:{},index:null}}function h(){const t=s.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function u(t){d(t,0)}function d(e,n){const i=s.newAttributes,r=s.enabledAttributes,a=s.attributeDivisors;i[e]=1,0===r[e]&&(t.enableVertexAttribArray(e),r[e]=1),a[e]!==n&&(t.vertexAttribDivisor(e,n),a[e]=n)}function p(){const e=s.newAttributes,n=s.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function f(e,n,i,r,s,a,o){!0===o?t.vertexAttribIPointer(e,n,i,s,a):t.vertexAttribPointer(e,n,i,r,s,a)}function m(){g(),a=!0,s!==r&&(s=r,o(s.object))}function g(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:function(n,r,l,m,g){let v=!1;const y=function(e,n,r){const s=!0===r.wireframe;let a=i[e.id];void 0===a&&(a={},i[e.id]=a);let o=a[n.id];void 0===o&&(o={},a[n.id]=o);let l=o[s];void 0===l&&(l=c(t.createVertexArray()),o[s]=l);return l}(m,l,r);s!==y&&(s=y,o(s.object)),v=function(t,e,n,i){const r=s.attributes,a=e.attributes;let o=0;const l=n.getAttributes();for(const e in l){if(l[e].location>=0){const n=r[e];let i=a[e];if(void 0===i&&("instanceMatrix"===e&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(i=t.instanceColor)),void 0===n)return!0;if(n.attribute!==i)return!0;if(i&&n.data!==i.data)return!0;o++}}return s.attributesNum!==o||s.index!==i}(n,m,l,g),v&&function(t,e,n,i){const r={},a=e.attributes;let o=0;const l=n.getAttributes();for(const e in l){if(l[e].location>=0){let n=a[e];void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor));const i={};i.attribute=n,n&&n.data&&(i.data=n.data),r[e]=i,o++}}s.attributes=r,s.attributesNum=o,s.index=i}(n,m,l,g),null!==g&&e.update(g,t.ELEMENT_ARRAY_BUFFER),(v||a)&&(a=!1,function(n,i,r,s){h();const a=s.attributes,o=r.getAttributes(),l=i.defaultAttributeValues;for(const i in o){const r=o[i];if(r.location>=0){let o=a[i];if(void 0===o&&("instanceMatrix"===i&&n.instanceMatrix&&(o=n.instanceMatrix),"instanceColor"===i&&n.instanceColor&&(o=n.instanceColor)),void 0!==o){const i=o.normalized,a=o.itemSize,l=e.get(o);if(void 0===l)continue;const c=l.buffer,h=l.type,p=l.bytesPerElement,m=h===t.INT||h===t.UNSIGNED_INT||o.gpuType===Dp;if(o.isInterleavedBufferAttribute){const e=o.data,l=e.stride,g=o.offset;if(e.isInstancedInterleavedBuffer){for(let t=0;t<r.locationSize;t++)d(r.location+t,e.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=e.meshPerAttribute*e.count)}else for(let t=0;t<r.locationSize;t++)u(r.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<r.locationSize;t++)f(r.location+t,a/r.locationSize,h,i,l*p,(g+a/r.locationSize*t)*p,m)}else{if(o.isInstancedBufferAttribute){for(let t=0;t<r.locationSize;t++)d(r.location+t,o.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let t=0;t<r.locationSize;t++)u(r.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<r.locationSize;t++)f(r.location+t,a/r.locationSize,h,i,a*p,a/r.locationSize*t*p,m)}}else if(void 0!==l){const e=l[i];if(void 0!==e)switch(e.length){case 2:t.vertexAttrib2fv(r.location,e);break;case 3:t.vertexAttrib3fv(r.location,e);break;case 4:t.vertexAttrib4fv(r.location,e);break;default:t.vertexAttrib1fv(r.location,e)}}}}p()}(n,r,l,m),null!==g&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const t in i){const e=i[t];for(const t in e){const n=e[t];for(const t in n)l(n[t].object),delete n[t];delete e[t]}delete i[t]}},releaseStatesOfGeometry:function(t){if(void 0===i[t.id])return;const e=i[t.id];for(const t in e){const n=e[t];for(const t in n)l(n[t].object),delete n[t];delete e[t]}delete i[t.id]},releaseStatesOfProgram:function(t){for(const e in i){const n=i[e];if(void 0===n[t.id])continue;const r=n[t.id];for(const t in r)l(r[t].object),delete r[t];delete n[t.id]}},initAttributes:h,enableAttribute:u,disableUnusedAttributes:p}}function zy(t,e,n){let i;function r(e,r,s){0!==s&&(t.drawArraysInstanced(i,e,r,s),n.update(r,i,s))}this.setMode=function(t){i=t},this.render=function(e,r){t.drawArrays(i,e,r),n.update(r,i,1)},this.renderInstances=r,this.renderMultiDraw=function(t,r,s){if(0===s)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,t,0,r,0,s);let a=0;for(let t=0;t<s;t++)a+=r[t];n.update(a,i,1)},this.renderMultiDrawInstances=function(t,s,a,o){if(0===a)return;const l=e.get("WEBGL_multi_draw");if(null===l)for(let e=0;e<t.length;e++)r(t[e],s[e],o[e]);else{l.multiDrawArraysInstancedWEBGL(i,t,0,s,0,o,0,a);let e=0;for(let t=0;t<a;t++)e+=s[t];for(let t=0;t<o.length;t++)n.update(e,i,o[t])}}}function Ny(t,e,n,i){let r;function s(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let a=void 0!==n.precision?n.precision:"highp";const o=s(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=!0===n.logarithmicDepthBuffer,c=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),h=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:s,textureFormatReadable:function(e){return e===jp||i.convert(e)===t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const r=n===zp&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(n!==Cp&&i.convert(n)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==Ip&&!r)},precision:a,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxCubemapSize:t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:t.getParameter(t.MAX_VERTEX_ATTRIBS),maxVertexUniforms:t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:t.getParameter(t.MAX_VARYING_VECTORS),maxFragmentUniforms:t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:h>0,maxSamples:t.getParameter(t.MAX_SAMPLES)}}function Uy(t){const e=this;let n=null,i=0,r=!1,s=!1;const a=new by,o=new xm,l={value:null,needsUpdate:!1};function c(t,n,i,r){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const e=i+4*s,r=n.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,n=i;e!==s;++e,n+=4)a.copy(t[e]).applyMatrix4(r,o),a.normal.toArray(c,n),c[n+3]=a.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const n=0!==t.length||e||0!==i||r;return r=e,i=t.length,n},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(t,e){n=c(t,e,0)},this.setState=function(a,o,h){const u=a.clippingPlanes,d=a.clipIntersection,p=a.clipShadows,f=t.get(a);if(!r||null===u||0===u.length||s&&!p)s?c(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=i>0);e.numPlanes=i,e.numIntersection=0}();else{const t=s?0:i,e=4*t;let r=f.clippingState||null;l.value=r,r=c(u,o,e,h);for(let t=0;t!==e;++t)r[t]=n[t];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function ky(t){let e=new WeakMap;function n(t,e){return e===gp?t.mapping=fp:e===vp&&(t.mapping=mp),t}function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping;if(s===gp||s===vp){if(e.has(r)){return n(e.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const a=new gy(s.height);return a.fromEquirectangularTexture(t,r),e.set(r,a),r.addEventListener("dispose",i),n(a.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}class By extends ly{constructor(t=-1,e=1,n=1,i=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,s=n+t,a=i+e,o=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,a-=e*this.view.offsetY,o=a-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const Fy=[.125,.215,.35,.446,.526,.582],Vy=20,jy=new By,Hy=new pv;let Gy=null,Wy=0,qy=0,Xy=!1;const $y=(1+Math.sqrt(5))/2,Yy=1/$y,Zy=[new $m(-$y,Yy,0),new $m($y,Yy,0),new $m(-Yy,0,$y),new $m(Yy,0,$y),new $m(0,$y,-Yy),new $m(0,$y,Yy),new $m(-1,1,-1),new $m(1,1,-1),new $m(-1,1,1),new $m(1,1,1)];class Ky{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){Gy=this._renderer.getRenderTarget(),Wy=this._renderer.getActiveCubeFace(),qy=this._renderer.getActiveMipmapLevel(),Xy=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=ex(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=tx(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Gy,Wy,qy),this._renderer.xr.enabled=Xy,t.scissorTest=!1,Qy(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===fp||t.mapping===mp?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Gy=this._renderer.getRenderTarget(),Wy=this._renderer.getActiveCubeFace(),qy=this._renderer.getActiveMipmapLevel(),Xy=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:Tp,minFilter:Tp,generateMipmaps:!1,type:zp,format:jp,colorSpace:Bf,depthBuffer:!1},i=Jy(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Jy(t,e,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],n=[],i=[];let r=t;const s=t-4+1+Fy.length;for(let a=0;a<s;a++){const s=Math.pow(2,r);n.push(s);let o=1/s;a>t-4?o=Fy[a-t+4-1]:0===a&&(o=0),i.push(o);const l=1/(s-2),c=-l,h=1+l,u=[c,c,h,c,h,h,c,c,h,h,c,h],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),x=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];v.set(i,f*p*t),y.set(u,m*p*t);const r=[t,t,t,t,t,t];x.set(r,g*p*t)}const b=new Nv;b.setAttribute("position",new Tv(v,f)),b.setAttribute("uv",new Tv(y,m)),b.setAttribute("faceIndex",new Tv(x,g)),e.push(b),r>4&&r--}return{lodPlanes:e,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(t,e,n){const i=new Float32Array(Vy),r=new $m(0,1,0),s=new oy({name:"SphericalGaussianBlur",defines:{n:Vy,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:nx(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return s}(i,t,e)}return i}_compileMaterial(t){const e=new ty(this._lodPlanes[0],t);this._renderer.compile(e,jy)}_sceneToCubeUV(t,e,n,i){const r=new dy(90,1,e,n),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(Hy),o.toneMapping=ap,o.autoClear=!1;const h=new vv({name:"PMREM.Background",side:Nd,depthWrite:!1,depthTest:!1}),u=new ty(new ny,h);let d=!1;const p=t.background;p?p.isColor&&(h.color.copy(p),t.background=null,d=!0):(h.color.copy(Hy),d=!0);for(let e=0;e<6;e++){const n=e%3;0===n?(r.up.set(0,s[e],0),r.lookAt(a[e],0,0)):1===n?(r.up.set(0,0,s[e]),r.lookAt(0,a[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,a[e]));const l=this._cubeSize;Qy(i,n*l,e>2?l:0,l,l),o.setRenderTarget(i),d&&o.render(u,r),o.render(t,r)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=c,o.autoClear=l,t.background=p}_textureToCubeUV(t,e){const n=this._renderer,i=t.mapping===fp||t.mapping===mp;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=ex()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=tx());const r=i?this._cubemapMaterial:this._equirectMaterial,s=new ty(this._lodPlanes[0],r);r.uniforms.envMap.value=t;const a=this._cubeSize;Qy(e,0,0,3*a,2*a),n.setRenderTarget(e),n.render(s,jy)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;const i=this._lodPlanes.length;for(let e=1;e<i;e++){const n=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),r=Zy[(i-e-1)%Zy.length];this._blur(t,e-1,e,n,r)}e.autoClear=n}_blur(t,e,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,i,"latitudinal",r),this._halfBlur(s,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,s,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new ty(this._lodPlanes[i],l),h=l.uniforms,u=this._sizeLods[n]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):Vy;f>Vy&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let t=0;t<Vy;++t){const e=t/p,n=Math.exp(-e*e/2);m.push(n),0===t?g+=n:t<f&&(g+=2*n)}for(let t=0;t<m.length;t++)m[t]=m[t]/g;h.envMap.value=t.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===s,a&&(h.poleAxis.value=a);const{_lodMax:v}=this;h.dTheta.value=d,h.mipInt.value=v-n;const y=this._sizeLods[i];Qy(e,3*y*(i>v-4?i-v+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(e),o.render(c,jy)}}function Jy(t,e,n){const i=new Gm(t,e,n);return i.texture.mapping=yp,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Qy(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function tx(){return new oy({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:nx(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function ex(){return new oy({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:nx(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function nx(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function ix(t){let e=new WeakMap,n=null;function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){const s=r.mapping,a=s===gp||s===vp,o=s===fp||s===mp;if(a||o){let s=e.get(r);const l=void 0!==s?s.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==l)return null===n&&(n=new Ky(t)),s=a?n.fromEquirectangular(r,s):n.fromCubemap(r,s),s.texture.pmremVersion=r.pmremVersion,e.set(r,s),s.texture;if(void 0!==s)return s.texture;{const l=r.image;return a&&l&&l.height>0||o&&l&&function(t){let e=0;const n=6;for(let i=0;i<n;i++)void 0!==t[i]&&e++;return e===n}(l)?(null===n&&(n=new Ky(t)),s=a?n.fromEquirectangular(r):n.fromCubemap(r),s.texture.pmremVersion=r.pmremVersion,e.set(r,s),r.addEventListener("dispose",i),s.texture):null}}}return r},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function rx(t){const e={};function n(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,i}return{has:function(t){return null!==n(t)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(t){const e=n(t);return null===e&&Am("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function sx(t,e,n,i){const r={},s=new WeakMap;function a(t){const o=t.target;null!==o.index&&e.remove(o.index);for(const t in o.attributes)e.remove(o.attributes[t]);for(const t in o.morphAttributes){const n=o.morphAttributes[t];for(let t=0,i=n.length;t<i;t++)e.remove(n[t])}o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(e.remove(l),s.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(t){const n=[],i=t.index,r=t.attributes.position;let a=0;if(null!==i){const t=i.array;a=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],s=t[e+2];n.push(i,r,r,s,s,i)}}else{if(void 0===r)return;{const t=r.array;a=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}}const o=new(_m(n)?Av:Ev)(n,1);o.version=a;const l=s.get(t);l&&e.remove(l),s.set(t,o)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",a),r[e.id]=!0,n.memory.geometries++),e},update:function(n){const i=n.attributes;for(const n in i)e.update(i[n],t.ARRAY_BUFFER);const r=n.morphAttributes;for(const n in r){const i=r[n];for(let n=0,r=i.length;n<r;n++)e.update(i[n],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&o(t)}else o(t);return s.get(t)}}}function ax(t,e,n){let i,r,s;function a(e,a,o){0!==o&&(t.drawElementsInstanced(i,a,r,e*s,o),n.update(a,i,o))}this.setMode=function(t){i=t},this.setIndex=function(t){r=t.type,s=t.bytesPerElement},this.render=function(e,a){t.drawElements(i,a,r,e*s),n.update(a,i,1)},this.renderInstances=a,this.renderMultiDraw=function(t,s,a){if(0===a)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,s,0,r,t,0,a);let o=0;for(let t=0;t<a;t++)o+=s[t];n.update(o,i,1)},this.renderMultiDrawInstances=function(t,o,l,c){if(0===l)return;const h=e.get("WEBGL_multi_draw");if(null===h)for(let e=0;e<t.length;e++)a(t[e]/s,o[e],c[e]);else{h.multiDrawElementsInstancedWEBGL(i,o,0,r,t,0,c,0,l);let e=0;for(let t=0;t<l;t++)e+=o[t];for(let t=0;t<c.length;t++)n.update(e,i,c[t])}}}function ox(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(n,i,r){switch(e.calls++,i){case t.TRIANGLES:e.triangles+=r*(n/3);break;case t.LINES:e.lines+=r*(n/2);break;case t.LINE_STRIP:e.lines+=r*(n-1);break;case t.LINE_LOOP:e.lines+=r*n;break;case t.POINTS:e.points+=r*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function lx(t,e,n){const i=new WeakMap,r=new jm;return{update:function(s,a,o){const l=s.morphTargetInfluences,c=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=void 0!==c?c.length:0;let u=i.get(a);if(void 0===u||u.count!==h){void 0!==u&&u.texture.dispose();const d=void 0!==a.morphAttributes.position,p=void 0!==a.morphAttributes.normal,f=void 0!==a.morphAttributes.color,m=a.morphAttributes.position||[],g=a.morphAttributes.normal||[],v=a.morphAttributes.color||[];let y=0;!0===d&&(y=1),!0===p&&(y=2),!0===f&&(y=3);let x=a.attributes.position.count*y,b=1;x>e.maxTextureSize&&(b=Math.ceil(x/e.maxTextureSize),x=e.maxTextureSize);const _=new Float32Array(x*b*4*h),w=new Wm(_,x,b,h);w.type=Ip,w.needsUpdate=!0;const S=4*y;for(let T=0;T<h;T++){const E=m[T],A=g[T],C=v[T],P=x*b*4*T;for(let R=0;R<E.count;R++){const O=R*S;!0===d&&(r.fromBufferAttribute(E,R),_[P+O+0]=r.x,_[P+O+1]=r.y,_[P+O+2]=r.z,_[P+O+3]=0),!0===p&&(r.fromBufferAttribute(A,R),_[P+O+4]=r.x,_[P+O+5]=r.y,_[P+O+6]=r.z,_[P+O+7]=0),!0===f&&(r.fromBufferAttribute(C,R),_[P+O+8]=r.x,_[P+O+9]=r.y,_[P+O+10]=r.z,_[P+O+11]=4===C.itemSize?r.w:1)}}function M(){w.dispose(),i.delete(a),a.removeEventListener("dispose",M)}u={count:h,texture:w,size:new ym(x,b)},i.set(a,u),a.addEventListener("dispose",M)}if(!0===s.isInstancedMesh&&null!==s.morphTexture)o.getUniforms().setValue(t,"morphTexture",s.morphTexture,n);else{let D=0;for(let I=0;I<l.length;I++)D+=l[I];const L=a.morphTargetsRelative?1:1-D;o.getUniforms().setValue(t,"morphTargetBaseInfluence",L),o.getUniforms().setValue(t,"morphTargetInfluences",l)}o.getUniforms().setValue(t,"morphTargetsTexture",u.texture,n),o.getUniforms().setValue(t,"morphTargetsTextureSize",u.size)}}}function cx(t,e,n,i){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(a){const o=i.render.frame,l=a.geometry,c=e.get(a,l);if(r.get(c)!==o&&(e.update(c),r.set(c,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),r.get(a)!==o&&(n.update(a.instanceMatrix,t.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,t.ARRAY_BUFFER),r.set(a,o))),a.isSkinnedMesh){const t=a.skeleton;r.get(t)!==o&&(t.update(),r.set(t,o))}return c},dispose:function(){r=new WeakMap}}}class hx extends Vm{constructor(t,e,n,i,r,s,a,o,l,c=1026){if(c!==Wp&&c!==qp)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===Wp&&(n=Lp),void 0===n&&c===qp&&(n=kp),super(null,i,r,s,a,o,c,n,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==a?a:wp,this.minFilter=void 0!==o?o:wp,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}const ux=new Vm,dx=new hx(1,1),px=new Wm,fx=new qm,mx=new my,gx=[],vx=[],yx=new Float32Array(16),xx=new Float32Array(9),bx=new Float32Array(4);function _x(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let s=gx[r];if(void 0===s&&(s=new Float32Array(r),gx[r]=s),0!==e){i.toArray(s,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(s,r)}return s}function wx(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function Sx(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function Mx(t,e){let n=vx[e];void 0===n&&(n=new Int32Array(e),vx[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function Tx(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function Ex(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(wx(n,e))return;t.uniform2fv(this.addr,e),Sx(n,e)}}function Ax(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(wx(n,e))return;t.uniform3fv(this.addr,e),Sx(n,e)}}function Cx(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(wx(n,e))return;t.uniform4fv(this.addr,e),Sx(n,e)}}function Px(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(wx(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Sx(n,e)}else{if(wx(n,i))return;bx.set(i),t.uniformMatrix2fv(this.addr,!1,bx),Sx(n,i)}}function Rx(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(wx(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Sx(n,e)}else{if(wx(n,i))return;xx.set(i),t.uniformMatrix3fv(this.addr,!1,xx),Sx(n,i)}}function Ox(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(wx(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Sx(n,e)}else{if(wx(n,i))return;yx.set(i),t.uniformMatrix4fv(this.addr,!1,yx),Sx(n,i)}}function Dx(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Lx(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(wx(n,e))return;t.uniform2iv(this.addr,e),Sx(n,e)}}function Ix(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(wx(n,e))return;t.uniform3iv(this.addr,e),Sx(n,e)}}function zx(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(wx(n,e))return;t.uniform4iv(this.addr,e),Sx(n,e)}}function Nx(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Ux(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(wx(n,e))return;t.uniform2uiv(this.addr,e),Sx(n,e)}}function kx(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(wx(n,e))return;t.uniform3uiv(this.addr,e),Sx(n,e)}}function Bx(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(wx(n,e))return;t.uniform4uiv(this.addr,e),Sx(n,e)}}function Fx(t,e,n){const i=this.cache,r=n.allocateTextureUnit();let s;i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),this.type===t.SAMPLER_2D_SHADOW?(dx.compareFunction=Zf,s=dx):s=ux,n.setTexture2D(e||s,r)}function Vx(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||fx,r)}function jx(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||mx,r)}function Hx(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||px,r)}function Gx(t,e){t.uniform1fv(this.addr,e)}function Wx(t,e){const n=_x(e,this.size,2);t.uniform2fv(this.addr,n)}function qx(t,e){const n=_x(e,this.size,3);t.uniform3fv(this.addr,n)}function Xx(t,e){const n=_x(e,this.size,4);t.uniform4fv(this.addr,n)}function $x(t,e){const n=_x(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Yx(t,e){const n=_x(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Zx(t,e){const n=_x(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Kx(t,e){t.uniform1iv(this.addr,e)}function Jx(t,e){t.uniform2iv(this.addr,e)}function Qx(t,e){t.uniform3iv(this.addr,e)}function tb(t,e){t.uniform4iv(this.addr,e)}function eb(t,e){t.uniform1uiv(this.addr,e)}function nb(t,e){t.uniform2uiv(this.addr,e)}function ib(t,e){t.uniform3uiv(this.addr,e)}function rb(t,e){t.uniform4uiv(this.addr,e)}function sb(t,e,n){const i=this.cache,r=e.length,s=Mx(n,r);wx(i,s)||(t.uniform1iv(this.addr,s),Sx(i,s));for(let t=0;t!==r;++t)n.setTexture2D(e[t]||ux,s[t])}function ab(t,e,n){const i=this.cache,r=e.length,s=Mx(n,r);wx(i,s)||(t.uniform1iv(this.addr,s),Sx(i,s));for(let t=0;t!==r;++t)n.setTexture3D(e[t]||fx,s[t])}function ob(t,e,n){const i=this.cache,r=e.length,s=Mx(n,r);wx(i,s)||(t.uniform1iv(this.addr,s),Sx(i,s));for(let t=0;t!==r;++t)n.setTextureCube(e[t]||mx,s[t])}function lb(t,e,n){const i=this.cache,r=e.length,s=Mx(n,r);wx(i,s)||(t.uniform1iv(this.addr,s),Sx(i,s));for(let t=0;t!==r;++t)n.setTexture2DArray(e[t]||px,s[t])}class cb{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.setValue=function(t){switch(t){case 5126:return Tx;case 35664:return Ex;case 35665:return Ax;case 35666:return Cx;case 35674:return Px;case 35675:return Rx;case 35676:return Ox;case 5124:case 35670:return Dx;case 35667:case 35671:return Lx;case 35668:case 35672:return Ix;case 35669:case 35673:return zx;case 5125:return Nx;case 36294:return Ux;case 36295:return kx;case 36296:return Bx;case 35678:case 36198:case 36298:case 36306:case 35682:return Fx;case 35679:case 36299:case 36307:return Vx;case 35680:case 36300:case 36308:case 36293:return jx;case 36289:case 36303:case 36311:case 36292:return Hx}}(e.type)}}class hb{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Gx;case 35664:return Wx;case 35665:return qx;case 35666:return Xx;case 35674:return $x;case 35675:return Yx;case 35676:return Zx;case 5124:case 35670:return Kx;case 35667:case 35671:return Jx;case 35668:case 35672:return Qx;case 35669:case 35673:return tb;case 5125:return eb;case 36294:return nb;case 36295:return ib;case 36296:return rb;case 35678:case 36198:case 36298:case 36306:case 35682:return sb;case 35679:case 36299:case 36307:return ab;case 35680:case 36300:case 36308:case 36293:return ob;case 36289:case 36303:case 36311:case 36292:return lb}}(e.type)}}class ub{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(t,e[s.id],n)}}}const db=/(\w+)(\])?(\[|\.)?/g;function pb(t,e){t.seq.push(e),t.map[e.id]=e}function fb(t,e,n){const i=t.name,r=i.length;for(db.lastIndex=0;;){const s=db.exec(i),a=db.lastIndex;let o=s[1];const l="]"===s[2],c=s[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===r){pb(n,void 0===c?new cb(o,t,e):new hb(o,t,e));break}{let t=n.map[o];void 0===t&&(t=new ub(o),pb(n,t)),n=t}}}class mb{constructor(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);fb(n,t.getUniformLocation(e,n.name),this)}}setValue(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)}setOptional(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)}static upload(t,e,n,i){for(let r=0,s=e.length;r!==s;++r){const s=e[r],a=n[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,i)}}static seqWithValue(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n}}function gb(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}const vb=37297;let yb=0;function xb(t,e,n){const i=t.getShaderParameter(e,t.COMPILE_STATUS),r=t.getShaderInfoLog(e).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const i=parseInt(s[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){const n=t.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let t=r;t<s;t++){const r=t+1;i.push(`${r===e?">":" "} ${r}: ${n[t]}`)}return i.join("\n")}(t.getShaderSource(e),i)}return r}function bb(t,e){const n=function(t){const e=Dm.getPrimaries(Dm.workingColorSpace),n=Dm.getPrimaries(t);let i;switch(e===n?i="":e===Wf&&n===Gf?i="LinearDisplayP3ToLinearSRGB":e===Gf&&n===Wf&&(i="LinearSRGBToLinearDisplayP3"),t){case Bf:case Vf:return[i,"LinearTransferOETF"];case kf:case Ff:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),[i,"LinearTransferOETF"]}}(e);return`vec4 ${t}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function _b(t,e){let n;switch(e){case op:n="Linear";break;case lp:n="Reinhard";break;case cp:n="OptimizedCineon";break;case hp:n="ACESFilmic";break;case dp:n="AgX";break;case pp:n="Neutral";break;case up:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function wb(t){return""!==t}function Sb(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Mb(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Tb=/^[ \t]*#include +<([\w\d./]+)>/gm;function Eb(t){return t.replace(Tb,Cb)}const Ab=new Map;function Cb(t,e){let n=Ay[e];if(void 0===n){const t=Ab.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");n=Ay[t],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,t)}return Eb(n)}const Pb=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Rb(t){return t.replace(Pb,Ob)}function Ob(t,e,n,i){let r="";for(let t=parseInt(e);t<parseInt(n);t++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function Db(t){let e=`precision ${t.precision} float;\n\tprecision ${t.precision} int;\n\tprecision ${t.precision} sampler2D;\n\tprecision ${t.precision} samplerCube;\n\tprecision ${t.precision} sampler3D;\n\tprecision ${t.precision} sampler2DArray;\n\tprecision ${t.precision} sampler2DShadow;\n\tprecision ${t.precision} samplerCubeShadow;\n\tprecision ${t.precision} sampler2DArrayShadow;\n\tprecision ${t.precision} isampler2D;\n\tprecision ${t.precision} isampler3D;\n\tprecision ${t.precision} isamplerCube;\n\tprecision ${t.precision} isampler2DArray;\n\tprecision ${t.precision} usampler2D;\n\tprecision ${t.precision} usampler3D;\n\tprecision ${t.precision} usamplerCube;\n\tprecision ${t.precision} usampler2DArray;\n\t`;return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Lb(t,e,n,i){const r=t.getContext(),s=n.defines;let a=n.vertexShader,o=n.fragmentShader;const l=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===Dd?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===Ld?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===Id&&(e="SHADOWMAP_TYPE_VSM"),e}(n),c=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case fp:case mp:e="ENVMAP_TYPE_CUBE";break;case yp:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),h=function(t){let e="ENVMAP_MODE_REFLECTION";t.envMap&&t.envMapMode===mp&&(e="ENVMAP_MODE_REFRACTION");return e}(n),u=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case ip:e="ENVMAP_BLENDING_MULTIPLY";break;case rp:e="ENVMAP_BLENDING_MIX";break;case sp:e="ENVMAP_BLENDING_ADD"}return e}(n),d=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const n=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),p=function(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(wb).join("\n")}(n),f=function(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(s),m=r.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(wb).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(wb).join("\n"),v.length>0&&(v+="\n")):(g=[Db(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(wb).join("\n"),v=[Db(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+h:"",n.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==ap?"#define TONE_MAPPING":"",n.toneMapping!==ap?Ay.tonemapping_pars_fragment:"",n.toneMapping!==ap?_b("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Ay.colorspace_pars_fragment,bb("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(wb).join("\n")),a=Eb(a),a=Sb(a,n),a=Mb(a,n),o=Eb(o),o=Sb(o,n),o=Mb(o,n),a=Rb(a),o=Rb(o),!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===im?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===im?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const x=y+g+a,b=y+v+o,_=gb(r,r.VERTEX_SHADER,x),w=gb(r,r.FRAGMENT_SHADER,b);function S(e){if(t.debug.checkShaderErrors){const n=r.getProgramInfoLog(m).trim(),i=r.getShaderInfoLog(_).trim(),s=r.getShaderInfoLog(w).trim();let a=!0,o=!0;if(!1===r.getProgramParameter(m,r.LINK_STATUS))if(a=!1,"function"==typeof t.debug.onShaderError)t.debug.onShaderError(r,m,_,w);else{const t=xb(r,_,"vertex"),i=xb(r,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,r.VALIDATE_STATUS)+"\n\nMaterial Name: "+e.name+"\nMaterial Type: "+e.type+"\n\nProgram Info Log: "+n+"\n"+t+"\n"+i)}else""!==n?console.warn("THREE.WebGLProgram: Program Info Log:",n):""!==i&&""!==s||(o=!1);o&&(e.diagnostics={runnable:a,programLog:n,vertexShader:{log:i,prefix:g},fragmentShader:{log:s,prefix:v}})}r.deleteShader(_),r.deleteShader(w),M=new mb(r,m),T=function(t,e){const n={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r),s=i.name;let a=1;i.type===t.FLOAT_MAT2&&(a=2),i.type===t.FLOAT_MAT3&&(a=3),i.type===t.FLOAT_MAT4&&(a=4),n[s]={type:i.type,location:t.getAttribLocation(e,s),locationSize:a}}return n}(r,m)}let M,T;r.attachShader(m,_),r.attachShader(m,w),void 0!==n.index0AttributeName?r.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),this.getUniforms=function(){return void 0===M&&S(this),M},this.getAttributes=function(){return void 0===T&&S(this),T};let E=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===E&&(E=r.getProgramParameter(m,vb)),E},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=yb++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=_,this.fragmentShader=w,this}let Ib=0;class zb{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,i=this._getShaderStage(e),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(t);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let n=e.get(t);return void 0===n&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){const e=this.shaderCache;let n=e.get(t);return void 0===n&&(n=new Nb(t),e.set(t,n)),n}}class Nb{constructor(t){this.id=Ib++,this.code=t,this.usedTimes=0}}function Ub(t,e,n,i,r,s,a){const o=new zg,l=new zb,c=new Set,h=[],u=r.logarithmicDepthBuffer,d=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(t){return c.add(t),0===t?"uv":`uv${t}`}return{getParameters:function(s,o,h,g,v){const y=g.fog,x=v.geometry,b=s.isMeshStandardMaterial?g.environment:null,_=(s.isMeshStandardMaterial?n:e).get(s.envMap||b),w=_&&_.mapping===yp?_.image.height:null,S=f[s.type];null!==s.precision&&(p=r.getMaxPrecision(s.precision),p!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",p,"instead."));const M=x.morphAttributes.position||x.morphAttributes.normal||x.morphAttributes.color,T=void 0!==M?M.length:0;let E,A,C,P,R=0;if(void 0!==x.morphAttributes.position&&(R=1),void 0!==x.morphAttributes.normal&&(R=2),void 0!==x.morphAttributes.color&&(R=3),S){const t=Py[S];E=t.vertexShader,A=t.fragmentShader}else E=s.vertexShader,A=s.fragmentShader,l.update(s),C=l.getVertexShaderID(s),P=l.getFragmentShaderID(s);const O=t.getRenderTarget(),D=!0===v.isInstancedMesh,L=!0===v.isBatchedMesh,I=!!s.map,z=!!s.matcap,N=!!_,U=!!s.aoMap,k=!!s.lightMap,B=!!s.bumpMap,F=!!s.normalMap,V=!!s.displacementMap,j=!!s.emissiveMap,H=!!s.metalnessMap,G=!!s.roughnessMap,W=s.anisotropy>0,q=s.clearcoat>0,X=s.dispersion>0,$=s.iridescence>0,Y=s.sheen>0,Z=s.transmission>0,K=W&&!!s.anisotropyMap,J=q&&!!s.clearcoatMap,Q=q&&!!s.clearcoatNormalMap,tt=q&&!!s.clearcoatRoughnessMap,et=$&&!!s.iridescenceMap,nt=$&&!!s.iridescenceThicknessMap,it=Y&&!!s.sheenColorMap,rt=Y&&!!s.sheenRoughnessMap,st=!!s.specularMap,at=!!s.specularColorMap,ot=!!s.specularIntensityMap,lt=Z&&!!s.transmissionMap,ct=Z&&!!s.thicknessMap,ht=!!s.gradientMap,ut=!!s.alphaMap,dt=s.alphaTest>0,pt=!!s.alphaHash,ft=!!s.extensions;let mt=ap;s.toneMapped&&(null!==O&&!0!==O.isXRRenderTarget||(mt=t.toneMapping));const gt={shaderID:S,shaderType:s.type,shaderName:s.name,vertexShader:E,fragmentShader:A,defines:s.defines,customVertexShaderID:C,customFragmentShaderID:P,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,batching:L,batchingColor:L&&null!==v._colorsTexture,instancing:D,instancingColor:D&&null!==v.instanceColor,instancingMorph:D&&null!==v.morphTexture,supportsVertexTextures:d,outputColorSpace:null===O?t.outputColorSpace:!0===O.isXRRenderTarget?O.texture.colorSpace:Bf,alphaToCoverage:!!s.alphaToCoverage,map:I,matcap:z,envMap:N,envMapMode:N&&_.mapping,envMapCubeUVHeight:w,aoMap:U,lightMap:k,bumpMap:B,normalMap:F,displacementMap:d&&V,emissiveMap:j,normalMapObjectSpace:F&&1===s.normalMapType,normalMapTangentSpace:F&&0===s.normalMapType,metalnessMap:H,roughnessMap:G,anisotropy:W,anisotropyMap:K,clearcoat:q,clearcoatMap:J,clearcoatNormalMap:Q,clearcoatRoughnessMap:tt,dispersion:X,iridescence:$,iridescenceMap:et,iridescenceThicknessMap:nt,sheen:Y,sheenColorMap:it,sheenRoughnessMap:rt,specularMap:st,specularColorMap:at,specularIntensityMap:ot,transmission:Z,transmissionMap:lt,thicknessMap:ct,gradientMap:ht,opaque:!1===s.transparent&&s.blending===kd&&!1===s.alphaToCoverage,alphaMap:ut,alphaTest:dt,alphaHash:pt,combine:s.combine,mapUv:I&&m(s.map.channel),aoMapUv:U&&m(s.aoMap.channel),lightMapUv:k&&m(s.lightMap.channel),bumpMapUv:B&&m(s.bumpMap.channel),normalMapUv:F&&m(s.normalMap.channel),displacementMapUv:V&&m(s.displacementMap.channel),emissiveMapUv:j&&m(s.emissiveMap.channel),metalnessMapUv:H&&m(s.metalnessMap.channel),roughnessMapUv:G&&m(s.roughnessMap.channel),anisotropyMapUv:K&&m(s.anisotropyMap.channel),clearcoatMapUv:J&&m(s.clearcoatMap.channel),clearcoatNormalMapUv:Q&&m(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:tt&&m(s.clearcoatRoughnessMap.channel),iridescenceMapUv:et&&m(s.iridescenceMap.channel),iridescenceThicknessMapUv:nt&&m(s.iridescenceThicknessMap.channel),sheenColorMapUv:it&&m(s.sheenColorMap.channel),sheenRoughnessMapUv:rt&&m(s.sheenRoughnessMap.channel),specularMapUv:st&&m(s.specularMap.channel),specularColorMapUv:at&&m(s.specularColorMap.channel),specularIntensityMapUv:ot&&m(s.specularIntensityMap.channel),transmissionMapUv:lt&&m(s.transmissionMap.channel),thicknessMapUv:ct&&m(s.thicknessMap.channel),alphaMapUv:ut&&m(s.alphaMap.channel),vertexTangents:!!x.attributes.tangent&&(F||W),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!x.attributes.color&&4===x.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!x.attributes.uv&&(I||ut),fog:!!y,useFog:!0===s.fog,fogExp2:!!y&&y.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==x.morphAttributes.position,morphNormals:void 0!==x.morphAttributes.normal,morphColors:void 0!==x.morphAttributes.color,morphTargetsCount:T,morphTextureStride:R,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.length>0,shadowMapType:t.shadowMap.type,toneMapping:mt,decodeVideoTexture:I&&!0===s.map.isVideoTexture&&Dm.getTransfer(s.map.colorSpace)===Hf,premultipliedAlpha:s.premultipliedAlpha,doubleSided:s.side===Ud,flipSided:s.side===Nd,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionClipCullDistance:ft&&!0===s.extensions.clipCullDistance&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(ft&&!0===s.extensions.multiDraw||L)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()};return gt.vertexUv1s=c.has(1),gt.vertexUv2s=c.has(2),gt.vertexUv3s=c.has(3),c.clear(),gt},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(n,e),function(t,e){o.disableAll(),e.supportsVertexTextures&&o.enable(0);e.instancing&&o.enable(1);e.instancingColor&&o.enable(2);e.instancingMorph&&o.enable(3);e.matcap&&o.enable(4);e.envMap&&o.enable(5);e.normalMapObjectSpace&&o.enable(6);e.normalMapTangentSpace&&o.enable(7);e.clearcoat&&o.enable(8);e.iridescence&&o.enable(9);e.alphaTest&&o.enable(10);e.vertexColors&&o.enable(11);e.vertexAlphas&&o.enable(12);e.vertexUv1s&&o.enable(13);e.vertexUv2s&&o.enable(14);e.vertexUv3s&&o.enable(15);e.vertexTangents&&o.enable(16);e.anisotropy&&o.enable(17);e.alphaHash&&o.enable(18);e.batching&&o.enable(19);e.dispersion&&o.enable(20);e.batchingColor&&o.enable(21);t.push(o.mask),o.disableAll(),e.fog&&o.enable(0);e.useFog&&o.enable(1);e.flatShading&&o.enable(2);e.logarithmicDepthBuffer&&o.enable(3);e.skinning&&o.enable(4);e.morphTargets&&o.enable(5);e.morphNormals&&o.enable(6);e.morphColors&&o.enable(7);e.premultipliedAlpha&&o.enable(8);e.shadowMapEnabled&&o.enable(9);e.doubleSided&&o.enable(10);e.flipSided&&o.enable(11);e.useDepthPacking&&o.enable(12);e.dithering&&o.enable(13);e.transmission&&o.enable(14);e.sheen&&o.enable(15);e.opaque&&o.enable(16);e.pointsUvs&&o.enable(17);e.decodeVideoTexture&&o.enable(18);e.alphaToCoverage&&o.enable(19);t.push(o.mask)}(n,e),n.push(t.outputColorSpace)),n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=f[t.type];let n;if(e){const t=Py[e];n=ay.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let i;for(let t=0,e=h.length;t<e;t++){const e=h[t];if(e.cacheKey===n){i=e,++i.usedTimes;break}}return void 0===i&&(i=new Lb(t,n,e,s),h.push(i)),i},releaseProgram:function(t){if(0==--t.usedTimes){const e=h.indexOf(t);h[e]=h[h.length-1],h.pop(),t.destroy()}},releaseShaderCache:function(t){l.remove(t)},programs:h,dispose:function(){l.dispose()}}}function kb(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function Bb(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function Fb(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Vb(){const t=[];let e=0;const n=[],i=[],r=[];function s(n,i,r,s,a,o){let l=t[e];return void 0===l?(l={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:a,group:o},t[e]=l):(l.id=n.id,l.object=n,l.geometry=i,l.material=r,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=a,l.group=o),e++,l}return{opaque:n,transmissive:i,transparent:r,init:function(){e=0,n.length=0,i.length=0,r.length=0},push:function(t,e,a,o,l,c){const h=s(t,e,a,o,l,c);a.transmission>0?i.push(h):!0===a.transparent?r.push(h):n.push(h)},unshift:function(t,e,a,o,l,c){const h=s(t,e,a,o,l,c);a.transmission>0?i.unshift(h):!0===a.transparent?r.unshift(h):n.unshift(h)},finish:function(){for(let n=e,i=t.length;n<i;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||Bb),i.length>1&&i.sort(e||Fb),r.length>1&&r.sort(e||Fb)}}}function jb(){let t=new WeakMap;return{get:function(e,n){const i=t.get(e);let r;return void 0===i?(r=new Vb,t.set(e,[r])):n>=i.length?(r=new Vb,i.push(r)):r=i[n],r},dispose:function(){t=new WeakMap}}}function Hb(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new $m,color:new pv};break;case"SpotLight":n={position:new $m,direction:new $m,color:new pv,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new $m,color:new pv,distance:0,decay:0};break;case"HemisphereLight":n={direction:new $m,skyColor:new pv,groundColor:new pv};break;case"RectAreaLight":n={color:new pv,position:new $m,halfWidth:new $m,halfHeight:new $m}}return t[e.id]=n,n}}}let Gb=0;function Wb(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function qb(t){const e=new Hb,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ym};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ym,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let t=0;t<9;t++)i.probe.push(new $m);const r=new $m,s=new Mg,a=new Mg;return{setup:function(r){let s=0,a=0,o=0;for(let t=0;t<9;t++)i.probe[t].set(0,0,0);let l=0,c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,v=0,y=0;r.sort(Wb);for(let t=0,x=r.length;t<x;t++){const x=r[t],b=x.color,_=x.intensity,w=x.distance,S=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)s+=b.r*_,a+=b.g*_,o+=b.b*_;else if(x.isLightProbe){for(let t=0;t<9;t++)i.probe[t].addScaledVector(x.sh.coefficients[t],_);y++}else if(x.isDirectionalLight){const t=e.get(x);if(t.color.copy(x.color).multiplyScalar(x.intensity),x.castShadow){const t=x.shadow,e=n.get(x);e.shadowIntensity=t.intensity,e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,i.directionalShadow[l]=e,i.directionalShadowMap[l]=S,i.directionalShadowMatrix[l]=x.shadow.matrix,p++}i.directional[l]=t,l++}else if(x.isSpotLight){const t=e.get(x);t.position.setFromMatrixPosition(x.matrixWorld),t.color.copy(b).multiplyScalar(_),t.distance=w,t.coneCos=Math.cos(x.angle),t.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),t.decay=x.decay,i.spot[h]=t;const r=x.shadow;if(x.map&&(i.spotLightMap[g]=x.map,g++,r.updateMatrices(x),x.castShadow&&v++),i.spotLightMatrix[h]=r.matrix,x.castShadow){const t=n.get(x);t.shadowIntensity=r.intensity,t.shadowBias=r.bias,t.shadowNormalBias=r.normalBias,t.shadowRadius=r.radius,t.shadowMapSize=r.mapSize,i.spotShadow[h]=t,i.spotShadowMap[h]=S,m++}h++}else if(x.isRectAreaLight){const t=e.get(x);t.color.copy(b).multiplyScalar(_),t.halfWidth.set(.5*x.width,0,0),t.halfHeight.set(0,.5*x.height,0),i.rectArea[u]=t,u++}else if(x.isPointLight){const t=e.get(x);if(t.color.copy(x.color).multiplyScalar(x.intensity),t.distance=x.distance,t.decay=x.decay,x.castShadow){const t=x.shadow,e=n.get(x);e.shadowIntensity=t.intensity,e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,e.shadowCameraNear=t.camera.near,e.shadowCameraFar=t.camera.far,i.pointShadow[c]=e,i.pointShadowMap[c]=S,i.pointShadowMatrix[c]=x.shadow.matrix,f++}i.point[c]=t,c++}else if(x.isHemisphereLight){const t=e.get(x);t.skyColor.copy(x.color).multiplyScalar(_),t.groundColor.copy(x.groundColor).multiplyScalar(_),i.hemi[d]=t,d++}}u>0&&(!0===t.has("OES_texture_float_linear")?(i.rectAreaLTC1=Cy.LTC_FLOAT_1,i.rectAreaLTC2=Cy.LTC_FLOAT_2):(i.rectAreaLTC1=Cy.LTC_HALF_1,i.rectAreaLTC2=Cy.LTC_HALF_2)),i.ambient[0]=s,i.ambient[1]=a,i.ambient[2]=o;const x=i.hash;x.directionalLength===l&&x.pointLength===c&&x.spotLength===h&&x.rectAreaLength===u&&x.hemiLength===d&&x.numDirectionalShadows===p&&x.numPointShadows===f&&x.numSpotShadows===m&&x.numSpotMaps===g&&x.numLightProbes===y||(i.directional.length=l,i.spot.length=h,i.rectArea.length=u,i.point.length=c,i.hemi.length=d,i.directionalShadow.length=p,i.directionalShadowMap.length=p,i.pointShadow.length=f,i.pointShadowMap.length=f,i.spotShadow.length=m,i.spotShadowMap.length=m,i.directionalShadowMatrix.length=p,i.pointShadowMatrix.length=f,i.spotLightMatrix.length=m+g-v,i.spotLightMap.length=g,i.numSpotLightShadowsWithMaps=v,i.numLightProbes=y,x.directionalLength=l,x.pointLength=c,x.spotLength=h,x.rectAreaLength=u,x.hemiLength=d,x.numDirectionalShadows=p,x.numPointShadows=f,x.numSpotShadows=m,x.numSpotMaps=g,x.numLightProbes=y,i.version=Gb++)},setupView:function(t,e){let n=0,o=0,l=0,c=0,h=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=i.directional[n];t.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(u),n++}else if(d.isSpotLight){const t=i.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const t=i.rectArea[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),a.identity(),s.copy(d.matrixWorld),s.premultiply(u),a.extractRotation(s),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const t=i.point[o];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),o++}else if(d.isHemisphereLight){const t=i.hemi[h];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),h++}}},state:i}}function Xb(t){const e=new qb(t),n=[],i=[];const r={lightsArray:n,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function(t){r.camera=t,n.length=0,i.length=0},state:r,setupLights:function(){e.setup(n)},setupLightsView:function(t){e.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){i.push(t)}}}function $b(t){let e=new WeakMap;return{get:function(n,i=0){const r=e.get(n);let s;return void 0===r?(s=new Xb(t),e.set(n,[s])):i>=r.length?(s=new Xb(t),r.push(s)):s=r[i],s},dispose:function(){e=new WeakMap}}}class Yb extends gv{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Zb extends gv{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function Kb(t,e,n){let i=new Sy;const r=new ym,s=new ym,a=new jm,o=new Yb({depthPacking:3201}),l=new Zb,c={},h=n.maxTextureSize,u={[zd]:Nd,[Nd]:zd,[Ud]:Ud},d=new oy({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ym},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new Nv;f.setAttribute("position",new Tv(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new ty(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Dd;let v=this.type;function y(n,i){const s=e.update(m);d.defines.VSM_SAMPLES!==n.blurSamples&&(d.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Gm(r.x,r.y)),d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,s,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,s,p,m,null)}function x(e,n,i,r){let s=null;const a=!0===i.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==a)s=a;else if(s=!0===i.isPointLight?l:o,t.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const t=s.uuid,e=n.uuid;let i=c[t];void 0===i&&(i={},c[t]=i);let r=i[e];void 0===r&&(r=s.clone(),i[e]=r,n.addEventListener("dispose",_)),s=r}if(s.visible=n.visible,s.wireframe=n.wireframe,s.side=r===Id?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:u[n.side],s.alphaMap=n.alphaMap,s.alphaTest=n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===i.isPointLight&&!0===s.isMeshDistanceMaterial){t.properties.get(s).light=i}return s}function b(n,r,s,a,o){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&o===Id)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=e.update(n),l=n.material;if(Array.isArray(l)){const e=i.groups;for(let c=0,h=e.length;c<h;c++){const h=e[c],u=l[h.materialIndex];if(u&&u.visible){const e=x(n,u,a,o);n.onBeforeShadow(t,n,r,s,i,e,h),t.renderBufferDirect(s,null,i,e,n,h),n.onAfterShadow(t,n,r,s,i,e,h)}}}else if(l.visible){const e=x(n,l,a,o);n.onBeforeShadow(t,n,r,s,i,e,null),t.renderBufferDirect(s,null,i,e,n,null),n.onAfterShadow(t,n,r,s,i,e,null)}}const l=n.children;for(let t=0,e=l.length;t<e;t++)b(l[t],r,s,a,o)}function _(t){t.target.removeEventListener("dispose",_);for(const e in c){const n=c[e],i=t.target.uuid;if(i in n){n[i].dispose(),delete n[i]}}}this.render=function(e,n,o){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=v!==Id&&this.type===Id,f=v===Id&&this.type!==Id;for(let l=0,c=e.length;l<c;l++){const c=e[l],u=c.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const m=u.getFrameExtents();if(r.multiply(m),s.copy(u.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/m.x),r.x=s.x*m.x,u.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/m.y),r.y=s.y*m.y,u.mapSize.y=s.y)),null===u.map||!0===p||!0===f){const t=this.type!==Id?{minFilter:wp,magFilter:wp}:{};null!==u.map&&u.map.dispose(),u.map=new Gm(r.x,r.y,t),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const g=u.getViewportCount();for(let t=0;t<g;t++){const e=u.getViewport(t);a.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),d.viewport(a),u.updateMatrices(c,t),i=u.getFrustum(),b(n,o,u.camera,c,this.type)}!0!==u.isPointLightShadow&&this.type===Id&&y(u,o),u.needsUpdate=!1}v=this.type,g.needsUpdate=!1,t.setRenderTarget(l,c,u)}}function Jb(t){const e=new function(){let e=!1;const n=new jm;let i=null;const r=new jm(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,s,a,o){!0===o&&(e*=a,i*=a,s*=a),n.set(e,i,s,a),!1===r.equals(n)&&(t.clearColor(e,i,s,a),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},n=new function(){let e=!1,n=null,i=null,r=null;return{setTest:function(e){e?B(t.DEPTH_TEST):F(t.DEPTH_TEST)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}},i=new function(){let e=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(n){e||(n?B(t.STENCIL_TEST):F(t.STENCIL_TEST))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,a){i===e&&r===n&&s===a||(t.stencilFunc(e,n,a),i=e,r=n,s=a)},setOp:function(e,n,i){a===e&&o===n&&l===i||(t.stencilOp(e,n,i),a=e,o=n,l=i)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,n=null,i=null,r=null,s=null,a=null,o=null,l=null,c=null}}},r=new WeakMap,s=new WeakMap;let a={},o={},l=new WeakMap,c=[],h=null,u=!1,d=null,p=null,f=null,m=null,g=null,v=null,y=null,x=new pv(0,0,0),b=0,_=!1,w=null,S=null,M=null,T=null,E=null;const A=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let C=!1,P=0;const R=t.getParameter(t.VERSION);-1!==R.indexOf("WebGL")?(P=parseFloat(/^WebGL (\d)/.exec(R)[1]),C=P>=1):-1!==R.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL ES (\d)/.exec(R)[1]),C=P>=2);let O=null,D={};const L=t.getParameter(t.SCISSOR_BOX),I=t.getParameter(t.VIEWPORT),z=(new jm).fromArray(L),N=(new jm).fromArray(I);function U(e,n,i,r){const s=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let a=0;a<i;a++)e===t.TEXTURE_3D||e===t.TEXTURE_2D_ARRAY?t.texImage3D(n,0,t.RGBA,1,1,r,0,t.RGBA,t.UNSIGNED_BYTE,s):t.texImage2D(n+a,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,s);return a}const k={};function B(e){!0!==a[e]&&(t.enable(e),a[e]=!0)}function F(e){!1!==a[e]&&(t.disable(e),a[e]=!1)}k[t.TEXTURE_2D]=U(t.TEXTURE_2D,t.TEXTURE_2D,1),k[t.TEXTURE_CUBE_MAP]=U(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),k[t.TEXTURE_2D_ARRAY]=U(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),k[t.TEXTURE_3D]=U(t.TEXTURE_3D,t.TEXTURE_3D,1,1),e.setClear(0,0,0,1),n.setClear(1),i.setClear(0),B(t.DEPTH_TEST),n.setFunc(3),G(!1),W(1),B(t.CULL_FACE),H(0);const V={[Bd]:t.FUNC_ADD,[Fd]:t.FUNC_SUBTRACT,[Vd]:t.FUNC_REVERSE_SUBTRACT};V[103]=t.MIN,V[104]=t.MAX;const j={[jd]:t.ZERO,[Hd]:t.ONE,[Gd]:t.SRC_COLOR,[qd]:t.SRC_ALPHA,[Jd]:t.SRC_ALPHA_SATURATE,[Zd]:t.DST_COLOR,[$d]:t.DST_ALPHA,[Wd]:t.ONE_MINUS_SRC_COLOR,[Xd]:t.ONE_MINUS_SRC_ALPHA,[Kd]:t.ONE_MINUS_DST_COLOR,[Yd]:t.ONE_MINUS_DST_ALPHA,[Qd]:t.CONSTANT_COLOR,[tp]:t.ONE_MINUS_CONSTANT_COLOR,[ep]:t.CONSTANT_ALPHA,[np]:t.ONE_MINUS_CONSTANT_ALPHA};function H(e,n,i,r,s,a,o,l,c,h){if(0!==e){if(!1===u&&(B(t.BLEND),u=!0),5===e)s=s||n,a=a||i,o=o||r,n===p&&s===g||(t.blendEquationSeparate(V[n],V[s]),p=n,g=s),i===f&&r===m&&a===v&&o===y||(t.blendFuncSeparate(j[i],j[r],j[a],j[o]),f=i,m=r,v=a,y=o),!1!==l.equals(x)&&c===b||(t.blendColor(l.r,l.g,l.b,c),x.copy(l),b=c),d=e,_=!1;else if(e!==d||h!==_){if(p===Bd&&g===Bd||(t.blendEquation(t.FUNC_ADD),p=Bd,g=Bd),h)switch(e){case kd:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case kd:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}f=null,m=null,v=null,y=null,x.set(0,0,0),b=0,d=e,_=h}}else!0===u&&(F(t.BLEND),u=!1)}function G(e){w!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),w=e)}function W(e){0!==e?(B(t.CULL_FACE),e!==S&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):F(t.CULL_FACE),S=e}function q(e,n,i){e?(B(t.POLYGON_OFFSET_FILL),T===n&&E===i||(t.polygonOffset(n,i),T=n,E=i)):F(t.POLYGON_OFFSET_FILL)}return{buffers:{color:e,depth:n,stencil:i},enable:B,disable:F,bindFramebuffer:function(e,n){return o[e]!==n&&(t.bindFramebuffer(e,n),o[e]=n,e===t.DRAW_FRAMEBUFFER&&(o[t.FRAMEBUFFER]=n),e===t.FRAMEBUFFER&&(o[t.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(e,n){let i=c,r=!1;if(e){i=l.get(n),void 0===i&&(i=[],l.set(n,i));const s=e.textures;if(i.length!==s.length||i[0]!==t.COLOR_ATTACHMENT0){for(let e=0,n=s.length;e<n;e++)i[e]=t.COLOR_ATTACHMENT0+e;i.length=s.length,r=!0}}else i[0]!==t.BACK&&(i[0]=t.BACK,r=!0);r&&t.drawBuffers(i)},useProgram:function(e){return h!==e&&(t.useProgram(e),h=e,!0)},setBlending:H,setMaterial:function(r,s){r.side===Ud?F(t.CULL_FACE):B(t.CULL_FACE);let a=r.side===Nd;s&&(a=!a),G(a),r.blending===kd&&!1===r.transparent?H(0):H(r.blending,r.blendEquation,r.blendSrc,r.blendDst,r.blendEquationAlpha,r.blendSrcAlpha,r.blendDstAlpha,r.blendColor,r.blendAlpha,r.premultipliedAlpha),n.setFunc(r.depthFunc),n.setTest(r.depthTest),n.setMask(r.depthWrite),e.setMask(r.colorWrite);const o=r.stencilWrite;i.setTest(o),o&&(i.setMask(r.stencilWriteMask),i.setFunc(r.stencilFunc,r.stencilRef,r.stencilFuncMask),i.setOp(r.stencilFail,r.stencilZFail,r.stencilZPass)),q(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits),!0===r.alphaToCoverage?B(t.SAMPLE_ALPHA_TO_COVERAGE):F(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:G,setCullFace:W,setLineWidth:function(e){e!==M&&(C&&t.lineWidth(e),M=e)},setPolygonOffset:q,setScissorTest:function(e){e?B(t.SCISSOR_TEST):F(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+A-1),O!==e&&(t.activeTexture(e),O=e)},bindTexture:function(e,n,i){void 0===i&&(i=null===O?t.TEXTURE0+A-1:O);let r=D[i];void 0===r&&(r={type:void 0,texture:void 0},D[i]=r),r.type===e&&r.texture===n||(O!==i&&(t.activeTexture(i),O=i),t.bindTexture(e,n||k[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=D[O];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{t.compressedTexImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(e,n){let i=s.get(n);void 0===i&&(i=new WeakMap,s.set(n,i));let r=i.get(e);void 0===r&&(r=t.getUniformBlockIndex(n,e.name),i.set(e,r))},uniformBlockBinding:function(e,n){const i=s.get(n).get(e);r.get(n)!==i&&(t.uniformBlockBinding(n,i,e.__bindingPointIndex),r.set(n,i))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===z.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),z.copy(e))},viewport:function(e){!1===N.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),N.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),a={},O=null,D={},o={},l=new WeakMap,c=[],h=null,u=!1,d=null,p=null,f=null,m=null,g=null,v=null,y=null,x=new pv(0,0,0),b=0,_=!1,w=null,S=null,M=null,T=null,E=null,z.set(0,0,t.canvas.width,t.canvas.height),N.set(0,0,t.canvas.width,t.canvas.height),e.reset(),n.reset(),i.reset()}}}function Qb(t,e,n,i){const r=function(t){switch(t){case Cp:case Pp:return{byteLength:1,components:1};case Op:case Rp:case zp:return{byteLength:2,components:1};case Np:case Up:return{byteLength:2,components:4};case Lp:case Dp:case Ip:return{byteLength:4,components:1};case Bp:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}(i);switch(n){case Fp:case Hp:return t*e;case Gp:return t*e*2;case Xp:case $p:return t*e/r.components*r.byteLength;case Yp:case Zp:return t*e*2/r.components*r.byteLength;case Vp:return t*e*3/r.components*r.byteLength;case jp:case Kp:return t*e*4/r.components*r.byteLength;case Jp:case Qp:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case tf:case ef:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case rf:case af:return Math.max(t,16)*Math.max(e,8)/4;case nf:case sf:return Math.max(t,8)*Math.max(e,8)/2;case of:case lf:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case cf:case hf:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case uf:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case df:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case pf:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case ff:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case mf:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case gf:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case vf:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case yf:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case xf:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case bf:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case _f:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case wf:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case Sf:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case Mf:case Tf:case Ef:return Math.ceil(t/4)*Math.ceil(e/4)*16;case Af:case Cf:return Math.ceil(t/4)*Math.ceil(e/4)*8;case Pf:case Rf:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function t_(t,e,n,i,r,s,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new ym,h=new WeakMap;let u;const d=new WeakMap;let p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function f(t,e){return p?new OffscreenCanvas(t,e):Mm("canvas")}function m(t,e,n){let i=1;const r=F(t);if((r.width>n||r.height>n)&&(i=n/Math.max(r.width,r.height)),i<1){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&t instanceof VideoFrame){const n=Math.floor(i*r.width),s=Math.floor(i*r.height);void 0===u&&(u=f(n,s));const a=e?f(n,s):u;a.width=n,a.height=s;return a.getContext("2d").drawImage(t,0,0,n,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+r.width+"x"+r.height+") to ("+n+"x"+s+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+r.width+"x"+r.height+")."),t}return t}function g(t){return t.generateMipmaps&&t.minFilter!==wp&&t.minFilter!==Tp}function v(e){t.generateMipmap(e)}function y(n,i,r,s,a=!1){if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=i;if(i===t.RED&&(r===t.FLOAT&&(o=t.R32F),r===t.HALF_FLOAT&&(o=t.R16F),r===t.UNSIGNED_BYTE&&(o=t.R8)),i===t.RED_INTEGER&&(r===t.UNSIGNED_BYTE&&(o=t.R8UI),r===t.UNSIGNED_SHORT&&(o=t.R16UI),r===t.UNSIGNED_INT&&(o=t.R32UI),r===t.BYTE&&(o=t.R8I),r===t.SHORT&&(o=t.R16I),r===t.INT&&(o=t.R32I)),i===t.RG&&(r===t.FLOAT&&(o=t.RG32F),r===t.HALF_FLOAT&&(o=t.RG16F),r===t.UNSIGNED_BYTE&&(o=t.RG8)),i===t.RG_INTEGER&&(r===t.UNSIGNED_BYTE&&(o=t.RG8UI),r===t.UNSIGNED_SHORT&&(o=t.RG16UI),r===t.UNSIGNED_INT&&(o=t.RG32UI),r===t.BYTE&&(o=t.RG8I),r===t.SHORT&&(o=t.RG16I),r===t.INT&&(o=t.RG32I)),i===t.RGB&&r===t.UNSIGNED_INT_5_9_9_9_REV&&(o=t.RGB9_E5),i===t.RGBA){const e=a?jf:Dm.getTransfer(s);r===t.FLOAT&&(o=t.RGBA32F),r===t.HALF_FLOAT&&(o=t.RGBA16F),r===t.UNSIGNED_BYTE&&(o=e===Hf?t.SRGB8_ALPHA8:t.RGBA8),r===t.UNSIGNED_SHORT_4_4_4_4&&(o=t.RGBA4),r===t.UNSIGNED_SHORT_5_5_5_1&&(o=t.RGB5_A1)}return o!==t.R16F&&o!==t.R32F&&o!==t.RG16F&&o!==t.RG32F&&o!==t.RGBA16F&&o!==t.RGBA32F||e.get("EXT_color_buffer_float"),o}function x(e,n){let i;return e?null===n||n===Lp||n===kp?i=t.DEPTH24_STENCIL8:n===Ip?i=t.DEPTH32F_STENCIL8:n===Op&&(i=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):null===n||n===Lp||n===kp?i=t.DEPTH_COMPONENT24:n===Ip?i=t.DEPTH_COMPONENT32F:n===Op&&(i=t.DEPTH_COMPONENT16),i}function b(t,e){return!0===g(t)||t.isFramebufferTexture&&t.minFilter!==wp&&t.minFilter!==Tp?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function _(t){const e=t.target;e.removeEventListener("dispose",_),function(t){const e=i.get(t);if(void 0===e.__webglInit)return;const n=t.source,r=d.get(n);if(r){const i=r[e.__cacheKey];i.usedTimes--,0===i.usedTimes&&S(t),0===Object.keys(r).length&&d.delete(n)}i.remove(t)}(e),e.isVideoTexture&&h.delete(e)}function w(e){const n=e.target;n.removeEventListener("dispose",w),function(e){const n=i.get(e);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++){if(Array.isArray(n.__webglFramebuffer[e]))for(let i=0;i<n.__webglFramebuffer[e].length;i++)t.deleteFramebuffer(n.__webglFramebuffer[e][i]);else t.deleteFramebuffer(n.__webglFramebuffer[e]);n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[e])}else{if(Array.isArray(n.__webglFramebuffer))for(let e=0;e<n.__webglFramebuffer.length;e++)t.deleteFramebuffer(n.__webglFramebuffer[e]);else t.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let e=0;e<n.__webglColorRenderbuffer.length;e++)n.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(n.__webglColorRenderbuffer[e]);n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const r=e.textures;for(let e=0,n=r.length;e<n;e++){const n=i.get(r[e]);n.__webglTexture&&(t.deleteTexture(n.__webglTexture),a.memory.textures--),i.remove(r[e])}i.remove(e)}(n)}function S(e){const n=i.get(e);t.deleteTexture(n.__webglTexture);const r=e.source;delete d.get(r)[n.__cacheKey],a.memory.textures--}let M=0;function T(e,r){const s=i.get(e);if(e.isVideoTexture&&function(t){const e=a.render.frame;h.get(t)!==e&&(h.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&s.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void O(s,e,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(t.TEXTURE_2D,s.__webglTexture,t.TEXTURE0+r)}const E={[xp]:t.REPEAT,[bp]:t.CLAMP_TO_EDGE,[_p]:t.MIRRORED_REPEAT},A={[wp]:t.NEAREST,[Sp]:t.NEAREST_MIPMAP_NEAREST,[Mp]:t.NEAREST_MIPMAP_LINEAR,[Tp]:t.LINEAR,[Ep]:t.LINEAR_MIPMAP_NEAREST,[Ap]:t.LINEAR_MIPMAP_LINEAR},C={[Xf]:t.NEVER,[tm]:t.ALWAYS,[$f]:t.LESS,[Zf]:t.LEQUAL,[Yf]:t.EQUAL,[Qf]:t.GEQUAL,[Kf]:t.GREATER,[Jf]:t.NOTEQUAL};function P(n,s){if(s.type!==Ip||!1!==e.has("OES_texture_float_linear")||s.magFilter!==Tp&&s.magFilter!==Ep&&s.magFilter!==Mp&&s.magFilter!==Ap&&s.minFilter!==Tp&&s.minFilter!==Ep&&s.minFilter!==Mp&&s.minFilter!==Ap||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(n,t.TEXTURE_WRAP_S,E[s.wrapS]),t.texParameteri(n,t.TEXTURE_WRAP_T,E[s.wrapT]),n!==t.TEXTURE_3D&&n!==t.TEXTURE_2D_ARRAY||t.texParameteri(n,t.TEXTURE_WRAP_R,E[s.wrapR]),t.texParameteri(n,t.TEXTURE_MAG_FILTER,A[s.magFilter]),t.texParameteri(n,t.TEXTURE_MIN_FILTER,A[s.minFilter]),s.compareFunction&&(t.texParameteri(n,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(n,t.TEXTURE_COMPARE_FUNC,C[s.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){if(s.magFilter===wp)return;if(s.minFilter!==Mp&&s.minFilter!==Ap)return;if(s.type===Ip&&!1===e.has("OES_texture_float_linear"))return;if(s.anisotropy>1||i.get(s).__currentAnisotropy){const a=e.get("EXT_texture_filter_anisotropic");t.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy}}}function R(e,n){let i=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",_));const r=n.source;let s=d.get(r);void 0===s&&(s={},d.set(r,s));const o=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(n);if(o!==e.__cacheKey){void 0===s[o]&&(s[o]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,i=!0),s[o].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&S(n)),e.__cacheKey=o,e.__webglTexture=s[o].texture}return i}function O(e,a,o){let l=t.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(l=t.TEXTURE_2D_ARRAY),a.isData3DTexture&&(l=t.TEXTURE_3D);const c=R(e,a),h=a.source;n.bindTexture(l,e.__webglTexture,t.TEXTURE0+o);const u=i.get(h);if(h.version!==u.__version||!0===c){n.activeTexture(t.TEXTURE0+o);const e=Dm.getPrimaries(Dm.workingColorSpace),i=a.colorSpace===Uf?null:Dm.getPrimaries(a.colorSpace),d=a.colorSpace===Uf||e===i?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,a.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,a.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=m(a.image,!1,r.maxTextureSize);p=B(a,p);const f=s.convert(a.format,a.colorSpace),_=s.convert(a.type);let w,S=y(a.internalFormat,f,_,a.colorSpace,a.isVideoTexture);P(l,a);const M=a.mipmaps,T=!0!==a.isVideoTexture,E=void 0===u.__version||!0===c,A=h.dataReady,C=b(a,p);if(a.isDepthTexture)S=x(a.format===qp,a.type),E&&(T?n.texStorage2D(t.TEXTURE_2D,1,S,p.width,p.height):n.texImage2D(t.TEXTURE_2D,0,S,p.width,p.height,0,f,_,null));else if(a.isDataTexture)if(M.length>0){T&&E&&n.texStorage2D(t.TEXTURE_2D,C,S,M[0].width,M[0].height);for(let e=0,i=M.length;e<i;e++)w=M[e],T?A&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,w.width,w.height,f,_,w.data):n.texImage2D(t.TEXTURE_2D,e,S,w.width,w.height,0,f,_,w.data);a.generateMipmaps=!1}else T?(E&&n.texStorage2D(t.TEXTURE_2D,C,S,p.width,p.height),A&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,p.width,p.height,f,_,p.data)):n.texImage2D(t.TEXTURE_2D,0,S,p.width,p.height,0,f,_,p.data);else if(a.isCompressedTexture)if(a.isCompressedArrayTexture){T&&E&&n.texStorage3D(t.TEXTURE_2D_ARRAY,C,S,M[0].width,M[0].height,p.depth);for(let e=0,i=M.length;e<i;e++)if(w=M[e],a.format!==jp)if(null!==f)if(T){if(A)if(a.layerUpdates.size>0){const i=Qb(w.width,w.height,a.format,a.type);for(const r of a.layerUpdates){const s=w.data.subarray(r*i/w.data.BYTES_PER_ELEMENT,(r+1)*i/w.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,r,w.width,w.height,1,f,s,0,0)}a.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,w.width,w.height,p.depth,f,w.data,0,0)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,S,w.width,w.height,p.depth,0,w.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else T?A&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,w.width,w.height,p.depth,f,_,w.data):n.texImage3D(t.TEXTURE_2D_ARRAY,e,S,w.width,w.height,p.depth,0,f,_,w.data)}else{T&&E&&n.texStorage2D(t.TEXTURE_2D,C,S,M[0].width,M[0].height);for(let e=0,i=M.length;e<i;e++)w=M[e],a.format!==jp?null!==f?T?A&&n.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,w.width,w.height,f,w.data):n.compressedTexImage2D(t.TEXTURE_2D,e,S,w.width,w.height,0,w.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):T?A&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,w.width,w.height,f,_,w.data):n.texImage2D(t.TEXTURE_2D,e,S,w.width,w.height,0,f,_,w.data)}else if(a.isDataArrayTexture)if(T){if(E&&n.texStorage3D(t.TEXTURE_2D_ARRAY,C,S,p.width,p.height,p.depth),A)if(a.layerUpdates.size>0){const e=Qb(p.width,p.height,a.format,a.type);for(const i of a.layerUpdates){const r=p.data.subarray(i*e/p.data.BYTES_PER_ELEMENT,(i+1)*e/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,i,p.width,p.height,1,f,_,r)}a.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,_,p.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,S,p.width,p.height,p.depth,0,f,_,p.data);else if(a.isData3DTexture)T?(E&&n.texStorage3D(t.TEXTURE_3D,C,S,p.width,p.height,p.depth),A&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,_,p.data)):n.texImage3D(t.TEXTURE_3D,0,S,p.width,p.height,p.depth,0,f,_,p.data);else if(a.isFramebufferTexture){if(E)if(T)n.texStorage2D(t.TEXTURE_2D,C,S,p.width,p.height);else{let e=p.width,i=p.height;for(let r=0;r<C;r++)n.texImage2D(t.TEXTURE_2D,r,S,e,i,0,f,_,null),e>>=1,i>>=1}}else if(M.length>0){if(T&&E){const e=F(M[0]);n.texStorage2D(t.TEXTURE_2D,C,S,e.width,e.height)}for(let e=0,i=M.length;e<i;e++)w=M[e],T?A&&n.texSubImage2D(t.TEXTURE_2D,e,0,0,f,_,w):n.texImage2D(t.TEXTURE_2D,e,S,f,_,w);a.generateMipmaps=!1}else if(T){if(E){const e=F(p);n.texStorage2D(t.TEXTURE_2D,C,S,e.width,e.height)}A&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,f,_,p)}else n.texImage2D(t.TEXTURE_2D,0,S,f,_,p);g(a)&&v(l),u.__version=h.version,a.onUpdate&&a.onUpdate(a)}e.__version=a.version}function D(e,r,a,l,c,h){const u=s.convert(a.format,a.colorSpace),d=s.convert(a.type),p=y(a.internalFormat,u,d,a.colorSpace);if(!i.get(r).__hasExternalTextures){const e=Math.max(1,r.width>>h),i=Math.max(1,r.height>>h);c===t.TEXTURE_3D||c===t.TEXTURE_2D_ARRAY?n.texImage3D(c,h,p,e,i,r.depth,0,u,d,null):n.texImage2D(c,h,p,e,i,0,u,d,null)}n.bindFramebuffer(t.FRAMEBUFFER,e),k(r)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,l,c,i.get(a).__webglTexture,0,U(r)):(c===t.TEXTURE_2D||c>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,l,c,i.get(a).__webglTexture,h),n.bindFramebuffer(t.FRAMEBUFFER,null)}function L(e,n,i){if(t.bindRenderbuffer(t.RENDERBUFFER,e),n.depthBuffer){const r=n.depthTexture,s=r&&r.isDepthTexture?r.type:null,a=x(n.stencilBuffer,s),l=n.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,c=U(n);k(n)?o.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,c,a,n.width,n.height):i?t.renderbufferStorageMultisample(t.RENDERBUFFER,c,a,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,a,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,l,t.RENDERBUFFER,e)}else{const e=n.textures;for(let r=0;r<e.length;r++){const a=e[r],l=s.convert(a.format,a.colorSpace),c=s.convert(a.type),h=y(a.internalFormat,l,c,a.colorSpace),u=U(n);i&&!1===k(n)?t.renderbufferStorageMultisample(t.RENDERBUFFER,u,h,n.width,n.height):k(n)?o.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,u,h,n.width,n.height):t.renderbufferStorage(t.RENDERBUFFER,h,n.width,n.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function I(e){const r=i.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),T(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture,a=U(r);if(r.depthTexture.format===Wp)k(r)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s,0);else{if(r.depthTexture.format!==qp)throw new Error("Unknown depthTexture format");k(r)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=t.createRenderbuffer(),L(r.__webglDepthbuffer[i],e,!1)}else n.bindFramebuffer(t.FRAMEBUFFER,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),L(r.__webglDepthbuffer,e,!1);n.bindFramebuffer(t.FRAMEBUFFER,null)}const z=[],N=[];function U(t){return Math.min(r.maxSamples,t.samples)}function k(t){const n=i.get(t);return t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function B(t,e){const n=t.colorSpace,i=t.format,r=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||n!==Bf&&n!==Uf&&(Dm.getTransfer(n)===Hf?i===jp&&r===Cp||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",n)),e}function F(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?(c.width=t.naturalWidth||t.width,c.height=t.naturalHeight||t.height):"undefined"!=typeof VideoFrame&&t instanceof VideoFrame?(c.width=t.displayWidth,c.height=t.displayHeight):(c.width=t.width,c.height=t.height),c}this.allocateTextureUnit=function(){const t=M;return t>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+r.maxTextures),M+=1,t},this.resetTextureUnits=function(){M=0},this.setTexture2D=T,this.setTexture2DArray=function(e,r){const s=i.get(e);e.version>0&&s.__version!==e.version?O(s,e,r):n.bindTexture(t.TEXTURE_2D_ARRAY,s.__webglTexture,t.TEXTURE0+r)},this.setTexture3D=function(e,r){const s=i.get(e);e.version>0&&s.__version!==e.version?O(s,e,r):n.bindTexture(t.TEXTURE_3D,s.__webglTexture,t.TEXTURE0+r)},this.setTextureCube=function(e,a){const o=i.get(e);e.version>0&&o.__version!==e.version?function(e,a,o){if(6!==a.image.length)return;const l=R(e,a),c=a.source;n.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+o);const h=i.get(c);if(c.version!==h.__version||!0===l){n.activeTexture(t.TEXTURE0+o);const e=Dm.getPrimaries(Dm.workingColorSpace),i=a.colorSpace===Uf?null:Dm.getPrimaries(a.colorSpace),u=a.colorSpace===Uf||e===i?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,a.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,a.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,u);const d=a.isCompressedTexture||a.image[0].isCompressedTexture,p=a.image[0]&&a.image[0].isDataTexture,f=[];for(let t=0;t<6;t++)f[t]=d||p?p?a.image[t].image:a.image[t]:m(a.image[t],!0,r.maxCubemapSize),f[t]=B(a,f[t]);const x=f[0],_=s.convert(a.format,a.colorSpace),w=s.convert(a.type),S=y(a.internalFormat,_,w,a.colorSpace),M=!0!==a.isVideoTexture,T=void 0===h.__version||!0===l,E=c.dataReady;let A,C=b(a,x);if(P(t.TEXTURE_CUBE_MAP,a),d){M&&T&&n.texStorage2D(t.TEXTURE_CUBE_MAP,C,S,x.width,x.height);for(let e=0;e<6;e++){A=f[e].mipmaps;for(let i=0;i<A.length;i++){const r=A[i];a.format!==jp?null!==_?M?E&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0,0,r.width,r.height,_,r.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,S,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):M?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0,0,r.width,r.height,_,w,r.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,S,r.width,r.height,0,_,w,r.data)}}}else{if(A=a.mipmaps,M&&T){A.length>0&&C++;const e=F(f[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,C,S,e.width,e.height)}for(let e=0;e<6;e++)if(p){M?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,f[e].width,f[e].height,_,w,f[e].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,S,f[e].width,f[e].height,0,_,w,f[e].data);for(let i=0;i<A.length;i++){const r=A[i].image[e].image;M?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,0,0,r.width,r.height,_,w,r.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,S,r.width,r.height,0,_,w,r.data)}}else{M?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,_,w,f[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,S,_,w,f[e]);for(let i=0;i<A.length;i++){const r=A[i];M?E&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,0,0,_,w,r.image[e]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,i+1,S,_,w,r.image[e])}}}g(a)&&v(t.TEXTURE_CUBE_MAP),h.__version=c.version,a.onUpdate&&a.onUpdate(a)}e.__version=a.version}(o,e,a):n.bindTexture(t.TEXTURE_CUBE_MAP,o.__webglTexture,t.TEXTURE0+a)},this.rebindTextures=function(e,n,r){const s=i.get(e);void 0!==n&&D(s.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==r&&I(e)},this.setupRenderTarget=function(e){const r=e.texture,o=i.get(e),l=i.get(r);e.addEventListener("dispose",w);const c=e.textures,h=!0===e.isWebGLCubeRenderTarget,u=c.length>1;if(u||(void 0===l.__webglTexture&&(l.__webglTexture=t.createTexture()),l.__version=r.version,a.memory.textures++),h){o.__webglFramebuffer=[];for(let e=0;e<6;e++)if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer[e]=[];for(let n=0;n<r.mipmaps.length;n++)o.__webglFramebuffer[e][n]=t.createFramebuffer()}else o.__webglFramebuffer[e]=t.createFramebuffer()}else{if(r.mipmaps&&r.mipmaps.length>0){o.__webglFramebuffer=[];for(let e=0;e<r.mipmaps.length;e++)o.__webglFramebuffer[e]=t.createFramebuffer()}else o.__webglFramebuffer=t.createFramebuffer();if(u)for(let e=0,n=c.length;e<n;e++){const n=i.get(c[e]);void 0===n.__webglTexture&&(n.__webglTexture=t.createTexture(),a.memory.textures++)}if(e.samples>0&&!1===k(e)){o.__webglMultisampledFramebuffer=t.createFramebuffer(),o.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,o.__webglMultisampledFramebuffer);for(let n=0;n<c.length;n++){const i=c[n];o.__webglColorRenderbuffer[n]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,o.__webglColorRenderbuffer[n]);const r=s.convert(i.format,i.colorSpace),a=s.convert(i.type),l=y(i.internalFormat,r,a,i.colorSpace,!0===e.isXRRenderTarget),h=U(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,h,l,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+n,t.RENDERBUFFER,o.__webglColorRenderbuffer[n])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(o.__webglDepthRenderbuffer=t.createRenderbuffer(),L(o.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(h){n.bindTexture(t.TEXTURE_CUBE_MAP,l.__webglTexture),P(t.TEXTURE_CUBE_MAP,r);for(let n=0;n<6;n++)if(r.mipmaps&&r.mipmaps.length>0)for(let i=0;i<r.mipmaps.length;i++)D(o.__webglFramebuffer[n][i],e,r,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,i);else D(o.__webglFramebuffer[n],e,r,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(r)&&v(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(u){for(let r=0,s=c.length;r<s;r++){const s=c[r],a=i.get(s);n.bindTexture(t.TEXTURE_2D,a.__webglTexture),P(t.TEXTURE_2D,s),D(o.__webglFramebuffer,e,s,t.COLOR_ATTACHMENT0+r,t.TEXTURE_2D,0),g(s)&&v(t.TEXTURE_2D)}n.unbindTexture()}else{let i=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(i=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(i,l.__webglTexture),P(i,r),r.mipmaps&&r.mipmaps.length>0)for(let n=0;n<r.mipmaps.length;n++)D(o.__webglFramebuffer[n],e,r,t.COLOR_ATTACHMENT0,i,n);else D(o.__webglFramebuffer,e,r,t.COLOR_ATTACHMENT0,i,0);g(r)&&v(i),n.unbindTexture()}e.depthBuffer&&I(e)},this.updateRenderTargetMipmap=function(e){const r=e.textures;for(let s=0,a=r.length;s<a;s++){const a=r[s];if(g(a)){const r=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,s=i.get(a).__webglTexture;n.bindTexture(r,s),v(r),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.samples>0)if(!1===k(e)){const r=e.textures,s=e.width,a=e.height;let o=t.COLOR_BUFFER_BIT;const c=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,h=i.get(e),u=r.length>1;if(u)for(let e=0;e<r.length;e++)n.bindFramebuffer(t.FRAMEBUFFER,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,h.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,h.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglFramebuffer);for(let n=0;n<r.length;n++){if(e.resolveDepthBuffer&&(e.depthBuffer&&(o|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&e.resolveStencilBuffer&&(o|=t.STENCIL_BUFFER_BIT)),u){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,h.__webglColorRenderbuffer[n]);const e=i.get(r[n]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,s,a,0,0,s,a,o,t.NEAREST),!0===l&&(z.length=0,N.length=0,z.push(t.COLOR_ATTACHMENT0+n),e.depthBuffer&&!1===e.resolveDepthBuffer&&(z.push(c),N.push(c),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,N)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,z))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),u)for(let e=0;e<r.length;e++){n.bindFramebuffer(t.FRAMEBUFFER,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,h.__webglColorRenderbuffer[e]);const s=i.get(r[e]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,h.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,s,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,h.__webglMultisampledFramebuffer)}else if(e.depthBuffer&&!1===e.resolveDepthBuffer&&l){const n=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=I,this.setupFrameBufferTexture=D,this.useMultisampledRTT=k}function e_(t,e){return{convert:function(n,i=""){let r;const s=Dm.getTransfer(i);if(n===Cp)return t.UNSIGNED_BYTE;if(n===Np)return t.UNSIGNED_SHORT_4_4_4_4;if(n===Up)return t.UNSIGNED_SHORT_5_5_5_1;if(n===Bp)return t.UNSIGNED_INT_5_9_9_9_REV;if(n===Pp)return t.BYTE;if(n===Rp)return t.SHORT;if(n===Op)return t.UNSIGNED_SHORT;if(n===Dp)return t.INT;if(n===Lp)return t.UNSIGNED_INT;if(n===Ip)return t.FLOAT;if(n===zp)return t.HALF_FLOAT;if(n===Fp)return t.ALPHA;if(n===Vp)return t.RGB;if(n===jp)return t.RGBA;if(n===Hp)return t.LUMINANCE;if(n===Gp)return t.LUMINANCE_ALPHA;if(n===Wp)return t.DEPTH_COMPONENT;if(n===qp)return t.DEPTH_STENCIL;if(n===Xp)return t.RED;if(n===$p)return t.RED_INTEGER;if(n===Yp)return t.RG;if(n===Zp)return t.RG_INTEGER;if(n===Kp)return t.RGBA_INTEGER;if(n===Jp||n===Qp||n===tf||n===ef)if(s===Hf){if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(n===Jp)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Qp)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===tf)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===ef)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=e.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(n===Jp)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Qp)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===tf)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===ef)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===nf||n===rf||n===sf||n===af){if(r=e.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(n===nf)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===rf)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===sf)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===af)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===of||n===lf||n===cf){if(r=e.get("WEBGL_compressed_texture_etc"),null===r)return null;if(n===of||n===lf)return s===Hf?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===cf)return s===Hf?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===hf||n===uf||n===df||n===pf||n===ff||n===mf||n===gf||n===vf||n===yf||n===xf||n===bf||n===_f||n===wf||n===Sf){if(r=e.get("WEBGL_compressed_texture_astc"),null===r)return null;if(n===hf)return s===Hf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===uf)return s===Hf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===df)return s===Hf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===pf)return s===Hf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===ff)return s===Hf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===mf)return s===Hf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===gf)return s===Hf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===vf)return s===Hf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===yf)return s===Hf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===xf)return s===Hf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===bf)return s===Hf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===_f)return s===Hf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===wf)return s===Hf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Sf)return s===Hf?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===Mf||n===Tf||n===Ef){if(r=e.get("EXT_texture_compression_bptc"),null===r)return null;if(n===Mf)return s===Hf?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===Tf)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Ef)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===Af||n===Cf||n===Pf||n===Rf){if(r=e.get("EXT_texture_compression_rgtc"),null===r)return null;if(n===Mf)return r.COMPRESSED_RED_RGTC1_EXT;if(n===Cf)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Pf)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Rf)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===kp?t.UNSIGNED_INT_24_8:void 0!==t[n]?t[n]:null}}}class n_ extends dy{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class i_ extends Kg{constructor(){super(),this.isGroup=!0,this.type="Group"}}const r_={type:"move"};class s_{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new i_,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new i_,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new $m,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new $m),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new i_,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new $m,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new $m),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let i=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){s=!0;for(const i of t.hand.values()){const t=e.getJointPose(i,n),r=this._getHandJoint(l,i);null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,r.jointRadius=t.radius),r.visible=null!==t}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=i.position.distanceTo(r.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(i=e.getPose(t.targetRaySpace,n),null===i&&null!==r&&(i=r),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(r_)))}return null!==a&&(a.visible=null!==i),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const n=new i_;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}class a_{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e,n){if(null===this.texture){const i=new Vm;t.properties.get(i).__webglTexture=e.texture,e.depthNear==n.depthNear&&e.depthFar==n.depthFar||(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=i}}getMesh(t){if(null!==this.texture&&null===this.mesh){const e=t.cameras[0].viewport,n=new oy({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new ty(new Ey(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class o_ extends am{constructor(t,e){super();const n=this;let i=null,r=1,s=null,a="local-floor",o=1,l=null,c=null,h=null,u=null,d=null,p=null;const f=new a_,m=e.getContextAttributes();let g=null,v=null;const y=[],x=[],b=new ym;let _=null;const w=new dy;w.layers.enable(1),w.viewport=new jm;const S=new dy;S.layers.enable(2),S.viewport=new jm;const M=[w,S],T=new n_;T.layers.enable(1),T.layers.enable(2);let E=null,A=null;function C(t){const e=x.indexOf(t.inputSource);if(-1===e)return;const n=y[e];void 0!==n&&(n.update(t.inputSource,t.frame,l||s),n.dispatchEvent({type:t.type,data:t.inputSource}))}function P(){i.removeEventListener("select",C),i.removeEventListener("selectstart",C),i.removeEventListener("selectend",C),i.removeEventListener("squeeze",C),i.removeEventListener("squeezestart",C),i.removeEventListener("squeezeend",C),i.removeEventListener("end",P),i.removeEventListener("inputsourceschange",R);for(let t=0;t<y.length;t++){const e=x[t];null!==e&&(x[t]=null,y[t].disconnect(e))}E=null,A=null,f.reset(),t.setRenderTarget(g),d=null,u=null,h=null,i=null,v=null,z.stop(),n.isPresenting=!1,t.setPixelRatio(_),t.setSize(b.width,b.height,!1),n.dispatchEvent({type:"sessionend"})}function R(t){for(let e=0;e<t.removed.length;e++){const n=t.removed[e],i=x.indexOf(n);i>=0&&(x[i]=null,y[i].disconnect(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e];let i=x.indexOf(n);if(-1===i){for(let t=0;t<y.length;t++){if(t>=x.length){x.push(n),i=t;break}if(null===x[t]){x[t]=n,i=t;break}}if(-1===i)break}const r=y[i];r&&r.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=y[t];return void 0===e&&(e=new s_,y[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=y[t];return void 0===e&&(e=new s_,y[t]=e),e.getGripSpace()},this.getHand=function(t){let e=y[t];return void 0===e&&(e=new s_,y[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(t){l=t},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(c){if(i=c,null!==i){if(g=t.getRenderTarget(),i.addEventListener("select",C),i.addEventListener("selectstart",C),i.addEventListener("selectend",C),i.addEventListener("squeeze",C),i.addEventListener("squeezestart",C),i.addEventListener("squeezeend",C),i.addEventListener("end",P),i.addEventListener("inputsourceschange",R),!0!==m.xrCompatible&&await e.makeXRCompatible(),_=t.getPixelRatio(),t.getSize(b),void 0===i.renderState.layers){const n={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(i,e,n),i.updateRenderState({baseLayer:d}),t.setPixelRatio(1),t.setSize(d.framebufferWidth,d.framebufferHeight,!1),v=new Gm(d.framebufferWidth,d.framebufferHeight,{format:jp,type:Cp,colorSpace:t.outputColorSpace,stencilBuffer:m.stencil})}else{let n=null,s=null,a=null;m.depth&&(a=m.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,n=m.stencil?qp:Wp,s=m.stencil?kp:Lp);const o={colorFormat:e.RGBA8,depthFormat:a,scaleFactor:r};h=new XRWebGLBinding(i,e),u=h.createProjectionLayer(o),i.updateRenderState({layers:[u]}),t.setPixelRatio(1),t.setSize(u.textureWidth,u.textureHeight,!1),v=new Gm(u.textureWidth,u.textureHeight,{format:jp,type:Cp,depthTexture:new hx(u.textureWidth,u.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:t.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===u.ignoreDepthValues})}v.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await i.requestReferenceSpace(a),z.setContext(i),z.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode},this.getDepthTexture=function(){return f.getDepthTexture()};const O=new $m,D=new $m;function L(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===i)return;null!==f.texture&&(t.near=f.depthNear,t.far=f.depthFar),T.near=S.near=w.near=t.near,T.far=S.far=w.far=t.far,E===T.near&&A===T.far||(i.updateRenderState({depthNear:T.near,depthFar:T.far}),E=T.near,A=T.far,w.near=E,w.far=A,S.near=E,S.far=A,w.updateProjectionMatrix(),S.updateProjectionMatrix(),t.updateProjectionMatrix());const e=t.parent,n=T.cameras;L(T,e);for(let t=0;t<n.length;t++)L(n[t],e);2===n.length?function(t,e,n){O.setFromMatrixPosition(e.matrixWorld),D.setFromMatrixPosition(n.matrixWorld);const i=O.distanceTo(D),r=e.projectionMatrix.elements,s=n.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=a*h,p=a*u,f=i/(-h+u),m=f*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=a+f,v=o+f,y=d-m,x=p+(i-m),b=l*o/v*g,_=c*o/v*g;t.projectionMatrix.makePerspective(y,x,b,_,g,v),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}(T,w,S):T.projectionMatrix.copy(w.projectionMatrix),function(t,e,n){null===n?t.matrix.copy(e.matrixWorld):(t.matrix.copy(n.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld));t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*hm*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,T,e)},this.getCamera=function(){return T},this.getFoveation=function(){if(null!==u||null!==d)return o},this.setFoveation=function(t){o=t,null!==u&&(u.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(T)};let I=null;const z=new My;z.setAnimationLoop((function(e,r){if(c=r.getViewerPose(l||s),p=r,null!==c){const e=c.views;null!==d&&(t.setRenderTargetFramebuffer(v,d.framebuffer),t.setRenderTarget(v));let n=!1;e.length!==T.cameras.length&&(T.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const r=e[i];let s=null;if(null!==d)s=d.getViewport(r);else{const e=h.getViewSubImage(u,r);s=e.viewport,0===i&&(t.setRenderTargetTextures(v,e.colorTexture,u.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(v))}let a=M[i];void 0===a&&(a=new dy,a.layers.enable(i),a.viewport=new jm,M[i]=a),a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),a.projectionMatrix.fromArray(r.projectionMatrix),a.projectionMatrixInverse.copy(a.projectionMatrix).invert(),a.viewport.set(s.x,s.y,s.width,s.height),0===i&&(T.matrix.copy(a.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),!0===n&&T.cameras.push(a)}const r=i.enabledFeatures;if(r&&r.includes("depth-sensing")){const n=h.getDepthInformation(e[0]);n&&n.isValid&&n.texture&&f.init(t,n,i.renderState)}}for(let t=0;t<y.length;t++){const e=x[t],n=y[t];null!==e&&void 0!==n&&n.update(e,r,l||s)}I&&I(e,r),r.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:r}),p=null})),this.setAnimationLoop=function(t){I=t},this.dispose=function(){}}}const l_=new Ig,c_=new Mg;function h_(t,e){function n(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function i(t,i){t.opacity.value=i.opacity,i.color&&t.diffuse.value.copy(i.color),i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(t.map.value=i.map,n(i.map,t.mapTransform)),i.alphaMap&&(t.alphaMap.value=i.alphaMap,n(i.alphaMap,t.alphaMapTransform)),i.bumpMap&&(t.bumpMap.value=i.bumpMap,n(i.bumpMap,t.bumpMapTransform),t.bumpScale.value=i.bumpScale,i.side===Nd&&(t.bumpScale.value*=-1)),i.normalMap&&(t.normalMap.value=i.normalMap,n(i.normalMap,t.normalMapTransform),t.normalScale.value.copy(i.normalScale),i.side===Nd&&t.normalScale.value.negate()),i.displacementMap&&(t.displacementMap.value=i.displacementMap,n(i.displacementMap,t.displacementMapTransform),t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap,n(i.emissiveMap,t.emissiveMapTransform)),i.specularMap&&(t.specularMap.value=i.specularMap,n(i.specularMap,t.specularMapTransform)),i.alphaTest>0&&(t.alphaTest.value=i.alphaTest);const r=e.get(i),s=r.envMap,a=r.envMapRotation;s&&(t.envMap.value=s,l_.copy(a),l_.x*=-1,l_.y*=-1,l_.z*=-1,s.isCubeTexture&&!1===s.isRenderTargetTexture&&(l_.y*=-1,l_.z*=-1),t.envMapRotation.value.setFromMatrix4(c_.makeRotationFromEuler(l_)),t.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,t.reflectivity.value=i.reflectivity,t.ior.value=i.ior,t.refractionRatio.value=i.refractionRatio),i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity,n(i.lightMap,t.lightMapTransform)),i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity,n(i.aoMap,t.aoMapTransform))}return{refreshFogUniforms:function(e,n){n.color.getRGB(e.fogColor.value,sy(t)),n.isFog?(e.fogNear.value=n.near,e.fogFar.value=n.far):n.isFogExp2&&(e.fogDensity.value=n.density)},refreshMaterialUniforms:function(t,r,s,a,o){r.isMeshBasicMaterial||r.isMeshLambertMaterial?i(t,r):r.isMeshToonMaterial?(i(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,r)):r.isMeshPhongMaterial?(i(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,r)):r.isMeshStandardMaterial?(i(t,r),function(t,e){t.metalness.value=e.metalness,e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap,n(e.metalnessMap,t.metalnessMapTransform));t.roughness.value=e.roughness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap,n(e.roughnessMap,t.roughnessMapTransform));e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}(t,r),r.isMeshPhysicalMaterial&&function(t,e,i){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,n(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,n(e.sheenRoughnessMap,t.sheenRoughnessMapTransform)));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,n(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,n(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,n(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),e.side===Nd&&t.clearcoatNormalScale.value.negate()));e.dispersion>0&&(t.dispersion.value=e.dispersion);e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,n(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,n(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform)));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,n(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,n(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,n(e.anisotropyMap,t.anisotropyMapTransform)));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,n(e.specularColorMap,t.specularColorMapTransform));e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,n(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,r,o)):r.isMeshMatcapMaterial?(i(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,r)):r.isMeshDepthMaterial?i(t,r):r.isMeshDistanceMaterial?(i(t,r),function(t,n){const i=e.get(n).light;t.referencePosition.value.setFromMatrixPosition(i.matrixWorld),t.nearDistance.value=i.shadow.camera.near,t.farDistance.value=i.shadow.camera.far}(t,r)):r.isMeshNormalMaterial?i(t,r):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform))}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,i,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*r,e.map&&(t.map.value=e.map,n(e.map,t.uvTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r,s,a):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,n(e.map,t.mapTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,n(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function u_(t,e,n,i){let r={},s={},a=[];const o=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function l(t,e,n,i){const r=t.value,s=e+"_"+n;if(void 0===i[s])return i[s]="number"==typeof r||"boolean"==typeof r?r:r.clone(),!0;{const t=i[s];if("number"==typeof r||"boolean"==typeof r){if(t!==r)return i[s]=r,!0}else if(!1===t.equals(r))return t.copy(r),!0}return!1}function c(t){const e={boundary:0,storage:0};return"number"==typeof t||"boolean"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e}function h(e){const n=e.target;n.removeEventListener("dispose",h);const i=a.indexOf(n.__bindingPointIndex);a.splice(i,1),t.deleteBuffer(r[n.id]),delete r[n.id],delete s[n.id]}return{bind:function(t,e){const n=e.program;i.uniformBlockBinding(t,n)},update:function(n,u){let d=r[n.id];void 0===d&&(!function(t){const e=t.uniforms;let n=0;const i=16;for(let t=0,r=e.length;t<r;t++){const r=Array.isArray(e[t])?e[t]:[e[t]];for(let t=0,e=r.length;t<e;t++){const e=r[t],s=Array.isArray(e.value)?e.value:[e.value];for(let t=0,r=s.length;t<r;t++){const r=c(s[t]),a=n%i;0!==a&&i-a<r.boundary&&(n+=i-a),e.__data=new Float32Array(r.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=n,n+=r.storage}}}const r=n%i;r>0&&(n+=i-r);t.__size=n,t.__cache={}}(n),d=function(e){const n=function(){for(let t=0;t<o;t++)if(-1===a.indexOf(t))return a.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=n;const i=t.createBuffer(),r=e.__size,s=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,i),t.bufferData(t.UNIFORM_BUFFER,r,s),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,n,i),i}(n),r[n.id]=d,n.addEventListener("dispose",h));const p=u.program;i.updateUBOMapping(n,p);const f=e.render.frame;s[n.id]!==f&&(!function(e){const n=r[e.id],i=e.uniforms,s=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,n);for(let e=0,n=i.length;e<n;e++){const n=Array.isArray(i[e])?i[e]:[i[e]];for(let i=0,r=n.length;i<r;i++){const r=n[i];if(!0===l(r,e,i,s)){const e=r.__offset,n=Array.isArray(r.value)?r.value:[r.value];let i=0;for(let s=0;s<n.length;s++){const a=n[s],o=c(a);"number"==typeof a||"boolean"==typeof a?(r.__data[0]=a,t.bufferSubData(t.UNIFORM_BUFFER,e+i,r.__data)):a.isMatrix3?(r.__data[0]=a.elements[0],r.__data[1]=a.elements[1],r.__data[2]=a.elements[2],r.__data[3]=0,r.__data[4]=a.elements[3],r.__data[5]=a.elements[4],r.__data[6]=a.elements[5],r.__data[7]=0,r.__data[8]=a.elements[6],r.__data[9]=a.elements[7],r.__data[10]=a.elements[8],r.__data[11]=0):(a.toArray(r.__data,i),i+=o.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,r.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(n),s[n.id]=f)},dispose:function(){for(const e in r)t.deleteBuffer(r[e]);a=[],r={},s={}}}}class d_{constructor(t={}){const{canvas:e=Tm(),context:n=null,depth:i=!0,stencil:r=!1,alpha:s=!1,antialias:a=!1,premultipliedAlpha:o=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:h=!1}=t;let u;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!=typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");u=n.getContextAttributes().alpha}else u=s;const d=new Uint32Array(4),p=new Int32Array(4);let f=null,m=null;const g=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=kf,this.toneMapping=ap,this.toneMappingExposure=1;const y=this;let x=!1,b=0,_=0,w=null,S=-1,M=null;const T=new jm,E=new jm;let A=null;const C=new pv(0);let P=0,R=e.width,O=e.height,D=1,L=null,I=null;const z=new jm(0,0,R,O),N=new jm(0,0,R,O);let U=!1;const k=new Sy;let B=!1,F=!1;const V=new Mg,j=new $m,H=new jm,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let W=!1;function q(){return null===w?D:1}let X,$,Y,Z,K,J,Q,tt,et,nt,it,rt,st,at,ot,lt,ct,ht,ut,dt,pt,ft,mt,gt,vt=n;function yt(t,n){return e.getContext(t,n)}try{const t={alpha:!0,depth:i,stencil:r,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Pd}`),e.addEventListener("webglcontextlost",_t,!1),e.addEventListener("webglcontextrestored",wt,!1),e.addEventListener("webglcontextcreationerror",St,!1),null===vt){const e="webgl2";if(vt=yt(e,t),null===vt)throw yt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function xt(){X=new rx(vt),X.init(),ft=new e_(vt,X),$=new Ny(vt,X,t,ft),Y=new Jb(vt),Z=new ox(vt),K=new kb,J=new t_(vt,X,Y,K,$,ft,Z),Q=new ky(y),tt=new ix(y),et=new Ty(vt),mt=new Iy(vt,et),nt=new sx(vt,et,Z,mt),it=new cx(vt,nt,et,Z),ut=new lx(vt,$,J),lt=new Uy(K),rt=new Ub(y,Q,tt,X,$,mt,lt),st=new h_(y,K),at=new jb,ot=new $b(X),ht=new Ly(y,Q,tt,Y,it,u,o),ct=new Kb(y,it,$),gt=new u_(vt,Z,$,Y),dt=new zy(vt,X,Z),pt=new ax(vt,X,Z),Z.programs=rt.programs,y.capabilities=$,y.extensions=X,y.properties=K,y.renderLists=at,y.shadowMap=ct,y.state=Y,y.info=Z}xt();const bt=new o_(y,vt);function _t(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function wt(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const t=Z.autoReset,e=ct.enabled,n=ct.autoUpdate,i=ct.needsUpdate,r=ct.type;xt(),Z.autoReset=t,ct.enabled=e,ct.autoUpdate=n,ct.needsUpdate=i,ct.type=r}function St(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function Mt(t){const e=t.target;e.removeEventListener("dispose",Mt),function(t){(function(t){const e=K.get(t).programs;void 0!==e&&(e.forEach((function(t){rt.releaseProgram(t)})),t.isShaderMaterial&&rt.releaseShaderCache(t))})(t),K.remove(t)}(e)}function Tt(t,e,n){!0===t.transparent&&t.side===Ud&&!1===t.forceSinglePass?(t.side=Nd,t.needsUpdate=!0,zt(t,e,n),t.side=zd,t.needsUpdate=!0,zt(t,e,n),t.side=Ud):zt(t,e,n)}this.xr=bt,this.getContext=function(){return vt},this.getContextAttributes=function(){return vt.getContextAttributes()},this.forceContextLoss=function(){const t=X.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=X.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(t){void 0!==t&&(D=t,this.setSize(R,O,!1))},this.getSize=function(t){return t.set(R,O)},this.setSize=function(t,n,i=!0){bt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(R=t,O=n,e.width=Math.floor(t*D),e.height=Math.floor(n*D),!0===i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(R*D,O*D).floor()},this.setDrawingBufferSize=function(t,n,i){R=t,O=n,D=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(T)},this.getViewport=function(t){return t.copy(z)},this.setViewport=function(t,e,n,i){t.isVector4?z.set(t.x,t.y,t.z,t.w):z.set(t,e,n,i),Y.viewport(T.copy(z).multiplyScalar(D).round())},this.getScissor=function(t){return t.copy(N)},this.setScissor=function(t,e,n,i){t.isVector4?N.set(t.x,t.y,t.z,t.w):N.set(t,e,n,i),Y.scissor(E.copy(N).multiplyScalar(D).round())},this.getScissorTest=function(){return U},this.setScissorTest=function(t){Y.setScissorTest(U=t)},this.setOpaqueSort=function(t){L=t},this.setTransparentSort=function(t){I=t},this.getClearColor=function(t){return t.copy(ht.getClearColor())},this.setClearColor=function(){ht.setClearColor.apply(ht,arguments)},this.getClearAlpha=function(){return ht.getClearAlpha()},this.setClearAlpha=function(){ht.setClearAlpha.apply(ht,arguments)},this.clear=function(t=!0,e=!0,n=!0){let i=0;if(t){let t=!1;if(null!==w){const e=w.texture.format;t=e===Kp||e===Zp||e===$p}if(t){const t=w.texture.type,e=t===Cp||t===Lp||t===Op||t===kp||t===Np||t===Up,n=ht.getClearColor(),i=ht.getClearAlpha(),r=n.r,s=n.g,a=n.b;e?(d[0]=r,d[1]=s,d[2]=a,d[3]=i,vt.clearBufferuiv(vt.COLOR,0,d)):(p[0]=r,p[1]=s,p[2]=a,p[3]=i,vt.clearBufferiv(vt.COLOR,0,p))}else i|=vt.COLOR_BUFFER_BIT}e&&(i|=vt.DEPTH_BUFFER_BIT),n&&(i|=vt.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),vt.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",_t,!1),e.removeEventListener("webglcontextrestored",wt,!1),e.removeEventListener("webglcontextcreationerror",St,!1),at.dispose(),ot.dispose(),K.dispose(),Q.dispose(),tt.dispose(),it.dispose(),mt.dispose(),gt.dispose(),rt.dispose(),bt.dispose(),bt.removeEventListener("sessionstart",At),bt.removeEventListener("sessionend",Ct),Pt.stop()},this.renderBufferDirect=function(t,e,n,i,r,s){null===e&&(e=G);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(t,e,n,i,r){!0!==e.isScene&&(e=G);J.resetTextureUnits();const s=e.fog,a=i.isMeshStandardMaterial?e.environment:null,o=null===w?y.outputColorSpace:!0===w.isXRRenderTarget?w.texture.colorSpace:Bf,l=(i.isMeshStandardMaterial?tt:Q).get(i.envMap||a),c=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,h=!!n.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),u=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=ap;i.toneMapped&&(null!==w&&!0!==w.isXRRenderTarget||(f=y.toneMapping));const g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==g?g.length:0,x=K.get(i),b=m.state.lights;if(!0===B&&(!0===F||t!==M)){const e=t===M&&i.id===S;lt.setState(i,t,e)}let _=!1;i.version===x.__version?x.needsLights&&x.lightsStateVersion!==b.state.version||x.outputColorSpace!==o||r.isBatchedMesh&&!1===x.batching?_=!0:r.isBatchedMesh||!0!==x.batching?r.isBatchedMesh&&!0===x.batchingColor&&null===r.colorTexture||r.isBatchedMesh&&!1===x.batchingColor&&null!==r.colorTexture||r.isInstancedMesh&&!1===x.instancing?_=!0:r.isInstancedMesh||!0!==x.instancing?r.isSkinnedMesh&&!1===x.skinning?_=!0:r.isSkinnedMesh||!0!==x.skinning?r.isInstancedMesh&&!0===x.instancingColor&&null===r.instanceColor||r.isInstancedMesh&&!1===x.instancingColor&&null!==r.instanceColor||r.isInstancedMesh&&!0===x.instancingMorph&&null===r.morphTexture||r.isInstancedMesh&&!1===x.instancingMorph&&null!==r.morphTexture||x.envMap!==l||!0===i.fog&&x.fog!==s?_=!0:void 0===x.numClippingPlanes||x.numClippingPlanes===lt.numPlanes&&x.numIntersection===lt.numIntersection?(x.vertexAlphas!==c||x.vertexTangents!==h||x.morphTargets!==u||x.morphNormals!==d||x.morphColors!==p||x.toneMapping!==f||x.morphTargetsCount!==v)&&(_=!0):_=!0:_=!0:_=!0:_=!0:(_=!0,x.__version=i.version);let T=x.currentProgram;!0===_&&(T=zt(i,e,r));let E=!1,A=!1,C=!1;const P=T.getUniforms(),R=x.uniforms;Y.useProgram(T.program)&&(E=!0,A=!0,C=!0);i.id!==S&&(S=i.id,A=!0);if(E||M!==t){P.setValue(vt,"projectionMatrix",t.projectionMatrix),P.setValue(vt,"viewMatrix",t.matrixWorldInverse);const e=P.map.cameraPosition;void 0!==e&&e.setValue(vt,j.setFromMatrixPosition(t.matrixWorld)),$.logarithmicDepthBuffer&&P.setValue(vt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&P.setValue(vt,"isOrthographic",!0===t.isOrthographicCamera),M!==t&&(M=t,A=!0,C=!0)}if(r.isSkinnedMesh){P.setOptional(vt,r,"bindMatrix"),P.setOptional(vt,r,"bindMatrixInverse");const t=r.skeleton;t&&(null===t.boneTexture&&t.computeBoneTexture(),P.setValue(vt,"boneTexture",t.boneTexture,J))}r.isBatchedMesh&&(P.setOptional(vt,r,"batchingTexture"),P.setValue(vt,"batchingTexture",r._matricesTexture,J),P.setOptional(vt,r,"batchingIdTexture"),P.setValue(vt,"batchingIdTexture",r._indirectTexture,J),P.setOptional(vt,r,"batchingColorTexture"),null!==r._colorsTexture&&P.setValue(vt,"batchingColorTexture",r._colorsTexture,J));const L=n.morphAttributes;void 0===L.position&&void 0===L.normal&&void 0===L.color||ut.update(r,n,T);(A||x.receiveShadow!==r.receiveShadow)&&(x.receiveShadow=r.receiveShadow,P.setValue(vt,"receiveShadow",r.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(R.envMap.value=l,R.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);i.isMeshStandardMaterial&&null===i.envMap&&null!==e.environment&&(R.envMapIntensity.value=e.environmentIntensity);A&&(P.setValue(vt,"toneMappingExposure",y.toneMappingExposure),x.needsLights&&(z=C,(I=R).ambientLightColor.needsUpdate=z,I.lightProbe.needsUpdate=z,I.directionalLights.needsUpdate=z,I.directionalLightShadows.needsUpdate=z,I.pointLights.needsUpdate=z,I.pointLightShadows.needsUpdate=z,I.spotLights.needsUpdate=z,I.spotLightShadows.needsUpdate=z,I.rectAreaLights.needsUpdate=z,I.hemisphereLights.needsUpdate=z),s&&!0===i.fog&&st.refreshFogUniforms(R,s),st.refreshMaterialUniforms(R,i,D,O,m.state.transmissionRenderTarget[t.id]),mb.upload(vt,Nt(x),R,J));var I,z;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(mb.upload(vt,Nt(x),R,J),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&P.setValue(vt,"center",r.center);if(P.setValue(vt,"modelViewMatrix",r.modelViewMatrix),P.setValue(vt,"normalMatrix",r.normalMatrix),P.setValue(vt,"modelMatrix",r.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const t=i.uniformsGroups;for(let e=0,n=t.length;e<n;e++){const n=t[e];gt.update(n,T),gt.bind(n,T)}}return T}(t,e,n,i,r);Y.setMaterial(i,a);let l=n.index,c=1;if(!0===i.wireframe){if(l=nt.getWireframeAttribute(n),void 0===l)return;c=2}const h=n.drawRange,u=n.attributes.position;let d=h.start*c,p=(h.start+h.count)*c;null!==s&&(d=Math.max(d,s.start*c),p=Math.min(p,(s.start+s.count)*c)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=u&&(d=Math.max(d,0),p=Math.min(p,u.count));const f=p-d;if(f<0||f===1/0)return;let g;mt.setup(r,i,o,n,l);let v=dt;if(null!==l&&(g=et.get(l),v=pt,v.setIndex(g)),r.isMesh)!0===i.wireframe?(Y.setLineWidth(i.wireframeLinewidth*q()),v.setMode(vt.LINES)):v.setMode(vt.TRIANGLES);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),Y.setLineWidth(t*q()),r.isLineSegments?v.setMode(vt.LINES):r.isLineLoop?v.setMode(vt.LINE_LOOP):v.setMode(vt.LINE_STRIP)}else r.isPoints?v.setMode(vt.POINTS):r.isSprite&&v.setMode(vt.TRIANGLES);if(r.isBatchedMesh)if(null!==r._multiDrawInstances)v.renderMultiDrawInstances(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount,r._multiDrawInstances);else if(X.get("WEBGL_multi_draw"))v.renderMultiDraw(r._multiDrawStarts,r._multiDrawCounts,r._multiDrawCount);else{const t=r._multiDrawStarts,e=r._multiDrawCounts,n=r._multiDrawCount,s=l?et.get(l).bytesPerElement:1,a=K.get(i).currentProgram.getUniforms();for(let i=0;i<n;i++)a.setValue(vt,"_gl_DrawID",i),v.render(t[i]/s,e[i])}else if(r.isInstancedMesh)v.renderInstances(d,f,r.count);else if(n.isInstancedBufferGeometry){const t=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,e=Math.min(n.instanceCount,t);v.renderInstances(d,f,e)}else v.render(d,f)},this.compile=function(t,e,n=null){null===n&&(n=t),m=ot.get(n),m.init(e),v.push(m),n.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(m.pushLight(t),t.castShadow&&m.pushShadow(t))})),t!==n&&t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(m.pushLight(t),t.castShadow&&m.pushShadow(t))})),m.setupLights();const i=new Set;return t.traverse((function(t){const e=t.material;if(e)if(Array.isArray(e))for(let r=0;r<e.length;r++){const s=e[r];Tt(s,n,t),i.add(s)}else Tt(e,n,t),i.add(e)})),v.pop(),m=null,i},this.compileAsync=function(t,e,n=null){const i=this.compile(t,e,n);return new Promise((e=>{function n(){i.forEach((function(t){K.get(t).currentProgram.isReady()&&i.delete(t)})),0!==i.size?setTimeout(n,10):e(t)}null!==X.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)}))};let Et=null;function At(){Pt.stop()}function Ct(){Pt.start()}const Pt=new My;function Rt(t,e,n,i){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)m.pushLight(t),t.castShadow&&m.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||k.intersectsSprite(t)){i&&H.setFromMatrixPosition(t.matrixWorld).applyMatrix4(V);const e=it.update(t),r=t.material;r.visible&&f.push(t,e,r,n,H.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||k.intersectsObject(t))){const e=it.update(t),r=t.material;if(i&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),H.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),H.copy(e.boundingSphere.center)),H.applyMatrix4(t.matrixWorld).applyMatrix4(V)),Array.isArray(r)){const i=e.groups;for(let s=0,a=i.length;s<a;s++){const a=i[s],o=r[a.materialIndex];o&&o.visible&&f.push(t,e,o,n,H.z,a)}}else r.visible&&f.push(t,e,r,n,H.z,null)}const r=t.children;for(let t=0,s=r.length;t<s;t++)Rt(r[t],e,n,i)}function Ot(t,e,n,i){const r=t.opaque,s=t.transmissive,a=t.transparent;m.setupLightsView(n),!0===B&&lt.setGlobalState(y.clippingPlanes,n),i&&Y.viewport(T.copy(i)),r.length>0&&Lt(r,e,n),s.length>0&&Lt(s,e,n),a.length>0&&Lt(a,e,n),Y.buffers.depth.setTest(!0),Y.buffers.depth.setMask(!0),Y.buffers.color.setMask(!0),Y.setPolygonOffset(!1)}function Dt(t,e,n,i){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===m.state.transmissionRenderTarget[i.id]&&(m.state.transmissionRenderTarget[i.id]=new Gm(1,1,{generateMipmaps:!0,type:X.has("EXT_color_buffer_half_float")||X.has("EXT_color_buffer_float")?zp:Cp,minFilter:Ap,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Dm.workingColorSpace}));const s=m.state.transmissionRenderTarget[i.id],a=i.viewport||T;s.setSize(a.z,a.w);const o=y.getRenderTarget();y.setRenderTarget(s),y.getClearColor(C),P=y.getClearAlpha(),P<1&&y.setClearColor(16777215,.5),W?ht.render(n):y.clear();const l=y.toneMapping;y.toneMapping=ap;const c=i.viewport;if(void 0!==i.viewport&&(i.viewport=void 0),m.setupLightsView(i),!0===B&&lt.setGlobalState(y.clippingPlanes,i),Lt(t,n,i),J.updateMultisampleRenderTarget(s),J.updateRenderTargetMipmap(s),!1===X.has("WEBGL_multisampled_render_to_texture")){let t=!1;for(let r=0,s=e.length;r<s;r++){const s=e[r],a=s.object,o=s.geometry,l=s.material,c=s.group;if(l.side===Ud&&a.layers.test(i.layers)){const e=l.side;l.side=Nd,l.needsUpdate=!0,It(a,n,i,o,l,c),l.side=e,l.needsUpdate=!0,t=!0}}!0===t&&(J.updateMultisampleRenderTarget(s),J.updateRenderTargetMipmap(s))}y.setRenderTarget(o),y.setClearColor(C,P),void 0!==c&&(i.viewport=c),y.toneMapping=l}function Lt(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=s.object,o=s.geometry,l=null===i?s.material:i,c=s.group;a.layers.test(n.layers)&&It(a,e,n,o,l,c)}}function It(t,e,n,i,r,s){t.onBeforeRender(y,e,n,i,r,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),!0===r.transparent&&r.side===Ud&&!1===r.forceSinglePass?(r.side=Nd,r.needsUpdate=!0,y.renderBufferDirect(n,e,i,r,t,s),r.side=zd,r.needsUpdate=!0,y.renderBufferDirect(n,e,i,r,t,s),r.side=Ud):y.renderBufferDirect(n,e,i,r,t,s),t.onAfterRender(y,e,n,i,r,s)}function zt(t,e,n){!0!==e.isScene&&(e=G);const i=K.get(t),r=m.state.lights,s=m.state.shadowsArray,a=r.state.version,o=rt.getParameters(t,r.state,s,e,n),l=rt.getProgramCacheKey(o);let c=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=(t.isMeshStandardMaterial?tt:Q).get(t.envMap||i.environment),i.envMapRotation=null!==i.environment&&null===t.envMap?e.environmentRotation:t.envMapRotation,void 0===c&&(t.addEventListener("dispose",Mt),c=new Map,i.programs=c);let h=c.get(l);if(void 0!==h){if(i.currentProgram===h&&i.lightsStateVersion===a)return Ut(t,o),h}else o.uniforms=rt.getUniforms(t),t.onBeforeCompile(o,y),h=rt.acquireProgram(o,l),c.set(l,h),i.uniforms=o.uniforms;const u=i.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=lt.uniform),Ut(t,o),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=a,i.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotLightMatrix.value=r.state.spotLightMatrix,u.spotLightMap.value=r.state.spotLightMap,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix),i.currentProgram=h,i.uniformsList=null,h}function Nt(t){if(null===t.uniformsList){const e=t.currentProgram.getUniforms();t.uniformsList=mb.seqWithValue(e.seq,t.uniforms)}return t.uniformsList}function Ut(t,e){const n=K.get(t);n.outputColorSpace=e.outputColorSpace,n.batching=e.batching,n.batchingColor=e.batchingColor,n.instancing=e.instancing,n.instancingColor=e.instancingColor,n.instancingMorph=e.instancingMorph,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}Pt.setAnimationLoop((function(t){Et&&Et(t)})),"undefined"!=typeof self&&Pt.setContext(self),this.setAnimationLoop=function(t){Et=t,bt.setAnimationLoop(t),null===t?Pt.stop():Pt.start()},bt.addEventListener("sessionstart",At),bt.addEventListener("sessionend",Ct),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===x)return;if(!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===bt.enabled&&!0===bt.isPresenting&&(!0===bt.cameraAutoUpdate&&bt.updateCamera(e),e=bt.getCamera()),!0===t.isScene&&t.onBeforeRender(y,t,e,w),m=ot.get(t,v.length),m.init(e),v.push(m),V.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),k.setFromProjectionMatrix(V),F=this.localClippingEnabled,B=lt.init(this.clippingPlanes,F),f=at.get(t,g.length),f.init(),g.push(f),!0===bt.enabled&&!0===bt.isPresenting){const t=y.xr.getDepthSensingMesh();null!==t&&Rt(t,e,-1/0,y.sortObjects)}Rt(t,e,0,y.sortObjects),f.finish(),!0===y.sortObjects&&f.sort(L,I),W=!1===bt.enabled||!1===bt.isPresenting||!1===bt.hasDepthSensing(),W&&ht.addToRenderList(f,t),this.info.render.frame++,!0===B&&lt.beginShadows();const n=m.state.shadowsArray;ct.render(n,t,e),!0===B&&lt.endShadows(),!0===this.info.autoReset&&this.info.reset();const i=f.opaque,r=f.transmissive;if(m.setupLights(),e.isArrayCamera){const n=e.cameras;if(r.length>0)for(let e=0,s=n.length;e<s;e++){Dt(i,r,t,n[e])}W&&ht.render(t);for(let e=0,i=n.length;e<i;e++){const i=n[e];Ot(f,t,i,i.viewport)}}else r.length>0&&Dt(i,r,t,e),W&&ht.render(t),Ot(f,t,e);null!==w&&(J.updateMultisampleRenderTarget(w),J.updateRenderTargetMipmap(w)),!0===t.isScene&&t.onAfterRender(y,t,e),mt.resetDefaultState(),S=-1,M=null,v.pop(),v.length>0?(m=v[v.length-1],!0===B&&lt.setGlobalState(y.clippingPlanes,m.state.camera)):m=null,g.pop(),f=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(t,e,n){K.get(t.texture).__webglTexture=e,K.get(t.depthTexture).__webglTexture=n;const i=K.get(t);i.__hasExternalTextures=!0,i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===X.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(t,e){const n=K.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,n=0){w=t,b=e,_=n;let i=!0,r=null,s=!1,a=!1;if(t){const o=K.get(t);void 0!==o.__useDefaultFramebuffer?(Y.bindFramebuffer(vt.FRAMEBUFFER,null),i=!1):void 0===o.__webglFramebuffer?J.setupRenderTarget(t):o.__hasExternalTextures&&J.rebindTextures(t,K.get(t.texture).__webglTexture,K.get(t.depthTexture).__webglTexture);const l=t.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(a=!0);const c=K.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=Array.isArray(c[e])?c[e][n]:c[e],s=!0):r=t.samples>0&&!1===J.useMultisampledRTT(t)?K.get(t).__webglMultisampledFramebuffer:Array.isArray(c)?c[n]:c,T.copy(t.viewport),E.copy(t.scissor),A=t.scissorTest}else T.copy(z).multiplyScalar(D).floor(),E.copy(N).multiplyScalar(D).floor(),A=U;if(Y.bindFramebuffer(vt.FRAMEBUFFER,r)&&i&&Y.drawBuffers(t,r),Y.viewport(T),Y.scissor(E),Y.setScissorTest(A),s){const i=K.get(t.texture);vt.framebufferTexture2D(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0,vt.TEXTURE_CUBE_MAP_POSITIVE_X+e,i.__webglTexture,n)}else if(a){const i=K.get(t.texture),r=e||0;vt.framebufferTextureLayer(vt.FRAMEBUFFER,vt.COLOR_ATTACHMENT0,i.__webglTexture,n||0,r)}S=-1},this.readRenderTargetPixels=function(t,e,n,i,r,s,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=K.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){Y.bindFramebuffer(vt.FRAMEBUFFER,o);try{const a=t.texture,o=a.format,l=a.type;if(!$.textureFormatReadable(o))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!$.textureTypeReadable(l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&vt.readPixels(e,n,i,r,ft.convert(o),ft.convert(l),s)}finally{const t=null!==w?K.get(w).__webglFramebuffer:null;Y.bindFramebuffer(vt.FRAMEBUFFER,t)}}},this.readRenderTargetPixelsAsync=async function(t,e,n,i,r,s,a){if(!t||!t.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=K.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){Y.bindFramebuffer(vt.FRAMEBUFFER,o);try{const a=t.texture,o=a.format,l=a.type;if(!$.textureFormatReadable(o))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!$.textureTypeReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r){const t=vt.createBuffer();vt.bindBuffer(vt.PIXEL_PACK_BUFFER,t),vt.bufferData(vt.PIXEL_PACK_BUFFER,s.byteLength,vt.STREAM_READ),vt.readPixels(e,n,i,r,ft.convert(o),ft.convert(l),0),vt.flush();const a=vt.fenceSync(vt.SYNC_GPU_COMMANDS_COMPLETE,0);await function(t,e,n){return new Promise((function(i,r){setTimeout((function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:r();break;case t.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:i()}}),n)}))}(vt,a,4);try{vt.bindBuffer(vt.PIXEL_PACK_BUFFER,t),vt.getBufferSubData(vt.PIXEL_PACK_BUFFER,0,s)}finally{vt.deleteBuffer(t),vt.deleteSync(a)}return s}}finally{const t=null!==w?K.get(w).__webglFramebuffer:null;Y.bindFramebuffer(vt.FRAMEBUFFER,t)}}},this.copyFramebufferToTexture=function(t,e=null,n=0){!0!==t.isTexture&&(console.warn("WebGLRenderer: copyFramebufferToTexture function signature has changed."),e=arguments[0]||null,t=arguments[1]);const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),s=Math.floor(t.image.height*i),a=null!==e?e.x:0,o=null!==e?e.y:0;J.setTexture2D(t,0),vt.copyTexSubImage2D(vt.TEXTURE_2D,n,0,0,a,o,r,s),Y.unbindTexture()},this.copyTextureToTexture=function(t,e,n=null,i=null,r=0){let s,a,o,l,c,h;!0!==t.isTexture&&(console.warn("WebGLRenderer: copyTextureToTexture function signature has changed."),i=arguments[0]||null,t=arguments[1],e=arguments[2],r=arguments[3]||0,n=null),null!==n?(s=n.max.x-n.min.x,a=n.max.y-n.min.y,o=n.min.x,l=n.min.y):(s=t.image.width,a=t.image.height,o=0,l=0),null!==i?(c=i.x,h=i.y):(c=0,h=0);const u=ft.convert(e.format),d=ft.convert(e.type);J.setTexture2D(e,0),vt.pixelStorei(vt.UNPACK_FLIP_Y_WEBGL,e.flipY),vt.pixelStorei(vt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),vt.pixelStorei(vt.UNPACK_ALIGNMENT,e.unpackAlignment);const p=vt.getParameter(vt.UNPACK_ROW_LENGTH),f=vt.getParameter(vt.UNPACK_IMAGE_HEIGHT),m=vt.getParameter(vt.UNPACK_SKIP_PIXELS),g=vt.getParameter(vt.UNPACK_SKIP_ROWS),v=vt.getParameter(vt.UNPACK_SKIP_IMAGES),y=t.isCompressedTexture?t.mipmaps[r]:t.image;vt.pixelStorei(vt.UNPACK_ROW_LENGTH,y.width),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,y.height),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,o),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,l),t.isDataTexture?vt.texSubImage2D(vt.TEXTURE_2D,r,c,h,s,a,u,d,y.data):t.isCompressedTexture?vt.compressedTexSubImage2D(vt.TEXTURE_2D,r,c,h,y.width,y.height,u,y.data):vt.texSubImage2D(vt.TEXTURE_2D,r,c,h,s,a,u,d,y),vt.pixelStorei(vt.UNPACK_ROW_LENGTH,p),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,f),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,m),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,g),vt.pixelStorei(vt.UNPACK_SKIP_IMAGES,v),0===r&&e.generateMipmaps&&vt.generateMipmap(vt.TEXTURE_2D),Y.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n=null,i=null,r=0){let s,a,o,l,c,h,u,d,p;!0!==t.isTexture&&(console.warn("WebGLRenderer: copyTextureToTexture3D function signature has changed."),n=arguments[0]||null,i=arguments[1]||null,t=arguments[2],e=arguments[3],r=arguments[4]||0);const f=t.isCompressedTexture?t.mipmaps[r]:t.image;null!==n?(s=n.max.x-n.min.x,a=n.max.y-n.min.y,o=n.max.z-n.min.z,l=n.min.x,c=n.min.y,h=n.min.z):(s=f.width,a=f.height,o=f.depth,l=0,c=0,h=0),null!==i?(u=i.x,d=i.y,p=i.z):(u=0,d=0,p=0);const m=ft.convert(e.format),g=ft.convert(e.type);let v;if(e.isData3DTexture)J.setTexture3D(e,0),v=vt.TEXTURE_3D;else{if(!e.isDataArrayTexture&&!e.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(e,0),v=vt.TEXTURE_2D_ARRAY}vt.pixelStorei(vt.UNPACK_FLIP_Y_WEBGL,e.flipY),vt.pixelStorei(vt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),vt.pixelStorei(vt.UNPACK_ALIGNMENT,e.unpackAlignment);const y=vt.getParameter(vt.UNPACK_ROW_LENGTH),x=vt.getParameter(vt.UNPACK_IMAGE_HEIGHT),b=vt.getParameter(vt.UNPACK_SKIP_PIXELS),_=vt.getParameter(vt.UNPACK_SKIP_ROWS),w=vt.getParameter(vt.UNPACK_SKIP_IMAGES);vt.pixelStorei(vt.UNPACK_ROW_LENGTH,f.width),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,f.height),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,l),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,c),vt.pixelStorei(vt.UNPACK_SKIP_IMAGES,h),t.isDataTexture||t.isData3DTexture?vt.texSubImage3D(v,r,u,d,p,s,a,o,m,g,f.data):e.isCompressedArrayTexture?vt.compressedTexSubImage3D(v,r,u,d,p,s,a,o,m,f.data):vt.texSubImage3D(v,r,u,d,p,s,a,o,m,g,f),vt.pixelStorei(vt.UNPACK_ROW_LENGTH,y),vt.pixelStorei(vt.UNPACK_IMAGE_HEIGHT,x),vt.pixelStorei(vt.UNPACK_SKIP_PIXELS,b),vt.pixelStorei(vt.UNPACK_SKIP_ROWS,_),vt.pixelStorei(vt.UNPACK_SKIP_IMAGES,w),0===r&&e.generateMipmaps&&vt.generateMipmap(v),Y.unbindTexture()},this.initRenderTarget=function(t){void 0===K.get(t).__webglFramebuffer&&J.setupRenderTarget(t)},this.initTexture=function(t){t.isCubeTexture?J.setTextureCube(t,0):t.isData3DTexture?J.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?J.setTexture2DArray(t,0):J.setTexture2D(t,0),Y.unbindTexture()},this.resetState=function(){b=0,_=0,w=null,Y.reset(),mt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return rm}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorSpace=t===Ff?"display-p3":"srgb",e.unpackColorSpace=Dm.workingColorSpace===Vf?"display-p3":"srgb"}}class p_{constructor(t,e=1,n=1e3){this.isFog=!0,this.name="",this.color=new pv(t),this.near=e,this.far=n}clone(){return new p_(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class f_ extends Kg{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Ig,this.environmentIntensity=1,this.environmentRotation=new Ig,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class m_{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=em,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=um()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return Am("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=um()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=um()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const g_=new $m;class v_{constructor(t,e,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)g_.fromBufferAttribute(this,e),g_.applyMatrix4(t),this.setXYZ(e,g_.x,g_.y,g_.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)g_.fromBufferAttribute(this,e),g_.applyNormalMatrix(t),this.setXYZ(e,g_.x,g_.y,g_.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)g_.fromBufferAttribute(this,e),g_.transformDirection(t),this.setXYZ(e,g_.x,g_.y,g_.z);return this}getComponent(t,e){let n=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(n=mm(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=gm(n,this.array)),this.data.array[t*this.data.stride+this.offset+e]=n,this}setX(t,e){return this.normalized&&(e=gm(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=gm(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=gm(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=gm(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=mm(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=mm(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=mm(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=mm(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=gm(e,this.array),n=gm(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=gm(e,this.array),n=gm(n,this.array),i=gm(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=gm(e,this.array),n=gm(n,this.array),i=gm(i,this.array),r=gm(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new Tv(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new v_(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class y_ extends Kg{constructor(){super(),this.isBone=!0,this.type="Bone"}}class x_ extends Vm{constructor(t=null,e=1,n=1,i,r,s,a,o,l=wp,c=wp,h,u){super(null,s,a,o,l,c,i,r,h,u),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const b_=new Mg,__=new Mg;class w_{constructor(t=[],e=[]){this.uuid=um(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Mg)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Mg;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,r=t.length;i<r;i++){const r=t[i]?t[i].matrixWorld:__;b_.multiplyMatrices(r,e[i]),b_.toArray(n,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new w_(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new x_(e,t,t,jp,Ip);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,i=t.bones.length;n<i;n++){const i=t.bones[n];let r=e[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new y_),this.bones.push(r),this.boneInverses.push((new Mg).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let i=0,r=e.length;i<r;i++){const r=e[i];t.bones.push(r.uuid);const s=n[i];t.boneInverses.push(s.toArray())}return t}}class S_ extends Tv{constructor(t,e,n,i=1){super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const M_=new Mg,T_=new Mg,E_=[],A_=new Km,C_=new Mg,P_=new ty,R_=new mg;class O_ extends ty{constructor(t,e,n){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new S_(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let t=0;t<n;t++)this.setMatrixAt(t,C_)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new Km),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,M_),A_.copy(t.boundingBox).applyMatrix4(M_),this.boundingBox.union(A_)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new mg),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,M_),R_.copy(t.boundingSphere).applyMatrix4(M_),this.boundingSphere.union(R_)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){const n=e.morphTargetInfluences,i=this.morphTexture.source.data.data,r=t*(n.length+1)+1;for(let t=0;t<n.length;t++)n[t]=i[r+t]}raycast(t,e){const n=this.matrixWorld,i=this.count;if(P_.geometry=this.geometry,P_.material=this.material,void 0!==P_.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),R_.copy(this.boundingSphere),R_.applyMatrix4(n),!1!==t.ray.intersectsSphere(R_)))for(let r=0;r<i;r++){this.getMatrixAt(r,M_),T_.multiplyMatrices(n,M_),P_.matrixWorld=T_,P_.raycast(t,E_);for(let t=0,n=E_.length;t<n;t++){const n=E_[t];n.instanceId=r,n.object=this,e.push(n)}E_.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new S_(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){const n=e.morphTargetInfluences,i=n.length+1;null===this.morphTexture&&(this.morphTexture=new x_(new Float32Array(i*this.count),i,this.count,Xp,Ip));const r=this.morphTexture.source.data.data;let s=0;for(let t=0;t<n.length;t++)s+=n[t];const a=this.geometry.morphTargetsRelative?1:1-s,o=i*t;r[o]=a,r.set(n,o+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class D_ extends gv{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new pv(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const L_=new $m,I_=new $m,z_=new Mg,N_=new Sg,U_=new mg,k_=new $m,B_=new $m;class F_ extends Kg{constructor(t=new Nv,e=new D_){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)L_.fromBufferAttribute(e,t-1),I_.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=L_.distanceTo(I_);t.setAttribute("lineDistance",new Cv(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),U_.copy(n.boundingSphere),U_.applyMatrix4(i),U_.radius+=r,!1===t.ray.intersectsSphere(U_))return;z_.copy(i).invert(),N_.copy(t.ray).applyMatrix4(z_);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=this.isLineSegments?2:1,c=n.index,h=n.attributes.position;if(null!==c){const n=Math.max(0,s.start),i=Math.min(c.count,s.start+s.count);for(let r=n,s=i-1;r<s;r+=l){const n=c.getX(r),i=c.getX(r+1),s=V_(this,t,N_,o,n,i);s&&e.push(s)}if(this.isLineLoop){const r=c.getX(i-1),s=c.getX(n),a=V_(this,t,N_,o,r,s);a&&e.push(a)}}else{const n=Math.max(0,s.start),i=Math.min(h.count,s.start+s.count);for(let r=n,s=i-1;r<s;r+=l){const n=V_(this,t,N_,o,r,r+1);n&&e.push(n)}if(this.isLineLoop){const r=V_(this,t,N_,o,i-1,n);r&&e.push(r)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const n=t[e[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=n.length;t<e;t++){const e=n[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function V_(t,e,n,i,r,s){const a=t.geometry.attributes.position;L_.fromBufferAttribute(a,r),I_.fromBufferAttribute(a,s);if(n.distanceSqToSegment(L_,I_,k_,B_)>i)return;k_.applyMatrix4(t.matrixWorld);const o=e.ray.origin.distanceTo(k_);return o<e.near||o>e.far?void 0:{distance:o,point:B_.clone().applyMatrix4(t.matrixWorld),index:r,face:null,faceIndex:null,object:t}}const j_=new $m,H_=new $m;class G_ extends F_{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)j_.fromBufferAttribute(e,t),H_.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+j_.distanceTo(H_);t.setAttribute("lineDistance",new Cv(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class W_ extends Vm{constructor(t,e,n,i,r,s,a,o,l){super(t,e,n,i,r,s,a,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:Tp,this.magFilter=void 0!==r?r:Tp,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class q_ extends Vm{constructor(t,e,n,i,r,s,a,o,l){super(t,e,n,i,r,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class X_{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),r+=n.distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let i=0;const r=n.length;let s;s=e||t*n[r-1];let a,o=0,l=r-1;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),a=n[i]-s,a<0)o=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(i=l,n[i]===s)return i/(r-1);const c=n[i];return(i+(s-c)/(n[i+1]-c))/(r-1)}getTangent(t,e){const n=1e-4;let i=t-n,r=t+n;i<0&&(i=0),r>1&&(r=1);const s=this.getPoint(i),a=this.getPoint(r),o=e||(s.isVector2?new ym:new $m);return o.copy(a).sub(s).normalize(),o}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new $m,i=[],r=[],s=[],a=new $m,o=new Mg;for(let e=0;e<=t;e++){const n=e/t;i[e]=this.getTangentAt(n,new $m)}r[0]=new $m,s[0]=new $m;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),h=Math.abs(i[0].y),u=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),u<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),s[0].crossVectors(i[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),a.crossVectors(i[e-1],i[e]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(dm(i[e-1].dot(i[e]),-1,1));r[e].applyMatrix4(o.makeRotationAxis(a,t))}s[e].crossVectors(i[e],r[e])}if(!0===e){let e=Math.acos(dm(r[0].dot(r[t]),-1,1));e/=t,i[0].dot(a.crossVectors(r[0],r[t]))>0&&(e=-e);for(let n=1;n<=t;n++)r[n].applyMatrix4(o.makeRotationAxis(i[n],e*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class $_ extends X_{constructor(t=0,e=0,n=1,i=1,r=0,s=2*Math.PI,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(t,e=new ym){const n=e,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const a=this.aStartAngle+t*r;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=o-this.aX,i=l-this.aY;o=n*t-i*e+this.aX,l=n*e+i*t+this.aY}return n.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}function Y_(){let t=0,e=0,n=0,i=0;function r(r,s,a,o){t=r,e=a,n=-3*r+3*s-2*a-o,i=2*r-2*s+a+o}return{initCatmullRom:function(t,e,n,i,s){r(e,n,s*(n-t),s*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,s,a,o){let l=(e-t)/s-(n-t)/(s+a)+(n-e)/a,c=(n-e)/a-(i-e)/(a+o)+(i-n)/o;l*=a,c*=a,r(e,n,l,c)},calc:function(r){const s=r*r;return t+e*r+n*s+i*(s*r)}}}const Z_=new $m,K_=new Y_,J_=new Y_,Q_=new Y_;function tw(t,e,n,i,r){const s=.5*(i-e),a=.5*(r-n),o=t*t;return(2*n-2*i+s+a)*(t*o)+(-3*n+3*i-2*s-a)*o+s*t+n}function ew(t,e,n,i){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,i)}function nw(t,e,n,i,r){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,r)}class iw extends X_{constructor(t=new ym,e=new ym,n=new ym,i=new ym){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new ym){const n=e,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(nw(t,i.x,r.x,s.x,a.x),nw(t,i.y,r.y,s.y,a.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class rw extends X_{constructor(t=new $m,e=new $m,n=new $m,i=new $m){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new $m){const n=e,i=this.v0,r=this.v1,s=this.v2,a=this.v3;return n.set(nw(t,i.x,r.x,s.x,a.x),nw(t,i.y,r.y,s.y,a.y),nw(t,i.z,r.z,s.z,a.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class sw extends X_{constructor(t=new ym,e=new ym){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new ym){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new ym){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class aw extends X_{constructor(t=new $m,e=new $m){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new $m){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new $m){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class ow extends X_{constructor(t=new ym,e=new ym,n=new ym){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new ym){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(ew(t,i.x,r.x,s.x),ew(t,i.y,r.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class lw extends X_{constructor(t=new $m,e=new $m,n=new $m){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new $m){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(ew(t,i.x,r.x,s.x),ew(t,i.y,r.y,s.y),ew(t,i.z,r.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class cw extends X_{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new ym){const n=e,i=this.points,r=(i.length-1)*t,s=Math.floor(r),a=r-s,o=i[0===s?s:s-1],l=i[s],c=i[s>i.length-2?i.length-1:s+1],h=i[s>i.length-3?i.length-1:s+2];return n.set(tw(a,o.x,l.x,c.x,h.x),tw(a,o.y,l.y,c.y,h.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new ym).fromArray(n))}return this}}var hw=Object.freeze({__proto__:null,ArcCurve:class extends $_{constructor(t,e,n,i,r,s){super(t,e,n,n,i,r,s),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends X_{constructor(t=[],e=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t,e=new $m){const n=e,i=this.points,r=i.length,s=(r-(this.closed?0:1))*t;let a,o,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?a=i[(l-1)%r]:(Z_.subVectors(i[0],i[1]).add(i[0]),a=Z_);const h=i[l%r],u=i[(l+1)%r];if(this.closed||l+2<r?o=i[(l+2)%r]:(Z_.subVectors(i[r-1],i[r-2]).add(i[r-1]),o=Z_),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(h),t),n=Math.pow(h.distanceToSquared(u),t),i=Math.pow(u.distanceToSquared(o),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),K_.initNonuniformCatmullRom(a.x,h.x,u.x,o.x,e,n,i),J_.initNonuniformCatmullRom(a.y,h.y,u.y,o.y,e,n,i),Q_.initNonuniformCatmullRom(a.z,h.z,u.z,o.z,e,n,i)}else"catmullrom"===this.curveType&&(K_.initCatmullRom(a.x,h.x,u.x,o.x,this.tension),J_.initCatmullRom(a.y,h.y,u.y,o.y,this.tension),Q_.initCatmullRom(a.z,h.z,u.z,o.z,this.tension));return n.set(K_.calc(c),J_.calc(c),Q_.calc(c)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new $m).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}},CubicBezierCurve:iw,CubicBezierCurve3:rw,EllipseCurve:$_,LineCurve:sw,LineCurve3:aw,QuadraticBezierCurve:ow,QuadraticBezierCurve3:lw,SplineCurve:cw});class uw extends X_{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const n=!0===t.isVector2?"LineCurve":"LineCurve3";this.curves.push(new hw[n](e,t))}return this}getPoint(t,e){const n=t*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const t=i[r]-n,s=this.curves[r],a=s.getLength(),o=0===a?0:1-t/a;return s.getPointAt(o,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],a=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let t=0;t<o.length;t++){const i=o[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new hw[n.type]).fromJSON(n))}return this}}class dw extends uw{constructor(t){super(),this.type="Path",this.currentPoint=new ym,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new sw(this.currentPoint.clone(),new ym(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){const r=new ow(this.currentPoint.clone(),new ym(t,e),new ym(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,r,s){const a=new iw(this.currentPoint.clone(),new ym(t,e),new ym(n,i),new ym(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new cw(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,n,i,r,s),this}absarc(t,e,n,i,r,s){return this.absellipse(t,e,n,n,i,r,s),this}ellipse(t,e,n,i,r,s,a,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,n,i,r,s,a,o),this}absellipse(t,e,n,i,r,s,a,o){const l=new $_(t,e,n,i,r,s,a,o);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class pw extends Nv{constructor(t=[new ym(0,-.5),new ym(.5,0),new ym(0,.5)],e=12,n=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},e=Math.floor(e),i=dm(i,0,2*Math.PI);const r=[],s=[],a=[],o=[],l=[],c=1/e,h=new $m,u=new ym,d=new $m,p=new $m,f=new $m;let m=0,g=0;for(let e=0;e<=t.length-1;e++)switch(e){case 0:m=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case t.length-1:o.push(f.x,f.y,f.z);break;default:m=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let r=0;r<=e;r++){const d=n+r*c*i,p=Math.sin(d),f=Math.cos(d);for(let n=0;n<=t.length-1;n++){h.x=t[n].x*p,h.y=t[n].y,h.z=t[n].x*f,s.push(h.x,h.y,h.z),u.x=r/e,u.y=n/(t.length-1),a.push(u.x,u.y);const i=o[3*n+0]*p,c=o[3*n+1],d=o[3*n+0]*f;l.push(i,c,d)}}for(let n=0;n<e;n++)for(let e=0;e<t.length-1;e++){const i=e+n*t.length,s=i,a=i+t.length,o=i+t.length+1,l=i+1;r.push(s,a,l),r.push(o,l,a)}this.setIndex(r),this.setAttribute("position",new Cv(s,3)),this.setAttribute("uv",new Cv(a,2)),this.setAttribute("normal",new Cv(l,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new pw(t.points,t.segments,t.phiStart,t.phiLength)}}class fw extends Nv{constructor(t=1,e=1,n=1,i=32,r=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};const l=this;i=Math.floor(i),r=Math.floor(r);const c=[],h=[],u=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const r=p,s=new ym,f=new $m;let v=0;const y=!0===n?t:e,x=!0===n?1:-1;for(let t=1;t<=i;t++)h.push(0,m*x,0),u.push(0,x,0),d.push(.5,.5),p++;const b=p;for(let t=0;t<=i;t++){const e=t/i*o+a,n=Math.cos(e),r=Math.sin(e);f.x=y*r,f.y=m*x,f.z=y*n,h.push(f.x,f.y,f.z),u.push(0,x,0),s.x=.5*n+.5,s.y=.5*r*x+.5,d.push(s.x,s.y),p++}for(let t=0;t<i;t++){const e=r+t,i=b+t;!0===n?c.push(i,i+1,e):c.push(i+1,i,e),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const s=new $m,v=new $m;let y=0;const x=(e-t)/n;for(let l=0;l<=r;l++){const c=[],g=l/r,y=g*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,r=e*o+a,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*n+m,v.z=y*f,h.push(v.x,v.y,v.z),s.set(l,x,f).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-g),c.push(p++)}f.push(c)}for(let t=0;t<i;t++)for(let e=0;e<r;e++){const n=f[e][t],i=f[e+1][t],r=f[e+1][t+1],s=f[e][t+1];c.push(n,i,s),c.push(i,r,s),y+=6}l.addGroup(g,y,0),g+=y}(),!1===s&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new Cv(h,3)),this.setAttribute("normal",new Cv(u,3)),this.setAttribute("uv",new Cv(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new fw(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class mw extends fw{constructor(t=1,e=1,n=32,i=1,r=!1,s=0,a=2*Math.PI){super(0,t,e,n,i,r,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(t){return new mw(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class gw extends Nv{constructor(t=[],e=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i};const r=[],s=[];function a(t,e,n,i){const r=i+1,s=[];for(let i=0;i<=r;i++){s[i]=[];const a=t.clone().lerp(n,i/r),o=e.clone().lerp(n,i/r),l=r-i;for(let t=0;t<=l;t++)s[i][t]=0===t&&i===r?a:a.clone().lerp(o,t/l)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const n=Math.floor(e/2);e%2==0?(o(s[t][n+1]),o(s[t+1][n]),o(s[t][n])):(o(s[t][n+1]),o(s[t+1][n+1]),o(s[t+1][n]))}}function o(t){r.push(t.x,t.y,t.z)}function l(e,n){const i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function c(t,e,n,i){i<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=i/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new $m,i=new $m,r=new $m;for(let s=0;s<e.length;s+=3)l(e[s+0],n),l(e[s+1],i),l(e[s+2],r),a(n,i,r,t)}(i),function(t){const e=new $m;for(let n=0;n<r.length;n+=3)e.x=r[n+0],e.y=r[n+1],e.z=r[n+2],e.normalize().multiplyScalar(t),r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z}(n),function(){const t=new $m;for(let n=0;n<r.length;n+=3){t.x=r[n+0],t.y=r[n+1],t.z=r[n+2];const i=h(t)/2/Math.PI+.5,a=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(i,1-a)}var e;(function(){const t=new $m,e=new $m,n=new $m,i=new $m,a=new ym,o=new ym,l=new ym;for(let u=0,d=0;u<r.length;u+=9,d+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),n.set(r[u+6],r[u+7],r[u+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),i.copy(t).add(e).add(n).divideScalar(3);const p=h(i);c(a,d+0,t,p),c(o,d+2,e,p),c(l,d+4,n,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],n=s[t+2],i=s[t+4],r=Math.max(e,n,i),a=Math.min(e,n,i);r>.9&&a<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),i<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new Cv(r,3)),this.setAttribute("normal",new Cv(r.slice(),3)),this.setAttribute("uv",new Cv(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new gw(t.vertices,t.indices,t.radius,t.details)}}class vw extends gw{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new vw(t.radius,t.detail)}}class yw extends dw{constructor(t){super(t),this.uuid=um(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new dw).fromJSON(n))}return this}}const xw=function(t,e,n=2){const i=e&&e.length,r=i?e[0]*n:t.length;let s=bw(t,0,r,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,h,u,d,p;if(i&&(s=function(t,e,n,i){const r=[];let s,a,o,l,c;for(s=0,a=e.length;s<a;s++)o=e[s]*i,l=s<a-1?e[s+1]*i:t.length,c=bw(t,o,l,i,!1),c===c.next&&(c.steiner=!0),r.push(Ow(c));for(r.sort(Aw),s=0;s<r.length;s++)n=Cw(r[s],n);return n}(t,e,s,n)),t.length>80*n){o=c=t[0],l=h=t[1];for(let e=n;e<r;e+=n)u=t[e],d=t[e+1],u<o&&(o=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-o,h-l),p=0!==p?32767/p:0}return ww(s,a,n,o,l,p,0),a};function bw(t,e,n,i,r){let s,a;if(r===function(t,e,n,i){let r=0;for(let s=e,a=n-i;s<n;s+=i)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}(t,e,n,i)>0)for(s=e;s<n;s+=i)a=Vw(s,t[s],t[s+1],a);else for(s=n-i;s>=e;s-=i)a=Vw(s,t[s],t[s+1],a);return a&&zw(a,a.next)&&(jw(a),a=a.next),a}function _w(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!zw(i,i.next)&&0!==Iw(i.prev,i,i.next))i=i.next;else{if(jw(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function ww(t,e,n,i,r,s,a){if(!t)return;!a&&s&&function(t,e,n,i){let r=t;do{0===r.z&&(r.z=Rw(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n,i,r,s,a,o,l,c=1;do{for(n=t,t=null,s=null,a=0;n;){for(a++,i=n,o=0,e=0;e<c&&(o++,i=i.nextZ,i);e++);for(l=c;o>0||l>0&&i;)0!==o&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,o--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(a>1)}(r)}(t,i,r,s);let o,l,c=t;for(;t.prev!==t.next;)if(o=t.prev,l=t.next,s?Mw(t,i,r,s):Sw(t))e.push(o.i/n|0),e.push(t.i/n|0),e.push(l.i/n|0),jw(t),t=l.next,c=l.next;else if((t=l)===c){a?1===a?ww(t=Tw(_w(t),e,n),e,n,i,r,s,2):2===a&&Ew(t,e,n,i,r,s):ww(_w(t),e,n,i,r,s,1);break}}function Sw(t){const e=t.prev,n=t,i=t.next;if(Iw(e,n,i)>=0)return!1;const r=e.x,s=n.x,a=i.x,o=e.y,l=n.y,c=i.y,h=r<s?r<a?r:a:s<a?s:a,u=o<l?o<c?o:c:l<c?l:c,d=r>s?r>a?r:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c;let f=i.next;for(;f!==e;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&Dw(r,o,s,l,a,c,f.x,f.y)&&Iw(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Mw(t,e,n,i){const r=t.prev,s=t,a=t.next;if(Iw(r,s,a)>=0)return!1;const o=r.x,l=s.x,c=a.x,h=r.y,u=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,f=h<u?h<d?h:d:u<d?u:d,m=o>l?o>c?o:c:l>c?l:c,g=h>u?h>d?h:d:u>d?u:d,v=Rw(p,f,e,n,i),y=Rw(m,g,e,n,i);let x=t.prevZ,b=t.nextZ;for(;x&&x.z>=v&&b&&b.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&Dw(o,h,l,u,c,d,x.x,x.y)&&Iw(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&Dw(o,h,l,u,c,d,b.x,b.y)&&Iw(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;x&&x.z>=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==a&&Dw(o,h,l,u,c,d,x.x,x.y)&&Iw(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==a&&Dw(o,h,l,u,c,d,b.x,b.y)&&Iw(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Tw(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!zw(r,s)&&Nw(r,i,i.next,s)&&Bw(r,s)&&Bw(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),jw(i),jw(i.next),i=t=s),i=i.next}while(i!==t);return _w(i)}function Ew(t,e,n,i,r,s){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&Lw(a,t)){let o=Fw(a,t);return a=_w(a,a.next),o=_w(o,o.next),ww(a,e,n,i,r,s,0),void ww(o,e,n,i,r,s,0)}t=t.next}a=a.next}while(a!==t)}function Aw(t,e){return t.x-e.x}function Cw(t,e){const n=function(t,e){let n,i=e,r=-1/0;const s=t.x,a=t.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const t=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=s&&t>r&&(r=t,n=i.x<i.next.x?i:i.next,t===s))return n}i=i.next}while(i!==e);if(!n)return null;const o=n,l=n.x,c=n.y;let h,u=1/0;i=n;do{s>=i.x&&i.x>=l&&s!==i.x&&Dw(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),Bw(i,t)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&Pw(n,i)))&&(n=i,u=h)),i=i.next}while(i!==o);return n}(t,e);if(!n)return e;const i=Fw(n,t);return _w(i,i.next),_w(n,n.next)}function Pw(t,e){return Iw(t.prev,t,e.prev)<0&&Iw(e.next,t,t.next)<0}function Rw(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ow(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Dw(t,e,n,i,r,s,a,o){return(r-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(i-o)>=(n-a)*(e-o)&&(n-a)*(s-o)>=(r-a)*(i-o)}function Lw(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Nw(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Bw(t,e)&&Bw(e,t)&&function(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(Iw(t.prev,t,e.prev)||Iw(t,e.prev,e))||zw(t,e)&&Iw(t.prev,t,t.next)>0&&Iw(e.prev,e,e.next)>0)}function Iw(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function zw(t,e){return t.x===e.x&&t.y===e.y}function Nw(t,e,n,i){const r=kw(Iw(t,e,n)),s=kw(Iw(t,e,i)),a=kw(Iw(n,i,t)),o=kw(Iw(n,i,e));return r!==s&&a!==o||(!(0!==r||!Uw(t,n,e))||(!(0!==s||!Uw(t,i,e))||(!(0!==a||!Uw(n,t,i))||!(0!==o||!Uw(n,e,i)))))}function Uw(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function kw(t){return t>0?1:t<0?-1:0}function Bw(t,e){return Iw(t.prev,t,t.next)<0?Iw(t,e,t.next)>=0&&Iw(t,t.prev,e)>=0:Iw(t,e,t.prev)<0||Iw(t,t.next,e)<0}function Fw(t,e){const n=new Hw(t.i,t.x,t.y),i=new Hw(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Vw(t,e,n,i){const r=new Hw(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function jw(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Hw(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Gw{static area(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n}static isClockWise(t){return Gw.area(t)<0}static triangulateShape(t,e){const n=[],i=[],r=[];Ww(t),qw(n,t);let s=t.length;e.forEach(Ww);for(let t=0;t<e.length;t++)i.push(s),s+=e[t].length,qw(n,e[t]);const a=xw(n,i);for(let t=0;t<a.length;t+=3)r.push(a.slice(t,t+3));return r}}function Ww(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function qw(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class Xw extends Nv{constructor(t=new yw([new ym(.5,.5),new ym(-.5,.5),new ym(-.5,-.5),new ym(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let e=0,n=t.length;e<n;e++){s(t[e])}function s(t){const s=[],a=void 0!==e.curveSegments?e.curveSegments:12,o=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:1;let c=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:h-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:$w;let g,v,y,x,b,_=!1;f&&(g=f.getSpacedPoints(o),_=!0,c=!1,v=f.computeFrenetFrames(o,!1),y=new $m,x=new $m,b=new $m),c||(p=0,h=0,u=0,d=0);const w=t.extractPoints(a);let S=w.shape;const M=w.holes;if(!Gw.isClockWise(S)){S=S.reverse();for(let t=0,e=M.length;t<e;t++){const e=M[t];Gw.isClockWise(e)&&(M[t]=e.reverse())}}const T=Gw.triangulateShape(S,M),E=S;for(let t=0,e=M.length;t<e;t++){const e=M[t];S=S.concat(e)}function A(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().addScaledVector(e,n)}const C=S.length,P=T.length;function R(t,e,n){let i,r,s;const a=t.x-e.x,o=t.y-e.y,l=n.x-t.x,c=n.y-t.y,h=a*a+o*o,u=a*c-o*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=e.x-o/u,f=e.y+a/u,m=((n.x-c/d-p)*c-(n.y+l/d-f)*l)/(a*c-o*l);i=p+a*m-t.x,r=f+o*m-t.y;const g=i*i+r*r;if(g<=2)return new ym(i,r);s=Math.sqrt(g/2)}else{let t=!1;a>Number.EPSILON?l>Number.EPSILON&&(t=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(c)&&(t=!0),t?(i=-o,r=a,s=Math.sqrt(h)):(i=a,r=o,s=Math.sqrt(h/2))}return new ym(i/s,r/s)}const O=[];for(let t=0,e=E.length,n=e-1,i=t+1;t<e;t++,n++,i++)n===e&&(n=0),i===e&&(i=0),O[t]=R(E[t],E[n],E[i]);const D=[];let L,I=O.concat();for(let t=0,e=M.length;t<e;t++){const e=M[t];L=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),L[t]=R(e[t],e[i],e[r]);D.push(L),I=I.concat(L)}for(let t=0;t<p;t++){const e=t/p,n=h*Math.cos(e*Math.PI/2),i=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],O[t],i);U(e.x,e.y,-n)}for(let t=0,e=M.length;t<e;t++){const e=M[t];L=D[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],L[t],i);U(r.x,r.y,-n)}}}const z=u+d;for(let t=0;t<C;t++){const e=c?A(S[t],I[t],z):S[t];_?(x.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),b.copy(g[0]).add(x).add(y),U(b.x,b.y,b.z)):U(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<C;e++){const n=c?A(S[e],I[e],z):S[e];_?(x.copy(v.normals[t]).multiplyScalar(n.x),y.copy(v.binormals[t]).multiplyScalar(n.y),b.copy(g[t]).add(x).add(y),U(b.x,b.y,b.z)):U(n.x,n.y,l/o*t)}for(let t=p-1;t>=0;t--){const e=t/p,n=h*Math.cos(e*Math.PI/2),i=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],O[t],i);U(e.x,e.y,l+n)}for(let t=0,e=M.length;t<e;t++){const e=M[t];L=D[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],L[t],i);_?U(r.x,r.y+g[o-1].y,g[o-1].x+n):U(r.x,r.y,l+n)}}}function N(t,e){let n=t.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=t.length-1);for(let t=0,n=o+2*p;t<n;t++){const n=C*t,s=C*(t+1);B(e+i+n,e+r+n,e+r+s,e+i+s)}}}function U(t,e,n){s.push(t),s.push(e),s.push(n)}function k(t,e,r){F(t),F(e),F(r);const s=i.length/3,a=m.generateTopUV(n,i,s-3,s-2,s-1);V(a[0]),V(a[1]),V(a[2])}function B(t,e,r,s){F(t),F(e),F(s),F(e),F(r),F(s);const a=i.length/3,o=m.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);V(o[0]),V(o[1]),V(o[3]),V(o[1]),V(o[2]),V(o[3])}function F(t){i.push(s[3*t+0]),i.push(s[3*t+1]),i.push(s[3*t+2])}function V(t){r.push(t.x),r.push(t.y)}!function(){const t=i.length/3;if(c){let t=0,e=C*t;for(let t=0;t<P;t++){const n=T[t];k(n[2]+e,n[1]+e,n[0]+e)}t=o+2*p,e=C*t;for(let t=0;t<P;t++){const n=T[t];k(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<P;t++){const e=T[t];k(e[2],e[1],e[0])}for(let t=0;t<P;t++){const e=T[t];k(e[0]+C*o,e[1]+C*o,e[2]+C*o)}}n.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;N(E,e),e+=E.length;for(let t=0,n=M.length;t<n;t++){const n=M[t];N(n,e),e+=n.length}n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new Cv(i,3)),this.setAttribute("uv",new Cv(r,2)),this.computeVertexNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,i=t.length;e<i;e++){const i=t[e];n.shapes.push(i.uuid)}else n.shapes.push(t.uuid);n.options=Object.assign({},e),void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}const i=t.options.extrudePath;return void 0!==i&&(t.options.extrudePath=(new hw[i.type]).fromJSON(i)),new Xw(n,t.options)}}const $w={generateTopUV:function(t,e,n,i,r){const s=e[3*n],a=e[3*n+1],o=e[3*i],l=e[3*i+1],c=e[3*r],h=e[3*r+1];return[new ym(s,a),new ym(o,l),new ym(c,h)]},generateSideWallUV:function(t,e,n,i,r,s){const a=e[3*n],o=e[3*n+1],l=e[3*n+2],c=e[3*i],h=e[3*i+1],u=e[3*i+2],d=e[3*r],p=e[3*r+1],f=e[3*r+2],m=e[3*s],g=e[3*s+1],v=e[3*s+2];return Math.abs(o-h)<Math.abs(a-c)?[new ym(a,1-l),new ym(c,1-u),new ym(d,1-f),new ym(m,1-v)]:[new ym(o,1-l),new ym(h,1-u),new ym(p,1-f),new ym(g,1-v)]}};class Yw extends gw{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Yw(t.radius,t.detail)}}class Zw extends Nv{constructor(t=new yw([new ym(0,.5),new ym(-.5,-.5),new ym(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],i=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(a,o,e),a+=o,o=0;function l(t){const a=i.length/3,l=t.extractPoints(e);let c=l.shape;const h=l.holes;!1===Gw.isClockWise(c)&&(c=c.reverse());for(let t=0,e=h.length;t<e;t++){const e=h[t];!0===Gw.isClockWise(e)&&(h[t]=e.reverse())}const u=Gw.triangulateShape(c,h);for(let t=0,e=h.length;t<e;t++){const e=h[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];i.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],i=e[0]+a,r=e[1]+a,s=e[2]+a;n.push(i,r,s),o+=3}}this.setIndex(n),this.setAttribute("position",new Cv(i,3)),this.setAttribute("normal",new Cv(r,3)),this.setAttribute("uv",new Cv(s,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}return new Zw(n,t.curveSegments)}}class Kw extends Nv{constructor(t=1,e=32,n=16,i=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const o=Math.min(s+a,Math.PI);let l=0;const c=[],h=new $m,u=new $m,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],v=d/n;let y=0;0===d&&0===s?y=.5/e:d===n&&o===Math.PI&&(y=-.5/e);for(let n=0;n<=e;n++){const o=n/e;h.x=-t*Math.cos(i+o*r)*Math.sin(s+v*a),h.y=t*Math.cos(s+v*a),h.z=t*Math.sin(i+o*r)*Math.sin(s+v*a),p.push(h.x,h.y,h.z),u.copy(h).normalize(),f.push(u.x,u.y,u.z),m.push(o+y,1-v),g.push(l++)}c.push(g)}for(let t=0;t<n;t++)for(let i=0;i<e;i++){const e=c[t][i+1],r=c[t][i],a=c[t+1][i],l=c[t+1][i+1];(0!==t||s>0)&&d.push(e,r,l),(t!==n-1||o<Math.PI)&&d.push(r,a,l)}this.setIndex(d),this.setAttribute("position",new Cv(p,3)),this.setAttribute("normal",new Cv(f,3)),this.setAttribute("uv",new Cv(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Kw(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Jw extends Nv{constructor(t=1,e=.4,n=12,i=48,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],a=[],o=[],l=[],c=new $m,h=new $m,u=new $m;for(let s=0;s<=n;s++)for(let d=0;d<=i;d++){const p=d/i*r,f=s/n*Math.PI*2;h.x=(t+e*Math.cos(f))*Math.cos(p),h.y=(t+e*Math.cos(f))*Math.sin(p),h.z=e*Math.sin(f),a.push(h.x,h.y,h.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),u.subVectors(h,c).normalize(),o.push(u.x,u.y,u.z),l.push(d/i),l.push(s/n)}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*t+e-1,r=(i+1)*(t-1)+e-1,a=(i+1)*(t-1)+e,o=(i+1)*t+e;s.push(n,r,o),s.push(r,a,o)}this.setIndex(s),this.setAttribute("position",new Cv(a,3)),this.setAttribute("normal",new Cv(o,3)),this.setAttribute("uv",new Cv(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Jw(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Qw extends Nv{constructor(t=1,e=.4,n=64,i=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);const a=[],o=[],l=[],c=[],h=new $m,u=new $m,d=new $m,p=new $m,f=new $m,m=new $m,g=new $m;for(let a=0;a<=n;++a){const y=a/n*r*Math.PI*2;v(y,r,s,t,d),v(y+.01,r,s,t,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let t=0;t<=i;++t){const r=t/i*Math.PI*2,s=-e*Math.cos(r),p=e*Math.sin(r);h.x=d.x+(s*g.x+p*f.x),h.y=d.y+(s*g.y+p*f.y),h.z=d.z+(s*g.z+p*f.z),o.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(a/n),c.push(t/i)}}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),s=(i+1)*t+e,o=(i+1)*(t-1)+e;a.push(n,r,o),a.push(r,s,o)}function v(t,e,n,i,r){const s=Math.cos(t),a=Math.sin(t),o=n/e*t,l=Math.cos(o);r.x=i*(2+l)*.5*s,r.y=i*(2+l)*a*.5,r.z=i*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new Cv(o,3)),this.setAttribute("normal",new Cv(l,3)),this.setAttribute("uv",new Cv(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Qw(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class tS extends oy{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}function eS(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function nS(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}class iS{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let s;n:{i:if(!(t<i)){for(let s=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(r=i,i=e[++n],t<i)break e}s=e.length;break n}if(t>=r)break t;{const a=e[1];t<a&&(n=2,r=a);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(i=r,r=e[--n-1],t>=r)break e}s=n,n=0}}for(;n<s;){const i=n+s>>>1;t<e[i]?s=i:n=i+1}if(i=e[n],r=e[n-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let t=0;t!==i;++t)e[t]=n[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class rS extends iS{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:If,endingEnd:If}}intervalChanged_(t,e,n){const i=this.parameterPositions;let r=t-2,s=t+1,a=i[r],o=i[s];if(void 0===a)switch(this.getSettings_().endingStart){case zf:r=t,a=2*e-n;break;case Nf:r=i.length-2,a=e+i[r]-i[r+1];break;default:r=t,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case zf:s=t,o=2*n-e;break;case Nf:s=1,o=n+i[1]-i[0];break;default:s=t-1,o=e}const l=.5*(n-e),c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-n),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f;for(let t=0;t!==a;++t)r[t]=g*s[c+t]+v*s[l+t]+y*s[o+t]+x*s[h+t];return r}}class sS extends iS{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=(n-e)/(i-e),h=1-c;for(let t=0;t!==a;++t)r[t]=s[l+t]*h+s[o+t]*c;return r}}class aS extends iS{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class oS{constructor(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=eS(e,this.TimeBufferType),this.values=eS(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:eS(t.times,Array),values:eS(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new aS(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new sS(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new rS(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Of:e=this.InterpolantFactoryMethodDiscrete;break;case Df:e=this.InterpolantFactoryMethodLinear;break;case Lf:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Of;case this.InterpolantFactoryMethodLinear:return Df;case this.InterpolantFactoryMethodSmooth:return Lf}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=n.slice(r,s),this.values=this.values.slice(r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const i=n[e];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,i),t=!1;break}if(null!==s&&s>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,i,s),t=!1;break}s=i}if(void 0!==i&&nS(i))for(let e=0,n=i.length;e!==n;++e){const n=i[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===Lf,r=t.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=t[a];if(o!==t[a+1]&&(1!==a||o!==t[0]))if(i)r=!0;else{const t=a*n,i=t-n,s=t+n;for(let a=0;a!==n;++a){const n=e[t+a];if(n!==e[i+a]||n!==e[s+a]){r=!0;break}}}if(r){if(a!==s){t[s]=t[a];const i=a*n,r=s*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*n,i=s*n,a=0;a!==n;++a)e[i+a]=e[t+a];++s}return s!==t.length?(this.times=t.slice(0,s),this.values=e.slice(0,s*n)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}oS.prototype.TimeBufferType=Float32Array,oS.prototype.ValueBufferType=Float32Array,oS.prototype.DefaultInterpolation=Df;class lS extends oS{constructor(t,e,n){super(t,e,n)}}lS.prototype.ValueTypeName="bool",lS.prototype.ValueBufferType=Array,lS.prototype.DefaultInterpolation=Of,lS.prototype.InterpolantFactoryMethodLinear=void 0,lS.prototype.InterpolantFactoryMethodSmooth=void 0;class cS extends oS{}cS.prototype.ValueTypeName="color";class hS extends oS{}hS.prototype.ValueTypeName="number";class uS extends iS{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-e)/(i-e);let l=t*a;for(let t=l+a;l!==t;l+=4)Xm.slerpFlat(r,0,s,l-a,s,l,o);return r}}class dS extends oS{InterpolantFactoryMethodLinear(t){return new uS(this.times,this.values,this.getValueSize(),t)}}dS.prototype.ValueTypeName="quaternion",dS.prototype.InterpolantFactoryMethodSmooth=void 0;class pS extends oS{constructor(t,e,n){super(t,e,n)}}pS.prototype.ValueTypeName="string",pS.prototype.ValueBufferType=Array,pS.prototype.DefaultInterpolation=Of,pS.prototype.InterpolantFactoryMethodLinear=void 0,pS.prototype.InterpolantFactoryMethodSmooth=void 0;class fS extends oS{}fS.prototype.ValueTypeName="vector";const mS={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class gS{constructor(t,e,n){const i=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){o++,!1===s&&void 0!==i.onStart&&i.onStart(t,a,o),s=!0},this.itemEnd=function(t){a++,void 0!==i.onProgress&&i.onProgress(t,a,o),a===o&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=l.length;e<n;e+=2){const n=l[e],i=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}}const vS=new gS;class yS{constructor(t){this.manager=void 0!==t?t:vS,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(i,r){n.load(t,i,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}yS.DEFAULT_MATERIAL_NAME="__DEFAULT";const xS={};class bS extends Error{constructor(t,e){super(t),this.response=e}}class _S extends yS{constructor(t){super(t)}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=mS.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==xS[t])return void xS[t].push({onLoad:e,onProgress:n,onError:i});xS[t]=[],xS[t].push({onLoad:e,onProgress:n,onError:i});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const n=xS[t],i=e.body.getReader(),r=e.headers.get("X-File-Size")||e.headers.get("Content-Length"),s=r?parseInt(r):0,a=0!==s;let o=0;const l=new ReadableStream({start(t){!function e(){i.read().then((({done:i,value:r})=>{if(i)t.close();else{o+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onProgress&&e.onProgress(i)}t.enqueue(r),e()}}),(e=>{t.error(e)}))}()}});return new Response(l)}throw new bS(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(o){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,a)));case"json":return t.json();default:if(void 0===a)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(a),n=e&&e[1]?e[1].toLowerCase():void 0,i=new TextDecoder(n);return t.arrayBuffer().then((t=>i.decode(t)))}}})).then((e=>{mS.add(t,e);const n=xS[t];delete xS[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onLoad&&i.onLoad(e)}})).catch((e=>{const n=xS[t];if(void 0===n)throw this.manager.itemError(t),e;delete xS[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class wS extends yS{constructor(t){super(t)}load(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=mS.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const a=Mm("img");function o(){c(),mS.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){c(),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class SS extends yS{constructor(t){super(t)}load(t,e,n,i){const r=new Vm,s=new wS(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),n,i),r}}class MS extends Kg{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new pv(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(e.object.target=this.target.uuid),e}}class TS extends MS{constructor(t,e,n){super(t,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Kg.DEFAULT_UP),this.updateMatrix(),this.groundColor=new pv(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const ES=new Mg,AS=new $m,CS=new $m;class PS{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ym(512,512),this.map=null,this.mapPass=null,this.matrix=new Mg,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Sy,this._frameExtents=new ym(1,1),this._viewportCount=1,this._viewports=[new jm(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;AS.setFromMatrixPosition(t.matrixWorld),e.position.copy(AS),CS.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(CS),e.updateMatrixWorld(),ES.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ES),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(ES)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 1!==this.intensity&&(t.intensity=this.intensity),0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class RS extends PS{constructor(){super(new dy(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,n=2*hm*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class OS extends MS{constructor(t,e,n=0,i=Math.PI/3,r=0,s=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Kg.DEFAULT_UP),this.updateMatrix(),this.target=new Kg,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new RS}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const DS=new Mg,LS=new $m,IS=new $m;class zS extends PS{constructor(){super(new dy(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ym(4,2),this._viewportCount=6,this._viewports=[new jm(2,1,1,1),new jm(0,1,1,1),new jm(3,1,1,1),new jm(1,1,1,1),new jm(3,0,1,1),new jm(1,0,1,1)],this._cubeDirections=[new $m(1,0,0),new $m(-1,0,0),new $m(0,0,1),new $m(0,0,-1),new $m(0,1,0),new $m(0,-1,0)],this._cubeUps=[new $m(0,1,0),new $m(0,1,0),new $m(0,1,0),new $m(0,1,0),new $m(0,0,1),new $m(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,i=this.matrix,r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),LS.setFromMatrixPosition(t.matrixWorld),n.position.copy(LS),IS.copy(n.position),IS.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(IS),n.updateMatrixWorld(),i.makeTranslation(-LS.x,-LS.y,-LS.z),DS.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(DS)}}class NS extends MS{constructor(t,e,n=0,i=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new zS}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class US extends PS{constructor(){super(new By(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class kS extends MS{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Kg.DEFAULT_UP),this.updateMatrix(),this.target=new Kg,this.shadow=new US}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class BS extends Nv{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class FS extends yS{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new _S(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}}),n,i)}parse(t){const e={},n={};function i(t,i){if(void 0!==e[i])return e[i];const r=t.interleavedBuffers[i],s=function(t,e){if(void 0!==n[e])return n[e];const i=t.arrayBuffers,r=i[e],s=new Uint32Array(r).buffer;return n[e]=s,s}(t,r.buffer),a=Sm(r.type,s),o=new m_(a,r.stride);return o.uuid=r.uuid,e[i]=o,o}const r=t.isInstancedBufferGeometry?new BS:new Nv,s=t.data.index;if(void 0!==s){const t=Sm(s.type,s.array);r.setIndex(new Tv(t,1))}const a=t.data.attributes;for(const e in a){const n=a[e];let s;if(n.isInterleavedBufferAttribute){const e=i(t.data,n.data);s=new v_(e,n.itemSize,n.offset,n.normalized)}else{const t=Sm(n.type,n.array);s=new(n.isInstancedBufferAttribute?S_:Tv)(t,n.itemSize,n.normalized)}void 0!==n.name&&(s.name=n.name),void 0!==n.usage&&s.setUsage(n.usage),r.setAttribute(e,s)}const o=t.data.morphAttributes;if(o)for(const e in o){const n=o[e],s=[];for(let e=0,r=n.length;e<r;e++){const r=n[e];let a;if(r.isInterleavedBufferAttribute){const e=i(t.data,r.data);a=new v_(e,r.itemSize,r.offset,r.normalized)}else{const t=Sm(r.type,r.array);a=new Tv(t,r.itemSize,r.normalized)}void 0!==r.name&&(a.name=r.name),s.push(a)}r.morphAttributes[e]=s}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];r.addGroup(e.start,e.count,e.materialIndex)}const c=t.data.boundingSphere;if(void 0!==c){const t=new $m;void 0!==c.center&&t.fromArray(c.center),r.boundingSphere=new mg(t,c.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}}const VS="\\[\\]\\.:\\/",jS=new RegExp("["+VS+"]","g"),HS="[^"+VS+"]",GS="[^"+VS.replace("\\.","")+"]",WS=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",HS)+/(WCOD+)?/.source.replace("WCOD",GS)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",HS)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",HS)+"$"),qS=["material","materials","bones","map"];class XS{constructor(t,e,n){this.path=e,this.parsedPath=n||XS.parseTrackName(e),this.node=XS.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new XS.Composite(t,e,n):new XS(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(jS,"")}static parseTrackName(t){const e=WS.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==qS.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const s=n(r.children);if(s)return s}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=XS.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const s=t[i];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}XS.Composite=class{constructor(t,e,n){const i=n||XS.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},XS.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},XS.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},XS.prototype.GetterByBindingType=[XS.prototype._getValue_direct,XS.prototype._getValue_array,XS.prototype._getValue_arrayElement,XS.prototype._getValue_toArray],XS.prototype.SetterByBindingTypeAndVersioning=[[XS.prototype._setValue_direct,XS.prototype._setValue_direct_setNeedsUpdate,XS.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[XS.prototype._setValue_array,XS.prototype._setValue_array_setNeedsUpdate,XS.prototype._setValue_array_setMatrixWorldNeedsUpdate],[XS.prototype._setValue_arrayElement,XS.prototype._setValue_arrayElement_setNeedsUpdate,XS.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[XS.prototype._setValue_fromArray,XS.prototype._setValue_fromArray_setNeedsUpdate,XS.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];new Float32Array(1);class $S{constructor(t){this.value=t}clone(){return new $S(void 0===this.value.clone?this.value:this.value.clone())}}const YS=new Mg;class ZS{constructor(t,e,n=0,i=1/0){this.ray=new Sg(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new zg,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return YS.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(YS),this}intersectObject(t,e=!0,n=[]){return JS(t,this,n,e),n.sort(KS),n}intersectObjects(t,e=!0,n=[]){for(let i=0,r=t.length;i<r;i++)JS(t[i],this,n,e);return n.sort(KS),n}}function KS(t,e){return t.distance-e.distance}function JS(t,e,n,i){let r=!0;if(t.layers.test(e.layers)){!1===t.raycast(e,n)&&(r=!1)}if(!0===r&&!0===i){const i=t.children;for(let t=0,r=i.length;t<r;t++)JS(i[t],e,n,!0)}}class QS{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(dm(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const tM=new ym;class eM{constructor(t=new ym(1/0,1/0),e=new ym(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=tM.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,tM).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const nM=new $m,iM=new $m;class rM{constructor(t=new $m,e=new $m){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){nM.subVectors(t,this.start),iM.subVectors(this.end,this.start);const n=iM.dot(iM);let i=iM.dot(nM)/n;return e&&(i=dm(i,0,1)),i}closestPointToPoint(t,e,n){const i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const sM=new $m;class aM extends Kg{constructor(t,e){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const n=new Nv,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,n=32;t<n;t++,e++){const r=t/n*Math.PI*2,s=e/n*Math.PI*2;i.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new Cv(i,3));const r=new D_({fog:!1,toneMapped:!1});this.cone=new G_(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),sM.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(sM),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}class oM extends ty{constructor(t,e,n){super(new Kw(e,4,2),new vv({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const lM=new $m,cM=new $m,hM=new $m;class uM extends Kg{constructor(t,e,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===e&&(e=1);let i=new Nv;i.setAttribute("position",new Cv([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new D_({fog:!1,toneMapped:!1});this.lightPlane=new F_(i,r),this.add(this.lightPlane),i=new Nv,i.setAttribute("position",new Cv([0,0,0,0,0,1],3)),this.targetLine=new F_(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),lM.setFromMatrixPosition(this.light.matrixWorld),cM.setFromMatrixPosition(this.light.target.matrixWorld),hM.subVectors(cM,lM),this.lightPlane.lookAt(cM),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(cM),this.targetLine.scale.z=hM.length()}}const dM=new $m,pM=new ly;class fM extends G_{constructor(t){const e=new Nv,n=new D_({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={};function a(t,e){o(t),o(e)}function o(t){i.push(0,0,0),r.push(0,0,0),void 0===s[t]&&(s[t]=[]),s[t].push(i.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),e.setAttribute("position",new Cv(i,3)),e.setAttribute("color",new Cv(r,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new pv(16755200),c=new pv(16711680),h=new pv(43775),u=new pv(16777215),d=new pv(3355443);this.setColors(l,c,h,u,d)}setColors(t,e,n,i,r){const s=this.geometry.getAttribute("color");s.setXYZ(0,t.r,t.g,t.b),s.setXYZ(1,t.r,t.g,t.b),s.setXYZ(2,t.r,t.g,t.b),s.setXYZ(3,t.r,t.g,t.b),s.setXYZ(4,t.r,t.g,t.b),s.setXYZ(5,t.r,t.g,t.b),s.setXYZ(6,t.r,t.g,t.b),s.setXYZ(7,t.r,t.g,t.b),s.setXYZ(8,t.r,t.g,t.b),s.setXYZ(9,t.r,t.g,t.b),s.setXYZ(10,t.r,t.g,t.b),s.setXYZ(11,t.r,t.g,t.b),s.setXYZ(12,t.r,t.g,t.b),s.setXYZ(13,t.r,t.g,t.b),s.setXYZ(14,t.r,t.g,t.b),s.setXYZ(15,t.r,t.g,t.b),s.setXYZ(16,t.r,t.g,t.b),s.setXYZ(17,t.r,t.g,t.b),s.setXYZ(18,t.r,t.g,t.b),s.setXYZ(19,t.r,t.g,t.b),s.setXYZ(20,t.r,t.g,t.b),s.setXYZ(21,t.r,t.g,t.b),s.setXYZ(22,t.r,t.g,t.b),s.setXYZ(23,t.r,t.g,t.b),s.setXYZ(24,e.r,e.g,e.b),s.setXYZ(25,e.r,e.g,e.b),s.setXYZ(26,e.r,e.g,e.b),s.setXYZ(27,e.r,e.g,e.b),s.setXYZ(28,e.r,e.g,e.b),s.setXYZ(29,e.r,e.g,e.b),s.setXYZ(30,e.r,e.g,e.b),s.setXYZ(31,e.r,e.g,e.b),s.setXYZ(32,n.r,n.g,n.b),s.setXYZ(33,n.r,n.g,n.b),s.setXYZ(34,n.r,n.g,n.b),s.setXYZ(35,n.r,n.g,n.b),s.setXYZ(36,n.r,n.g,n.b),s.setXYZ(37,n.r,n.g,n.b),s.setXYZ(38,i.r,i.g,i.b),s.setXYZ(39,i.r,i.g,i.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){const t=this.geometry,e=this.pointMap;pM.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),mM("c",e,t,pM,0,0,-1),mM("t",e,t,pM,0,0,1),mM("n1",e,t,pM,-1,-1,-1),mM("n2",e,t,pM,1,-1,-1),mM("n3",e,t,pM,-1,1,-1),mM("n4",e,t,pM,1,1,-1),mM("f1",e,t,pM,-1,-1,1),mM("f2",e,t,pM,1,-1,1),mM("f3",e,t,pM,-1,1,1),mM("f4",e,t,pM,1,1,1),mM("u1",e,t,pM,.7,1.1,-1),mM("u2",e,t,pM,-.7,1.1,-1),mM("u3",e,t,pM,0,2,-1),mM("cf1",e,t,pM,-1,0,1),mM("cf2",e,t,pM,1,0,1),mM("cf3",e,t,pM,0,-1,1),mM("cf4",e,t,pM,0,1,1),mM("cn1",e,t,pM,-1,0,-1),mM("cn2",e,t,pM,1,0,-1),mM("cn3",e,t,pM,0,-1,-1),mM("cn4",e,t,pM,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function mM(t,e,n,i,r,s,a){dM.set(r,s,a).unproject(i);const o=e[t];if(void 0!==o){const t=n.getAttribute("position");for(let e=0,n=o.length;e<n;e++)t.setXYZ(o[e],dM.x,dM.y,dM.z)}}class gM extends G_{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Nv;i.setIndex(new Tv(n,1)),i.setAttribute("position",new Cv([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new D_({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class vM extends G_{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Nv;n.setAttribute("position",new Cv(e,3)),n.setAttribute("color",new Cv([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new D_({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,n){const i=new pv,r=this.geometry.attributes.color.array;return i.set(t),i.toArray(r,0),i.toArray(r,3),i.set(e),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class yM{constructor(){this.type="ShapePath",this.color=new pv,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new dw,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this}bezierCurveTo(t,e,n,i,r,s){return this.currentPath.bezierCurveTo(t,e,n,i,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(t,e){const n=e.length;let i=!1;for(let r=n-1,s=0;s<n;r=s++){let n=e[r],a=e[s],o=a.x-n.x,l=a.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=e[s],o=-o,a=e[r],l=-l),t.y<n.y||t.y>a.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=l*(t.x-n.x)-o*(t.y-n.y);if(0===e)return!0;if(e<0)continue;i=!i}}else{if(t.y!==n.y)continue;if(a.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=a.x)return!0}}return i}const n=Gw.isClockWise,i=this.subPaths;if(0===i.length)return[];let r,s,a;const o=[];if(1===i.length)return s=i[0],a=new yw,a.curves=s.curves,o.push(a),o;let l=!n(i[0].getPoints());l=t?!l:l;const c=[],h=[];let u,d,p=[],f=0;h[f]=void 0,p[f]=[];for(let e=0,a=i.length;e<a;e++)s=i[e],u=s.getPoints(),r=n(u),r=t?!r:r,r?(!l&&h[f]&&f++,h[f]={s:new yw,p:u},h[f].s.curves=s.curves,l&&f++,p[f]=[]):p[f].push({h:s,p:u[0]});if(!h[0])return function(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n],r=new yw;r.curves=i.curves,e.push(r)}return e}(i);if(h.length>1){let t=!1,n=0;for(let t=0,e=h.length;t<e;t++)c[t]=[];for(let i=0,r=h.length;i<r;i++){const r=p[i];for(let s=0;s<r.length;s++){const a=r[s];let o=!0;for(let r=0;r<h.length;r++)e(a.p,h[r].p)&&(i!==r&&n++,o?(o=!1,c[r].push(a)):t=!0);o&&c[i].push(a)}}n>0&&!1===t&&(p=c)}for(let t=0,e=h.length;t<e;t++){a=h[t].s,o.push(a),d=p[t];for(let t=0,e=d.length;t<e;t++)a.holes.push(d[t].h)}return o}}class xM extends Gm{constructor(t=1,e=1,n=1,i={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(t,e,{...i,count:n}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Pd}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Pd),pu.plugin(mu),window.Alpine=pu,window.$=jQuery,xd.use([function(t){let{swiper:e,extendParams:n,on:i,emit:r}=t;function s(t){let n;return t&&"string"==typeof t&&e.isElement&&(n=e.el.querySelector(t),n)?n:(t&&("string"==typeof t&&(n=[...document.querySelectorAll(t)]),e.params.uniqueNavElements&&"string"==typeof t&&n&&n.length>1&&1===e.el.querySelectorAll(t).length?n=e.el.querySelector(t):n&&1===n.length&&(n=n[0])),t&&!n?t:n)}function a(t,n){const i=e.params.navigation;(t=ku(t)).forEach((t=>{t&&(t.classList[n?"add":"remove"](...i.disabledClass.split(" ")),"BUTTON"===t.tagName&&(t.disabled=n),e.params.watchOverflow&&e.enabled&&t.classList[e.isLocked?"add":"remove"](i.lockClass))}))}function o(){const{nextEl:t,prevEl:n}=e.navigation;if(e.params.loop)return a(n,!1),void a(t,!1);a(n,e.isBeginning&&!e.params.rewind),a(t,e.isEnd&&!e.params.rewind)}function l(t){t.preventDefault(),(!e.isBeginning||e.params.loop||e.params.rewind)&&(e.slidePrev(),r("navigationPrev"))}function c(t){t.preventDefault(),(!e.isEnd||e.params.loop||e.params.rewind)&&(e.slideNext(),r("navigationNext"))}function h(){const t=e.params.navigation;if(e.params.navigation=bd(e,e.originalParams.navigation,e.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!t.nextEl&&!t.prevEl)return;let n=s(t.nextEl),i=s(t.prevEl);Object.assign(e.navigation,{nextEl:n,prevEl:i}),n=ku(n),i=ku(i);const r=(n,i)=>{n&&n.addEventListener("click","next"===i?c:l),!e.enabled&&n&&n.classList.add(...t.lockClass.split(" "))};n.forEach((t=>r(t,"next"))),i.forEach((t=>r(t,"prev")))}function u(){let{nextEl:t,prevEl:n}=e.navigation;t=ku(t),n=ku(n);const i=(t,n)=>{t.removeEventListener("click","next"===n?c:l),t.classList.remove(...e.params.navigation.disabledClass.split(" "))};t.forEach((t=>i(t,"next"))),n.forEach((t=>i(t,"prev")))}n({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),e.navigation={nextEl:null,prevEl:null},i("init",(()=>{!1===e.params.navigation.enabled?d():(h(),o())})),i("toEdge fromEdge lock unlock",(()=>{o()})),i("destroy",(()=>{u()})),i("enable disable",(()=>{let{nextEl:t,prevEl:n}=e.navigation;t=ku(t),n=ku(n),e.enabled?o():[...t,...n].filter((t=>!!t)).forEach((t=>t.classList.add(e.params.navigation.lockClass)))})),i("click",((t,n)=>{let{nextEl:i,prevEl:s}=e.navigation;i=ku(i),s=ku(s);const a=n.target;let o=s.includes(a)||i.includes(a);if(e.isElement&&!o){const t=n.path||n.composedPath&&n.composedPath();t&&(o=t.find((t=>i.includes(t)||s.includes(t))))}if(e.params.navigation.hideOnClick&&!o){if(e.pagination&&e.params.pagination&&e.params.pagination.clickable&&(e.pagination.el===a||e.pagination.el.contains(a)))return;let t;i.length?t=i[0].classList.contains(e.params.navigation.hiddenClass):s.length&&(t=s[0].classList.contains(e.params.navigation.hiddenClass)),r(!0===t?"navigationShow":"navigationHide"),[...i,...s].filter((t=>!!t)).forEach((t=>t.classList.toggle(e.params.navigation.hiddenClass)))}}));const d=()=>{e.el.classList.add(...e.params.navigation.navigationDisabledClass.split(" ")),u()};Object.assign(e.navigation,{enable:()=>{e.el.classList.remove(...e.params.navigation.navigationDisabledClass.split(" ")),h(),o()},disable:d,update:o,init:h,destroy:u})},function(t){let{swiper:e,extendParams:n,on:i,emit:r}=t;const s="swiper-pagination";let a;n({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:t=>t,formatFractionTotal:t=>t,bulletClass:`${s}-bullet`,bulletActiveClass:`${s}-bullet-active`,modifierClass:`${s}-`,currentClass:`${s}-current`,totalClass:`${s}-total`,hiddenClass:`${s}-hidden`,progressbarFillClass:`${s}-progressbar-fill`,progressbarOppositeClass:`${s}-progressbar-opposite`,clickableClass:`${s}-clickable`,lockClass:`${s}-lock`,horizontalClass:`${s}-horizontal`,verticalClass:`${s}-vertical`,paginationDisabledClass:`${s}-disabled`}}),e.pagination={el:null,bullets:[]};let o=0;function l(){return!e.params.pagination.el||!e.pagination.el||Array.isArray(e.pagination.el)&&0===e.pagination.el.length}function c(t,n){const{bulletActiveClass:i}=e.params.pagination;t&&(t=t[("prev"===n?"previous":"next")+"ElementSibling"])&&(t.classList.add(`${i}-${n}`),(t=t[("prev"===n?"previous":"next")+"ElementSibling"])&&t.classList.add(`${i}-${n}-${n}`))}function h(t){const n=t.target.closest(_d(e.params.pagination.bulletClass));if(!n)return;t.preventDefault();const i=Iu(n)*e.params.slidesPerGroup;if(e.params.loop){if(e.realIndex===i)return;e.slideToLoop(i)}else e.slideTo(i)}function u(){const t=e.rtl,n=e.params.pagination;if(l())return;let i,s,h=e.pagination.el;h=ku(h);const u=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:e.slides.length,d=e.params.loop?Math.ceil(u/e.params.slidesPerGroup):e.snapGrid.length;if(e.params.loop?(s=e.previousRealIndex||0,i=e.params.slidesPerGroup>1?Math.floor(e.realIndex/e.params.slidesPerGroup):e.realIndex):void 0!==e.snapIndex?(i=e.snapIndex,s=e.previousSnapIndex):(s=e.previousIndex||0,i=e.activeIndex||0),"bullets"===n.type&&e.pagination.bullets&&e.pagination.bullets.length>0){const r=e.pagination.bullets;let l,u,d;if(n.dynamicBullets&&(a=Uu(r[0],e.isHorizontal()?"width":"height",!0),h.forEach((t=>{t.style[e.isHorizontal()?"width":"height"]=a*(n.dynamicMainBullets+4)+"px"})),n.dynamicMainBullets>1&&void 0!==s&&(o+=i-(s||0),o>n.dynamicMainBullets-1?o=n.dynamicMainBullets-1:o<0&&(o=0)),l=Math.max(i-o,0),u=l+(Math.min(r.length,n.dynamicMainBullets)-1),d=(u+l)/2),r.forEach((t=>{const e=[...["","-next","-next-next","-prev","-prev-prev","-main"].map((t=>`${n.bulletActiveClass}${t}`))].map((t=>"string"==typeof t&&t.includes(" ")?t.split(" "):t)).flat();t.classList.remove(...e)})),h.length>1)r.forEach((t=>{const r=Iu(t);r===i?t.classList.add(...n.bulletActiveClass.split(" ")):e.isElement&&t.setAttribute("part","bullet"),n.dynamicBullets&&(r>=l&&r<=u&&t.classList.add(...`${n.bulletActiveClass}-main`.split(" ")),r===l&&c(t,"prev"),r===u&&c(t,"next"))}));else{const t=r[i];if(t&&t.classList.add(...n.bulletActiveClass.split(" ")),e.isElement&&r.forEach(((t,e)=>{t.setAttribute("part",e===i?"bullet-active":"bullet")})),n.dynamicBullets){const t=r[l],e=r[u];for(let t=l;t<=u;t+=1)r[t]&&r[t].classList.add(...`${n.bulletActiveClass}-main`.split(" "));c(t,"prev"),c(e,"next")}}if(n.dynamicBullets){const i=Math.min(r.length,n.dynamicMainBullets+4),s=(a*i-a)/2-d*a,o=t?"right":"left";r.forEach((t=>{t.style[e.isHorizontal()?o:"top"]=`${s}px`}))}}h.forEach(((t,s)=>{if("fraction"===n.type&&(t.querySelectorAll(_d(n.currentClass)).forEach((t=>{t.textContent=n.formatFractionCurrent(i+1)})),t.querySelectorAll(_d(n.totalClass)).forEach((t=>{t.textContent=n.formatFractionTotal(d)}))),"progressbar"===n.type){let r;r=n.progressbarOpposite?e.isHorizontal()?"vertical":"horizontal":e.isHorizontal()?"horizontal":"vertical";const s=(i+1)/d;let a=1,o=1;"horizontal"===r?a=s:o=s,t.querySelectorAll(_d(n.progressbarFillClass)).forEach((t=>{t.style.transform=`translate3d(0,0,0) scaleX(${a}) scaleY(${o})`,t.style.transitionDuration=`${e.params.speed}ms`}))}"custom"===n.type&&n.renderCustom?(t.innerHTML=n.renderCustom(e,i+1,d),0===s&&r("paginationRender",t)):(0===s&&r("paginationRender",t),r("paginationUpdate",t)),e.params.watchOverflow&&e.enabled&&t.classList[e.isLocked?"add":"remove"](n.lockClass)}))}function d(){const t=e.params.pagination;if(l())return;const n=e.virtual&&e.params.virtual.enabled?e.virtual.slides.length:e.grid&&e.params.grid.rows>1?e.slides.length/Math.ceil(e.params.grid.rows):e.slides.length;let i=e.pagination.el;i=ku(i);let s="";if("bullets"===t.type){let i=e.params.loop?Math.ceil(n/e.params.slidesPerGroup):e.snapGrid.length;e.params.freeMode&&e.params.freeMode.enabled&&i>n&&(i=n);for(let n=0;n<i;n+=1)t.renderBullet?s+=t.renderBullet.call(e,n,t.bulletClass):s+=`<${t.bulletElement} ${e.isElement?'part="bullet"':""} class="${t.bulletClass}"></${t.bulletElement}>`}"fraction"===t.type&&(s=t.renderFraction?t.renderFraction.call(e,t.currentClass,t.totalClass):`<span class="${t.currentClass}"></span> / <span class="${t.totalClass}"></span>`),"progressbar"===t.type&&(s=t.renderProgressbar?t.renderProgressbar.call(e,t.progressbarFillClass):`<span class="${t.progressbarFillClass}"></span>`),e.pagination.bullets=[],i.forEach((n=>{"custom"!==t.type&&(n.innerHTML=s||""),"bullets"===t.type&&e.pagination.bullets.push(...n.querySelectorAll(_d(t.bulletClass)))})),"custom"!==t.type&&r("paginationRender",i[0])}function p(){e.params.pagination=bd(e,e.originalParams.pagination,e.params.pagination,{el:"swiper-pagination"});const t=e.params.pagination;if(!t.el)return;let n;"string"==typeof t.el&&e.isElement&&(n=e.el.querySelector(t.el)),n||"string"!=typeof t.el||(n=[...document.querySelectorAll(t.el)]),n||(n=t.el),n&&0!==n.length&&(e.params.uniqueNavElements&&"string"==typeof t.el&&Array.isArray(n)&&n.length>1&&(n=[...e.el.querySelectorAll(t.el)],n.length>1&&(n=n.filter((t=>zu(t,".swiper")[0]===e.el))[0])),Array.isArray(n)&&1===n.length&&(n=n[0]),Object.assign(e.pagination,{el:n}),n=ku(n),n.forEach((n=>{"bullets"===t.type&&t.clickable&&n.classList.add(...(t.clickableClass||"").split(" ")),n.classList.add(t.modifierClass+t.type),n.classList.add(e.isHorizontal()?t.horizontalClass:t.verticalClass),"bullets"===t.type&&t.dynamicBullets&&(n.classList.add(`${t.modifierClass}${t.type}-dynamic`),o=0,t.dynamicMainBullets<1&&(t.dynamicMainBullets=1)),"progressbar"===t.type&&t.progressbarOpposite&&n.classList.add(t.progressbarOppositeClass),t.clickable&&n.addEventListener("click",h),e.enabled||n.classList.add(t.lockClass)})))}function f(){const t=e.params.pagination;if(l())return;let n=e.pagination.el;n&&(n=ku(n),n.forEach((n=>{n.classList.remove(t.hiddenClass),n.classList.remove(t.modifierClass+t.type),n.classList.remove(e.isHorizontal()?t.horizontalClass:t.verticalClass),t.clickable&&(n.classList.remove(...(t.clickableClass||"").split(" ")),n.removeEventListener("click",h))}))),e.pagination.bullets&&e.pagination.bullets.forEach((e=>e.classList.remove(...t.bulletActiveClass.split(" "))))}i("changeDirection",(()=>{if(!e.pagination||!e.pagination.el)return;const t=e.params.pagination;let{el:n}=e.pagination;n=ku(n),n.forEach((n=>{n.classList.remove(t.horizontalClass,t.verticalClass),n.classList.add(e.isHorizontal()?t.horizontalClass:t.verticalClass)}))})),i("init",(()=>{!1===e.params.pagination.enabled?m():(p(),d(),u())})),i("activeIndexChange",(()=>{void 0===e.snapIndex&&u()})),i("snapIndexChange",(()=>{u()})),i("snapGridLengthChange",(()=>{d(),u()})),i("destroy",(()=>{f()})),i("enable disable",(()=>{let{el:t}=e.pagination;t&&(t=ku(t),t.forEach((t=>t.classList[e.enabled?"remove":"add"](e.params.pagination.lockClass))))})),i("lock unlock",(()=>{u()})),i("click",((t,n)=>{const i=n.target,s=ku(e.pagination.el);if(e.params.pagination.el&&e.params.pagination.hideOnClick&&s&&s.length>0&&!i.classList.contains(e.params.pagination.bulletClass)){if(e.navigation&&(e.navigation.nextEl&&i===e.navigation.nextEl||e.navigation.prevEl&&i===e.navigation.prevEl))return;const t=s[0].classList.contains(e.params.pagination.hiddenClass);r(!0===t?"paginationShow":"paginationHide"),s.forEach((t=>t.classList.toggle(e.params.pagination.hiddenClass)))}}));const m=()=>{e.el.classList.add(e.params.pagination.paginationDisabledClass);let{el:t}=e.pagination;t&&(t=ku(t),t.forEach((t=>t.classList.add(e.params.pagination.paginationDisabledClass)))),f()};Object.assign(e.pagination,{enable:()=>{e.el.classList.remove(e.params.pagination.paginationDisabledClass);let{el:t}=e.pagination;t&&(t=ku(t),t.forEach((t=>t.classList.remove(e.params.pagination.paginationDisabledClass)))),p(),d(),u()},disable:m,render:d,update:u,init:p,destroy:f})},function(t){let{swiper:e,extendParams:n,on:i}=t;n({fadeEffect:{crossFade:!1}}),wd({effect:"fade",swiper:e,on:i,setTranslate:()=>{const{slides:t}=e;e.params.fadeEffect;for(let n=0;n<t.length;n+=1){const t=e.slides[n];let i=-t.swiperSlideOffset;e.params.virtualTranslate||(i-=e.translate);let r=0;e.isHorizontal()||(r=i,i=0);const s=e.params.fadeEffect.crossFade?Math.max(1-Math.abs(t.progress),0):1+Math.min(Math.max(t.progress,-1),0),a=Sd(0,t);a.style.opacity=s,a.style.transform=`translate3d(${i}px, ${r}px, 0px)`}},setTransition:t=>{const n=e.slides.map((t=>Pu(t)));n.forEach((e=>{e.style.transitionDuration=`${t}ms`})),Md({swiper:e,duration:t,transformElements:n,allSlides:!0})},overwriteParams:()=>({slidesPerView:1,slidesPerGroup:1,watchSlidesProgress:!0,spaceBetween:0,virtualTranslate:!e.params.cssMode})})},function(t){let e,n,{swiper:i,extendParams:r,on:s,emit:a,params:o}=t;i.autoplay={running:!1,paused:!1,timeLeft:0},r({autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!1,stopOnLastSlide:!1,reverseDirection:!1,pauseOnMouseEnter:!1}});let l,c,h,u,d,p,f,m,g=o&&o.autoplay?o.autoplay.delay:3e3,v=o&&o.autoplay?o.autoplay.delay:3e3,y=(new Date).getTime();function x(t){i&&!i.destroyed&&i.wrapperEl&&t.target===i.wrapperEl&&(i.wrapperEl.removeEventListener("transitionend",x),m||t.detail&&t.detail.bySwiperTouchMove||T())}const b=()=>{if(i.destroyed||!i.autoplay.running)return;i.autoplay.paused?c=!0:c&&(v=l,c=!1);const t=i.autoplay.paused?l:y+v-(new Date).getTime();i.autoplay.timeLeft=t,a("autoplayTimeLeft",t,t/g),n=requestAnimationFrame((()=>{b()}))},_=t=>{if(i.destroyed||!i.autoplay.running)return;cancelAnimationFrame(n),b();let r=void 0===t?i.params.autoplay.delay:t;g=i.params.autoplay.delay,v=i.params.autoplay.delay;const s=(()=>{let t;if(t=i.virtual&&i.params.virtual.enabled?i.slides.filter((t=>t.classList.contains("swiper-slide-active")))[0]:i.slides[i.activeIndex],!t)return;return parseInt(t.getAttribute("data-swiper-autoplay"),10)})();!Number.isNaN(s)&&s>0&&void 0===t&&(r=s,g=s,v=s),l=r;const o=i.params.speed,c=()=>{i&&!i.destroyed&&(i.params.autoplay.reverseDirection?!i.isBeginning||i.params.loop||i.params.rewind?(i.slidePrev(o,!0,!0),a("autoplay")):i.params.autoplay.stopOnLastSlide||(i.slideTo(i.slides.length-1,o,!0,!0),a("autoplay")):!i.isEnd||i.params.loop||i.params.rewind?(i.slideNext(o,!0,!0),a("autoplay")):i.params.autoplay.stopOnLastSlide||(i.slideTo(0,o,!0,!0),a("autoplay")),i.params.cssMode&&(y=(new Date).getTime(),requestAnimationFrame((()=>{_()}))))};return r>0?(clearTimeout(e),e=setTimeout((()=>{c()}),r)):requestAnimationFrame((()=>{c()})),r},w=()=>{y=(new Date).getTime(),i.autoplay.running=!0,_(),a("autoplayStart")},S=()=>{i.autoplay.running=!1,clearTimeout(e),cancelAnimationFrame(n),a("autoplayStop")},M=(t,n)=>{if(i.destroyed||!i.autoplay.running)return;clearTimeout(e),t||(f=!0);const r=()=>{a("autoplayPause"),i.params.autoplay.waitForTransition?i.wrapperEl.addEventListener("transitionend",x):T()};if(i.autoplay.paused=!0,n)return p&&(l=i.params.autoplay.delay),p=!1,void r();const s=l||i.params.autoplay.delay;l=s-((new Date).getTime()-y),i.isEnd&&l<0&&!i.params.loop||(l<0&&(l=0),r())},T=()=>{i.isEnd&&l<0&&!i.params.loop||i.destroyed||!i.autoplay.running||(y=(new Date).getTime(),f?(f=!1,_(l)):_(),i.autoplay.paused=!1,a("autoplayResume"))},E=()=>{if(i.destroyed||!i.autoplay.running)return;const t=xu();"hidden"===t.visibilityState&&(f=!0,M(!0)),"visible"===t.visibilityState&&T()},A=t=>{"mouse"===t.pointerType&&(f=!0,m=!0,i.animating||i.autoplay.paused||M(!0))},C=t=>{"mouse"===t.pointerType&&(m=!1,i.autoplay.paused&&T())};s("init",(()=>{i.params.autoplay.enabled&&(i.params.autoplay.pauseOnMouseEnter&&(i.el.addEventListener("pointerenter",A),i.el.addEventListener("pointerleave",C)),xu().addEventListener("visibilitychange",E),w())})),s("destroy",(()=>{i.el&&"string"!=typeof i.el&&(i.el.removeEventListener("pointerenter",A),i.el.removeEventListener("pointerleave",C)),xu().removeEventListener("visibilitychange",E),i.autoplay.running&&S()})),s("_freeModeStaticRelease",(()=>{(u||f)&&T()})),s("_freeModeNoMomentumRelease",(()=>{i.params.autoplay.disableOnInteraction?S():M(!0,!0)})),s("beforeTransitionStart",((t,e,n)=>{!i.destroyed&&i.autoplay.running&&(n||!i.params.autoplay.disableOnInteraction?M(!0,!0):S())})),s("sliderFirstMove",(()=>{!i.destroyed&&i.autoplay.running&&(i.params.autoplay.disableOnInteraction?S():(h=!0,u=!1,f=!1,d=setTimeout((()=>{f=!0,u=!0,M(!0)}),200)))})),s("touchEnd",(()=>{if(!i.destroyed&&i.autoplay.running&&h){if(clearTimeout(d),clearTimeout(e),i.params.autoplay.disableOnInteraction)return u=!1,void(h=!1);u&&i.params.cssMode&&T(),u=!1,h=!1}})),s("slideChange",(()=>{!i.destroyed&&i.autoplay.running&&(p=!0)})),Object.assign(i.autoplay,{start:w,stop:S,pause:M,resume:T})},function(t){let{swiper:e,extendParams:n,emit:i,once:r}=t;n({freeMode:{enabled:!1,momentum:!0,momentumRatio:1,momentumBounce:!0,momentumBounceRatio:1,momentumVelocityRatio:1,sticky:!1,minimumVelocity:.02}}),Object.assign(e,{freeMode:{onTouchStart:function(){if(e.params.cssMode)return;const t=e.getTranslate();e.setTranslate(t),e.setTransition(0),e.touchEventsData.velocities.length=0,e.freeMode.onTouchEnd({currentPos:e.rtl?e.translate:-e.translate})},onTouchMove:function(){if(e.params.cssMode)return;const{touchEventsData:t,touches:n}=e;0===t.velocities.length&&t.velocities.push({position:n[e.isHorizontal()?"startX":"startY"],time:t.touchStartTime}),t.velocities.push({position:n[e.isHorizontal()?"currentX":"currentY"],time:Su()})},onTouchEnd:function(t){let{currentPos:n}=t;if(e.params.cssMode)return;const{params:s,wrapperEl:a,rtlTranslate:o,snapGrid:l,touchEventsData:c}=e,h=Su()-c.touchStartTime;if(n<-e.minTranslate())e.slideTo(e.activeIndex);else if(n>-e.maxTranslate())e.slides.length<l.length?e.slideTo(l.length-1):e.slideTo(e.slides.length-1);else{if(s.freeMode.momentum){if(c.velocities.length>1){const t=c.velocities.pop(),n=c.velocities.pop(),i=t.position-n.position,r=t.time-n.time;e.velocity=i/r,e.velocity/=2,Math.abs(e.velocity)<s.freeMode.minimumVelocity&&(e.velocity=0),(r>150||Su()-t.time>300)&&(e.velocity=0)}else e.velocity=0;e.velocity*=s.freeMode.momentumVelocityRatio,c.velocities.length=0;let t=1e3*s.freeMode.momentumRatio;const n=e.velocity*t;let h=e.translate+n;o&&(h=-h);let u,d=!1;const p=20*Math.abs(e.velocity)*s.freeMode.momentumBounceRatio;let f;if(h<e.maxTranslate())s.freeMode.momentumBounce?(h+e.maxTranslate()<-p&&(h=e.maxTranslate()-p),u=e.maxTranslate(),d=!0,c.allowMomentumBounce=!0):h=e.maxTranslate(),s.loop&&s.centeredSlides&&(f=!0);else if(h>e.minTranslate())s.freeMode.momentumBounce?(h-e.minTranslate()>p&&(h=e.minTranslate()+p),u=e.minTranslate(),d=!0,c.allowMomentumBounce=!0):h=e.minTranslate(),s.loop&&s.centeredSlides&&(f=!0);else if(s.freeMode.sticky){let t;for(let e=0;e<l.length;e+=1)if(l[e]>-h){t=e;break}h=Math.abs(l[t]-h)<Math.abs(l[t-1]-h)||"next"===e.swipeDirection?l[t]:l[t-1],h=-h}if(f&&r("transitionEnd",(()=>{e.loopFix()})),0!==e.velocity){if(t=o?Math.abs((-h-e.translate)/e.velocity):Math.abs((h-e.translate)/e.velocity),s.freeMode.sticky){const n=Math.abs((o?-h:h)-e.translate),i=e.slidesSizesGrid[e.activeIndex];t=n<i?s.speed:n<2*i?1.5*s.speed:2.5*s.speed}}else if(s.freeMode.sticky)return void e.slideToClosest();s.freeMode.momentumBounce&&d?(e.updateProgress(u),e.setTransition(t),e.setTranslate(h),e.transitionStart(!0,e.swipeDirection),e.animating=!0,Nu(a,(()=>{e&&!e.destroyed&&c.allowMomentumBounce&&(i("momentumBounce"),e.setTransition(s.speed),setTimeout((()=>{e.setTranslate(u),Nu(a,(()=>{e&&!e.destroyed&&e.transitionEnd()}))}),0))}))):e.velocity?(i("_freeModeNoMomentumRelease"),e.updateProgress(h),e.setTransition(t),e.setTranslate(h),e.transitionStart(!0,e.swipeDirection),e.animating||(e.animating=!0,Nu(a,(()=>{e&&!e.destroyed&&e.transitionEnd()})))):e.updateProgress(h),e.updateActiveIndex(),e.updateSlidesClasses()}else{if(s.freeMode.sticky)return void e.slideToClosest();s.freeMode&&i("_freeModeNoMomentumRelease")}(!s.freeMode.momentum||h>=s.longSwipesMs)&&(i("_freeModeStaticRelease"),e.updateProgress(),e.updateActiveIndex(),e.updateSlidesClasses())}}}})},function(t){let{swiper:e,extendParams:n,on:i,emit:r}=t;const s=_u();let a;n({mousewheel:{enabled:!1,releaseOnEdges:!1,invert:!1,forceToAxis:!1,sensitivity:1,eventsTarget:"container",thresholdDelta:null,thresholdTime:null,noMousewheelClass:"swiper-no-mousewheel"}}),e.mousewheel={enabled:!1};let o,l=Su();const c=[];function h(){e.enabled&&(e.mouseEntered=!0)}function u(){e.enabled&&(e.mouseEntered=!1)}function d(t){return!(e.params.mousewheel.thresholdDelta&&t.delta<e.params.mousewheel.thresholdDelta)&&(!(e.params.mousewheel.thresholdTime&&Su()-l<e.params.mousewheel.thresholdTime)&&(t.delta>=6&&Su()-l<60||(t.direction<0?e.isEnd&&!e.params.loop||e.animating||(e.slideNext(),r("scroll",t.raw)):e.isBeginning&&!e.params.loop||e.animating||(e.slidePrev(),r("scroll",t.raw)),l=(new s.Date).getTime(),!1)))}function p(t){let n=t,i=!0;if(!e.enabled)return;if(t.target.closest(`.${e.params.mousewheel.noMousewheelClass}`))return;const s=e.params.mousewheel;e.params.cssMode&&n.preventDefault();let l=e.el;"container"!==e.params.mousewheel.eventsTarget&&(l=document.querySelector(e.params.mousewheel.eventsTarget));const h=l&&l.contains(n.target);if(!e.mouseEntered&&!h&&!s.releaseOnEdges)return!0;n.originalEvent&&(n=n.originalEvent);let u=0;const p=e.rtlTranslate?-1:1,f=function(t){let e=0,n=0,i=0,r=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),i=10*e,r=10*n,"deltaY"in t&&(r=t.deltaY),"deltaX"in t&&(i=t.deltaX),t.shiftKey&&!i&&(i=r,r=0),(i||r)&&t.deltaMode&&(1===t.deltaMode?(i*=40,r*=40):(i*=800,r*=800)),i&&!e&&(e=i<1?-1:1),r&&!n&&(n=r<1?-1:1),{spinX:e,spinY:n,pixelX:i,pixelY:r}}(n);if(s.forceToAxis)if(e.isHorizontal()){if(!(Math.abs(f.pixelX)>Math.abs(f.pixelY)))return!0;u=-f.pixelX*p}else{if(!(Math.abs(f.pixelY)>Math.abs(f.pixelX)))return!0;u=-f.pixelY}else u=Math.abs(f.pixelX)>Math.abs(f.pixelY)?-f.pixelX*p:-f.pixelY;if(0===u)return!0;s.invert&&(u=-u);let m=e.getTranslate()+u*s.sensitivity;if(m>=e.minTranslate()&&(m=e.minTranslate()),m<=e.maxTranslate()&&(m=e.maxTranslate()),i=!!e.params.loop||!(m===e.minTranslate()||m===e.maxTranslate()),i&&e.params.nested&&n.stopPropagation(),e.params.freeMode&&e.params.freeMode.enabled){const t={time:Su(),delta:Math.abs(u),direction:Math.sign(u)},i=o&&t.time<o.time+500&&t.delta<=o.delta&&t.direction===o.direction;if(!i){o=void 0;let l=e.getTranslate()+u*s.sensitivity;const h=e.isBeginning,d=e.isEnd;if(l>=e.minTranslate()&&(l=e.minTranslate()),l<=e.maxTranslate()&&(l=e.maxTranslate()),e.setTransition(0),e.setTranslate(l),e.updateProgress(),e.updateActiveIndex(),e.updateSlidesClasses(),(!h&&e.isBeginning||!d&&e.isEnd)&&e.updateSlidesClasses(),e.params.loop&&e.loopFix({direction:t.direction<0?"next":"prev",byMousewheel:!0}),e.params.freeMode.sticky){clearTimeout(a),a=void 0,c.length>=15&&c.shift();const n=c.length?c[c.length-1]:void 0,i=c[0];if(c.push(t),n&&(t.delta>n.delta||t.direction!==n.direction))c.splice(0);else if(c.length>=15&&t.time-i.time<500&&i.delta-t.delta>=1&&t.delta<=6){const n=u>0?.8:.2;o=t,c.splice(0),a=wu((()=>{e.slideToClosest(e.params.speed,!0,void 0,n)}),0)}a||(a=wu((()=>{o=t,c.splice(0),e.slideToClosest(e.params.speed,!0,void 0,.5)}),500))}if(i||r("scroll",n),e.params.autoplay&&e.params.autoplayDisableOnInteraction&&e.autoplay.stop(),s.releaseOnEdges&&(l===e.minTranslate()||l===e.maxTranslate()))return!0}}else{const n={time:Su(),delta:Math.abs(u),direction:Math.sign(u),raw:t};c.length>=2&&c.shift();const i=c.length?c[c.length-1]:void 0;if(c.push(n),i?(n.direction!==i.direction||n.delta>i.delta||n.time>i.time+150)&&d(n):d(n),function(t){const n=e.params.mousewheel;if(t.direction<0){if(e.isEnd&&!e.params.loop&&n.releaseOnEdges)return!0}else if(e.isBeginning&&!e.params.loop&&n.releaseOnEdges)return!0;return!1}(n))return!0}return n.preventDefault?n.preventDefault():n.returnValue=!1,!1}function f(t){let n=e.el;"container"!==e.params.mousewheel.eventsTarget&&(n=document.querySelector(e.params.mousewheel.eventsTarget)),n[t]("mouseenter",h),n[t]("mouseleave",u),n[t]("wheel",p)}function m(){return e.params.cssMode?(e.wrapperEl.removeEventListener("wheel",p),!0):!e.mousewheel.enabled&&(f("addEventListener"),e.mousewheel.enabled=!0,!0)}function g(){return e.params.cssMode?(e.wrapperEl.addEventListener(event,p),!0):!!e.mousewheel.enabled&&(f("removeEventListener"),e.mousewheel.enabled=!1,!0)}i("init",(()=>{!e.params.mousewheel.enabled&&e.params.cssMode&&g(),e.params.mousewheel.enabled&&m()})),i("destroy",(()=>{e.params.cssMode&&m(),e.mousewheel.enabled&&g()})),Object.assign(e.mousewheel,{enable:m,disable:g})},function(t){let{swiper:e,extendParams:n,on:i}=t;n({creativeEffect:{limitProgress:1,shadowPerProgress:!1,progressMultiplier:1,perspective:!0,prev:{translate:[0,0,0],rotate:[0,0,0],opacity:1,scale:1},next:{translate:[0,0,0],rotate:[0,0,0],opacity:1,scale:1}}});const r=t=>"string"==typeof t?t:`${t}px`;wd({effect:"creative",swiper:e,on:i,setTranslate:()=>{const{slides:t,wrapperEl:n,slidesSizesGrid:i}=e,s=e.params.creativeEffect,{progressMultiplier:a}=s,o=e.params.centeredSlides,l=function(t){return e=>Math.abs(e)>0&&t.browser&&t.browser.need3dFix&&Math.abs(e)%90==0?e+.001:e}(e);if(o){const t=i[0]/2-e.params.slidesOffsetBefore||0;n.style.transform=`translateX(calc(50% - ${t}px))`}for(let n=0;n<t.length;n+=1){const i=t[n],c=i.progress,h=Math.min(Math.max(i.progress,-s.limitProgress),s.limitProgress);let u=h;o||(u=Math.min(Math.max(i.originalProgress,-s.limitProgress),s.limitProgress));const d=i.swiperSlideOffset,p=[e.params.cssMode?-d-e.translate:-d,0,0],f=[0,0,0];let m=!1;e.isHorizontal()||(p[1]=p[0],p[0]=0);let g={translate:[0,0,0],rotate:[0,0,0],scale:1,opacity:1};h<0?(g=s.next,m=!0):h>0&&(g=s.prev,m=!0),p.forEach(((t,e)=>{p[e]=`calc(${t}px + (${r(g.translate[e])} * ${Math.abs(h*a)}))`})),f.forEach(((t,e)=>{let n=g.rotate[e]*Math.abs(h*a);f[e]=n})),i.style.zIndex=-Math.abs(Math.round(c))+t.length;const v=p.join(", "),y=`rotateX(${l(f[0])}deg) rotateY(${l(f[1])}deg) rotateZ(${l(f[2])}deg)`,x=u<0?`scale(${1+(1-g.scale)*u*a})`:`scale(${1-(1-g.scale)*u*a})`,b=u<0?1+(1-g.opacity)*u*a:1-(1-g.opacity)*u*a,_=`translate3d(${v}) ${y} ${x}`;if(m&&g.shadow||!m){let t=i.querySelector(".swiper-slide-shadow");if(!t&&g.shadow&&(t=Td("creative",i)),t){const e=s.shadowPerProgress?h*(1/s.limitProgress):h;t.style.opacity=Math.min(Math.max(Math.abs(e),0),1)}}const w=Sd(0,i);w.style.transform=_,w.style.opacity=b,g.origin&&(w.style.transformOrigin=g.origin)}},setTransition:t=>{const n=e.slides.map((t=>Pu(t)));n.forEach((e=>{e.style.transitionDuration=`${t}ms`,e.querySelectorAll(".swiper-slide-shadow").forEach((e=>{e.style.transitionDuration=`${t}ms`}))})),Md({swiper:e,duration:t,transformElements:n,allSlides:!0})},perspective:()=>e.params.creativeEffect.perspective,overwriteParams:()=>({watchSlidesProgress:!0,virtualTranslate:!e.params.cssMode})})},function(t){let{swiper:e,extendParams:n,on:i}=t;n({cardsEffect:{slideShadows:!0,rotate:!0,perSlideRotate:2,perSlideOffset:8}}),wd({effect:"cards",swiper:e,on:i,setTranslate:()=>{const{slides:t,activeIndex:n,rtlTranslate:i}=e,r=e.params.cardsEffect,{startTranslate:s,isTouched:a}=e.touchEventsData,o=i?-e.translate:e.translate;for(let l=0;l<t.length;l+=1){const c=t[l],h=c.progress,u=Math.min(Math.max(h,-4),4);let d=c.swiperSlideOffset;e.params.centeredSlides&&!e.params.cssMode&&(e.wrapperEl.style.transform=`translateX(${e.minTranslate()}px)`),e.params.centeredSlides&&e.params.cssMode&&(d-=t[0].swiperSlideOffset);let p=e.params.cssMode?-d-e.translate:-d,f=0;const m=-100*Math.abs(u);let g=1,v=-r.perSlideRotate*u,y=r.perSlideOffset-.75*Math.abs(u);const x=e.virtual&&e.params.virtual.enabled?e.virtual.from+l:l,b=(x===n||x===n-1)&&u>0&&u<1&&(a||e.params.cssMode)&&o<s,_=(x===n||x===n+1)&&u<0&&u>-1&&(a||e.params.cssMode)&&o>s;if(b||_){const t=(1-Math.abs((Math.abs(u)-.5)/.5))**.5;v+=-28*u*t,g+=-.5*t,y+=96*t,f=-25*t*Math.abs(u)+"%"}if(p=u<0?`calc(${p}px ${i?"-":"+"} (${y*Math.abs(u)}%))`:u>0?`calc(${p}px ${i?"-":"+"} (-${y*Math.abs(u)}%))`:`${p}px`,!e.isHorizontal()){const t=f;f=p,p=t}const w=u<0?""+(1+(1-g)*u):""+(1-(1-g)*u),S=`\n        translate3d(${p}, ${f}, ${m}px)\n        rotateZ(${r.rotate?i?-v:v:0}deg)\n        scale(${w})\n      `;if(r.slideShadows){let t=c.querySelector(".swiper-slide-shadow");t||(t=Td("cards",c)),t&&(t.style.opacity=Math.min(Math.max((Math.abs(u)-.5)/.5,0),1))}c.style.zIndex=-Math.abs(Math.round(h))+t.length;Sd(0,c).style.transform=S}},setTransition:t=>{const n=e.slides.map((t=>Pu(t)));n.forEach((e=>{e.style.transitionDuration=`${t}ms`,e.querySelectorAll(".swiper-slide-shadow").forEach((e=>{e.style.transitionDuration=`${t}ms`}))})),Md({swiper:e,duration:t,transformElements:n})},perspective:()=>!0,overwriteParams:()=>({watchSlidesProgress:!0,virtualTranslate:!e.params.cssMode})})}]),window.Swiper=xd,nr.registerPlugin(lo),window.gsap=nr,window.ScrollTrigger=lo,pu.store("select",{test:!0}),document.addEventListener("alpine:init",(()=>{function t(t){return t=(t=(t=t.replace(/\s+/g," ")).replace(/\n/g,"<br>")).replace(/(['"\\])/g,"\\$1")}pu.store("showIsland",!0),pu.store("showSiteTitle",!0),pu.store("showFloatingWorld",!1),pu.store("scrollViewport",(function(){window.scrollTo({top:window.scrollY+window.innerHeight,behavior:"smooth"})})),pu.store("scroll",(function(t){window.scrollTo({top:window.scrollY+t,behavior:"smooth"})})),pu.store("distanceToBottom",(function(t){const e=t.getBoundingClientRect(),n=window.scrollY||window.pageYOffset;return e.bottom+n-window.innerHeight-n})),pu.store("showreelMuted",!0),pu.data("staggeredText",((e,n=10,i=.01)=>({text:t(e),wordsArray:[],initialized:!1,init(){this.observeVisibility()},observeVisibility(){const t=this,e=this.$el;lo.create({trigger:e,start:"top bottom+=200",onEnter:()=>{t.initialized||(t.initialize(),t.initialized=!0)}})},initialize(){e.split(" ").forEach((t=>{var e=t.split("");this.wordsArray.push([...e,"&nbsp;"])}));var t=this;this.$nextTick((function(){t.$el.style.visibility="visible",nr.from($(t.$el).find(".letter"),{duration:1,y:"1em",opacity:0,rotation:n+"deg",ease:"expo.out",scrollTrigger:{trigger:$(t.$el),pin:!1,start:"top bottom-=100",onLeave:function(){t.output='<span class="inline-block letter">'+e+"</span>"}},stagger:i})}))},output:'\n      <template x-for="(word, index) in wordsArray">\n        <div class="inline-block overflow-hidden align-top">\n          <template x-for="letter in word">\n            <span class="inline-block letter will-change-transform" x-html="letter"></span>\n          </template>\n        </div>\n      </template>\n    '}))),pu.data("staggeredTextWord",((e,n=0,i=.01)=>({text:t(e),wordsArray:[],paragraphsArray:[],initialized:!1,init(){this.observeVisibility()},observeVisibility(){const t=this,e=this.$el;lo.create({trigger:e,start:"top bottom+=200",onEnter:()=>{t.initialized||(t.initialize(),t.initialized=!0)}})},initialize(){(e=e.replace(/<br \/> /g,"<br>")).split("<br>").forEach(((t,e)=>{var n=t.split(" ");n.forEach(((t,i)=>{Array.isArray(this.paragraphsArray[e])||(this.paragraphsArray[e]=[]),this.paragraphsArray[e].push(t),i<n.length-1&&this.paragraphsArray[e].push("&nbsp;")}))}));var t=this;this.$nextTick((function(){t.$el.style.visibility="visible",nr.from($(t.$el).find(".word"),{duration:1,y:"2em",opacity:0,rotation:n+"deg",ease:"expo.out",scrollTrigger:{trigger:$(t.$el),pin:!1,start:"top bottom-=100",onLeave:function(){t.output='<span class="inline-block letter">'+e+"</span>"}},stagger:i})}))},output:'\n      <template x-for="(paragraph) in paragraphsArray">\n        <div>\n          <template x-for="(word, index) in paragraph">\n            <div class="inline-block overflow-hidden align-top">\n              <span class="inline-block word will-change-transform" x-html="word"></span>\n            </div>\n          </template>\n        </div>\n      </template>\n    '}))),pu.data("typingText",((e,n=500)=>({text:t(e),wordsArray:[],initialized:!1,finalHeight:0,init(){this.observeElement()},observeElement(){const t=new MutationObserver((()=>{this.$el.offsetWidth>0&&(this.calculateHeight(),this.observeVisibility(),t.disconnect())}));t.observe(this.$el,{attributes:!0,childList:!0,subtree:!0})},calculateHeight(){const t=document.createElement("div");t.style.position="absolute",t.style.visibility="hidden",t.style.whiteSpace="normal",t.style.width=this.$el.offsetWidth+"px",t.className=this.$el.className,t.style.fontSize=window.getComputedStyle(this.$el).fontSize,t.innerHTML=this.text,document.body.appendChild(t),this.finalHeight=t.offsetHeight,document.body.removeChild(t)},observeVisibility(){const t=this,e=this.$el;lo.create({trigger:e,start:"top bottom+=200",onEnter:()=>{t.initialized||setTimeout((()=>{t.initialize(),t.initialized=!0}),n)}})},initialize(){var t=e.split(" ");t.forEach(((e,n)=>{let i=e.split("");n<t.length-1&&i.push("&nbsp;"),i.forEach(((t,e)=>{if(this.char=t,this.wordsArray[n]||(this.wordsArray[n]=[]),"&nbsp;"===t)this.wordsArray[n][e]="&nbsp;";else if(/[a-zA-Z]/.test(t)){let r=0;this.wordsArray[n][e]=this.getRandomLetter(t);const s=setInterval((()=>{r<10?(this.wordsArray[n][e]=this.getRandomLetter(t),r++):(clearInterval(s),this.wordsArray[n][e]=i[e]),this.$nextTick((()=>{this.$el.querySelectorAll(".letter").forEach((t=>{t.style.visibility="visible"}))}))}),50)}else this.wordsArray[n][e]=t}))}))},getRandomLetter(t){const e=t===t.toLowerCase()?"abcdefghijklmnopqrstuvwxyz":"ABCDEFGHIJKLMNOPQRSTUVWXYZ";return e.charAt(Math.floor(Math.random()*e.length))},output:'\n      <div class="typing-container" :style="{ height: finalHeight + \'px\' }">\n        <template x-for="(word, index) in wordsArray">\n          <div class="inline-block overflow-hidden align-top">\n            <template x-for="letter in word">\n              <span class="inline-block letter will-change-transform" x-html="letter"></span>\n            </template>\n          </div>\n        </template>\n      </div>\n    '}))),pu.data("workCard",(t=>({size:"small_card",init(){[1,3,5,8,11].includes(t%13)&&(this.size="medium_card"),[2,7,12].includes(t%13)&&(this.size="large_card"),window.matchMedia(`(min-width: ${Ed}px)`).matches?this.$nextTick((()=>{let t=this.$el.querySelector(".media-wrapper"),e=this.$el.querySelector(".media-wrapper img, .media-wrapper video");if(e){let n,i,r,s=.02,a={x:.5,y:.5},o={x:.5,y:.5},l=0,c={x:.5,y:.5};n=new f_,n.background=new pv(0),i=new By(-50,50,50,-50,.1,1e3),i.position.z=1;const h="\n                varying vec2 vUv;\n                void main() {\n                  vUv = uv;\n                  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                }\n            ",u="\n                varying vec2 vUv;\n                uniform sampler2D u_texture;    \n                uniform vec2 u_mouse;\n                uniform vec2 u_prevMouse;\n                uniform float u_aberrationIntensity;\n\n                void main() {\n                  // Use higher resolution grid for better quality\n                  vec2 gridUV = floor(vUv * vec2(800.0, 800.0)) / vec2(800.0, 800.0);\n                  vec2 centerOfPixel = gridUV + vec2(1.0/800.0, 1.0/800.0);\n\n                  vec2 mouseDirection = u_mouse - u_prevMouse;\n                  \n                  vec2 pixelToMouseDirection = centerOfPixel - u_mouse;\n                  float pixelDistanceToMouse = length(pixelToMouseDirection);\n                  float strength = smoothstep(0.2, 0.0, pixelDistanceToMouse);\n          \n                  vec2 uvOffset = strength * - mouseDirection * 0.2;\n                  vec2 uv = vUv - uvOffset;\n\n                  // Use texture2D with proper filtering\n                  vec4 colorR = texture2D(u_texture, uv);\n                  vec4 colorG = texture2D(u_texture, uv);\n                  vec4 colorB = texture2D(u_texture, uv);\n\n                  gl_FragColor = vec4(colorR.r, colorG.g, colorB.b, 1.0);\n                }\n            ";let d,p;if("VIDEO"===e.tagName)e.muted=!0,e.playsInline=!0,e.loop=!0,e.addEventListener("loadedmetadata",(()=>{try{p=e.videoWidth/e.videoHeight,d=new W_(e),d.minFilter=Tp,d.magFilter=Tp,d.format=Vp,d.anisotropy=16,d.generateMipmaps=!0,d.addEventListener("error",(()=>{f(this)})),m(this)}catch(t){f(this)}})),e.readyState>=2&&e.dispatchEvent(new Event("loadedmetadata"));else try{const b=e.dataset.src||e.src,_=this;if(e.classList.contains("lazyload")){const S=new MutationObserver((t=>{t.forEach((t=>{"attributes"===t.type&&"class"===t.attributeName&&e.classList.contains("lazyloaded")&&(S.disconnect(),w())}))}));S.observe(e,{attributes:!0})}else w();function w(){d=(new SS).load(b,(t=>{t.anisotropy=16,t.generateMipmaps=!0,t.minFilter=Tp,t.magFilter=Tp,m(_)}),void 0,(()=>{f(_)}))}}catch(M){f(this)}function f(t){t.renderer&&t.destroyCanvas(),nr.to(t.$refs.mediaOverlay,{opacity:0,duration:1.5,ease:"expo.inOut"})}function m(i){try{let s,a={u_mouse:{type:"v2",value:new ym},u_prevMouse:{type:"v2",value:new ym},u_aberrationIntensity:{type:"f",value:0},u_texture:{type:"t",value:d}};r=new ty(new Ey(100,100),new oy({uniforms:a,vertexShader:h,fragmentShader:u})),p="VIDEO"===e.tagName?e.videoWidth/e.videoHeight:e.naturalWidth/e.naturalHeight,s=t.offsetWidth/t.offsetHeight,p>s?r.scale.set(p/s,1,1):r.scale.set(1,s/p,1);const o=window.devicePixelRatio||1;i.renderer=new d_({antialias:!0,powerPreference:"high-performance"}),i.renderer.setPixelRatio(o),i.renderer.setSize(e.offsetWidth,e.offsetHeight),n.add(r),g(i),$(i.renderer.domElement).addClass("absolute top-0 left-0 z-10 hover:scale-105 transition-transform duration-700 ease-out"),t.appendChild(i.renderer.domElement),nr.to(i.$refs.mediaOverlay,{opacity:0,duration:1.5,ease:"expo.inOut"})}catch(t){f(i)}}function g(t){t.animationId=requestAnimationFrame((()=>g(t))),a.x+=(o.x-a.x)*s,a.y+=(o.y-a.y)*s,r.material.uniforms.u_mouse.value.set(a.x,1-a.y),r.material.uniforms.u_prevMouse.value.set(c.x,1-c.y),l=Math.max(0,l-.05),r.material.uniforms.u_aberrationIntensity.value=l,i.aspect=e.offsetWidth/e.offsetHeight,i.updateProjectionMatrix(),t.renderer.setSize(e.offsetWidth,e.offsetHeight),t.renderer.render(n,i)}function v(e){s=.02;let n=t.getBoundingClientRect();c={...o},o.x=(e.clientX-n.left)/n.width,o.y=(e.clientY-n.top)/n.height,l=1}function y(e){s=.02;let n=t.getBoundingClientRect();a.x=o.x=(e.clientX-n.left)/n.width,a.y=o.y=(e.clientY-n.top)/n.height}function x(){s=.05,o={...c}}t.addEventListener("mousemove",v),t.addEventListener("mouseenter",y),t.addEventListener("mouseleave",x)}else nr.to(this.$refs.mediaOverlay,{opacity:0,duration:1.5,ease:"expo.inOut"})})):this.$nextTick((()=>{nr.to(this.$refs.mediaOverlay,{opacity:0,duration:1.5,ease:"expo.inOut"})}))},renderer:null,animationId:null,destroyCanvas(){this.animationId&&cancelAnimationFrame(this.animationId),this.renderer&&(this.renderer.dispose(),this.renderer.domElement&&this.renderer.domElement.parentNode&&this.renderer.domElement.parentNode.removeChild(this.renderer.domElement),this.renderer.forceContextLoss&&this.renderer.forceContextLoss(),this.renderer=null)}})))})),pu.start();const bM={type:"change"},_M={type:"start"},wM={type:"end"},SM=new Sg,MM=new by,TM=Math.cos(70*vm.DEG2RAD);class EM extends am{constructor(t,e){super(),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new $m,this.cursor=new $m,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Rd.ROTATE,MIDDLE:Rd.DOLLY,RIGHT:Rd.PAN},this.touches={ONE:Od.ROTATE,TWO:Od.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",Y),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Y),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(bM),n.update(),r=i.NONE},this.update=function(){const e=new $m,h=(new Xm).setFromUnitVectors(t.up,new $m(0,1,0)),u=h.clone().invert(),d=new $m,p=new Xm,f=new $m,m=2*Math.PI;return function(g=null){const v=n.object.position;e.copy(v).sub(n.target),e.applyQuaternion(h),a.setFromVector3(e),n.autoRotate&&r===i.NONE&&E(function(t){return null!==t?2*Math.PI/60*n.autoRotateSpeed*t:2*Math.PI/60/60*n.autoRotateSpeed}(g)),n.enableDamping?(a.theta+=o.theta*n.dampingFactor,a.phi+=o.phi*n.dampingFactor):(a.theta+=o.theta,a.phi+=o.phi);let y=n.minAzimuthAngle,w=n.maxAzimuthAngle;isFinite(y)&&isFinite(w)&&(y<-Math.PI?y+=m:y>Math.PI&&(y-=m),w<-Math.PI?w+=m:w>Math.PI&&(w-=m),a.theta=y<=w?Math.max(y,Math.min(w,a.theta)):a.theta>(y+w)/2?Math.max(y,a.theta):Math.min(w,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(c,n.dampingFactor):n.target.add(c),n.target.sub(n.cursor),n.target.clampLength(n.minTargetRadius,n.maxTargetRadius),n.target.add(n.cursor);let S=!1;if(n.zoomToCursor&&_||n.object.isOrthographicCamera)a.radius=I(a.radius);else{const t=a.radius;a.radius=I(a.radius*l),S=t!=a.radius}if(e.setFromSpherical(a),e.applyQuaternion(u),v.copy(n.target).add(e),n.object.lookAt(n.target),!0===n.enableDamping?(o.theta*=1-n.dampingFactor,o.phi*=1-n.dampingFactor,c.multiplyScalar(1-n.dampingFactor)):(o.set(0,0,0),c.set(0,0,0)),n.zoomToCursor&&_){let i=null;if(n.object.isPerspectiveCamera){const t=e.length();i=I(t*l);const r=t-i;n.object.position.addScaledVector(x,r),n.object.updateMatrixWorld(),S=!!r}else if(n.object.isOrthographicCamera){const t=new $m(b.x,b.y,0);t.unproject(n.object);const r=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),n.object.updateProjectionMatrix(),S=r!==n.object.zoom;const s=new $m(b.x,b.y,0);s.unproject(n.object),n.object.position.sub(s).add(t),n.object.updateMatrixWorld(),i=e.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;null!==i&&(this.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(i).add(n.object.position):(SM.origin.copy(n.object.position),SM.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(SM.direction))<TM?t.lookAt(n.target):(MM.setFromNormalAndCoplanarPoint(n.object.up,n.target),SM.intersectPlane(MM,n.target))))}else if(n.object.isOrthographicCamera){const t=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/l)),t!==n.object.zoom&&(n.object.updateProjectionMatrix(),S=!0)}return l=1,_=!1,!!(S||d.distanceToSquared(n.object.position)>s||8*(1-p.dot(n.object.quaternion))>s||f.distanceToSquared(n.target)>s)&&(n.dispatchEvent(bM),d.copy(n.object.position),p.copy(n.object.quaternion),f.copy(n.target),!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",K),n.domElement.removeEventListener("pointerdown",H),n.domElement.removeEventListener("pointercancel",W),n.domElement.removeEventListener("wheel",q),n.domElement.removeEventListener("pointermove",G),n.domElement.removeEventListener("pointerup",W);n.domElement.getRootNode().removeEventListener("keydown",X,{capture:!0}),null!==n._domElementKeyEvents&&(n._domElementKeyEvents.removeEventListener("keydown",Y),n._domElementKeyEvents=null)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=i.NONE;const s=1e-6,a=new QS,o=new QS;let l=1;const c=new $m,h=new ym,u=new ym,d=new ym,p=new ym,f=new ym,m=new ym,g=new ym,v=new ym,y=new ym,x=new $m,b=new ym;let _=!1;const w=[],S={};let M=!1;function T(t){const e=Math.abs(.01*t);return Math.pow(.95,n.zoomSpeed*e)}function E(t){o.theta-=t}function A(t){o.phi-=t}const C=function(){const t=new $m;return function(e,n){t.setFromMatrixColumn(n,0),t.multiplyScalar(-e),c.add(t)}}(),P=function(){const t=new $m;return function(e,i){!0===n.screenSpacePanning?t.setFromMatrixColumn(i,1):(t.setFromMatrixColumn(i,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(e),c.add(t)}}(),R=function(){const t=new $m;return function(e,i){const r=n.domElement;if(n.object.isPerspectiveCamera){const s=n.object.position;t.copy(s).sub(n.target);let a=t.length();a*=Math.tan(n.object.fov/2*Math.PI/180),C(2*e*a/r.clientHeight,n.object.matrix),P(2*i*a/r.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(C(e*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),P(i*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function O(t){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function D(t){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?l*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function L(t,e){if(!n.zoomToCursor)return;_=!0;const i=n.domElement.getBoundingClientRect(),r=t-i.left,s=e-i.top,a=i.width,o=i.height;b.x=r/a*2-1,b.y=-s/o*2+1,x.set(b.x,b.y,1).unproject(n.object).sub(n.object.position).normalize()}function I(t){return Math.max(n.minDistance,Math.min(n.maxDistance,t))}function z(t){h.set(t.clientX,t.clientY)}function N(t){p.set(t.clientX,t.clientY)}function U(t){if(1===w.length)h.set(t.pageX,t.pageY);else{const e=Q(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);h.set(n,i)}}function k(t){if(1===w.length)p.set(t.pageX,t.pageY);else{const e=Q(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);p.set(n,i)}}function B(t){const e=Q(t),n=t.pageX-e.x,i=t.pageY-e.y,r=Math.sqrt(n*n+i*i);g.set(0,r)}function F(t){if(1==w.length)u.set(t.pageX,t.pageY);else{const e=Q(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);u.set(n,i)}d.subVectors(u,h).multiplyScalar(n.rotateSpeed);const e=n.domElement;E(2*Math.PI*d.x/e.clientHeight),A(2*Math.PI*d.y/e.clientHeight),h.copy(u)}function V(t){if(1===w.length)f.set(t.pageX,t.pageY);else{const e=Q(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);f.set(n,i)}m.subVectors(f,p).multiplyScalar(n.panSpeed),R(m.x,m.y),p.copy(f)}function j(t){const e=Q(t),i=t.pageX-e.x,r=t.pageY-e.y,s=Math.sqrt(i*i+r*r);v.set(0,s),y.set(0,Math.pow(v.y/g.y,n.zoomSpeed)),O(y.y),g.copy(v);L(.5*(t.pageX+e.x),.5*(t.pageY+e.y))}function H(t){!1!==n.enabled&&(0===w.length&&(n.domElement.setPointerCapture(t.pointerId),n.domElement.addEventListener("pointermove",G),n.domElement.addEventListener("pointerup",W)),function(t){for(let e=0;e<w.length;e++)if(w[e]==t.pointerId)return!0;return!1}(t)||(function(t){w.push(t.pointerId)}(t),"touch"===t.pointerType?Z(t):function(t){let e;switch(t.button){case 0:e=n.mouseButtons.LEFT;break;case 1:e=n.mouseButtons.MIDDLE;break;case 2:e=n.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Rd.DOLLY:if(!1===n.enableZoom)return;!function(t){L(t.clientX,t.clientX),g.set(t.clientX,t.clientY)}(t),r=i.DOLLY;break;case Rd.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;N(t),r=i.PAN}else{if(!1===n.enableRotate)return;z(t),r=i.ROTATE}break;case Rd.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;z(t),r=i.ROTATE}else{if(!1===n.enablePan)return;N(t),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(_M)}(t)))}function G(t){!1!==n.enabled&&("touch"===t.pointerType?function(t){switch(J(t),r){case i.TOUCH_ROTATE:if(!1===n.enableRotate)return;F(t),n.update();break;case i.TOUCH_PAN:if(!1===n.enablePan)return;V(t),n.update();break;case i.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(t){n.enableZoom&&j(t),n.enablePan&&V(t)}(t),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(t){n.enableZoom&&j(t),n.enableRotate&&F(t)}(t),n.update();break;default:r=i.NONE}}(t):function(t){switch(r){case i.ROTATE:if(!1===n.enableRotate)return;!function(t){u.set(t.clientX,t.clientY),d.subVectors(u,h).multiplyScalar(n.rotateSpeed);const e=n.domElement;E(2*Math.PI*d.x/e.clientHeight),A(2*Math.PI*d.y/e.clientHeight),h.copy(u),n.update()}(t);break;case i.DOLLY:if(!1===n.enableZoom)return;!function(t){v.set(t.clientX,t.clientY),y.subVectors(v,g),y.y>0?O(T(y.y)):y.y<0&&D(T(y.y)),g.copy(v),n.update()}(t);break;case i.PAN:if(!1===n.enablePan)return;!function(t){f.set(t.clientX,t.clientY),m.subVectors(f,p).multiplyScalar(n.panSpeed),R(m.x,m.y),p.copy(f),n.update()}(t)}}(t))}function W(t){switch(function(t){delete S[t.pointerId];for(let e=0;e<w.length;e++)if(w[e]==t.pointerId)return void w.splice(e,1)}(t),w.length){case 0:n.domElement.releasePointerCapture(t.pointerId),n.domElement.removeEventListener("pointermove",G),n.domElement.removeEventListener("pointerup",W),n.dispatchEvent(wM),r=i.NONE;break;case 1:const e=w[0],s=S[e];Z({pointerId:e,pageX:s.x,pageY:s.y})}}function q(t){!1!==n.enabled&&!1!==n.enableZoom&&r===i.NONE&&(t.preventDefault(),n.dispatchEvent(_M),function(t){L(t.clientX,t.clientY),t.deltaY<0?D(T(t.deltaY)):t.deltaY>0&&O(T(t.deltaY)),n.update()}(function(t){const e=t.deltaMode,n={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}t.ctrlKey&&!M&&(n.deltaY*=10);return n}(t)),n.dispatchEvent(wM))}function X(t){if("Control"===t.key){M=!0;n.domElement.getRootNode().addEventListener("keyup",$,{passive:!0,capture:!0})}}function $(t){if("Control"===t.key){M=!1;n.domElement.getRootNode().removeEventListener("keyup",$,{passive:!0,capture:!0})}}function Y(t){!1!==n.enabled&&!1!==n.enablePan&&function(t){let e=!1;switch(t.code){case n.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?A(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):R(0,n.keyPanSpeed),e=!0;break;case n.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?A(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):R(0,-n.keyPanSpeed),e=!0;break;case n.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?E(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):R(n.keyPanSpeed,0),e=!0;break;case n.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?E(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):R(-n.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),n.update())}(t)}function Z(t){switch(J(t),w.length){case 1:switch(n.touches.ONE){case Od.ROTATE:if(!1===n.enableRotate)return;U(t),r=i.TOUCH_ROTATE;break;case Od.PAN:if(!1===n.enablePan)return;k(t),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(n.touches.TWO){case Od.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(t){n.enableZoom&&B(t),n.enablePan&&k(t)}(t),r=i.TOUCH_DOLLY_PAN;break;case Od.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(t){n.enableZoom&&B(t),n.enableRotate&&U(t)}(t),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(_M)}function K(t){!1!==n.enabled&&t.preventDefault()}function J(t){let e=S[t.pointerId];void 0===e&&(e=new ym,S[t.pointerId]=e),e.set(t.pageX,t.pageY)}function Q(t){const e=t.pointerId===w[0]?w[1]:w[0];return S[e]}n.domElement.addEventListener("contextmenu",K),n.domElement.addEventListener("pointerdown",H),n.domElement.addEventListener("pointercancel",W),n.domElement.addEventListener("wheel",q,{passive:!1});n.domElement.getRootNode().addEventListener("keydown",X,{passive:!0,capture:!0}),this.update()}}const AM=new By(-1,1,1,-1,0,1);const CM=new class extends Nv{constructor(){super(),this.setAttribute("position",new Cv([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Cv([0,2,0,0,2,0],2))}};class PM{constructor(t){this._mesh=new ty(CM,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,AM)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class RM{constructor(t,e,n){this.variables=[],this.currentTextureIndex=0;let i=Ip;const r={passThruTexture:{value:null}},s=l("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",r),a=new PM(s);function o(n){n.defines.resolution="vec2( "+t.toFixed(1)+", "+e.toFixed(1)+" )"}function l(t,e){const n=new oy({name:"GPUComputationShader",uniforms:e=e||{},vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:t});return o(n),n}this.setDataType=function(t){return i=t,this},this.addVariable=function(t,e,n){const i={name:t,initialValueTexture:n,material:this.createShaderMaterial(e),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:wp,magFilter:wp};return this.variables.push(i),i},this.setVariableDependencies=function(t,e){t.dependencies=e},this.init=function(){if(0===n.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(let n=0;n<this.variables.length;n++){const i=this.variables[n];i.renderTargets[0]=this.createRenderTarget(t,e,i.wrapS,i.wrapT,i.minFilter,i.magFilter),i.renderTargets[1]=this.createRenderTarget(t,e,i.wrapS,i.wrapT,i.minFilter,i.magFilter),this.renderTexture(i.initialValueTexture,i.renderTargets[0]),this.renderTexture(i.initialValueTexture,i.renderTargets[1]);const r=i.material,s=r.uniforms;if(null!==i.dependencies)for(let t=0;t<i.dependencies.length;t++){const e=i.dependencies[t];if(e.name!==i.name){let t=!1;for(let n=0;n<this.variables.length;n++)if(e.name===this.variables[n].name){t=!0;break}if(!t)return"Variable dependency not found. Variable="+i.name+", dependency="+e.name}s[e.name]={value:null},r.fragmentShader="\nuniform sampler2D "+e.name+";\n"+r.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){const t=this.currentTextureIndex,e=0===this.currentTextureIndex?1:0;for(let n=0,i=this.variables.length;n<i;n++){const i=this.variables[n];if(null!==i.dependencies){const e=i.material.uniforms;for(let n=0,r=i.dependencies.length;n<r;n++){const r=i.dependencies[n];e[r.name].value=r.renderTargets[t].texture}}this.doRenderTarget(i.material,i.renderTargets[e])}this.currentTextureIndex=e},this.getCurrentRenderTarget=function(t){return t.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(t){return t.renderTargets[0===this.currentTextureIndex?1:0]},this.dispose=function(){a.dispose();const t=this.variables;for(let e=0;e<t.length;e++){const n=t[e];n.initialValueTexture&&n.initialValueTexture.dispose();const i=n.renderTargets;for(let t=0;t<i.length;t++){i[t].dispose()}}},this.addResolutionDefine=o,this.createShaderMaterial=l,this.createRenderTarget=function(n,r,s,a,o,l){return new Gm(n=n||t,r=r||e,{wrapS:s=s||bp,wrapT:a=a||bp,minFilter:o=o||wp,magFilter:l=l||wp,format:jp,type:i,depthBuffer:!1})},this.createTexture=function(){const n=new Float32Array(t*e*4),i=new x_(n,t,e,jp,Ip);return i.needsUpdate=!0,i},this.renderTexture=function(t,e){r.passThruTexture.value=t,this.doRenderTarget(s,e),r.passThruTexture.value=null},this.doRenderTarget=function(t,e){const i=n.getRenderTarget(),r=n.xr.enabled,o=n.shadowMap.autoUpdate;n.xr.enabled=!1,n.shadowMap.autoUpdate=!1,a.material=t,n.setRenderTarget(e),a.render(n),a.material=s,n.xr.enabled=r,n.shadowMap.autoUpdate=o,n.setRenderTarget(i)}}}const OM=new lv,DM=new $m,LM=new ym,IM=new ym,zM=new ym;class NM{constructor(t){this.geometry=t.geometry,this.randomFunction=Math.random,this.indexAttribute=this.geometry.index,this.positionAttribute=this.geometry.getAttribute("position"),this.normalAttribute=this.geometry.getAttribute("normal"),this.colorAttribute=this.geometry.getAttribute("color"),this.uvAttribute=this.geometry.getAttribute("uv"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(t){return this.weightAttribute=t?this.geometry.getAttribute(t):null,this}build(){const t=this.indexAttribute,e=this.positionAttribute,n=this.weightAttribute,i=t?t.count/3:e.count/3,r=new Float32Array(i);for(let s=0;s<i;s++){let i=1,a=3*s,o=3*s+1,l=3*s+2;t&&(a=t.getX(a),o=t.getX(o),l=t.getX(l)),n&&(i=n.getX(a)+n.getX(o)+n.getX(l)),OM.a.fromBufferAttribute(e,a),OM.b.fromBufferAttribute(e,o),OM.c.fromBufferAttribute(e,l),i*=OM.getArea(),r[s]=i}const s=new Float32Array(i);let a=0;for(let t=0;t<i;t++)a+=r[t],s[t]=a;return this.distribution=s,this}setRandomGenerator(t){return this.randomFunction=t,this}sample(t,e,n,i){const r=this.sampleFaceIndex();return this.sampleFace(r,t,e,n,i)}sampleFaceIndex(){const t=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*t)}binarySearch(t){const e=this.distribution;let n=0,i=e.length-1,r=-1;for(;n<=i;){const s=Math.ceil((n+i)/2);if(0===s||e[s-1]<=t&&e[s]>t){r=s;break}t<e[s]?i=s-1:n=s+1}return r}sampleFace(t,e,n,i,r){let s=this.randomFunction(),a=this.randomFunction();s+a>1&&(s=1-s,a=1-a);const o=this.indexAttribute;let l=3*t,c=3*t+1,h=3*t+2;return o&&(l=o.getX(l),c=o.getX(c),h=o.getX(h)),OM.a.fromBufferAttribute(this.positionAttribute,l),OM.b.fromBufferAttribute(this.positionAttribute,c),OM.c.fromBufferAttribute(this.positionAttribute,h),e.set(0,0,0).addScaledVector(OM.a,s).addScaledVector(OM.b,a).addScaledVector(OM.c,1-(s+a)),void 0!==n&&(void 0!==this.normalAttribute?(OM.a.fromBufferAttribute(this.normalAttribute,l),OM.b.fromBufferAttribute(this.normalAttribute,c),OM.c.fromBufferAttribute(this.normalAttribute,h),n.set(0,0,0).addScaledVector(OM.a,s).addScaledVector(OM.b,a).addScaledVector(OM.c,1-(s+a)).normalize()):OM.getNormal(n)),void 0!==i&&void 0!==this.colorAttribute&&(OM.a.fromBufferAttribute(this.colorAttribute,l),OM.b.fromBufferAttribute(this.colorAttribute,c),OM.c.fromBufferAttribute(this.colorAttribute,h),DM.set(0,0,0).addScaledVector(OM.a,s).addScaledVector(OM.b,a).addScaledVector(OM.c,1-(s+a)),i.r=DM.x,i.g=DM.y,i.b=DM.z),void 0!==r&&void 0!==this.uvAttribute&&(LM.fromBufferAttribute(this.uvAttribute,l),IM.fromBufferAttribute(this.uvAttribute,c),zM.fromBufferAttribute(this.uvAttribute,h),r.set(0,0).addScaledVector(LM,s).addScaledVector(IM,a).addScaledVector(zM,1-(s+a))),this}}const UM=new WeakMap;class kM extends yS{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,n,i){const r=new _S(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,(t=>{this.parse(t,e,i)}),n,i)}parse(t,e,n=(()=>{})){this.decodeDracoFile(t,e,null,null,kf,n).catch(n)}decodeDracoFile(t,e,n,i,r=Bf,s=(()=>{})){const a={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:r};return this.decodeGeometry(t,a).then(e).catch(s)}decodeGeometry(t,e){const n=JSON.stringify(e);if(UM.has(t)){const e=UM.get(t);if(e.key===n)return e.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const r=this.workerNextTaskID++,s=t.byteLength,a=this._getWorker(r,s).then((n=>(i=n,new Promise(((n,s)=>{i._callbacks[r]={resolve:n,reject:s},i.postMessage({type:"decode",id:r,taskConfig:e,buffer:t},[t])}))))).then((t=>this._createGeometry(t.geometry)));return a.catch((()=>!0)).then((()=>{i&&r&&this._releaseTask(i,r)})),UM.set(t,{key:n,promise:a}),a}_createGeometry(t){const e=new Nv;t.index&&e.setIndex(new Tv(t.index.array,1));for(let n=0;n<t.attributes.length;n++){const i=t.attributes[n],r=i.name,s=i.array,a=i.itemSize,o=new Tv(s,a);"color"===r&&(this._assignVertexColorSpace(o,i.vertexColorSpace),o.normalized=s instanceof Float32Array==!1),e.setAttribute(r,o)}return e}_assignVertexColorSpace(t,e){if(e!==kf)return;const n=new pv;for(let e=0,i=t.count;e<i;e++)n.fromBufferAttribute(t,e).convertSRGBToLinear(),t.setXYZ(e,n.r,n.g,n.b)}_loadLibrary(t,e){const n=new _S(this.manager);return n.setPath(this.decoderPath),n.setResponseType(e),n.setWithCredentials(this.withCredentials),new Promise(((e,i)=>{n.load(t,e,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then((e=>{const n=e[0];t||(this.decoderConfig.wasmBinary=e[1]);const i=BM.toString(),r=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending}_getWorker(t,e){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const t=new Worker(this.workerSourceURL);t._callbacks={},t._taskCosts={},t._taskLoad=0,t.postMessage({type:"init",decoderConfig:this.decoderConfig}),t.onmessage=function(e){const n=e.data;switch(n.type){case"decode":t._callbacks[n.id].resolve(n);break;case"error":t._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(t)}else this.workerPool.sort((function(t,e){return t._taskLoad>e._taskLoad?-1:1}));const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[t]=e,n._taskLoad+=e,n}))}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map((t=>t._taskLoad)))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function BM(){let t,e;function n(t,e,n,i,r,s){const a=s.num_components(),o=n.num_points()*a,l=o*r.BYTES_PER_ELEMENT,c=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}(t,r),h=t._malloc(l);e.GetAttributeDataArrayForAllPoints(n,s,c,l,h);const u=new r(t.HEAPF32.buffer,h,o).slice();return t._free(h),{name:i,array:u,itemSize:a}}onmessage=function(i){const r=i.data;switch(r.type){case"init":t=r.decoderConfig,e=new Promise((function(e){t.onModuleLoaded=function(t){e({draco:t})},DracoDecoderModule(t)}));break;case"decode":const i=r.buffer,s=r.taskConfig;e.then((t=>{const e=t.draco,a=new e.Decoder;try{const t=function(t,e,i,r){const s=r.attributeIDs,a=r.attributeTypes;let o,l;const c=e.GetEncodedGeometryType(i);if(c===t.TRIANGULAR_MESH)o=new t.Mesh,l=e.DecodeArrayToMesh(i,i.byteLength,o);else{if(c!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new t.PointCloud,l=e.DecodeArrayToPointCloud(i,i.byteLength,o)}if(!l.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const h={index:null,attributes:[]};for(const i in s){const l=self[a[i]];let c,u;if(r.useUniqueIDs)u=s[i],c=e.GetAttributeByUniqueId(o,u);else{if(u=e.GetAttributeId(o,t[s[i]]),-1===u)continue;c=e.GetAttribute(o,u)}const d=n(t,e,o,i,l,c);"color"===i&&(d.vertexColorSpace=r.vertexColorSpace),h.attributes.push(d)}c===t.TRIANGULAR_MESH&&(h.index=function(t,e,n){const i=n.num_faces(),r=3*i,s=4*r,a=t._malloc(s);e.GetTrianglesUInt32Array(n,s,a);const o=new Uint32Array(t.HEAPF32.buffer,a,r).slice();return t._free(a),{array:o,itemSize:1}}(t,e,o));return t.destroy(o),h}(e,a,new Int8Array(i),s),o=t.attributes.map((t=>t.array.buffer));t.index&&o.push(t.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:t},o)}catch(t){console.error(t),self.postMessage({type:"error",id:r.id,error:t.message})}finally{e.destroy(a)}}))}}}var FM=Object.create,VM=Object.defineProperty,jM=Object.getOwnPropertyDescriptor,HM=Object.getOwnPropertyNames,GM=Object.getPrototypeOf,WM=Object.prototype.hasOwnProperty,qM=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),XM=(t,e,n)=>(n=null!=t?FM(GM(t)):{},((t,e,n,i)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let r of HM(e))!WM.call(t,r)&&r!==n&&VM(t,r,{get:()=>e[r],enumerable:!(i=jM(e,r))||i.enumerable});return t})(!e&&t&&t.__esModule?n:VM(n,"default",{value:t,enumerable:!0}),t)),$M=(t,e,n)=>(((t,e,n)=>{e in t?VM(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n),YM=qM(((t,e)=>{var n,i;n=t,i=function(){return t.importState=function(e){var n=new t;return n.importState(e),n},t;function t(){return function(t){var e=0,n=0,i=0,r=1;0==t.length&&(t=[+new Date]);var s=function(){var t=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){var i=.02519603282416938*(t+=e.charCodeAt(n));i-=t=i>>>0,t=(i*=t)>>>0,t+=4294967296*(i-=t)}return 2.3283064365386963e-10*(t>>>0)};return e.version="Mash 0.9",e}();e=s(" "),n=s(" "),i=s(" ");for(var a=0;a<t.length;a++)(e-=s(t[a]))<0&&(e+=1),(n-=s(t[a]))<0&&(n+=1),(i-=s(t[a]))<0&&(i+=1);s=null;var o=function(){var t=2091639*e+2.3283064365386963e-10*r;return e=n,n=i,i=t-(r=0|t)};return o.next=o,o.uint32=function(){return 4294967296*o()},o.fract53=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.version="Alea 0.9",o.args=t,o.exportState=function(){return[e,n,i,r]},o.importState=function(t){e=+t[0]||0,n=+t[1]||0,i=+t[2]||0,r=+t[3]||0},o}(Array.prototype.slice.call(arguments))}},"object"==typeof t?e.exports=i():"function"==typeof define&&define.amd?define(i):n.Alea=i()})),ZM=qM(((t,e)=>{var n,i;n=t,i=function(t){t.SVD=function(t,e,n,i,r){if(e=void 0===e||e,n=void 0===n||n,r=1e-64/(i=i||Math.pow(2,-52)),!t)throw new TypeError("Matrix a is not defined");var s,a,o,l,c,h,u,d,p,f,m,g,v=t[0].length,y=t.length;if(y<v)throw new TypeError("Invalid matrix: m < n");for(var x=[],b=[],_=[],w="f"===e?y:v,S=f=u=0;S<y;S++)b[S]=new Array(w).fill(0);for(S=0;S<v;S++)_[S]=new Array(v).fill(0);var M,T=new Array(v).fill(0);for(S=0;S<y;S++)for(s=0;s<v;s++)b[S][s]=t[S][s];for(S=0;S<v;S++){for(x[S]=u,p=0,o=S+1,s=S;s<y;s++)p+=Math.pow(b[s][S],2);if(p<r)u=0;else for(d=(h=b[S][S])*(u=h<0?Math.sqrt(p):-Math.sqrt(p))-p,b[S][S]=h-u,s=o;s<v;s++){for(p=0,a=S;a<y;a++)p+=b[a][S]*b[a][s];for(h=p/d,a=S;a<y;a++)b[a][s]=b[a][s]+h*b[a][S]}for(T[S]=u,p=0,s=o;s<v;s++)p+=Math.pow(b[S][s],2);if(p<r)u=0;else{for(d=(h=b[S][S+1])*(u=h<0?Math.sqrt(p):-Math.sqrt(p))-p,b[S][S+1]=h-u,s=o;s<v;s++)x[s]=b[S][s]/d;for(s=o;s<y;s++){for(p=0,a=o;a<v;a++)p+=b[s][a]*b[S][a];for(a=o;a<v;a++)b[s][a]=b[s][a]+p*x[a]}}f<(m=Math.abs(T[S])+Math.abs(x[S]))&&(f=m)}if(n)for(S=v-1;0<=S;S--){if(0!==u){for(d=b[S][S+1]*u,s=o;s<v;s++)_[s][S]=b[S][s]/d;for(s=o;s<v;s++){for(p=0,a=o;a<v;a++)p+=b[S][a]*_[a][s];for(a=o;a<v;a++)_[a][s]=_[a][s]+p*_[a][S]}}for(s=o;s<v;s++)_[S][s]=0,_[s][S]=0;_[S][S]=1,u=x[S],o=S}if(e){if("f"===e)for(S=v;S<y;S++){for(s=v;s<y;s++)b[S][s]=0;b[S][S]=1}for(S=v-1;0<=S;S--){for(o=S+1,u=T[S],s=o;s<w;s++)b[S][s]=0;if(0!==u){for(d=b[S][S]*u,s=o;s<w;s++){for(p=0,a=o;a<y;a++)p+=b[a][S]*b[a][s];for(h=p/d,a=S;a<y;a++)b[a][s]=b[a][s]+h*b[a][S]}for(s=S;s<y;s++)b[s][S]=b[s][S]/u}else for(s=S;s<y;s++)b[s][S]=0;b[S][S]=b[S][S]+1}}for(i*=f,a=v-1;0<=a;a--)for(var E=0;E<50;E++){for(M=!1,o=a;0<=o;o--){if(Math.abs(x[o])<=i){M=!0;break}if(Math.abs(T[o-1])<=i)break}if(!M)for(c=0,l=o-(p=1),S=o;S<a+1&&(h=p*x[S],x[S]=c*x[S],!(Math.abs(h)<=i));S++)if(u=T[S],T[S]=Math.sqrt(h*h+u*u),c=u/(d=T[S]),p=-h/d,e)for(s=0;s<y;s++)m=b[s][l],g=b[s][S],b[s][l]=m*c+g*p,b[s][S]=-m*p+g*c;if(g=T[a],o===a){if(g<0&&(T[a]=-g,n))for(s=0;s<v;s++)_[s][a]=-_[s][a];break}for(f=T[o],h=(((m=T[a-1])-g)*(m+g)+((u=x[a-1])-(d=x[a]))*(u+d))/(2*d*m),u=Math.sqrt(h*h+1),h=((f-g)*(f+g)+d*(m/(h<0?h-u:h+u)-d))/f,S=o+(p=c=1);S<a+1;S++){if(u=x[S],m=T[S],d=p*u,u*=c,g=Math.sqrt(h*h+d*d),h=f*(c=h/(x[S-1]=g))+u*(p=d/g),u=-f*p+u*c,d=m*p,m*=c,n)for(s=0;s<v;s++)f=_[s][S-1],g=_[s][S],_[s][S-1]=f*c+g*p,_[s][S]=-f*p+g*c;if(g=Math.sqrt(h*h+d*d),h=(c=h/(T[S-1]=g))*u+(p=d/g)*m,f=-p*u+c*m,e)for(s=0;s<y;s++)m=b[s][S-1],g=b[s][S],b[s][S-1]=m*c+g*p,b[s][S]=-m*p+g*c}x[o]=0,x[a]=h,T[a]=f}for(S=0;S<v;S++)T[S]<i&&(T[S]=0);return{u:b,q:T,v:_}},t.VERSION="1.1.1",Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof t&&typeof e<"u"?i(t):"function"==typeof define&&define.amd?define(["exports"],i):i((n=typeof globalThis<"u"?globalThis:n||self).SVDJS={})})),KM=qM(((t,e)=>{function n(t,e,i,r){this.message=t,this.expected=e,this.found=i,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}!function(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}(n,Error),n.buildMessage=function(t,e){var n,i={literal:function(t){return'"'+s(t.text)+'"'},class:function(t){var e,n="";for(e=0;e<t.parts.length;e++)n+=t.parts[e]instanceof Array?a(t.parts[e][0])+"-"+a(t.parts[e][1]):a(t.parts[e]);return"["+(t.inverted?"^":"")+n+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function r(t){return t.charCodeAt(0).toString(16).toUpperCase()}function s(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+r(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+r(t)}))}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+r(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+r(t)}))}function o(t){return i[t.type](t)}return"Expected "+function(t){var e,n,i=new Array(t.length);for(e=0;e<t.length;e++)i[e]=o(t[e]);if(i.sort(),i.length>0){for(e=1,n=1;e<i.length;e++)i[e-1]!==i[e]&&(i[n]=i[e],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+(((n=e)?'"'+s(n)+'"':"end of input")+" found.")},e.exports={SyntaxError:n,parse:function(t,e){e=void 0!==e?e:{};var i,r={},s={svg_path:gt},a=gt,o=function(t){if(!t)return[];for(var e=[],n=0;n<t.length;n++)e=e.concat.apply(e,t[n]);var i=e[0];return i&&"m"==i.code&&(delete i.relative,i.code="M"),e},l=function(t,e){return function(t,e){if(!e)return[t];for(var n=[t],i=0,r=e.length;i<r;i++)n[i+1]=e[i][1];return n}(t,e)},c=/^[Mm]/,h=ut(["M","m"],!1,!1),u=function(t,e,n){var i=kt(t,[e]);return n&&(i=i.concat(kt("M"==t?"L":"l",n[1]))),i},d=/^[Zz]/,p=ut(["Z","z"],!1,!1),f=function(){return kt("Z")},m=/^[Ll]/,g=ut(["L","l"],!1,!1),v=function(t,e){return kt(t,e)},y=/^[Hh]/,x=ut(["H","h"],!1,!1),b=function(t,e){return kt(t,e.map((function(t){return{x:t}})))},_=/^[Vv]/,w=ut(["V","v"],!1,!1),S=function(t,e){return kt(t,e.map((function(t){return{y:t}})))},M=/^[Cc]/,T=ut(["C","c"],!1,!1),E=function(t,e,n){return{x1:t.x,y1:t.y,x2:e.x,y2:e.y,x:n.x,y:n.y}},A=/^[Ss]/,C=ut(["S","s"],!1,!1),P=function(t,e){return{x2:t.x,y2:t.y,x:e.x,y:e.y}},R=/^[Qq]/,O=ut(["Q","q"],!1,!1),D=function(t,e){return{x1:t.x,y1:t.y,x:e.x,y:e.y}},L=/^[Tt]/,I=ut(["T","t"],!1,!1),z=/^[Aa]/,N=ut(["A","a"],!1,!1),U=function(t,e,n,i,r,s){return{rx:t,ry:e,xAxisRotation:n,largeArc:i,sweep:r,x:s.x,y:s.y}},k=function(t,e){return{x:t,y:e}},B=function(t){return 1*t},F=function(t){return 1*t.join("")},V=/^[01]/,j=ut(["0","1"],!1,!1),H=function(t){return"1"==t},G=function(){return""},W=",",q=ht(",",!1),X=function(t){return t.join("")},$=".",Y=ht(".",!1),Z=/^[eE]/,K=ut(["e","E"],!1,!1),J=/^[+\-]/,Q=ut(["+","-"],!1,!1),tt=/^[0-9]/,et=ut([["0","9"]],!1,!1),nt=function(t){return t.join("")},it=/^[ \t\n\r]/,rt=ut([" ","\t","\n","\r"],!1,!1),st=0,at=[{line:1,column:1}],ot=0,lt=[],ct=0;if("startRule"in e){if(!(e.startRule in s))throw new Error("Can't start parsing from rule \""+e.startRule+'".');a=s[e.startRule]}function ht(t,e){return{type:"literal",text:t,ignoreCase:e}}function ut(t,e,n){return{type:"class",parts:t,inverted:e,ignoreCase:n}}function dt(e){var n,i=at[e];if(i)return i;for(n=e-1;!at[n];)n--;for(i={line:(i=at[n]).line,column:i.column};n<e;)10===t.charCodeAt(n)?(i.line++,i.column=1):i.column++,n++;return at[e]=i,i}function pt(t,e){var n=dt(t),i=dt(e);return{start:{offset:t,line:n.line,column:n.column},end:{offset:e,line:i.line,column:i.column}}}function ft(t){st<ot||(st>ot&&(ot=st,lt=[]),lt.push(t))}function mt(t,e,i){return new n(n.buildMessage(t,e),t,e,i)}function gt(){var t,e,n,i,s;for(t=st,e=[],n=zt();n!==r;)e.push(n),n=zt();if(e!==r)if(n=function(){var t,e,n,i,s,a;if(t=st,e=vt(),e!==r){for(n=[],i=st,s=[],a=zt();a!==r;)s.push(a),a=zt();for(s!==r?(a=vt())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r);i!==r;){for(n.push(i),i=st,s=[],a=zt();a!==r;)s.push(a),a=zt();s!==r?(a=vt())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r)}n!==r?t=e=l(e,n):(st=t,t=r)}else st=t,t=r;return t}(),n===r&&(n=null),n!==r){for(i=[],s=zt();s!==r;)i.push(s),s=zt();i!==r?t=e=o(n):(st=t,t=r)}else st=t,t=r;else st=t,t=r;return t}function vt(){var e,n,i,s,a,o;if(e=st,n=function(){var e,n,i,s,a,o,l;if(e=st,c.test(t.charAt(st))?(n=t.charAt(st),st++):(n=r,0===ct&&ft(h)),n!==r){for(i=[],s=zt();s!==r;)i.push(s),s=zt();i!==r?(s=Tt())!==r?(a=st,(o=Pt())===r&&(o=null),o!==r?(l=xt())!==r?a=o=[o,l]:(st=a,a=r):(st=a,a=r),a===r&&(a=null),a!==r?e=n=u(n,s,a):(st=e,e=r)):(st=e,e=r):(st=e,e=r)}else st=e,e=r;return e}(),n!==r){for(i=[],s=st,a=[],o=zt();o!==r;)a.push(o),o=zt();for(a!==r?(o=yt())!==r?s=a=[a,o]:(st=s,s=r):(st=s,s=r);s!==r;){for(i.push(s),s=st,a=[],o=zt();o!==r;)a.push(o),o=zt();a!==r?(o=yt())!==r?s=a=[a,o]:(st=s,s=r):(st=s,s=r)}i!==r?e=n=l(n,i):(st=e,e=r)}else st=e,e=r;return e}function yt(){var e;return(e=function(){var e,n;return e=st,d.test(t.charAt(st))?(n=t.charAt(st),st++):(n=r,0===ct&&ft(p)),n!==r&&(n=f()),e=n,e}())===r&&((e=function(){var e,n,i,s;if(e=st,m.test(t.charAt(st))?(n=t.charAt(st),st++):(n=r,0===ct&&ft(g)),n!==r){for(i=[],s=zt();s!==r;)i.push(s),s=zt();i!==r?(s=xt())!==r?e=n=v(n,s):(st=e,e=r):(st=e,e=r)}else st=e,e=r;return e}())===r&&((e=function(){var e,n,i,s;if(e=st,y.test(t.charAt(st))?(n=t.charAt(st),st++):(n=r,0===ct&&ft(x)),n!==r){for(i=[],s=zt();s!==r;)i.push(s),s=zt();i!==r?(s=bt())!==r?e=n=b(n,s):(st=e,e=r):(st=e,e=r)}else st=e,e=r;return e}())===r&&((e=function(){var e,n,i,s;if(e=st,_.test(t.charAt(st))?(n=t.charAt(st),st++):(n=r,0===ct&&ft(w)),n!==r){for(i=[],s=zt();s!==r;)i.push(s),s=zt();i!==r?(s=bt())!==r?e=n=S(n,s):(st=e,e=r):(st=e,e=r)}else st=e,e=r;return e}())===r&&((e=function(){var e,n,i,s;if(e=st,M.test(t.charAt(st))?(n=t.charAt(st),st++):(n=r,0===ct&&ft(T)),n!==r){for(i=[],s=zt();s!==r;)i.push(s),s=zt();i!==r?(s=function(){var t,e,n,i,s,a;if(t=st,e=_t(),e!==r){for(n=[],i=st,(s=Pt())===r&&(s=null),s!==r?(a=_t())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r);i!==r;)n.push(i),i=st,(s=Pt())===r&&(s=null),s!==r?(a=_t())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r);n!==r?t=e=l(e,n):(st=t,t=r)}else st=t,t=r;return t}(),s!==r?e=n=v(n,s):(st=e,e=r)):(st=e,e=r)}else st=e,e=r;return e}())===r&&((e=function(){var e,n,i,s;if(e=st,A.test(t.charAt(st))?(n=t.charAt(st),st++):(n=r,0===ct&&ft(C)),n!==r){for(i=[],s=zt();s!==r;)i.push(s),s=zt();i!==r?(s=function(){var t,e,n,i,s,a;if(t=st,e=wt(),e!==r){for(n=[],i=st,(s=Pt())===r&&(s=null),s!==r?(a=wt())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r);i!==r;)n.push(i),i=st,(s=Pt())===r&&(s=null),s!==r?(a=wt())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r);n!==r?t=e=l(e,n):(st=t,t=r)}else st=t,t=r;return t}(),s!==r?e=n=v(n,s):(st=e,e=r)):(st=e,e=r)}else st=e,e=r;return e}())===r&&((e=function(){var e,n,i,s;if(e=st,R.test(t.charAt(st))?(n=t.charAt(st),st++):(n=r,0===ct&&ft(O)),n!==r){for(i=[],s=zt();s!==r;)i.push(s),s=zt();i!==r?(s=function(){var t,e,n,i,s,a;if(t=st,e=St(),e!==r){for(n=[],i=st,(s=Pt())===r&&(s=null),s!==r?(a=St())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r);i!==r;)n.push(i),i=st,(s=Pt())===r&&(s=null),s!==r?(a=St())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r);n!==r?t=e=l(e,n):(st=t,t=r)}else st=t,t=r;return t}(),s!==r?e=n=v(n,s):(st=e,e=r)):(st=e,e=r)}else st=e,e=r;return e}())===r&&((e=function(){var e,n,i,s;if(e=st,L.test(t.charAt(st))?(n=t.charAt(st),st++):(n=r,0===ct&&ft(I)),n!==r){for(i=[],s=zt();s!==r;)i.push(s),s=zt();i!==r?(s=function(){var t,e,n,i,s,a;if(t=st,e=Tt(),e!==r){for(n=[],i=st,(s=Pt())===r&&(s=null),s!==r?(a=Tt())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r);i!==r;)n.push(i),i=st,(s=Pt())===r&&(s=null),s!==r?(a=Tt())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r);n!==r?t=e=l(e,n):(st=t,t=r)}else st=t,t=r;return t}(),s!==r?e=n=v(n,s):(st=e,e=r)):(st=e,e=r)}else st=e,e=r;return e}())===r&&(e=function(){var e,n,i,s;if(e=st,z.test(t.charAt(st))?(n=t.charAt(st),st++):(n=r,0===ct&&ft(N)),n!==r){for(i=[],s=zt();s!==r;)i.push(s),s=zt();i!==r?(s=function(){var t,e,n,i,s,a;if(t=st,e=Mt(),e!==r){for(n=[],i=st,(s=Pt())===r&&(s=null),s!==r?(a=Mt())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r);i!==r;)n.push(i),i=st,(s=Pt())===r&&(s=null),s!==r?(a=Mt())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r);n!==r?t=e=l(e,n):(st=t,t=r)}else st=t,t=r;return t}(),s!==r?e=n=v(n,s):(st=e,e=r)):(st=e,e=r)}else st=e,e=r;return e}())))))))),e}function xt(){var t,e,n,i,s,a;if(t=st,(e=Tt())!==r){for(n=[],i=st,(s=Pt())===r&&(s=null),s!==r?(a=Tt())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r);i!==r;)n.push(i),i=st,(s=Pt())===r&&(s=null),s!==r?(a=Tt())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r);n!==r?t=e=l(e,n):(st=t,t=r)}else st=t,t=r;return t}function bt(){var t,e,n,i,s,a;if(t=st,(e=At())!==r){for(n=[],i=st,(s=Pt())===r&&(s=null),s!==r?(a=At())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r);i!==r;)n.push(i),i=st,(s=Pt())===r&&(s=null),s!==r?(a=At())!==r?i=s=[s,a]:(st=i,i=r):(st=i,i=r);n!==r?t=e=l(e,n):(st=t,t=r)}else st=t,t=r;return t}function _t(){var t,e,n,i,s,a;return t=st,(e=Tt())!==r?((n=Pt())===r&&(n=null),n!==r?(i=Tt())!==r?((s=Pt())===r&&(s=null),s!==r?(a=Tt())!==r?t=e=E(e,i,a):(st=t,t=r):(st=t,t=r)):(st=t,t=r):(st=t,t=r)):(st=t,t=r),t}function wt(){var t,e,n,i;return t=st,(e=Tt())!==r?((n=Pt())===r&&(n=null),n!==r?(i=Tt())!==r?t=e=P(e,i):(st=t,t=r):(st=t,t=r)):(st=t,t=r),t}function St(){var t,e,n,i;return t=st,(e=Tt())!==r?((n=Pt())===r&&(n=null),n!==r?(i=Tt())!==r?t=e=D(e,i):(st=t,t=r):(st=t,t=r)):(st=t,t=r),t}function Mt(){var t,e,n,i,s,a,o,l,c,h,u;return t=st,(e=Et())!==r?((n=Pt())===r&&(n=null),n!==r?(i=Et())!==r?((s=Pt())===r&&(s=null),s!==r?(a=At())!==r?Pt()!==r?(o=Ct())!==r?((l=Pt())===r&&(l=null),l!==r?(c=Ct())!==r?((h=Pt())===r&&(h=null),h!==r?(u=Tt())!==r?t=e=U(e,i,a,o,c,u):(st=t,t=r):(st=t,t=r)):(st=t,t=r):(st=t,t=r)):(st=t,t=r):(st=t,t=r):(st=t,t=r):(st=t,t=r)):(st=t,t=r):(st=t,t=r)):(st=t,t=r),t}function Tt(){var t,e,n,i;return t=st,(e=At())!==r?((n=Pt())===r&&(n=null),n!==r?(i=At())!==r?t=e=k(e,i):(st=t,t=r):(st=t,t=r)):(st=t,t=r),t}function Et(){var t,e;return t=st,(e=Ot())===r&&(e=It()),e!==r&&(e=B(e)),t=e}function At(){var t,e,n,i;return t=st,e=st,(n=Lt())===r&&(n=null),n!==r?(i=Ot())!==r?e=n=[n,i]:(st=e,e=r):(st=e,e=r),e===r&&(e=st,(n=Lt())===r&&(n=null),n!==r?(i=It())!==r?e=n=[n,i]:(st=e,e=r):(st=e,e=r)),e!==r&&(e=F(e)),t=e}function Ct(){var e,n;return e=st,V.test(t.charAt(st))?(n=t.charAt(st),st++):(n=r,0===ct&&ft(j)),n!==r&&(n=H(n)),e=n}function Pt(){var t,e,n,i,s;if(t=st,e=[],(n=zt())!==r)for(;n!==r;)e.push(n),n=zt();else e=r;if(e!==r)if((n=Rt())===r&&(n=null),n!==r){for(i=[],s=zt();s!==r;)i.push(s),s=zt();i!==r?t=e=[e,n,i]:(st=t,t=r)}else st=t,t=r;else st=t,t=r;if(t===r){if(t=st,e=st,(n=Rt())!==r){for(i=[],s=zt();s!==r;)i.push(s),s=zt();i!==r?e=n=[n,i]:(st=e,e=r)}else st=e,e=r;e!==r&&(e=G()),t=e}return t}function Rt(){var e;return 44===t.charCodeAt(st)?(e=W,st++):(e=r,0===ct&&ft(q)),e}function Ot(){var e,n,i,s;return e=st,n=st,i=function(){var e,n,i,s,a;return e=st,n=st,i=It(),i===r&&(i=null),i!==r?(46===t.charCodeAt(st)?(s=$,st++):(s=r,0===ct&&ft(Y)),s!==r&&(a=It())!==r?(i=[i,s,a],n=i):(st=n,n=r)):(st=n,n=r),n===r&&(n=st,i=It(),i!==r?(46===t.charCodeAt(st)?(s=$,st++):(s=r,0===ct&&ft(Y)),s!==r?(i=[i,s],n=i):(st=n,n=r)):(st=n,n=r)),n!==r&&(n=X(n)),e=n,e}(),i!==r?((s=Dt())===r&&(s=null),s!==r?n=i=[i,s]:(st=n,n=r)):(st=n,n=r),n===r&&(n=st,(i=It())!==r?(s=Dt())!==r?n=i=[i,s]:(st=n,n=r):(st=n,n=r)),n!==r&&(n=X(n)),e=n}function Dt(){var e,n,i,s,a;return e=st,n=st,Z.test(t.charAt(st))?(i=t.charAt(st),st++):(i=r,0===ct&&ft(K)),i!==r?((s=Lt())===r&&(s=null),s!==r?(a=It())!==r?n=i=[i,s,a]:(st=n,n=r):(st=n,n=r)):(st=n,n=r),n!==r&&(n=X(n)),e=n}function Lt(){var e;return J.test(t.charAt(st))?(e=t.charAt(st),st++):(e=r,0===ct&&ft(Q)),e}function It(){var e,n,i;if(e=st,n=[],tt.test(t.charAt(st))?(i=t.charAt(st),st++):(i=r,0===ct&&ft(et)),i!==r)for(;i!==r;)n.push(i),tt.test(t.charAt(st))?(i=t.charAt(st),st++):(i=r,0===ct&&ft(et));else n=r;return n!==r&&(n=nt(n)),e=n}function zt(){var e,n;return e=st,it.test(t.charAt(st))?(n=t.charAt(st),st++):(n=r,0===ct&&ft(rt)),n!==r&&(n=G()),e=n}var Nt={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var Ut in Nt)Nt[Ut.toUpperCase()]=Nt[Ut];function kt(t,e){e||(e=[{}]);for(var n=e.length;n--;){var i={code:t,command:Nt[t]};for(var r in t==t.toLowerCase()&&(i.relative=!0),e[n])i[r]=e[n][r];e[n]=i}return e}if((i=a())!==r&&st===t.length)return i;throw i!==r&&st<t.length&&ft({type:"end"}),mt(lt,ot<t.length?t.charAt(ot):null,ot<t.length?pt(ot,ot+1):pt(ot,ot))}}})),JM=qM(((t,e)=>{var n=KM().parse;n.parseSVG=n,n.makeAbsolute=function(t){var e,n={x:0,y:0},i={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return t.forEach((function(t){for(var r in"moveto"===t.command&&(e=t),t.x0=n.x,t.y0=n.y,i)r in t&&(t[r]+=t.relative?t[i[r]]:0);"x"in t||(t.x=n.x),"y"in t||(t.y=n.y),t.relative=!1,t.code=t.code.toUpperCase(),"closepath"==t.command&&(t.x=e.x,t.y=e.y),n=t})),t},e.exports=n})),QM=qM(((t,e)=>{e.exports=function(t,e){for(var n=t.split("."),i=e.split("."),r=0;r<3;r++){var s=Number(n[r]),a=Number(i[r]);if(s>a)return 1;if(a>s)return-1;if(!isNaN(s)&&isNaN(a))return 1;if(isNaN(s)&&!isNaN(a))return-1}return 0}}));function tT(t){for(let e of Object.keys(t))void 0===t[e]&&delete t[e];return t}function eT(t,e){return Object.setPrototypeOf(t,e),t}function nT(t){return Array.isArray(t)?t:[t]}function iT(t,e){let n=0;for(;n<t.length&&n<e.length;){if(t[n]<e[n])return-1;if(t[n]>e[n])return 1;n+=1}return n!==e.length?-1:n!==t.length?1:0}var rT="object"==typeof global&&global&&global.Object===Object&&global,sT="object"==typeof self&&self&&self.Object===Object&&self,aT=rT||sT||Function("return this")(),oT=aT.Symbol,lT=Object.prototype,cT=lT.hasOwnProperty,hT=lT.toString,uT=oT?oT.toStringTag:void 0;var dT=function(t){var e=cT.call(t,uT),n=t[uT];try{t[uT]=void 0;var i=!0}catch{}var r=hT.call(t);return i&&(e?t[uT]=n:delete t[uT]),r},pT=Object.prototype.toString;var fT=function(t){return pT.call(t)},mT=oT?oT.toStringTag:void 0;var gT=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":mT&&mT in Object(t)?dT(t):fT(t)};var vT=function(t){return null!=t&&"object"==typeof t};var yT=function(t){return"symbol"==typeof t||vT(t)&&"[object Symbol]"==gT(t)};var xT=function(t,e){for(var n=-1,i=null==t?0:t.length,r=Array(i);++n<i;)r[n]=e(t[n],n,t);return r},bT=Array.isArray,_T=1/0,wT=oT?oT.prototype:void 0,ST=wT?wT.toString:void 0;var MT=function t(e){if("string"==typeof e)return e;if(bT(e))return xT(e,t)+"";if(yT(e))return ST?ST.call(e):"";var n=e+"";return"0"==n&&1/e==-_T?"-0":n},TT=/\s/;var ET=function(t){for(var e=t.length;e--&&TT.test(t.charAt(e)););return e},AT=/^\s+/;var CT=function(t){return t&&t.slice(0,ET(t)+1).replace(AT,"")};var PT=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},RT=/^[-+]0x[0-9a-f]+$/i,OT=/^0b[01]+$/i,DT=/^0o[0-7]+$/i,LT=parseInt;var IT=function(t){if("number"==typeof t)return t;if(yT(t))return NaN;if(PT(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=PT(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=CT(t);var n=OT.test(t);return n||DT.test(t)?LT(t.slice(2),n?2:8):RT.test(t)?NaN:+t};var zT=function(t){return t};var NT,UT=function(t){if(!PT(t))return!1;var e=gT(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},kT=aT["__core-js_shared__"],BT=(NT=/[^.]+$/.exec(kT&&kT.keys&&kT.keys.IE_PROTO||""))?"Symbol(src)_1."+NT:"";var FT=function(t){return!!BT&&BT in t},VT=Function.prototype.toString;var jT=function(t){if(null!=t){try{return VT.call(t)}catch{}try{return t+""}catch{}}return""},HT=/^\[object .+?Constructor\]$/,GT=Function.prototype,WT=Object.prototype,qT=GT.toString,XT=WT.hasOwnProperty,$T=RegExp("^"+qT.call(XT).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var YT=function(t){return!(!PT(t)||FT(t))&&(UT(t)?$T:HT).test(jT(t))};var ZT=function(t,e){return t?.[e]};var KT=function(t,e){var n=ZT(t,e);return YT(n)?n:void 0},JT=KT(aT,"WeakMap"),QT=Object.create,tE=function(){function t(){}return function(e){if(!PT(e))return{};if(QT)return QT(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),eE=tE;var nE=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)};var iE=function(t,e){var n=-1,i=t.length;for(e||(e=Array(i));++n<i;)e[n]=t[n];return e},rE=Date.now;var sE=function(t){var e=0,n=0;return function(){var i=rE(),r=16-(i-n);if(n=i,r>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}};var aE=function(t){return function(){return t}},oE=function(){try{var t=KT(Object,"defineProperty");return t({},"",{}),t}catch{}}(),lE=oE,cE=lE?function(t,e){return lE(t,"toString",{configurable:!0,enumerable:!1,value:aE(e),writable:!0})}:zT,hE=sE(cE);var uE=function(t,e){for(var n=-1,i=null==t?0:t.length;++n<i&&!1!==e(t[n],n,t););return t},dE=/^(?:0|[1-9]\d*)$/;var pE=function(t,e){var n=typeof t;return!!(e=e??9007199254740991)&&("number"==n||"symbol"!=n&&dE.test(t))&&t>-1&&t%1==0&&t<e};var fE=function(t,e,n){"__proto__"==e&&lE?lE(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n};var mE=function(t,e){return t===e||t!=t&&e!=e},gE=Object.prototype.hasOwnProperty;var vE=function(t,e,n){var i=t[e];(!gE.call(t,e)||!mE(i,n)||void 0===n&&!(e in t))&&fE(t,e,n)};var yE=function(t,e,n,i){var r=!n;n||(n={});for(var s=-1,a=e.length;++s<a;){var o=e[s],l=i?i(n[o],t[o],o,n,t):void 0;void 0===l&&(l=t[o]),r?fE(n,o,l):vE(n,o,l)}return n},xE=Math.max;var bE=function(t,e,n){return e=xE(void 0===e?t.length-1:e,0),function(){for(var i=arguments,r=-1,s=xE(i.length-e,0),a=Array(s);++r<s;)a[r]=i[e+r];r=-1;for(var o=Array(e+1);++r<e;)o[r]=i[r];return o[e]=n(a),nE(t,this,o)}};var _E=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var wE=function(t){return null!=t&&_E(t.length)&&!UT(t)},SE=Object.prototype;var ME=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||SE)};var TE=function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i};var EE=function(t){return vT(t)&&"[object Arguments]"==gT(t)},AE=Object.prototype,CE=AE.hasOwnProperty,PE=AE.propertyIsEnumerable,RE=EE(function(){return arguments}())?EE:function(t){return vT(t)&&CE.call(t,"callee")&&!PE.call(t,"callee")},OE=RE;var DE=function(){return!1},LE="object"==typeof exports&&exports&&!exports.nodeType&&exports,IE=LE&&"object"==typeof module&&module&&!module.nodeType&&module,zE=IE&&IE.exports===LE?aT.Buffer:void 0,NE=(zE?zE.isBuffer:void 0)||DE,UE={};UE["[object Float32Array]"]=UE["[object Float64Array]"]=UE["[object Int8Array]"]=UE["[object Int16Array]"]=UE["[object Int32Array]"]=UE["[object Uint8Array]"]=UE["[object Uint8ClampedArray]"]=UE["[object Uint16Array]"]=UE["[object Uint32Array]"]=!0,UE["[object Arguments]"]=UE["[object Array]"]=UE["[object ArrayBuffer]"]=UE["[object Boolean]"]=UE["[object DataView]"]=UE["[object Date]"]=UE["[object Error]"]=UE["[object Function]"]=UE["[object Map]"]=UE["[object Number]"]=UE["[object Object]"]=UE["[object RegExp]"]=UE["[object Set]"]=UE["[object String]"]=UE["[object WeakMap]"]=!1;var kE=function(t){return vT(t)&&_E(t.length)&&!!UE[gT(t)]};var BE=function(t){return function(e){return t(e)}},FE="object"==typeof exports&&exports&&!exports.nodeType&&exports,VE=FE&&"object"==typeof module&&module&&!module.nodeType&&module,jE=VE&&VE.exports===FE&&rT.process,HE=function(){try{return VE&&VE.require&&VE.require("util").types||jE&&jE.binding&&jE.binding("util")}catch{}}(),GE=HE&&HE.isTypedArray,WE=GE?BE(GE):kE,qE=Object.prototype.hasOwnProperty;var XE=function(t,e){var n=bT(t),i=!n&&OE(t),r=!n&&!i&&NE(t),s=!n&&!i&&!r&&WE(t),a=n||i||r||s,o=a?TE(t.length,String):[],l=o.length;for(var c in t)(e||qE.call(t,c))&&(!a||!("length"==c||r&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||pE(c,l)))&&o.push(c);return o};var $E=function(t,e){return function(n){return t(e(n))}},YE=$E(Object.keys,Object),ZE=Object.prototype.hasOwnProperty;var KE=function(t){if(!ME(t))return YE(t);var e=[];for(var n in Object(t))ZE.call(t,n)&&"constructor"!=n&&e.push(n);return e};var JE=function(t){return wE(t)?XE(t):KE(t)};var QE=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e},tA=Object.prototype.hasOwnProperty;var eA=function(t){if(!PT(t))return QE(t);var e=ME(t),n=[];for(var i in t)"constructor"==i&&(e||!tA.call(t,i))||n.push(i);return n};var nA=function(t){return wE(t)?XE(t,!0):eA(t)},iA=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,rA=/^\w*$/;var sA=function(t,e){if(bT(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!yT(t))||(rA.test(t)||!iA.test(t)||null!=e&&t in Object(e))},aA=KT(Object,"create");var oA=function(){this.__data__=aA?aA(null):{},this.size=0};var lA=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},cA=Object.prototype.hasOwnProperty;var hA=function(t){var e=this.__data__;if(aA){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return cA.call(e,t)?e[t]:void 0},uA=Object.prototype.hasOwnProperty;var dA=function(t){var e=this.__data__;return aA?void 0!==e[t]:uA.call(e,t)};var pA=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=aA&&void 0===e?"__lodash_hash_undefined__":e,this};function fA(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}fA.prototype.clear=oA,fA.prototype.delete=lA,fA.prototype.get=hA,fA.prototype.has=dA,fA.prototype.set=pA;var mA=fA;var gA=function(){this.__data__=[],this.size=0};var vA=function(t,e){for(var n=t.length;n--;)if(mE(t[n][0],e))return n;return-1},yA=Array.prototype.splice;var xA=function(t){var e=this.__data__,n=vA(e,t);return!(n<0)&&(n==e.length-1?e.pop():yA.call(e,n,1),--this.size,!0)};var bA=function(t){var e=this.__data__,n=vA(e,t);return n<0?void 0:e[n][1]};var _A=function(t){return vA(this.__data__,t)>-1};var wA=function(t,e){var n=this.__data__,i=vA(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this};function SA(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}SA.prototype.clear=gA,SA.prototype.delete=xA,SA.prototype.get=bA,SA.prototype.has=_A,SA.prototype.set=wA;var MA=SA,TA=KT(aT,"Map");var EA=function(){this.size=0,this.__data__={hash:new mA,map:new(TA||MA),string:new mA}};var AA=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var CA=function(t,e){var n=t.__data__;return AA(e)?n["string"==typeof e?"string":"hash"]:n.map};var PA=function(t){var e=CA(this,t).delete(t);return this.size-=e?1:0,e};var RA=function(t){return CA(this,t).get(t)};var OA=function(t){return CA(this,t).has(t)};var DA=function(t,e){var n=CA(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this};function LA(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}LA.prototype.clear=EA,LA.prototype.delete=PA,LA.prototype.get=RA,LA.prototype.has=OA,LA.prototype.set=DA;var IA=LA;function zA(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var i=arguments,r=e?e.apply(this,i):i[0],s=n.cache;if(s.has(r))return s.get(r);var a=t.apply(this,i);return n.cache=s.set(r,a)||s,a};return n.cache=new(zA.Cache||IA),n}zA.Cache=IA;var NA=zA;var UA=function(t){var e=NA(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e},kA=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,BA=/\\(\\)?/g,FA=UA((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(kA,(function(t,n,i,r){e.push(i?r.replace(BA,"$1"):n||t)})),e})),VA=FA;var jA=function(t){return null==t?"":MT(t)};var HA=function(t,e){return bT(t)?t:sA(t,e)?[t]:VA(jA(t))},GA=1/0;var WA=function(t){if("string"==typeof t||yT(t))return t;var e=t+"";return"0"==e&&1/t==-GA?"-0":e};var qA=function(t,e){for(var n=0,i=(e=HA(e,t)).length;null!=t&&n<i;)t=t[WA(e[n++])];return n&&n==i?t:void 0};var XA=function(t,e){for(var n=-1,i=e.length,r=t.length;++n<i;)t[r+n]=e[n];return t},$A=oT?oT.isConcatSpreadable:void 0;var YA=function(t){return bT(t)||OE(t)||!!($A&&t&&t[$A])};var ZA=function t(e,n,i,r,s){var a=-1,o=e.length;for(i||(i=YA),s||(s=[]);++a<o;){var l=e[a];n>0&&i(l)?n>1?t(l,n-1,i,r,s):XA(s,l):r||(s[s.length]=l)}return s};var KA=function(t){return(null==t?0:t.length)?ZA(t,1):[]};var JA=function(t){return hE(bE(t,void 0,KA),t+"")},QA=$E(Object.getPrototypeOf,Object),tC=Function.prototype,eC=Object.prototype,nC=tC.toString,iC=eC.hasOwnProperty,rC=nC.call(Object);var sC=function(t){if(!vT(t)||"[object Object]"!=gT(t))return!1;var e=QA(t);if(null===e)return!0;var n=iC.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&nC.call(n)==rC};var aC=function(t,e,n){var i=-1,r=t.length;e<0&&(e=-e>r?0:r+e),(n=n>r?r:n)<0&&(n+=r),r=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(r);++i<r;)s[i]=t[i+e];return s};var oC=function(){this.__data__=new MA,this.size=0};var lC=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n};var cC=function(t){return this.__data__.get(t)};var hC=function(t){return this.__data__.has(t)};var uC=function(t,e){var n=this.__data__;if(n instanceof MA){var i=n.__data__;if(!TA||i.length<199)return i.push([t,e]),this.size=++n.size,this;n=this.__data__=new IA(i)}return n.set(t,e),this.size=n.size,this};function dC(t){var e=this.__data__=new MA(t);this.size=e.size}dC.prototype.clear=oC,dC.prototype.delete=lC,dC.prototype.get=cC,dC.prototype.has=hC,dC.prototype.set=uC;var pC=dC;var fC=function(t,e){return t&&yE(e,JE(e),t)};var mC=function(t,e){return t&&yE(e,nA(e),t)},gC="object"==typeof exports&&exports&&!exports.nodeType&&exports,vC=gC&&"object"==typeof module&&module&&!module.nodeType&&module,yC=vC&&vC.exports===gC?aT.Buffer:void 0,xC=yC?yC.allocUnsafe:void 0;var bC=function(t,e){if(e)return t.slice();var n=t.length,i=xC?xC(n):new t.constructor(n);return t.copy(i),i};var _C=function(t,e){for(var n=-1,i=null==t?0:t.length,r=0,s=[];++n<i;){var a=t[n];e(a,n,t)&&(s[r++]=a)}return s};var wC=function(){return[]},SC=Object.prototype.propertyIsEnumerable,MC=Object.getOwnPropertySymbols,TC=MC?function(t){return null==t?[]:(t=Object(t),_C(MC(t),(function(e){return SC.call(t,e)})))}:wC,EC=TC;var AC=function(t,e){return yE(t,EC(t),e)},CC=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)XA(e,EC(t)),t=QA(t);return e}:wC,PC=CC;var RC=function(t,e){return yE(t,PC(t),e)};var OC=function(t,e,n){var i=e(t);return bT(t)?i:XA(i,n(t))};var DC=function(t){return OC(t,JE,EC)};var LC=function(t){return OC(t,nA,PC)},IC=KT(aT,"DataView"),zC=KT(aT,"Promise"),NC=KT(aT,"Set"),UC="[object Map]",kC="[object Promise]",BC="[object Set]",FC="[object WeakMap]",VC="[object DataView]",jC=jT(IC),HC=jT(TA),GC=jT(zC),WC=jT(NC),qC=jT(JT),XC=gT;(IC&&XC(new IC(new ArrayBuffer(1)))!=VC||TA&&XC(new TA)!=UC||zC&&XC(zC.resolve())!=kC||NC&&XC(new NC)!=BC||JT&&XC(new JT)!=FC)&&(XC=function(t){var e=gT(t),n="[object Object]"==e?t.constructor:void 0,i=n?jT(n):"";if(i)switch(i){case jC:return VC;case HC:return UC;case GC:return kC;case WC:return BC;case qC:return FC}return e});var $C=XC,YC=Object.prototype.hasOwnProperty;var ZC=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&YC.call(t,"index")&&(n.index=t.index,n.input=t.input),n},KC=aT.Uint8Array;var JC=function(t){var e=new t.constructor(t.byteLength);return new KC(e).set(new KC(t)),e};var QC=function(t,e){var n=e?JC(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)},tP=/\w*$/;var eP=function(t){var e=new t.constructor(t.source,tP.exec(t));return e.lastIndex=t.lastIndex,e},nP=oT?oT.prototype:void 0,iP=nP?nP.valueOf:void 0;var rP=function(t){return iP?Object(iP.call(t)):{}};var sP=function(t,e){var n=e?JC(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)};var aP=function(t,e,n){var i=t.constructor;switch(e){case"[object ArrayBuffer]":return JC(t);case"[object Boolean]":case"[object Date]":return new i(+t);case"[object DataView]":return QC(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return sP(t,n);case"[object Map]":case"[object Set]":return new i;case"[object Number]":case"[object String]":return new i(t);case"[object RegExp]":return eP(t);case"[object Symbol]":return rP(t)}};var oP=function(t){return"function"!=typeof t.constructor||ME(t)?{}:eE(QA(t))};var lP=function(t){return vT(t)&&"[object Map]"==$C(t)},cP=HE&&HE.isMap,hP=cP?BE(cP):lP;var uP=function(t){return vT(t)&&"[object Set]"==$C(t)},dP=HE&&HE.isSet,pP=dP?BE(dP):uP,fP="[object Arguments]",mP="[object Function]",gP="[object Object]",vP={};vP[fP]=vP["[object Array]"]=vP["[object ArrayBuffer]"]=vP["[object DataView]"]=vP["[object Boolean]"]=vP["[object Date]"]=vP["[object Float32Array]"]=vP["[object Float64Array]"]=vP["[object Int8Array]"]=vP["[object Int16Array]"]=vP["[object Int32Array]"]=vP["[object Map]"]=vP["[object Number]"]=vP[gP]=vP["[object RegExp]"]=vP["[object Set]"]=vP["[object String]"]=vP["[object Symbol]"]=vP["[object Uint8Array]"]=vP["[object Uint8ClampedArray]"]=vP["[object Uint16Array]"]=vP["[object Uint32Array]"]=!0,vP["[object Error]"]=vP[mP]=vP["[object WeakMap]"]=!1;var yP=function t(e,n,i,r,s,a){var o,l=1&n,c=2&n,h=4&n;if(i&&(o=s?i(e,r,s,a):i(e)),void 0!==o)return o;if(!PT(e))return e;var u=bT(e);if(u){if(o=ZC(e),!l)return iE(e,o)}else{var d=$C(e),p=d==mP||"[object GeneratorFunction]"==d;if(NE(e))return bC(e,l);if(d==gP||d==fP||p&&!s){if(o=c||p?{}:oP(e),!l)return c?RC(e,mC(o,e)):AC(e,fC(o,e))}else{if(!vP[d])return s?e:{};o=aP(e,d,l)}}a||(a=new pC);var f=a.get(e);if(f)return f;a.set(e,o),pP(e)?e.forEach((function(r){o.add(t(r,n,i,r,e,a))})):hP(e)&&e.forEach((function(r,s){o.set(s,t(r,n,i,s,e,a))}));var m=u?void 0:(h?c?LC:DC:c?nA:JE)(e);return uE(m||e,(function(r,s){m&&(r=e[s=r]),vE(o,s,t(r,n,i,s,e,a))})),o};var xP=function(t){return yP(t,5)};var bP=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var _P=function(t){return this.__data__.has(t)};function wP(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new IA;++e<n;)this.add(t[e])}wP.prototype.add=wP.prototype.push=bP,wP.prototype.has=_P;var SP=wP;var MP=function(t,e){for(var n=-1,i=null==t?0:t.length;++n<i;)if(e(t[n],n,t))return!0;return!1};var TP=function(t,e){return t.has(e)};var EP=function(t,e,n,i,r,s){var a=1&n,o=t.length,l=e.length;if(o!=l&&!(a&&l>o))return!1;var c=s.get(t),h=s.get(e);if(c&&h)return c==e&&h==t;var u=-1,d=!0,p=2&n?new SP:void 0;for(s.set(t,e),s.set(e,t);++u<o;){var f=t[u],m=e[u];if(i)var g=a?i(m,f,u,e,t,s):i(f,m,u,t,e,s);if(void 0!==g){if(g)continue;d=!1;break}if(p){if(!MP(e,(function(t,e){if(!TP(p,e)&&(f===t||r(f,t,n,i,s)))return p.push(e)}))){d=!1;break}}else if(f!==m&&!r(f,m,n,i,s)){d=!1;break}}return s.delete(t),s.delete(e),d};var AP=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t,i){n[++e]=[i,t]})),n};var CP=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n},PP=oT?oT.prototype:void 0,RP=PP?PP.valueOf:void 0;var OP=function(t,e,n,i,r,s,a){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!s(new KC(t),new KC(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return mE(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var o=AP;case"[object Set]":var l=1&i;if(o||(o=CP),t.size!=e.size&&!l)return!1;var c=a.get(t);if(c)return c==e;i|=2,a.set(t,e);var h=EP(o(t),o(e),i,r,s,a);return a.delete(t),h;case"[object Symbol]":if(RP)return RP.call(t)==RP.call(e)}return!1},DP=Object.prototype.hasOwnProperty;var LP=function(t,e,n,i,r,s){var a=1&n,o=DC(t),l=o.length;if(l!=DC(e).length&&!a)return!1;for(var c=l;c--;){var h=o[c];if(!(a?h in e:DP.call(e,h)))return!1}var u=s.get(t),d=s.get(e);if(u&&d)return u==e&&d==t;var p=!0;s.set(t,e),s.set(e,t);for(var f=a;++c<l;){var m=t[h=o[c]],g=e[h];if(i)var v=a?i(g,m,h,e,t,s):i(m,g,h,t,e,s);if(!(void 0===v?m===g||r(m,g,n,i,s):v)){p=!1;break}f||(f="constructor"==h)}if(p&&!f){var y=t.constructor,x=e.constructor;y!=x&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof x&&x instanceof x)&&(p=!1)}return s.delete(t),s.delete(e),p},IP="[object Arguments]",zP="[object Array]",NP="[object Object]",UP=Object.prototype.hasOwnProperty;var kP=function(t,e,n,i,r,s){var a=bT(t),o=bT(e),l=a?zP:$C(t),c=o?zP:$C(e),h=(l=l==IP?NP:l)==NP,u=(c=c==IP?NP:c)==NP,d=l==c;if(d&&NE(t)){if(!NE(e))return!1;a=!0,h=!1}if(d&&!h)return s||(s=new pC),a||WE(t)?EP(t,e,n,i,r,s):OP(t,e,l,n,i,r,s);if(!(1&n)){var p=h&&UP.call(t,"__wrapped__"),f=u&&UP.call(e,"__wrapped__");if(p||f){var m=p?t.value():t,g=f?e.value():e;return s||(s=new pC),r(m,g,n,i,s)}}return!!d&&(s||(s=new pC),LP(t,e,n,i,r,s))};var BP=function t(e,n,i,r,s){return e===n||(null==e||null==n||!vT(e)&&!vT(n)?e!=e&&n!=n:kP(e,n,i,r,t,s))};var FP=function(t,e){return null!=t&&e in Object(t)};var VP=function(t,e,n){for(var i=-1,r=(e=HA(e,t)).length,s=!1;++i<r;){var a=WA(e[i]);if(!(s=null!=t&&n(t,a)))break;t=t[a]}return s||++i!=r?s:!!(r=null==t?0:t.length)&&_E(r)&&pE(a,r)&&(bT(t)||OE(t))};var jP=function(t,e){return null!=t&&VP(t,e,FP)},HP=function(){return aT.Date.now()},GP=Math.max,WP=Math.min;var qP=function(t,e,n){var i,r,s,a,o,l,c=0,h=!1,u=!1,d=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var n=i,s=r;return i=r=void 0,c=e,a=t.apply(s,n)}function f(t){var n=t-l;return void 0===l||n>=e||n<0||u&&t-c>=s}function m(){var t=HP();if(f(t))return g(t);o=setTimeout(m,function(t){var n=e-(t-l);return u?WP(n,s-(t-c)):n}(t))}function g(t){return o=void 0,d&&i?p(t):(i=r=void 0,a)}function v(){var t=HP(),n=f(t);if(i=arguments,r=this,l=t,n){if(void 0===o)return function(t){return c=t,o=setTimeout(m,e),h?p(t):a}(l);if(u)return clearTimeout(o),o=setTimeout(m,e),p(l)}return void 0===o&&(o=setTimeout(m,e)),a}return e=IT(e)||0,PT(n)&&(h=!!n.leading,s=(u="maxWait"in n)?GP(IT(n.maxWait)||0,e):s,d="trailing"in n?!!n.trailing:d),v.cancel=function(){void 0!==o&&clearTimeout(o),c=0,i=l=r=o=void 0},v.flush=function(){return void 0===o?a:g(HP())},v};var XP=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0};var $P=function(t,e){return e.length<2?t:qA(t,aC(e,0,-1))};var YP=function(t,e){return BP(t,e)};var ZP=function(t,e){return e=HA(e,t),null==(t=$P(t,e))||delete t[WA(XP(e))]};var KP=function(t){return sC(t)?void 0:t},JP=JA((function(t,e){var n={};if(null==t)return n;var i=!1;e=xT(e,(function(e){return e=HA(e,t),i||(i=e.length>1),e})),yE(t,LC(t),n),i&&(n=yP(n,7,KP));for(var r=e.length;r--;)ZP(n,e[r]);return n})),QP=JP;var tR=function(t,e,n,i){if(!PT(t))return t;for(var r=-1,s=(e=HA(e,t)).length,a=s-1,o=t;null!=o&&++r<s;){var l=WA(e[r]),c=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return t;if(r!=a){var h=o[l];void 0===(c=i?i(h,l,o):void 0)&&(c=PT(h)?h:pE(e[r+1])?[]:{})}vE(o,l,c),o=o[l]}return t};var eR=function(t,e,n){for(var i=-1,r=e.length,s={};++i<r;){var a=e[i],o=qA(t,a);n(o,a)&&tR(s,HA(a,t),o)}return s};var nR=function(t,e){return eR(t,e,(function(e,n){return jP(t,n)}))},iR=JA((function(t,e){return null==t?{}:nR(t,e)})),rR=iR,sR=class{modifyById(t,e){let n=this;if(void 0===n[t])throw new Error("not expected");{let i={...n,[t]:e};return Object.setPrototypeOf(i,sR.prototype),i}}add(t,e){return this.runOp({type:1,id:t,data:e})?.data??this}runOp(t){let e=this;if(1===t.type){let n,i=e[t.id];n=void 0===i?{type:2,id:t.id}:{type:1,id:t.id,data:i};let{id:r,data:s}=t,a={...e,[r]:s};return Object.setPrototypeOf(a,sR.prototype),{data:a,actual:t,reverse:n}}if(2===t.type){let{id:n}=t,i=e[n];if(void 0===i)return null;{let r={...e};return Object.setPrototypeOf(r,sR.prototype),delete r[n],{data:r,actual:t,reverse:{type:1,id:n,data:i}}}}return null}};function aR(t){if(void 0!==t.deepFreeze)return void t.deepFreeze(t);let e=Object.getOwnPropertyNames(t);for(let n of e){let e=t[n];e&&"object"==typeof e&&aR(e)}return Object.freeze(t)}var oR=class extends Error{};function lR(t){let e={...t};return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),e}function cR(t,e,n){if(void 0===t?void 0===e?(t=0,e=10):t=e-10:void 0===e&&(e=t+10),t>e){let n=t;t=e,e=n}let i=[],r=1/(n+1);for(let s=0;s<n;s++){let n=t+(e-t)*(s+.75+.5*Math.random())*r;i.push(n)}return i}function hR(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array}function uR(t,e){for(let n of t)!0!==e(n.id,n.data)&&uR(n.children,e)}function dR(t,e){if(!0!==e(t.id,t.data))for(let n of t.children)dR(n,e)}var pR,fR=class extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,fR.prototype)}deepFreeze(){let t=0;for(;t<this.length;)aR(this[t]),t++}fillCaches0(t,e){this.objCaches.set(t.id,t),this.parentCaches.set(t.id,e);for(let e of t.children)this.fillCaches0(e,t.id)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,this.parentCaches=new Map;for(let t of this)this.fillCaches0(t,null)}}randomId(){this.fillCaches();let t=Array.from(this.objCaches.keys());if(0!==t.length)return t[Math.max(0,Math.floor(Math.random()*t.length)-1)]}nonExistOrDescendantOf(t,e){if(!this.has(t))return!0;for(;t;){let n=this.parent(t);if(n===e)return!0;t=n}return!1}rootAcestor(t){for(;t;){let e=this.parent(t);if(!e)return t;t=e}return t}isDescendantOf(t,e){for(;t;){let n=this.parent(t);if(n===e)return!0;t=n}return!1}data(t){return this.get(t)?.data}has(t){return void 0!==this.childrenOf(t)}get(t){return this.fillCaches(),this.objCaches.get(t)}childrenOf(t){return null===t?this:this.get(t)?.children}traverseFrom(t,e){if(null===t)this.traverse(e);else{let n=this.get(t);n&&dR(n,e)}}traverse(t){uR(this,t)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(t){return this.fillCaches(),this.parentCaches.get(t)}childrenArray(t){return null===t?this:this.get(t).children}modifyById(t,e){if(void 0===this.get(t))throw new Error("not expected");{let n=this.parent(t),i=this.childrenArray(n),r=i.findIndex((e=>e.id===t));if(r<0)throw new Error("not expected");let s=i[r];return i=[...i],i[r]={...s,data:e},this.modifyArrayBy(n,i)}}modifyArrayBy(t,e){let n=t,i=e;for(;null!==n;){let t=i,e=n;if(n=this.parent(n),void 0===n)throw new Error;i=this.childrenArray(n);let r=i.findIndex((t=>t.id===e));if(r<0)throw new Error;i=[...i],i[r]={...i[r],children:t}}Object.setPrototypeOf(i,fR.prototype);let r=i;return r.fillCaches(),r}runOp(t){switch(t.type){case 7:return this.addOp(t);case 8:return this.deleteOp(t);case 9:return this.moveOp(t)}return null}checkDuplicatedIdRec({id:t,children:e}){if(void 0!==this.get(t))return!0;for(let t of e)if(this.checkDuplicatedIdRec(t))return!0;return!1}addOp(t){let{parent:e,fi:n,id:i,data:r,children:s}=t;if(null!==e&&void 0===this.get(e))return null;if(this.checkDuplicatedIdRec(t))return null;{let a=e,o=this.childrenArray(a),l={fi:n,id:i,data:r,children:s};return o=[...o,l],o.sort(((t,e)=>t.fi-e.fi)),t.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:t,reverse:{type:8,id:i}}}}deleteOp(t){let{id:e}=t;if(null===this.get(e))return null;{let n=this.parent(e);if(void 0===n)return null;let i=this.childrenArray(n),r=i.findIndex((t=>t.id===e));t.localIndex=r,i=[...i];let s=i.splice(r,1)[0];return{data:this.modifyArrayBy(n,i),actual:t,reverse:{type:7,...s,parent:n}}}}moveOp(t){let{parent:e,fi:n,id:i}=t;if(null!==e&&void 0===this.get(e))return this.deleteOp({type:8,id:i});if(null!==e){let t=e;for(;null!==t;){if(void 0===t)throw new Error;if(t===i)throw new oR("cyclic tree");t=this.parent(t)}}let r=this.parent(i);if(void 0===r)return null;let s=r,a=this.childrenArray(r),o=a.findIndex((t=>t.id===i));a=[...a];let l=a.splice(o,1)[0],c=this.modifyArrayBy(r,a);r=e,a=c.childrenArray(r);let h=l.fi;return l={...l,fi:n},a=[...a,l],a.sort(((t,e)=>t.fi-e.fi)),t.localIndex=a.indexOf(l),c=c.modifyArrayBy(r,a),{data:c,actual:t,reverse:{type:9,parent:s,fi:h,id:i}}}previous(t,e){if(null===e){let e=this.childrenArray(t);return 0===e.length?null:e[e.length-1].id}let n=null;for(let i of this.childrenArray(t)){if(i.id===e)return n;n=i.id}return null}traverseSortNext(t){let e=this.parent(t);if(void 0!==e){let n=this.childrenArray(e),i=n.findIndex((e=>e.id===t))+1;if(i<n.length)return n[i].id;if(e)return this.traverseSortNext(e)}}sortNext(t){let e=this.childrenArray(t);return e.length>0?e[0].id:this.traverseSortNext(t)}traverseSortPrevious(t){let e=this.childrenArray(t);return e.length>0?this.traverseSortPrevious(e[e.length-1].id):t}sortPrevious(t){let e=this.parent(t);if(void 0!==e){let n=this.childrenArray(e),i=n.findIndex((e=>e.id===t))-1;return i>=0?this.traverseSortPrevious(n[i].id):e}}getAllSorted(t){let e=[];for(let n of t){let t=this.getWithSortKey(n.id);void 0!==t&&e.push({...n,...t})}e.sort(((t,e)=>function(t,e){let n=0;for(;n<t.length&&n<e.length;){if(t[n]<e[n])return-1;if(t[n]>e[n])return 1;n+=1}return n!==e.length?-1:n!==t.length?1:0}(t.sortKey,e.sortKey)));for(let t of e)delete t.sortKey;return e}getWithSortKey(t){var e=t;let n=[],i=this.get(e),r=i;if(void 0!==i){for(;e;)n.splice(0,0,i.fi),null!==(e=this.parent(e))&&(i=this.get(e));return{...r,sortKey:n}}}insertBeforeHelper(t,e,n){return this.insertAfterHelper(t,this.previous(t,e),n)}insertAfterHelper(t,e,n){let i=this.childrenArray(t);if(null===e){if(0===i.length)return cR(0,n,n);{let t=i[0].fi;return cR(t-n,t,n)}}{let r=this.get(e);if(void 0===r||this.parent(e)!==t)throw new Error("illegal args");let s=i.find((t=>t.fi>r.fi));if(void 0===s){let t=i[i.length-1].fi;return cR(t,t+n,n)}return cR(r.fi,s.fi,n)}}};(pR||(pR={})).runOp=function(t,e){if(0!==e.type)return null;if(Array.isArray(t)){let n=e.props,i={},r=[...t],s=!1;if(n)for(let t of Object.keys(n)){let e=parseInt(t);if(isNaN(e))throw new Error("wrong index");i[t]=r[e],r[e]=n[t],s=!0}return s?{data:r,actual:e,reverse:{type:0,props:i}}:null}{let n=e.props,i={},r={...t},s=!1;if(n)for(let t of Object.keys(n)){i[t]=r[t];let e=n[t];void 0===e?delete r[t]:r[t]=e,s=!0}return s?{data:r,actual:e,reverse:{type:0,props:i}}:null}};var mR=class extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,mR.prototype)}deepFreeze(){let t=0;for(;t<this.length;)aR(this[t]),t++}fillCaches0(t){this.objCaches.set(t.id,t)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let t of this)this.fillCaches0(t)}}randomId(){this.fillCaches();let t=Array.from(this.objCaches.keys());if(0!==t.length)return t[Math.max(0,Math.floor(Math.random()*t.length)-1)]}data(t){return this.get(t)?.data}get(t){return this.fillCaches(),this.objCaches.get(t)}modifyById(t,e){if(void 0===this.get(t))throw new Error("not expected");{let n=this,i=n.findIndex((e=>e.id===t));if(i<0)throw new Error("not expected");let r=n[i];return n=[...n],n[i]={...r,data:e},this.modifyArrayBy(n)}}modifyArrayBy(t){Object.setPrototypeOf(t,mR.prototype);let e=t;return typeof process<"u"||e.fillCaches(),e}runOp(t){switch(t.type){case 4:return this.addOp(t);case 5:return this.deleteOp(t);case 6:return this.moveOp(t)}return null}addOp(t){let{fi:e,id:n,data:i}=t,r=this,s={fi:e,id:n,data:i};return r=[...r,s],r.sort(((t,e)=>t.fi-e.fi)),t.localIndex=r.indexOf(s),{data:this.modifyArrayBy(r),actual:t,reverse:{type:5,id:n}}}deleteOp(t){let{id:e}=t,n=this,i=n.findIndex((t=>t.id===e));if(-1===i)return null;t.localIndex=i,n=[...n];let r=n.splice(i,1)[0];return{data:this.modifyArrayBy(n),actual:t,reverse:{type:4,...r}}}moveOp(t){let{fi:e,id:n}=t,i=this;i=[...i];let r=i.findIndex((t=>t.id===n));if(-1===r)return null;let s=i[r].fi,a={...i[r],fi:e};return i[r]=a,i.sort(((t,e)=>t.fi-e.fi)),t.localIndex=i.indexOf(a),{data:this.modifyArrayBy(i),actual:t,reverse:{type:6,fi:s,id:n}}}previous(t){if(null===t)return 0===this.length?null:this[this.length-1].id;let e=null;for(let n of this){if(n.id===t)return e;e=n.id}return null}insertBeforeHelper(t,e){return this.insertAfterHelper(this.previous(t),e)}insertAfterHelper(t,e){let n=this;if(null===t){if(0===n.length)return cR(0,e,e);{let t=n[0].fi;return cR(t-e,t,e)}}{let i=this.get(t);if(void 0===i)throw new Error("illegal args");let r=n.find((t=>t.fi>i.fi));if(void 0===r){let t=n[n.length-1].fi;return cR(t,t+e,e)}return cR(i.fi,r.fi,e)}}};function gR(t){return t&&"object"==typeof t&&t instanceof _R}var vR,yR,xR,bR,_R=class{unusedFunOverridesTable(t){}runOp(t){let e=[],n=this,i=0,r={};for(;i<t.path.length;){if(e.push(n),n=void 0===n?void 0:n[t.path[i]],void 0!==n&&!gR(n))return null;i+=1}n=n?lR(n):new _R;for(let[e,i]of Object.entries(t.props)){let t=n[e];r[e]=t,void 0===i?delete n[e]:n[e]=i}for(;i>0;){if(0===Object.keys(n).length){let r=e[i-1];r&&(n=lR(r),delete n[t.path[i-1]])}else{let r=e[i-1];if(r){let e=lR(r);e[t.path[i-1]]=n,n=e}else{let e=new _R;e[t.path[i-1]]=n,n=e}}i-=1}return{data:Object.setPrototypeOf(n,_R.prototype),actual:t,reverse:{...t,props:r}}}};function wR(t,e){if(void 0===e)return;let n=!1,i=t.map((t=>{let i=t.id,r=SR(t.data,e[i]);if(n=n||void 0!==r,void 0===r&&(r=t.data),t.children){let s=wR(t.children,e);return void 0!==s?n=!0:s=t.children,{...t,id:i,data:r,children:s}}return{...t,id:i,data:r}}));return n?i:void 0}function SR(t,e){if(!gR(e))return e;if(t instanceof fR){let n=wR(t,e);return void 0!==n&&Object.setPrototypeOf(n,Object.getPrototypeOf(t)),n}if(t instanceof mR)return function(t,e){if(void 0===e)return;let n=!1,i=t.map((t=>{let i=t.id,r=SR(t.data,e[i]);return n=n||void 0!==r,void 0===r&&(r=t.data),{...t,id:i,data:r}}));return n?(Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i):void 0}(t,e);if(Array.isArray(t)){let n=!1,i=t.map(((t,i)=>{let r=SR(t,e[i]);return n=n||void 0!==r,void 0===r&&(r=t),r}));return n?(Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i):void 0}if(t instanceof _R)return MR(t,e);if(t&&"object"==typeof t){let n={},i=!1;for(let[r,s]of Object.entries(t)){let t=SR(s,e[r]);i=i||void 0!==t,void 0===t&&(t=s),n[r]=t}return i?(Object.setPrototypeOf(n,Object.getPrototypeOf(t)),n):void 0}}function MR(t,e){if(void 0===t)return e;if(void 0===e)return t;if(!gR(e))return e;if(!gR(t))return vR.apply(t,e);let n=new Set;for(let e of Object.keys(t))n.add(e);for(let t of Object.keys(e))n.add(t);let i=new _R;for(let r of n){let n=MR(void 0===t?void 0:t[r],void 0===e?void 0:e[r]);i[r]=n}return i}function TR(t,e){let n={cur:[],result:[],len:0};return[t=PR(t,e,n)??t,n.result]}function ER(t,e){return null===t?null:(t.cur[t.len]=e,t.len+=1,t)}function AR(t){t&&(t.len-=1)}function CR(t,e,n){let i=!1,r=t.map((t=>{let r=t.id,s=e[r];if(void 0!==s&&"string"==typeof s&&(i=!0,r=s,null!==n))throw new Error("not supported");let a=PR(t.data,e,ER(n,r));AR(n),i=i||void 0!==a,void 0===a&&(a=t.data);let o=CR(t.children,e,n);return void 0!==o?i=!0:o=t.children,{...t,id:r,data:a,children:o}}));if(i)return r}function PR(t,e,n){if(t instanceof fR){let i=CR(t,e,n);return void 0!==i&&Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i}if(t instanceof mR)return function(t,e,n){let i=!1,r=t.map((t=>{let r=t.id,s=e[r];if(void 0!==s&&"string"==typeof s&&(i=!0,r=s,null!==n))throw new Error("not supported");let a=PR(t.data,e,ER(n,r));return AR(n),i=i||void 0!==a,void 0===a&&(a=t.data),{...t,id:r,data:a}}));if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r}(t,e,n);if(Array.isArray(t)){let i=!1,r=t.map(((t,r)=>{let s=PR(t,e,ER(n,r));return AR(n),i=i||void 0!==s,void 0===s&&(s=t),s}));return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r):void 0}if(t&&"object"==typeof t&&!hR(t)){let i={},r=!1;for(let[s,a]of Object.entries(t))if("name"!==s&&"variableId"!==s){let t=e[s];if("string"==typeof t){if(null!==n)throw new Error("not supported");r=!0,s=t}let o=PR(a,e,ER(n,s));AR(n),r=r||void 0!==o,void 0===o&&(o=a),i[s]=o}else i[s]=a;return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i):void 0}if("string"==typeof t){let i=e[t];return void 0!==i&&function(t){if(null===t)return null;t.result.push(t.cur.slice(0,t.len))}(n),i}}(t=>{t.apply=function(t,e){return SR(t,e)??t},t.merge=function(t,e){return MR(t,e)},t.filterOp=function(t,e){let n=0,i=e.path,r=t;for(;n<i.length&&void 0!==r;){if(r=jR.zoomOnce(r,i[n]),void 0===r)return e;if(!gR(r))return;n+=1}if(void 0===r)return e;if(gR(r)){if(0===e.type){let t={...e.props};for(let e of Object.keys(r))delete t[e];return{...e,props:t}}if(1===e.type||4===e.type||7===e.type){let t=wR([e],r);return t?(console.log(t),t):e}return e}}})(vR||(vR={})),(t=>{t.replaceProps=function(t,e){let n=jR.zoom(e,t.path);if("object"==typeof n){let e={};for(let i of Object.keys(t.props))e[i]=n[i];return{...t,props:e}}return{...t,props:{}}}})(yR||(yR={})),(t=>{function e(t,e){let n=e.path;for(var i=[];;){let r;if(t instanceof _R&&0===e.type&&(r=t.runOp({...e,path:n.slice(i.length)}),null===r&&(r=void 0)),void 0===r&&i.length===n.length&&(r=t instanceof fR||t instanceof mR||t instanceof sR?t.runOp(e):pR.runOp(t,e)),void 0!==r){if(null!==r){let t=r.data;for(let e=i.length-1;e>=0;e--){let r=n[e],s=i[e];if(s instanceof fR){if("number"==typeof r)throw new Error("illegal arg");t=s.modifyById(r,t)}else if(s instanceof mR){if("number"==typeof r)throw new Error("illegal arg");t=s.modifyById(r,t)}else if(s instanceof sR){if("number"==typeof r)throw new Error("illegal arg");t=s.modifyById(r,t)}else if(s instanceof _R){let e={...s,[r]:t};t=Object.setPrototypeOf(e,_R.prototype)}else{if("object"!=typeof s)return null;if(Array.isArray(s)){if("string"==typeof r&&(r=parseInt(r),isNaN(r)))throw new Error("Invalid path");let e=t;t=[...s],t[r]=e}else t={...s,[r]:t}}}return{data:t,actual:{...r.actual,path:n},reverse:{...r.reverse,path:n}}}return null}let s,a=n[i.length];if(t instanceof fR){if("number"==typeof a)throw new Error("");s=t.get(a)?.data}else if(t instanceof mR){if("number"==typeof a)throw new Error("");s=t.get(a)?.data}else null!==t&&(s=t[a]);if(void 0===s)return null;i.push(t),t=s}}function n(t,e){for(let n=0;n<t.length&&n<e.length;n++)if(t[n]!==e[n])return!0;return!1}function i(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}t.drop=function(t,e){return{...t,path:t.path.slice(e)}},t.applySimple=function(t,n){return e(t,n)?.data??t},t.apply=e,t.pathDisjoint=n,t.pathEq=i,t.commutative=function(t,e){return n(t.path,e.path)},t.subsumed=function(t,e){return!(0!==t.type||0!==e.type||!i(t.path,e.path))&&Object.keys(t.props).every((t=>void 0!==e.props[t]))}})(xR||(xR={})),(t=>{function e(t,e){var n=t;let i=[],r=[];for(let t of e)try{if(3===t.type||5===t.type&&"variables"===t.path[t.path.length-1]){let e,s,a;if(3===t.type?(e=jR.zoom(n,[...t.path,t.id]),a=xR.apply(n,{...t,type:2})):(e=jR.zoom(n,[...t.path,t.id,"value"]),a=xR.apply(n,t)),null!==a){n=a.data;let[o,l]=TR(n,{[t.id]:e});n=o;for(let a=0;a<l.length;a++){let o=l[a],c=o.pop();if("number"==typeof c){let i=[c];for(let t=a+1;t<l.length;t++){let e=l[t],n=e[e.length-1];if("number"!=typeof n||!jR.equal(o,e.slice(0,e.length-1)))break;i.push(n),l.splice(t,1)}let r=jR.zoom(n,o);s=r.map(((e,n)=>i.includes(n)?t.id:e)),e=r,c=o.pop()}else{if("alphaOverride"===c||"alpha"===c){e/=100;let t=e,i=jR.zoom(n,o.slice(0,o.length-2)),r=i.layers.map((e=>e.id===o[o.length-1]?{...e,data:{...e.data,[c]:t}}:e));Object.setPrototypeOf(r,Object.getPrototypeOf(i.layers)),i.layers=r}s=t.id}i.push({type:0,path:o,props:{[c]:e}}),r.push({type:0,path:o,props:{[c]:s}})}r.push(a.reverse),i.push(a.actual)}}else{let e=xR.apply(n,t);null!==e&&(i.push(e.actual),n=e.data,r.push(e.reverse))}}catch(t){if(t instanceof oR)return null;throw t}return{data:n,actual:i,reverse:r.reverse()}}t.empty=function(){return[]},t.removePrefix=function(t,e){let n=[];for(let i of t){let[t,...r]=i.path;t===e&&n.push({...i,path:r})}return n},t.addPrefix=function(t,e){return t.map((t=>({...t,path:[e,...t.path]})))},t.concat=function(t,e){return[...t,...e]},t.compress=function(t,e){return[...t.filter((t=>!e.some((e=>xR.subsumed(t,e))))),...e]},t.commutative=function(t,e){return t.every((t=>e.every((e=>xR.commutative(t,e)))))},t.applyAll=function(t,n){for(let i of n){let n=e(t,i);null!==n&&(t=n.data)}return t},t.apply=e})(bR||(bR={}));var RR=Symbol(),OR=Symbol(),DR=Symbol(),LR=class{reportOp(t,e,n=[]){let i=this;if(null===e)return;i._current=e.data;let r=n;for(;!(i instanceof HR);){let t=i._path,e=i._current;if(""!==t&&r.splice(0,0,t),i=i._parent,null===i)return;i.update(t,e)}i.push(r,t,e.actual,e.reverse)}deleteChildren(t){if(this._children){let e=this._children[t];if(e){let n=e[DR];n&&n(),delete this._children[t]}}}},IR=class extends LR{constructor(t,e,n){super(),this._parent=t,this._path=e,this._current=n}update(t,e){if(Array.isArray(this._current)){if("string"==typeof t&&(t=parseInt(t),isNaN(t)))throw new Error("Invalid path");this._current=[...this._current],this._current[t]=e}else this._current={...this._current,[t]:e}}runOp(t){this.reportOp(t,pR.runOp(this._current,t),t.path)}},zR=class extends LR{constructor(t,e,n){super(),this._parent=t,this._path=e,this._current=n}update(t,e){this._current={...this._current,[t]:e},Object.setPrototypeOf(this._current,sR.prototype)}runOp(t){this.reportOp(t,this._current.runOp(t))}},NR={get(t,e){if(e===DR)return()=>{t._parent=null};if(e===RR)return t._current;if(e===OR)return t;let{_current:n,_children:i}=t;if("push"===e&&Array.isArray(n))throw new Error("not supported to expand array");let r=void 0===i?void 0:i[e];if(void 0!==r)return r;let s=n[e],a=GR(t,e,s);return a!==s?(void 0===i&&(i={},t._children=i),i[e]=a,a):s},has:(t,e)=>e in t._current,ownKeys:t=>Reflect.ownKeys(t._current),defineProperty(){throw Error("not supported")},getPrototypeOf:t=>Object.getPrototypeOf(t._current),setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(t,e){let n=t._current,i=Reflect.getOwnPropertyDescriptor(n,e);return i&&{writable:!0,configurable:!0,enumerable:i.enumerable,value:n[e]}}},UR={...NR,set(t,e,n){let i={type:0,props:{[e]:XR(n)??n}};return t.deleteChildren(e),t.runOp(i),!0},deleteProperty(t,e){let n={type:0,props:{[e]:void 0}};return t.deleteChildren(e),t.runOp(n),!0}},kR={...NR,set(t,e,n){return void 0===n?this.deleteProperty(t,e):(t.deleteChildren(e),t.runOp({type:1,id:e,data:n})),!0},deleteProperty:(t,e)=>(t.runOp({type:2,id:e}),!0)},BR=class extends LR{constructor(t,e,n){super(),this._children={},this._parent=t,this._path=e,this._current=n,this[DR]=()=>{this._parent=null}}unproxy(){return this._current}update(t,e){this._current=this._current.modifyById(t,e)}runOp(t){this.reportOp(t,this._current.runOp(t))}randomId(){return this._current.randomId()}isDescendantOf(t,e){return this._current.isDescendantOf(t,e)}childrenOf(t){return this._current.childrenOf(t)}traverse(t){return this._current.traverse(t)}get(t){return this._current.get(t)}parent(t){return this._current.parent(t)}traverse(t){this._current.traverse(((e,n)=>{t(e,this.data(e))}))}data(t){let{_current:e,_children:n}=this,i=void 0===n?void 0:n[t];if(void 0!==i)return i;let r=e.get(t)?.data,s=GR(this,t,r);return s!==r?(void 0===n&&(n={},this._children=n),n[t]=s,s):r}add(t,e,n,i,r){this.runOp({type:7,parent:t,fi:e,id:n,data:i,children:r})}move(t,e,n){this.runOp({type:9,parent:t,fi:e,id:n})}insertAfter(t,e,n){let i=this._current.insertAfterHelper(t,e,n.length);for(let e=0;e<n.length;e++){let r=n[e];this.add(t,i[e],r.id,r.data,r.children)}}insertBefore(t,e,n){let i=this._current.insertBeforeHelper(t,e,n.length);for(let e=0;e<n.length;e++){let r=n[e];this.add(t,i[e],r.id,r.data,r.children)}}moveAfter(t,e,n){let i=this._current.insertAfterHelper(t,e,n.length);for(let e=0;e<n.length;e++){let r=n[e];this.move(t,i[e],r)}}moveBefore(t,e,n){let i=this._current.insertBeforeHelper(t,e,n.length);for(let e=0;e<n.length;e++){let r=n[e];this.move(t,i[e],r)}}delete(t){this.deleteChildren(t),this.runOp({type:8,id:t})}sortNext(t){return this._current.sortNext(t)}sortPrevious(t){return this._current.sortPrevious(t)}getAllSorted(t){return this._current.getAllSorted(t)}},FR=class extends LR{constructor(t,e,n){super(),this._children={},this._parent=t,this._path=e,this._current=n,this[DR]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(t){let e=this.length;for(let n=0;n<e;n++){let e=this._current[n].id,i=this._current[n].fi;t(this.data(this._current[n].id),e,i)}}find(t){let e=this.length;for(let n=0;n<e;n++){let e=this._current[n].id;if(t(this.data(e),e))return this.get(e)}}update(t,e){this._current=this._current.modifyById(t,e)}randomId(){return this._current.randomId()}get(t){return{...this._current.get(t),data:this.data(t)}}data(t){let{_current:e,_children:n}=this,i=void 0===n?void 0:n[t];if(void 0!==i)return i;let r=e.get(t)?.data,s=GR(this,t,r);return s!==r?(void 0===n&&(n={},this._children=n),n[t]=s,s):r}runOp(t){this.reportOp(t,this._current.runOp(t))}add(t,e,n){this.runOp({type:4,fi:t,id:e,data:n})}move(t,e){this.runOp({type:6,fi:t,id:e})}insertAfter(t,e){let n=this._current.insertAfterHelper(t,e.length);for(let t=0;t<e.length;t++){let i=e[t];this.add(n[t],i.id,i.data)}}insertBefore(t,e){let n=this._current.insertBeforeHelper(t,e.length);for(let t=0;t<e.length;t++){let i=e[t];this.add(n[t],i.id,i.data)}}moveAfter(t,e){let n=this._current.insertAfterHelper(t,e.length);for(let t=0;t<e.length;t++){let i=e[t];this.move(n[t],i)}}moveBefore(t,e){let n=this._current.insertBeforeHelper(t,e.length);for(let t=0;t<e.length;t++){let i=e[t];this.move(n[t],i)}}delete(t){this.deleteChildren(t),this.runOp({type:5,id:t})}};function VR(t,e,n){if(t.length>0){let i=t[t.length-1];if(0===i.type&&0===e.type&&jR.equal(i.path,n))return void Object.assign(i.props,e.props)}t.push({...e,path:n})}var jR,HR=class extends LR{constructor(t){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=t}update(t,e){if(""!==t)throw new Error("");this._current=e}push(t,e,n,i){VR(this.ts,e,t),VR(this.actual,n,t),VR(this.reverse,i,t)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function GR(t,e,n){return n instanceof fR?new BR(t,e,n):n instanceof mR?new FR(t,e,n):n instanceof sR?new Proxy(new zR(t,e,n),kR):null!==n&&"object"==typeof n?hR(n)?n:new Proxy(new IR(t,e,n),UR):n}function WR(t){let e=new HR(t);return[GR(e,"",t),e]}function qR(t,e){let[n,i]=WR(t);return e(n),i.result()}function XR(t){return t instanceof BR||t instanceof FR?t._current:null!==t&&"object"==typeof t?t[RR]:t}function $R(t,e){let n=[];if(!(e.length<=t.length))return null;for(var i=0;i<e.length;){if("*"===e[i])n.push(t[i]);else if(t[i]!==e[i])return null;i+=1}return n}(t=>{function e(t,e){return(t instanceof fR||t instanceof BR)&&"string"==typeof e||(t instanceof mR||t instanceof FR)&&"string"==typeof e?t.data(e):"number"==typeof e&&Array.isArray(t)||"string"==typeof e&&"object"==typeof t&&null!==t?t[e]:void 0}function n(t,n,i=0){for(;i<n.length&&void 0!==t;)t=e(t,n[i]),i+=1;return t}t.equal=function(t,e){if(e.length!==t.length)return!1;for(var n=0;n<t.length;){if(t[n]!==e[n])return!1;n+=1}return!0},t.removeOverridden=function(t,e,i){let r=n(i,t);if(void 0!==r&&"object"==typeof r&&null!==r){let t={...e};return Object.keys(r).forEach((e=>{delete t[e]})),t}return e},t.zoomOnce=e,t.zoom=n})(jR||(jR={}));var YR,ZR=class{},KR=class extends ZR{constructor(t){super(),this.id=t}},JR=class extends ZR{constructor(t){super(),this.data=t}};try{YR=new TextDecoder}catch{}var QR,tO,eO,nO,iO,rO,sO,aO=0,oO=[],lO=oO,cO=0,hO={},uO=0,dO=0,pO=[],fO={useRecords:!1,mapsAsObjects:!0},mO=class{},gO=new mO;gO.name="MessagePack 0xC1";var vO=!1,yO=class{constructor(t){t&&(!1===t.useRecords&&void 0===t.mapsAsObjects&&(t.mapsAsObjects=!0),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0)),Object.assign(this,t)}unpack(t,e){if(QR)return HO((()=>(GO(),this?this.unpack(t,e):yO.prototype.unpack.call(fO,t,e))));tO=e>-1?e:t.length,aO=0,cO=0,dO=0,nO=null,lO=oO,iO=null,QR=t;try{sO=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(e){throw QR=null,t instanceof Uint8Array?e:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&"object"==typeof t?t.constructor.name:typeof t))}if(this instanceof yO){if(hO=this,this.structures)return eO=this.structures,xO();(!eO||eO.length>0)&&(eO=[])}else hO=fO,(!eO||eO.length>0)&&(eO=[]);return xO()}unpackMultiple(t,e){let n,i=0;try{vO=!0;let r=t.length,s=this?this.unpack(t,r):XO.unpack(t,r);if(!e){for(n=[s];aO<r;)i=aO,n.push(xO());return n}for(e(s);aO<r;)if(i=aO,!1===e(xO()))return}catch(t){throw t.lastPosition=i,t.values=n,t}finally{vO=!1,GO()}}_mergeStructures(t,e){for(let e=0,n=(t=t||[]).length;e<n;e++){let n=t[e];n&&(n.isShared=!0,e>=32&&(n.highByte=e-32>>5))}t.sharedLength=t.length;for(let n in e||[])if(n>=0){let i=t[n],r=e[n];r&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[n]=i),t[n]=r)}return this.structures=t}decode(t,e){return this.unpack(t,e)}};function xO(){try{if(!hO.trusted&&!vO){let t=eO.sharedLength||0;t<eO.length&&(eO.length=t)}let t=_O();if(aO==tO)eO.restoreStructures&&bO(),eO=null,QR=null,rO&&(rO=null);else{if(aO>tO){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}if(!vO)throw new Error("Data read, but end of buffer not reached")}return t}catch(t){throw eO.restoreStructures&&bO(),GO(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer"))&&(t.incomplete=!0),t}}function bO(){for(let t in eO.restoreStructures)eO[t]=eO.restoreStructures[t];eO.restoreStructures=null}function _O(){let t=QR[aO++];if(t<160){if(t<128){if(t<64)return t;{let e=eO[63&t]||hO.getStructures&&TO()[63&t];return e?(e.read||(e.read=SO(e,63&t)),e.read()):t}}if(t<144){if(t-=128,hO.mapsAsObjects){let e={};for(let n=0;n<t;n++)e[BO()]=_O();return e}{let e=new Map;for(let n=0;n<t;n++)e.set(_O(),_O());return e}}{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=_O();return e}}if(t<192){let e=t-160;if(dO>=aO)return nO.slice(aO-uO,(aO+=e)-uO);if(0==dO&&tO<140){let t=e<16?zO(e):IO(e);if(null!=t)return t}return EO(e)}{let e;switch(t){case 192:return null;case 193:return iO?(e=_O(),e>0?iO[1].slice(iO.position1,iO.position1+=e):iO[0].slice(iO.position0,iO.position0-=e)):gO;case 194:return!1;case 195:return!0;case 196:return NO(QR[aO++]);case 197:return e=sO.getUint16(aO),aO+=2,NO(e);case 198:return e=sO.getUint32(aO),aO+=4,NO(e);case 199:return UO(QR[aO++]);case 200:return e=sO.getUint16(aO),aO+=2,UO(e);case 201:return e=sO.getUint32(aO),aO+=4,UO(e);case 202:if(e=sO.getFloat32(aO),hO.useFloat32>2){let t=WO[(127&QR[aO])<<1|QR[aO+1]>>7];return aO+=4,(t*e+(e>0?.5:-.5)|0)/t}return aO+=4,e;case 203:return e=sO.getFloat64(aO),aO+=8,e;case 204:return QR[aO++];case 205:return e=sO.getUint16(aO),aO+=2,e;case 206:return e=sO.getUint32(aO),aO+=4,e;case 207:return hO.int64AsNumber?(e=4294967296*sO.getUint32(aO),e+=sO.getUint32(aO+4)):e=sO.getBigUint64(aO),aO+=8,e;case 208:return sO.getInt8(aO++);case 209:return e=sO.getInt16(aO),aO+=2,e;case 210:return e=sO.getInt32(aO),aO+=4,e;case 211:return hO.int64AsNumber?(e=4294967296*sO.getInt32(aO),e+=sO.getUint32(aO+4)):e=sO.getBigInt64(aO),aO+=8,e;case 212:if(e=QR[aO++],114==e)return FO(63&QR[aO++]);{let t=pO[e];if(t)return t.read?(aO++,t.read(_O())):t.noBuffer?(aO++,t()):t(QR.subarray(aO,++aO));throw new Error("Unknown extension "+e)}case 213:return e=QR[aO],114==e?(aO++,FO(63&QR[aO++],QR[aO++])):UO(2);case 214:return UO(4);case 215:return UO(8);case 216:return UO(16);case 217:return e=QR[aO++],dO>=aO?nO.slice(aO-uO,(aO+=e)-uO):AO(e);case 218:return e=sO.getUint16(aO),dO>=(aO+=2)?nO.slice(aO-uO,(aO+=e)-uO):CO(e);case 219:return e=sO.getUint32(aO),dO>=(aO+=4)?nO.slice(aO-uO,(aO+=e)-uO):PO(e);case 220:return e=sO.getUint16(aO),aO+=2,OO(e);case 221:return e=sO.getUint32(aO),aO+=4,OO(e);case 222:return e=sO.getUint16(aO),aO+=2,DO(e);case 223:return e=sO.getUint32(aO),aO+=4,DO(e);default:if(t>=224)return t-256;if(void 0===t){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}throw new Error("Unknown MessagePack token "+t)}}}var wO=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function SO(t,e){function n(){if(n.count++>2){let n=t.read=new Function("r","return function(){return {"+t.map((t=>wO.test(t)?t+":r()":"["+JSON.stringify(t)+"]:r()")).join(",")+"}}")(_O);return 0===t.highByte&&(t.read=MO(e,t.read)),n()}let i={};for(let e=0,n=t.length;e<n;e++){i[t[e]]=_O()}return i}return n.count=0,0===t.highByte?MO(e,n):n}var MO=(t,e)=>function(){let n=QR[aO++];if(0===n)return e();let i=t<32?-(t+(n<<5)):t+(n<<5),r=eO[i]||TO()[i];if(!r)throw new Error("Record id is not defined for "+i);return r.read||(r.read=SO(r,t)),r.read()};function TO(){let t=HO((()=>(QR=null,hO.getStructures())));return eO=hO._mergeStructures(t,eO)}var EO=RO,AO=RO,CO=RO,PO=RO;function RO(t){let e;if(t<16&&(e=zO(t)))return e;if(t>64&&YR)return YR.decode(QR.subarray(aO,aO+=t));let n=aO+t,i=[];for(e="";aO<n;){let t=QR[aO++];if(128&t)if(192==(224&t)){let e=63&QR[aO++];i.push((31&t)<<6|e)}else if(224==(240&t)){let e=63&QR[aO++],n=63&QR[aO++];i.push((31&t)<<12|e<<6|n)}else if(240==(248&t)){let e=(7&t)<<18|(63&QR[aO++])<<12|(63&QR[aO++])<<6|63&QR[aO++];e>65535&&(e-=65536,i.push(e>>>10&1023|55296),e=56320|1023&e),i.push(e)}else i.push(t);else i.push(t);i.length>=4096&&(e+=LO.apply(String,i),i.length=0)}return i.length>0&&(e+=LO.apply(String,i)),e}function OO(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=_O();return e}function DO(t){if(hO.mapsAsObjects){let e={};for(let n=0;n<t;n++)e[BO()]=_O();return e}{let e=new Map;for(let n=0;n<t;n++)e.set(_O(),_O());return e}}var LO=String.fromCharCode;function IO(t){let e=aO,n=new Array(t);for(let i=0;i<t;i++){let t=QR[aO++];if((128&t)>0)return void(aO=e);n[i]=t}return LO.apply(String,n)}function zO(t){if(t<4){if(t<2){if(0===t)return"";{let t=QR[aO++];return(128&t)>1?void(aO-=1):LO(t)}}{let e=QR[aO++],n=QR[aO++];if((128&e)>0||(128&n)>0)return void(aO-=2);if(t<3)return LO(e,n);let i=QR[aO++];return(128&i)>0?void(aO-=3):LO(e,n,i)}}{let e=QR[aO++],n=QR[aO++],i=QR[aO++],r=QR[aO++];if((128&e)>0||(128&n)>0||(128&i)>0||(128&r)>0)return void(aO-=4);if(t<6){if(4===t)return LO(e,n,i,r);{let t=QR[aO++];return(128&t)>0?void(aO-=5):LO(e,n,i,r,t)}}if(t<8){let s=QR[aO++],a=QR[aO++];if((128&s)>0||(128&a)>0)return void(aO-=6);if(t<7)return LO(e,n,i,r,s,a);let o=QR[aO++];return(128&o)>0?void(aO-=7):LO(e,n,i,r,s,a,o)}{let s=QR[aO++],a=QR[aO++],o=QR[aO++],l=QR[aO++];if((128&s)>0||(128&a)>0||(128&o)>0||(128&l)>0)return void(aO-=8);if(t<10){if(8===t)return LO(e,n,i,r,s,a,o,l);{let t=QR[aO++];return(128&t)>0?void(aO-=9):LO(e,n,i,r,s,a,o,l,t)}}if(t<12){let c=QR[aO++],h=QR[aO++];if((128&c)>0||(128&h)>0)return void(aO-=10);if(t<11)return LO(e,n,i,r,s,a,o,l,c,h);let u=QR[aO++];return(128&u)>0?void(aO-=11):LO(e,n,i,r,s,a,o,l,c,h,u)}{let c=QR[aO++],h=QR[aO++],u=QR[aO++],d=QR[aO++];if((128&c)>0||(128&h)>0||(128&u)>0||(128&d)>0)return void(aO-=12);if(t<14){if(12===t)return LO(e,n,i,r,s,a,o,l,c,h,u,d);{let t=QR[aO++];return(128&t)>0?void(aO-=13):LO(e,n,i,r,s,a,o,l,c,h,u,d,t)}}{let p=QR[aO++],f=QR[aO++];if((128&p)>0||(128&f)>0)return void(aO-=14);if(t<15)return LO(e,n,i,r,s,a,o,l,c,h,u,d,p,f);let m=QR[aO++];return(128&m)>0?void(aO-=15):LO(e,n,i,r,s,a,o,l,c,h,u,d,p,f,m)}}}}}function NO(t){return hO.copyBuffers?Uint8Array.prototype.slice.call(QR,aO,aO+=t):QR.subarray(aO,aO+=t)}function UO(t){let e=QR[aO++];if(pO[e])return pO[e](QR.subarray(aO,aO+=t));throw new Error("Unknown extension type "+e)}var kO=new Array(4096);function BO(){let t=QR[aO++];if(!(t>=160&&t<192))return aO--,_O();if(t-=160,dO>=aO)return nO.slice(aO-uO,(aO+=t)-uO);if(!(0==dO&&tO<180))return EO(t);let e,n=4095&(t<<5^(t>1?sO.getUint16(aO):t>0?QR[aO]:0)),i=kO[n],r=aO,s=aO+t-3,a=0;if(i&&i.bytes==t){for(;r<s;){if(e=sO.getUint32(r),e!=i[a++]){r=1879048192;break}r+=4}for(s+=3;r<s;)if(e=QR[r++],e!=i[a++]){r=1879048192;break}if(r===s)return aO=r,i.string;s-=3,r=aO}for(i=[],kO[n]=i,i.bytes=t;r<s;)e=sO.getUint32(r),i.push(e),r+=4;for(s+=3;r<s;)e=QR[r++],i.push(e);let o=t<16?zO(t):IO(t);return i.string=null!=o?o:EO(t)}var FO=(t,e)=>{var n=_O();let i=t;void 0!==e&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let r=eO[t];return r&&r.isShared&&((eO.restoreStructures||(eO.restoreStructures=[]))[t]=r),eO[t]=n,n.read=SO(n,i),n.read()},VO="object"==typeof self?self:global;pO[0]=()=>{},pO[0].noBuffer=!0,pO[101]=()=>{let t=_O();return(VO[t[0]]||Error)(t[1])},pO[105]=t=>{let e=sO.getUint32(aO-4);rO||(rO=new Map);let n,i=QR[aO];n=i>=144&&i<160||220==i||221==i?[]:{};let r={target:n};rO.set(e,r);let s=_O();return r.used?Object.assign(n,s):(r.target=s,s)},pO[112]=t=>{let e=sO.getUint32(aO-4),n=rO.get(e);return n.used=!0,n.target},pO[115]=()=>new Set(_O());var jO=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((t=>t+"Array"));function HO(t){let e=tO,n=aO,i=cO,r=uO,s=dO,a=nO,o=lO,l=rO,c=iO,h=new Uint8Array(QR.slice(0,tO)),u=eO,d=eO.slice(0,eO.length),p=hO,f=vO,m=t();return tO=e,aO=n,cO=i,uO=r,dO=s,nO=a,lO=o,rO=l,iO=c,QR=h,vO=f,(eO=u).splice(0,eO.length,...d),hO=p,sO=new DataView(QR.buffer,QR.byteOffset,QR.byteLength),m}function GO(){QR=null,rO=null,eO=null}pO[116]=t=>{let e=t[0],n=jO[e];if(!n)throw new Error("Could not find typed array for code "+e);return new VO[n](Uint8Array.prototype.slice.call(t,1).buffer)},pO[120]=()=>{let t=_O();return new RegExp(t[0],t[1])},pO[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=aO;aO+=e-4,(iO=[_O(),_O()]).position0=0,iO.position1=0;let i=aO;aO=n;try{return _O()}finally{aO=i}},pO[255]=t=>4==t.length?new Date(1e3*(16777216*t[0]+(t[1]<<16)+(t[2]<<8)+t[3])):8==t.length?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+1e3*(4294967296*(3&t[3])+16777216*t[4]+(t[5]<<16)+(t[6]<<8)+t[7])):12==t.length?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+1e3*((128&t[4]?-281474976710656:0)+1099511627776*t[6]+4294967296*t[7]+16777216*t[8]+(t[9]<<16)+(t[10]<<8)+t[11])):new Date("invalid");var WO=new Array(147);for(let Wq=0;Wq<256;Wq++)WO[Wq]=+("1e"+Math.floor(45.15-.30103*Wq));var qO,XO=new yO({useRecords:!1}),$O=(XO.unpack,XO.unpackMultiple,XO.unpack,new Float32Array(1));new Uint8Array($O.buffer,0,4);try{qO=new TextEncoder}catch{}var YO,ZO,KO,JO,QO,tD=typeof Buffer<"u",eD=tD?Buffer.allocUnsafeSlow:Uint8Array,nD=tD?Buffer:Uint8Array,iD=tD?4294967296:2144337920,rD=0,sD=null,aD=/[\u0080-\uFFFF]/,oD=Symbol("record-id"),lD=class extends yO{constructor(t){super(t),this.offset=0;let e,n,i,r,s,a=0,o=nD.prototype.utf8Write?function(t,e,n){return KO.utf8Write(t,e,n)}:!(!qO||!qO.encodeInto)&&function(t,e){return qO.encodeInto(t,KO.subarray(e)).written},l=this;t||(t={});let c=t&&t.sequential,h=t.structures||t.saveStructures,u=t.maxSharedStructures;if(null==u&&(u=h?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=t.maxOwnStructures;null==d&&(d=h?32:64),c&&!t.saveStructures&&(this.structures=[]);let p=u>32||d+u>64,f=u+64,m=u+d+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],v=0,y=0;this.pack=this.encode=function(t,o){if(KO||(KO=new eD(8192),JO=new DataView(KO.buffer,0,8192),rD=0),(QO=KO.length-10)-rD<2048?(KO=new eD(KO.length),JO=new DataView(KO.buffer,0,KO.length),QO=KO.length-10,rD=0):rD=rD+7&2147483640,e=rD,s=l.structuredClone?new Map:null,l.bundleStrings?(sD=["",""],KO[rD++]=214,KO[rD++]=98,sD.position=rD-e,rD+=4):sD=null,n=l.structures,n){n.uninitialized&&(n=l._mergeStructures(l.getStructures()));let t=n.sharedLength||0;if(t>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+n.sharedLength);if(!n.transitions){n.transitions=Object.create(null);for(let e=0;e<t;e++){let t=n[e];if(!t)continue;let i,r=n.transitions;for(let e=0,n=t.length;e<n;e++){let n=t[e];i=r[n],i||(i=r[n]=Object.create(null)),r=i}r[oD]=e+64}a=t}c||(n.nextId=t+64)}i&&(i=!1),r=n||[];try{if(x(t),sD){JO.setUint32(sD.position+e,rD-sD.position-e);let t=sD;sD=null,x(t[0]),x(t[1])}if(l.offset=rD,s&&s.idsToInsert){(rD+=6*s.idsToInsert.length)>QO&&_(rD),l.offset=rD;let t=function(t,e){let n,i=6*e.length,r=t.length-i;for(e.sort(((t,e)=>t.offset>e.offset?1:-1));n=e.pop();){let e=n.offset,s=n.id;t.copyWithin(e+i,e,r),i-=6;let a=e+i;t[a++]=214,t[a++]=105,t[a++]=s>>24,t[a++]=s>>16&255,t[a++]=s>>8&255,t[a++]=255&s,r=e}return t}(KO.subarray(e,rD),s.idsToInsert);return s=null,t}return o&xD?(KO.start=e,KO.end=rD,KO):KO.subarray(e,rD)}finally{if(n){if(y<10&&y++,v>1e4)n.transitions=null,y=0,v=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let t=0,e=g.length;t<e;t++)g[t][oD]=0;g=[]}if(i&&l.saveStructures){let i=n.sharedLength||u;n.length>i&&(n=n.slice(0,i));let r=KO.subarray(e,rD);return!1===l.saveStructures(n,a)?(l._mergeStructures(l.getStructures()),l.pack(t)):(a=i,r)}}o&bD&&(rD=e)}};let x=t=>{rD>QO&&(KO=_(rD));var n,i=typeof t;if("string"===i){let e,i=t.length;if(sD&&i>=8&&i<4096){let e=aD.test(t);return sD[e?0:1]+=t,KO[rD++]=193,void x(e?-i:i)}e=i<32?1:i<256?2:i<65536?3:5;let r=3*i;if(rD+r>QO&&(KO=_(rD+r)),i<64||!o){let r,s,a,o=rD+e;for(r=0;r<i;r++)s=t.charCodeAt(r),s<128?KO[o++]=s:s<2048?(KO[o++]=s>>6|192,KO[o++]=63&s|128):55296==(64512&s)&&56320==(64512&(a=t.charCodeAt(r+1)))?(s=65536+((1023&s)<<10)+(1023&a),r++,KO[o++]=s>>18|240,KO[o++]=s>>12&63|128,KO[o++]=s>>6&63|128,KO[o++]=63&s|128):(KO[o++]=s>>12|224,KO[o++]=s>>6&63|128,KO[o++]=63&s|128);n=o-rD-e}else n=o(t,rD+e,r);n<32?KO[rD++]=160|n:n<256?(e<2&&KO.copyWithin(rD+2,rD+1,rD+1+n),KO[rD++]=217,KO[rD++]=n):n<65536?(e<3&&KO.copyWithin(rD+3,rD+2,rD+2+n),KO[rD++]=218,KO[rD++]=n>>8,KO[rD++]=255&n):(e<5&&KO.copyWithin(rD+5,rD+3,rD+3+n),KO[rD++]=219,JO.setUint32(rD,n),rD+=4),rD+=n}else if("number"===i)if(t>>>0===t)t<64?KO[rD++]=t:t<256?(KO[rD++]=204,KO[rD++]=t):t<65536?(KO[rD++]=205,KO[rD++]=t>>8,KO[rD++]=255&t):(KO[rD++]=206,JO.setUint32(rD,t),rD+=4);else if((t|0)===t)t>=-32?KO[rD++]=256+t:t>=-128?(KO[rD++]=208,KO[rD++]=t+256):t>=-32768?(KO[rD++]=209,JO.setInt16(rD,t),rD+=2):(KO[rD++]=210,JO.setInt32(rD,t),rD+=4);else{let e;if((e=this.useFloat32)>0&&t<4294967296&&t>=-2147483648){let n;if(KO[rD++]=202,JO.setFloat32(rD,t),e<4||((n=t*WO[(127&KO[rD])<<1|KO[rD+1]>>7])|0)===n)return void(rD+=4);rD--}KO[rD++]=203,JO.setFloat64(rD,t),rD+=8}else if("object"===i)if(t){if(s){let n=s.get(t);if(n){if(!n.id){let t=s.idsToInsert||(s.idsToInsert=[]);n.id=t.push(n)}return KO[rD++]=214,KO[rD++]=112,JO.setUint32(rD,n.id),void(rD+=4)}s.set(t,{offset:rD-e})}let i=t.constructor;if(i===Object)b(t,!0);else if(i===Array){(n=t.length)<16?KO[rD++]=144|n:n<65536?(KO[rD++]=220,KO[rD++]=n>>8,KO[rD++]=255&n):(KO[rD++]=221,JO.setUint32(rD,n),rD+=4);for(let e=0;e<n;e++)x(t[e])}else if(i===Map){(n=t.size)<16?KO[rD++]=128|n:n<65536?(KO[rD++]=222,KO[rD++]=n>>8,KO[rD++]=255&n):(KO[rD++]=223,JO.setUint32(rD,n),rD+=4);for(let[e,n]of t)x(e),x(n)}else{for(let e=0,n=YO.length;e<n;e++){if(t instanceof ZO[e]){let n=YO[e];if(n.write)return n.type&&(KO[rD++]=212,KO[rD++]=n.type,KO[rD++]=0),void x(n.write.call(this,t));let i,r=KO,s=JO,a=rD;KO=null;try{i=n.pack.call(this,t,(t=>(KO=r,r=null,(rD+=t)>QO&&_(rD),{target:KO,targetView:JO,position:rD-t})),x)}finally{r&&(JO=s,rD=a,QO=(KO=r).length-10)}return void(i&&(i.length+rD>QO&&_(i.length+rD),rD=uD(i,KO,rD,n.type)))}}b(t,!t.hasOwnProperty)}}else KO[rD++]=192;else if("boolean"===i)KO[rD++]=t?195:194;else if("bigint"===i){if(t<BigInt(1)<<BigInt(63)&&t>=-(BigInt(1)<<BigInt(63)))KO[rD++]=211,JO.setBigInt64(rD,t);else if(t<BigInt(1)<<BigInt(64)&&t>0)KO[rD++]=207,JO.setBigUint64(rD,t);else{if(!this.largeBigIntToFloat)throw new RangeError(t+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");KO[rD++]=203,JO.setFloat64(rD,Number(t))}rD+=8}else if("undefined"===i)this.encodeUndefinedAsNil?KO[rD++]=192:(KO[rD++]=212,KO[rD++]=0,KO[rD++]=0);else{if("function"!==i)throw new Error("Unknown type: "+i);x(this.writeFunction&&this.writeFunction())}},b=!1===this.useRecords?this.variableMapSize?t=>{let e,n=Object.keys(t),i=n.length;i<16?KO[rD++]=128|i:i<65536?(KO[rD++]=222,KO[rD++]=i>>8,KO[rD++]=255&i):(KO[rD++]=223,JO.setUint32(rD,i),rD+=4);for(let r=0;r<i;r++)x(e=n[r]),x(t[e])}:(t,n)=>{KO[rD++]=222;let i=rD-e;rD+=2;let r=0;for(let e in t)(n||t.hasOwnProperty(e))&&(x(e),x(t[e]),r++);KO[i+++e]=r>>8,KO[i+e]=255&r}:t=>{let e,n=Object.keys(t),s=r.transitions||(r.transitions=Object.create(null)),a=0;for(let t=0,i=n.length;t<i;t++){let i=n[t];e=s[i],e||(e=s[i]=Object.create(null),a++),s=e}let o=s[oD];if(o)o>=96&&p?(KO[rD++]=96+(31&(o-=96)),KO[rD++]=o>>5):KO[rD++]=o;else{o=r.nextId,o||(o=64),o<f&&this.shouldShareStructure&&!this.shouldShareStructure(n)?(o=r.nextOwnId,o<m||(o=f),r.nextOwnId=o+1):(o>=m&&(o=f),r.nextId=o+1);let t=n.highByte=o>=96&&p?o-96>>5:-1;s[oD]=o,r[o-64]=n,o<f?(n.isShared=!0,r.sharedLength=o-63,i=!0,t>=0?(KO[rD++]=96+(31&o),KO[rD++]=t):KO[rD++]=o):(t>=0?(KO[rD++]=213,KO[rD++]=114,KO[rD++]=96+(31&o),KO[rD++]=t):(KO[rD++]=212,KO[rD++]=114,KO[rD++]=o),a&&(v+=y*a),g.length>=d&&(g.shift()[oD]=0),g.push(s),x(n))}for(let e=0,i=n.length;e<i;e++)x(t[n[e]])},_=t=>{let n;if(t>16777216){if(t-e>iD)throw new Error("Packed buffer would be larger than maximum buffer size");n=Math.min(iD,4096*Math.round(Math.max((t-e)*(t>67108864?1.25:2),4194304)/4096))}else n=1+(Math.max(t-e<<2,KO.length-1)>>12)<<12;let i=new eD(n);return JO=new DataView(i.buffer,0,n),KO.copy?KO.copy(i,0,e,t):i.set(KO.slice(e,t)),rD-=e,e=0,QO=i.length-10,KO=i}}useBuffer(t){KO=t,JO=new DataView(KO.buffer,KO.byteOffset,KO.byteLength),rD=0}};function cD(t,e,n,i){let r=t.byteLength;if(r+1<256){var{target:s,position:a}=n(4+r);s[a++]=199,s[a++]=r+1}else if(r+1<65536){var{target:s,position:a}=n(5+r);s[a++]=200,s[a++]=r+1>>8,s[a++]=r+1&255}else{var{target:s,position:a,targetView:o}=n(7+r);s[a++]=201,o.setUint32(a,r+1),a+=4}s[a++]=116,s[a++]=e,s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),a)}function hD(t,e){let n=t.byteLength;var i,r;if(n<256){var{target:i,position:r}=e(n+2);i[r++]=196,i[r++]=n}else if(n<65536){var{target:i,position:r}=e(n+3);i[r++]=197,i[r++]=n>>8,i[r++]=255&n}else{var{target:i,position:r,targetView:s}=e(n+5);i[r++]=198,s.setUint32(r,n),r+=4}i.set(t,r)}function uD(t,e,n,i){let r=t.length;switch(r){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:r<256?(e[n++]=199,e[n++]=r):r<65536?(e[n++]=200,e[n++]=r>>8,e[n++]=255&r):(e[n++]=201,e[n++]=r>>24,e[n++]=r>>16&255,e[n++]=r>>8&255,e[n++]=255&r)}return e[n++]=i,e.set(t,n),n+=r}function dD(t){if(t.Class){if(!t.pack&&!t.write)throw new Error("Extension has no pack or write function");if(t.pack&&!t.type)throw new Error("Extension has no type (numeric code to identify the extension)");ZO.unshift(t.Class),YO.unshift(t)}!function(t){t.unpack?pO[t.type]=t.unpack:pO[t.type]=t}(t)}ZO=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,mO],YO=[{pack(t,e,n){let i=t.getTime()/1e3;if((this.useTimestamp32||0===t.getMilliseconds())&&i>=0&&i<4294967296){let{target:t,targetView:n,position:r}=e(6);t[r++]=214,t[r++]=255,n.setUint32(r,i)}else if(i>0&&i<17179869184){let{target:n,targetView:r,position:s}=e(10);n[s++]=215,n[s++]=255,r.setUint32(s,4e6*t.getMilliseconds()+(i/1e3/4294967296|0)),r.setUint32(s+4,i)}else if(isNaN(i)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:t,targetView:i,position:r}=e(3);t[r++]=212,t[r++]=255,t[r++]=255}else{let{target:n,targetView:r,position:s}=e(15);n[s++]=199,n[s++]=12,n[s++]=255,r.setUint32(s,1e6*t.getMilliseconds()),r.setBigInt64(s+4,BigInt(Math.floor(i)))}}},{pack(t,e,n){let i=Array.from(t),{target:r,position:s}=e(this.structuredClone?3:0);this.structuredClone&&(r[s++]=212,r[s++]=115,r[s++]=0),n(i)}},{pack(t,e,n){let{target:i,position:r}=e(this.structuredClone?3:0);this.structuredClone&&(i[r++]=212,i[r++]=101,i[r++]=0),n([t.name,t.message])}},{pack(t,e,n){let{target:i,position:r}=e(this.structuredClone?3:0);this.structuredClone&&(i[r++]=212,i[r++]=120,i[r++]=0),n([t.source,t.flags])}},{pack(t,e){this.structuredClone?cD(t,16,e):hD(tD?Buffer.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==nD&&this.structuredClone?cD(t,jO.indexOf(n.name),e):hD(t,e)}},{pack(t,e){let{target:n,position:i}=e(1);n[i]=193}}];var pD,fD=new lD({useRecords:!1}),{NEVER:mD,ALWAYS:gD,DECIMAL_ROUND:vD,DECIMAL_FIT:yD}=(fD.pack,fD.pack,{NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4}),xD=512,bD=1024,_D=new lD({structuredClone:!0});function wD(t){if(hR(t))return t;if(Array.isArray(t))return t.map(wD);if("object"==typeof t&&null!==t){let e={};for(let n of Object.keys(t).sort())e[n]=wD(t[n]);return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),e}return t}dD({Class:sR.prototype.constructor,type:1,write:t=>({...t}),read:t=>(Object.setPrototypeOf(t,sR.prototype),t)}),dD({Class:mR.prototype.constructor,type:2,write:t=>[...t],read:t=>(Object.setPrototypeOf(t,mR.prototype),t)}),dD({Class:fR.prototype.constructor,type:3,write:t=>[...t],read:t=>(Object.setPrototypeOf(t,fR.prototype),t)}),dD({Class:KR.prototype.constructor,type:4,write:t=>t.id,read:t=>new KR(t)}),dD({Class:JR.prototype.constructor,type:5,write:t=>t.data,read:t=>new JR(t)}),dD({Class:_R.prototype.constructor,type:6,write:t=>({...t}),read:t=>(Object.setPrototypeOf(t,_R.prototype),t)}),(t=>{function e(t){return _D.pack(t)}t.serialize=e,t.deserialize=function(t){return _D.unpack(t)},t.checksum=function(t){return function(t){var e=0;if(0===t.length)return e;for(let n=0;n<t.length;n++)e=(e<<5)-e+t[n],e|=0;return e}(e(wD(t))).toString()}})(pD||(pD={}));var SD,MD,TD,ED,AD,CD,PD,RD,OD,DD,LD,ID,zD,ND,UD,kD,BD,FD,VD,jD,HD="personal camera",GD="a218fcc3-276b-49b9-b485-49037fd14f5f",WD=5526619;function qD(t){return"string"==typeof t&&36===t.length&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t)}(t=>{function e(t,e){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}function n(t,n){return Math.sqrt(e(t,n))}function i(e,n,i){let r=t.sub(n,e),s=t.sub(i,e),a=t.dot(r,s)/t.dot(r,r),o=t.scalarMultiply(r,a);return t.add(e,o)}t.isEqual=function(t,e){return t[0]===e[0]&&t[1]===e[1]},t.lerp=function(t,e,n){return[t[0]+(e[0]-t[0])*n,t[1]+(e[1]-t[1])*n]},t.add=function(t,e){return[t[0]+e[0],t[1]+e[1]]},t.sub=function(t,e){return[t[0]-e[0],t[1]-e[1]]},t.multiply=function(t,e){return[t[0]*e[0],t[1]*e[1]]},t.divide=function(t,e){return[t[0]/e[0],t[1]/e[1]]},t.distanceSquared=e,t.distance=n,t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},t.scalarMultiply=function(t,e){return[t[0]*e,t[1]*e]},t.projectionOnto=i,t.projectionOntoDistance=function(t,e,r){return n(t,i(t,e,r))},t.center=function(t,e){return[.5*(t[0]+e[0]),.5*(t[1]+e[1])]}})(SD||(SD={})),(TD=MD||(MD={})).isEqual=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},TD.add=function(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2]]},TD.sub=function(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]},TD.div=function(t,e){return[t[0]/e[0],t[1]/e[1],t[2]/e[2]]},TD.mul=function(t,e){return[t[0]*e[0],t[1]*e[1],t[2]*e[2]]},TD.dist=function(t,e){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},TD.lerp=function(t,e,n){return[t[0]+(e[0]-t[0])*n,t[1]+(e[1]-t[1])*n,t[2]+(e[2]-t[2])*n]},(AD=ED||(ED={})).isEqual=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},AD.lerp=function(t,e,n){return[t[0]+(e[0]-t[0])*n,t[1]+(e[1]-t[1])*n,t[2]+(e[2]-t[2])*n,t[3]+(e[3]-t[3])*n]},(t=>{let e=180/Math.PI,n=Math.PI/180;function i(t){return"number"==typeof t?t*e:t}function r(t){return"number"==typeof t?t*n:t}t.radToDeg=function(t){return[i(t[0]),i(t[1]),i(t[2])]},t.degToRad=function(t){return[r(t[0]),r(t[1]),r(t[2])]}})(CD||(CD={})),(RD=PD||(PD={})).identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],RD.isEqual=function(t,e){for(let n=0;n<16;n++)if(t[n]!==e[n])return!1;return!0},RD.simplify=function(t){return t??RD.identity},RD.applyMatrix4=function(t,e){let n=e.slice(0);for(var i=0,r=e.length;i<r;i+=3){let r=t[3]*e[i]+t[7]*e[i+1]+t[11]*e[i+2]+t[15];n[i]=(t[0]*e[i]+t[4]*e[i+1]+t[8]*e[i+2]+t[12])/r,n[i+1]=(t[1]*e[i]+t[5]*e[i+1]+t[9]*e[i+2]+t[13])/r,n[i+2]=(t[2]*e[i]+t[6]*e[i+1]+t[10]*e[i+2]+t[14])/r}return n},(DD=OD||(OD={})).isRGB=function(t){return"object"==typeof t&&"number"==typeof t.r&&"number"==typeof t.g&&"number"==typeof t.b},DD.white={r:1,g:1,b:1},DD.red={r:1,g:0,b:0},DD.black={r:0,g:0,b:0},DD.toRgb255a1=function(t){return{r:Math.round(255*t.r),g:Math.round(255*t.g),b:Math.round(255*t.b),a:1}},DD.clone=function(t){return{r:t.r,g:t.g,b:t.b}},DD.fromHex=function(t){return{r:((t=Math.floor(t))>>16&255)/255,g:(t>>8&255)/255,b:(255&t)/255}},DD.toHex=function(t){return 65536*Math.round(255*t.r)+256*Math.round(255*t.g)+Math.round(255*t.b)},DD.equals=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b},DD.equalsFixed=function(t,e){return t.r.toFixed(2)===e.r.toFixed(2)&&t.g.toFixed(2)===e.g.toFixed(2)&&t.b.toFixed(2)===e.b.toFixed(2)},DD.lerp=function(t,e,n){return{r:t.r+(e.r-t.r)*n,g:t.g+(e.g-t.g)*n,b:t.b+(e.b-t.b)*n}},(ID=LD||(LD={})).white={...OD.white,a:1},ID.transparent={...OD.white,a:0},ID.from0to1=function(t){return{r:t[0],g:t[1],b:t[2],a:t[3]}},ID.fromHexAndA=function(t,e){return{...OD.fromHex(t),a:e}},ID.toRgb255a1=function(t){return{r:Math.round(255*t.r),g:Math.round(255*t.g),b:Math.round(255*t.b),a:t.a}},ID.equals=function(t,e){return OD.equals(t,e)&&t.a===e.a},ID.equalsFixed=function(t,e){return OD.equalsFixed(t,e)&&t.a.toFixed(2)===e.a.toFixed(2)},ID.lerp=function(t,e,n){return{r:t.r+(e.r-t.r)*n,g:t.g+(e.g-t.g)*n,b:t.b+(e.b-t.b)*n,a:t.a+(e.a-t.a)*n}},ID.toStyle=function({r:t,g:e,b:n,a:i}=ID.white){return`rgba(${255*t}, ${255*e}, ${255*n}, ${i})`},(t=>{t.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]}})(zD||(zD={})),(t=>{t.defaultData={mass:1,stiffness:80,damping:10,velocity:0}})(ND||(ND={})),(t=>{t.defaultData={control1:[.5,0],control2:[.5,1]}})(UD||(UD={})),(t=>{t.linear=[0,0,1,1],t.ease=[.25,.1,.25,1],t.easeIn=[.42,0,1,1],t.easeOut=[0,0,.58,1],t.easeInOut=[.42,0,.58,1]})(kD||(kD={})),(t=>{t.all=["PerspectiveCamera","OrthographicCamera"],t.is=function(e){return t.all.includes(e)}})(BD||(BD={})),(t=>{t.DefaultUp=[0,1,0],t.DefaultTargetOffset=1e3,t.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:t.DefaultUp,isUpVectorFlipped:!1,targetOffset:t.DefaultTargetOffset},t.getZoom=function(t){return"PerspectiveCamera"===t.type?t.perspective?.zoom??1:t.orthographic?.zoom??1}})(FD||(FD={})),(t=>{t.defaultData=function(t,e=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:2*Math.max(t[0],t[1]),start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[t[0]+t[0]*e,0,0]},grid:{count:[2,2,2],size:t.map((t=>t*(1+e))),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}},t.merge=function(t,e){let n={...t};if(rL.forEach((i=>{Object.assign(n,{[i]:e[i]??t[i]})})),n.radial={...t.radial},e.radial){let i=t.radial,r=e.radial;sL.forEach((t=>{Object.assign(n.radial,{[t]:r[t]??i[t]})}))}if(n.linear={...t.linear},e.linear){let i=t.linear,r=e.linear;aL.forEach((t=>{Object.assign(n.linear,{[t]:r[t]??i[t]})}))}if(n.grid={...t.grid},e.grid){let i=t.grid,r=e.grid;oL.forEach((t=>{Object.assign(n.grid,{[t]:r[t]??i[t]})}))}if(n.toObject={...t.toObject},e.toObject){let i=t.toObject,r=e.toObject;lL.forEach((t=>{Object.assign(n.toObject,{[t]:r[t]??i[t]})}))}if(n.randomnessObject={...t.randomnessObject},e.randomnessObject){let i=t.randomnessObject,r=e.randomnessObject;cL.forEach((t=>{Object.assign(n.randomnessObject,{[t]:r[t]??i[t]})}))}return n}})(VD||(VD={})),(t=>{t.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let e=["radial","linear","grid","toObject","randomnessObject"];t.toOps=function(t,n){let i=[];void 0!==t.count&&i.push({type:0,path:n,props:{count:t.count}});for(let r of e){let e=t[r];e&&Object.keys(e).length>0&&i.push({type:0,path:[...n,r],props:e})}return i}})(jD||(jD={}));var XD,$D,YD,ZD,KD,JD,QD,tL,eL,nL,iL,rL=["count"],sL=["radius","start","end","position","scale","rotation"],aL=["position","scale","rotation"],oL=["count","size"],lL=["count","position","scale","rotation"],cL=["strength","scale","rotation","position","movement","seed","freqScale"];(t=>{t.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"],t.is=function(e){return t.all.includes(e)}})(XD||(XD={})),(t=>{t.defaultData=function(t){return function(t){if("PointLight"===t)return{type:t,color:LD.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if("SpotLight"===t)return{type:t,color:LD.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if("DirectionalLight"===t)return{type:t,color:LD.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}(t)}})($D||($D={})),(t=>{t.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},t.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},t.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:t.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1,...t.defaultCollisionData}})(YD||(YD={})),(t=>{t.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]}})(ZD||(ZD={})),(t=>{t.defaultData={castShadow:!0,receiveShadow:!0},t.equals=function(t,e){return t.castShadow===e.castShadow&&t.receiveShadow===e.receiveShadow}})(KD||(KD={})),(t=>{t.defaultData={flatShading:!1,wireframe:!1,side:0},t.equals=function(t,e){return t.flatShading===e.flatShading&&t.side===e.side&&t.wireframe===e.wireframe}})(JD||(JD={})),(t=>{t.defaultData={...JD.defaultData,...KD.defaultData}})(QD||(QD={})),(t=>{t.getMaterialData=function(t,e){let n=[];if("material"in t){let i="string"==typeof t.material?e.materials[t.material]??e.lib.materials[t.material]?.asset:t.material;i&&n.push(i)}else if("materials"in t)for(let i of t.materials){let t="string"==typeof i?e.materials[i]??e.lib.materials[i]?.asset:i;t&&n.push(t)}return n}})(tL||(tL={})),(t=>{t.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},t.maxSize=3e7})(eL||(eL={})),(t=>{t.is=function(t){return"texture"===t||"video"===t||"color"===t||"depth"===t||"normal"===t||"gradient"===t||"noise"===t||"fresnel"===t||"rainbow"===t||"toon"===t||"outline"===t||"particle"===t||"transmission"===t||"matcap"===t||"displace"===t||"pattern"===t||"light"===t}})(nL||(nL={})),(t=>{t.is=function(t){return"phong"===t||"toon"===t||"lambert"===t||"physical"===t}})(iL||(iL={}));var hL,uL,dL,pL,fL=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],mL=["wrapping","image","video","name","minFilter","magFilter"];(t=>{t.patch=function(t,e){let{texture:n,...i}=e;if(Object.assign(t,i),n){let e=t.texture;e&&Object.assign(e,n)}},t.defaultData=function(t,e){return"light"===t&&e?function(t){let e={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(t){case"phong":return{...e,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...e,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...e,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...e,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}(e):function(t){let e={alpha:1,mode:0,isMask:!1,visible:!0};switch(t){case"texture":return{...e,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"video":return{...e,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:eL.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"color":return{...e,type:"color",color:OD.fromHex(WD)};case"depth":return{...e,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...e,type:"normal",cnormal:[1,1,1]};case"gradient":return{...e,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...e,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...OD.fromHex(6710886),a:1},colorB:{...OD.fromHex(6710886),a:1},colorC:{...OD.fromHex(16777215),a:1},colorD:{...OD.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...e,type:"fresnel",color:LD.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...e,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...e,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:LD.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...e,type:"outline",outlineColor:LD.fromHexAndA(0,1),contourColor:LD.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...e,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}};case"transmission":return{...e,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...e,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...OD.fromHex(0),a:1},colorB:{...OD.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}(t)}})(hL||(hL={})),(t=>{function e(t,e="layer1",n="layer2"){let i=new mR;return i.push({fi:0,data:hL.defaultData("light",t),id:e}),i.push({fi:1,data:hL.defaultData("color"),id:n}),{layers:i}}t.isMergable=function(t){return!t.layers.some((t=>"texture"===t.data.type&&0!==t.data.projection||"depth"===t.data.type&&!t.data.isWorldSpace||"noise"===t.data.type||"displace"===t.data.type))},t.getHash=function(t){let e="";return t.layers.forEach((t=>{Object.entries(t.data).forEach((([t,n])=>{e+=`${t}${n}`,Array.isArray(n)?n.forEach((t=>e+=`${t}`)):"object"==typeof n?Object.values(n).forEach((t=>{e+="number"==typeof t?`${t.toFixed(4)}`:`${t}`})):e+=`${n}`}))})),e},t.defaultEmptyData=function(){return{layers:new mR}},t.defaultData=function(t="layer1",n="layer2"){return e("phong",t,n)},t.withName=function(t,e){return{...t,name:e}},t.defaultTwoLayerData=e,t.defaultUIObjectMaterial=function(t){let e=hL.defaultData("texture");t&&Object.assign(e.texture,{image:t});let n=new mR;return n.push({fi:0,data:e,id:"layer1"}),n.push({fi:1,data:{...hL.defaultData("transmission"),alpha:1},id:"layer2"}),n.push({fi:2,data:{...hL.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:n}},t.defaultTwoLayerTextureData=function(t,e="phong",n="layer1",i="layer2"){let r=hL.defaultData("texture");Object.assign(r.texture,{image:t});let s=new mR;return s.push({fi:0,data:r,id:n}),s.push({fi:1,data:hL.defaultData("light",e),id:i}),{layers:s}},t.defaultTwoLayerVideoTextureData=function(t,e="phong",n="layer1",i="layer2"){let r=hL.defaultData("video");Object.assign(r.texture,{video:t});let s=new mR;return s.push({fi:0,data:r,id:n}),s.push({fi:1,data:hL.defaultData("light",e),id:i}),{layers:s}}})(uL||(uL={})),(t=>{t.defaultData=function(){return{points:new mR,roundness:0,shapeHoles:[],isClosed:!1}}})(dL||(dL={})),(t=>{t.defaultData=function(){return{points:new mR,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}})(pL||(pL={}));var gL,vL={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0};(t=>{t.merge=function(t,e){let n={...t};return hI.forEach((i=>{Object.assign(n,{[i]:e[i]??t[i]})})),n}})(gL||(gL={}));var yL,xL,bL,_L,wL,SL,ML,TL,EL,AL,CL,PL,RL,OL,DL,LL,IL,zL,NL,UL,kL,BL,FL,VL,jL,HL,GL,WL,qL,XL,$L,YL,ZL,KL,JL,QL,tI,eI,nI,iI,rI,sI,aI,oI,lI,cI={shape:vL,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},hI=["depth","offset","angle","twist","startScale","endScale"];function uI(t){t.layers.forEach((t=>{if("depth"===t.type&&void 0!==t.colorA){let e=t.colorA,n=t.colorB,i=[[e.r,e.g,e.b,e.a],[n.r,n.g,n.b,n.a]],r=[0,1];for(let t=2;t<10;t++)i.push(i[1]),r.push(1);let s={...rR(XR(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:i,steps:r,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,s)}else if("depth"===t.type&&1===t.gradientType&&(t.near<0||t.far<0)){let e={...XR(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,e)}}))}function dI(t,e){Object.values(t.shared.materials).forEach((t=>e(t)))}function pI(t,e){t.scene.objects.traverse(((t,n)=>{"materials"in n?n.materials.forEach(((t,i)=>{void 0===t&&(n.materials[i]=uL.defaultData(),t=n.materials[i]),"string"!=typeof t&&e(t)})):"material"in n?"string"!=typeof n.material&&(void 0===n.material&&(n.material=uL.defaultData()),e(n.material)):"Mesh"===n.type&&(void 0===n.material&&(n.material=uL.defaultData()),e(n.material)),"overrides"in n&&Object.values(n.overrides).forEach((t=>{t.material&&"string"!=typeof t.material&&Object.getPrototypeOf(t.material)!==_R.prototype&&e(t.material)}))}))}function fI(t){void 0===t.layers&&Object.assign(t,uL.defaultTwoLayerData("lambert"))}function mI(t){!t.layers||t.layers.forEach((t=>{if("depth"===t.type&&10===t.colors.length){let e=[...t.colors];e.push(t.colors[9]);let n=[...t.steps];n.push(t.steps[9]);let i={...XR(t),colors:e,steps:n};Object.assign(t,i)}}))}function gI(t){t.scene.objects.traverse(((t,e)=>{"materials"in e?e.materials.forEach((t=>{"string"!=typeof t&&mI(t)})):"material"in e&&"string"!=typeof e.material&&mI(e.material)})),Object.values(t.shared.materials).forEach((t=>mI(t)))}function vI(t){t.layers&&t.layers.forEach((t=>{"depth"===t.type&&void 0!==t.num&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)}))}function yI(t){t.layers&&t.layers.forEach((t=>{(function(t){return"displace"!==t.type})(t)&&void 0===t.isMask&&(t.isMask=!1),("texture"===t.type||"video"===t.type)&&void 0===t.blending&&(t.blending=0),("noise"===t.type||"displace"===t.type&&"noise"===t.displacementType)&&(void 0===t.voronoiStyle&&(t.voronoiStyle=0),void 0===t.highCut&&(t.highCut=1),void 0===t.lowCut&&(t.lowCut=0),void 0===t.smoothness&&(t.smoothness=.3),void 0===t.seed&&(t.seed=0),void 0===t.quality&&(t.quality=1))}))}function xI(t){let e=t.layers.find((t=>"light"===t.type))?.data;if("basic"===e?.category){let t=hL.defaultData("light","phong"),n=e;Object.assign(n,t),n.visible=!1}}function bI(t){dI(t,xI),pI(t,xI)}function _I(t){t.layers.forEach((t=>{"light"===t.type&&"toon"!==t.category&&void 0===t.occlusion&&(t.occlusion=!0)}))}function wI(t){t.layers&&t.layers.forEach((t=>{"light"===t.type&&void 0===t.bumpMapIntensity&&(t.bumpMapIntensity=5)}))}function SI(t,e){if(e<1&&(pI(t,uI),dI(t,uI),t.schema=1),e<2&&(function(t){Object.assign(t.scene.publish,{orbitControls:{...WL.defaultData,...XR(t.scene.publish.orbitControls)}})}(t),t.schema=2),e<3&&(function(t){function e(t){if(t.layers)for(let e of Object.values(t.layers))if(e)for(let[t,n]of Object.entries(e))if((fL.includes(t)||"boolean"==typeof n)&&delete e[t],"texture"===t)for(let[t,e]of Object.entries(n))(mL.includes(t)||"boolean"==typeof e)&&delete n[t]}t.scene.objects.traverse(((t,n)=>{n.states.forEach((t=>{let n=t;n.material?e(n.material):n.materials&&n.materials.forEach((t=>{e(t)}))}))}))}(t),t.schema=3),e<4&&(function(t){t.scene.publish.withBackground=!0}(t),t.schema=4),e<5&&(function(t){t.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}(t),t.schema=5),e<6&&(function(t){t.scene.objects.traverse(((t,e)=>{let n=e.cloner;n&&(n.radial.scale=n.radial.scale.map((t=>t+1)),n.linear.scale=n.linear.scale.map((t=>t+1)))}))}(t),t.schema=6),e<7&&(function(t){t.scene.objects.traverse(((t,e)=>{let n=e.geometry;n&&("DodecahedronGeometry"===n.type||"IcosahedronGeometry"===n.type)&&(n.detail=Math.round(n.detail))}))}(t),t.schema=7),e<8&&(t.schema=8),e<9&&(gI(t),t.schema=9),e<10&&(function(t){t.scene.objects.traverse(((t,e)=>{"Mesh"===e.type&&("BooleanGeometry"===e.geometry.type||"SubdivGeometry"===e.geometry.type)&&(e.geometry.phongAngle=35)}))}(t),t.schema=10),e<11&&(function(t){t.scene.environment.ambientLight.softShadows=!1,t.scene.environment.ambientLight.softShadowQuality="low",t.scene.objects.traverse(((t,e)=>{("DirectionalLight"===e.type||"SpotLight"===e.type)&&(e.shadowResolution=1024,e.shadowRadius=1,e.depth=1e5)})),t.shared.penumbraSize=new Array(5).fill(.5)}(t),t.schema=11),e<12&&(gI(t),t.schema=12),e<13&&(function(t){t.shared.audios=eT({},sR.prototype)}(t),t.schema=13),e<14&&(function(t){let e=t.shared.materials;Object.entries(e).forEach((([t,n])=>{if(!n.layers){let n={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(e,{[t]:n})}}))}(t),t.schema=14),e<15&&(function(t){Object.entries(XR(t.shared.images)).filter((t=>!1===t[1].asset)).map((t=>t[0])).forEach((e=>{delete t.shared.images[e]})),Object.entries(XR(t.shared.audios)).filter((t=>!1===t[1].asset)).map((t=>t[0])).forEach((e=>{delete t.shared.audios[e]}))}(t),t.schema=15),e<16&&(function(t){t.scene.publish.settings.web.preload=!1}(t),t.schema=16),e<17&&(pI(t,vI),dI(t,vI),t.schema=17),e<18&&(pI(t,fI),dI(t,fI),t.schema=18),e<19&&(function(t){Object.assign(t.scene.publish.settings,{video:{...qL.defaultData.settings.video,...XR(t.scene.publish.settings.video)}})}(t),t.schema=19),e<20&&(function(t){t.shared.fonts=eT({},sR.prototype)}(t),function(t){let e=[];t.scene.objects.traverse(((n,i)=>{let r=i;if("TextFrame"===r.type){let i=uL.defaultTwoLayerData("phong"),s="string"==typeof r.color?t.shared.colors[r.color]:r.color;i.layers[1].data.color={r:s.r,g:s.g,b:s.b},i.layers[1].data.alpha=r.alpha;let a=function(t){return t.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1))).join(" ")}(r.font);void 0===t.shared.fonts[a]&&(t.shared.fonts[a]={name:a});let o={name:r.name,...DL.defaultData,...UL.defaultData,flatShading:!1,wireframe:!1,geometry:{...bL.defaultData("TextGeometry"),width:r.width,height:r.height,font:a,depth:0,horizontalAlign:r.horizontalAlign,verticalAlign:r.verticalAlign,fontSize:1.40625*r.fontSize,lineHeight:r.lineHeight/1.40625,letterSpacing:r.letterSpacing-1,text:r.text,textTransform:r.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:i,states:XR(r.states),events:XR(r.events),visible:r.visible,raycastLock:r.raycastLock,position:r.position,rotation:r.rotation,scale:r.scale,hiddenMatrix:r.hiddenMatrix},l=XR(t.scene.objects).parent(n);t.scene.objects.insertAfter(l??null,n,[{id:n+"new",data:o,children:[]}]),e.push(n)}})),e.forEach((e=>{t.scene.objects.delete(e)}))}(t),t.schema=20),e<21&&(function(t){let e={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};t.scene.objects.traverse(((t,n)=>{n.events.forEach((t=>{if(e[Number(t.type)])if(Object.assign(t,{type:e[Number(t.type)]}),"Audio"===t.type&&"audioEvent"in t&&(Object.assign(t,{playAudio:t.audioEvent}),delete t.audioEvent),"GameControl"===t.type)Object.assign(t,{gameActions:{idle:new mR,move:new mR,jump:new mR}});else{let e=new mR;Object.assign(t,{actions:e}),("MouseDown"===t.type||"MouseUp"===t.type||"KeyDown"===t.type||"KeyUp"===t.type)&&"url"in t&&e.push({fi:0,id:vm.generateUUID(),data:{type:"Link",url:t.url,delay:0}}),"targets"in t&&(t.targets.forEach(((t,n,i)=>{let r={easing:t.easing,duration:t.duration};6===t.easing?Object.assign(r,rR(t,"mass","stiffness","damping","velocity")):5===t.easing&&Object.assign(r,{control1:{...t.control1},control2:{...t.control2}});let s={repeat:t.repeat?-1:0,delay:t.delay,delayDirection:t.delayDirection,direction:t.cycle&&t.rewind?"pingpong-rewind":t.cycle?"pingpong":"normal"},a={state:t.state,...s,...r},o={allowSlerp:!0,type:"Transition",object:t.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new mR({fi:0,id:vm.generateUUID(),data:{state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4}},{fi:1,id:vm.generateUUID(),data:a})};e.push({fi:i,id:n,data:o})})),delete t.targets)}}))}))}(t),function(t){t.scene.objects.traverse(((t,e)=>{function n(t,n){let i=new mR,r=[];if(e.events.forEach(((t,e,s)=>{if("Audio"===t.type&&t.trigger===n){let n;r.push(e),"play"===t.interaction?n={...rR(t,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in t?t.after:void 0,toggle:"after"in t?t.toggle:void 0,type:"Audio"}:("pause"===t.interaction||"stop"===t.interaction)&&(n={...rR(t,"interaction","delay","object","playAudio"),type:"Audio"}),n&&i.push({fi:s,id:e,data:n})}})),r.forEach((t=>e.events.delete(t))),i.length){let n=e.events.find((e=>e.type===t))?.data;n?"actions"in n&&n.actions.insertBefore(null,i):e.events.insertBefore(null,[{id:vm.generateUUID(),data:{type:t,actions:i}}])}}n("Start","start"),n("MouseDown","mouseDown"),n("MouseUp","mouseUp"),n("KeyDown","keyDown"),n("KeyUp","keyUp")}))}(t),t.schema=21),e<22&&(bI(t),t.schema=22),e<23&&(function(t){t.scene.objects.traverse(((t,e)=>{"Mesh"===e.type&&"SubdivGeometry"===e.geometry.type&&(e.geometry.scaleBaked||(e.geometry.scaleBaked=[1,1,1]))}))}(t),t.schema=23),e<24&&(function(t){t.scene.objects.traverse(((t,e)=>{("Empty"===e.type||"Mesh"===e.type)&&e.cloner&&!e.cloner.randomnessObject&&!e.cloner.toObject&&!e.cloner.randomness&&(e.cloner={...e.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})}))}(t),t.schema=24),(e<25||void 0===t.shared.videos)&&(function(t){t.shared.videos=eT({},sR.prototype)}(t),e<25&&(t.schema=25)),e<26&&(function(t){t.scene.objects.traverse(((e,n)=>{let i=t.scene.objects.unproxy().parent(e);if(i){let e=XR(t.scene.objects.data(i));e&&"Mesh"===e.type&&"BooleanGeometry"===e.geometry.type&&"Mesh"===n.type&&(n.visible=!0!==XR(n).booleanExclude)}}))}(t),t.schema=26),e<27&&(function(t){t.scene.objects.traverse(((t,e)=>{if("Mesh"===e.type){let t=e;"NonParametricGeometry"===e.geometry.type?void 0!==t.material&&delete t.material:void 0!==t.materials&&delete t.materials}}))}(t),t.schema=27),e<28&&(bI(t),t.schema=28),e<29&&(function(t){function e(t){Object.setPrototypeOf(t,_R.prototype),t.texture&&Object.setPrototypeOf(t.texture,_R.prototype)}function n(t){Object.setPrototypeOf(t,_R.prototype);for(let n in t)e(t[n])}t.scene.objects.traverse(((t,e)=>{e.states.forEach((t=>{let e=t;if(e.material){let t=XR(e.material).layers;n(t),e.material.layers=t}if(e.materials)for(let t=0;t<e.materials.length;t++){let i=e.materials[t],r=XR(i).layers;n(r),i.layers=r}}))}))}(t),t.schema=29),e<30&&(function(t){t.scene.objects.traverse(((t,e)=>{"Mesh"===e.type&&"NonParametricGeometry"===e.geometry.type&&!("material"in e)&&!("materials"in e)&&(e.material=uL.defaultTwoLayerData("phong"))}))}(t),t.schema=30),e<31&&(function(t){void 0===t.scene.publish.orbitControls.autoZoom&&(t.scene.publish.orbitControls.autoZoom=!1),t.scene.objects.traverse(((t,e)=>{("OrthographicCamera"===e.type||"PerspectiveCamera"===e.type)&&(void 0===e.orthographic.autoZoom&&(e.orthographic.autoZoom=!1),void 0===e.orthographic.autoZoomFrustumSize&&(e.orthographic.autoZoomFrustumSize=790))}))}(t),t.schema=31),e<33&&(function(t){t.scene.objects.traverse(((t,e)=>{void 0===e.pathSnapping&&(e.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),void 0===e.pathSnapping.offset&&(e.pathSnapping.offset=0)}))}(t),t.schema=33),e<34&&(function(t){void 0===t.scene.publish.mouseEventTarget&&(t.scene.publish.mouseEventTarget="canvas"),void 0===t.scene.publish.settings.web.hint&&(t.scene.publish.settings.web.hint=!1)}(t),t.schema=34),e<35&&(function(t){let{video:e}=t.scene.publish.settings;"gif"===e.format&&e.fps>48&&(e.fps=15)}(t),t.schema=35),e<36&&(function(t){t.scene.objects.traverse(((t,e)=>{e.events.forEach((t=>{"GameControl"===t.type&&(t.resetYPosition=Math.abs(t.resetYPosition-e.position[1]))}))}))}(t),t.schema=36),e<37&&(function(t){let e=t.scene.environment.usePhysics;t.scene.objects.traverse(((t,n)=>{e&&null===n.physics?n.collision=!1:n.collision="visibility"}))}(t),t.schema=37),e<38&&(pI(t,yI),dI(t,yI),t.schema=38),e<39&&(function(t){t.scene.objects.traverse(((t,e)=>{e.events.forEach((t=>{"GameControl"===t.type&&(t.navmesh=lI.defaultDataThirdPerson.navmesh)}))}))}(t),t.schema=39),e<40&&(function(t){t.scene.styles||(t.scene.styles=YL.defaultData())}(t),t.schema=40),e<41&&(function(t){void 0===t.scene.environment.ambientLight.occlusion&&(t.scene.environment.ambientLight.occlusion=!1),void 0===t.scene.environment.ambientLight.aoFullRes&&(t.scene.environment.ambientLight.aoFullRes=!1),void 0===t.scene.environment.ambientLight.radius&&(t.scene.environment.ambientLight.radius=256),void 0===t.scene.environment.ambientLight.bias&&(t.scene.environment.ambientLight.bias=.5),void 0===t.scene.environment.ambientLight.aoColor&&(t.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),pI(t,_I),dI(t,_I)}(t),t.schema=41),e<42&&(function(t){t.scene.objects.traverse(((t,e)=>{e.events.forEach((t=>{"GameControl"===t.type&&Object.assign(t.gameActions,{run:new mR})}))}))}(t),t.schema=42),e<43&&(function(t){t.scene.objects.traverse(((t,e)=>{e.events.forEach((t=>{"GameControl"===t.type&&(t.keyAssignments=[...t.keyAssignments,["run","\u21e7"],["none","Ctrl"]])}))}))}(t),t.schema=43),e<99){pI(t,wI),dI(t,wI),null===t.scene.publish.playCamera&&(t.scene.publish.playCamera=HD);let e=XR(t.scene.objects),n=t.scene.objects;t.scene.publish.playPage=GD,n.insertBefore(null,null,[{id:GD,data:{...jL.defaultData,backgroundColor:t.scene.backgroundColor,fog:t.scene.fog,postprocessing:t.scene.postprocessing,ao:rR(t.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:t.scene.publish.playCamera,gameControlObject:t.scene.publish.gameControlObject},shadow:rR(t.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...EL.defaultData,...rR(t.scene.environment,"usePhysics","gravity")},camera:XR(t.scene.ownerCamera)??jL.defaultData.camera,name:"Scene"},children:[]}]);for(let t of e)t.id!==KL.TRASH_CAN_ID&&n.move(GD,t.fi,t.id);let i=0,r=0;t.shared.penumbraSize&&t.scene.objects.traverse(((e,n)=>{"DirectionalLight"===n.type?(n.penumbraSize=t.shared.penumbraSize[Math.min(i,2)],i+=1):"SpotLight"===n.type&&(n.penumbraSize=t.shared.penumbraSize[3+Math.min(r,1)],r+=1),(void 0===n.physics||null===n.physics)&&"Instance"!==n.type&&(n.physics={},Object.assign(n.physics,ZD.defaultData)),void 0!==n.physics&&null!==n.physics&&(n.physics.enabled=n.collision??"visibility",delete n.collision)})),t.schema=99}}function MI(t){t.layers&&t.layers.forEach((t=>{"light"===t.type&&void 0===t.alphaOverride&&(t.alphaOverride=1)}))}(t=>{t.is2DParametricMesh=function(t){return"PolygonGeometry"===t||"RectangleGeometry"===t||"StarGeometry"===t||"TriangleGeometry"===t||"EllipseGeometry"===t||"UIGeometry"===t},t.isParametricMesh=function(t){return"PolygonGeometry"===t||"PolygonGeometry"===t||"RectangleGeometry"===t||"StarGeometry"===t||"TriangleGeometry"===t||"EllipseGeometry"===t||"PathGeometry"===t||"VectorGeometry"===t||"ConeGeometry"===t||"CubeGeometry"===t||"CylinderGeometry"===t||"DodecahedronGeometry"===t||"HelixGeometry"===t||"IcosahedronGeometry"===t||"LatheGeometry"===t||"PyramidGeometry"===t||"SphereGeometry"===t||"PlaneGeometry"===t||"BackdropGeometry"===t||"TorusGeometry"===t||"TorusKnotGeometry"===t||"BooleanGeometry"===t||"TextGeometry"===t||"InputGeometry"===t}})(yL||(yL={})),(t=>{t.merge=function(t,e){let n={...t};return Object.assign(n,e),"PathGeometry"===n.type&&"extrusion"in e&&e.extrusion&&(n.extrusion={...t.extrusion},Object.assign(n.extrusion,gL.merge(n.extrusion,e.extrusion))),n}})(xL||(xL={})),(t=>{t.defaultData=function(e){if("RectangleGeometry"===e)return{width:320,height:320,type:e,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("UIGeometry"===e)return{type:e,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if("PathGeometry"===e)return{type:e,width:1,height:1,depth:1,path:pL.defaultData(),extrusion:cI};if("VectorGeometry"===e)return{width:1,height:1,type:e,subdivisions:12,shape:dL.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("BooleanGeometry"===e)return{type:e,operation:2,width:0,height:0,depth:0,phongAngle:35};if("ShapeBlendGeometry"===e)return{type:e,width:0,height:0,depth:0,resolutionLevel:6,blendRange:100,useChildrenColors:!1};if("TextGeometry"===e)return{type:e,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if("InputGeometry"===e)return{...t.defaultData("TextGeometry"),type:e,editable:!0};if("SphereGeometry"===e)return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}})(bL||(bL={})),(t=>{t.defaultData={enabled:!1,useBackgroundColor:!1,color:OD.white,near:.1,far:2e3}})(_L||(_L={})),(t=>{let e={opacity:1,blendFunction:13,enabled:!1};t.defaultData={enabled:!1,pixelation:{...e,blendFunction:16,granularity:15},bloom:{...e,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...e,offset:[2,2]},vignette:{...e,darkness:1,offset:0},hueSaturation:{...e,hue:3,saturation:0},brightnessContrast:{...e,brightness:.25,contrast:0},depthOfField:{...e,focusDistance:100,focalLength:20,bokehScale:5},noise:{...e,blendFunction:16}}})(wL||(wL={})),(t=>{t.defaultData={softShadowQuality:"low"}})(SL||(SL={})),(t=>{t.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75}})(ML||(ML={})),(t=>{t.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}}})(TL||(TL={})),(t=>{t.defaultData={usePhysics:!1,gravity:-10}})(EL||(EL={})),(t=>{t.defaultData={playCamera:HD,gameControlObject:null}})(AL||(AL={})),(t=>{t.defaultData={backgroundColor:LD.fromHexAndA(2960946,1),postprocessing:wL.defaultData,fog:_L.defaultData,globalPhysics:EL.defaultData,ambient:ML.defaultData,ao:TL.defaultData,shadow:SL.defaultData,publish:AL.defaultData}})(CL||(CL={})),(t=>{t.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95}})(PL||(PL={})),(t=>{t.isComponentRelated=function(t){return"Component"===t||"Instance"===t},t.isEmptyOrComponent=function(t){return"Empty"===t||"Instance"===t}})(RL||(RL={})),(t=>{t.identity={...zD.identity,hiddenMatrix:PD.identity},t.fromObject=function(t){return{position:t.position,rotation:t.rotation,scale:t.scale,hiddenMatrix:t.hiddenMatrix}},t.merge=function(t,e){return{position:e?.position||t.position,rotation:e?.rotation||t.rotation,scale:e?.scale||t.scale,hiddenMatrix:e?.hiddenMatrix||t.hiddenMatrix}},t.diff=function(t,e){return tT({position:MD.isEqual(t.position,e.position)?void 0:e.position,rotation:MD.isEqual(t.rotation,e.rotation)?void 0:e.rotation,scale:MD.isEqual(t.scale,e.scale)?null:e.scale,hiddenMatrix:PD.isEqual(t.hiddenMatrix,e.hiddenMatrix)?void 0:e.hiddenMatrix})}})(OL||(OL={})),(t=>{t.defaultData={states:new mR,events:new mR,visible:!0,raycastLock:!1,physics:ZD.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...OL.identity,cloner:null}})(DL||(DL={})),(t=>{t.defaultData={type:"Empty",...DL.defaultData}})(LL||(LL={})),(t=>{t.defaultData={type:"ParticleCollider",...PL.defaultData,...DL.defaultData}})(IL||(IL={})),(t=>{t.defaultData={type:"Component",...DL.defaultData}})(zL||(zL={})),(t=>{t.defaultData={type:"Particle",...DL.defaultData,...YD.defaultData}})(NL||(NL={})),(t=>{t.defaultData={type:"Mesh",...DL.defaultData,...QD.defaultData}})(UL||(UL={})),(t=>{t.defaultData={...DL.defaultData,...OL.identity,position:[0,0,FD.DefaultTargetOffset],...FD.defaultData}})(kL||(kL={})),(t=>{t.defaultData=function(t){return{...DL.defaultData,...$D.defaultData(t)}},t.defaultDirectionalLightData={...t.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(BL||(BL={})),(t=>{function e(t,e,n=0){for(;n<e.length;){let i=t?t[e[n]]:void 0;if(e.length===n+1)return i;if(!i)return;t=i.descendants,n+=1}}t.resolveWithDes=e,t.resolve=function(t,n,i=0){let r=e(t,n,i);if(r){let t=Object.keys(r);if(1===t.length&&"descendants"===t[0])return}return r}})(FL||(FL={})),(t=>{function e(t,e){return{...DL.defaultData,...e,component:t,overrides:new _R,physics:void 0,events:void 0,type:"Instance"}}t.rootOverrideProps=["physics","events"],t.compositeNonOptionalOverrideProps=["geometry"],t.compositeEntireOverrideOverrideProps=["material"],t.ofComponent=e,t.fromComponentData=function(t){let n=OL.fromObject(t.data);return e(t.id,n)}})(VL||(VL={})),(t=>{t.defaultData={type:"Page",...DL.defaultData,physics:{...ZD.defaultData,fusedBody:!1},...CL.defaultData,camera:kL.defaultData},t.isUIPage=function(t){return void 0!==t.uiScene}})(jL||(jL={})),(t=>{t.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:PD.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:ZD.defaultData,states:new mR,events:new mR,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...FD.defaultData},t.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},t.defaultMeshObject={name:"Rectangle",...DL.defaultData,...UL.defaultData,geometry:bL.defaultData("RectangleGeometry"),material:uL.defaultTwoLayerData("phong","layer1","layer2")},t.defaultBooleanObject={name:"Boolean",...DL.defaultData,...UL.defaultData,geometry:bL.defaultData("BooleanGeometry"),material:uL.defaultTwoLayerData("phong","layer1","layer2")},t.defaultShapeBlendObject={name:"Shape Blend",...DL.defaultData,...UL.defaultData,geometry:bL.defaultData("ShapeBlendGeometry"),material:uL.defaultTwoLayerData("phong","layer1","layer2")},t.defaultTextObject={name:"Text",...DL.defaultData,...UL.defaultData,geometry:bL.defaultData("TextGeometry"),material:uL.defaultTwoLayerData("phong","layer1","layer2")},t.defaultInputObject={name:"Input",...DL.defaultData,...UL.defaultData,geometry:bL.defaultData("InputGeometry"),material:uL.defaultTwoLayerData("phong","layer1","layer2")}})(HL||(HL={})),(t=>{t.newEmpty=function(t,e){let n={name:e};return"Mesh"===t.type?(n.geometry={},"material"in t&&(n.material={layers:new _R}),"materials"in t&&(n.materials=t.materials.map((t=>({layers:new _R}))))):BD.is(t.type)&&(n.perspective={},n.orthographic={}),n},t.toOps=function(t,e){let n,i=[],r={orthographic:0,perspective:0,geometry:0};function s(t,e){for(let[n,r]of Object.entries(e.layers)){let{texture:e,...s}=r;if(void 0!==e&&Object.keys(e).length>0){let r={path:[...t,"layers",n,"texture"],props:e,type:0};i.push(r)}if(Object.keys(s).length>0){let e={path:[...t,"layers",n],props:s,type:0};i.push(e)}}}for(let[t,a]of Object.entries(e))if("name"!==t)if("cloner"===t)i.push(...jD.toOps(a,["cloner"]));else if("pathSnapping"===t)i.push({path:[t],props:{slide:a.slide,offset:a.offset},type:0});else if("material"===t)s(["material"],a);else if("materials"===t)for(let[t,e]of Object.entries(a))s(["materials",t],e);else if(0===r[t]){if("geometry"===t&&void 0!==a.extrusion){let e={path:[t,"extrusion"],props:a.extrusion,type:0};i.push(e),a={...a},delete a.extrusion}if(Object.keys(a).length>0){let e={path:[t],props:a,type:0};i.push(e)}}else void 0===n&&(n={path:[],props:{},type:0},i.push(n)),n.props[t]=a;return i},t.patch=function(t,e){if(void 0===e)return t;let n={...t};if(Object.assign(n,OL.merge(n,e)),Object.assign(n,{pathSnapping:Object.assign({},n.pathSnapping,{slide:e.pathSnapping?.slide??n.pathSnapping?.slide??0,offset:e.pathSnapping?.offset??n.pathSnapping?.offset??0})}),BD.is(t.type)){n.orthographic={...n.orthographic},n.perspective={...n.perspective};let t=e;void 0!==t.orthographic?.zoom&&(n.orthographic.zoom=t.orthographic.zoom),void 0!==t.perspective?.zoom&&(n.perspective.zoom=t.perspective.zoom),void 0!==t.isUpVectorFlipped&&(n.isUpVectorFlipped=t.isUpVectorFlipped),void 0!==t.targetOffset&&(n.targetOffset=t.targetOffset)}else if("Mesh"===t.type)"geometry"in e&&Object.assign(n,{geometry:xL.merge(n.geometry,e.geometry)}),(e.material||e.materials)&&(n=function(t,e){if(void 0===e)return t;let n={...t};return"material"in n&&"material"in e&&e.material&&(n.material=qR(n.material,(t=>{if("string"!=typeof t)for(let[n,i]of Object.entries(e.material.layers)){let e=t.layers.data(n);e&&hL.patch(e,i)}})).data),n.materials&&e.materials&&(n.materials=qR(n.materials,(t=>{for(let i=0;i<n.materials.length;i++){let n=e.materials[i];if("string"!=typeof n)for(let[e,r]of Object.entries(n.layers)){let n=t[i]?.layers?.data(e);n&&hL.patch(n,r)}}})).data),n}(n,e)),n.cloner&&"cloner"in e&&Object.assign(n,{cloner:VD.merge(n.cloner,e.cloner)});else if("Empty"===t.type)n.cloner&&"cloner"in e&&Object.assign(n,{cloner:VD.merge(n.cloner,e.cloner)});else if(XD.is(t.type)){let t=e;void 0!==t.intensity&&(n.intensity=t.intensity),void 0!==t.color&&("string"==typeof t.color?n.color=t.color:n.color=OD.clone(t.color))}return n}})(GL||(GL={})),(t=>{t.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0}})(WL||(WL={})),(t=>{t.defaultData={orbitControls:WL.defaultData,playPage:GD,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map(((t,e)=>{let n=0,i=0;return e<5?i=-30:e<10&&(i=30),0===e||10===e||5===e?n=30:(4===e||11===e||9===e)&&(n=-30),[120,[n,i],"show"]})),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70}},stopRaycast:!0,hdTransmission:!1}})(qL||(qL={})),(t=>{t.defaultData={id:"basic",label:"Basic",style:"None",prompt:""}})(XL||(XL={})),(t=>{t.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0}})($L||($L={})),(t=>{t.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...XL.defaultData},isRandomSeed:!0,seed:t.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:$L.defaultData}),t.generateSeed=()=>Math.round(1e5*Math.random())})(YL||(YL={})),(t=>{t.physicsEnabled=function(t){return void 0!==t.find((t=>"Page"===t.data.type&&t.data.globalPhysics.usePhysics))},t.traverseModuleInstances=function(t,e,n){t.scene.objects.traverseFrom(e,((e,i)=>{if("Instance"===i.type){let r=CI.getComponentData(t,i.component)?.data;r&&n(e,i,r.events)}else n(e,i,i.events)}))}})(ZL||(ZL={})),(t=>{function e(e=!0,n=[]){let i=[],r=HL.defaultMeshObject;e&&(i.push({...t.defaultLight}),i.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:r,children:[]})),i.push(...n);let s=new fR;return s.push({fi:1,id:GD,data:{...jL.defaultData,name:"Scene 1"},children:i}),s}function n(e){return{...t.defaultData,objects:eT(e,fR.prototype)}}t.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",t.defaultLight={fi:-1,data:BL.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]},t.createDefaultObjectTreeWithPage=e,t.defaultData={objects:e(),publish:qL.defaultData,styles:YL.defaultData()},t.emptyDataWithoutPage=function(){return{objects:new fR,publish:qL.defaultData,styles:YL.defaultData()}},t.emptyDataWithPage=function(t=!0){return{objects:e(t),publish:qL.defaultData,styles:YL.defaultData()}},t.emptyData=function(){return{objects:new fR,publish:{...qL.defaultData},styles:YL.defaultData()}},t.withObjs=n,t.withObj=function(t,e){return n([{id:t,data:e,children:[],fi:0}])}})(KL||(KL={})),(t=>{t.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}}})(JL||(JL={})),(t=>{t.defaultData=t=>({url:t,name:"New Webhook",parametersSchemas:new mR}),t.defaultParameterValueByType=t=>"number"===t?0:"boolean"!==t&&""})(QL||(QL={})),(t=>{t.defaultData=(t,e="GET")=>({url:t,method:e,name:"New API",headers:new mR,queries:new mR,autoStart:!0})})(tI||(tI={})),(t=>{function e(t){return void 0!==t.textValue}function n(t){return"boolean"==typeof t}t.isTextValue=e,t.isNumber=function(t){return"number"==typeof t},t.isBoolean=n,t.typeOfVariable=function(t){return e(t)?"string":n(t)?"boolean":"number"},t.getDisplayedValue=function(e){return t.isTextValue(e)?Array.isArray(e.textValue)?e.textValue.map((t=>t.toString().padStart(e.padding??2,"0"))).join(e.deliminator??":")+(void 0!==e.suffix?" "+e.suffix:""):e.textValue.toString():t.isBoolean(e)?e?"True":"False":t.isNumber(e)?parseFloat(e.toFixed(3)).toString():e.toString()}})(eI||(eI={})),(t=>{t.all=["images","videos","colors","audios","particles","fonts","materials","variables"]})(nI||(nI={})),(t=>{t.all=[...nI.all,"components"]})(iI||(iI={})),(t=>{t.defaultData=function(){return{images:new sR,videos:new sR,colors:new sR,audios:new sR,particles:new sR,fonts:new sR,materials:new sR,components:new sR,variables:new sR,userAPIs:new sR,userWebhooks:new sR}}})(rI||(rI={})),(t=>{t.defaultData=function(){return{images:new sR,videos:new sR,colors:new sR,audios:new sR,particles:new sR,fonts:new sR,materials:new sR,components:new sR,variables:new sR,userAPIs:new sR,userWebhooks:new sR}}})(sI||(sI={})),(t=>{t.defaultColors=function(){let t={"89b10010-844c-11ec-a8a3-0242ac120002":{r:.5,g:.5,b:.5,a:1,name:"Default Color"}};return eT(t,sR.prototype)},t.defaultImages=function(){return eT({},sR.prototype)},t.emptyData=function(){return{catelogs:new sR,materials:new sR,images:new sR,videos:new sR,colors:new sR,audios:new sR,particles:new sR,fonts:new sR,variables:new mR,userAPIs:new sR,userWebhooks:new sR,lib:sI.defaultData()}},t.defaultVariables=function(t){switch(t){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let e=[0,0,0];return{name:"Time",value:{textValue:e,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:e,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",t)}},t.getFormattedTimerTime=function(t,e){if("HH:mm:ss"===e.format){let e=Math.floor(t/3600),n=Math.floor((t-3600*e)/60);return{textValue:[e,n,Math.round(t-3600*e-60*n)]}}if("mm:ss"===e.format){let e=Math.floor(t/60);return{textValue:[e,Math.round(t-60*e)]}}return t="number"===e.format?Math.round(t):Math.round(1e3*t)/1e3}})(aI||(aI={})),(t=>{t.list=["idle","move","jump","run"]})(oI||(oI={})),(t=>{t.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},t.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","\u25b2"],["rotPosY","\u25c0"],["rotNegX","\u25bc"],["rotNegY","\u25b6"],["jump","Space"],["run","\u21e7"],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:t.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new mR,move:new mR,jump:new mR,run:new mR},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:LD.fromHexAndA(3728051,1)}}})(lI||(lI={}));var TI=180/Math.PI;function EI(t){t.rotation=t.rotation.slice(0,3).map((t=>t*TI))}function AI(t){EI(t),"Page"===t.type&&EI(t.camera),t.states?.forEach((t=>{void 0===t.rotation||null===t.rotation||(t.rotation=t.rotation.slice(0,3).map((t=>t*TI)))}));let e=t.geometry;e&&"SphereGeometry"===e.type&&(e.thetaLength=(e.thetaLength??180)*TI),e&&"TorusGeometry"===e.type&&(e.arc=e.arc*TI),e&&"PathGeometry"===e.type&&(e.extrusion.angle*=TI,e.extrusion.twist*=TI),"Mesh"===t.type&&"TextGeometry"===t.geometry.type&&(t.geometry.text={textValue:t.geometry.text}),Array.isArray(XR(t.events))&&t.events?.forEach((t=>{("MouseDown"===t.type||"MouseUp"===t.type||"MousePress"===t.type||"KeyDown"===t.type||"KeyUp"===t.type||"KeyPress"===t.type||"Collision"===t.type||"Trigger"===t.type)&&(t.runMode=t.toggle?"Toggle":"Repeat")}))}var CI,PI,RI,OI,DI,LI,II,zI,NI,UI,kI,BI,FI,VI,jI,HI,GI,WI,qI,XI,$I=115;function YI(t,e){e(t.data);for(let n of t.children)YI(n,e)}function ZI(t){let e=t.schema??104;e!==$I&&e<105&&(YI(t.asset,AI),t.schema=105)}function KI(t){let e=t.schema??0;if(e!==$I){console.warn("updating from ",e,"to ",$I),SI(t,e),e<100&&(void 0===t.scene.publish.joystickSizeAndXYOffset&&(t.scene.publish.joystickSizeAndXYOffset=qL.defaultData.joystickSizeAndXYOffset),t.schema=100),e<101&&(pI(t,MI),dI(t,MI),t.schema=101),e<102&&(function(t){t.scene.objects.traverse(((t,e)=>{let n=e.geometry;n&&"PathGeometry"===n.type&&(n.extrusion.capType="flat",n.extrusion.bevel=50,n.extrusion.bevelSides=6,"Custom"===n.extrusion.shape.type&&(n.extrusion.shape.shapeQuality="low"))}))}(t),t.schema=102),e<104&&(t.shared.catelogs=new sR,t.shared.lib=sI.defaultData(),t.schema=104),e<105&&(function(t){t.shared.variables=eT({},sR.prototype)}(t),t.scene.objects.traverse(((t,e)=>{AI(e)})),t.schema=105);for(let e of Object.values(t.shared.lib.components))ZI(e);e<106&&(function(t){let e=XR(t.shared.variables);t.shared.variables=eT(Object.entries(e??{}).map((([t,e],n)=>({fi:n,id:t,data:e}))),mR.prototype)}(t),t.schema=106),e<107&&(t.shared.lib.variables=sI.defaultData().variables,t.schema=107),e<109&&(function(t){t.shared.particles=eT({},sR.prototype),t.shared.lib&&(t.shared.lib.particles=sI.defaultData().particles)}(t),t.schema=109),e<110&&(function(t){t.scene.objects.traverse(((t,e)=>{"Particle"===e.type&&"number"==typeof e.renderMaterial.size&&Object.assign(e.renderMaterial,{size:[e.renderMaterial.size,e.renderMaterial.size]})}))}(t),t.schema=110),e<111&&(t.scene.objects.traverse(((t,e)=>{!function(t){Array.isArray(XR(t.events))&&t.events?.forEach((t=>{"disabled"in t||(t.disabled=!1),("MouseDown"===t.type||"MouseUp"===t.type||"MousePress"===t.type)&&(t.mode=t.mode||"Object")}))}(e)})),t.schema=111),e<112&&(function(t){t.scene.objects.traverse(((t,e)=>{"Page"===e.type&&(e.postprocessing.depthOfField.focusDistance=100,e.postprocessing.depthOfField.focalLength=20,e.postprocessing.depthOfField.bokehScale=5)}))}(t),t.schema=112),e<113&&(function(t){t.scene.objects.traverse(((t,e)=>{!1!==Array.isArray(XR(e.events))&&e.events?.forEach((t=>{let e=t.runMode;"MouseDown"===t.type||"MouseUp"===t.type||"KeyDown"===t.type||"KeyUp"===t.type||"Collision"===t.type||"Trigger"===t.type?t.actions?.forEach((t=>{"Transition"===t.type&&(t.runMode=e??"Repeat"),("Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Toggle"===e?"Toggle":"Normal")})):"MouseHover"===t.type||"MousePress"===t.type||"KeyPress"===t.type?t.actions?.forEach((t=>{("Transition"===t.type||"Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Toggle")})):"GameControl"===t.type?(delete t.actions,Object.keys(t.gameActions).forEach((e=>{t.gameActions[e]?.forEach((t=>{"Transition"===t.type&&(t.runMode="Repeat"),"Animation"===t.type&&(t.runMode="Normal")}))}))):"DragDrop"===t.type?(delete t.actions,t.dragDropActions?.drag?.forEach((t=>{("Transition"===t.type||"Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Toggle")})),t.dragDropActions?.drop?.forEach((t=>{("Transition"===t.type||"Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Toggle")}))):"Resize"===t.type?(delete t.actions,t.breakpoints?.forEach((t=>{t.actions?.forEach((t=>{("Transition"===t.type||"Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Toggle")}))}))):"Start"===t.type?t.actions?.forEach((t=>{"Transition"===t.type&&(t.runMode="Once"),("Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Normal")})):"VariableChange"===t.type||"Scroll"===t.type?t.actions?.forEach((t=>{"Transition"===t.type&&(t.runMode="Repeat"),("Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Normal")})):"Conditional"===t.type&&(delete t.actions,t.inActions?.forEach((t=>{"Transition"===t.type&&(t.runMode="Repeat"),("Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Normal")})),t.outActions?.forEach((t=>{"Transition"===t.type&&(t.runMode="Repeat"),("Animation"===t.type||"SwitchCamera"===t.type)&&(t.runMode="Normal")})))}))}))}(t),t.schema=113),e<114&&(void 0===t.scene.publish.settings.web.imageQuality&&(t.scene.publish.settings.web.imageQuality=70),t.schema=114),e<115&&(function(t){t.shared.userAPIs=eT({},sR.prototype),t.shared.userWebhooks=eT({},sR.prototype),t.shared.lib&&(t.shared.lib.userAPIs=sI.defaultData().userAPIs,t.shared.lib.userWebhooks=sI.defaultData().userWebhooks)}(t),t.schema=115)}}(t=>{t.defaultData={schema:$I,scene:KL.defaultData,frames:(new sR).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",JL.defaultData),shared:{...aI.emptyData(),colors:aI.defaultColors()}},t.emptyDataForImports=function(){let t=KL.emptyDataWithPage();return{schema:$I,scene:t,frames:(new sR).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",JL.defaultData),shared:{...aI.emptyData(),colors:aI.defaultColors(),images:aI.defaultImages()}}},t.emptyData=function(){return{schema:$I,scene:KL.emptyDataWithPage(),frames:(new sR).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",JL.defaultData),shared:aI.emptyData()}},t.clipboard2dData=function(){return{schema:$I,scene:KL.emptyData(),frames:new sR,shared:aI.emptyData()}},t.collabHelper={...bR,updateSchema:t=>(t.schema??0)<$I?qR(t,KI):(t.schema??0)-$I},t.updateSchemaDirectly=function(e){let n=t.collabHelper.updateSchema(e);return"number"==typeof n?0===n?e:null:n.data},t.withoutLib=function(t){return{...t,shared:{...t.shared,lib:sI.defaultData()}}},t.getComponentData=function(t,e){let n=t.scene.objects.get(e);if(n&&"Component"===n.data.type)return n;{let n=t.shared.lib.components[e];if(n)return n.asset}},t.hasSensitiveData=function(t){let e=Object.values(t.shared.userAPIs);for(let t of e){let e=t.headers;for(let t of e)if("authorization"===t.data.key.toLowerCase()&&""!==t.data.value)return!0}return!1}})(CI||(CI={})),(t=>{t.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"}})(PI||(PI={})),(t=>{t.is=function(t){return!0}})(RI||(RI={})),(t=>{t.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]},t.merge=function(t,e){return{position:e?.position??t.position,rotation:e?.rotation??t.rotation,scale:e?.scale??t.scale,shear:e?.shear??t.shear}},t.diff=function(t,e){return tT({position:SD.isEqual(t.position,e.position)?void 0:e.position,rotation:t.rotation===e.rotation?void 0:e.rotation,scale:SD.isEqual(t.scale,e.scale)?void 0:e.scale,shear:t.shear&&e.shear&&SD.isEqual(t.shear,e.shear)?void 0:e.shear})}})(OI||(OI={})),(t=>{t.defaultData={horizontalConstraint:0,verticalConstraint:0}})(DI||(DI={})),(t=>{t.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8}})(LI||(LI={})),(t=>{t.defaultData={opacity:1,fill:{color:LD.fromHexAndA(WD,1),enabled:!0},stroke:{color:LD.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:LD.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:LD.from0to1([0,0,0,1]),enabled:!1,spread:0}}})(II||(II={})),(t=>{t.newEmpty=function(t,e){return{name:e}},t.patch=function(t,e){if(void 0===e)return t;let n={...t};return Object.assign(n,OI.merge(n,e)),n=function(t,e){if(void 0===e)return t;let n={...t},i=["width","height","cornerRadius"];for(let t of i)t in n&&t in e&&void 0!==e[t]&&Object.assign(n,{[t]:e[t]});return n}(n,e),n=function(t,e){if(void 0===e)return t;let n={...t};return"fill"in n&&"fill"in e&&void 0!==e.fill&&Object.assign(n,{fill:{...n.fill,...e.fill}}),"stroke"in n&&"stroke"in e&&void 0!==e.stroke&&Object.assign(n,{stroke:{...n.stroke,...e.stroke}}),"layerBlur"in n&&"layerBlur"in e&&void 0!==e.layerBlur&&Object.assign(n,{layerBlur:{...n.layerBlur,...e.layerBlur}}),"backgroundBlur"in n&&"backgroundBlur"in e&&void 0!==e.backgroundBlur&&Object.assign(n,{backgroundBlur:{...n.backgroundBlur,...e.backgroundBlur}}),"dropShadow"in n&&"dropShadow"in e&&void 0!==e.dropShadow&&Object.assign(n,{dropShadow:{...n.dropShadow,...e.dropShadow}}),"innerShadow"in n&&"innerShadow"in e&&void 0!==e.innerShadow&&Object.assign(n,{innerShadow:{...n.innerShadow,...e.innerShadow}}),n}(n,e),n},t.toOps=function(t,e){let n,i=[];for(let[t,r]of Object.entries(e))"name"!==t&&(void 0===n&&(n={path:[],props:{},type:0},i.push(n)),n.props[t]=r);return i}})(zI||(zI={})),(t=>{t.defaultData={...OI.defaultData,...DI.defaultData,states:new mR,events:new mR,visible:!0,raycastLock:!1}})(NI||(NI={})),(t=>{t.defaultData={...NI.defaultData,...II.defaultData}})(UI||(UI={})),(t=>{t.defaultData={cornerRadius:[0,0,0,0]}})(kI||(kI={})),(t=>{t.defaultData={...UI.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"}})(BI||(BI={})),(t=>{t.defaultData={...UI.defaultData,...kI.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"}})(FI||(FI={})),(t=>{t.defaultData={...UI.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"}})(VI||(VI={})),(t=>{t.defaultData={...UI.defaultData,type:"path2d",path:"",name:"Path"}})(jI||(jI={})),(t=>{t.is=function(t){return"ellipse2d"===t.type||"rectangle2d"===t.type||"text2d"===t.type||"vector2d"===t.type||"path2d"===t.type}})(HI||(HI={})),(t=>{t.defaultData={...NI.defaultData,name:"Group",type:"group2d"}})(GI||(GI={})),(t=>{t.defaultData=()=>({...NI.defaultData,...kI.defaultData,...II.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:LD.fromHexAndA(4737101,1),enabled:!0},stroke:{color:LD.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}})})(WI||(WI={})),(t=>{t.defaultData=function(t){switch(t){case"rectangle2d":case"vector2d":return{...FI.defaultData};case"ellipse2d":return{...BI.defaultData};case"text2d":return{...VI.defaultData};case"path2d":return{...jI.defaultData};case"frame2d":return{...WI.defaultData()};case"group2d":return{...GI.defaultData}}},t.getPivot=function(t){return"width"in t&&"height"in t?["number"==typeof t.width?.5*t.width:0,"number"==typeof t.height?.5*t.height:0]:[0,0]},t.isResizeable=function(t){return"rectangle2d"===t.type||"ellipse2d"===t.type||"text2d"===t.type||"frame2d"===t.type},t.isAutoLayoutable=function(t){return"frame2d"===t.type&&void 0!==t.autoLayout},t.hasCorners=function(t){return"rectangle2d"===t.type||"frame2d"===t.type}})(qI||(qI={})),(t=>{t.defaultData={name:"UI",type:"scene2d",objects:new fR},t.emptyData=function(){return{type:"scene2d",objects:new fR}}})(XI||(XI={}));var JI=XM(YM()),QI=.5*(Math.sqrt(3)-1),tz=(3-Math.sqrt(3))/6,ez=1/3,nz=1/6,iz=(Math.sqrt(5),Math.sqrt(5),t=>0|Math.floor(t)),rz=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),sz=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function az(t){let e=new Uint8Array(512);for(let t=0;t<256;t++)e[t]=t;for(let n=0;n<255;n++){let i=n+~~(t()*(256-n)),r=e[n];e[n]=e[i],e[i]=r}for(let t=256;t<512;t++)e[t]=e[t-256];return e}var oz,lz=new lv,cz=class{constructor(t){this.weightAttribute=null;let e=t.geometry;if(!e.isBufferGeometry||3!==e.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(e=e.toNonIndexed()),this.geometry=e,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let t=this.positionAttribute,e=new Float32Array(t.count/3);for(let n=0;n<t.count;n+=3){let i=1;lz.a.fromBufferAttribute(t,n),lz.b.fromBufferAttribute(t,n+1),lz.c.fromBufferAttribute(t,n+2),i*=lz.getArea(),e[n/3]=i}this.distribution=new Float32Array(t.count/3);let n=0;for(let t=0;t<e.length;t++)n+=e[t],this.distribution[t]=n;return this}setRandomGenerator(t){return this.randomFunction=t,this}sample(t,e){if(this.distribution){let n=this.distribution[this.distribution.length-1],i=this.binarySearch(this.randomFunction()*n);return this.sampleFace(i,t,e)}}binarySearch(t){if(!this.distribution)return 0;let e=this.distribution,n=0,i=e.length-1,r=-1;for(;n<=i;){let s=Math.ceil((n+i)/2);if(0===s||e[s-1]<=t&&e[s]>t){r=s;break}t<e[s]?i=s-1:n=s+1}return r}sampleFace(t,e,n){let i=this.randomFunction(),r=this.randomFunction();return i+r>1&&(i=1-i,r=1-r),lz.a.fromBufferAttribute(this.positionAttribute,3*t),lz.b.fromBufferAttribute(this.positionAttribute,3*t+1),lz.c.fromBufferAttribute(this.positionAttribute,3*t+2),e.set(0,0,0).addScaledVector(lz.a,i).addScaledVector(lz.b,r).addScaledVector(lz.c,1-(i+r)),lz.getNormal(n),this}},hz=XM(ZM()),uz=new Mg,dz=new Mg,pz=new Mg;(t=>{t.is=function(t){return t&&t.__isSPEObject}})(oz||(oz={}));var fz,mz=t=>class extends t{constructor(){super(...arguments),this.previousModelViewMatrix=new Mg,this.copyPreviousMatrix=!0,this.hiddenMatrix=new Mg,this.matrixWorldRigid=new Mg,this.shearScale=new Mg,this.shearScaleInv=new Mg}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof Kg&&(t=t.uuid);let e=this;for(;e.parent;){if(e.parent.uuid===t)return!0;e=e.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let e of this.children)e.updateMatrixWorld(t)}updateWorldMatrix(t,e){let n=this.parent;if(t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),e)for(let t of this.children)t.updateWorldMatrix(!1,!0)}traverseChildren(t,e=0){for(let n of this.children)oz.is(n)&&n.traverseObject(t,e+1)}traverseObject(t,e=0){if(!0!==t(this,e))for(let n of this.children)oz.is(n)&&n.traverseObject(t,e+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,e=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:n,v:i,q:r}=(0,hz.SVD)(e),s=uz.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),a=dz.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),o=pz.copy(a).transpose();this.shearScale.makeScale(r[0],r[1],r[2]).multiply(o).premultiply(a),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(s,o).copyPosition(this.matrixWorld),r.every((t=>Math.abs(r[0]-t)<.01))?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,e){this.updateWorldMatrix(!0,!1);let n=(new Mg).copy(this.matrixWorld).invert();return null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),n.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof Mg?t.hiddenMatrix.premultiply(n):t.applyMatrix4(n),t.updateWorldMatrix(!1,!1),this.add(t),void 0!==e&&(this.children.pop(),this.children.splice(e,0,t)),this}copy(t,e=!1){return super.copy(t,e),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,e,n,i,r,s){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},gz=class extends(mz(Kg)){},vz=class extends gz{constructor(t){super(),this.object=t,this.matrixAutoUpdate=!1,this.hasNonUniformScale=t.hasNonUniformScale}raycast(t,e){}expand(){let t=0,e=this.object.entityChildren(t);for(;e;){let n=this.children[t];n?.object!==e&&(n&&this.remove(n),n=new vz(e),this.add(n),this.children.splice(t,0,this.children.pop()),n.matrixWorldNeedsUpdate=!0,n.matrixAutoUpdate=!1,n.matrix=e.matrix,n.hiddenMatrix=e.hiddenMatrix),n.expand(),t+=1,e=this.object.entityChildren(t)}for(;this.children.length>t;)this.remove(this.children[t])}get visible(){return void 0!==this.playModeVisible?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&!0===this.object.dataPatched.cloner?.hideBase}set visible(t){}get castShadow(){return this.object.castShadow}set castShadow(t){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(t){}get isMesh(){return(t=>"Mesh"===t.type)(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(t){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},yz=new $m,xz=new $m,bz=new Mg,_z=[new $m(-1,1,1),new $m(-1,-1,1),new $m(1,-1,1),new $m(1,1,1),new $m(-1,1,-1),new $m(-1,-1,-1),new $m(1,-1,-1),new $m(1,1,-1)],wz=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],Sz=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],Mz=(t,e,n)=>{t.updateEntityBoxSize(yz,xz),bz.copy(e).multiply(t.matrixWorld),0===xz.x&&0===xz.y&&0===xz.z?n.push(new $m(yz.x,yz.y,yz.z).applyMatrix4(bz)):_z.forEach((t=>{n.push(t.clone().multiply(xz).add(yz).applyMatrix4(bz))}))},Tz=class extends Km{constructor(){super(...arguments),this.matrix=new Mg,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(t){return super.copy(t),this.matrix.copy(t.matrix),this.vertices=t.vertices.map((t=>t.clone())),this.faces=t.faces.map((t=>t.clone())),this.edges=t.edges.map((t=>t.clone())),this.centerEdges=t.centerEdges.map((t=>t.clone())),this}setFromObjectSize(t,e=!1){t.updateWorldMatrix(!1,e),this.makeEmpty(),this.matrix.copy(t.matrixWorld);let n=(new Mg).copy(t.matrixWorld).invert();return this.expandByObjectSize(t,n,e)}expandByObjectSize(t,e,n=!1){let i=[];return!0===n?t.traverseEntity((t=>{if(t.visible||t.cloner&&t.data.visible){if(!("geometry"in t))return void i.push(new $m);Mz(t,e,i)}})):Mz(t,e,i),this.setFromPoints(i)}getCenter(t){return(t=super.getCenter(t)).applyMatrix4(this.matrix),t}getPositionToCenter(t){return(t=super.getCenter(t)).applyMatrix4(bz.copy(this.matrix).setPosition(0,0,0)),t}computeVertices(){this.getSize(xz).multiplyScalar(.5),this.getCenter(yz),bz.copy(this.matrix).setPosition(yz),this.vertices=_z.map((t=>t.clone().multiply(xz).applyMatrix4(bz)))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=wz.map((([t,e])=>new rM(this.vertices[t],this.vertices[e]))),this.centerEdges=this.edges.map((t=>t.getCenter(new $m)))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=Sz.map((([t,e])=>this.vertices[t].clone().add(this.vertices[e]).multiplyScalar(.5)))}},Ez={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},Az=class extends uw{constructor(){super()}getPoints(t=12){let e,n=[],i=this.getCurveLengths(),r=i[i.length-1]/i.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=0===s?i[s]:i[s]-i[s-1],c=Math.ceil(t*l/r),h=o.getPoints(c);for(let t=0;t<h.length;t++){let i=h[t];e&&e.equals(i)||(n.push(i),e=i)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},Cz=.001;function Pz(t,e,n){return e.clone().sub(t).cross(e.clone().sub(n)).length()<=Cz}function Rz(t,e){let n=new $m(...t.position),i=new $m(...t.controlNext.position),r=new $m(...e.controlPrevious.position),s=new $m(...e.position);return Pz(n,i,s)&&Pz(n,r,s)}function Oz(t){let e=t.points.map((t=>new $m(...t.data.position))),n=[t.points[0]],i=new $m(...n[0].data.position);for(let r=0;r<t.points.length-1;r++)Pz(i,e[r],e[r+1])||(n.push(t.points[r]),i=e[r]);n.push(t.points[t.points.length-1]);let r=t.isClosed,s=n.length-(r?0:1),a=n.length,o=[];for(let e=0;e<a;e++){let i=n[e].data,s=new $m(...i.position),l=new $m(...i.controlPrevious.position),c=new $m(...i.controlNext.position),h={position:s,baseRoundness:i.roundness,controlPrevious:l,controlNext:c};if(0===i.roundness||!t.isClosed&&(0===e||e===a-1)){o[e]={...h,removedLength:0};continue}let u=r&&e==a-1?0:e+1,d=n[r&&0==e?a-1:e-1].data,p=n[u].data,f=new $m(...d.position),m=new $m(...p.position),g=f.clone().sub(s).normalize(),v=m.clone().sub(s).normalize();Object.assign(h,{prevDir:g,nextDir:v});let y=Rz(d,i),x=Rz(i,p);if(y&&x){let t=g.clone().add(v).normalize(),n=t.clone().cross(g).length()/g.dot(t);o[e]={...h,tan:n,removedLength:i.roundness/n}}else o[e]={...h,removedLength:0}}for(let t=0;t<s;t++){let e=r&&t===a-1?0:t+1,n=o[t],i=o[e];if(0!==n.removedLength||0!==i.removedLength){let t=n.position.distanceTo(i.position);n.removedLength=Math.min(n.removedLength,t/2),i.removedLength=Math.min(i.removedLength,t/2)}}let l=[];for(let t=0;t<s;t++){let e=t,i=r&&t===a-1?0:t+1,s=o[e],c=o[i],h=null;if(Rz(n[e].data,n[i].data)){let t=s.position.clone(),e=c.position.clone();(0!==s.removedLength||0!==c.removedLength)&&(s.nextDir&&t.add(s.nextDir.clone().setLength(s.removedLength)),c.prevDir&&e.add(c.prevDir.clone().setLength(c.removedLength))),t.distanceTo(e)>Cz&&(h=new rw(t,t.clone().lerp(e,.3),e.clone().lerp(t,.3),e))}else s.position.distanceTo(c.position)>Cz&&(h=new rw(s.position,s.controlNext,c.controlPrevious,c.position));l[2*t+1]=h}for(let t=0;t<a;t++){let e=o[t];if(0===e.removedLength){l[2*t]=null;continue}let n=e.position,i=e.prevDir.clone().multiplyScalar(e.removedLength).add(n),r=e.nextDir.clone().multiplyScalar(e.removedLength).add(n),s=e.tan*e.removedLength,a=e.prevDir.clone().add(e.nextDir).normalize(),c=i.clone().lerp(r,.5),h=i.distanceTo(r)/2,u=a.clone().multiplyScalar(Math.sqrt(Math.pow(s,2)-Math.pow(h,2))).add(c),d=a.clone().multiplyScalar(-s).add(u),p=n.distanceTo(d)/n.distanceTo(c),f=e.prevDir.clone().multiplyScalar(p*n.distanceTo(i)).add(n),m=f.clone().lerp(d,2),g=i.clone().lerp(f,4/3),v=r.clone().lerp(m,4/3);l[2*t]=new rw(i,g,v,r)}let c=new Az;return l.forEach((t=>{t&&c.add(t)})),c}(t=>{t.is=function(t){return t&&t.__isEntity}})(fz||(fz={}));var Dz=t=>fz.is(t),Lz={type:"completeState",isfromEntity:!0},Iz=["x","y","z"],zz=new $m,Nz=(new $m).set(0,1,0),Uz=t=>class extends(mz(t)){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new Tz,this._recursiveBBox=new Tz,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let e=this.children[t];if(fz.is(e))return e}entityChildrenCount(){let t=this.children.length;for(;t--;)if(fz.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return"string"==typeof this.identity}get isVirtualEntity(){return"string"!=typeof this.identity}get isInstanceRoot(){return this.isConcreteEntity&&"Instance"===this.data.type}nearestInstanceSelfOrParent(){let t=this;for(;"Instance"!==t.data.type;){let e=t.parent;if(!fz.is(e))return;t=e}return t}forInstancesRec(t){this.instances.forEach((e=>{e.disposed||t(e),e.forInstancesRec(t)}))}super_Entity(t,e){"string"==typeof t&&(this.uuid=t),this.identity=t,this.data=e,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,e,n=!1){if(0!==this.data.states.length||n){for(let t of this.data.states)GL.toOps(this.data,t.data).forEach((t=>{let n=yR.replaceProps(t,this.data);this.dataPatched=this.data,this.updateByPatchedOp(n,this.data,e)}));if(null!==t){let n=this.data.states.data(t);n&&(this.dataPatched=GL.patch(this.data,n),GL.toOps(this.data,n).forEach((t=>{this.updateByPatchedOp(t,this.dataPatched,e)})))}n&&this.updateTransformState(this.dataPatched,e),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,e){t.setScalar(0),e.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors((t=>{Dz(t)&&t.resetBBoxNeedsUpdateSelf()})),this.traverseEntity((t=>{t.resetBBoxNeedsUpdateSelf()}))}find(t){let e;return this.traverseEntity((n=>{n.uuid===t&&(e=n)})),e}traverseSortNextHelper(){let t=this.parent;if(t){let e=t.children,n=e.indexOf(this)+1;if(fz.is(e[n]))return e[n];if(fz.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&fz.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let e=this;for(;t>0&&null!==e;)e=e.parent,t-=1;return e}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let e=this.parent;for(;e;){if(t===e)return!0;e=e.parent}return!1}countToAccestor(t){let e=0,n=this;for(;n!==t;){if(null===n)return-1;n=n.parent,e+=1}return e}forEachEntity(t){for(let e of this.children)Dz(e)&&t(e)}traverseEntityAncestors(t){this.traverseAncestors((e=>{fz.is(e)&&t(e)}))}traverseConcreteEntity(t,e=0){if(!0!==t(this,e))for(let n of this.children)Dz(n)&&n.isConcreteEntity&&n.traverseEntity(t,e+1)}traverseEntity(t,e=0){if(!0!==t(this,e))for(let n of this.children)Dz(n)&&n.traverseEntity(t,e+1)}traverseVisibleEntity(t){t(this);for(let e of this.children)Dz(e)&&e.visible&&e.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(t){super.updateMatrixWorld(t),this.dispatchEvent({type:"updateMatrixWorld"})}copy(t,e=!1){return super.copy(t,e),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some((t=>Dz(t)))}isAncestorOf(t){if(this.uuid===t)return!1;let e=!1;return this.traverseEntity((n=>{n.uuid===t&&(e=!0)})),e}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let e={position:this.position.toArray(),rotation:[this.rotation.x*vm.RAD2DEG,this.rotation.y*vm.RAD2DEG,this.rotation.z*vm.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return QP(e,t)}getTransformValues(t,e,n){return e[t].map(((e,i)=>n?.shared.getVariable(e,[this.uuid,t,Iz[i]])??e))}updateTransformState(t,e){let n=!1;return t.position&&(this.position.fromArray(this.getTransformValues("position",t,e)),n=!0),t.rotation&&(zz.fromArray(this.getTransformValues("rotation",t,e)).multiplyScalar(vm.DEG2RAD),this.rotation.setFromVector3(zz),n=!0),t.scale&&(this.scale.fromArray(this.getTransformValues("scale",t,e)),n=!0),void 0!==t.hiddenMatrix&&(n=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??PD.identity)),n&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors((t=>{t.invalidateClonerTransform(this)}))),t.position&&t.rotation&&t.scale&&void 0!==t.hiddenMatrix&&this.updateWorldMatrix(!1,!0),n}onVariableUpdate(t=!1){t?this.resetBBoxNeedsUpdate():(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors((t=>{t.invalidateClonerTransform(this)})))}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)fz.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach((t=>{fz.is(t)&&t.disposeRecursively()}))}toState(t=[]){let e={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return QP(e,t)}updateByObjUpdateOp(t,e){void 0!==t&&this.updateByOp({type:0,props:t,path:[]},{...this.data,...t},e,!1)}updateByOp(t,e,n,i){let r=this.data;this.data=e;let s=t,a=$R(t.path,["states","*"]);if(null!==a){if(0===t.type){let[e]=a;if(this?.stateSelection===e){let e={...t.props};if(delete e.name,Object.values(t.props).some((t=>void 0===t))){let n=this.data;if(void 0!==n){let i=jR.zoom(n,t.path.slice(2));if(i)for(let n in t.props)void 0===t.props[n]&&n in i&&(e[n]=i[n])}}s={...t,props:e,path:t.path.slice(2)}}}}else if(0===t.type){let e=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==e){if(void 0!==t.props.name&&e.name){let{name:t,...n}=e;e=n}if(void 0!==t.props.material&&"material"in e){let{material:t,...n}=e;e=n}let n=jR.removeOverridden(t.path,t.props,e);s={...t,props:n}}}if(this.updateByPatchedOpBase(s,GL.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),n),$R(t.path,["overrides"])){let i=[],r=[...t.path];for(i.push(r[1]),r.splice(0,2);r.length>0&&"descendants"===r[0];)i.push(r[1]),r.splice(0,2);if(void 0===i[i.length-1]){if(0===t.type)for(let e of Object.keys(t.props)){i[i.length-1]=e;let r=n.scene.findInstance([this.uuid,...i]);r&&(r.overrideData=t.props[e],r.updateState(vR.apply(r.component.data,r.overrideData),n))}}else{let s=n.scene.findInstance([this.uuid,...i]);if(s){let a=jR.zoom(s.component.data,r);if(0===(t={...t,path:r}).type){let e=t.props;if(a)for(let[n,i]of Object.entries(t.props))void 0===i&&(e===t.props&&(e={...t.props}),e[n]=a[n]);t={...t,props:e}}s.overrideData=FL.resolve(e.overrides,i),s.updateByOp(t,xR.applySimple(s.data,t),n,!1)}}}else if(this.instances.length>0){let i;if(0===t.path.length&&0===t.type){let e;for(let n of VL.rootOverrideProps)n in t.props&&(void 0===e&&(e={}),e[n]=t.props[n]);e&&(i={...t,props:e})}else for(let e of VL.rootOverrideProps)if($R(t.path,[e])){i=t;break}void 0!==i&&this.instances.forEach((t=>{if(t.isInstanceRoot){let e=vR.filterOp(t.overrideData,i);e&&t.updateByOp(e,xR.applySimple(t.data,e),n,!0)}})),this.instances.forEach((i=>{if(!i.isInstanceRoot){let s=vR.filterOp(i.overrideData,t);if(s){let a;a=r===i.data&&t===s?e:xR.applySimple(i.data,s),i.updateByOp(s,a,n,!0)}}}))}}updateByPatchedOpBase(t,e,n){if(this.dataPatched=e,0===t.path.length&&0===t.type)void 0!==t.props.type&&!BD.is(t.props.type)&&Ez.changeEntityProptotype(this,e,n);else if(1===t.path.length&&"geometry"===t.path[0]&&0===t.type&&"type"in t.props){Ez.changeEntityProptotype(this,e,n);for(let t of this.children)fz.is(t)&&t.updateVisible(n.scene)}this.updateByPatchedOp(t,e,n)}updateByPatchedOp(t,e,n){if(0===t.path.length&&0===t.type?this.updateState(t.props,n):0===t.type&&("resolutionLevel"in t.props||"useChildrenColors"in t.props)&&this.updateState(e,n),"morphTargetInfluences"===t.path[0]&&0===t.type){let i=e.morphTargetInfluences.get(t.path[1])?.data.name;i&&this.updateMorphInfluences(i,n.shared.getVariable(t.props.value,[this.uuid,"morphTargetInfluences",i]))}if(null!==$R(t.path,["pathSnapping"])&&this.updatePathSnapping(e.pathSnapping),null!==$R(t.path,["cloner"])){let i=xR.drop(t,1);0===i.path.length&&0===i.type&&!0===i.props.disabled?this.setFromClonerState(null,n):this.cloner?this.cloner.updateState(e.cloner,n.scene):(this.setFromClonerState(e.cloner,n),this.expandCloner(n.scene)),this.updateVisible(n.scene)}}updatePathSnapping(t=this.dataPatched.pathSnapping){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){let e=this._updatedPathSnapping?.pathId??this.dataPatched.pathSnapping.pathId,n=this._updatedPathSnapping?.slide??this.dataPatched.pathSnapping.slide??0,i=this._updatedPathSnapping?.offset??this.dataPatched.pathSnapping.offset??0,r=this._updatedPathSnapping?.orientation??this.dataPatched.pathSnapping.orientation;if(null===e)return;let s=t.find(e);if(!s||!1===this._needApplyPathSnapping)return;this._needApplyPathSnapping=!1;let a=s.data;if(a.geometry.path.points.length<=1)return;let o=Oz(a.geometry.path),l=(n+i)%1;n+i===1&&0===l&&(l=1);let c=null;try{c=o.curves.length?o.getPointAt(l):null}catch(t){}if(null===c)return;let h=this.parent?this.parent?.matrixWorld:new Mg;s.updateMatrixWorld();let u=(new Mg).multiplyMatrices(h.clone().invert(),s.matrixWorld);c.applyMatrix4(u);let d={position:c.toArray(),rotation:a.rotation};if("tangential"===r){let t=(new Mg).extractRotation(s.matrixWorld),e=o.getTangentAt(l).applyMatrix4(t).add(c),n=(new Mg).lookAt(c,e,Nz),i=zz.setFromEuler((new Ig).setFromRotationMatrix(n)).multiplyScalar(vm.RAD2DEG);d={...d,rotation:i.toArray()}}this.updateTransformState(d),this.traverseEntity((t=>{t._cameraType&&t.dispatchEvent(Lz)}))}updateVisible(t){if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||!0!==this.dataPatched.cloner?.hideBase),!t)return;let e=!1;this.traverseEntity((t=>{if("Splat"===t.data.type)return e=!0,!0})),e&&t.reloadSplats()}updateState_Entity(t,e){void 0!==t.name&&(this.name=t.name),void 0!==t.raycastLock&&(this.raycastLock=t.raycastLock),void 0!==t.visible&&(this.updateVisible(e?.scene),this.resetBBoxNeedsUpdate()),e&&"cloner"in t&&void 0!==t.cloner&&(this.setFromClonerState(t.cloner,e),this.updateVisible(e.scene)),this.updateTransformState(t,e)}get attachedSurfaceCloners(){return this.children.filter((t=>t instanceof Ez.Cloner&&"toObject"===t.parameters.type))}setFromClonerState(t,e){this.disposed||(null===t||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):void 0===this.cloner?(this.cloner=new Ez.Cloner(this,t),e.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,e.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}requestRender(){this.dispatchEvent({type:"requestRender"})}};function kz(t,e,n){n.x=t.x*e.x,n.y=t.y,n.z=t.x*e.y}function Bz(t){return new ym(t.y,-t.x)}var Fz=class extends Nv{constructor(t,e,n,i,r,s,a,o,l,c,h,u,d=!1){super(),this.type="RoundedCylinderBufferGeometry",t=void 0!==t?t:1,e=void 0!==e?e:1,n=n||1,i=Math.floor(i)||8,r=Math.floor(r)||1,s=void 0!==s&&s,a=void 0!==a?a:0,o=void 0!==o?o:2*Math.PI,s&&(l=0,c=0);let p=[],f=[],m=[],g=[],v=0,y=n/2,x=new $m,b=new $m;d&&0==t&&(t=l),d&&0==e&&(e=c);let _=new ym(t,y),w=new ym(e,-y),S=null,M=null,T=null,E=null,A=_.clone().sub(w),C=0,P=0,R=0;u>0&&(C=Math.min(t,e)*(1-u),P=t-C,R=e-C);let O=_.clone();O.x-=C;let D=Math.PI-A.angle(),L=A.angle(),I=Math.tan(L/2),z=Math.tan(D/2),N=I+z,U=u?N:z,k=u?N:I;if(l=Math.min(l,(t-P)/U,A.length()/N),c=Math.min(c,(e-R)/k,A.length()/N),l>0){let t=l/I;S=_.clone().sub(new ym(t,l)),u&&(T=S.clone(),T.x-=C-N*l),_.sub(A.clone().setLength(t))}if(c>0){let t=c/z;M=w.clone().sub(new ym(t,-c)),w.add(A.clone().setLength(t)),u&&(E=M.clone(),E.x-=C-N*c,O.sub(A.clone().setLength(t)))}A=_.clone().sub(w);let B=A.length()<.5,F=[];for(let h=0;h<=i;h++){let d=[],p=h/i,y=p*o+a,_=new ym(Math.sin(y),Math.cos(y));if(E&&M?(V(d,p,_,D,c,E,-1,!0),V(d,p,_,L,c,M,-1,!1)):M?(j(d,_,M.x,0,-1),V(d,p,_,L,c,M,-1,!1)):s||j(d,_,e,R,-1),kz(Bz(A).normalize(),_,x),!B)for(let t=0;t<=r;t++){let e=t/r;kz(A.clone().multiplyScalar(e).add(w),_,b),f.push(b.x,b.y,b.z),m.push(x.x,x.y,x.z),g.push(p,.5+b.y/n),d.push(v++)}if(T&&S?(V(d,p,_,D,l,S,1,!1),V(d,p,_,L,l,T,1,!0)):S?(V(d,p,_,D,l,S,1,!1),j(d,_,S.x,0,1)):s||j(d,_,t,P,1),u&&!B){kz(Bz(A).multiplyScalar(-1).normalize(),_,x);for(let t=0;t<=r;t++){let e=t/r;kz(A.clone().multiplyScalar(-e).add(O),_,b),f.push(b.x,b.y,b.z),m.push(x.x,x.y,x.z),g.push(p,.5+b.y/n),d.push(v++)}}u&&!s&&d.push(d[0]),F.push(d)}for(let t=0;t<F.length-1;t++)for(let e=0;e<F[0].length-1;e++){if(s&&u&&e==r)continue;let n=F[t][e],i=F[t+1][e],a=F[t+1][e+1],o=F[t][e+1],l=f[3*a+0],c=f[3*a+2];p.push(n,i,o),(0!=l||0!=c)&&p.push(i,a,o)}function V(t,e,i,r,s,a,o,l){for(let c=0;c<h+1;c++){let u=c/h,d=o<0?u:1-u;l&&(d-=1),d*=r;let p=new ym(Math.sin(d),Math.cos(d)*o);kz(p.clone().multiplyScalar(s).add(a),i,b),f.push(b.x,b.y,b.z),kz(p,i,x),m.push(x.x,x.y,x.z),g.push(e,.5+b.y/n),t.push(v++)}}function j(t,e,n,i,r){let s=new $m,a=new ym,o=[n,i];r<0&&o.reverse();for(let n of o)a.set(n,y*r),kz(a,e,s),f.push(s.x,s.y,s.z),m.push(0,r,0),g.push(.5,.5),t.push(v++)}function H(n,i,r){let s=new ym(Math.sin(r),Math.cos(r)),a=new ym(-Math.cos(r),Math.sin(r)),o=new $m,l=n<0?(t,e,n)=>p.push(t,e,n):(t,e,n)=>p.push(t,n,e);kz(new ym((t+e+P+R)/4,0),s,o),f.push(o.x,o.y,o.z),m.push(a.x,0,a.y),g.push(.5,.5);let c=v++;for(let t of i){let e=f.slice(3*t,3*t+3);f.push(...e),m.push(a.x,0,a.y);let n=g.slice(2*t,2*t+2);g.push(...n),v++}for(let t=c+1;t<v-1;t++)l(c,t,t+1);l(c,v-1,c+1)}o<2*Math.PI&&(H(-1,F[0],a),H(1,F[F.length-1],a+o)),this.setIndex(p),this.setAttribute("position",new Cv(f,3)),this.setAttribute("normal",new Cv(m,3)),this.setAttribute("uv",new Cv(g,2))}},Vz=Math.PI/2,jz=class extends Nv{constructor(t=1,e=1,n=1,i=1,r=1,s=1,a=0,o=4){super(),this.type="BoxGeometry",i=Math.floor(i),r=Math.floor(r),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,t/2,e/2,n/2);let l=[],c=[],h=[],u=[],d=0;function p(t,e,n,i,r,s,o,p,f,m){let g=(s-2*a)/f,v=(o-2*a)/m,y=s/2-a,x=o/2-a,b=p/2,_=f+1,w=m+1,S=0,M=new $m;for(let s=0;s<w;s++){let a=s*v-x;for(let o=0;o<_;o++){let l=o*g-y;M[t]=l*i,M[e]=a*r,M[n]=b,c.push(M.x,M.y,M.z),M[t]=0,M[e]=0,M[n]=p>0?1:-1,h.push(M.x,M.y,M.z),u.push(o/f),u.push(1-s/m),S+=1}}for(let t=0;t<m;t++)for(let e=0;e<f;e++){let n=d+e+_*t,i=d+e+_*(t+1),r=d+(e+1)+_*(t+1),s=d+(e+1)+_*t;l.push(n,i,s),l.push(i,r,s)}d+=S}function f(t,e,n,i,r,s,p,f,m,g){let v=(p-2*a)/g,y=p/2-a,x=f/2-a,b=m/2,_=g+1,w=0,S=new $m,M=new $m;for(let l=0;l<o+1;l++){let d=l/o*Vz,p=Math.sin(d)*a,f=(1-Math.cos(d))*a,m=Math.sin(d),T=Math.cos(d);S[e]=(x+p)*r,S[n]=(b-f)*s,M[t]=0,M[e]=m*Math.sign(S[e]),M[n]=T*Math.sign(S[n]);for(let e=0;e<_;e++){let n=e*v-y;S[t]=n*i,c.push(S.x,S.y,S.z),h.push(M.x,M.y,M.z),u.push(e/g),u.push(0),w+=1}}for(let t=0;t<o;t++)for(let e=0;e<g;e++){let n=d+e+_*t,i=d+e+_*(t+1),r=d+(e+1)+_*(t+1),s=d+(e+1)+_*t;l.push(n,i,s),l.push(i,r,s)}d+=w}function m(i,r,s){let p=new $m,f=new $m(t/2,e/2,n/2);f.subScalar(a);let m=[],g=i*r*s>0?(t,e,n)=>l.push(t,e,n):(t,e,n)=>l.push(t,n,e);for(let t=0;t<=o;t++){let e=[],n=Vz*(1-t/o),l=Math.cos(n),g=Math.sin(n),v=0;for(let n=0;n<=t;n++){let n=Math.cos(v),o=Math.sin(v);p.x=l*n,p.y=g,p.z=l*o;let m=f.clone().addScaledVector(p,a);c.push(i*m.x,r*m.y,s*m.z),h.push(i*p.x,r*p.y,s*p.z),u.push(0,0),e.push(d++),v+=Vz/t}m.push(e)}let v=m.length-1;for(let t=0;t<v;t++){let e=m[t],n=m[t+1],i=e.length-1;g(e[0],n[1],n[0]);for(let t=1;t<=i;t++)g(e[t-1],e[t],n[t]),g(e[t],n[t+1],n[t])}}p("z","y","x",-1,-1,n,e,t,s,r),p("z","y","x",1,-1,n,e,-t,s,r),p("x","z","y",1,1,t,n,e,i,s),p("x","z","y",1,-1,t,n,-e,i,s),p("x","y","z",1,-1,t,e,n,i,r),p("x","y","z",-1,-1,t,e,-n,i,r),a>0&&(f("z","y","x",-1,-1,1,n,e,t,s),f("z","y","x",1,-1,-1,n,e,t,s),f("z","y","x",-1,1,-1,n,e,t,s),f("z","y","x",1,1,1,n,e,t,s),f("x","y","z",-1,-1,-1,t,e,n,i),f("x","y","z",1,-1,1,t,e,n,i),f("x","y","z",-1,1,1,t,e,n,i),f("x","y","z",1,1,-1,t,e,n,i),f("y","x","z",-1,-1,1,e,t,n,r),f("y","x","z",1,-1,-1,e,t,n,r),f("y","x","z",1,1,1,e,t,n,r),f("y","x","z",-1,1,-1,e,t,n,r),m(1,1,1),m(-1,1,1),m(1,-1,1),m(-1,-1,1),m(1,1,-1),m(-1,1,-1),m(1,-1,-1),m(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new Cv(c,3)),this.setAttribute("normal",new Cv(h,3)),this.setAttribute("uv",new Cv(u,2))}},Hz=class extends Nv{constructor(t=[],e=[],n="",i=1,r=.2,s=4){super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];return function(){0==(r=Math.min(.99999,r))&&(s=0);let o={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[n],c=new $m,h=c.clone(),u=new lv,d=r*i,p=i-d,f=s+1,m=new $m,g=(t,e)=>m.subVectors(t,e).normalize(),v=(t,e)=>Array(t).fill(void 0).map(e),y=v(t.length/3,((e,n)=>(new $m).fromArray(t,3*n).setLength(i))),x=[],b=1e6;for(let t=0;t<y.length;t++){let n,i,r,s=y[t],a=[],o=1e10,l=-1;for(;-1!=(l=e.indexOf(t,l+1));){let t=l-l%3;n=e[t+(l+1)%3],i=e[t+(l+2)%3],r=s.distanceToSquared(y[n]),o=Math.min(o,r),a.push([n,i,r])}o+=1e-6;let c=[],h=0,u=a.length;for(let e=0;e<u;e++){[n,i,r]=a[h];let e=1==x[n]?.includes(t);r<=o&&c.push(n+ +e*b),h=a.findIndex((t=>t[0]==i))}x.push(c)}let _=[];{let t,e,n=0,i=0,r=3==o;for(let a=0;a<=s;a++){t=a*(a+1)/2,e=(a+1)*(a+2)/2;for(let o=0;o<s-a;o++)[n,i]=[t+o+a+2,e+o+a+3],_.push(t,e,...r?[i,t]:[n,e],i,n),[t,e]=[n,i];_.push(t,e,t+s+2)}}let w=c.clone(),S=c.clone(),M=c.clone(),T=c.clone(),E=c.clone(),A=[],C=v(y.length,(()=>v(o,(()=>c.clone()))));for(let t=0;t<y.length;t++){c.copy(y[t]).normalize(),w.copy(c).multiplyScalar(p);let e=x[t];for(let n=0;n<e.length;n++){let i=e[n],r=e[(n+1)%o];u.setFromPointsAndIndices(y,t,i%b,r%b),u.b.sub(u.a).setLength(1e10).add(u.a),u.c.sub(u.a).setLength(1e10).add(u.a),u.closestPointToPoint(w,C[t][n])}let n=[],i=[],r=[],v=new $m;0==s&&[...C[t]].reduce(((t,e)=>t.add(e)),v).multiplyScalar(1/o);for(let e=0;e<o;e++){let a=[],l=(e-1+o)%o,u=C[t][l],y=C[t][e];c.copy(u).sub(w),h.copy(y).sub(w);let x=w.angleTo(c),b=c.angleTo(h),_=Math.cos(x)*d;0==s?S.copy(v):S.copy(w).setLength(p+_),i.push(_);let A=[S,u,y];for(let t=0;t<2;t++){let e=A[t],i=A[t+1];T.subVectors(e,w),E.subVectors(i,w),M.crossVectors(T,E).normalize();for(let i=0;i<f;i++){let r=[x,b][t]*i/f;c.copy(T).applyAxisAngle(M,r).add(w),n.push(c.clone()),t&&(g(c,w),a.push([0==i?e:c.clone(),m.clone()]))}t&&(g(i,w),a.push([i,m.clone()]))}r.push(a)}A.push(r);let P=2*f,R=2;for(let t=0;t<o;t++){let e=P*t,r=P*((t+1)%o),s=[n[e]];for(let a=1;a<f;a++){T=n[e+a],E=n[r+a],s.push(T);for(let e=1,n=a-R+1;e<=n;e++)c.lerpVectors(T,E,e/(n+1)),c.sub(w).setLength(i[t]).add(w),s.push(c.clone());s.push(E)}for(let t=0;t<f;t++)s.push(n[t+f+e]);s.push(n[r+f]);let h=_.map((t=>s[t]));a.push(...h.map((t=>[t.x,t.y,t.z])).flat()),l.push(...h.map((t=>(g(t,w),[m.x,m.y,m.z]))).flat())}}let P=[];for(let t=0;t<x.length;t++)for(let e=0;e<o;e++){let n=x[t][e];if(n<b){let i=x[n].findIndex((e=>e%b==t)),r=A[t][e],s=A[n][i];for(let t=0;t<f;t++){let e=r[t],n=s[f-t],i=r[t+1];[e,n,i,i,n,s[f-(t+1)]].forEach((t=>{a.push(t[0].x,t[0].y,t[0].z),l.push(t[1].x,t[1].y,t[1].z)}))}P.push(r[0][0],s[f][0],r[f][0],s[0][0])}}for(;P.length;){let t,e,n,i;[t,e]=P.splice(0,2);let r=[t];for(;t!=e;)r.push(e),n=P.indexOf(e),i=n%2,e=P.splice(n-i,2)[1-i];m.subVectors(r[0],r[1]).cross(c.subVectors(r[0],r[2])).normalize();let s=m.dot(r[0])<0;s&&m.negate();for(let t=1;t<=r.length-2;t++)[r[t+ +s],r[t+1-+s],r[0]].forEach((t=>{a.push(t.x,t.y,t.z),l.push(m.x,m.y,m.z)}))}}(),function(){let t=new $m;for(let e=0;e<a.length;e+=3){t.x=a[e+0],t.y=a[e+1],t.z=a[e+2];let n=u(t)/2/Math.PI+.5,i=d(t)/Math.PI+.5;o.push(n,1-i)}let e=new $m,n=new $m,i=new $m,r=new $m,s=new ym,l=new ym,c=new ym,h=(t,e,n,i)=>{i<0&&1===t.x&&(o[e]=t.x-1),0===n.x&&0===n.z&&(o[e]=i/2/Math.PI+.5)};for(let t=0,d=0;t<a.length;t+=9,d+=6){e.set(a[t+0],a[t+1],a[t+2]),n.set(a[t+3],a[t+4],a[t+5]),i.set(a[t+6],a[t+7],a[t+8]),s.set(o[d+0],o[d+1]),l.set(o[d+2],o[d+3]),c.set(o[d+4],o[d+5]),r.copy(e).add(n).add(i).divideScalar(3);let p=u(r);h(s,d+0,e,p),h(l,d+2,n,p),h(c,d+4,i,p)}for(let t=0;t<o.length;t+=6){let e=o[t+0],n=o[t+2],i=o[t+4],r=Math.max(e,n,i),s=Math.min(e,n,i);r>.9&&s<.1&&(e<.2&&(o[t+0]+=1),n<.2&&(o[t+2]+=1),i<.2&&(o[t+4]+=1))}function u(t){return Math.atan2(t.z,-t.x)}function d(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}}(),this.setAttribute("position",new Cv(a,3)),this.setAttribute("normal",new Cv(l,3)),void this.setAttribute("uv",new Cv(o,2))}static fromJSON(t){return new Hz(t.vertices,t.indices,t.radius,t.corner,t.cornerSides)}},Gz=class extends Hz{constructor(t=1,e=.2,n=4){let i=(1+Math.sqrt(5))/2,r=1/i,s="DodecahedronGeometry";super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],s,t,e,n),this.type=s}static fromJSON(t){return new Gz(t.radius,t.corner,t.cornerSides)}},Wz=1e-12,qz=class{constructor(t){this.position=new ym,this.startPosition=new ym,this.uuid=vm.generateUUID(),this.position=t.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(t){this.position.copy(this.startPosition).add(t)}copy(t){return this.position.copy(t.position),this.startPosition.copy(t.startPosition),this}clone(){return new qz(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},Xz=class extends qz{constructor(t){super(t.position),this.parent=t}copy(t){return super.copy(t),this}clone(){return new Xz(this.parent).copy(this)}},$z=class extends qz{constructor(t,e){super(e),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=t,this.controls.push(new Xz(this),new Xz(this))}static create(t,e){let n=new $z(t,new ym(...e.position));return n.controls[0].position.set(...e.controlPrevious.position),n.controls[1].position.set(...e.controlNext.position),n.roundness=e.roundness,n.areControlsDirectionsMirrored=e.areControlsDirectionsMirrored,n}getOppositeControl(t){let e=this.controls.indexOf(t);return 0===e?this.controls[1]:1===e?this.controls[0]:null}applyOffsetToControls(t,e=1){for(let n=0,i=this.controls.length;n<i;n++){let i=this.controls[n];this.position.distanceTo(i.position)<=e?i.position.copy(this.position):i.applyOffset(t)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(t){return super.copy(t),this.controls[0].copy(t.controls[0]),this.controls[1].copy(t.controls[1]),this.roundness=t.roundness,this.uuid=t.uuid,this}clone(){return new $z(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){let t=this.curveBefore?.getTangentAt(1),e=this.curveAfter?.getTangentAt(0);return[t,e]}computeNormals(t=new ym,e=new ym){let[n,i]=this.computeTangents();return n&&i&&(Yz(n,t),Yz(i,e)),[t,e]}computeTangent(t=new ym){let[e,n]=this.computeTangents();return e&&n&&t.copy(e).add(n).normalize(),t}computeNormal(t=new ym){let[e,n]=this.computeNormals();return t.copy(e).add(n).normalize(),t}};function Yz(t,e=new ym){let n=t.length();return e.set(-t.y/n,t.x/n)}var Zz=new ym,Kz=new ym,Jz=new ym,Qz=new ym,tN=new ym,eN=new ym,nN=new $m,iN=new $m;function rN(t){let e=new ym;e.addVectors(t.v0,Zz.subVectors(t.v1,t.v0).multiplyScalar(2/3));let n=new ym;return n.addVectors(t.v2,Kz.subVectors(t.v1,t.v2).multiplyScalar(2/3)),new iw(t.v0,e,n,t.v2)}function sN(t,e,n=Number.EPSILON){return Math.abs(t-e)<n}function aN(t,e,n=Number.EPSILON){return t.distanceTo(e)<n}function oN(t,e,n=Number.EPSILON){return t.distanceTo(e)<n}function lN(t,e,n){let i=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),r=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),s=Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2));return Math.acos((r*r+i*i-s*s)/(2*r*i))}function cN(t,e,n){return mN(t,e)&&mN(e,n)&&hN(t.position,e.position,n.position)}function hN(t,e,n){return 0===Zz.copy(e).sub(t).cross(Kz.copy(n).sub(t))}function uN(t,e,n,i,r){let s=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),a=(t.y+e.y)/2,o=(t.x+e.x)/2,l=Math.sqrt(Math.pow(n,2)-Math.pow(s/2,2))*(t.y-e.y)/s,c=Math.sqrt(Math.pow(n,2)-Math.pow(s/2,2))*(e.x-t.x)/s;return i.set(o+l,a+c),r.set(o-l,a-c),[i,r]}function dN(t,e,n){return t.distanceTo(n)<e.distanceTo(n)?e:t}function pN(t,e,n,i,r,s){let a,o=e.x-t.x,l=e.y-t.y,c=n.x-t.x,h=n.y-t.y,u=Math.sqrt((o+c)*(o+c)+(l+h)*(l+h));return lN(e,t,n)>Math.PI&&(u*=-1),a=sN(h,l)?(l+h)*(i/u-.5)*8/3/(o-c):(o+c)*(i/u-.5)*8/3/(h-l),r.set(e.x-a*l,e.y+a*o),s.set(n.x+a*h,n.y-a*c),[r,s]}function fN(t,e){return t.position.equals(t.controls[1].position)&&e.position.equals(e.controls[0].position)}function mN(t,e){return hN(t.position,t.controls[1].position,e.position)&&hN(t.position,e.controls[0].position,e.position)}function gN(t,e=12,n=!1){let i=[];for(let r=0,s=t.length;r<s;r++){let s=t[r],a=0;if(n&&void 0!==s.roundedCurveCorner){let t=.5*vN(s.roundedCurveCorner,e);r>0&&(i[r-1]+=t),a+=t}void 0!==s.curveAfter&&(a+=vN(s.curveAfter,e)),i.push(a)}return t.length>0&&n&&void 0!==t[0].roundedCurveCorner&&(i[t.length-1]+=.5*vN(t[0].roundedCurveCorner,e)),i}function vN(t,e=12){return t&&t instanceof $_?2*e:t&&(t instanceof sw||t instanceof aw)?1:t&&t instanceof cw?e*t.points.length:e}var yN,xN,bN=new ym,_N=new ym,wN=new ym,SN=new ym,MN=new ym,TN=new ym,EN=class extends yw{constructor(t=100,e=100){super(),this.points=[],this.shapeHoles=[],this.plane=new by(new $m(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=vm.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=t,this._height=e}static createFromState(t,e,n){let i=new EN;return i.isClosed=t.isClosed,i.points=t.points.map((t=>$z.create(t.id,t.data))),"number"==typeof t.roundness&&(i.roundness=t.roundness),i.shapeHoles=t.shapeHoles.map((t=>EN.createFromState(t))),void 0!==e&&void 0!==n&&i.applySize(e,n),i.update(),i}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(t){if(this._roundness!==t){this._roundness=t;for(let e=0,n=this.points.length;e<n;e++)this.points[e].roundness=t;this.needsUpdate=!0}}getPointsIndexesByIds(t){return t.map((t=>this.getPointIndexById(t))).filter((t=>t>=0))}getPointIndexById(t){let e=this.points.length,n=this.points.findIndex((e=>e.uuid===t));if(n<0){let n=e;for(let e=0,i=this.shapeHoles.length;e<i;e++){let i=this.shapeHoles[e],r=i.points.length,s=i.getPointIndexById(t);if(!(s<0))return s+n;n+=r}}return n}getLineIndexById(t){return this.getPointIndexById(t)}getBezierPoint(t){if(t<=this.points.length-1)return this.points[t];if(this.shapeHoles.length>0){let e=this.points.length;for(let n=0,i=this.shapeHoles.length;n<i;n++){let i=this.shapeHoles[n],r=t-e;if(r<=i.points.length-1)return i.points[r];e+=i.points.length}}throw new Error("This shape does not have a point for this index: "+t)}getBezierPointIndex(t){let e=this.points.indexOf(t);if(e>=0)return e;if(e=this.points.length,this.shapeHoles.length>0)for(let n=0,i=this.shapeHoles.length;n<i;n++){let i=this.shapeHoles[n],r=i.points.indexOf(t);if(r>=0)return e+r;e+=i.points.length}return-1}getAllPoints(){let t=[].concat(...this.shapeHoles.map((t=>t.points)));return[...this.points,...t]}applySize(t,e){0===t&&(t=.001),0===e&&(e=.001),this._width=t,this._height=e}applyScale(t,e){let n=bN.set(t,e);for(let t=0,e=this.points.length;t<e;t++){let e=this.points[t];e.position.multiply(n),e.controls[0].position.multiply(n),e.controls[1].position.multiply(n)}for(let n=0,i=this.shapeHoles.length;n<i;n++)this.shapeHoles[n].applyScale(t,e);this._update()}createPoint(t,e=0,n=vm.generateUUID()){let i;i=t instanceof ym?t:new ym(t,e);let r=new $z(n,i);return r.roundness=this.roundness,r}addPoint(t){this.points.push(t),this.needsUpdate=!0}addPointAt(t,e){this.points.splice(e,0,t),this.needsUpdate=!0}getPointByUuid(t){for(let e=0,n=this.points.length;e<n;e++){let n=this.points[e];if(n.uuid===t)return n}for(let e=0,n=this.shapeHoles.length;e<n;e++){let n=this.shapeHoles[e].getPointByUuid(t);if(n)return n}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(t){let e=this.points.indexOf(t);e>=0&&this.points.splice(e,1),this.needsUpdate=!0}removePointById(t){let e=this.points.find((e=>e.uuid===t));e&&this.removePoint(e)}update(){for(let t=0,e=this.shapeHoles.length;t<e;t++)this.shapeHoles[t].update();this._update()}extractShapePointsToBuffer(t,e=12,n=!1){this.subdivision=e,void 0===this.curveDivisions&&this.computeCurveDivisions(e);let i=n?this.roundedCurveDivisions:this.curveDivisions;return function(t,e,n=12,i=!0){let r,s=iN.set(0,0,0),a=0,o=[];for(let i=0;i<e.length;i++){let l=e[i],c=Zz,h=vN(l,n);o.push(h);for(let e=0;e<=h;e++)if(l instanceof iw||l instanceof ow||l instanceof sw){if(l.getPoint(e/h,c),s.set(c.x,c.y,0),void 0!==r&&oN(r,s))continue;void 0===r&&(r=nN),r.copy(s),t.setXYZ(a,s.x,s.y,s.z),a++}}i&&a>1&&!(t.getX(a-1)===t.getX(0)&&t.getY(a-1)===t.getY(0)&&t.getZ(a-1)===t.getZ(0))&&(t.setXYZ(a,t.getX(0),t.getY(0),t.getZ(0)),a++)}(t,n?this.roundedCurves:this.curves,e,this.autoClose),i.reduce(((t,e)=>t+e),0)+1}computeCurveDivisions(t=12){return this.curveDivisions=gN(this.points,t,!1),this.roundedCurveDivisions=gN(this.points,t,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(t,e,n=12){return 2*function(t,e,n,i=12,r=!0){let s=iN.set(0,0,0),a=0,o=[];for(let r=0;r<e.length;r++){if(!1===n[r])continue;let l,c=e[r],h=Zz,u=vN(c,i);o.push(u);for(let e=0;e<=u;e++)if(c instanceof iw||c instanceof ow||c instanceof sw){if(c.getPoint(e/u,h),s.set(h.x,h.y,0),l?.equals(s))continue;void 0===l?l=nN:(t.setXYZ(a,l.x,l.y,l.z),a++,t.setXYZ(a,s.x,s.y,s.z),a++),l.copy(s)}}return r&&a>1&&!(t.getX(a-1)===t.getX(0)&&t.getY(a-1)===t.getY(0)&&t.getZ(a-1)===t.getZ(0))&&(t.setXYZ(a,t.getX(0),t.getY(0),t.getZ(0)),a++),o}(t,this.curves,e,n,this.autoClose).reduce(((t,e)=>t+e),0)}extractShapePointsToFlatArray(t,e=12){return this.subdivision=e,void 0===this.curveDivisions&&this.computeCurveDivisions(e),function(t,e,n=12,i=!0){let r,s=0;for(let i=0;i<e.length;i++){let a=e[i],o=vN(a,n),l=Zz;for(let e=0;e<=o;e++)if(a instanceof iw||a instanceof ow||a instanceof sw){if(a.getPoint(e/o,l),void 0!==r&&aN(r,l,Wz))continue;void 0===r&&(r=Kz),r.copy(l),t.push(l.x,l.y),s++}}return sN(t[0],t[t.length-2],Wz)&&sN(t[1],t[t.length-1],Wz)&&(t.pop(),t.pop()),i&&s>1&&!(sN(t[s-1],t[1],Wz)&&sN(t[s-2],t[0],Wz))&&(t.push(t[0],t[1]),s++),t}(t,this.roundedCurves,e,this.autoClose)}getCurveIndexFromVertexId(t,e=!1){let n=0;void 0===this.curveDivisions&&this.computeCurveDivisions(this.subdivision);let i=e?this.roundedCurveDivisions:this.curveDivisions,r=0;e&&void 0!==this.points[0].roundedCurveCorner&&(r=.5*vN(this.points[0].roundedCurveCorner,this.subdivision));let s=t-r;s<0&&(s+=i.reduce(((t,e)=>t+e),0));for(let t=0,e=i.length;t<e;t++){let e=i[t];if(s<n+e)return[t,(s-n+1)/e];n+=e}return[0,1]}getCurveT(t,e,n){let i=this.points[t],r=this.points[t>=this.points.length-1?0:t+1],s=this.curveDivisions,a=s[t];if(fN(i,r)){let t=i.position.distanceTo(r.position);return i.position.distanceTo(bN.set(n.x,n.y))/t}let o=0;for(let e=0;e<t;e++)o+=s[e];return(e-o)/a}dispose(){}_applyCurveForPoint(t,e){fN(e,t)?this.lineTo(t.position.x,t.position.y):this.bezierCurveTo(e.controls[1].position.x,e.controls[1].position.y,t.controls[0].position.x,t.controls[0].position.y,t.position.x,t.position.y);let n=this.curves[this.curves.length-1];t.curveBefore=n,e.curveAfter=n;let i=n.clone();t.roundedCurveBefore=i,e.roundedCurveAfter=i,t.roundedCurveCorner=void 0,this.roundedCurves.push(i)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,e=this.points.length;t<e;t++){let e=this.points[t];if(0===t)this.moveTo(e.position.x,e.position.y);else{let n=this.points[t-1];this._applyCurveForPoint(e,n)}}let t=this.getLastPoint();if(t?.curveAfter&&(t.curveAfter=void 0),this.isClosed){let t=this.points[0],e=this.points[this.points.length-1];this._applyCurveForPoint(t,e)}if(this.points.length>2){let t=0;for(let e=0,n=this.points.length;e<n;e++){let n=this.points[e],i=this.points[e-1]??this.points[this.points.length-1],r=this.points[e+1]??this.points[0],s=n.roundness,a=i&&r&&cN(i,n,r);if(!n.controlsMoved()&&s>0&&!a){let i=n.curveBefore,r=n.curveAfter;if(void 0===i||void 0===r)continue;let a,o=n.roundedCurveBefore,l=n.roundedCurveAfter,c=i.getLength(),h=r.getLength(),u=Math.min(s,.499*c),d=Math.min(s,.499*h),p=Math.min(u,d),f=1-p/c,m=p/h,g=i.getPointAt(f,bN),v=r.getPointAt(m,_N);if(this._subSplitCurve(i,o,f,g,void 0),this._subSplitCurve(r,l,m,void 0,v),this.useCubicForRoundedCorners){let t=lN(g,n.position,v)/2,e=Math.tan(t)*g.distanceTo(n.position),[i,r]=uN(g,v,e,wN,SN),s=dN(i,r,n.position),[o,l]=pN(s,g,v,e,MN,TN);a=new iw(g.clone(),o.clone(),l.clone(),v.clone())}else a=new ow(g.clone(),n.position.clone(),v.clone());n.roundedCurveCorner=a,this.roundedCurves.splice(e+t,0,a),t++}}}}_subSplitCurve(t,e,n,i,r){if(!(t instanceof sw)){let s=t,a=e,o=s.getUtoTmapping(n,0),l=function(t,e,n,i,r=.5){let s=Zz.subVectors(e,t).multiplyScalar(r).add(t),a=Kz.subVectors(n,e).multiplyScalar(r).add(e),o=Jz.subVectors(i,n).multiplyScalar(r).add(n),l=s,c=Qz.subVectors(a,s).multiplyScalar(r).add(s),h=tN.subVectors(o,a).multiplyScalar(r).add(a),u=o,d=eN.subVectors(h,c).multiplyScalar(r).add(c);return[t.x,t.y,l.x,l.y,c.x,c.y,d.x,d.y,h.x,h.y,u.x,u.y,i.x,i.y]}(s.v0,s.v1,s.v2,s.v3,o);return void 0!==i&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),void 0!==r&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return void 0!==i&&e.v2.copy(i),void 0!==r&&e.v1.copy(r),e}clone(){let t=new EN(this._width,this._height);return t.points=this.points.map((t=>t.clone())),t.isClosed=this.isClosed,t.roundness=this.roundness,t.isMesh2D=this.isMesh2D,t.shapeHoles=this.shapeHoles.map((t=>t.clone())),t}toJSON(){return{points:this.points.reduce(((t,e)=>t.concat(e.toJSON())),[]),shapeHoles:this.shapeHoles.map((t=>t.toJSON())),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(t){this.points=[],this.pointIDs=0;let e=t.points.length/7;for(let n=0;n<e;n++){let e=7*n,i=t.points[e+0],r=t.points[e+1],s=t.points[e+2],a=t.points[e+3],o=t.points[e+4],l=t.points[e+5],c=t.points[e+6],h=new $z(vm.generateUUID(),new ym(i,r));h.controls[0].position.set(s,a),h.controls[1].position.set(o,l),h.roundness=c,this.points.push(h)}return this.shapeHoles=t.shapeHoles?.length?t.shapeHoles.map((t=>{let e=new EN;return e.fromJSON(t),e})):[],this.isClosed=t.isClosed,this._roundness=t.roundness,this._update(),this}fromShape(t,e=!1){this.isText=e;let n=(t,e)=>{e instanceof iw&&e.v3.equals(t.position)&&t.controls[0].position.copy(e.v2)};return this.points=(t=>{let e,i,r=[];for(e=0,i=t.length;e<i;e++)t[e]instanceof ow&&(t[e]=rN(t[e]));for(e=0,i=t.length;e<i;e++){let i,s=t[e],a=e>0?t[e-1]:null;s instanceof iw?(i=this.createPoint(s.v0),i.controls[1].position.copy(s.v1)):s instanceof sw&&(i=this.createPoint(s.v1)),void 0!==i&&(null!==a&&n(i,a),r.push(i))}let s=t[t.length-1],a=!1;return s instanceof iw?s.v3.equals(r[0].position)&&(r[0].controls[0].position.copy(s.v2),a=!0):s instanceof sw&&s.v2.equals(r[0].position)&&(a=!0),this.isClosed=a,r})(t.curves),t instanceof yw&&(this.shapeHoles=t.holes.map((t=>{let e=new EN;return e.fromShape(t),e}))),this.update(),this}updatePoint(t,e){let n=this.getPointByUuid(t);n&&(void 0!==e.position&&n.position.fromArray(e.position),void 0!==e.roundness&&(n.roundness=e.roundness),void 0!==e.areControlsDirectionsMirrored&&(n.areControlsDirectionsMirrored=e.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(t,e){let n=this.getPointByUuid(t)?.controls[0];n&&(e.position&&n.position.fromArray(e.position),this.needsUpdate=!0)}updateNextControl(t,e){let n=this.getPointByUuid(t)?.controls[1];n&&(e.position&&n.position.fromArray(e.position),this.needsUpdate=!0)}},AN=2*Math.PI;function CN({x:t,y:e},n,i,r,s){return{x:t*n+r,y:e*i+s}}function PN(t,e){let n=1.5707963267948966===e?.551915024494:-1.5707963267948966===e?-.551915024494:1.3333333333333333*Math.tan(e/4),i=Math.cos(t),r=Math.sin(t),s=Math.cos(t+e),a=Math.sin(t+e);return[{x:i-r*n,y:r+i*n},{x:s+a*n,y:a-s*n},{x:s,y:a}]}function RN(t,e,n,i){let r=t*i-e*n<0?-1:1,s=Math.min(1,Math.max(-1,t*n+e*i));return r*Math.acos(s)}function ON({px:t,py:e,cx:n,cy:i,rx:r,ry:s,largeArcFlag:a,sweepFlag:o}){let l=[];if(0===r||0===s)return[];let c=(t-n)/2,h=(e-i)/2;if(0===c&&0===h)return[];r=Math.abs(r),s=Math.abs(s);let u=Math.pow(c,2)/Math.pow(r,2)+Math.pow(h,2)/Math.pow(s,2);u>1&&(r*=Math.sqrt(u),s*=Math.sqrt(u));let d=function(t,e,n,i,r,s,a,o,l,c){let h=Math.pow(r,2),u=Math.pow(s,2),d=Math.pow(a,2),p=Math.pow(o,2),f=h*u-h*p-u*d;f<0&&(f=0),f/=h*p+u*d,f=Math.sqrt(f)*(l===c?-1:1);let m=f*r/s*o,g=f*-s/r*a,v=m+(t+n)/2,y=g+(e+i)/2,x=(a-m)/r,b=(o-g)/s,_=(-a-m)/r,w=(-o-g)/s,S=RN(1,0,x,b),M=RN(x,b,_,w);return!c&&M>0&&(M-=AN),c&&M<0&&(M+=AN),{centerx:v,centery:y,ang1:S,ang2:M}}(t,e,n,i,r,s,c,h,a,o),{ang1:p,ang2:f}=d,{centerx:m,centery:g}=d,v=Math.abs(f)/(AN/4);Math.abs(1-v)<1e-7&&(v=1);let y=Math.max(Math.ceil(v),1);f/=y;for(let t=0;t<y;t++)l.push(PN(p,f)),p+=f;return l.map((t=>{let{x:e,y:n}=CN(t[0],r,s,m,g),{x:i,y:a}=CN(t[1],r,s,m,g),{x:o,y:l}=CN(t[2],r,s,m,g);return{x1:e,y1:n,x2:i,y2:a,x:o,y:l}}))}function DN(t,e){if(!t)throw e||"Assertion Failed!"}!function(t){t[t.ODD=0]="ODD",t[t.NONZERO=1]="NONZERO",t[t.POSITIVE=2]="POSITIVE",t[t.NEGATIVE=3]="NEGATIVE",t[t.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"}(yN||(yN={})),function(t){t[t.POLYGONS=0]="POLYGONS",t[t.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",t[t.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"}(xN||(xN={}));var LN=function(){function t(){}return t.vertEq=function(t,e){return t.s===e.s&&t.t===e.t},t.vertLeq=function(t,e){return t.s<e.s||t.s===e.s&&t.t<=e.t},t.transLeq=function(t,e){return t.t<e.t||t.t===e.t&&t.s<=e.s},t.edgeGoesLeft=function(e){return t.vertLeq(e.Dst,e.Org)},t.edgeGoesRight=function(e){return t.vertLeq(e.Org,e.Dst)},t.vertL1dist=function(t,e){return Math.abs(t.s-e.s)+Math.abs(t.t-e.t)},t.edgeEval=function(e,n,i){DN(t.vertLeq(e,n)&&t.vertLeq(n,i));var r=n.s-e.s,s=i.s-n.s;return r+s>0?r<s?n.t-e.t+(e.t-i.t)*(r/(r+s)):n.t-i.t+(i.t-e.t)*(s/(r+s)):0},t.edgeSign=function(e,n,i){DN(t.vertLeq(e,n)&&t.vertLeq(n,i));var r=n.s-e.s,s=i.s-n.s;return r+s>0?(n.t-i.t)*r+(n.t-e.t)*s:0},t.transEval=function(e,n,i){DN(t.transLeq(e,n)&&t.transLeq(n,i));var r=n.t-e.t,s=i.t-n.t;return r+s>0?r<s?n.s-e.s+(e.s-i.s)*(r/(r+s)):n.s-i.s+(i.s-e.s)*(s/(r+s)):0},t.transSign=function(e,n,i){DN(t.transLeq(e,n)&&t.transLeq(n,i));var r=n.t-e.t,s=i.t-n.t;return r+s>0?(n.s-i.s)*r+(n.s-e.s)*s:0},t.vertCCW=function(t,e,n){return t.s*(e.t-n.t)+e.s*(n.t-t.t)+n.s*(t.t-e.t)>=0},t.interpolate=function(t,e,n,i){return(t=t<0?0:t)<=(n=n<0?0:n)?0===n?(e+i)/2:e+t/(t+n)*(i-e):i+n/(t+n)*(e-i)},t.intersect=function(e,n,i,r,s){var a,o,l;t.vertLeq(e,n)||(l=e,e=n,n=l),t.vertLeq(i,r)||(l=i,i=r,r=l),t.vertLeq(e,i)||(l=e,e=i,i=l,l=n,n=r,r=l),t.vertLeq(i,n)?t.vertLeq(n,r)?((a=t.edgeEval(e,i,n))+(o=t.edgeEval(i,n,r))<0&&(a=-a,o=-o),s.s=t.interpolate(a,i.s,o,n.s)):((a=t.edgeSign(e,i,n))+(o=-t.edgeSign(e,r,n))<0&&(a=-a,o=-o),s.s=t.interpolate(a,i.s,o,r.s)):s.s=(i.s+n.s)/2,t.transLeq(e,n)||(l=e,e=n,n=l),t.transLeq(i,r)||(l=i,i=r,r=l),t.transLeq(e,i)||(l=e,e=i,i=l,l=n,n=r,r=l),t.transLeq(i,n)?t.transLeq(n,r)?((a=t.transEval(e,i,n))+(o=t.transEval(i,n,r))<0&&(a=-a,o=-o),s.t=t.interpolate(a,i.t,o,n.t)):((a=t.transSign(e,i,n))+(o=-t.transSign(e,r,n))<0&&(a=-a,o=-o),s.t=t.interpolate(a,i.t,o,r.t)):s.t=(i.t+n.t)/2},t}(),IN=function(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1},zN=function(){function t(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(t.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),t}(),NN=function(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0},UN=function(){function t(){var t=new NN,e=new IN,n=new zN(0),i=new zN(1);t.next=t.prev=t,t.anEdge=null,e.next=e.prev=e,n.next=n,n.Sym=i,i.next=i,i.Sym=n,this.vHead=t,this.fHead=e,this.eHead=n,this.eHeadSym=i}return t.prototype.makeEdge_=function(t){var e=new zN(0),n=new zN(1);t.Sym.side<t.side&&(t=t.Sym);var i=t.Sym.next;return n.next=i,i.Sym.next=e,e.next=t,t.Sym.next=n,e.Sym=n,e.Onext=e,e.Lnext=n,e.Org=null,e.Lface=null,e.winding=0,e.activeRegion=null,n.Sym=e,n.Onext=n,n.Lnext=e,n.Org=null,n.Lface=null,n.winding=0,n.activeRegion=null,e},t.prototype.splice_=function(t,e){var n=t.Onext,i=e.Onext;n.Sym.Lnext=e,i.Sym.Lnext=t,t.Onext=i,e.Onext=n},t.prototype.makeVertex_=function(t,e,n){var i=t;DN(i,"Vertex can't be null!");var r=n.prev;i.prev=r,r.next=i,i.next=n,n.prev=i,i.anEdge=e;var s=e;do{s.Org=i,s=s.Onext}while(s!==e)},t.prototype.makeFace_=function(t,e,n){var i=t;DN(i,"Face can't be null");var r=n.prev;i.prev=r,r.next=i,i.next=n,n.prev=i,i.anEdge=e,i.trail=null,i.marked=!1,i.inside=n.inside;var s=e;do{s.Lface=i,s=s.Lnext}while(s!==e)},t.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var e=t.next,n=t.Sym.next;e.Sym.next=n,n.Sym.next=e},t.prototype.killVertex_=function(t,e){var n=t.anEdge,i=n;do{i.Org=e,i=i.Onext}while(i!==n);var r=t.prev,s=t.next;s.prev=r,r.next=s},t.prototype.killFace_=function(t,e){var n=t.anEdge,i=n;do{i.Lface=e,i=i.Lnext}while(i!==n);var r=t.prev,s=t.next;s.prev=r,r.next=s},t.prototype.makeEdge=function(){var t=new NN,e=new NN,n=new IN,i=this.makeEdge_(this.eHead);return this.makeVertex_(t,i,this.vHead),this.makeVertex_(e,i.Sym,this.vHead),this.makeFace_(n,i,this.fHead),i},t.prototype.splice=function(t,e){var n=!1,i=!1;if(t!==e){if(e.Org!==t.Org&&(i=!0,this.killVertex_(e.Org,t.Org)),e.Lface!==t.Lface&&(n=!0,this.killFace_(e.Lface,t.Lface)),this.splice_(e,t),!i){var r=new NN;this.makeVertex_(r,e,t.Org),t.Org.anEdge=t}if(!n){var s=new IN;this.makeFace_(s,e,t.Lface),t.Lface.anEdge=t}}},t.prototype.delete=function(t){var e=t.Sym,n=!1;if(t.Lface!==t.Rface&&(n=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!n){var i=new IN;this.makeFace_(i,t,t.Lface)}e.Onext===e?(this.killVertex_(e.Org,null),this.killFace_(e.Lface,null)):(t.Lface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev)),this.killEdge_(t)},t.prototype.addEdgeVertex=function(t){var e=this.makeEdge_(t),n=e.Sym;this.splice_(e,t.Lnext),e.Org=t.Dst;var i=new NN;return this.makeVertex_(i,n,e.Org),e.Lface=n.Lface=t.Lface,e},t.prototype.splitEdge=function(t){var e=this.addEdgeVertex(t).Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,e),t.Dst=e.Org,e.Dst.anEdge=e.Sym,e.Rface=t.Rface,e.winding=t.winding,e.Sym.winding=t.Sym.winding,e.idx=t.idx,e.Sym.idx=t.Sym.idx,e},t.prototype.connect=function(t,e){var n=!1,i=this.makeEdge_(t),r=i.Sym;if(e.Lface!==t.Lface&&(n=!0,this.killFace_(e.Lface,t.Lface)),this.splice_(i,t.Lnext),this.splice_(r,e),i.Org=t.Dst,r.Org=e.Org,i.Lface=r.Lface=t.Lface,t.Lface.anEdge=r,!n){var s=new IN;this.makeFace_(s,i,t.Lface)}return i},t.prototype.zapFace=function(t){var e,n,i,r,s,a=t.anEdge;n=a.Lnext;do{n=(e=n).Lnext,e.Lface=null,null===e.Rface&&(e.Onext===e?this.killVertex_(e.Org,null):(e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev)),(i=e.Sym).Onext===i?this.killVertex_(i.Org,null):(i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(e))}while(e!=a);r=t.prev,(s=t.next).prev=r,r.next=s},t.prototype.countFaceVerts_=function(t){var e=t.anEdge,n=0;do{n++,e=e.Lnext}while(e!==t.anEdge);return n},t.prototype.mergeConvexFaces=function(t){var e,n,i,r,s;for(e=this.fHead.next;e!==this.fHead;e=e.next)if(e.inside)for(s=(n=e.anEdge).Org;i=n.Lnext,(r=n.Sym)&&r.Lface&&r.Lface.inside&&(this.countFaceVerts_(e)+this.countFaceVerts_(r.Lface)-2<=t&&LN.vertCCW(n.Lprev.Org,n.Org,r.Lnext.Lnext.Org)&&LN.vertCCW(r.Lprev.Org,r.Org,n.Lnext.Lnext.Org)&&(i=r.Lnext,this.delete(r),n=null,r=null)),!n||n.Lnext.Org!==s;)n=i;return!0},t.prototype.check=function(){var t,e,n,i,r,s,a=this.fHead,o=this.vHead,l=this.eHead;for(e=a,e=a;(t=e.next)!==a;e=t){DN(t.prev===e),r=t.anEdge;do{DN(r.Sym!==r),DN(r.Sym.Sym===r),DN(r.Lnext.Onext.Sym===r),DN(r.Onext.Sym.Lnext===r),DN(r.Lface===t),r=r.Lnext}while(r!==t.anEdge)}for(DN(t.prev===e&&null===t.anEdge),i=o,i=o;(n=i.next)!==o;i=n){DN(n.prev===i),r=n.anEdge;do{DN(r.Sym!==r),DN(r.Sym.Sym===r),DN(r.Lnext.Onext.Sym===r),DN(r.Onext.Sym.Lnext===r),DN(r.Org===n),r=r.Onext}while(r!==n.anEdge)}for(DN(n.prev===i&&null===n.anEdge),s=l,s=l;(r=s.next)!==l;s=r)DN(r.Sym.next===s.Sym),DN(r.Sym!==r),DN(r.Sym.Sym===r),DN(null!==r.Org),DN(null!==r.Dst),DN(r.Lnext.Onext.Sym===r),DN(r.Onext.Sym.Lnext===r);DN(r.Sym.next===s.Sym&&r.Sym===this.eHeadSym&&r.Sym.Sym===r&&null===r.Org&&null===r.Dst&&null===r.Lface&&null===r.Rface)},t}(),kN=function(){this.handle=null},BN=function(){this.key=null,this.node=0},FN=function(){function t(t,e){this.leq=e,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var n=0;n<t+1;n++)this.nodes[n]=new kN,this.handles[n]=new BN;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return t.prototype.floatDown_=function(t){var e,n,i,r=this.nodes,s=this.handles;for(e=r[t].handle;;){if((i=t<<1)<this.size&&this.leq(s[r[i+1].handle].key,s[r[i].handle].key)&&++i,DN(i<=this.max),n=r[i].handle,i>this.size||this.leq(s[e].key,s[n].key)){r[t].handle=e,s[e].node=t;break}r[t].handle=n,s[n].node=t,t=i}},t.prototype.floatUp_=function(t){var e,n,i,r=this.nodes,s=this.handles;for(e=r[t].handle;;){if(n=r[i=t>>1].handle,0===i||this.leq(s[n].key,s[e].key)){r[t].handle=e,s[e].node=t;break}r[t].handle=n,s[n].node=t,t=i}},t.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},t.prototype.min=function(){return this.handles[this.nodes[1].handle].key},t.prototype.insert=function(t){var e,n;if(2*(e=++this.size)>this.max){var i,r;for(this.max*=2,r=this.nodes.length,this.nodes.length=this.max+1,i=r;i<this.nodes.length;i++)this.nodes[i]=new kN;for(r=this.handles.length,this.handles.length=this.max+1,i=r;i<this.handles.length;i++)this.handles[i]=new BN}return 0===this.freeList?n=e:(n=this.freeList,this.freeList=this.handles[n].node),this.nodes[e].handle=n,this.handles[n].node=e,this.handles[n].key=t,this.initialized&&this.floatUp_(e),n},t.prototype.extractMin=function(){var t=this.nodes,e=this.handles,n=t[1].handle,i=e[n].key;return this.size>0&&(t[1].handle=t[this.size].handle,e[t[1].handle].node=1,e[n].key=null,e[n].node=this.freeList,this.freeList=n,--this.size,this.size>0&&this.floatDown_(1)),i},t.prototype.delete=function(t){var e,n=this.nodes,i=this.handles;DN(t>=1&&t<=this.max&&null!==i[t].key),n[e=i[t].node].handle=n[this.size].handle,i[n[e].handle].node=e,--this.size,e<=this.size&&(e<=1||this.leq(i[n[e>>1].handle].key,i[n[e].handle].key)?this.floatDown_(e):this.floatUp_(e)),i[t].key=null,i[t].node=this.freeList,this.freeList=t},t}(),VN=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},jN=function(){this.key=null,this.next=null,this.prev=null},HN=function(){function t(t,e){this.frame=t,this.leq=e,this.head=new jN,this.head.next=this.head,this.head.prev=this.head}return t.prototype.min=function(){return this.head.next},t.prototype.max=function(){return this.head.prev},t.prototype.insert=function(t){return this.insertBefore(this.head,t)},t.prototype.search=function(t){var e=this.head;do{e=e.next}while(null!==e.key&&!this.leq(this.frame,t,e.key));return e},t.prototype.insertBefore=function(t,e){do{t=t.prev}while(null!==t.key&&!this.leq(this.frame,t.key,e));var n=new jN;return n.key=e,n.next=t.next,t.next.prev=n,n.prev=t,t.next=n,n},t.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},t}(),GN=function(){function t(){}return t.regionBelow=function(t){return t.nodeUp.prev.key},t.regionAbove=function(t){return t.nodeUp.next.key},t.debugEvent=function(t){},t.addWinding=function(t,e){t.winding+=e.winding,t.Sym.winding+=e.Sym.winding},t.edgeLeq=function(t,e,n){var i=t.event,r=e.eUp,s=n.eUp;return r.Dst===i?s.Dst===i?LN.vertLeq(r.Org,s.Org)?LN.edgeSign(s.Dst,r.Org,s.Org)<=0:LN.edgeSign(r.Dst,s.Org,r.Org)>=0:LN.edgeSign(s.Dst,i,s.Org)<=0:s.Dst===i?LN.edgeSign(r.Dst,i,r.Org)>=0:LN.edgeEval(r.Dst,i,r.Org)>=LN.edgeEval(s.Dst,i,s.Org)},t.deleteRegion=function(t,e){e.fixUpperEdge&&DN(0===e.eUp.winding),e.eUp.activeRegion=null,t.dict.delete(e.nodeUp)},t.fixUpperEdge=function(t,e,n){DN(e.fixUpperEdge),t.mesh.delete(e.eUp),e.fixUpperEdge=!1,e.eUp=n,n.activeRegion=e},t.topLeftRegion=function(e,n){var i,r=n.eUp.Org;do{n=t.regionAbove(n)}while(n.eUp.Org===r);if(n.fixUpperEdge){if(null===(i=e.mesh.connect(t.regionBelow(n).eUp.Sym,n.eUp.Lnext)))return null;t.fixUpperEdge(e,n,i),n=t.regionAbove(n)}return n},t.topRightRegion=function(e){var n=e.eUp.Dst;do{e=t.regionAbove(e)}while(e.eUp.Dst===n);return e},t.addRegionBelow=function(t,e,n){var i=new VN;return i.eUp=n,i.nodeUp=t.dict.insertBefore(e.nodeUp,i),i.fixUpperEdge=!1,i.sentinel=!1,i.dirty=!1,n.activeRegion=i,i},t.isWindingInside=function(t,e){switch(t.windingRule){case yN.ODD:return!!(1&e);case yN.NONZERO:return 0!==e;case yN.POSITIVE:return e>0;case yN.NEGATIVE:return e<0;case yN.ABS_GEQ_TWO:return e>=2||e<=-2}throw new Error("Invalid winding rulle")},t.computeWinding=function(e,n){n.windingNumber=t.regionAbove(n).windingNumber+n.eUp.winding,n.inside=t.isWindingInside(e,n.windingNumber)},t.finishRegion=function(e,n){var i=n.eUp,r=i.Lface;r.inside=n.inside,r.anEdge=i,t.deleteRegion(e,n)},t.finishLeftRegions=function(e,n,i){for(var r,s=null,a=n,o=n.eUp;a!==i;){if(a.fixUpperEdge=!1,(r=(s=t.regionBelow(a)).eUp).Org!=o.Org){if(!s.fixUpperEdge){t.finishRegion(e,a);break}r=e.mesh.connect(o.Lprev,r.Sym),t.fixUpperEdge(e,s,r)}o.Onext!==r&&(e.mesh.splice(r.Oprev,r),e.mesh.splice(o,r)),t.finishRegion(e,a),o=s.eUp,a=s}return o},t.addRightEdges=function(e,n,i,r,s,a){var o,l,c,h,u=!0;c=i;do{DN(LN.vertLeq(c.Org,c.Dst)),t.addRegionBelow(e,n,c.Sym),c=c.Onext}while(c!==r);for(null===s&&(s=t.regionBelow(n).eUp.Rprev),l=n,h=s;(c=(o=t.regionBelow(l)).eUp.Sym).Org===h.Org;)c.Onext!==h&&(e.mesh.splice(c.Oprev,c),e.mesh.splice(h.Oprev,c)),o.windingNumber=l.windingNumber-c.winding,o.inside=t.isWindingInside(e,o.windingNumber),l.dirty=!0,!u&&t.checkForRightSplice(e,l)&&(t.addWinding(c,h),t.deleteRegion(e,l),e.mesh.delete(h)),u=!1,l=o,h=c;l.dirty=!0,DN(l.windingNumber-c.winding===o.windingNumber),a&&t.walkDirtyRegions(e,l)},t.spliceMergeVertices=function(t,e,n){t.mesh.splice(e,n)},t.vertexWeights=function(t,e,n){var i=LN.vertL1dist(e,t),r=LN.vertL1dist(n,t),s=.5*r/(i+r),a=.5*i/(i+r);t.coords[0]+=s*e.coords[0]+a*n.coords[0],t.coords[1]+=s*e.coords[1]+a*n.coords[1],t.coords[2]+=s*e.coords[2]+a*n.coords[2]},t.getIntersectData=function(e,n,i,r,s,a){n.coords[0]=n.coords[1]=n.coords[2]=0,n.idx=-1,t.vertexWeights(n,i,r),t.vertexWeights(n,s,a)},t.checkForRightSplice=function(e,n){var i=t.regionBelow(n),r=n.eUp,s=i.eUp;if(LN.vertLeq(r.Org,s.Org)){if(LN.edgeSign(s.Dst,r.Org,s.Org)>0)return!1;LN.vertEq(r.Org,s.Org)?r.Org!==s.Org&&(e.pq.delete(r.Org.pqHandle),t.spliceMergeVertices(e,s.Oprev,r)):(e.mesh.splitEdge(s.Sym),e.mesh.splice(r,s.Oprev),n.dirty=i.dirty=!0)}else{if(LN.edgeSign(r.Dst,s.Org,r.Org)<0)return!1;t.regionAbove(n).dirty=n.dirty=!0,e.mesh.splitEdge(r.Sym),e.mesh.splice(s.Oprev,r)}return!0},t.checkForLeftSplice=function(e,n){var i,r=t.regionBelow(n),s=n.eUp,a=r.eUp;if(DN(!LN.vertEq(s.Dst,a.Dst)),LN.vertLeq(s.Dst,a.Dst)){if(LN.edgeSign(s.Dst,a.Dst,s.Org)<0)return!1;t.regionAbove(n).dirty=n.dirty=!0,i=e.mesh.splitEdge(s),e.mesh.splice(a.Sym,i),i.Lface.inside=n.inside}else{if(LN.edgeSign(a.Dst,s.Dst,a.Org)>0)return!1;n.dirty=r.dirty=!0,i=e.mesh.splitEdge(a),e.mesh.splice(s.Lnext,a.Sym),i.Rface.inside=n.inside}return!0},t.checkForIntersect=function(e,n){var i,r,s=t.regionBelow(n),a=n.eUp,o=s.eUp,l=a.Org,c=o.Org,h=a.Dst,u=o.Dst,d=new NN;if(DN(!LN.vertEq(u,h)),DN(LN.edgeSign(h,e.event,l)<=0),DN(LN.edgeSign(u,e.event,c)>=0),DN(l!==e.event&&c!==e.event),DN(!n.fixUpperEdge&&!s.fixUpperEdge),l===c||Math.min(l.t,h.t)>Math.max(c.t,u.t))return!1;if(LN.vertLeq(l,c)){if(LN.edgeSign(u,l,c)>0)return!1}else if(LN.edgeSign(h,c,l)<0)return!1;return t.debugEvent(e),LN.intersect(h,l,u,c,d),DN(Math.min(l.t,h.t)<=d.t),DN(d.t<=Math.max(c.t,u.t)),DN(Math.min(u.s,h.s)<=d.s),DN(d.s<=Math.max(c.s,l.s)),LN.vertLeq(d,e.event)&&(d.s=e.event.s,d.t=e.event.t),i=LN.vertLeq(l,c)?l:c,LN.vertLeq(i,d)&&(d.s=i.s,d.t=i.t),LN.vertEq(d,l)||LN.vertEq(d,c)?(t.checkForRightSplice(e,n),!1):!LN.vertEq(h,e.event)&&LN.edgeSign(h,e.event,d)>=0||!LN.vertEq(u,e.event)&&LN.edgeSign(u,e.event,d)<=0?u===e.event?(e.mesh.splitEdge(a.Sym),e.mesh.splice(o.Sym,a),n=t.topLeftRegion(e,n),a=t.regionBelow(n).eUp,t.finishLeftRegions(e,t.regionBelow(n),s),t.addRightEdges(e,n,a.Oprev,a,a,!0),!0):h===e.event?(e.mesh.splitEdge(o.Sym),e.mesh.splice(a.Lnext,o.Oprev),s=n,n=t.topRightRegion(n),r=t.regionBelow(n).eUp.Rprev,s.eUp=o.Oprev,o=t.finishLeftRegions(e,s,null),t.addRightEdges(e,n,o.Onext,a.Rprev,r,!0),!0):(LN.edgeSign(h,e.event,d)>=0&&(t.regionAbove(n).dirty=n.dirty=!0,e.mesh.splitEdge(a.Sym),a.Org.s=e.event.s,a.Org.t=e.event.t),LN.edgeSign(u,e.event,d)<=0&&(n.dirty=s.dirty=!0,e.mesh.splitEdge(o.Sym),o.Org.s=e.event.s,o.Org.t=e.event.t),!1):(e.mesh.splitEdge(a.Sym),e.mesh.splitEdge(o.Sym),e.mesh.splice(o.Oprev,a),a.Org.s=d.s,a.Org.t=d.t,a.Org.pqHandle=e.pq.insert(a.Org),t.getIntersectData(e,a.Org,l,h,c,u),t.regionAbove(n).dirty=n.dirty=s.dirty=!0,!1)},t.walkDirtyRegions=function(e,n){for(var i,r,s=t.regionBelow(n);;){for(;s.dirty;)n=s,s=t.regionBelow(s);if(!n.dirty&&(s=n,null===(n=t.regionAbove(n))||!n.dirty))return;if(n.dirty=!1,i=n.eUp,r=s.eUp,i.Dst!==r.Dst&&t.checkForLeftSplice(e,n)&&(s.fixUpperEdge?(t.deleteRegion(e,s),e.mesh.delete(r),r=(s=t.regionBelow(n)).eUp):n.fixUpperEdge&&(t.deleteRegion(e,n),e.mesh.delete(i),i=(n=t.regionAbove(s)).eUp)),i.Org!==r.Org)if(i.Dst===r.Dst||n.fixUpperEdge||s.fixUpperEdge||i.Dst!==e.event&&r.Dst!==e.event)t.checkForRightSplice(e,n);else if(t.checkForIntersect(e,n))return;i.Org===r.Org&&i.Dst===r.Dst&&(t.addWinding(r,i),t.deleteRegion(e,n),e.mesh.delete(i),n=t.regionAbove(s))}},t.connectRightVertex=function(e,n,i){var r,s=i.Onext,a=t.regionBelow(n),o=n.eUp,l=a.eUp,c=!1;o.Dst!==l.Dst&&t.checkForIntersect(e,n),LN.vertEq(o.Org,e.event)&&(e.mesh.splice(s.Oprev,o),n=t.topLeftRegion(e,n),s=t.regionBelow(n).eUp,t.finishLeftRegions(e,t.regionBelow(n),a),c=!0),LN.vertEq(l.Org,e.event)&&(e.mesh.splice(i,l.Oprev),i=t.finishLeftRegions(e,a,null),c=!0),c?t.addRightEdges(e,n,i.Onext,s,s,!0):(r=LN.vertLeq(l.Org,o.Org)?l.Oprev:o,r=e.mesh.connect(i.Lprev,r),t.addRightEdges(e,n,r,r.Onext,r.Onext,!1),r.Sym.activeRegion.fixUpperEdge=!0,t.walkDirtyRegions(e,n))},t.connectLeftDegenerate=function(e,n,i){var r,s,a,o,l;return r=n.eUp,LN.vertEq(r.Org,i)?(DN(!1),void t.spliceMergeVertices(e,r,i.anEdge)):LN.vertEq(r.Dst,i)?(DN(!1),n=t.topRightRegion(n),s=o=(a=(l=t.regionBelow(n)).eUp.Sym).Onext,l.fixUpperEdge&&(DN(s!==a),t.deleteRegion(e,l),e.mesh.delete(a),a=s.Oprev),e.mesh.splice(i.anEdge,a),LN.edgeGoesLeft(s)||(s=null),void t.addRightEdges(e,n,a.Onext,o,s,!0)):(e.mesh.splitEdge(r.Sym),n.fixUpperEdge&&(e.mesh.delete(r.Onext),n.fixUpperEdge=!1),e.mesh.splice(i.anEdge,r),void t.sweepEvent(e,i))},t.connectLeftVertex=function(e,n){var i,r,s,a,o,l,c=new VN;if(c.eUp=n.anEdge.Sym,i=e.dict.search(c).key,r=t.regionBelow(i)){if(a=i.eUp,o=r.eUp,0===LN.edgeSign(a.Dst,n,a.Org))return void t.connectLeftDegenerate(e,i,n);if(s=LN.vertLeq(o.Dst,a.Dst)?i:r,i.inside||s.fixUpperEdge){if(s===i)l=e.mesh.connect(n.anEdge.Sym,a.Lnext);else l=e.mesh.connect(o.Dnext,n.anEdge).Sym;s.fixUpperEdge?t.fixUpperEdge(e,s,l):t.computeWinding(e,t.addRegionBelow(e,i,l)),t.sweepEvent(e,n)}else t.addRightEdges(e,i,n.anEdge,n.anEdge,null,!0)}},t.sweepEvent=function(e,n){e.event=n,t.debugEvent(e);for(var i=n.anEdge;null===i.activeRegion;)if((i=i.Onext)===n.anEdge)return void t.connectLeftVertex(e,n);var r=t.topLeftRegion(e,i.activeRegion);DN(null!==r);var s=t.regionBelow(r),a=s.eUp,o=t.finishLeftRegions(e,s,null);o.Onext===a?t.connectRightVertex(e,r,o):t.addRightEdges(e,r,o.Onext,a,a,!0)},t.addSentinel=function(t,e,n,i){var r=new VN,s=t.mesh.makeEdge();s.Org.s=n,s.Org.t=i,s.Dst.s=e,s.Dst.t=i,t.event=s.Dst,r.eUp=s,r.windingNumber=0,r.inside=!1,r.fixUpperEdge=!1,r.sentinel=!0,r.dirty=!1,r.nodeUp=t.dict.insert(r)},t.initEdgeDict=function(e){e.dict=new HN(e,t.edgeLeq);var n=e.bmax[0]-e.bmin[0],i=e.bmax[1]-e.bmin[1],r=e.bmin[0]-n,s=e.bmax[0]+n,a=e.bmin[1]-i,o=e.bmax[1]+i;t.addSentinel(e,r,s,a),t.addSentinel(e,r,s,o)},t.doneEdgeDict=function(e){for(var n,i=0;null!==(n=e.dict.min().key);)n.sentinel||(DN(n.fixUpperEdge),DN(1==++i)),DN(0===n.windingNumber),t.deleteRegion(e,n)},t.removeDegenerateEdges=function(e){var n,i,r,s=e.mesh.eHead;for(n=s.next;n!==s;n=i)i=n.next,r=n.Lnext,LN.vertEq(n.Org,n.Dst)&&n.Lnext.Lnext!==n&&(t.spliceMergeVertices(e,r,n),e.mesh.delete(n),r=(n=r).Lnext),r.Lnext===n&&(r!==n&&((r===i||r===i.Sym)&&(i=i.next),e.mesh.delete(r)),(n===i||n===i.Sym)&&(i=i.next),e.mesh.delete(n))},t.initPriorityQ=function(t){var e,n,i,r=0;for(n=(i=t.mesh.vHead).next;n!==i;n=n.next)r++;for(r+=8,e=t.pq=new FN(r,LN.vertLeq),n=(i=t.mesh.vHead).next;n!==i;n=n.next)n.pqHandle=e.insert(n);return n===i&&(e.init(),!0)},t.donePriorityQ=function(t){t.pq=null},t.removeDegenerateFaces=function(e,n){var i,r,s;for(i=n.fHead.next;i!==n.fHead;i=r)r=i.next,DN((s=i.anEdge).Lnext!==s),s.Lnext.Lnext===s&&(t.addWinding(s.Onext,s),e.mesh.delete(s));return!0},t.computeInterior=function(e,n){var i,r;if(void 0===n&&(n=!0),t.removeDegenerateEdges(e),!t.initPriorityQ(e))return!1;for(t.initEdgeDict(e);null!==(i=e.pq.extractMin());){for(;null!==(r=e.pq.min())&&LN.vertEq(r,i);)r=e.pq.extractMin(),t.spliceMergeVertices(e,i.anEdge,r.anEdge);t.sweepEvent(e,i)}return e.event=e.dict.min().key.eUp.Org,t.debugEvent(e),t.doneEdgeDict(e),t.donePriorityQ(e),!!t.removeDegenerateFaces(e,e.mesh)&&(n&&e.mesh.check(),!0)},t}(),WN=function(){function t(){this.mesh=new UN,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=yN.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return t.prototype.dot_=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.prototype.normalize_=function(t){var e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!e)throw"Zero-size vector!";e=Math.sqrt(e),t[0]/=e,t[1]/=e,t[2]/=e},t.prototype.longAxis_=function(t){var e=0;return Math.abs(t[1])>Math.abs(t[0])&&(e=1),Math.abs(t[2])>Math.abs(t[e])&&(e=2),e},t.prototype.computeNormal_=function(t){var e,n,i,r,s,a,o=[0,0,0],l=[0,0,0],c=[0,0,0],h=[0,0,0],u=[0,0,0],d=[null,null,null],p=[null,null,null],f=this.mesh.vHead;e=f.next;for(var m=0;m<3;++m)r=e.coords[m],l[m]=r,p[m]=e,o[m]=r,d[m]=e;for(e=f.next;e!==f;e=e.next)for(var g=0;g<3;++g)(r=e.coords[g])<l[g]&&(l[g]=r,p[g]=e),r>o[g]&&(o[g]=r,d[g]=e);var v=0;if(o[1]-l[1]>o[0]-l[0]&&(v=1),o[2]-l[2]>o[v]-l[v]&&(v=2),l[v]>=o[v])return t[0]=0,t[1]=0,void(t[2]=1);for(a=0,n=p[v],i=d[v],c[0]=n.coords[0]-i.coords[0],c[1]=n.coords[1]-i.coords[1],c[2]=n.coords[2]-i.coords[2],e=f.next;e!==f;e=e.next)h[0]=e.coords[0]-i.coords[0],h[1]=e.coords[1]-i.coords[1],h[2]=e.coords[2]-i.coords[2],u[0]=c[1]*h[2]-c[2]*h[1],u[1]=c[2]*h[0]-c[0]*h[2],u[2]=c[0]*h[1]-c[1]*h[0],(s=u[0]*u[0]+u[1]*u[1]+u[2]*u[2])>a&&(a=s,t[0]=u[0],t[1]=u[1],t[2]=u[2]);a<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(c)]=1)},t.prototype.checkOrientation_=function(){for(var t,e,n=this.mesh.fHead,i=this.mesh.vHead,r=0,s=n.next;s!==n;s=s.next)if(!((e=s.anEdge).winding<=0))do{r+=(e.Org.s-e.Dst.s)*(e.Org.t+e.Dst.t),e=e.Lnext}while(e!==s.anEdge);if(r<0){for(t=i.next;t!==i;t=t.next)t.t=-t.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},t.prototype.projectPolygon_=function(){var t,e,n=this.mesh.vHead,i=[0,0,0],r=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),r=!0),t=this.sUnit,e=this.tUnit;var s=this.longAxis_(i);t[s]=0,t[(s+1)%3]=1,t[(s+2)%3]=0,e[s]=0,e[(s+1)%3]=0,e[(s+2)%3]=i[s]>0?1:-1;for(var a=n.next;a!==n;a=a.next)a.s=this.dot_(a.coords,t),a.t=this.dot_(a.coords,e);r&&this.checkOrientation_();for(var o=!0,l=n.next;l!==n;l=l.next)o?(this.bmin[0]=this.bmax[0]=l.s,this.bmin[1]=this.bmax[1]=l.t,o=!1):(l.s<this.bmin[0]&&(this.bmin[0]=l.s),l.s>this.bmax[0]&&(this.bmax[0]=l.s),l.t<this.bmin[1]&&(this.bmin[1]=l.t),l.t>this.bmax[1]&&(this.bmax[1]=l.t))},t.prototype.addWinding_=function(t,e){t.winding+=e.winding,t.Sym.winding+=e.Sym.winding},t.prototype.tessellateMonoRegion_=function(t,e){var n,i;if((n=e.anEdge).Lnext===n||n.Lnext.Lnext===n)throw"Mono region invalid";for(;LN.vertLeq(n.Dst,n.Org);n=n.Lprev);for(;LN.vertLeq(n.Org,n.Dst);n=n.Lnext);i=n.Lprev;for(;n.Lnext!==i;)if(LN.vertLeq(n.Dst,i.Org)){for(;i.Lnext!==n&&(LN.edgeGoesLeft(i.Lnext)||LN.edgeSign(i.Org,i.Dst,i.Lnext.Dst)<=0);)i=t.connect(i.Lnext,i).Sym;i=i.Lprev}else{for(;i.Lnext!==n&&(LN.edgeGoesRight(n.Lprev)||LN.edgeSign(n.Dst,n.Org,n.Lprev.Org)>=0);)n=t.connect(n,n.Lprev).Sym;n=n.Lnext}if(i.Lnext===n)throw"Mono region invalid";for(;i.Lnext.Lnext!==n;)i=t.connect(i.Lnext,i).Sym;return!0},t.prototype.tessellateInterior_=function(t){for(var e,n=t.fHead.next;n!==t.fHead;n=e)if(e=n.next,n.inside&&!this.tessellateMonoRegion_(t,n))return!1;return!0},t.prototype.discardExterior_=function(t){for(var e,n=t.fHead.next;n!==t.fHead;n=e)e=n.next,n.inside||t.zapFace(n)},t.prototype.setWindingNumber_=function(t,e,n){for(var i,r=t.eHead.next;r!==t.eHead;r=i)i=r.next,r.Rface.inside!==r.Lface.inside?r.winding=r.Lface.inside?e:-e:n?t.delete(r):r.winding=0},t.prototype.getNeighbourFace_=function(t){return t.Rface&&t.Rface.inside?t.Rface.n:-1},t.prototype.outputPolymesh_=function(t,e,n,i){var r,s,a=0,o=0;n>3&&t.mergeConvexFaces(n);for(var l=t.vHead.next;l!==t.vHead;l=l.next)l.n=-1;for(var c=t.fHead.next;c!==t.fHead;c=c.next)if(c.n=-1,c.inside){r=c.anEdge,s=0;do{-1===(l=r.Org).n&&(l.n=o,o++),s++,r=r.Lnext}while(r!==c.anEdge);if(s>n)throw"Face vertex greater that support polygon";c.n=a,++a}this.elementCount=a,e===xN.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*n,this.vertexCount=o,this.vertices=[],this.vertices.length=o*i,this.vertexIndices=[],this.vertexIndices.length=o;for(l=t.vHead.next;l!==t.vHead;l=l.next)if(-1!==l.n){var h=l.n*i;this.vertices[h+0]=l.coords[0],this.vertices[h+1]=l.coords[1],i>2&&(this.vertices[h+2]=l.coords[2]),this.vertexIndices[l.n]=l.idx}var u=0;for(c=t.fHead.next;c!==t.fHead;c=c.next)if(c.inside){r=c.anEdge,s=0;do{l=r.Org;this.elements[u++]=l.n,s++,r=r.Lnext}while(r!==c.anEdge);for(var d=s;d<n;++d)this.elements[u++]=-1;if(e===xN.CONNECTED_POLYGONS){r=c.anEdge;do{this.elements[u++]=this.getNeighbourFace_(r),r=r.Lnext}while(r!==c.anEdge);for(var p=s;p<n;++p)this.elements[u++]=-1}}},t.prototype.outputContours_=function(t,e){var n,i,r=0,s=0;this.vertexCount=0,this.elementCount=0;for(var a=t.fHead.next;a!==t.fHead;a=a.next)if(a.inside){i=n=a.anEdge;do{this.vertexCount++,n=n.Lnext}while(n!==i);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*e,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var o=0,l=0,c=0;r=0;for(a=t.fHead.next;a!==t.fHead;a=a.next)if(a.inside){s=0,i=n=a.anEdge;do{this.vertices[o++]=n.Org.coords[0],this.vertices[o++]=n.Org.coords[1],e>2&&(this.vertices[o++]=n.Org.coords[2]),this.vertexIndices[l++]=this.vertexIdCallback?this.vertexIdCallback(n):n.Org.idx,s++,n=n.Lnext}while(n!==i);this.elements[c++]=r,this.elements[c++]=s,r+=s}},t.prototype.addContour=function(t,e){null===this.mesh&&(this.mesh=new UN),t<2&&(t=2),t>3&&(t=3);for(var n=null,i=0;i<e.length;i+=t)null===n?(n=this.mesh.makeEdge(),this.mesh.splice(n,n.Sym)):(this.mesh.splitEdge(n),n=n.Lnext),n.Org.coords[0]=e[i+0],n.Org.coords[1]=e[i+1],n.Org.coords[2]=t>2?e[i+2]:0,n.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(n),n.winding=1,n.Sym.winding=-1},t.prototype.tesselate=function(t,e,n,i,r,s){if(void 0===t&&(t=yN.ODD),void 0===e&&(e=xN.POLYGONS),void 0===s&&(s=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,r&&(this.normal[0]=r[0],this.normal[1]=r[1],this.normal[2]=r[2]),this.windingRule=t,i<2&&(i=2),i>3&&(i=3),!this.mesh)return!1;this.projectPolygon_(),GN.computeInterior(this,s);var a=this.mesh;return e===xN.BOUNDARY_CONTOURS?this.setWindingNumber_(a,1,!0):this.tessellateInterior_(a),s&&a.check(),e===xN.BOUNDARY_CONTOURS?this.outputContours_(a,i):this.outputPolymesh_(a,e,n,i),!0},t}();function qN(t){var e=t.windingRule,n=void 0===e?yN.ODD:e,i=t.elementType,r=void 0===i?xN.POLYGONS:i,s=t.polySize,a=void 0===s?3:s,o=t.vertexSize,l=void 0===o?2:o,c=t.normal,h=void 0===c?[0,0,1]:c,u=t.contours,d=void 0===u?[]:u,p=t.strict,f=void 0===p||p,m=t.debug,g=void 0!==m&&m;if(!d&&f)throw new Error("Contours can't be empty");if(d){var v=new WN;t.edgeCreateCallback&&(v.edgeCreateCallback=t.edgeCreateCallback),t.vertexIdCallback&&(v.vertexIdCallback=t.vertexIdCallback);for(var y=0;y<d.length;y++)v.addContour(l||2,d[y]);return v.tesselate(n,r,a,l,h,f),{vertices:v.vertices,vertexIndices:v.vertexIndices,vertexCount:v.vertexCount,elements:v.elements,elementCount:v.elementCount,mesh:g?v.mesh:void 0}}}yN.ODD,yN.NONZERO,yN.POSITIVE,yN.NEGATIVE,yN.ABS_GEQ_TWO,xN.POLYGONS,xN.CONNECTED_POLYGONS,xN.BOUNDARY_CONTOURS;var XN=class{constructor(t=256,e=!1){this.capacity=t,this.size=0,this.debug=e,this.debug&&console.log(`allocating with cap ${t}`);let n=t*XN.eSize;this.buffer=new ArrayBuffer(n);let i=Float32Array.BYTES_PER_ELEMENT,r=0;this.positions=new Float32Array(this.buffer,r*i,3*t),r+=3*t,this.normals=new Float32Array(this.buffer,r*i,3*t),r+=3*t,this.uvs=new Float32Array(this.buffer,r*i,2*t)}realloc(t,e=!1){if(t<this.size)throw Error("cannot shrink buffer");if(t<=this.capacity&&!e)return;this.debug&&console.log(`resizing from ${this.capacity} \u2192 ${t}`);let n=t*XN.eSize,i=new ArrayBuffer(n),r=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(i,s*r,3*t);s+=3*t;let o=new Float32Array(i,s*r,3*t);s+=3*t;let l=new Float32Array(i,s*r,2*t);e?(a.set(this.positions.subarray(0,3*this.size)),o.set(this.normals.subarray(0,3*this.size)),l.set(this.uvs.subarray(0,2*this.size))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=i,this.positions=a,this.normals=o,this.uvs=l,this.capacity=t}get(t=1){let e=this.size+t;if(e>this.capacity){let t=this.capacity;for(;e>t;)t*=2;this.realloc(t)}let n=this.size;return this.size=e,n}reserve(t){let e=this.size+t;e>this.capacity&&this.realloc(e)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} \u2192 ${this.size}`),this.realloc(this.size,!0)}},$N=XN;$N.eSize=8*Float32Array.BYTES_PER_ELEMENT;var YN=class{constructor(t=[],e=((t,e)=>t<e?-1:t>e?1:0)){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(0===this.length)return;let t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:e,compare:n}=this,i=e[t];for(;t>0;){let r=t-1>>1,s=e[r];if(n(i,s)>=0)break;e[t]=s,t=r}e[t]=i}_down(t){let{data:e,compare:n}=this,i=this.length>>1,r=e[t];for(;t<i;){let i=1+(t<<1),s=i+1;if(s<this.length&&n(e[s],e[i])<0&&(i=s),n(e[i],r)>=0)break;e[t]=e[i],t=i}e[t]=r}};function ZN(t,e,n=1,i=!1){let r=1/0,s=1/0,a=-1/0,o=-1/0;for(let[e,n]of t[0])e<r&&(r=e),n<s&&(s=n),e>a&&(a=e),n>o&&(o=n);let l=a-r,c=o-s,h=Math.max(n,Math.min(l,c));if(h===n){let t=[r,s];return t.distance=0,t.distance}let u=new YN([],((t,e)=>e.max-t.max)),d=function(t){let e=0,n=0,i=0,r=t[0];for(let t=0,s=r.length,a=s-1;t<s;a=t++){let s=r[t],o=r[a],l=s[0]*o[1]-o[0]*s[1];n+=(s[0]+o[0])*l,i+=(s[1]+o[1])*l,e+=3*l}let s=new KN(n/e,i/e,0,t);return 0===e||s.d<0?new KN(r[0][0],r[0][1],0,t):s}(t),p=new KN(r+l/2,s+c/2,0,t);p.d>d.d&&(d=p);let f=2;function m(r,s,a){let o=new KN(r,s,a,t);if(f++,o.max>d.d+n&&u.push(o),o.d>d.d&&(d=o,i&&console.log(`found best ${Math.round(1e4*o.d)/1e4} after ${f} probes`),d.d>e))return e}let g=h/2;for(let t=r;t<a;t+=h)for(let e=s;e<o;e+=h)m(t+g,e+g,g);for(;u.length;){let{max:t,x:e,y:i,h:r}=u.pop();if(t-d.d<=n)break;g=r/2,m(e-g,i-g,g),m(e+g,i-g,g),m(e-g,i+g,g),m(e+g,i+g,g)}i&&console.log(`num probes: ${f}\nbest distance: ${d.d}`);let v=[d.x,d.y];return v.distance=d.d,v.distance}function KN(t,e,n,i){this.x=t,this.y=e,this.h=n,this.d=function(t,e,n){let i=!1,r=1/0;for(let s of n)for(let n=0,a=s.length,o=a-1;n<a;o=n++){let a=s[n],l=s[o];a[1]>e!=l[1]>e&&t<(l[0]-a[0])*(e-a[1])/(l[1]-a[1])+a[0]&&(i=!i),r=Math.min(r,JN(t,e,a,l))}return 0===r?0:(i?1:-1)*Math.sqrt(r)}(t,e,i),this.max=this.d+this.h*Math.SQRT2}function JN(t,e,n,i){let r=n[0],s=n[1],a=i[0]-r,o=i[1]-s;if(0!==a||0!==o){let n=((t-r)*a+(e-s)*o)/(a*a+o*o);n>1?(r=i[0],s=i[1]):n>0&&(r+=a*n,s+=o*n)}return a=t-r,o=e-s,a*a+o*o}var QN={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},tU={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},eU={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},nU=(t,e)=>([n,i])=>(i<n&&(i+=e),(t>=n?t:t+e)<=i),iU=class extends Nv{constructor(t,e,n=0,i=12,r=3,s=yN.ODD,a=!1){super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=t,this._depth=e,this._curveSegments=i,this._bevelSegmentsInput=r;let o,l,c,h=this._shape.extractShapePointsToFlatArray([],i),u=this._shape.shapeHoles.map((t=>{let e=t.extractShapePointsToFlatArray([],i),n=[];for(let t=e.length-1;t>=1;t-=2){let i=e[t-1],r=e[t-0];n.push(i,r)}return n})),d=[],p=[];for(let t=0;t<h.length;t+=2)p.push([h[t],h[t+1]]);d.push(p);for(let t=0;t<u.length;t++){let e=u[t],n=[];for(let t=0;t<e.length;t+=2)n.push([e[t],e[t+1]]);d.push(n)}o=t.isText?.1*(new eM).setFromPoints(t.points.map((t=>t.position))).getSize(new ym).length():0===d[0].length?n:n>0?ZN(d,n):1e-5,n<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(n,o,e/2),this._bevelSegments=Math.floor(r));try{l=qN({windingRule:s,elementType:xN.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[h]})}catch{l=QN}try{c=qN({windingRule:yN.ODD,elementType:xN.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...u]})}catch{c=tU}if(!l)throw new Error("error generating geometry");let f=l.elementCount;if(c){l.elementCount+=c.elementCount;for(let t=0;t<c.elements.length;t++){let e=c.elements[t],n=t%2==0?l.vertexCount:0;l.elements.push(e+n)}for(let t=0;t<c.vertexIndices.length;t++){let e=c.vertexIndices[t],n=l.vertexCount;l.vertexIndices.push(e+n)}for(let t=0;t<c.vertices.length;t++){let e=c.vertices[t];l.vertices.push(e)}}let m=1/0,g=-1/0,v=1/0,y=-1/0;for(let t=0,e=l.vertexCount;t<e;t++){let e=2*t,n=l.vertices[e+0],i=l.vertices[e+1];n<m&&(m=n),n>g&&(g=n),i<v&&(v=i),i>y&&(y=i)}this._minX=m,this._minY=v,this._width=g-m,this._height=y-v,this._buffer=new $N(this._computeBufferEstimatedSize(l));let x=[],b=[];for(let t=l.elementCount-1;t>=0;t--){let e=t>=f,n=2*t,r=l.elements[n+0],s=l.elements[n+1],c=r+s,h={start:r,count:s,normals:[],continuous:[],concave:[]},d=r,p=c-1,m=r+1,g=this._shape.roundedCurves.length;do{let t=d-r,n=l.vertices[2*p+0],i=l.vertices[2*p+1],a=l.vertices[2*d+0],o=l.vertices[2*d+1],u=l.vertices[2*m+0],f=l.vertices[2*m+1],v=a-n,y=o-i,x=Math.sqrt(v*v+y*y);v/=x,y/=x;let b=a-u,_=o-f,w=Math.sqrt(b*b+_*_);b/=w,_/=w,h.normals[2*t+0]=-_,h.normals[2*t+1]=b,h.concave[t]=v*_-y*b>0;let S=l.vertexIndices[d];if(Array.isArray(S))h.continuous[t]=!1;else{let[e,n]=this._shape.getCurveIndexFromVertexId(S-1,!0);if(n>0&&n<1)h.continuous[t]=!0;else{let i=1===n?e+1:e-1;i=(i+g)%g;let r=1===n?0:1,s=this._shape.roundedCurves[e].getTangent(n),a=this._shape.roundedCurves[i].getTangent(r);h.continuous[t]=s.dot(a)>.95}}e&&(h.normals[2*t+0]*=-1,h.normals[2*t+1]*=-1),[p,d,m]=[d,m,m+1],m>=c&&(m-=s)}while(m!==r+1);let v=[];v.push({bevelI:0,angle:0,size:0,boundary:{vertices:l.vertices.slice(2*r,2*c),vertexCount:s,vertexIndices:new Array(s).fill(!0).map(((t,e)=>[e,e])),elements:[0,s],elementCount:1,mesh:null},reverseMap:[],insetPoints:l.vertices.slice(2*r,2*c)});let y=0;for(let t=1;t<=this._bevelSegments;t++){let n=t/this._bevelSegments*Math.PI/2,r=(1-Math.cos(n))*this._bevel,a=[],o=[],c=[],u=[],d=0;for(let t=0;t<s;t++){let n=2*t,p=(t-1+s)%s*2,f=l.vertices[2*h.start+n+0],m=l.vertices[2*h.start+n+1],g=-h.normals[p+0]*r,v=-h.normals[p+1]*r,y=-h.normals[n+0]*r,x=-h.normals[n+1]*r;if(h.concave[t]||!h.concave[t]&&e){let n=Math.atan2(v,g),s=Math.atan2(x,y);s>n&&(s-=2*Math.PI);let o=s-n;if(h.continuous[t]||e){let i=n+o/2,s=Math.cos(i)*r,l=Math.sin(i)*r;a[2*d+0]=f+s*(e?-1:1),a[2*d+1]=m+l*(e?-1:1),u[d]=t,d++}else{let e=Math.max(1,Math.floor(i/4*Math.abs(o)/Math.PI));for(let i=0;i<=e;i++){let s=n+o*(i/e),l=Math.cos(s)*r,c=Math.sin(s)*r;a[2*d+0]=f+l,a[2*d+1]=m+c,u[d]=t,d++}}}else a[2*d+0]=f+g,a[2*d+1]=m+v,u[d]=t,o[t]=d,d++,a[2*d+0]=f,a[2*d+1]=m,u[d]=t,d++,a[2*d+0]=f+y,a[2*d+1]=m+x,u[d]=t,c[t]=d,d++}let p=qN({windingRule:yN.POSITIVE,elementType:xN.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[a],edgeCreateCallback:t=>{let e=t.Org.idx,n=u[e],i=u[(e+1)%u.length];t.idx=[n,i],t.Sym.idx=[i,n]},vertexIdCallback:t=>{let e=t.Lprev.idx;return[e?e[1]:0,t.idx?t.idx[0]:0]}});if(!p)throw console.log("Error"),new Error(`error generating bevel geometry for ${t}'th loop`);if(!p.vertexCount){let e=(t-1)/this._bevelSegments*Math.PI/2;y=(1-Math.sin(e))*this._bevel;break}for(let t=0;t<p.vertexIndices.length;t++){let[e,n]=p.vertexIndices[t];if(e===n)continue;let i=n;n<e&&(i+=s);for(let r=e;r<i;r++){let i=r%s,a=(r+1)%s;if(!h.continuous[i]||!h.continuous[a]){p.vertexIndices[t]=[e,i],p.vertexIndices.splice(t+1,0,[a,n]),p.vertices.splice(2*(t+1),0,p.vertices[2*t],p.vertices[2*t+1]);break}}}v.push({bevelI:t,angle:n,size:r,boundary:p,reverseMap:u,insetPoints:a})}let _=(t,e,n)=>{let i=0,r=t.boundary.vertexIndices.length;for(;i<r&&n(t.boundary.vertexIndices[e]);)e=(e+1)%r,i++;return i},w=x.length;for(let t=1;t<v.length;t++){let e=v[t-1],n=v[t],i=e.boundary.vertexIndices.length,r=n.boundary.vertexIndices.length;if(!i||!r)break;let o=h.concave.length,l=0,c=nU(l,s);for(;!e.boundary.vertexIndices.filter(c).length||!n.boundary.vertexIndices.filter(c).length;)l++,c=nU(l,s);let u=e.boundary.vertexIndices.findIndex(c),d=n.boundary.vertexIndices.findIndex(c);do{u=(u+1)%i}while(c(e.boundary.vertexIndices[u]));do{d=(d+1)%r}while(c(n.boundary.vertexIndices[d]));l=(l+1)%s;let p,f,m=l,g=0,y=this._buildBevelVert(h,e,(u-1+i)%i,void 0,g),b=this._buildBevelVert(h,n,(d-1+r)%r,void 0,g),w=!1;do{g=(l||o)/o,c=nU(l,s);let t=_(e,u,c),m=_(n,d,c),v=w;if(w=!1,t&&!m){for(let n=0;n<t;n++)p=this._buildBevelVert(h,e,(u+n)%i,n/(t-1),g),x.push(y.topN,p.topP,b.topN),!1===a&&x.push(p.bottomP,y.bottomN,b.bottomN),y=p;w=!0}else if(!t&&m)for(let t=0;t<m;t++)f=this._buildBevelVert(h,n,(d+t)%r,t/(m-1),g),x.push(b.topN,y.topP,f.topP),!1===a&&x.push(y.bottomP,b.bottomN,f.bottomP),b=f;else if(t&&m)if(p=this._buildBevelVert(h,e,u,0,g),f=this._buildBevelVert(h,n,d,0,g),v?(x.push(y.topN,f.topP,b.topN),x.push(y.topN,p.topP,f.topP),!1===a&&(x.push(f.bottomP,y.bottomN,b.bottomN),x.push(f.bottomP,p.bottomP,y.bottomN))):(x.push(b.topN,y.topN,p.topP),x.push(b.topN,p.topP,f.topP),!1===a&&(x.push(p.bottomP,y.bottomN,b.bottomN),x.push(p.bottomP,b.bottomN,f.bottomP))),y=p,b=f,t===m)for(let s=1;s<t;s++)p=this._buildBevelVert(h,e,(u+s)%i,s/(t-1),g),f=this._buildBevelVert(h,n,(d+s)%r,s/(m-1),g),x.push(y.topN,p.topP,b.topN),x.push(b.topN,p.topP,f.topP),!1===a&&(x.push(p.bottomP,y.bottomN,b.bottomN),x.push(p.bottomP,b.bottomN,f.bottomP)),y=p,b=f;else if(t>m){let s=t/m,o=0;for(let l=1;l<t;l++)p=this._buildBevelVert(h,e,(u+l)%i,l/(t-1),g),x.push(y.topN,p.topP,b.topN),!1===a&&x.push(p.bottomP,y.bottomN,b.bottomN),y=p,l>(o+1)*s&&(o++,f=this._buildBevelVert(h,n,(d+o)%r,o/(m-1),g),x.push(b.topN,p.topP,f.topP),!1===a&&x.push(p.bottomP,b.bottomN,f.bottomP),b=f)}else{let s=m/t,o=0;for(let l=1;l<m;l++)f=this._buildBevelVert(h,n,(d+l)%r,l/(m-1),g),x.push(b.topN,p.topP,f.topP),!1===a&&x.push(p.bottomP,b.bottomN,f.bottomP),b=f,l>(o+1)*s&&(o++,p=this._buildBevelVert(h,e,(u+o)%i,o/(t-1),g),x.push(y.topN,p.topP,b.topN),!1===a&&x.push(p.bottomP,y.bottomN,b.bottomN),y=p)}u=(u+t)%i,d=(d+m)%r,l=(l+1)%o}while(l!==m)}if(!1===a&&this._depth>2*this._bevel&&this._buildWall(v,h,x),e){let t=[];for(let e=x.length-1;e>=w+2;e-=3){let n=x[e-2],i=x[e-1],r=x[e-0];t.push(r,i,n)}x.splice(w,x.length-w,...t)}if(e){let t=[];for(let e=v[v.length-1].boundary.vertices.length-1;e>=1;e-=2){let n=v[v.length-1].boundary.vertices[e-1],i=v[v.length-1].boundary.vertices[e-0];t.push(n,i)}b.push(t)}if(!e){let t,e=v[v.length-1];try{t=qN({windingRule:v.length>1?yN.POSITIVE:yN.ODD,elementType:xN.POLYGONS,vertexSize:2,strict:!0,contours:[e.insetPoints,...b]})}catch{t=eU}if(!t)throw new Error("Error generating geometry for surface");0===u.length&&this._bevel<o&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let e=0;e<3*t.elementCount;e+=3){let n=this._buildSurfaceVert(t,t.elements[e+0],y),i=this._buildSurfaceVert(t,t.elements[e+1],y),r=this._buildSurfaceVert(t,t.elements[e+2],y);x.push(n.top,i.top,r.top),!1===a&&x.push(r.bottom,i.bottom,n.bottom)}}this.vertexCache={}}this._buffer.shrink();let _=new Tv(Uint32Array.from(x),1),w=new Tv(this._buffer.positions,3),S=new Tv(this._buffer.normals,3),M=new Tv(this._buffer.uvs,2);w.needsUpdate=!0,S.needsUpdate=!0,M.needsUpdate=!0,_.needsUpdate=!0,this.setAttribute("position",w),this.setAttribute("normal",S),this.setAttribute("uv",M),this.setIndex(_)}_computeBufferEstimatedSize(t){return 2*t.vertexCount*(2+this._bevelSegments)}_buildWall(t,e,n){let i=t[0];for(let t=0,r=i.boundary.vertexCount;t<r;t++){let s=this._buildBevelVert(e,i,t),a=this._buildBevelVert(e,i,(t+1)%r);n.push(a.topP,s.topN,s.bottomN),n.push(a.topP,s.bottomN,a.bottomP)}}_buildSurfaceVert(t,e,n){let i=e.toString();if(i in this.vertexCache)return this.vertexCache[i];let r=t.vertices[2*e+0],s=t.vertices[2*e+1],a=(r-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),c=3*l,h=2*l,u={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=r,this._buffer.positions[c+1]=s,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-n,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[h+0]=a,this._buffer.uvs[h+1]=o,!1===this.forPathBevel&&(this._buffer.positions[c+3]=r,this._buffer.positions[c+4]=s,this._buffer.positions[c+5]=n,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[h+2]=a,this._buffer.uvs[h+3]=o),this.vertexCache[i]=u,u}_buildBevelVert(t,e,n,i=1,r){let s=`${e.bevelI}:${n}`;if(s in this.vertexCache&&0!==r&&1!==r&&(!r||r===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let a,o,l,c,[h,u]=e.boundary.vertexIndices[n];h!==u?(o=h,a=u,c=!1,l=t.continuous[o]&&t.continuous[a]):(a=h,o=(a-1+t.count)%t.count,c=t.concave[a]&&e.bevelI>0,l=t.continuous[a]||c);let d=Math.cos(e.angle),p=Math.sin(e.angle),f=2*n,m=2*a,g=2*o,v=e.boundary.vertices[f+0],y=e.boundary.vertices[f+1],x=(1-p)*this._bevel,b=(v-this._minX)/this._width,_=(y-this._minY)/this._height;this.forPathBevel&&(void 0!==r&&(b=r),_=1);let w=t.normals[m+0],S=t.normals[m+1],M=t.normals[g+0],T=t.normals[g+1];if(c){w+=(M-w)*(1-i),S+=(T-S)*(1-i);let t=Math.sqrt(w*w+S*S);w/=t,S/=t}let E=this.forPathBevel?this._buffer.get(l?1:2):this._buffer.get(l?2:4),A=3*E,C=2*E,P={i:n,fi:a,topP:E+0,topN:E+0,bottomP:E+1,bottomN:E+1,pathBevelUCoord:r};return this._buffer.positions[A+0]=v,this._buffer.positions[A+1]=y,this._buffer.positions[A+2]=(this.forPathBevel?this._bevel:this._depth)-x,this._buffer.normals[A+0]=w*d,this._buffer.normals[A+1]=S*d,this._buffer.normals[A+2]=p,this._buffer.uvs[C+0]=b,this._buffer.uvs[C+1]=_,!1===this.forPathBevel&&(this._buffer.positions[A+3]=v,this._buffer.positions[A+4]=y,this._buffer.positions[A+5]=x,this._buffer.normals[A+3]=w*d,this._buffer.normals[A+4]=S*d,this._buffer.normals[A+5]=-p,this._buffer.uvs[C+2]=_,this._buffer.uvs[C+3]=b),l||(this.forPathBevel?(E+=1,A+=3,C+=2):(E+=2,A+=6,C+=4),P.topP=E+0,P.bottomP=E+1,this._buffer.positions[A+0]=v,this._buffer.positions[A+1]=y,this._buffer.positions[A+2]=(this.forPathBevel?this._bevel:this._depth)-x,this._buffer.normals[A+0]=M*d,this._buffer.normals[A+1]=T*d,this._buffer.normals[A+2]=p,this._buffer.uvs[C+0]=b,this._buffer.uvs[C+1]=_,!1===this.forPathBevel&&(this._buffer.positions[A+3]=v,this._buffer.positions[A+4]=y,this._buffer.positions[A+5]=x,this._buffer.normals[A+3]=M*d,this._buffer.normals[A+4]=T*d,this._buffer.normals[A+5]=-p,this._buffer.uvs[C+2]=_,this._buffer.uvs[C+3]=b)),this.vertexCache[s]=P,P}clone(){let t=new iU(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return t.userData=xP(this.userData),t}},rU=class extends Nv{constructor(t,e=12,n={}){super(),this.type="ShapeGeometry",this.windingRule=yN.ODD,this.elementType=xN.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=t,this._curveSegments=e,this._triangulationOptions=Object.assign({windingRule:yN.ODD,elementType:xN.POLYGONS,polySize:3,vertexSize:2,strict:!0},n);let i,r,s,a=this._shape.extractShapePointsToFlatArray([],this._curveSegments),o=this._shape.shapeHoles.map((t=>t.extractShapePointsToFlatArray([],this._curveSegments))),l=!0,c=!0;for(let t=0,e=a.length/2;t<e;t++){let e=2*t,n=a[e+0],i=a[e+1];if(void 0!==r&&n!==r&&(l=!1),void 0!==s&&i!==s&&(c=!1),r=n,s=i,!l&&!c)break}if(!l&&!c)try{i=qN({contours:[a,...o],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{i=QN}let h=i?.vertexCount??1,u=i?.elementCount??1;if(this._positionAttribute=new Tv(new Float32Array(3*h),3),this._normalAttribute=new Tv(new Float32Array(3*h),3),this._uvAttribute=new Tv(new Float32Array(2*h),2),this._indexAttribute=new Tv(new Uint32Array(3*u),1),i){let t=1/0,e=-1/0,n=1/0,r=-1/0;for(let s=0,a=h;s<a;s++){let a=2*s,o=i.vertices[a+0],l=i.vertices[a+1];o<t&&(t=o),o>e&&(e=o),l<n&&(n=l),l>r&&(r=l)}let s=e-t,a=r-n;for(let e=0,r=h;e<r;e++){let r=2*e,o=i.vertices[r+0],l=i.vertices[r+1],c=(o-t)/s,h=(l-n)/a;this._positionAttribute.setXYZ(e,o,l,0),this._normalAttribute.setXYZ(e,0,0,1),this._uvAttribute.setXY(e,c,h)}for(let t=0,e=u;t<e;t++){let e=3*t,n=i.elements[e+0],r=i.elements[e+1],s=i.elements[e+2];this._indexAttribute.setX(e+0,n),this._indexAttribute.setX(e+1,r),this._indexAttribute.setX(e+2,s)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,3*(i?.elementCount??1))}clone(){let t=new rU(this._shape,this._curveSegments);return t.userData=xP(this.userData),t}},sU=class extends iU{constructor(t,e,n=0,i=12,r=3,s=yN.ODD){super(t,e,n,i,r,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(t){return 2*t.vertexCount*(2+this._bevelSegments)}_buildWall(t,e,n){let i=t[0];for(let t=0,r=i.boundary.vertexCount;t<r;t++){let s=this._buildBevelVert(e,i,t),a=this._buildBevelVert(e,i,(t+1)%r);n.push(a.topP,s.topN,s.bottomN),n.push(a.topP,s.bottomN,a.bottomP)}}clone(){let t=new sU(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return t.userData=xP(this.userData),t}},aU=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:yN.ODD},t.parameters),i=Math.abs(n.width),r=Math.abs(n.height??n.width),s=Math.abs(n.depth??0),a=t.shape??e?.shape,o=a?.roundness??n.roundness;void 0!==a&&(a instanceof EN?(a.width!==i||a.height!==r)&&a.applySize(i,r):a=new EN(i,r).fromJSON(a),void 0!==t.parameters?.roundness&&t.parameters?.roundness>0&&a.update());let l=a??new EN(i,r);return{parameters:Object.assign(n,{width:i,height:r,depth:s,roundness:o}),shape:l}}static build(t){let e,{depth:n,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:s,roundness:a,windingRule:o}=t.parameters;return t.shape.roundness=a,e=n<=0?new rU(t.shape,s,{windingRule:o}):new sU(t.shape,n,i,s,r,o),Object.assign(e,{userData:{...t,type:"VectorGeometry"}})}},oU=2*Math.PI,lU=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters);return n.angle=vm.clamp(n.angle,0,360),{shape:t.shape&&t.shape instanceof EN?t.shape:new EN,parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??0)})}}static build(t){let e,{width:n,height:i,spikes:r,angle:s,innerRadius:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=t.parameters,h=t.shape,u=function(t,e,n,i,r,s){if(i>=oU)return r>30||r%4==0?(function(t,e,n,i=0,r=0,s=0){let a=.5522847498,o=e*a,l=n*a;t.addPoint(uU(r-e,s,r-e,s-l,r-e,s+l)),t.addPoint(uU(r,s+n,r-o,s+n,r+o,s+n)),t.addPoint(uU(r+e,s,r+e,s+l,r+e,s-l)),t.addPoint(uU(r,s-n,r+o,s-n,r-o,s-n)),i>0&&pU(t,e,n,i)}(t,e,n,s),Math.round(r/4)):cU(t,i,r,e,n,s);i=Math.max(i,.001);let a={x:0,y:n},o=i+.5*Math.PI,l={x:Math.cos(o)*e,y:Math.sin(o)*n},c=ON({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:e,ry:n,largeArcFlag:i>Math.PI,sweepFlag:!0});return r>30||r%c.length==0?function(t,e,n,i,r,s,a,o){let l=Math.round(r/i.length);t.addPoint(hU(e,n));for(let e=0,n=i.length;e<n;e++){let n=i[e],r=t.points[e],s=hU(n.x,n.y);r.controls[1].position.set(n.x1,n.y1),s.controls[0].position.set(n.x2,n.y2),t.addPoint(s)}return o>0?dU(t,s,a,o):t.addPoint(hU(0,0)),l}(t,a.x,a.y,c,r,e,n,s):cU(t,i,r,e,n,s)}(h,.5*n,.5*i,s*Math.PI/180,r,a);return h.isClosed=!0,h.update(),0===s?(e=new Nv,e.setAttribute("position",new Cv([],3))):e=aU.create({shape:h,parameters:{subdivisions:u,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}}),Object.assign(e,{userData:{...t,type:"EllipseGeometry"}})}};function cU(t,e,n,i,r,s){let a=-e/n;for(let e=0;e<=n;e++){let n=a*e,s=Math.sin(n)*i,o=Math.cos(n)*r;t.addPoint(hU(s,o))}return e<oU?s>0?dU(t,i,r,s):t.addPoint(hU(0,0)):(t.removePoint(t.points[t.points.length-1]),s>0&&pU(t,i,r,s)),1}function hU(t,e){return new $z(vm.generateUUID(),new ym(t,e))}function uU(t,e,n,i,r,s){let a=hU(t,e);return a.controls[0].position.set(n,i),a.controls[1].position.set(r,s),a}function dU(t,e,n,i){fU(t,e,n,i).forEach((e=>t.addPoint(e)))}function pU(t,e,n,i){let r=fU(t,e,n,i),s=new EN;r.forEach((t=>s.addPoint(t))),s.isClosed=!0,t.shapeHoles.push(s)}function fU(t,e,n,i){let r=i*e/100,s=r*(Math.abs(n)/Math.abs(e)),a=new ym(r/e,s/n),o=t.points.map((t=>{let e=t.clone();return e.uuid=vm.generateUUID(),e})).reverse();return o.forEach((t=>{t.position.multiply(a);let e=t.controls[0].position.clone().multiply(a),n=t.controls[1].position.clone().multiply(a);t.controls[0].position.copy(n),t.controls[1].position.copy(e)})),o}var mU=new Av([0,0,0],1),gU=class extends Nv{constructor(t=!0,e=1,n=1,i=1,r=1,s=1,a=1,o=1,l=1,c=1,h=1,u=1){if(super(),0===s)return;let d=t&&1===s;d&&(u=0),h>100&&(h=100),0===h&&(u=0);let p,f,m,g,v,y,x,b,_=()=>new $m,w=new $m,S=_(),M=_(),T=_(),E=_(),A=_(),C=_(),P=_(),R=_(),O=_(),D=_(),L=_(),I=n-2*o+.001,z=I/s,N=Math.ceil(a*s),U=N+1,k=I/N,B=-I/2,F=c+1,V=2*Math.PI/c,j=Math.PI/2/u,H=Math.min((1-h/100)*o,o-.01),G=o-H,W=0,q=2*u+2,X=F*q/2,$=X+F*U,Y=Math.max(0,F*(U+q)),[Z,K,J]=[3,3,2].map((t=>Array(Y*t).fill(0))),Q=[],tt=r-o;function et(e,n){let i=Math.PI/2;y=n*k,b=2*Math.PI*(y%z)/z+i,y+=B,x=Math.sin(b)*tt,v=Math.cos(b)*tt,t?e.set(v,x,y):e.set(v,y,x)}et(w,-1e-10),et(S,0),E.copy(w),et(w,1);let nt=w.distanceTo(S),it=d?0:G+H,rt=nt*N+2*it,st=H,at=rt-it;for(let e=0;e<=N;e++){et(M,e),L.subVectors(M,E).normalize(),E.copy(M),O.copy(M).setComponent(+t+1,0).normalize(),D.crossVectors(L,O).normalize();let n=0===e,i=e===N,r=n?3*Math.PI/2:j,s=n?st:at,a=n?F:$,l=n?0:Y-F,h=L.clone().multiplyScalar(n?-G:G).add(M),p=L.clone().multiplyScalar(n?-1:1).normalize();for(let t=0;t<F;t++){let f=t*V;if(A.addVectors(w.copy(O).multiplyScalar(o*Math.cos(f)),S.copy(D).multiplyScalar(o*Math.sin(f))),C.copy(A).normalize(),n||i){d||(W=l+t,[0,1,2].forEach((t=>{Z[3*W+t]=h.getComponent(t),K[3*W+t]=p.getComponent(t)})),J[2*W]=+i,J[2*W+1]=t/c),S.copy(C).multiplyScalar(H),T.addVectors(M,S);for(let e=0;e<u;e++){let i=e*j+r;P.addVectors(w.copy(L).multiplyScalar(G*Math.sin(i)),S.copy(C).multiplyScalar(G*Math.cos(i))),R.copy(P).normalize(),S.addVectors(T,P),P.normalize(),W=a+e*F+t,[0,1,2].forEach((t=>{Z[3*W+t]=S.getComponent(t),K[3*W+t]=R.getComponent(t)}));let o=+n+Math.sin(i);J[2*W]=(s+G*o)/rt,J[2*W+1]=t/c}}S.addVectors(M,A),W=X+e*F+t,[0,1,2].forEach((t=>{Z[3*W+t]=S.getComponent(t),K[3*W+t]=C.getComponent(t)})),J[2*W]=(it+e*nt)/rt,J[2*W+1]=t/c}}let ot=U+2*u+2,[lt,ct]=[+d,ot-1];for(let t=lt;t<=ct-1;t++){let e=d&&t===ct-1;for(let n=0;n<F-1;n++)p=t*F+n,f=p+1,m=(e?n:p)+F,g=(e?n+1:f)+F,0===t?Q.push(f,g,m):t===ot-2?Q.push(p,f,m):Q.push(p,f,m,f,g,m)}this.setIndex(Q),this.setAttribute("position",new Cv(Z,3)),this.setAttribute("normal",new Cv(K,3)),this.setAttribute("uv",new Cv(J,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let t,e,n,i,r=this.userData.parameters,s=Math.ceil(r.tubularSegments),a=r.radialSegments+1,o=Array.from(this.getIndex().array),l=6*(s-1)*r.radialSegments,c=s,h=c===s;for(let s=0;s<r.radialSegments;s++)t=c*a+s,e=t+1,n=(h?s:t)+a,i=(h?s+1:e)+a,o[l++]=t,o[l++]=e,o[l++]=n,o[l++]=e,o[l++]=i,o[l++]=n;return o.length=l,mU.array=o,mU.count=o.length,mU}},vU=class extends Hz{constructor(t=1,e=.2,n=4){let i=(1+Math.sqrt(5))/2,r="IcosahedronGeometry";super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],r,t,e,n),this.type=r}static fromJSON(t){return new vU(t.radius,t.corner,t.cornerSides)}},yU=new Mg,xU=new Kg,bU=new $m,_U=class extends am{constructor(){super(),this.uuid=vm.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(t){let e=(new xm).getNormalMatrix(t);for(let e=0,n=this.vertices.length;e<n;e++)this.vertices[e].applyMatrix4(t);for(let t=0,n=this.faces.length;t<n;t++){let n=this.faces[t];n.normal.applyMatrix3(e).normalize();for(let t=0,i=n.vertexNormals.length;t<i;t++)n.vertexNormals[t].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(t){return yU.makeRotationX(t),this.applyMatrix4(yU),this}rotateY(t){return yU.makeRotationY(t),this.applyMatrix4(yU),this}rotateZ(t){return yU.makeRotationZ(t),this.applyMatrix4(yU),this}translate(t,e,n){return yU.makeTranslation(t,e,n),this.applyMatrix4(yU),this}scale(t,e,n){return yU.makeScale(t,e,n),this.applyMatrix4(yU),this}lookAt(t){return xU.lookAt(t),xU.updateMatrix(),this.applyMatrix4(xU.matrix),this}fromBufferGeometry(t){let e=this,n=null!==t.index?t.index:void 0,i=t.attributes;if(void 0===i.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let r=i.position,s=i.normal,a=i.color,o=i.uv,l=i.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(let t=0;t<r.count;t++)e.vertices.push((new $m).fromBufferAttribute(r,t)),void 0!==a&&e.colors.push((new pv).fromBufferAttribute(a,t));function c(t,n,i,r){let c=void 0===a?[]:[e.colors[t].clone(),e.colors[n].clone(),e.colors[i].clone()],h=void 0===s?[]:[(new $m).fromBufferAttribute(s,t),(new $m).fromBufferAttribute(s,n),(new $m).fromBufferAttribute(s,i)],u=new SU(t,n,i,h,c,r);e.faces.push(u),void 0!==o&&e.faceVertexUvs[0].push([(new ym).fromBufferAttribute(o,t),(new ym).fromBufferAttribute(o,n),(new ym).fromBufferAttribute(o,i)]),void 0!==l&&e.faceVertexUvs[1].push([(new ym).fromBufferAttribute(l,t),(new ym).fromBufferAttribute(l,n),(new ym).fromBufferAttribute(l,i)])}let h=t.groups;if(h.length>0)for(let t=0;t<h.length;t++){let e=h[t],i=e.start;for(let t=i,r=i+e.count;t<r;t+=3)void 0!==n?c(n.getX(t),n.getX(t+1),n.getX(t+2),e.materialIndex):c(t,t+1,t+2,e.materialIndex)}else if(void 0!==n)for(let t=0;t<n.count;t+=3)c(n.getX(t),n.getX(t+1),n.getX(t+2));else for(let t=0;t<r.count;t+=3)c(t,t+1,t+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(bU).negate(),this.translate(bU.x,bU.y,bU.z),this}normalize(){this.computeBoundingSphere();let t=this.boundingSphere.center,e=this.boundingSphere.radius,n=0===e?1:1/e,i=new Mg;return i.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix4(i),this}computeFaceNormals(){let t=new $m,e=new $m;for(let n=0,i=this.faces.length;n<i;n++){let i=this.faces[n],r=this.vertices[i.a],s=this.vertices[i.b],a=this.vertices[i.c];t.subVectors(a,s),e.subVectors(r,s),t.cross(e),t.normalize(),i.normal.copy(t)}}computeVertexNormals(t=!0){let e=new Array(this.vertices.length);for(let t=0,n=this.vertices.length;t<n;t++)e[t]=new $m;if(t){let t=new $m,n=new $m;for(let i=0,r=this.faces.length;i<r;i++){let r=this.faces[i],s=this.vertices[r.a],a=this.vertices[r.b],o=this.vertices[r.c];t.subVectors(o,a),n.subVectors(s,a),t.cross(n),e[r.a].add(t),e[r.b].add(t),e[r.c].add(t)}}else{this.computeFaceNormals();for(let t=0,n=this.faces.length;t<n;t++){let n=this.faces[t];e[n.a].add(n.normal),e[n.b].add(n.normal),e[n.c].add(n.normal)}}for(let t=0,n=this.vertices.length;t<n;t++)e[t].normalize();for(let t=0,n=this.faces.length;t<n;t++){let n=this.faces[t],i=n.vertexNormals;3===i.length?(i[0].copy(e[n.a]),i[1].copy(e[n.b]),i[2].copy(e[n.c])):(i[0]=e[n.a].clone(),i[1]=e[n.b].clone(),i[2]=e[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let t=0,e=this.faces.length;t<e;t++){let e=this.faces[t],n=e.vertexNormals;3===n.length?(n[0].copy(e.normal),n[1].copy(e.normal),n[2].copy(e.normal)):(n[0]=e.normal.clone(),n[1]=e.normal.clone(),n[2]=e.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,e=this.faces.length;t<e;t++){let e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,n=e.vertexNormals.length;t<n;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}let t=new _U;t.faces=this.faces;for(let e=0,n=this.morphTargets.length;e<n;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];let t=this.morphNormals[e].faceNormals,n=this.morphNormals[e].vertexNormals;for(let e=0,i=this.faces.length;e<i;e++){let e=new $m,i={a:new $m,b:new $m,c:new $m};t.push(e),n.push(i)}}let n=this.morphNormals[e];t.vertices=this.morphTargets[e].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let t=0,e=this.faces.length;t<e;t++){let e=this.faces[t],i=n.faceNormals[t],r=n.vertexNormals[t];i.copy(e.normal),r.a.copy(e.vertexNormals[0]),r.b.copy(e.vertexNormals[1]),r.c.copy(e.vertexNormals[2])}}for(let t=0,e=this.faces.length;t<e;t++){let e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Km),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new mg),this.boundingSphere.setFromPoints(this.vertices)}merge(t,e,n=0){if(!t||!t.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);let i,r=this.vertices.length,s=this.vertices,a=t.vertices,o=this.faces,l=t.faces,c=this.colors,h=t.colors;void 0!==e&&(i=(new xm).getNormalMatrix(e));for(let t=0,n=a.length;t<n;t++){let n=a[t].clone();void 0!==e&&n.applyMatrix4(e),s.push(n)}for(let t=0,e=h.length;t<e;t++)c.push(h[t].clone());for(let t=0,e=l.length;t<e;t++){let e,s,a=l[t],c=a.vertexNormals,h=a.vertexColors,u=new SU(a.a+r,a.b+r,a.c+r);u.normal.copy(a.normal),void 0!==i&&u.normal.applyMatrix3(i).normalize();for(let t=0,n=c.length;t<n;t++)e=c[t].clone(),void 0!==i&&e.applyMatrix3(i).normalize(),u.vertexNormals.push(e);u.color.copy(a.color);for(let t=0,e=h.length;t<e;t++)s=h[t],u.vertexColors.push(s.clone());u.materialIndex=a.materialIndex+n,o.push(u)}for(let e=0,n=t.faceVertexUvs.length;e<n;e++){let n=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,i=n.length;t<i;t++){let i=n[t],r=[];for(let t=0,e=i.length;t<e;t++)r.push(i[t].clone());this.faceVertexUvs[e].push(r)}}}mergeMesh(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)}mergeVertices(t=4){let e={},n=[],i=[],r=Math.pow(10,t);for(let t=0,s=this.vertices.length;t<s;t++){let s=this.vertices[t],a=Math.round(s.x*r)+"_"+Math.round(s.y*r)+"_"+Math.round(s.z*r);void 0===e[a]?(e[a]=t,n.push(this.vertices[t]),i[t]=n.length-1):i[t]=i[e[a]]}let s=[];for(let t=0,e=this.faces.length;t<e;t++){let e=this.faces[t];e.a=i[e.a],e.b=i[e.b],e.c=i[e.c];let n=[e.a,e.b,e.c];for(let e=0;e<3;e++)if(n[e]===n[(e+1)%3]){s.push(t);break}}for(let t=s.length-1;t>=0;t--){let e=s[t];this.faces.splice(e,1);for(let t=0,n=this.faceVertexUvs.length;t<n;t++)this.faceVertexUvs[t].splice(e,1)}let a=this.vertices.length-n.length;return this.vertices=n,a}setFromPoints(t){this.vertices=[];for(let e=0,n=t.length;e<n;e++){let n=t[e];this.vertices.push(new $m(n.x,n.y,n.z||0))}return this}sortFacesByMaterialIndex(){let t=this.faces,e=t.length;for(let n=0;n<e;n++)t[n]._id=n;t.sort((function(t,e){return t.materialIndex-e.materialIndex}));let n,i,r=this.faceVertexUvs[0],s=this.faceVertexUvs[1];r&&r.length===e&&(n=[]),s&&s.length===e&&(i=[]);for(let a=0;a<e;a++){let e=t[a]._id;n&&n.push(r[e]),i&&i.push(s[e])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)}toJSON(){let t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){let e=this.parameters;for(let n in e)void 0!==e[n]&&(t[n]=e[n]);return t}let e=[];for(let t=0;t<this.vertices.length;t++){let n=this.vertices[t];e.push(n.x,n.y,n.z)}let n=[],i=[],r={},s=[],a={},o=[],l={};for(let t=0;t<this.faces.length;t++){let e=this.faces[t],i=!0,r=!1,s=void 0!==this.faceVertexUvs[0][t],a=e.normal.length()>0,o=e.vertexNormals.length>0,l=1!==e.color.r||1!==e.color.g||1!==e.color.b,p=e.vertexColors.length>0,f=0;if(f=c(f,0,0),f=c(f,1,i),f=c(f,2,r),f=c(f,3,s),f=c(f,4,a),f=c(f,5,o),f=c(f,6,l),f=c(f,7,p),n.push(f),n.push(e.a,e.b,e.c),n.push(e.materialIndex),s){let e=this.faceVertexUvs[0][t];n.push(d(e[0]),d(e[1]),d(e[2]))}if(a&&n.push(h(e.normal)),o){let t=e.vertexNormals;n.push(h(t[0]),h(t[1]),h(t[2]))}if(l&&n.push(u(e.color)),p){let t=e.vertexColors;n.push(u(t[0]),u(t[1]),u(t[2]))}}function c(t,e,n){return n?t|1<<e:t&~(1<<e)}function h(t){let e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==r[e]||(r[e]=i.length/3,i.push(t.x,t.y,t.z)),r[e]}function u(t){let e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==a[e]||(a[e]=s.length,s.push(t.getHex())),a[e]}function d(t){let e=t.x.toString()+t.y.toString();return void 0!==l[e]||(l[e]=o.length/2,o.push(t.x,t.y)),l[e]}return t.data={},t.data.vertices=e,t.data.normals=i,s.length>0&&(t.data.colors=s),o.length>0&&(t.data.uvs=[o]),t.data.faces=n,t}clone(){return(new _U).copy(this)}copy(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;let e=t.vertices;for(let t=0,n=e.length;t<n;t++)this.vertices.push(e[t].clone());let n=t.colors;for(let t=0,e=n.length;t<e;t++)this.colors.push(n[t].clone());let i=t.faces;for(let t=0,e=i.length;t<e;t++)this.faces.push(i[t].clone());for(let e=0,n=t.faceVertexUvs.length;e<n;e++){let n=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,i=n.length;t<i;t++){let i=n[t],r=[];for(let t=0,e=i.length;t<e;t++){let e=i[t];r.push(e.clone())}this.faceVertexUvs[e].push(r)}}let r=t.morphTargets;for(let t=0,e=r.length;t<e;t++){let e={};if(e.name=r[t].name,void 0!==r[t].vertices){e.vertices=[];for(let n=0,i=r[t].vertices.length;n<i;n++)e.vertices.push(r[t].vertices[n].clone())}if(void 0!==r[t].normals){e.normals=[];for(let n=0,i=r[t].normals.length;n<i;n++)e.normals.push(r[t].normals[n].clone())}this.morphTargets.push(e)}let s=t.morphNormals;for(let t=0,e=s.length;t<e;t++){let e={};if(void 0!==s[t].vertexNormals){e.vertexNormals=[];for(let n=0,i=s[t].vertexNormals.length;n<i;n++){let i=s[t].vertexNormals[n],r={};r.a=i.a.clone(),r.b=i.b.clone(),r.c=i.c.clone(),e.vertexNormals.push(r)}}if(void 0!==s[t].faceNormals){e.faceNormals=[];for(let n=0,i=s[t].faceNormals.length;n<i;n++)e.faceNormals.push(s[t].faceNormals[n].clone())}this.morphNormals.push(e)}let a=t.skinWeights;for(let t=0,e=a.length;t<e;t++)this.skinWeights.push(a[t].clone());let o=t.skinIndices;for(let t=0,e=o.length;t<e;t++)this.skinIndices.push(o[t].clone());let l=t.lineDistances;for(let t=0,e=l.length;t<e;t++)this.lineDistances.push(l[t]);let c=t.boundingBox;null!==c&&(this.boundingBox=c.clone());let h=t.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}toBufferGeometry(){let t=(new wU).fromGeometry(this),e=new Nv,n=new Float32Array(3*t.vertices.length);if(e.setAttribute("position",AU.call(new Tv(n,3),t.vertices)),t.normals.length>0){let n=new Float32Array(3*t.normals.length);e.setAttribute("normal",AU.call(new Tv(n,3),t.normals))}if(t.colors.length>0){let n=new Float32Array(3*t.colors.length);e.setAttribute("color",TU.call(new Tv(n,3),t.colors))}if(t.uvs.length>0){let n=new Float32Array(2*t.uvs.length);e.setAttribute("uv",EU.call(new Tv(n,2),t.uvs))}if(t.uvs2.length>0){let n=new Float32Array(2*t.uvs2.length);e.setAttribute("uv2",EU.call(new Tv(n,2),t.uvs2))}e.groups=t.groups;for(let n in t.morphTargets){let i=[],r=t.morphTargets[n];for(let t=0,e=r.length;t<e;t++){let e=r[t],n=new Cv(3*e.data.length,3);n.name=e.name,i.push(AU.call(n,e.data))}e.morphAttributes[n]=i}if(t.skinIndices.length>0){let n=new Cv(4*t.skinIndices.length,4);e.setAttribute("skinIndex",CU.call(n,t.skinIndices))}if(t.skinWeights.length>0){let n=new Cv(4*t.skinWeights.length,4);e.setAttribute("skinWeight",CU.call(n,t.skinWeights))}return null!==t.boundingSphere&&(e.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(e.boundingBox=t.boundingBox.clone()),e}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(t){let e=new Nv,n=t.geometry;if(t.isPoints||t.isLine){let t=new Cv(3*n.vertices.length,3),i=new Cv(3*n.colors.length,3);if(e.setAttribute("position",AU.call(t,n.vertices)),e.setAttribute("color",TU.call(i,n.colors)),n.lineDistances&&n.lineDistances.length===n.vertices.length){let t=new Cv(n.lineDistances.length,1);e.setAttribute("lineDistance",MU.call(t,n.lineDistances))}null!==n.boundingSphere&&(e.boundingSphere=n.boundingSphere.clone()),null!==n.boundingBox&&(e.boundingBox=n.boundingBox.clone())}else t.isMesh&&(e=n.toBufferGeometry());return e}};_U.prototype.isGeometry=!0;var wU=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(t){let e,n,i,r=[],s=t.faces;for(n=0;n<s.length;n++){let t=s[n];t.materialIndex!==i&&(i=t.materialIndex,void 0!==e&&(e.count=3*n-e.start,r.push(e)),e={start:3*n,materialIndex:i})}void 0!==e&&(e.count=3*n-e.start,r.push(e)),this.groups=r}fromGeometry(t){let e,n=t.faces,i=t.vertices,r=t.faceVertexUvs,s=r[0]&&r[0].length>0,a=r[1]&&r[1].length>0,o=t.morphTargets,l=o.length;if(l>0){e=[];for(let t=0;t<l;t++)e[t]={name:o[t].name,data:[]};this.morphTargets.position=e}let c,h=t.morphNormals,u=h.length;if(u>0){c=[];for(let t=0;t<u;t++)c[t]={name:h[t].name,data:[]};this.morphTargets.normal=c}let d=t.skinIndices,p=t.skinWeights,f=d.length===i.length,m=p.length===i.length;i.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let t=0;t<n.length;t++){let g=n[t];this.vertices.push(i[g.a],i[g.b],i[g.c]);let v=g.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{let t=g.normal;this.normals.push(t,t,t)}let y=g.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{let t=g.color;this.colors.push(t,t,t)}if(!0===s){let e=r[0][t];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",t),this.uvs.push(new ym,new ym,new ym))}if(!0===a){let e=r[1][t];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",t),this.uvs2.push(new ym,new ym,new ym))}for(let t=0;t<l;t++){let n=o[t].vertices;e[t].data.push(n[g.a],n[g.b],n[g.c])}for(let e=0;e<u;e++){let n=h[e].vertexNormals[t];c[e].data.push(n.a,n.b,n.c)}f&&this.skinIndices.push(d[g.a],d[g.b],d[g.c]),m&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}},SU=class{constructor(t,e,n,i,r,s=0){this.a=t,this.b=e,this.c=n,this.normal=i&&i.isVector3?i:new $m,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new pv,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=s}clone(){return(new this.constructor).copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}};function MU(t){return this.array.set(t),this}function TU(t){let e=this.array,n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new pv),e[n++]=r.r,e[n++]=r.g,e[n++]=r.b}return this}function EU(t){let e=this.array,n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new ym),e[n++]=r.x,e[n++]=r.y}return this}function AU(t){let e=this.array,n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new $m),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z}return this}function CU(t){let e=this.array,n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new jm),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z,e[n++]=r.w}return this}var PU=["a","b","c"];function RU(t,e){switch(e){case"c":return t.c;case"b":return t.b;default:return t.a}}function OU(t,e,n){let i=Math.min(t,e)+"_"+Math.max(t,e);return n.get(i)}function DU(t,e,n,i,r,s){let a,o=Math.min(t,e),l=Math.max(t,e),c=o+"_"+l;if(i.has(c))a=i.get(c);else{a={a:n[o],b:n[l],newEdge:null,faces:[]},i.set(c,a)}a.faces.push(r),s[t].edges.push(a),s[e].edges.push(a)}function LU(t,e,n,i,r){t.push(new SU(e,n,i,void 0,void 0,r))}function IU(t,e){return Math.abs(e-t)/2+Math.min(t,e)}function zU(t,e,n,i){t.push([e.clone(),n.clone(),i.clone()])}var NU=class{constructor(t=1){this.subdivisions=t}modify(t){(t=t instanceof Nv?(new _U).fromBufferGeometry(t):t.clone()).mergeVertices();let e=this.subdivisions;for(;e-- >0;)this._smooth(t);return t.computeFaceNormals(),t.computeVertexNormals(),t}_smooth(t){let e,n,i,r,s,a=new $m,o=t.vertices,l=t.faces,c=t.faceVertexUvs[0],h=void 0!==c&&c.length>0,u=[],d=new Map;!function(t,e,n,i){let r,s,a;for(r=0,s=t.length;r<s;r++)n[r]={edges:[]};for(r=0,s=e.length;r<s;r++)a=e[r],DU(a.a,a.b,t,i,a,n),DU(a.b,a.c,t,i,a,n),DU(a.c,a.a,t,i,a,n)}(o,l,u,d);let p,f,m,g,v,y,x,b=[];for(let t of Array.from(d.keys())){for(f=d.get(t),m=new $m,v=3/8,y=1/8,x=f.faces.length,2!=x&&(v=.5,y=0),m.addVectors(f.a,f.b).multiplyScalar(v),a.set(0,0,0),r=0;r<x;r++){for(g=f.faces[r],s=0;s<3&&(p=o[RU(g,PU[s])],p===f.a||p===f.b);s++);p&&a.add(p)}a.multiplyScalar(y),m.add(a),f.newEdge=b.length,b.push(m)}let _,w,S,M,T,E,A,C=[];for(n=0,i=o.length;n<i;n++){for(E=o[n],T=u[n].edges,e=T.length,3==e?_=3/16:e>3&&(_=3/(8*e)),w=1-e*Number(_),S=_,e<=2&&(2==e&&(w=3/4,S=1/8)),A=E.clone().multiplyScalar(w),a.set(0,0,0),r=0;r<e;r++)M=T[r],p=M.a!==E?M.a:M.b,a.add(p);a.multiplyScalar(Number(S)),A.add(a),C.push(A)}let P,R,O,D,L,I,z,N=C.concat(b),U=C.length,k=[],B=[],F=new ym,V=new ym,j=new ym;for(n=0,i=l.length;n<i;n++)g=l[n],P=Number(OU(g.a,g.b,d).newEdge)+U,R=Number(OU(g.b,g.c,d).newEdge)+U,O=Number(OU(g.c,g.a,d).newEdge)+U,LU(k,P,R,O,g.materialIndex),LU(k,g.a,P,O,g.materialIndex),LU(k,g.b,R,P,g.materialIndex),LU(k,g.c,O,R,g.materialIndex),h&&(D=c[n],L=D[0],I=D[1],z=D[2],F.set(IU(L.x,I.x),IU(L.y,I.y)),V.set(IU(I.x,z.x),IU(I.y,z.y)),j.set(IU(L.x,z.x),IU(L.y,z.y)),zU(B,F,V,j),zU(B,L,F,j),zU(B,I,V,F),zU(B,z,j,V));t.vertices=N,t.faces=k,h&&(t.faceVertexUvs[0]=B)}},UU=new $m,kU=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},t.parameters);return{shape:t.shape&&t.shape instanceof EN?t.shape:new EN,parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??0)})}}static build(t){let{width:e,height:n,spikes:i,cornerRadius:r,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=t.parameters,l=t.shape,c=.5*e,h=.5*n,u=2*Math.PI/i;for(let t=0;t<i;t++){let e=u*t,n=0+Math.sin(e)*c,i=0+Math.cos(e)*h;l.addPoint(l.createPoint(n,i))}l.isClosed=!0;for(let t=0,e=l.points.length;t<e;t++)l.points[t].roundness=r;l.roundness=r,l.update();let d=aU.create({shape:l,parameters:{roundness:r,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(d,{userData:{...t,type:"PolygonGeometry"}})}};function BU(t,e,n){n.x=t.x*e.x,n.y=t.y,n.z=t.x*e.y}function FU(t,e,n,i,r,s){let a=e.clone().sub(t),o=n.clone().sub(t),l=a.angleTo(o);if(a.normalize(),o.normalize(),i===r){let e=a.add(o).normalize();s.copy(t).addScaledVector(e,i/Math.sin(l/2))}else{let e=a.angleTo(o);s.copy(t),s.addScaledVector(a,r/Math.sin(e)),s.addScaledVector(o,i/Math.sin(e))}}function VU(t,e,n){let i=t.clone().sub(e),r=n.clone().sub(e);return i.projectOnVector(r),i.add(e)}var jU=class extends Nv{constructor(t=.5,e=1,n=4,i=1,r=!1,s=0,a=4){super(),n=Math.floor(Math.max(3,n)),i=Math.floor(i),a=Math.floor(a);let o,l=[],c=[],h=[],u=[],d=0,p=e/2,f=Math.PI/n,m=t*Math.cos(Math.PI/n),g=2*Math.PI/n,v=(n-2)*Math.PI/n,y=Math.PI-v,x=new $m(0,-p,0),b=new $m(0,p,0),_=new ym(t,-p),w=new ym(m,-p),S=new ym(0,b.y).sub(w),M=new ym(0,b.y).sub(_),T=new ym(S.y,-S.x).normalize(),E=new ym(M.y,-M.x).normalize(),A=t*Math.cos(Math.PI/n)*Math.tan((Math.PI-S.angle())/2)-1e-8;s=Math.min(s,A);{let t=new $m(T.x,T.y,0),e=new $m(Math.cos(g)*t.x,t.y,Math.sin(g)*t.x);o=t.angleTo(e)}let C=s/Math.tan((Math.PI-S.angle())/2),P=s/Math.tan((Math.PI-o)/2),R=new $m;if(!r){c.push(x.x,x.y,x.z),h.push(0,-1,0),u.push(0,0);let t=d++,e=[],i=_.clone(),r=C/Math.cos(Math.PI/n);i.x-=r;for(let t=0;t<n;t++){let r=t/n*Math.PI*2+f;BU(i,new ym(Math.sin(r),Math.cos(r)),R),c.push(R.x,R.y,R.z),h.push(0,-1,0),u.push(0,0),e.push(d++)}for(let n=0;n<e.length;n++)l.push(e[n],t,e[(n+1)%e.length])}let O=[];{let t=new $m,e=new $m,i=new $m,r=new $m,p=new $m,m=new $m;for(let g=0;g<n;g++){let v=g/n*Math.PI*2+f,y=(g+.5)/n*Math.PI*2+f,w=(g+1)/n*Math.PI*2+f,M=new ym(Math.sin(v),Math.cos(v)),A=new ym(Math.sin(y),Math.cos(y)),R=new ym(Math.sin(w),Math.cos(w));BU(_,M,e),BU(_,R,i),BU(T,A,t),FU(b,e,i,P,P,r),c.push(r.x,r.y,r.z),FU(e,b,i,P,C,p),c.push(p.x,p.y,p.z),FU(i,e,b,C,P,m),c.push(m.x,m.y,m.z),h.push(t.x,t.y,t.z),h.push(t.x,t.y,t.z),h.push(t.x,t.y,t.z),u.push(0,0),u.push(0,0),u.push(0,0);let I=d++,z=d++,N=d++;if(l.push(I,z,N),s>0){{let t=e.clone().add(i).multiplyScalar(.5),n=b.clone().sub(t).normalize(),r=x.clone().sub(t).normalize().add(n).normalize().multiplyScalar(-1);D(t,m.clone().sub(p),r,S.angle())}let f,g;{let t=new $m;BU(E,R,t);let e=m.clone().add(r).multiplyScalar(.5);e=VU(e,i,b);let n=m.clone().sub(r);[f,g]=D(e,n,t,o,r.y)}{let t=f,e=t.clone().setY(0).normalize(),n=new $m(0,-1,0),i=e.clone().cross(n);L(t,e,n,i)}O.concat(g);{let e=S.angle(),i=Math.PI-e,r=b.clone();r.y-=s/Math.sin(e-Math.PI/2);let o=new $m,p=[];for(let e=0;e<a;e++){let l=[],f=Math.PI/2-i*e/a,m=Math.cos(f),g=Math.sin(f),v=y;for(let i=0;i<=e;i++){let i=Math.cos(v),a=Math.sin(v);t.x=m*a,t.y=g,t.z=m*i,o.copy(r).addScaledVector(t,s),c.push(o.x,o.y,o.z),h.push(t.x,t.y,t.z),u.push(0,0),l.push(d++),v+=2*Math.PI/e/n}p.push(l)}g.reverse(),p.push(g);let f=p.length-1;for(let t=0;t<f;t++){let e=p[t],n=p[t+1],i=e.length-1;l.push(n[1],e[0],n[0]);for(let t=1;t<=i;t++)l.push(e[t],e[t-1],n[t]),l.push(n[t+1],e[t],n[t])}}}}}function D(t,e,n,i,r){let o=-i/2,p=(Math.PI-i)/2,f=e.clone().normalize().cross(n);t.addScaledVector(n,-s/Math.sin(p));let m=new $m,g=new $m,v=d,y=[];for(let l=0;l<=a;l++){let p=o+l/a*i;g.set(0,0,0),g.addScaledVector(f,Math.sin(p)),g.addScaledVector(n,Math.cos(p));for(let n=0;n<=1;n++){let i=n/1-.5;if(m.copy(t),m.addScaledVector(e,i),m.addScaledVector(g,s),null!=r){let t=Math.max(0,m.y-r);m.addScaledVector(e,-t/e.y)}c.push(m.x,m.y,m.z),h.push(g.x,g.y,g.z),u.push(0,0),0===n&&y.push(d),d++}}for(let t=0;t<a;t++)for(let e=0;e<1;e++){let n=v+e+2*t,i=n+2,r=i+1,s=n+1;l.push(n,i,s),l.push(i,r,s)}return[t.clone().addScaledVector(e,.5),y]}function L(t,e,n,i){let r=Math.PI/2,o=M.angle()-r,p=[],f=new $m,m=new $m;for(let l=0;l<=a;l++){let g=[],v=l/a;for(let a=0;a<=l;a++){let p=((l?a/l:0)-.5)*y,x=Math.cos(p),b=Math.sin(p),_=(r+Math.atan(Math.tan(o)*x))*v,w=Math.cos(_),S=Math.sin(_);f.set(0,0,0),f.addScaledVector(e,S*x),f.addScaledVector(n,w),f.addScaledVector(i,S*b),m.copy(t).addScaledVector(f,s),c.push(m.x,m.y,m.z),h.push(f.x,f.y,f.z),u.push(0,0),g.push(d++)}p.push(g)}let g=p.length-1;for(let t=0;t<g;t++){let e=p[t],n=p[t+1],i=e.length-1;l.push(e[0],n[1],n[0]);for(let t=1;t<=i;t++)l.push(e[t-1],e[t],n[t]),l.push(e[t],n[t+1],n[t])}}this.setIndex(l),this.setAttribute("position",new Cv(c,3)),this.setAttribute("normal",new Cv(h,3)),this.setAttribute("uv",new Cv(u,2))}},HU=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters),i=Object.assign(e?.ui??{enabledIndieCorners:!1},t.ui);return{shape:t.shape&&t.shape instanceof EN?t.shape:new EN,parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??0)}),ui:i}}static build(t){let e=t.shape,{width:n,height:i,cornerRadius:r,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=t.parameters,c={x:.5*n,y:.5*i},h={x:-c.x,y:-c.y},u={x:c.x,y:c.y};function d(t,e,r){return e>n&&r>i?Math.min(t*n/e,t*i/r):e>n?t*n/e:r>i?t*i/r:t}let p=[];p[0]=0===r[0]?0:d(r[0],r[0]+r[3],r[0]+r[1]),p[1]=0===r[1]?0:d(r[1],r[1]+r[2],r[1]+r[0]),p[2]=0===r[2]?0:d(r[2],r[2]+r[1],r[2]+r[3]),p[3]=0===r[3]?0:d(r[3],r[3]+r[0],r[3]+r[2]);let f=h.x,m=u.x,g=u.y,v=h.y;e.addPoint(e.createPoint(f,g)),e.addPoint(e.createPoint(m,g)),e.addPoint(e.createPoint(m,v)),e.addPoint(e.createPoint(f,v)),e.isClosed=!0;let y=!0;for(let t=0,n=e.points.length;t<n;t++)e.points[t].roundness=p[t],t>0&&p[t]!==p[t-1]&&(y=!1);y&&(e.roundness=p[0]),e.useCubicForRoundedCorners=1!==s,e.update();let x=aU.create({shape:e,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(x,{userData:{...t,type:"RectangleGeometry"}})}},GU=class extends Nv{constructor(t=1,e=1,n=1,i=90,r=10,s=24){super(),this.type="BackdropGeometry";let a=[],o=[],l=[],c=.001;0==r&&(s=1),s=Math.max(1,Math.floor(s)),r=Math.min(r,100),i=Math.min(180-c,i),i*=Math.PI/180;let h=[],u=Math.PI/2,d=(t=0,e=0,n=0)=>new $m(t,e,n),p=d(),f=d(),[m,g,v]=[e/2,t/2,n/2],y=-g,x=+g,[b,_,w]=[d(y,-m,+v),d(y,-m,-v),d(y,+m,-v)],S=(t,e=!1)=>Math.sin(t-Math.PI/(+e+1)),M=(t,e=!1)=>Math.cos(t-Math.PI/(+e+1));w.y=Math.sin(i)*e-m;let T=Math.cos(i)*e-v,E=b.z-c;i<=u?(w.z=Math.min(T,E),w.z==E&&(w.y-=(T-E)/Math.tan(u-i))):_.z=Math.min(_.z-T-v,b.z-c),p.subVectors(b,_),f.subVectors(w,_);let A=Math.min(p.length(),f.length())*r/100,C=A*Math.tan(i/2),P=A/Math.cos(i/2),R=p.clone().normalize().add(f.normalize()).setLength(P).add(_);p.set(0,S(i,!0),M(i,!0)),h.push([w,p.clone()]);let O=(Math.PI-i)/s;for(let t=0;t<=s;t++){let e=u+i+t*O;p.set(0,Math.sin(e)*C,Math.cos(e)*C),p.add(R),f.set(0,S(e),M(e)),h.push([p.clone(),f.clone()])}h.push([b,d(0,1,0)]);let D=Math.sin(O/2)*C*2,L=h.length-1,I=h[0][0].distanceTo(h[1][0]),z=I+D*s+h[L-1][0].distanceTo(h[L][0]);h[0].push(1);for(let t=0;t<=s;t++)h[t+1].push(1-(I+t*D)/z);h[L].push(0);let N,U,k,[B,F,V]=h[0];for(let t=1;t<h.length;t++)[N,U,k]=h[t],a.push(y,B.y,B.z,y,N.y,N.z,x,B.y,B.z,x,B.y,B.z,y,N.y,N.z,x,N.y,N.z),o.push(0,F.y,F.z,0,U.y,U.z,0,F.y,F.z,0,F.y,F.z,0,U.y,U.z,0,U.y,U.z),l.push(0,V,0,k,1,V,1,V,0,k,1,k),[B,F,V]=[N,U,k];this.setAttribute("position",new Cv(a,3)),this.setAttribute("normal",new Cv(o,3)),this.setAttribute("uv",new Cv(l,2))}},WU=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters);return{shape:t.shape&&t.shape instanceof EN?t.shape:new EN,parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??0)})}}static build(t){let{width:e,height:n,innerRadiusPercent:i,spikes:r,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=t.parameters,h=t.shape,u=.5*e,d=.5*n,p=a*Math.PI/360/r,f=Math.PI/2*3*-1,m=u*i/100,g=d*i/100;if(3===r&&50===i){p=2*Math.PI/r;for(let t=0;t<r;t++){let e=p*t,n=0+Math.sin(e)*u,i=0+Math.cos(e)*d;h.addPoint(h.createPoint(n,i))}}else for(let t=0;t<r;t++){let t=0+Math.cos(f)*u,e=0+Math.sin(f)*d;h.addPoint(h.createPoint(t,e)),f+=p,t=0+Math.cos(f)*m,e=0+Math.sin(f)*g,h.addPoint(h.createPoint(t,e)),f+=p}h.isClosed=!0;for(let t=0,e=h.points.length;t<e;t++)h.points[t].roundness=s;h.roundness=s,h.update();let v=aU.create({shape:h,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(v,{userData:{...t,type:"StarGeometry"}})}};var qU={parseRgba:function(t){return/^(rgba)?\(\s*(\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(t.toLowerCase())},hsvToRgb:function(t,e,n){let i,r,s,a=Math.floor(6*t),o=6*t-a,l=n*(1-e),c=n*(1-o*e),h=n*(1-(1-o)*e);switch(a%6){case 0:i=n,r=h,s=l;break;case 1:i=c,r=n,s=l;break;case 2:i=l,r=n,s=h;break;case 3:i=l,r=c,s=n;break;case 4:i=h,r=l,s=n;break;default:i=n,r=l,s=c}return{r:255*i,g:255*r,b:255*s}},rgbToHsv:function(t,e,n){t/=255,e/=255,n/=255;let i,r=Math.max(t,e,n),s=Math.min(t,e,n),a=r,o=r-s,l=0==r?0:o/r;if(r==s)i=0;else{switch(r){case t:i=(e-n)/o+(e<n?6:0);break;case e:i=(n-t)/o+2;break;default:i=(t-e)/o+4}i/=6}return{h:i,s:l,v:a}},hexToRgb:function(t){return{r:(t=Math.floor(t))>>16&255,g:t>>8&255,b:255&t}},rgbToHex:function(t,e,n){return(t<<16)+(e<<8)+n},rgbToHexString:function(t,e,n){return"#"+[t=Math.round(t),e=Math.round(e),n=Math.round(n)].map((t=>t.toString(16).padStart(2,"0"))).join("").toUpperCase()},hexStringToRgb:function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((t,e,n,i)=>String(e+e+n+n+i+i)));let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}};function XU(t){return{all:t=t||new Map,on:function(e,n){var i=t.get(e);i?i.push(n):t.set(e,[n])},off:function(e,n){var i=t.get(e);i&&(n?i.splice(i.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var i=t.get(e);i&&i.slice().map((function(t){t(n)})),(i=t.get("*"))&&i.slice().map((function(t){t(e,n)}))}}}var $U=class{constructor(t,e,n){this.id=t,this.userAPI=e,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise((t=>t())),this.emitter=XU(),this._innerCallUserAPI=async t=>{this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await async function(t,e,n=new AbortController){let i,r,s=t.url,a=t.proxy?.enabled??!1;if("OpenAI"===t.integration?.type){let n=KU(""===t.integration.prompt?[]:JSON.parse(t.integration.prompt),e),i=""===t.integration.behavior?[]:KU(JSON.parse(t.integration.behavior),e);r=`{\n\t\t"model": "${t.integration.model}",\n\t\t"messages": [${t.integration.useBehavior?`\n\t\t{\n\t\t\t"role": "system",\n\t\t\t"content": "${i}"\n\t\t},`:""}\n\t\t{\n\t\t\t"role": "user",\n\t\t\t"content": "${n}"\n\t\t}\n\t\t]\n\t}`}if(a){let n;s=`https://apis.spline.design/file/${t.proxy.fileId}/external-api/request?uuidexternalapi=${t.proxy.proxyId}`,void 0!==r?n=r:"POST"===t.method&&t.body&&(n=KU(JSON.parse(t.body),e)),void 0!==n&&(s+=`&data=${encodeURIComponent(n.replace(/(\r\n|\n|\r|\t)/gm,""))}`)}else"OpenAI"===t.integration?.type?i=r:"POST"===t.method&&t.body&&(i=KU(JSON.parse(t.body),e));let o=await fetch(s,{method:a?"GET":t.method,headers:a?void 0:YU(t),signal:n.signal,body:i});if(!o.ok)throw new Error("status:"+o.status+"_:_"+o.statusText);if("OpenAI"===t.integration?.type){let t=await o.json();return a&&(t=t.response),{content:t.choices[0].message.content}}{let t=await o.json();return a&&(t=t.response),t}}(this.userAPI,t),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(t){let e=t.message?.split("_:_")?.[0]?.replace("status:","")??"null";this.error=e,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0},"OpenAI"===e?.integration?.type?this.result={content:""}:"GET"===e.method&&""!==e.url&&(this.prefetchPromise=this.prefetch(n)),this._debouncedCallUserAPI=this._innerCallUserAPI,this._updateDebouncedCallUserAPI(),this._debouncedPrefetch=qP(this.prefetch,1e3,{trailing:!0})}_updateDebouncedCallUserAPI(){this._debouncedCallUserAPI=void 0!==this.userAPI.debounce&&this.userAPI.debounce>0?qP(this._innerCallUserAPI,this.userAPI.debounce,{leading:!0,trailing:!0}):this._innerCallUserAPI}async prefetch(t){await this.callUserAPI(t)}async callUserAPI(t){await this._debouncedCallUserAPI(t)}update(t,e,n=!0){this.userAPI=t,this._updateDebouncedCallUserAPI(),""!==this.userAPI.url&&"GET"===this.userAPI.method&&n&&this._debouncedPrefetch(e)}retrieveValue(t){if(this.result)try{return jR.zoom(this.result,t)}catch(t){console.error(t)}}retrieveZoomedKeyValues(t){if(this.result){let e=t&&t.length?jR.zoom(this.result,t):this.result;if(function(t){return"object"==typeof t&&null!==t}(e))return Object.entries(e);if(function(t){return Array.isArray(t)}(e))return e.map(((t,e)=>[e.toString(),t]));throw function(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||null===t}(e)?new Error("This path points to a value, use retrieveValue() instead. "+t?.join(".")):new Error("Path error"+t?.join("."))}}dispose(){}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}get autostart(){return this.userAPI.autoStart}};function YU(t){let e=new Headers;return t.headers.forEach((t=>{""!==t.data.key&&e.append(t.data.key,t.data.value)})),e}var ZU=(t,e)=>{if("string"==typeof t){let n=e.getVariable(t);if(n)return ZU(n,e)}return eI.isBoolean(t)?eI.getDisplayedValue(t).toLowerCase():eI.getDisplayedValue(t)},KU=(t,e)=>t.map(((t,n)=>{if("text"in t)return t.text;if("type"in t){if("paragraph"===t.type)return(n>0?"\n":"")+KU(t.children,e);if("variable"===t.type){let n=e.getVariable(t.variableId);if(void 0!==n)return ZU(n,e)}}return""})).join(""),JU=new Mg,QU=new Mg;var tk=class extends Nv{constructor(t){super(),this.type="PathExtrusionGeometry",this.inputs=t,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&1===this.inputs.parameters.extrusion.depth}_isOpenEnded(){let t=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&1===t.depth&&function(t,e){let n=2*Math.PI;return(t%n+n)%n==(e%n+n)%n}(t.twist,0)&&t.startScale===t.endScale)}build(){let t=this._extractPathPoints();if(t.length<2)return;let e=this._computeBasisMatrices(t),{depth:n,offset:i}=this.inputs.parameters.extrusion;n=Math.max(0,Math.min(n,1)),i=Math.max(0,Math.min(i,1));let r=this.inputs.path.isClosed?t.length:t.length-1,s=Math.floor(i*r),a=this.inputs.path.isClosed?Math.ceil((n+i)*r):Math.ceil(Math.min(1,n+i)*r),o=Math.min(Math.max(2,a-s+1),r+2),l=[],c=[];for(let n=0;n<o;n++){let i=this.inputs.path.isClosed?(n+s)%t.length:Math.min(n+s,t.length-1);l.push(t[i].clone()),c.push(e[i].clone())}let h=(t,e,n)=>{l[t]=l[t].clone().lerp(l[e],n),c[t]=function(t,e,n){let i=[new $m,new $m,new $m],r=[new $m,new $m,new $m];return t.extractBasis(i[0],i[1],i[2]),e.extractBasis(r[0],r[1],r[2]),i.forEach(((t,e)=>{let i=r[e],s=vm.lerp(t.length(),i.length(),n);t.lerp(i,n).setLength(s)})),(new Mg).makeBasis(i[0],i[1],i[2])}(c[t],c[e],n)},u=0,d=i*r%1;(!this.inputs.path.isClosed||n<=1)&&(d||0===i)&&(u=d,h(0,1,u));let p=0,f=(i+n)*r%1;if((this.inputs.path.isClosed&&n<=1||!this.inputs.path.isClosed&&i+n<1)&&f&&(p=f,h(l.length-1,l.length-2,1-p)),0===n){let t=l.length-1;l[t].copy(l[0]),c[t].copy(c[0])}this._applyPathModifiers(c,u,p);let{bevel:m,bevelSides:g}=this.inputs.parameters.extrusion,v=m>0?this.inputs.parameters.extrusion.capType:"flat",y=5;"Custom"===this.inputs.parameters.extrusion.shape.type&&(y="low"===this.inputs.parameters.extrusion.shape.shapeQuality?5:12);let x,{regions:b,infos:_,vertices:w}=this._computeShapePoints(y),S=0;"round"===v&&(x=new iU(this.inputs.shapeData,2*m,m,y,g,void 0,!0),S=x.getAttribute("position").count);let M=0,T=0;_.sort(((t,e)=>t.start-e.start)),_.forEach((t=>{t.verticesStart=M,t.verticesCount=t.continuous.reduce(((t,e,n)=>t+(0!==n&&e?1:2)),0),T+=t.verticesCount,M=T}));let E,A=T*o,C=0;if(this._isOpenEnded()&&"flat"===v){try{E=qN({windingRule:yN.ODD,elementType:xN.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:b})}catch{E=eU}C=E.vertexCount}let P=A+2*C+2*S,R=A+2*C,O={positions:new Float32Array(3*P),normals:new Float32Array(3*P),uvs:new Float32Array(2*P)},D=[];if(_.forEach((t=>{this._extrudeRegion(t,w,c,l,O,D,this._isGeometryClosed()&&!this._isOpenEnded())})),E&&(this._closeEnd(E,A,D,O,c[0],l[0],!1),this._closeEnd(E,A+C,D,O,c[c.length-1],l[l.length-1],!0)),x){O.positions.set(x.getAttribute("position").array,3*R),O.normals.set(x.getAttribute("normal").array,3*R),O.uvs.set(x.getAttribute("uv").array,2*R);for(let t=R;t<R+S;t++)O.uvs[2*t+1]=1e-4;let t=D.length;D.push(...x.getIndex().array.map((t=>t+R))),R+=S,O.positions.set(x.getAttribute("position").array,3*R),O.normals.set(x.getAttribute("normal").array,3*R),O.uvs.set(x.getAttribute("uv").array,2*R);let e=D.length;D.push(...x.getIndex().array.map((t=>t+R))),this.setAttribute("position",new Tv(O.positions,3)),this.setAttribute("normal",new Tv(O.normals,3)),this.setAttribute("uv",new Tv(O.uvs,2)),this.setIndex(D);let n=JU;n.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(n,R,P),n.copy(c[0]).setPosition(l[0]).multiply(QU.makeScale(1,1,-1)),this.applyMatrix4OnRange(n,R-S,R),this.reverseIndicesOnRange(t,e)}else this.setAttribute("position",new Tv(O.positions,3)),this.setAttribute("normal",new Tv(O.normals,3)),this.setAttribute("uv",new Tv(O.uvs,2)),this.setIndex(D)}_extractPathPoints(){let t=Oz(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(t.length<2)return[];let e=[t[0]];return t.forEach((t=>{e[e.length-1].distanceToSquared(t)>.001&&e.push(t)})),this.inputs.path.isClosed&&e[e.length-1].distanceTo(e[0])<.001&&e.pop(),e}_computeBasisMatrices(t){let e=[],n=t.length,i=this.inputs.path.isClosed,r=new $m,s=new $m,a=new $m,o=new $m,l=new $m(0,1,0);for(let c=0;c<n;c++){let h,u,d=t[c];h=0===c?i?t[t.length-2]:d.clone().multiplyScalar(2).sub(t[1]):t[c-1],u=c===n-1?i?t[1]:d.clone().multiplyScalar(2).sub(t[c-1]):t[c+1];let p=d.clone().sub(h).normalize(),f=u.clone().sub(d).normalize(),m=p.clone().add(f).normalize();a.copy(m),0===c&&(m.equals(l)||m.clone().negate().equals(l))&&l.set(0,0,1);let g=l.clone().cross(m).normalize(),v=m.clone().cross(g).normalize();l.copy(v),o.copy(g),0===c&&(r.copy(v),s.copy(m));let y=(new Mg).makeBasis(g,v,m);e.push(y)}let c=i?s:a,h=i?r:new $m(0,1,0),u=c.clone().cross(o).normalize(),d=Math.acos(h.dot(u));if(isNaN(d))return e;let p=h.clone().cross(u);c.dot(p)>0&&(d*=-1);for(let t=1;t<e.length;t++){let n=(new Mg).makeRotationZ(d*t/e.length);e[t].multiply(n)}return e}_applyPathModifiers(t,e,n){let i=t.length,{angle:r,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new Mg,c=new Mg;return t.forEach(((t,h)=>{let u=0===h?0:h===i-1?1:(h-e)/(i-(0===n?0:1)-(e+(1-n)));l.makeRotationZ(vm.lerp(r,r+s,u)*vm.DEG2RAD);let d=vm.lerp(a,o,u);c.makeScale(d,d,d),t.multiply(l).multiply(c)})),t}_computeShapePoints(t=12,e=yN.ODD){let n,i,r=this.inputs.shapeData,s=r.extractShapePointsToFlatArray([],t),a=r.shapeHoles.map((e=>{let n=e.extractShapePointsToFlatArray([],t),i=[];for(let t=n.length-1;t>=1;t-=2){let e=n[t-1],r=n[t-0];i.push(e,r)}return i}));try{n=qN({windingRule:e,elementType:xN.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[s]})}catch{n=QN}try{i=qN({windingRule:yN.ODD,elementType:xN.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...a]})}catch{i=tU}if(!n)throw new Error("error generating geometry");let o=n.elementCount;if(i){n.elementCount+=i.elementCount;for(let t=0;t<i.elements.length;t++){let e=i.elements[t],r=t%2==0?n.vertexCount:0;n.elements.push(e+r)}for(let t=0;t<i.vertexIndices.length;t++){let e=i.vertexIndices[t],r=n.vertexCount;n.vertexIndices.push(e+r)}for(let t=0;t<i.vertices.length;t++){let e=i.vertices[t];n.vertices.push(e)}}let l=1/0,c=-1/0,h=1/0,u=-1/0;for(let t=0,e=n.vertexCount;t<e;t++){let e=2*t,i=n.vertices[e+0],r=n.vertices[e+1];i<l&&(l=i),i>c&&(c=i),r<h&&(h=r),r>u&&(u=r)}let d=[];for(let t=n.elementCount-1;t>=0;t--){let e=t>=o,i=2*t,s=n.elements[i+0],a=n.elements[i+1],l=s+a,c={start:s,count:a,normals:[],isHole:e,continuous:[],verticesStart:0,verticesCount:0};d.push(c);let h=s,u=l-1,p=s+1,f=r.roundedCurves.length;do{let t=h-s,i=n.vertices[2*u+0],o=n.vertices[2*u+1],d=n.vertices[2*h+0],m=n.vertices[2*h+1],g=n.vertices[2*p+0],v=n.vertices[2*p+1],y=d-i,x=m-o,b=Math.sqrt(y*y+x*x);y/=b,x/=b;let _=d-g,w=m-v,S=Math.sqrt(_*_+w*w);_/=S,w/=S,c.normals[2*t+0]=-w,c.normals[2*t+1]=_;let M=n.vertexIndices[h];if(Array.isArray(M))c.continuous[t]=!1;else{let[e,n]=r.getCurveIndexFromVertexId(M-1,!0);if(n>0&&n<1)c.continuous[t]=!0;else{let i=1===n?e+1:e-1;i=(i+f)%f;let s=1===n?0:1,a=r.roundedCurves[e].getTangent(n),o=r.roundedCurves[i].getTangent(s);c.continuous[t]=a.dot(o)>.95}}e&&(c.normals[2*t+0]*=-1,c.normals[2*t+1]*=-1),[u,h,p]=[h,p,p+1],p>=l&&(p-=a)}while(p!==s+1)}return{regions:[s,...a],infos:d,vertices:n.vertices}}_insertVertex(t,e,n,i,r){let s=2*e,a=3*e;t.positions[a+0]=n.x,t.positions[a+1]=n.y,t.positions[a+2]=n.z,t.normals[a+0]=i.x,t.normals[a+1]=i.y,t.normals[a+2]=i.z,t.uvs[s+0]=r.x,t.uvs[s+1]=r.y}_extrudeRegion(t,e,n,i,r,s,a){let o=new $m,l=new $m,c=new $m,h=new $m,u=new ym;n.forEach(((s,a)=>{let d=i[a],p=t.verticesStart*n.length+t.verticesCount*a;for(let i=0;i<t.count;i++){let f=2*(t.start+i);if(o.set(e[f+0],e[f+1],0),c.copy(o).applyMatrix4(s).add(d),t.continuous[i])h.set(t.normals[2*i+0],t.normals[2*i+1],0);else{let n=0===i?2*(t.start+t.count-1):f-2;l.set(e[n+0],e[n+1],0),h.copy(o).sub(l),h.set(-h.y,h.x,0),t.isHole||h.negate()}if(h.applyMatrix4(s).normalize(),u.set(0===i?1:i/t.count,a/(n.length-1)),this._insertVertex(r,p,c,h,u),p++,!t.continuous[i]||0===i){if(0===i)h.set(t.normals[2*i+0],t.normals[2*i+1],0),u.set(0,a/(n.length-1));else{let n=i===t.count-1?2*t.start:f+2;l.set(e[n+0],e[n+1],0),h.copy(l).sub(o),h.set(-h.y,h.x,0),t.isHole||h.negate()}h.applyMatrix4(s).normalize(),this._insertVertex(r,p,c,h,u),p++}}}));let d=n.length-1;for(let e=0;e<d;e++){let i=t.verticesStart*n.length+t.verticesCount*e,r=t.verticesStart*n.length+t.verticesCount*(e+1),a=0;for(let e=0;e<t.count;e++){(!t.continuous[e]||0===e)&&a++;let n=e===t.count-1?0:a+1,o=i+a,l=i+n,c=r+n,h=r+a;t.isHole?s.push(o,c,l,o,h,c):s.push(o,l,c,o,c,h),a++}}}_closeEnd(t,e,n,i,r,s,a){let o=t.vertexCount,l=new $m(0,0,a?-1:1).applyMatrix4(r),c=new $m,h=new ym;for(let n=0;n<o;n++){let a=2*n;c.set(t.vertices[a+0],t.vertices[a+1],0).applyMatrix4(r).add(s),this._insertVertex(i,e+n,c,l,h)}let u=t.elements;for(let i=0;i<t.elementCount;i++){let t=3*i,r=u[t+0]+e,s=u[t+(a?1:2)]+e,o=u[t+(a?2:1)]+e;n.push(r,s,o)}}applyMatrix4OnRange(t,e,n){let i,r,s,a,o=t.elements,l=(new xm).getNormalMatrix(t).elements,c=this.attributes.position,h=this.attributes.normal;if(!c||!h)return;let u=c.array,d=h.array,p=c.itemSize;for(let t=e*p,c=n*p;t<c;t+=p)i=u[t+0],r=u[t+1],s=u[t+2],a=1/(o[3]*i+o[7]*r+o[11]*s+o[15]),u[t+0]=(o[0]*i+o[4]*r+o[8]*s+o[12])*a,u[t+1]=(o[1]*i+o[5]*r+o[9]*s+o[13])*a,u[t+2]=(o[2]*i+o[6]*r+o[10]*s+o[14])*a,i=d[t+0],r=d[t+1],s=d[t+2],d[t+0]=l[0]*i+l[3]*r+l[6]*s,d[t+1]=l[1]*i+l[4]*r+l[7]*s,d[t+2]=l[2]*i+l[5]*r+l[8]*s;c.needsUpdate=!0,h.needsUpdate=!0}reverseIndicesOnRange(t,e){let n=this.index;if(n){for(let i=t;i<e;i+=3){let t=n.getX(i),e=n.getX(i+1),r=n.getX(i+2);n.setXYZ(i,r,e,t)}n.needsUpdate=!0}}};function ek(){let t=new Nv;return t.setAttribute("position",new Tv(new Float32Array([]),3)),t.setIndex(new Tv(new Uint16Array([]),1)),t}var nk=ek().attributes,ik=class extends Nv{constructor(t,e){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,nk),this.userData={parameters:t,type:"TextGeometry"};let n=e.getFont(t.font);n?.isLoaded?(this.font=n,this.update(t)):this.updateFont(t.font,e).then((()=>{this.update(t),e?.requestRender()}))}async updateFont(t,e){let n=e.getFont(t);n&&(this.font=n,await n.loadingPromise)}update(t){let e=this.font;if(this.userData={parameters:t,type:"TextGeometry"},!e?.isLoaded)return void console.warn("Cannot update text because its font is not loaded");let{width:n,height:i,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o,text:l,textTransform:c}=t,h=eI.getDisplayedValue(l),u=function(t,e,n){let i=[""],r="";for(let s of n)r+=s," "===s||"\n"===s?(i[i.length-1]+=r,r="","\n"===s&&i.push("")):e.getTextWidth(i[i.length-1]+r,t)>t.width&&(i[i.length-1].length&&i.push(""),e.getTextWidth(i[i.length-1]+r,t)>t.width&&(1===r.length?(i[i.length-1]+=r,r=""):(i[i.length-1]+=r.slice(0,-1),r=r[r.length-1],i.push(""))));return i[i.length-1]+=r,i}(t,e,2===c?h.toUpperCase():3===c?h.toLowerCase():h),{shapes:d,charWidths:p,charCoords:f}=e.generateShapes(u,t),m=.5*("number"==typeof n?n:1),g=.5*("number"==typeof i?i:1),v=d.map((t=>(new EN).fromShape(t,!0)));this.vectorShapes=v;let y=v.map((t=>aU.create({shape:t,parameters:{depth:s,extrudeBevelSegments:o,extrudeBevelSize:a,windingRule:s<=0?yN.NONZERO:yN.ODD,subdivisions:this.isLowResolution&&s>0?1:12}}))),x=y.length?(0,r.mergeBufferGeometries)(y):ek();x.translate(-m,g,0),this.dispose(),this.wrappedText=u,this.charCoords=f,this.charWidths=p,this.deleteAttribute("extrudeNormal"),Object.entries(x.attributes).forEach((([t,e])=>{this.setAttribute(t,e)})),this.setIndex(x.index),this.computeBoundingSphere()}clone(){let t=eT(new Nv,ik.prototype);return t.copy(this),console.log("CloneGeometry",this,t),t}copy(t){return Object.entries(t.attributes).forEach((([t,e])=>{this.setAttribute(t,e)})),this.setIndex(t.index),this.userData={parameters:{...t.userData.parameters},type:"TextGeometry"},this}async setText(t){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:{textValue:t}})}get text(){return this.userData.parameters.text??""}};var rk,sk,ak=new Promise((t=>{rk=t})),ok=!1;function lk(){if(!ok)return sk||(sk=async function(){let t=n.e(859).then(n.bind(n,"../node_modules/@splinetool/loader/build/process.js")),[e,i]=await Promise.all([t,fetch("https://unpkg.com/@splinetool/modelling-wasm@1.9.69/build/process.wasm").then((t=>t.arrayBuffer()))]),r=e.default,s=await r({wasmBinary:i});rk(s),ok=!0}(),sk)}var ck=["font"];function hk(t,e,n,i){let r,s,a;"PathGeometry"===t.type?(s=JSON.parse(JSON.stringify(t)),a=[[],["extrusion"]]):(s={...t},a=[[]]);for(let t of a){let n=s;for(let e of t)n=n[e];for(r in n){let s=n[r];qD(s)&&!ck.includes(r)&&(n[r]=e.getVariable(s,[i.uuid,"geometry",...t,r]),qD(n[r])&&(n[r]=1))}}let o,l={parameters:s,type:s.type};if("PathGeometry"===s.type)l.path=s.path;else if("VectorGeometry"===s.type){let t=EN.createFromState(s.shape,s.width,s.height);l.shape=t}else if("NonParametricGeometry"===s.type){if(s.data.groups&&s.data.groups?.forEach((t=>t.materialIndex=Math.max(t.materialIndex??0,0))),l.geometry=(new FS).parse(s),0===l.geometry.groups.length){let t=l.geometry;t.addGroup(0,Math.max(t.getIndex()?.count??0,t.getAttribute("position").count),0)}}else{if("SubdivGeometry"===s.type){let e=new xk(s,n);return e.data=t,e}if("TextGeometry"===s.type)return new ik(s,e);if("InputGeometry"===s.type)return new ik(s,e);if("UIGeometry"===s.type)return HU.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}try{o=Fk(l)}catch(t){console.error(t)}if(!o){let t=EN.createFromState(dL.defaultData(),100,100);l.shape=t,o=Fk(l)}return o}var uk=new Mg;function dk(t,e,n,i){let r,s,a,o=t.position.array,l=t.normal.array,c=uk.makeScale(e,n,i).invert().elements;for(var h=0,u=o.length;h<u;h+=3)o[h]*=e,o[h+1]*=n,o[h+2]*=i,r=l[h],s=l[h+1],a=l[h+2],l[h]=c[0]*r+c[4]*s+c[8]*a,l[h+1]=c[1]*r+c[5]*s+c[9]*a,l[h+2]=c[2]*r+c[6]*s+c[10]*a;t.position.needsUpdate=!0,t.normal.needsUpdate=!0}var pk,fk=new Km,mk=new $m;ak.then((t=>{pk=t}));var gk=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),vk=new Uint32Array([0,1,2,3]),yk=new Uint8Array([4]),xk=class extends Nv{constructor(t,e){super(),this.data=t,this.flatShading=e,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(t,e){this.freeSubdivPointer();let n=this.data.scaleBaked,i=MD.div(e,n);this.subdividedGeometry&&dk(this.subdividedGeometry.attributes,...i),this.originalGeometry&&dk(this.originalGeometry.attributes,...i),this.data=t;let r=this.userData.parameters;this.userData.parameters={width:r.width*i[0],height:r.height*i[1],depth:r.depth*i[2]},this.originalGeometry.boundingSphere.center.multiply(mk.fromArray(i));let s=mk.set(r.width,r.height,r.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return 0===this.subdivPointer&&this.rebuild(),this.subdivPointer}rebuild(){let t,e,n;try{({originalGeometry:t,subdividedGeometry:e,subdivPointer:n}=xk.build(this.data,void 0,!this.flatShading,void 0))}catch{t=new ny(100,100,100),n=0}this.subdivPointer=n,this.originalGeometry=t,this.subdividedGeometry=e??void 0;let i=this.subdividedGeometry??this.originalGeometry;Object.assign(this,i),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(xk.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let t=this.originalGeometry;null===t.boundingSphere&&(t.boundingSphere=new mg,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=t.boundingSphere));let e=t.attributes.position,n=t.boundingSphere.center;fk.setFromBufferAttribute(e),fk.getCenter(n),t.boundingSphere.radius=n.distanceTo(fk.max),isNaN(t.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),fk.getSize(mk);let i={width:mk.x,height:mk.y,depth:mk.z};return this.userData.parameters=i,i}static build(t,e,n,i){let r,s,a,o=t?.phongAngle??35;!1===n&&(o=-1),e&&(pk.free_bvh(e),pk.free_subdivision_surface(e));try{r=xk.allocate(t,i)}catch(e){console.error(e,t),r=xk.allocate({positionWASM:gk,indexWASM:vk,verticesPerFaceWASM:yk},i)}if(pk.set_destination_refinement_level(r,0),s=xk.buildLevel(r,!0,o),t.subdivisions>0)try{pk.set_destination_refinement_level(r,t.subdivisions),a=xk.buildLevel(r,!1,o)}catch{try{pk.set_destination_refinement_level(r,t.subdivisions-1),a=xk.buildLevel(r,!1,o)}catch{a=null}}else a=null;return{subdivPointer:r,originalGeometry:s,subdividedGeometry:a}}static primitiveToQuads(t,e,n){t.widthSegments>16&&(t.widthSegments=16),t.heightSegments>16&&(t.heightSegments=16),t.depthSegments>16&&(t.depthSegments=16),t.radialSegments>16&&(t.radialSegments=16),"DodecahedronGeometry"===t.type&&(t.detail=0);let i,r,s,a,o,l,c=void 0!==t.shape||void 0!==t.path?e.geometry:hk(t,n,!1);if(i="TorusGeometry"===t.type&&t.arc===2*Math.PI?c.getClosedTorusIndicesForBooleanOrSubdiv():c.getIndex(),({positions:r,triIndices:o}=_k(c.getAttribute("position"),i)),"CylinderGeometry"===t.type&&0===t.cornerRadius&&0===t.hollow&&!1===t.openEnded){let e=t.radialSegments*t.heightSegments*3*2;l=[e,e+3*t.radialSegments]}return({indices:s,verticesPerFace:a}=Ek(r,o,c,l)),{positions:r,indices:s,verticesPerFace:a}}static allocate(t,e){let n,i,r,s=[],a=[];t.positionWASM&&t.positionWASM.length>0?(n=t.positionWASM,i=t.indexWASM,r=t.verticesPerFaceWASM):(n=gk,i=vk,r=yk);let o,l=n.length,c=i.length,h=r.length,u=n.length+s.length+a.length,d=i.length+r.length,p=u*Float32Array.BYTES_PER_ELEMENT+d*Uint32Array.BYTES_PER_ELEMENT,f=u*Float32Array.BYTES_PER_ELEMENT,m=(Uint32Array.BYTES_PER_ELEMENT,pk._malloc(p)),g=new Float32Array(pk.HEAPF32.buffer,m,u),v=new Uint32Array(pk.HEAPU32.buffer,m+f,d);g.set(n,0),g.set(s,n.length),g.set(a,n.length+s.length),v.set(i,0),v.set(r,i.length),t?.scaleBaked?.some((t=>1!==t))&&(o=(new Mg).makeScale(...t.scaleBaked)),e&&(o?o.premultiply(e):o=e);let y=o?pk.alloc_subdivision_surface2(m,l,m+f,c,m+f+i.length*Uint32Array.BYTES_PER_ELEMENT,h,o.elements):pk.alloc_subdivision_surface(m,l,m+f,c,m+f+i.length*Uint32Array.BYTES_PER_ELEMENT,h);return pk._free(m),y}static buildLevel(t,e,n,i,r){let s=r?pk.get_mesh_data2(t,e?pk.Level.CONTROL:pk.Level.REFINED,n,r.elements):pk.get_mesh_data(t,e?pk.Level.CONTROL:pk.Level.REFINED,n),a=pk.HEAPU32.subarray(s>>2,8+(s>>2)),o=a.subarray(4,8),l=0,c=pk.HEAPU32[a[l]>>2],h=pk.HEAPF32.subarray(c>>2,(c>>2)+o[l]);l++;let u=pk.HEAPU32[a[l]>>2],d=pk.HEAPF32.subarray(u>>2,(u>>2)+o[l]);l++;let p=pk.HEAPU32[a[l]>>2],f=pk.HEAPU32.subarray(p>>2,(p>>2)+o[l]);l++;let m=pk.HEAPU32[a[l]>>2],g=pk.HEAPU32.subarray(m>>2,(m>>2)+o[l]);if(l++,void 0===i){let t=new Nv;if(t.setIndex(new Av(g,1)),t.setAttribute("position",new Cv(h,3)),t.setAttribute("normal",new Cv(d,3)),e){t.setAttribute("faceMap",new Av(f,1));let e=new Float32Array(d.length/3*4).fill(0);t.setAttribute("color",new Tv(e,4))}return pk.free_mesh_data(s),t.userData.type="SubdivGeometry",t}i.getAttribute("position").copyArray(h),i.getAttribute("normal").copyArray(d),i.attributes.position.needsUpdate=!0,i.attributes.normal.needsUpdate=!0,pk.free_mesh_data(s)}static freeSubdivPointer(t){pk.free_bvh(t),pk.free_subdivision_surface(t)}static buildControlCageWireframe(t,e,n){let i=pk.get_wireframe_data_for_base_level(t),r=pk.HEAPU32.subarray(i>>2,4+(i>>2)),s=r.subarray(2,4),a=0,o=pk.HEAPU32[r[a]>>2],l=pk.HEAPF32.subarray(o>>2,(o>>2)+s[a]);a++;let c=pk.HEAPU32[r[a]>>2],h=pk.HEAPU32.subarray(c>>2,(c>>2)+s[a]);if(void 0===e){let t=new Nv;t.setAttribute("position",new Cv(l,3));let e=new Float32Array(l.length);for(let t=0,i=l.length;t<i;)e[t++]=n.r,e[t++]=n.g,e[t++]=n.b;return t.setAttribute("color",new Tv(e,3)),t.setIndex(new Av(h,1)),pk.free_wireframe_data_for_base_level(i),t}e.getAttribute("position").copyArray(l),e.attributes.position.needsUpdate=!0,pk.free_wireframe_data_for_base_level(i)}static updateCollabMesh(t,e,n){let i=0===e;i||pk.set_destination_refinement_level(t,e);let r=n?pk.get_topological_data2(t,i?pk.Level.CONTROL:pk.Level.REFINED,n.elements):pk.get_topological_data(t,i?pk.Level.CONTROL:pk.Level.REFINED),s=pk.HEAPU32.subarray(r>>2,6+(r>>2)),a=s.subarray(3,6),o=0,l=pk.HEAPU32[s[o]>>2],c=new Float32Array(pk.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let h=pk.HEAPU32[s[o]>>2],u=new Uint32Array(pk.HEAPU32.subarray(h>>2,(h>>2)+a[o]));o++;let d=pk.HEAPU32[s[o]>>2],p=new Uint8Array(pk.HEAPU32.subarray(d>>2,(d>>2)+a[o]));return pk.free_topological_data(r),{positions:c,indices:u,verticesPerFace:p}}},bk=["getX","getY","getZ"];function _k(t,e){let n={},i=e?e.count:t.count,r=0,s=[],a=[];for(let o=0;o<i;o++){let i=e?e.getX(o):o,l="";for(let e=0;e<3;e++)l+=~~(1e4*t[bk[e]](i))+",";if(l in n)s.push(n[l]);else{for(let e=0;e<3;e++)a.push(t[bk[e]](i));n[l]=r,s.push(r),r++}}let o=[];for(let t=0;t<s.length;t+=3)s[t]===s[t+1]||s[t]===s[t+2]||s[t+1]===s[t+2]||o.push(s[t],s[t+1],s[t+2]);return{positions:a,triIndices:o}}var wk=new $m,Sk=new $m,Mk=new $m,Tk=new $m;function Ek(t,e,n,i){let r=[],s=[];if(void 0!==n.userData.shape&&0===n.userData.parameters.depth&&0===n.userData.shape.shapeHoles.length){let e=n.userData.shape.extractShapePointsToFlatArray([]),i=n.userData.parameters.spikes;if("EllipseGeometry"===n.userData.type&&i<=24&&i%4==0&&n.userData.parameters.angle>=360){let t=e.length/2/i;e=e.filter(((e,n)=>Math.floor(n/2)%t==0))}let a=0;for(let t=0;t<e.length;t+=2)a+=(e[t]-e[(0===t?e.length:t)-2])*(e[t+1]+e[(0===t?e.length:t)-1]);t.length=0;let o=0;if(a<0)for(let n=0;n<e.length;n+=2)t.push(e[n],e[n+1],0),r.push(o++);else for(let n=e.length-2;n>=0;n-=2)t.push(e[n],e[n+1],0),r.push(o++);return s.push(o),{indices:r,verticesPerFace:s}}let a=new Float32Array([n.userData.parameters.depth])[0],o=0;for(;o<e.length;){if(n.useNgonForTopBottomFaceDuringBake){let n=0;if((t[3*e[o]+2]===a||0===t[3*e[o]+2])&&n++,(t[3*e[o+1]+2]===a||0===t[3*e[o+1]+2])&&n++,(t[3*e[o+2]+2]===a||0===t[3*e[o+2]+2])&&n++,3===n)break}if(e[o+1]===e[o+3]&&e[o+2]===e[o+5]||e[o+0]===e[o+3]&&e[o+2]===e[o+4]){wk.set(t[3*e[o]],t[3*e[o]+1],t[3*e[o]+2]),Sk.set(t[3*e[o+1]],t[3*e[o+1]+1],t[3*e[o+1]+2]),Mk.set(t[3*e[o+4]],t[3*e[o+4]+1],t[3*e[o+4]+2]),Tk.set(t[3*e[o+5]],t[3*e[o+5]+1],t[3*e[o+5]+2]),Sk.sub(wk).normalize(),Mk.sub(wk).normalize(),Tk.sub(wk).normalize();let n=Sk.cross(Mk).dot(Tk);Math.abs(n)>.005||i&&i.some(((t,e)=>e%2!=1&&(o>=i[e]&&o<i[e+1])))?(r.push(e[o],e[o+1],e[o+2]),s.push(3),o+=3):(r.push(e[o],e[o+1],e[o+4],e[o+5]),s.push(4),o+=6)}else r.push(e[o],e[o+1],e[o+2]),s.push(3),o+=3}if(n.useNgonForTopBottomFaceDuringBake){let e=[],i=[],o=0;for(let n=0,r=0;n<t.length;n+=3,r++)0===t[n+2]&&(e.push(r),o++),t[n+2]===a&&i.push(r);if(0===n.userData.parameters.extrudeBevelSize){let t=i[0];i[0]=i[1],i[1]=t}e.reverse(),r.push(...e,...i),s.push(o,o)}return{indices:r,verticesPerFace:s}}var Ak={};((t,e)=>{for(var n in e)VM(t,n,{get:e[n],enumerable:!0})})(Ak,{calcBoolean:()=>Ik,calcBooleanTopological:()=>Lk,freeMeshSet:()=>kk,getMeshSet:()=>zk,hasOpenEdges:()=>Nk,transformMeshSet:()=>Uk});var Ck,Pk,Rk=new Promise((t=>{t}));function Ok(t){let e=t.length,n=e*Uint32Array.BYTES_PER_ELEMENT,i=e*Float32Array.BYTES_PER_ELEMENT,r=Number.isInteger(t[0])?n:i,s=Ck._malloc(r);return(Number.isInteger(t[0])?new Uint32Array(Ck.HEAPU32.buffer,s,e):new Float32Array(Ck.HEAPF32.buffer,s,e)).set(t,0),s}function Dk(t){switch(t){case 0:return Ck.OP.UNION;case 1:return Ck.OP.INTERSECTION;case 2:return Ck.OP.A_MINUS_B;default:throw new Error("Unknown boolean operation "+t)}}function Lk(t,e){void 0===Pk&&(Pk=Ck.init_csg());let n=Ok(t),i=Ck.csg_calc_topological(Pk,n,t.length,Dk(e));Ck._free(n);let r=Ck.HEAPU32.subarray(i>>2,6+(i>>2)),s=r.subarray(3,6),a=0,o=Ck.HEAPU32[r[a]>>2],l=new Float32Array(Ck.HEAPF32.subarray(o>>2,(o>>2)+s[a]));a++;let c=Ck.HEAPU32[r[a]>>2],h=new Uint32Array(Ck.HEAPU32.subarray(c>>2,(c>>2)+s[a]));a++;let u=Ck.HEAPU32[r[a]>>2],d=new Uint8Array(Ck.HEAPU32.subarray(u>>2,(u>>2)+s[a]));return Ck.free_mesh_data(i),{positions:l,indices:h,verticesPerFace:d}}function Ik(t,e,n,i){void 0===Pk&&(Pk=Ck.init_csg());let r=Ok(t),s=Ck.csg_calc(Pk,r,t.length,i,Dk(e));Ck._free(r);let a=Ck.HEAPU32.subarray(s>>2,5+(s>>2)),o=a.subarray(2,5),l=0,c=Ck.HEAPU32[a[l]>>2],h=Ck.HEAPF32.subarray(c>>2,(c>>2)+o[l]);l++;let u=Ck.HEAPU32[a[l]>>2],d=Ck.HEAPF32.subarray(u>>2,(u>>2)+o[l]);l++;let p=o[l];n.setAttribute("position",new Cv(h,3)),n.setAttribute("normal",new Cv(d,3));let f=Ck.HEAPF32.subarray(5+(s>>2),5+(s>>2)+6);return null===n.boundingSphere&&(n.boundingSphere=new mg),n.boundingSphere.center.set(f[0],f[1],f[2]),n.boundingSphere.radius=(f[3]**2+f[4]**2+f[5]**2)**.5,n.userData.parameters={width:2*f[3],height:2*f[4],depth:2*f[5]},Ck.free_mesh_data(s),p}function zk(t,e,n){if(void 0===Ck)return-1;let i,r,s;if(e&&void 0!==t.userData.positions){let e=t.userData;s=e.verticesPerFace.length,i=e.positions,r=Array(e.verticesPerFace.reduce(((t,e)=>t+e),0)+s);for(let t=0,n=0,i=0;t<e.verticesPerFace.length;t++){r[i++]=e.verticesPerFace[t];for(let s=0;s<e.verticesPerFace[t];s++)r[i++]=e.indices[n++]}}else({positions:i,faceIndices:r,nFaces:s}=function(t,e,n){let i,r;r="TorusGeometry"===t.userData.parameters.type&&t.userData.parameters.arc===2*Math.PI?t.getClosedTorusIndicesForBooleanOrSubdiv():t.getIndex();let s,{positions:a,triIndices:o}=_k(t.getAttribute("position"),r);if(e&&n){let{indices:e,verticesPerFace:n}=Ek(a,o,t);s=n.length,i=[];for(let t=0,r=0;t<s;t++){i.push(n[t]);for(let s=0;s<n[t];s++)i.push(e[r++])}}else{let t=o.length;i=Array(t+t/3),s=0;for(let t=0,e=0;e<i.length;)i[e++]=3,s++,i[e++]=o[t++],i[e++]=o[t++],i[e++]=o[t++]}return{positions:a,faceIndices:i,nFaces:s}}(t,e,n));let a=i.length,o=r.length,l=i.length,c=r.length,h=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,u=l*Float32Array.BYTES_PER_ELEMENT,d=(Uint32Array.BYTES_PER_ELEMENT,Ck._malloc(h)),p=new Float32Array(Ck.HEAPF32.buffer,d,l),f=new Uint32Array(Ck.HEAPU32.buffer,d+u,c);p.set(i,0),f.set(r,0);let m=Ck.get_csg_mesh(d,a,d+u,o,s);return Ck._free(d),m}function Nk(t){return Ck.has_open_edges(t)}function Uk(t,e){Ck.transform_csg_mesh(t,e.elements)}function kk(t){Ck.free_csg_mesh(t)}Rk.then((t=>Ck=t));var Bk={ConeGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},t.parameters);return n.thetaLength=vm.clamp(n.thetaLength,0,360),{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width)})}}static build(t){let e,{width:n,depth:i,height:r,radialSegments:s,heightSegments:a,openEnded:o,thetaStart:l,thetaLength:c,cornerRadiusTop:h,cornerRadiusBottom:u,cornerSegments:d}=t.parameters;return 0===c?(e=new Nv,e.setAttribute("position",new Cv([],3))):e=h>0||u>0||c<360?new Fz(0,n/2,r,s,a,o,l,c*Math.PI/180,h,u,d,0,!0):new mw(n/2,r,s,a,o),e.scale(1,1,i/n),Object.assign(e,{userData:{...t,type:"ConeGeometry"}})}},CubeGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},t.parameters);return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width)})}}static build(t){let e,{width:n,height:i,depth:r,widthSegments:s,heightSegments:a,depthSegments:o,cornerRadius:l,cornerSegments:c}=t.parameters;return e=0===l?new ny(n,i,r,s,a,o):new jz(n,i,r,s,a,o,l,c),Object.assign(e,{userData:{...t,type:"CubeGeometry"}})}},CylinderGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=t.parameters?.radiusTop,i=t.parameters?.radiusBottom,r=Object.assign({},e?.parameters??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},t.parameters);r.thetaLength=vm.clamp(r.thetaLength,0,360);let s=r.width/2,a=r.radiusTop??s,o=r.radiusBottom??s;if(a===o?(a=s,o=s):a>o?(a=s,o=o*s/a):(a=a*s/o,o=s),r.shapeBlendNode){a=n??s,o=i??s;let t=2*Math.max(a,o);r.width=t,r.depth=t}return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(r.height??r.width),depth:Math.abs(r.depth??r.width),radiusTop:a,radiusBottom:o})}}static build(t){let e,{width:n,depth:i,height:r,radialSegments:s,heightSegments:a,openEnded:o,thetaStart:l,thetaLength:c,radiusTop:h,radiusBottom:u,cornerRadius:d,cornerSegments:p,hollow:f}=t.parameters;return 0===c?(e=new Nv,e.setAttribute("position",new Cv([],3))):e=d||f?new Fz(h,u,r,s,a,o,l,c*Math.PI/180,d,d,p,f):new fw(h,u,r,s,a,o,l,c*Math.PI/180),e.scale(1,1,i/n),Object.assign(e,{userData:{...t,type:"CylinderGeometry"}})}},DodecahedronGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,detail:0,corner:0,cornerSides:4},t.parameters);return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width)})}}static build(t){let{width:e,height:n,depth:i,detail:r,corner:s,cornerSides:a}=t.parameters,o=0===r&&0!==s?new Gz(.5*e,s,a):new vw(.5*e,r);return o.scale(1,n/e,i/e),Object.assign(o,{userData:{...t,type:"DodecahedronGeometry"}})}},EllipseGeometry:lU,HelixGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},t.parameters),i=Math.abs(n.width),r=Math.abs(n.height??i),s=Math.abs(n.depth??i),a=Math.abs(Math.min(i,s))/2;return{parameters:Object.assign(n,{width:i,height:r,depth:s,radius:a,segments:Math.round(n.segments),pathSegments:Math.round(n.pathSegments),cornerSegments:Math.round(n.cornerSegments)})}}static build(t){let{width:e,height:n,depth:i,radius:r,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:c,cornerRadius:h,cornerSegments:u}=t.parameters,d=new gU(!1,e,n,i,r,s,a,o,l,c,h,u);return Object.assign(d,{userData:{...t,type:"HelixGeometry"}})}},IcosahedronGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,detail:0,corner:0,cornerSides:4},t.parameters);return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width)})}}static build(t){let{width:e,height:n,depth:i,detail:r,corner:s,cornerSides:a}=t.parameters,o=0===r&&0!==s?new vU(.5*e,s,a):new Yw(.5*e,r);return o.scale(1,n/e,i/e),Object.assign(o,{userData:{...t,type:"IcosahedronGeometry"}})}},LatheGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){(t.parameters?.points??[]).forEach((t=>{Array.isArray(t)&&(t.x=t[0],t.y=t[1])}));let n=Object.assign({},e?.parameters??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},t.parameters);return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width)})}}static build(t){let{points:e,segments:n,verticalSegments:i}=t.parameters,r=new yw;r.moveTo(e[0].x,e[0].y),r.bezierCurveTo(e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y);let s=new pw(r.extractPoints(i).shape,n);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...t,type:"LatheGeometry"}})}},NonParametricGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n,i=t.geometry??e?.geometry??(new Nv).copy(new ny(100,100,100));void 0===e?(i.computeBoundingBox(),i.boundingBox.getSize(UU),n={width:UU.x,height:UU.y,depth:UU.z,subdivisions:0}):n=e.parameters;let r={...n,...t.parameters};return{parameters:{width:Math.abs(r.width),height:Math.abs(r.height),depth:Math.abs(r.depth),subdivisions:Math.abs(r.subdivisions)},geometry:i}}static build(t){let{width:e,height:n,depth:i,subdivisions:r}=t.parameters,s=t.geometry??(new Nv).copy(new ny(100,100,100)),a=s.userData.parameters;void 0===a?(s.computeBoundingBox(),s.boundingBox.getSize(UU)):UU.set(a.width,a.height,a.depth),(e!==UU.x||n!==UU.y||i!==UU.z)&&s.scale(0===UU.x?1:e/UU.x,0===UU.y?1:n/UU.y,0===UU.z?1:i/UU.z);let o=s.originalGeometry;try{r>0?(void 0===o||a?.subdivisions!==r)&&(void 0===o&&(o=s),s=new NU(r).modify(o).toBufferGeometry()):(void 0!==o&&(s=o),o=void 0,void 0===s.getAttribute("normal")&&s.computeVertexNormals())}catch{void 0!==o&&(s=o),o=void 0,void 0===s.getAttribute("normal")&&s.computeVertexNormals()}return void 0!==o&&Object.assign(s,{originalGeometry:o}),delete t.geometry,Object.assign(s,{userData:{...t,type:"NonParametricGeometry"}})}static loadFromUrl(t,e,n){new FS(n).load(t,(t=>{let n=this.normalizeInputs({geometry:t});t.boundingBox.getSize(UU);let i=100/UU.x;Object.assign(n.parameters,{width:100,height:UU.y*i,depth:UU.z*i}),e(this.build(n))}))}},PolygonGeometry:kU,PyramidGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},t.parameters);return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width)})}}static build(t){let{width:e,height:n,depth:i,radialSegments:r,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=t.parameters,c=new jU(.5*e,n,r,s,a,o,l);return c.scale(1,1,i/e),Object.assign(c,{userData:{...t,type:"PyramidGeometry"}})}},RectangleGeometry:HU,SphereGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},t.parameters);return n.thetaLength=vm.clamp(n.thetaLength,0,180),{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width)})}}static build(t){let e,{width:n=100,height:i=n,depth:r=n,widthSegments:s=64,heightSegments:a=64,phiStart:o,phiLength:l,thetaStart:c,thetaLength:h}=t.parameters;return 0===h?(e=new Nv,e.setAttribute("position",new Cv([],3))):e=new Kw(.5*n,s,a,o,l,c,h*vm.DEG2RAD),e.scale(1,i/n,r/n),Object.assign(e,{userData:{...t,type:"SphereGeometry"}})}},PlaneGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,depth:0,widthSegments:8,heightSegments:8},t.parameters);return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:0})}}static build(t){let{width:e=100,height:n=e,widthSegments:i=8,heightSegments:r=8}=t.parameters,s=new Ey(e,n,i,r);return s.scale(1,1,1),Object.assign(s,{userData:{...t,type:"PlaneGeometry"}})}},BackdropGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,angle:90,cornerRadius:24,cornerSegments:8},t.parameters);return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width)})}}static build(t){let{width:e,height:n,depth:i,angle:r,cornerRadius:s,cornerSegments:a}=t.parameters,o=new GU(e,n,i,r,s,a);return Object.assign(o,{userData:{...t,type:"BackdropGeometry"}})}},StarGeometry:WU,TextFrameGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,depth:0},t.parameters);return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??0)})}}static build(t){let{width:e,height:n}=t.parameters,i=new Ey(e,n);return Object.assign(i,{userData:{...t,type:"TextFrameGeometry"}})}},TorusGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},t.parameters),i=Math.abs(n.width),r=Math.abs(n.height??n.width);n.shapeBlendNode&&(r=i);let s=Math.round(Math.abs(n.depth??.25*n.width));return{parameters:Object.assign(n,{width:i,height:r,depth:s})}}static build(t){let{width:e,height:n,depth:i,radialSegments:r,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=t.parameters,c=function(t,e,n,i,r,s,a,o,l,c,h){[e,n]=[n,e],a=e/2;let u=vm.clamp(r/360,0,1);if(0===u){let t=new Nv;return t.setAttribute("position",new Cv([],3)),t}return 1===u&&(c=0),new gU(!0,t,e,n,i,u,s,a,o,l,c,h)}(e,n,i,.5*e,a,s,0,0,r,o,l);return c.scale(1,n/e,1),Object.assign(c,{userData:{...t,type:"TorusGeometry"}})}},TorusKnotGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},t.parameters);return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width),tube:n.tube??.125*n.width})}}static build(t){let{width:e,tube:n,tubularSegments:i,radialSegments:r,p:s,q:a}=t.parameters,o=.5*e;o!==n&&(o-=n);let l=new Qw(o,n,i,r,s,a);return Object.assign(l,{userData:{...t,type:"TorusKnotGeometry"}})}},TriangleGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},t.parameters);return{shape:t.shape&&t.shape instanceof EN?t.shape:new EN,parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width*(n.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(n.depth??0)})}}static build(t){let{width:e=100,height:n,cornerRadius:i,depth:r,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=t.parameters,l=t.shape,c=.5*e,h=.5*n;o?(l.addPoint(l.createPoint(-c,h)),l.addPoint(l.createPoint(c,-h)),l.addPoint(l.createPoint(-c,-h))):(l.addPoint(l.createPoint(0,h)),l.addPoint(l.createPoint(c,-h)),l.addPoint(l.createPoint(-c,-h))),l.isClosed=!0;for(let t=0,e=l.points.length;t<e;t++)l.points[t].roundness=i;l.roundness=i,l.update();let u=aU.create({shape:l,parameters:{roundness:i,depth:r,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(u,{userData:{...t,type:"TriangleGeometry"}})}},PathGeometry:class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let n=Object.assign({},e?.parameters??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},t.parameters),i=Math.abs(n.width),r=Math.abs(n.height??n.width),s=Math.abs(n.depth??0),a=e?.shapeData??lU.create({parameters:vL}).userData.shape;return{path:t.path??pL.defaultData(),parameters:Object.assign(n,{width:i,height:r,depth:s,extrusion:{...cI,...n.extrusion}}),shapeData:a}}static build(t){if(t.path.points.length>=2){let e=new tk(t);return Object.assign(e,{userData:{...t,type:"PathGeometry"}})}return Object.assign(new Nv,{userData:{...t,type:"PathGeometry"}})}},VectorGeometry:aU},Fk=t=>Bk[t.type].create(t);function Vk(t){return null!==t&&"booleanOp"in t}var jk=class extends(Uz(ty)){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new Mg}updateVisible(t){super.updateVisible(t),this.visible=!Vk(this.parent)&&this.visible,Vk(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){-1!==this.booleanMeshSetAddress&&(Ak.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(t=!1){return t?this.booleanWasTransformed=!0:this.freeBooleanPointer(),Vk(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let t of this.children)t instanceof jk&&(t.freeBooleanPointer(),Vk(t)&&t.invalidateUpstreamBooleanData())}updateTransformState(t,e){let n=super.updateTransformState(t,e);return n&&Vk(this.parent)&&this.invalidateDownstreamBooleanData(!0),n}onVariableUpdate(t=!1){super.onVariableUpdate(t),Vk(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},Hk=new Km;function Gk(t,e=0,n=t.count,i,r){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,h=-1/0;for(let i=e;i<n;i++){let e=t.getX(i),n=t.getY(i),r=t.getZ(i);e<s&&(s=e),n<a&&(a=n),r<o&&(o=r),e>l&&(l=e),n>c&&(c=n),r>h&&(h=r)}Hk.min.set(s,a,o),Hk.max.set(l,c,h),Hk.getCenter(i),Hk.getSize(r).multiplyScalar(.5)}var Wk=new Nv,qk=new vv,Xk=class extends jk{constructor(t,e){super(Wk,qk),this.super_Entity(t,e)}updateState(t,e){this.updateState_Entity(t,e)}updateEntityBoxSize(t,e){let n=this.geometry.getAttribute("position");void 0!==n?Gk(n,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:n.count,t,e):super.updateEntityBoxSize(t,e)}},$k=class{constructor(t){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},null===$k.uuidContext)throw new Error("plz startContext");$k.uuidContext===$k.globalContext?this.uuid="_gid"+$k.uuidContext.nodeContextUuid++:this.uuid="_uid"+$k.uuidContext.nodeContextUuid++,this.type=t,this.name=""}static startContext(t){null===this.uuidContext||this.uuidContext===$k.globalContext?this.uuidContext=t:console.error("Can't start context twice")}static endContext(t){this.uuidContext!==t&&console.error("Can't end context twice"),this.uuidContext=null}analyze(t,e){e=e??{},t.analyzing=!0,this.build(t.addFlow(e.slot,e.cache,e.context),"v4"),t.clearVertexNodeCode(),t.clearFragmentNodeCode(),t.removeFlow(),t.analyzing=!1}analyzeAndFlow(t,e,n){return n=n??{},this.analyze(t,n),this.flow(t,e,n)}flow(t,e,n){n=n??{},t.addFlow(n.slot,n.cache,n.context);let i={result:this.build(t,e),code:t.clearNodeCode(),extra:t.context.extra};return t.removeFlow(),i}build(t,e,n){e=e??this.getType(t,e);let i=t.getNodeData(n??this);return t.analyzing&&this.appendDepsNode(t,i,e),-1===t.nodes.indexOf(this)&&t.nodes.push(this),void 0!==this.updateFrame&&-1===t.updaters.indexOf(this)&&t.updaters.push(this),this.generate(t,e,n)}updateFrame(t){}generateReadonly(t,e,n,i,r,s){return""}generate(t,e,n,i,r){return""}parse(t,e,n,i){}appendDepsNode(t,e,n){e.deps=(e.deps||0)+1;let i=t.getTypeLength(n);(i>(e.outputMax||0)||this.getType(t,n))&&(e.outputMax=i,e.output=n)}setName(t){this.name=t}getName(){return this.name}getType(t,e){return"sampler2D"===e||"samplerCube"===e?e:this.type}},Yk=$k;Yk.globalContext={nodeContextUuid:0},Yk.uuidContext=$k.globalContext;var Zk=class{constructor(t){t=t??{},this.name=t.name,this.type=t.type,this.node=t.node,this.size=t.size,this.needsUpdate=t.needsUpdate}get value(){return this.node.value}set value(t){this.node.value=t}},Kk=new class{constructor(){this.nodes={},this.keywords={}}add(t){this.nodes[t.name]=t}addKeyword(t,e,n){n=void 0===n||n,this.keywords[t]={callback:e,cache:n}}remove(t){delete this.nodes[t.name]}removeKeyword(t){delete this.keywords[t]}get(t){return this.nodes[t]}getKeyword(t,e){return this.keywords[t].callback(e)}getKeywordData(t){return this.keywords[t]}contains(t){return void 0!==this.nodes[t]}containsKeyword(t){return void 0!==this.keywords[t]}},Jk=class extends Yk{constructor(t,e){super(t),this.scope="",e=e??{},this.shared=void 0===e.shared||e.shared,this.unique=void 0!==e.unique&&e.unique}build(t,e,n,i){if(e=e??this.getType(t),this.getShared(t,e)){let r=this.getUnique(t,e);r&&void 0===this.uuid&&(this.uuid=vm.generateUUID()),n=t.getUUID(n??this.getUUID(),!r);let s=t.getNodeData(n),a=s.output||this.getType(t);if(t.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(t,s,e),this.generate(t,e,n)):super.build(t,e,n);if(r)return s.name=s.name||super.build(t,e,n),s.name;if(!this.getLabel()&&(!this.getShared(t,a)||t.context.ignoreCache||1===s.deps))return super.build(t,e,n);n=this.getUUID(!1);let o=this.getTemp(t,n);if(o)return t.format(o,a,e);{o=super.generate(t,e,n,s.output,i);let r=this.generate(t,a,n);return t.addNodeCode(o+" = "+r+";"),t.format(o,a,e)}}return super.build(t,e,n)}getShared(t,e){return"sampler2D"!==e&&"samplerCube"!==e&&this.shared}getUnique(t,e){return this.unique}setLabel(t){return this.label=t,this}getLabel(){return this.label}getUUID(t){let e=this.uuid;return"string"==typeof this.scope&&(e=this.scope+"-"+e),e}getTemp(t,e){e=e||this.uuid;let n=t.getVars()[e];return n?n.name:void 0}generate(t,e,n,i,r){return this.getShared(t,e)||console.error("TempNode is not shared"),n=n??this.uuid,t.getTempVar(n,i??this.getType(t),r,this.getLabel()).name}},Qk=class extends Jk{constructor(t,e){(e=e??{}).shared=void 0!==e.shared&&e.shared,super(t,e),this.readonly=!1}setReadonly(t){return this.readonly=t,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(t,e,n,i,r,s){n=t.getUUID(n??this.getUUID()),i=i??this.getType(t);let a=t.getNodeData(n);return this.getReadonly()&&void 0!==this.generateReadonly?this.generateReadonly(t,e,n,i,r,s):t.isShader("vertex")?(a.vertex||(a.vertex=t.createVertexUniform(i,this,r,s,this.getLabel())),t.format(a.vertex.name,i,e)):(a.fragment||(a.fragment=t.createFragmentUniform(i,this,r,s,this.getLabel())),t.format(a.fragment.name,i,e))}},tB=class extends Qk{constructor(t=0,e){super("v2"),this.nodeType="Vector2",this.value=t instanceof ym?t:new ym(t,e)}get x(){return this.value.x}set x(t){this.value.x=t}get y(){return this.value.y}set y(t){this.value.y=t}generateReadonly(t,e,n,i,r,s){return t.format("vec2("+this.value.x+", "+this.value.y+")",i,e)}},eB=class extends Qk{constructor(t=0,e,n){super("v3"),this.nodeType="Vector3",this.value=t instanceof $m?t:new $m(t,e,n)}get x(){return this.value.x}set x(t){this.value.x=t}get y(){return this.value.y}set y(t){this.value.y=t}get z(){return this.value.z}set z(t){this.value.z=t}generateReadonly(t,e,n,i,r,s){return t.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",i,e)}},nB=class extends pv{constructor(t,e,n,i){super(t,e,n),this.isColorA=!0,this.a=i}setRGBA(t,e,n,i){super.setRGB(t,e,n),this.a=i}copy(t){return super.copy(t),this.a="a"in t?t.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(t){return super.equals(t)&&this.a===t.a}setStyle(t,e="srgb"){let n;if("transparent"===t)return this.setRGBA(0,0,0,0),this;if(n=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(t)){let i,r=n[1],s=n[2];switch(r){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a="rgba"===r?parseFloat(i[4]):1,super.setStyle(t,e);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a="hsla"===r?parseFloat(i[4]):1,super.setStyle(t,e)}}return super.setStyle(t,e)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(t){this.r=t}set y(t){this.g=t}set z(t){this.b=t}set w(t){this.a=t}},iB=class extends Qk{constructor(t){super("v4"),this.nodeType="Vector4",this.value=t instanceof nB?t:new nB(t.r,t.g,t.b,t.a)}generateReadonly(t,e,n,i,r,s){return t.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",i,e)}},rB=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,sB=/[a-z_0-9]+/gi,aB=class extends Jk{constructor(t,e,n,i,r){super(r),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=void 0===r,this.isInterface=!1,this.parse(t,e,n,i)}getShared(t,e){return!this.isMethod}getType(t){return t.getTypeByFormat(this.type)}getInputByName(t){if(this.inputs){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}}getIncludeByName(t){if(this.includes){let e=this.includes.length;for(;e--;)if(this.includes[e].name===t)return this.includes[e]}}generate(t,e,n,i,r){let s,a=0,o=this.src;if(this.includes)for(let e=0;e<this.includes.length;e++)t.include(this.includes[e],this);for(let e in this.extensions)t.extensions[e]=!0;let l=[];for(;s=sB.exec(this.src);)l.push(s);for(let e=0;e<l.length;e++){let n=l[e],i=n[0],r=!this.isMethod||!this.getInputByName(i),s=i;if(this.keywords[i]||this.useKeywords&&r&&Kk.containsKeyword(i)){let e=this.keywords[i];if(!e){let n=Kk.getKeywordData(i);n.cache&&(e=t.keywords[i]),e=e||Kk.getKeyword(i,t),n.cache&&(t.keywords[i]=e)}s=e.build(t)}i!==s&&"."!==o[n.index+a-1]&&(o=o.substring(0,n.index+a)+s+o.substring(n.index+i.length+a),a+=s.length-i.length),void 0===this.getIncludeByName(s)&&Kk.contains(s)&&t.include(Kk.get(s))}return"source"===e?o:this.isMethod?(this.isInterface||t.include(this,void 0,o),this.name):t.format("( "+o+" )",this.getType(t),e)}parse(t,e,n,i){if(this.src=t||"",this.includes=e??[],this.extensions=n??{},this.keywords=i??{},this.isMethod){let t=rB.exec(this.src);if(this.inputs=[],t&&4==t.length){this.type=t[1],this.name=t[2];let e=t[3].match(sB);if(e){let t=0;for(;t<e.length;){let n,i=e[t++];"in"===i||"out"===i||"inout"===i?n=e[t++]:(n=i,i="");let r=e[t++];this.inputs.push({name:r,type:n,qualifier:i})}}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}},oB=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,lB=class extends Jk{constructor(t="",e){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(t||lB.PI,void 0,void 0,void 0,e)}getType(t){return t.getTypeByFormat(this.type)}parse(t,e,n,i,r){this.src=t||"";let s,a,o="",l=oB.exec(t);this.useDefine=r??"#"===this.src.charAt(0),l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(t,e){if("source"===e){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return t.include(this),t.format(this.name,this.getType(t),e)}generate(t,e,n,i,r){return t.format(this.name,this.getType(t),e)}},cB=lB;cB.PI="PI",cB.PI2="PI2",cB.RECIPROCAL_PI="RECIPROCAL_PI",cB.RECIPROCAL_PI2="RECIPROCAL_PI2",cB.LOG2="LOG2",cB.EPSILON="EPSILON";var hB=new RegExp("^structs*([a-z_0-9]+)s*{s*((.|\n)*?)}","gim"),uB=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),dB=class extends Jk{constructor(t=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(t)}getType(t){return t.getTypeByFormat(this.name)}getInputByName(t){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}generate(t,e,n,i,r){return"source"===e?this.src+";":t.format("( "+this.src+" )",this.getType(t),e)}parse(t=""){this.src=t,this.inputs=[];let e=hB.exec(t);if(e){let t,n=e[2];for(;t=uB.exec(n);)this.inputs.push({type:t[1],name:t[2]});this.name=e[1]}else this.name="";this.type=this.name}},pB=class extends Jk{constructor(t){super("v2",{shared:!1}),this.nodeType="UV",this.index=t??0}generate(t,e){t.requires.uv[this.index]=!0;let n=this.index>0?this.index+1:"",i=t.isShader("vertex")?"uv"+n:"vUv"+n;return t.format(i,this.getType(t),e)}};Kk.addKeyword("uv",(function(){return new pB})),Kk.addKeyword("uv2",(function(){return new pB(1)}));var fB=class extends Jk{constructor(t,e){super("v4"),this.nodeType="ColorSpace",this.input=t,this.method=e??fB.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(t){switch(t){case i.LinearEncoding:return["Linear"];case i.sRGBEncoding:return["sRGB"];default:return[]}}generate(t,e){let n=this.input.build(t,"v4"),i=this.getType(t),r=fB.Nodes[this.method],s=t.include(r);if(s===fB.LINEAR_TO_LINEAR)return t.format(n,i,e);if(2===r.inputs?.length){let r=this.factor.build(t,"f");return t.format(s+"( "+n+", "+r+" )",i,e)}return t.format(s+"( "+n+" )",i,e)}fromEncoding(t){let e=fB.getEncodingComponents(t);this.method="LinearTo"+e[0],this.factor=e[1]}fromDecoding(t){let e=fB.getEncodingComponents(t);this.method=e[0]+"ToLinear",this.factor=e[1]}},mB=fB;mB.Nodes={LinearToLinear:new aB(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),sRGBToLinear:new aB(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),LinearTosRGB:new aB(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n"))},mB.LINEAR_TO_LINEAR="LinearToLinear",mB.SRGB_TO_LINEAR="sRGBToLinear",mB.LINEAR_TO_SRGB="LinearTosRGB";var gB=class extends aB{constructor(t="",e,n,i,r){super(t,r,i,n,e),this.nodeType="Expression"}},vB=class extends Qk{constructor(t=new Vm,e,n,i){super("v4",{shared:!0}),this.nodeType="Texture",this.value=t,this.uv=e??new pB,this.bias=n,this.project=void 0!==i&&i}getTexture(t,e){return super.generate(t,e,this.value.uuid,"t")}generate(t,e){if("sampler2D"===e)return this.getTexture(t,e);let n,i,r=this.getTexture(t,e),s=this.uv.build(t,this.project?"v4":"v2"),a=this.bias?this.bias.build(t,"f"):void 0;void 0===a&&t.context.bias&&(a=t.context.bias.setTexture(this).build(t,"f")),n=this.project?"texture2DProj":a?"tex2DBias":"tex2D",i=a?n+"( "+r+", "+s+", "+a+" )":n+"( "+r+", "+s+" )";let o={include:t.isShader("vertex"),ignoreCache:!0},l=this.getType(t);return t.addContext(o),this.colorSpace=this.colorSpace??new mB(new gB("",l)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(i),i=this.colorSpace.build(t,l),t.removeContext(),t.format(i,l,e)}},yB=class extends Qk{constructor(t){super("f"),this.nodeType="Float",this.value=t??0}generateReadonly(t,e,n,i,r,s){return t.format(this.value+(this.value%1?"":".0"),i,e)}},xB=class extends Jk{constructor(t,e){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=t,this.inputs=e??[]}getFunction(){return this.value}getType(t){return this.value.getType(t)}generate(t,e,n,i,r){i=this.getType(t);let s=this.value,a=s.build(t,e)+"( ",o=[];if(s.inputs){for(let e=0;e<s.inputs.length;e++){let n=s.inputs[e],i=this.inputs[e]||this.inputs[n.name];o.push(i.build(t,t.getTypeByFormat(n.type)))}a+=o.join(", ")+" )"}return t.format(a,i,e)}},bB=class extends Jk{constructor(t,e,n=bB.ADD){super(),this.nodeType="Operator",this.type=t.type,this.a=t,this.b=e,this.op=n}getType(t){let e=this.a.getType(t),n=this.b.getType(t);return t.isTypeMatrix(e)?"v4":t.getTypeLength(n)>t.getTypeLength(e)?n:e}generate(t,e){let n=this.getType(t);this.type=n;let i=this.a.build(t,n),r=this.b.build(t,n);return t.format("( "+i+" "+this.op+" "+r+" )",n,e)}},_B=bB;_B.ADD="+",_B.SUB="-",_B.MUL="*",_B.DIV="/";var wB=class extends Jk{constructor(t,e=wB.ABS,n,i){super(),this.nodeType="Math",this.a=t,"string"!=typeof e?this.b=e:i=e,"string"!=typeof n?this.c=n:i=n,this.method=i,this.hashProperties=["method"]}getNumInputs(t){switch(this.method){case wB.MIX:case wB.CLAMP:case wB.REFRACT:case wB.SMOOTHSTEP:case wB.FACEFORWARD:return 3;case wB.MIN:case wB.MAX:case wB.MOD:case wB.STEP:case wB.REFLECT:case wB.DISTANCE:case wB.DOT:case wB.CROSS:case wB.POW:return 2;default:return 1}}getInputType(t){let e=t.getTypeLength(this.a.getType(t)),n=this.b?t.getTypeLength(this.b.getType(t)):0,i=this.c?t.getTypeLength(this.c.getType(t)):0;return e>n&&e>i?this.a.getType(t):n>i?this.b.getType(t):this.c.getType(t)}getType(t){switch(this.method){case wB.LENGTH:case wB.DISTANCE:case wB.DOT:return"f";case wB.CROSS:return"v3"}return this.getInputType(t)}generate(t,e){let n,i,r,s=this.a?t.getTypeLength(this.a.getType(t)):0,a=this.b?t.getTypeLength(this.b.getType(t)):0,o=this.c?t.getTypeLength(this.c.getType(t)):0,l=this.getInputType(t),c=this.getType(t);switch(this.type=c,this.method){case wB.NEGATE:return t.format("( -"+this.a.build(t,l)+" )",l,e);case wB.INVERT:return t.format("( 1.0 - "+this.a.build(t,l)+" )",l,e);case wB.CROSS:n=this.a.build(t,"v3"),i=this.b.build(t,"v3");break;case wB.STEP:n=this.a.build(t,1===s?"f":l),i=this.b.build(t,l);break;case wB.MIN:case wB.MAX:case wB.MOD:n=this.a.build(t,l),i=this.b.build(t,1===a?"f":l);break;case wB.REFRACT:n=this.a.build(t,l),i=this.b.build(t,l),r=this.c.build(t,"f");break;case wB.MIX:n=this.a.build(t,l),i=this.b.build(t,l),r=this.c.build(t,1===o?"f":l);break;default:n=this.a.build(t,l),this.b&&(i=this.b.build(t,l)),this.c&&(r=this.c.build(t,l))}let h=[];h.push(n),i&&h.push(i),r&&h.push(r);let u=this.getNumInputs(t);if(h.length!==u)throw Error(`Arguments not match used in "${this.method}". Require ${u}, currently ${h.length}.`);return t.format(this.method+"( "+h.join(", ")+" )",c,e)}},SB=wB;SB.RAD="radians",SB.DEG="degrees",SB.EXP="exp",SB.EXP2="exp2",SB.LOG="log",SB.LOG2="log2",SB.SQRT="sqrt",SB.INV_SQRT="inversesqrt",SB.FLOOR="floor",SB.CEIL="ceil",SB.NORMALIZE="normalize",SB.FRACT="fract",SB.SATURATE="saturate",SB.SIN="sin",SB.COS="cos",SB.TAN="tan",SB.ASIN="asin",SB.ACOS="acos",SB.ARCTAN="atan",SB.ABS="abs",SB.SIGN="sign",SB.LENGTH="length",SB.NEGATE="negate",SB.INVERT="invert",SB.MIN="min",SB.MAX="max",SB.MOD="mod",SB.STEP="step",SB.REFLECT="reflect",SB.DISTANCE="distance",SB.DOT="dot",SB.CROSS="cross",SB.POW="pow",SB.MIX="mix",SB.CLAMP="clamp",SB.REFRACT="refract",SB.SMOOTHSTEP="smoothstep",SB.FACEFORWARD="faceforward";var MB=class extends Jk{constructor(t,e,n){super("v4"),this.nodeType="TextureCubeUV",this.value=t,this.uv=e,this.bias=n}bilinearCubeUV(t,e,n,i){let r=new xB(MB.Nodes.bilinearCubeUV,[e,n,i]);this.colorSpaceTL=this.colorSpaceTL??new mB(new gB("","v4")),this.colorSpaceTL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(r.build(t)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new mB(new gB("","v4")),this.colorSpaceTR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(r.build(t)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new mB(new gB("","v4")),this.colorSpaceBL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(r.build(t)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new mB(new gB("","v4")),this.colorSpaceBR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(r.build(t)+".br");let s={include:t.isShader("vertex"),ignoreCache:!0};t.addContext(s),this.colorSpaceTLExp=new gB(this.colorSpaceTL.build(t,"v4"),"v4"),this.colorSpaceTRExp=new gB(this.colorSpaceTR.build(t,"v4"),"v4"),this.colorSpaceBLExp=new gB(this.colorSpaceBL.build(t,"v4"),"v4"),this.colorSpaceBRExp=new gB(this.colorSpaceBR.build(t,"v4"),"v4"),t.removeContext();let a=new gB("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=r,a}generate(t,e){if(t.isShader("fragment")){let n=this.uv,i=this.bias||t.context.roughness,r=new xB(MB.Nodes.roughnessToMip,[i]),s=new SB(r,MB.Nodes.m0,MB.Nodes.cubeUV_maxMipLevel,SB.CLAMP),a=new SB(s,SB.FLOOR),o=new SB(s,SB.FRACT),l=this.bilinearCubeUV(t,this.value,n,a),c=this.bilinearCubeUV(t,this.value,n,new _B(a,new yB(1).setReadonly(!0),_B.ADD)),h=new SB(l,c,o,SB.MIX);return t.format(h.build(t),"v4",e)}return console.warn("TextureCubeUVNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)}},TB=MB;TB.Nodes=function(){let t=new dB("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),e=new cB("float cubeUV_maxMipLevel 8.0",!0),n=new cB("float cubeUV_minMipLevel 4.0",!0),i=new cB("float cubeUV_maxTileSize 256.0",!0),r=new cB("float cubeUV_minTileSize 16.0",!0),s=new aB("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");s.useKeywords=!1;let a=new aB("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");a.useKeywords=!1;let o=new aB("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[t,s,a,e,n,i,r]);o.useKeywords=!1;let l=new cB("float r0 1.0",!0),c=new cB("float v0 0.339",!0),h=new cB("float m0 -2.0",!0),u=new cB("float r1 0.8",!0),d=new cB("float v1 0.276",!0),p=new cB("float m1 -1.0",!0),f=new cB("float r4 0.4",!0),m=new cB("float v4 0.046",!0),g=new cB("float m4 2.0",!0),v=new cB("float r5 0.305",!0),y=new cB("float v5 0.016",!0),x=new cB("float m5 3.0",!0),b=new cB("float r6 0.21",!0),_=new cB("float v6 0.0038",!0),w=new cB("float m6 4.0",!0);return{bilinearCubeUV:o,roughnessToMip:new aB("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[l,c,h,u,d,p,f,m,g,v,y,x,b,_,w]),m0:h,cubeUV_maxMipLevel:e}}();var EB=class extends Jk{constructor(t){super("v3"),this.nodeType="Normal",this.scope=t??EB.VIEW}getShared(){return this.scope===EB.WORLD}build(t,e,n,i){let r=t.context[this.scope+"Normal"];return r?r.build(t,e,n,i):super.build(t,e,n)}generate(t,e,n,i,r){let s;switch(this.scope){case EB.VIEW:s=t.isShader("vertex")?"transformedNormal":"geometryNormal";break;case EB.LOCAL:t.isShader("vertex")?s="objectNormal":(t.requires.normal=!0,s="vObjectNormal");break;case EB.WORLD:t.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(t.requires.worldNormal=!0,s="vWNormal")}return t.format(s,this.getType(t),e)}},AB=EB;AB.LOCAL="local",AB.WORLD="world",AB.VIEW="view",AB.NORMAL="normal",Kk.addKeyword("viewNormal",(function(){return new AB(AB.VIEW)})),Kk.addKeyword("localNormal",(function(){return new AB(AB.NORMAL)})),Kk.addKeyword("worldNormal",(function(){return new AB(AB.WORLD)}));var CB=class extends Jk{constructor(t){super("v3"),this.nodeType="Position",this.scope=t??CB.LOCAL}getType(){return this.scope===CB.PROJECTION?"v4":this.type}getShader(){switch(this.scope){case CB.LOCAL:case CB.WORLD:return!1}return!0}generate(t,e,n,i,r){let s;switch(this.scope){case CB.LOCAL:t.isShader("vertex")?s="transformed":(t.requires.position=!0,s="vPosition");break;case CB.WORLD:if(t.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";t.requires.worldPosition=!0,s="vWPosition";break;case CB.VIEW:s=t.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case CB.PROJECTION:s=t.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return t.format(s,this.getType(),e)}},PB=CB;PB.LOCAL="local",PB.WORLD="world",PB.VIEW="view",PB.PROJECTION="projection",Kk.addKeyword("position",(function(){return new PB})),Kk.addKeyword("worldPosition",(function(){return new PB(PB.WORLD)})),Kk.addKeyword("viewPosition",(function(){return new PB(PB.VIEW)}));var RB=class extends Jk{constructor(t){super("v3"),this.nodeType="Reflect",this.scope=t??RB.CUBE}getUnique(t){return!t.context.viewNormal}getType(){return this.scope===RB.SPHERE?"v2":this.type}generate(t,e){let n=this.getUnique(t);if(t.isShader("fragment")){let i;switch(this.scope){case RB.VECTOR:{let e=new AB(AB.VIEW),r=t.context.roughness,s=e.build(t,"v3"),a=new PB(PB.VIEW).build(t,"v3"),o=r?r.build(t,"f"):void 0,l=`reflect( -normalize( ${a} ), ${s} )`;o&&(l=`normalize( mix( ${l}, ${s}, ${o} * ${o} ) )`);let c=`inverseTransformDirection( ${l}, viewMatrix )`;n?(t.addNodeCode(`vec3 reflectVec = ${c};`),i="reflectVec"):i=c;break}case RB.CUBE:{let e=new RB(RB.VECTOR).build(t,"v3"),r="vec3( -"+e+".x, "+e+".yz )";n?(t.addNodeCode(`vec3 reflectCubeVec = ${r};`),i="reflectCubeVec"):i=r;break}case RB.SPHERE:{let e="normalize( ( viewMatrix * vec4( "+new RB(RB.VECTOR).build(t,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";n?(t.addNodeCode(`vec2 reflectSphereVec = ${e};`),i="reflectSphereVec"):i=e;break}}return t.format(i,this.getType(),e)}return console.warn("ReflectNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.type,e)}},OB=RB;OB.CUBE="cube",OB.SPHERE="sphere",OB.VECTOR="vector";var DB=class extends Jk{constructor(t=new vB,e,n){super("v4"),this.nodeType="TextureCube",this.value=t,this.radianceNode=new TB(this.value,e??new OB(OB.VECTOR),n),this.irradianceNode=new TB(this.value,new AB(AB.WORLD),new yB(1).setReadonly(!0))}generate(t,e){return t.isShader("fragment")?(t.require("irradiance"),t.context.bias&&t.context.bias.setTexture(this.value),("irradiance"===t.slot?this.irradianceNode:this.radianceNode).build(t,e)):(console.warn("TextureCubeNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e))}},LB=class extends Qk{constructor(t=new my,e,n){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=t,this.uv=e??new OB,this.bias=n}getTexture(t,e){return super.generate(t,e,this.value.uuid,"tc")}generate(t,e){if("samplerCube"===e)return this.getTexture(t,e);let n,i=this.getTexture(t,e),r=this.uv?.build(t,"v3"),s=this.bias?this.bias.build(t,"f"):void 0;void 0===s&&t.context.bias&&(s=t.context.bias.setTexture(this).build(t,"f")),n=s?"texCubeBias( "+i+", "+r+", "+s+" )":"texCube( "+i+", "+r+" )";let a={include:t.isShader("vertex"),ignoreCache:!0},o=this.getType(t);return t.addContext(a),this.colorSpace=this.colorSpace??new mB(new gB("",o)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(n),n=this.colorSpace.build(t,o),t.removeContext(),t.format(n,o,e)}},IB=["x","y","z","w"],zB=["float","vec2","vec3","vec4"],NB={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},UB={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},kB=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function t(t,e){return t.deps.length-e.deps.length}return function(e,n){let i=this.getIncludes(e,n);if(!i)return"";let r="";i=i.sort(t);for(let t=0;t<i.length;t++)i[t].src&&(r+=i[t].src+"\n");return r}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","\n\t\t\t// NOTE: Include Spline's blending modes. This could be part of BlendNode\n\t\t\t#define SPE_BLENDING_NORMAL 0\n\t\t\t#define SPE_BLENDING_MULTIPLY 1\n\t\t\t#define SPE_BLENDING_SCREEN 2\n\t\t\t#define SPE_BLENDING_OVERLAY 3\n\n\t\t\tvec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, a * b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );\n\t\t\t\treturn mix( a, tmp, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );\n\t\t\t\treturn clamp( mix( a, tmp, alpha ), 0.0, 1.0 );\n\t\t\t}\n\n\t\t\tvec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {\n\t\t\t\tif ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );\n\t\t\t\treturn vec3( 1.0 );\n\t\t\t}\n\t\t\t","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join("\n"),fragment:["float accumAlpha = 0.0;","void accumulateAlpha(float alpha) {\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * alpha;\n\t\t\t\t}",""].join("\n")},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(t,e){this.addVertexParsCode("\nuniform int frameIndex;\nuniform vec2 resolution;\nuniform mat4 previousModelViewMatrix;\nuniform mat4 previousProjectionMatrix;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n"),this.addFragmentParsCode("\nlayout(location = 1) out vec4 gVelocity;\n\nuniform int frameIndex;\nuniform vec2 resolution;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\nvec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {\n  const float goldenAngle = 2.399963f; // radians\n  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));\n  float theta = float(sampleIndex) * goldenAngle + angle;\n  float sine = sin(theta);\n  float cosine = cos(theta);\n  return vec2(cosine, sine) * r;\n}\n\n// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso\nfloat getNoiseInterleavedGradient(vec2 screenPos) {\n    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);\n    return fract(magic.z * fract(dot(screenPos, magic.xy)));\n}\n\n"),this.buildShader("vertex",t),this.buildShader("fragment",e);for(let t=0;t<this.requires.uv.length;t++)if(this.requires.uv[t]){let e=t>0?t+1:"";this.addVaryCode("varying vec2 vUv"+e+";"),t>0&&this.addVertexParsCode("attribute vec2 uv"+e+";"),this.addVertexFinalCode("vUv"+e+" = uv"+e+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("\n\t\t\t\t#ifndef SHAPEBLEND \n\t\t\t\t\tvObjectNormal = normal;\n\t\t\t\t#else\n\t\t\t\t\tvObjectNormal = objectNormal;\n\t\t\t\t#endif\n\t\t\t")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode("\n// TODO: This could be generated CPU side and passed to the shader every frame\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\n// TODO: Pass correct view size\nvec2 offset = haltonSequence[frameIndex];\noffset.x /= resolution.x;\noffset.y /= resolution.y;\n\nvec4 currentPosition = gl_Position;\nvec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);\n\n// We want to calculate the velocity with unjittered positions\n// so that things that are not moving get a velocity = 0\nvCurrentPosition = currentPosition;\nvPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);\n#ifdef OUTLINE_COMPENSATION\nvPreviousPosition.xy += OUTLINE_COMPENSATION;\n#endif\ngl_Position = currentPositionJittered;\n\n"),this.addFragmentFinalCode("\nvec2 oldPos = vPreviousPosition.xy;\n    oldPos /= vPreviousPosition.w;\n    oldPos.xy = (oldPos.xy+1.)/2.0;\n\nvec2 newPos = vCurrentPosition.xy;\n    newPos /= vCurrentPosition.w;\n    newPos.xy = (newPos.xy+1.)/2.0;\n\nvec2 velocity = (newPos - oldPos);\n\n// Discard fully transparent pixels \nif (gl_FragColor.a <= 0.0) discard;\n\ngVelocity = vec4(velocity, 0.0, 1.0);\n")),this}buildShader(t,e){this.resultCode[t]=e.build(this.setShader(t),"v4")}setMaterial(t,e){return this.defines={},this}addFlow(t,e,n){return this.addSlot(t).addCache(e).addContext(n)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(t){return this.cache=t??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(t){return this.context=Object.assign({},this.context,t),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(t){return this.slot=t||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(t,e){void 0===this.fragmentVariables[t]&&(this.addFragmentCode(`${e} ${t};`),this.fragmentVariables[t]="")}addFragmentParsVariable(t,e){void 0===this.fragmentParsVariables[t]&&(this.addFragmentParsCode(`${e} ${t};`),this.fragmentParsVariables[t]="")}addVertexParsVariable(t,e){void 0===this.vertexParsVariables[t]&&(this.addVertexParsCode(`${e} ${t};`),this.vertexParsVariables[t]="")}addVertexCode(t){this.addCode(t,"vertex")}addFragmentCode(t){this.addCode(t,"fragment")}addCode(t,e){this.code[e??this.shader]+=t+"\n"}addVertexNodeCode(t){this.addNodeCode(t,"vertex")}addFragmentNodeCode(t){this.addNodeCode(t,"fragment")}addNodeCode(t,e){this.nodeCode[e??this.shader]+=t+"\n"}clearNodeCode(t){t=t??this.shader;let e=this.nodeCode[t];return this.nodeCode[t]="",e}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(t){this.addFinalCode(t,"vertex")}addFragmentFinalCode(t){this.addFinalCode(t,"fragment")}addFinalCode(t,e){this.finalCode[e??this.shader]+=t+"\n"}addVertexParsCode(t){this.addParsCode(t,"vertex")}addFragmentParsCode(t){this.addParsCode(t,"fragment")}addParsCode(t,e){this.parsCode[e??this.shader]+=t+"\n"}addVaryCode(t){this.addVertexParsCode(t),this.addFragmentParsCode(t)}isCache(t){return-1!==this.caches.indexOf(t)}isSlot(t){return-1!==this.slots.indexOf(t)}define(t,e){this.defines[t]=void 0===e?1:e}require(t){this.requires[t]=!0}isDefined(t){return void 0!==this.defines[t]}getVar(t,e,n,i="varying",r="V",s=""){let a=this.getVars(i),o=a[t];if(!o){let i=a.length;o={name:n||"node"+r+i+(s?"_"+s:""),type:e},a.push(o),a[t]=o}return o}getTempVar(t,e,n,i){return this.getVar(t,e,n,this.shader,"T",i)}getAttribute(t,e){if(!this.attributes[t]){let n=this.getVar(t,e);this.addVertexParsCode("attribute "+e+" "+t+";"),this.addVertexFinalCode(n.name+" = "+t+";"),this.attributes[t]={varying:n,name:t,type:e}}return this.attributes[t]}getCode(t){return[this.prefixCode,this.parsCode[t],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[t],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[t],"uniform"),this.getIncludesCode("consts",t),this.getIncludesCode("structs",t),this.getIncludesCode("functions",t),"void main() {",this.getVarListCode(this.getVars(t)),this.code[t],this.resultCode[t],this.finalCode[t],"}"].join("\n")}getVarListCode(t,e){e=e??"";let n="";for(let i=0,r=t.length;i<r;++i){let r=t[i],s=r.type,a=r.name,o=r.size,l=this.getFormatByType(s);if(void 0===l)throw new Error("Node pars "+l+" not found.");l.includes("[]")?n+=e+" "+l.substring(0,l.length-2)+" "+a+`[${o}];\n`:n+=e+" "+l+" "+a+";\n"}return n}getVars(t){return this.inputs.vars[t??this.shader]}getNodeData(t){let e=t instanceof Yk?t.uuid:t;return this.nodeData[e]=this.nodeData[e]||{}}createUniform(t,e,n,i,r,s){if(e.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new Zk({type:e,size:n.size,name:i||"nodeUA"+o+(s?"_"+s:""),node:n,needsUpdate:r});return a.list.push(l),a[t].push(l),a[t][l.name]=l,this.uniforms[l.name]=l,l}{let a=this.inputs.uniforms,o=a.list.length,l=new Zk({type:e,name:i||"nodeU"+o+(s?"_"+s:""),node:n,needsUpdate:r});return a.list.push(l),a[t].push(l),a[t][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(t,e,n,i,r){return this.createUniform("vertex",t,e,n,i,r)}createFragmentUniform(t,e,n,i,r){return this.createUniform("fragment",t,e,n,i,r)}include(t,e,n){let i;if(t="string"==typeof t?Kk.get(t):t,!1===this.context.include)return t.name;t instanceof aB?i=this.includes.functions:t instanceof cB?i=this.includes.consts:t instanceof dB&&(i=this.includes.structs);let r=i[this.shader]=i[this.shader]||[];if(t){let i=r[t.name];if(i||(i=r[t.name]={node:t,deps:[]},r.push(i),i.src=t.build(this,"source")),t instanceof aB&&e&&r[e.name]&&-1===r[e.name].deps.indexOf(t)&&(r[e.name].deps.push(t),t.includes?.length)){let n=0;do{this.include(t.includes[n++],e)}while(n<t.includes.length)}return n&&(i.src=n),t.name}throw new Error("Include not found.")}colorToVectorProperties(t){return t.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(t){return t.replace(/c/g,"v3")}getIncludes(t,e){return this.includes[t][e||this.shader]}getConstructorFromLength(t){return zB[t-1]}isTypeMatrix(t){return/^m/.test(t)}getTypeLength(t){return"f"===t?1:parseInt(this.colorToVector(t).substr(1))}getTypeFromLength(t){return 1===t?"f":"v"+t}findNode(...t){for(let e=0;e<arguments.length;e++){let n=t[e];if(n?.isNode)return n}}resolve(...t){for(let e=0;e<arguments.length;e++){let n=t[e];if(void 0!==n){if(n.isNode)return n;if(n.isTexture)switch(n.mapping){case fp:case mp:return new LB(n);case yp:return new DB(new vB(n));default:return new vB(n)}else{if(n.isVector2)return new tB(n);if(n.isVector3)return new eB(n);if(n.isVector4)return new iB(n)}}}}format(t,e,n){switch(this.colorToVector(n+" <- "+e)){case"f <- v2":case"f <- v3":case"f <- v4":return t+".x";case"f <- i":case"f <- b":return"float( "+t+" )";case"v2 <- f":return"vec2( "+t+" )";case"v2 <- v3":case"v2 <- v4":return t+".xy";case"v2 <- i":case"v2 <- b":case"v3 <- i":case"v3 <- b":return"vec2( float( "+t+" ) )";case"v3 <- f":return"vec3( "+t+" )";case"v3 <- v2":return"vec3( "+t+", 0.0 )";case"v3 <- v4":return t+".xyz";case"v4 <- f":return"vec4( "+t+" )";case"v4 <- v2":return"vec4( "+t+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+t+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+t+" ) )";case"i <- f":case"i <- b":return"int( "+t+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+t+".x )";case"b <- f":return"( "+t+" != 0.0 )";case"b <- v2":return"( "+t+" != vec2( 0.0 ) )";case"b <- v3":return"( "+t+" != vec3( 0.0 ) )";case"b <- v4":return"( "+t+" != vec4( 0.0 ) )";case"b <- i":return"( "+t+" != 0 )"}return t}getTypeByFormat(t){return NB[t]||t}getFormatByType(t){return UB[t]||t}getUUID(t,e){return(e=void 0===e||e)&&this.cache&&(t=this.cache+"-"+t),t}getElementByIndex(t){return IB[t]}getIndexByElement(t){return IB.indexOf(t)}isShader(t){return this.shader===t}setShader(t){return this.shader=t,this}mergeDefines(t){for(let e in t)this.defines[e]=t[e];return this.defines}mergeUniform(t){for(let e in t)this.uniforms[e]=t[e];return this.uniforms}getTextureEncodingFromMap(t){let e;return t?t.isTexture&&(e=t.encoding):e=i.LinearEncoding,e===i.LinearEncoding&&this.context.gamma&&(e=i.sRGBEncoding),e}},BB=class extends Qk{constructor(t=0,e,n,i){super("c"),this.nodeType="Color",this.value=t instanceof nB?t:new nB(t||0,e,n,i)}setRGBA(t){this.value.setRGBA(t.r,t.g,t.b,t.a)}generate(t,e,n,i,r,s){n=t.getUUID(n??this.getUUID()),i=i??this.getType(t);let a=t.getNodeData(n),o=this.getReadonly()&&void 0!==this.generateReadonly;if(this.alpha){let e=this.alpha.build(t,"f");t.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${e};`)}return o?this.generateReadonly(t,e,n,i,r,s):t.isShader("vertex")?(a.vertex||(a.vertex=t.createVertexUniform(i,this,r,s,this.getLabel())),t.format(a.vertex.name,i,e)):(a.fragment||(a.fragment=t.createFragmentUniform(i,this,r,s,this.getLabel())),t.format(a.fragment.name,i,e))}generateReadonly(t,e,n,i,r,s){return t.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",i,e)}},FB=class extends Qk{constructor(t){super("i"),this.nodeType="Int",this.value=Math.floor(t??0)}generateReadonly(t,e,n,i,r,s){return t.format(this.value.toString(),i,e)}},VB=class extends Qk{constructor(t){super("b"),this.nodeType="Bool",this.value=t??!1}generateReadonly(t,e,n,i){return t.format(this.value?"true":"false",i,e)}},jB=class extends Qk{constructor(t=1,e){super("f[]"),this.nodeType="FloatArray",this.size=t,this.value=Array.isArray(e)?e:"number"==typeof e?new Array(t).fill(e):new Array(t).fill(0)}},HB=class extends Qk{},GB=class extends HB{constructor(t){super("v3"),this.image=t,this._value=new $m}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},WB=class extends HB{constructor(t,e,n=1008,i=1006){super("t"),this.image=t,this.wrap=e,this.minFilter=n,this.magFilter=i}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},qB=class extends Qk{constructor(t){super("m3"),this.nodeType="Matrix3",this.value=t??new xm}generateReadonly(t,e,n,i,r,s){return t.format("mat3("+this.value.elements.join(", ")+")",i,e)}get elements(){return this.value.elements}set elements(t){this.value.fromArray(t)}},XB=class extends Qk{constructor(t){super("m4"),this.nodeType="Matrix4",this.value=t??new Mg}generateReadonly(t,e,n,i,r,s){return t.format("mat4("+this.value.elements.join(", ")+")",i,e)}get elements(){return this.value.elements}set elements(t){this.value.fromArray(t)}};function $B(t,e,n,i=0){t.setUvTransform(n[0],n[1],e[0],e[1],0,0,0).premultiply((new xm).makeRotation(i*vm.DEG2RAD))}var YB=class extends qB{constructor(t,e,n=0){super(new xm),this.repeat=t,this.offset=e,this.rotation=n,$B(this.value,t,e,n)}updateMatrix(){$B(this.value,this.repeat,this.offset,this.rotation)}},ZB=class extends Qk{constructor(t=1,e){super("v4[]"),this.nodeType="Vector4Array",this.size=t,this.value=Array.isArray(e)?e:e instanceof jm?new Array(t).fill(e):new Array(t).fill(new jm(0))}},KB=class extends Jk{constructor(t,e,n,i){super("v3"),this.nodeType="Blend",this.a=t,this.b=e,this.alpha=n,this.mode=i}generate(t,e){if(t.isShader("fragment")){let n=[];return n.push(this.a.build(t,"c")),n.push(this.b.build(t,"c")),n.push(this.alpha.build(t,"f")),n.push(this.mode.build(t,"i")),t.format("spe_blend("+n.join(",")+")",this.getType(t),e)}return console.warn("BlendNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},JB=class extends Jk{constructor(t,e){super("v3"),this.nodeType="CustomColor",this.color=t,this.alpha=e,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){let n=t.include(JB.Nodes.customColor);t.addFragmentVariable(this.calpha,"float");let i=[];return i.push(this.color.build(t,"v3")),i.push(this.mask?`luminance(${this.mask.build(t,"v3")})`:"1.0"),i.push(this.alpha.build(t,"f")),i.push(this.calpha),t.format(n+"("+i.join(",")+")",this.getType(t),e)}return console.warn("CustomColorNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},QB=JB;QB.Nodes={customColor:new aB("vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color;\n\t\t\t}")};var tF=class extends Jk{constructor(t,e){super("v3"),this.nodeType="CustomNormal",this.cnormal=t,this.alpha=e,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){let n=t.include(tF.Nodes.customNormal);t.addFragmentVariable(this.calpha,"float");let i=[];return i.push(this.cnormal.build(t,"v3")),i.push("normal"),i.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),i.push(this.alpha.build(t,"f")),i.push(this.calpha),t.format(n+"("+i.join(",")+")",this.getType(t),e)}return console.warn("CustomNormalNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},eF=tF;eF.Nodes={customNormal:new aB("vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {\n\t\t\t\tvec3 normal = packNormalToRGB( norm ).rgb;\n\t\t\t\tnormal *= step( vec3(0.5), cnormal );\n\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\n\t\t\t\treturn normal;\n\t\t\t}")};var nF=class extends Jk{constructor(t,e,n,i,r,s,a,o,l,c,h,u){super("v3"),this.nodeType="CustomTexture",this.texture=t,this.textureSize=e,this.crop=n,this.projection=i,this.axis=r,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=u,this.alpha=c,this.mode=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){t.require("position"),t.require("normal"),t.require("uv"),t.requires.uv=[!0],t.extensions.shaderTextureLOD=!0,t.extensions.derivatives=!0;let n,i=`g${this.uuid.toString().replace(/-/g,"")}`;switch(this.projection.value){case 3:n=t.include(nF.Nodes.cylindrical);break;case 2:n=t.include(nF.Nodes.spherical);break;case 1:let e=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],r=["zy","xz","xy"][this.axis.value],s=new aB(`\n\t\tvec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 projected = (1. + (position.${r})) / 2.;\n\t\t\t\tvec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\t${2===this.side.value?"":`lalpha *= step(0.0, ${1===this.side.value?"-1.0 * ":""}dot(vObjectNormal, ${e}));`}\n\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}`);n=t.include(s);break;case 4:n=t.include(nF.Nodes.triplanar);break;default:n=t.include(nF.Nodes.uv)}t.addFragmentVariable(this.calpha,"float");let r=[];if(r.push("normal"),r.push(this.texture.generate(t,"t")),r.push(this.textureSize.build(t,"v2")),r.push(this.crop.build(t,"f")),r.push(this.mat.build(t,"mat3")),r.push(this.size.build(t,"v2")),r.push(this.blending.build(t,"f")),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.mode.build(t,"i")),r.push(this.calpha),4===this.projection.value){let e=`${i}_writeUvs`,n=e+"0",s=e+"1",a=e+"2",o=`${i}_triplanarWeights`;t.addFragmentVariable(n,"vec2"),t.addFragmentVariable(s,"vec2"),t.addFragmentVariable(a,"vec2"),t.addFragmentVariable(o,"vec3"),r.push(n),r.push(s),r.push(a),r.push(o)}else{let e=`${i}_writeUvs`;t.addFragmentVariable(e,"vec2"),r.push(e)}return t.format(n+"("+r.join(",")+")",this.getType(t),e)}},iF=nF;iF.Nodes={cylindrical:new aB("\nvec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(position);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float scaledHeight = position.y / (size.y * 0.5);\n                float v =  (scaledHeight / 2.) + .5;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\t\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),spherical:new aB("\nvec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(vPosition);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float v = 0.5 + asin(posN.y) / 3.1415;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),uv:new aB("vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}"),triplanar:new aB("vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {\n\t\t\t\tvec3 p = position;\n\t\t\t\tvec2 uv0 = (1.0 + p.xy) / 2.0;     \n\t\t\t\tvec2 uv1 = (1.0 + p.zy) / 2.0;\t\t\n\t\t\t\tvec2 uv2 = (1.0 + p.xz) / 2.0;\t\t\n\t\n\t\t\t\tuv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\n\t\t\t\t// Write out all sets of UVs that we generated\n\t\t\t\twriteUvs0 = uv0;\n\t\t\t\twriteUvs1 = uv1;\n\t\t\t\twriteUvs2 = uv2;\n\t\t\t\twriteWeights = weights;\n\n\t\t\t\t// Derivatives for LOD\n\t\t\t\tvec2 df0 = fwidth(uv0);\n\t\t\t\tvec2 df1 = fwidth(uv1);\n\t\t\t\tvec2 df2 = fwidth(uv2);\n\t\t\t\tif (df0.x > 0.5) df0.x = 0.0;\n\t\t\t\tif (df1.x > 0.5) df1.x = 0.0;\n\t\t\t\tif (df2.x > 0.5) df2.x = 0.0;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                \tvec4 tmp = \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#else\n                \tvec4 tmp = \n\t\t\t\t\t\ttextureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttextureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttextureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\n\t\t\t\t// Apply cropping across all 3 planes\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;//n * 0.5 + 0.5;\n\t\t\t}\t\t\t\n\t\t\t")};var rF=class extends Jk{constructor(t,e,n,i,r,s,a,o,l,c,h,u){super("v3"),this.nodeType="Depth",this.gradientType=t,this.smooth=e,this.near=n,this.far=i,this.isVector=r,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=c,this.isMask=u,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){let n=`g${this.uuid.toString().replace(/-/g,"")}`,i=new aB(`vec3 ${n}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${n}_MAX_COLORS], float steps[${n}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {\n               vec4 color = colors[0];\n               #ifdef ${n}_IS_VECTOR\n                   #ifdef ${n}_LINEAR\n                       #ifdef ${n}_WORLDSPACE\n                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);\n                       #else\n                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);\n                       #endif\n                   #else\n                       #ifdef ${n}_WORLDSPACE\n                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);\n                       #else\n                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);\n                       #endif\n                   #endif\n               #else\n                   float dist = length(vWPosition - cameraPosition);\n\t\t\t       float depth = ( dist - near ) / ( far - near );\n               #endif\n\n\n              float p;\n              #ifdef ${n}_SMOOTH\n\t\t\t\tfor ( int i = 1; i < ${n}_MAX_COLORS; i++ ) {\n\t\t\t\t\t\tp = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n              #else\n                for ( int i = 1; i < ${n}_MAX_COLORS; i++ ) {\n                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);\n                   color = mix(color, colors[i], p);\n                 }\n              #endif\n\n               float lalpha = alpha * color.a * mask;\n               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t   \n               return color.rgb;\n\t\t\t}`,[rF.Nodes.vectorLinearWorldSpaceDepth,rF.Nodes.vectorLinearObjectSpaceDepth,rF.Nodes.vectorSphericalObjectSpaceDepth,rF.Nodes.vectorSphericalWorldSpaceDepth]);if(t.isShader("fragment")){t.define(`${n}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&t.define(`${n}_SMOOTH`),this.isVector.value>.5&&t.define(`${n}_IS_VECTOR`),0===this.gradientType.value&&t.define(`${n}_LINEAR`),this.isWorldSpace.value>.5&&t.define(`${n}_WORLDSPACE`),t.require("worldPosition"),t.addFragmentVariable(this.calpha,"float");let r=t.include(i),s=[];return s.push(this.near.build(t,"f")),s.push(this.far.build(t,"f")),s.push(this.origin.build(t,"v3")),s.push(this.direction.build(t,"v3")),s.push(this.colors.build(t,"v4[]")),s.push(this.steps.build(t,"f[]")),s.push(this.isMask.build(t,"b")),s.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),s.push(this.alpha.build(t,"f")),s.push(this.calpha),t.format(r+"("+s.join(",")+")",this.getType(t),e)}return console.warn("DepthNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},sF=rF;sF.Nodes={vectorLinearWorldSpaceDepth:new aB("float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorLinearObjectSpaceDepth:new aB("float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalWorldSpaceDepth:new aB("float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(vWPosition - origin);\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalObjectSpaceDepth:new aB("float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(position - origin);\n               return ( dist - near ) / ( far - near );\n            }")};var aF=class extends Jk{constructor(t,e,n,i,r,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=t,this.bias=e,this.scale=n,this.intensity=i,this.factor=r,this.isMask=o,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("vWorldViewDir"),t.require("worldNormal"),t.isShader("fragment")){t.addFragmentVariable(this.calpha,"float");let n=new aB("vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\t\t\t\t\tfloat fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );\n\n\t\t\t\t\tfloat lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn color;\n\t\t\t\t}"),i=t.include(n),r=[];return r.push(this.color.build(t,"c")),r.push(this.bias.build(t,"f")),r.push(this.scale.build(t,"f")),r.push(this.intensity.build(t,"f")),r.push(this.factor.build(t,"f")),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.mode.build(t,"i")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}return console.warn("FresnelNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},oF=class extends Jk{constructor(t,e,n,i,r,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=t,this.smooth=e,this.colors=n,this.steps=i,this.offset=r,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){t.define("GRAD_MAX",10),t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let n=t.include(oF.Nodes.gradient),i=[];return i.push(this.gradientType.build(t,"i")),i.push(this.smooth.build(t,"b")),i.push(this.colors.build(t,"v4[]")),i.push(this.steps.build(t,"f[]")),i.push(this.offset.build(t,"v2")),i.push(this.morph.build(t,"v2")),i.push(this.angle.build(t,"f")),i.push(this.isMask.build(t,"b")),i.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),i.push(this.alpha.build(t,"f")),i.push(this.calpha),t.format(n+"("+i.join(",")+")",this.getType(t),e)}return console.warn("GradientNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},lF=oF;lF.Nodes={gradient:new aB("vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tvec2 m = morph / vUv.xy;\n\t\t\t\tvec2 rot = vec2( 0.5 + m.x, m.y );\n\t\t\t\tvec2 dt = vec2(\n\t\t\t\t\tcos( angle ) * rot.x - sin( angle ) * rot.y,\n\t\t\t\t\tsin( angle ) * rot.x + cos( angle ) * rot.y\n\t\t\t\t);\n\t\t\t\tvec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;\n\t\t\t\tfloat t = dot( pt, dt ) / dot( dt, dt );\n\t\t\t\tif ( gradientType == 1 ) {\n\t\t\t\t\tt = distance (\n\t\t\t\t\t\t( vUv + morph ) * 3.0,\n\t\t\t\t\t\t( vUv + offset ) + 1.0\n\t\t\t\t\t) + angle;\n\t\t\t\t} else if ( gradientType == 2 ) {\n\t\t\t\t\tfloat polar = atan(\n\t\t\t\t\t\tvUv.x + morph.x - 0.5 + offset.x,\n\t\t\t\t\t\tvUv.y + morph.y - 0.5 + offset.y\n\t\t\t\t\t) * -1.0;\n\t\t\t\t\tt = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );\n\t\t\t\t}\n\n\t\t\t\tfloat p;\n\t\t\t\tif (smoothed) {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\n\t\t\t\treturn color.xyz;\n\t\t\t}")};var cF=class extends Jk{constructor(t,e,n,i,r){super("v3"),this.nodeType="Matcap",this.texture=t,this.isMask=i,this.alpha=e,this.mode=n,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=r}generate(t,e){if(t.isShader("fragment")){t.addFragmentVariable(this.calpha,"float");let n=t.include(cF.Nodes.matcap);t.require("normal"),t.requires.normal=!0;let i=[];return i.push(this.texture.generate(t,"t")),i.push("normal"),i.push(this.isMask.build(t,"b")),i.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),i.push(this.alpha.build(t,"f")),i.push(this.mode.build(t,"i")),i.push(this.calpha),i.push(this.rotation.build(t,"f")),t.format(n+"("+i.join(",")+")",this.getType(t),e)}return console.warn("MatcapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},hF=cF;hF.Nodes={matcap:new aB("vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {\n\t\t\t\t\tvec3 viewDir = normalize( vViewPosition );\n\t\t\t\t\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\t\t\t\t\tvec3 y = cross( viewDir, x );\n\t\t\t\t\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) );\n\t\t\t\t\tuv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;\n\t\t\t\t\tuv = uv * 0.495 + 0.5;\n\t\t\t\t\tvec4 matcapColor = texture2D( matcapTex, uv );\n\n\t\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\t\n\t\t\t\t\treturn matcapColor.rgb;\n            \t}")};var uF=function(){let t=new aB("vec3 random3(vec3 c) {\n\t\t\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\t\t\tvec3 r;\n\t\t\tr.z = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.x = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.y = fract(512.0*j);\n\t\t\treturn r-0.5;\n\t\t}"),e=new aB("float simplexFast(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t mediump vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t mediump vec3 hs = s;\n\t\t\t \n\t\t\t mediump vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t mediump vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t mediump vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t mediump vec3 x1 = x - i1 + G3;\n\t\t\t mediump vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t mediump vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t mediump vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(hs), x);\n\t\t\t d.y = dot(random3(hs + i1), x1);\n\t\t\t d.z = dot(random3(hs + i2), x2);\n\t\t\t d.w = dot(random3(hs + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[t]);e.keywords.F3=new cB("float F3 0.3333333"),e.keywords.G3=new cB("float G3 0.1666667");let n=new aB("float simplexPrecise(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t \n\t\t\t vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t vec3 x1 = x - i1 + G3;\n\t\t\t vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(s), x);\n\t\t\t d.y = dot(random3(s + i1), x1);\n\t\t\t d.z = dot(random3(s + i2), x2);\n\t\t\t d.w = dot(random3(s + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[t]);n.keywords.F3=new cB("float F3 0.3333333"),n.keywords.G3=new cB("float G3 0.1666667");let i=new aB("float simplexFractal(vec3 m) {\n\t\t\tmat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);\n\t\t\tmat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);\n\t\t\tmat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);\n\t\t\treturn 0.5333333 * simplexFast(m * rot1)\n\t\t\t\t + 0.2666667 * simplexFast(2.0 * m * rot2)\n\t\t\t\t + 0.1333333 * simplexFast(4.0 * m * rot3)\n\t\t\t\t + 0.0666667 * simplexFast(8.0 * m);\n\t\t}",[e]),r=new aB("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new aB("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new aB("float simplexAshima(vec3 v) {\n\t\t  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t  vec3 i  = floor(v + dot(v, C.yyy) );\n\t\t  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\t\t  vec3 g = step(x0.yzx, x0.xyz);\n\t\t  vec3 l = 1.0 - g;\n\t\t  vec3 i1 = min( g.xyz, l.zxy );\n\t\t  vec3 i2 = max( g.xyz, l.zxy );\n\t\t  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\t\t  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\t\t  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\t\t  i = mod(i, 289.0 ); \n\t\t  vec4 p = permute( permute( permute( \n\t\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n\t\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t  float n_ = 1.0/7.0; // N=7\n\t\t  vec3  ns = n_ * D.wyz - D.xzx;\n\t\t  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\t\t  vec4 x_ = floor(j * ns.z);\n\t\t  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\t\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t\t  vec4 h = 1.0 - abs(x) - abs(y);\n\t\t  vec4 b0 = vec4( x.xy, y.xy );\n\t\t  vec4 b1 = vec4( x.zw, y.zw );\n\t\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t  vec4 sh = -step(h, vec4(0.0));\n\t\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t  vec3 p0 = vec3(a0.xy,h.x);\n\t\t  vec3 p1 = vec3(a0.zw,h.y);\n\t\t  vec3 p2 = vec3(a1.xy,h.z);\n\t\t  vec3 p3 = vec3(a1.zw,h.w);\n\t\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t  p0 *= norm.x;\n\t\t  p1 *= norm.y;\n\t\t  p2 *= norm.z;\n\t\t  p3 *= norm.w;\n\t\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t  m = m * m;\n\t\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n\t\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t\t}",[r,s]),o=new aB("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),l=new aB("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),c=new aB("float noise(vec3 p){\n\t\t\tvec3 a = floor(p);\n\t\t\tvec3 d = p - a;\n\t\t\td = d * d * (3.0 - 2.0 * d);\n\t\t\tvec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n\t\t\tvec4 k1 = perm(b.xyxy);\n\t\t\tvec4 k2 = perm(k1.xyxy + b.zzww);\n\t\t\tvec4 c = k2 + a.zzzz;\n\t\t\tvec4 k3 = perm(c);\n\t\t\tvec4 k4 = perm(c + 1.0);\n\t\t\tvec4 o1 = fract(k3 * (1.0 / 41.0));\n\t\t\tvec4 o2 = fract(k4 * (1.0 / 41.0));\n\t\t\tvec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n\t\t\tvec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\t\t\treturn o4.y * d.y + o4.x * (1.0 - d.y);\n\t\t}",[l]),h=new aB("float fbm(vec3 x) {\n\t\t\tfloat v = 0.0;\n\t\t\tfloat a = 0.5;\n\t\t\tvec3 shift = vec3(100);\n\t\t\tfor (int i = 0; i < NUM_OCTAVES; ++i) {\n\t\t\t\tv += a * noise(x);\n\t\t\t\tx = x * 2.0 + shift;\n\t\t\t\ta *= 0.5;\n\t\t\t}\n\t\t\treturn v;\n\t\t}",[c]);h.keywords.NUM_OCTAVES=new cB("int NUM_OCTAVES 5");let u=new aB("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),d=new aB("float perlin(vec3 P){\n\t\t  vec3 Pi0 = floor(P);\n\t\t  vec3 Pi1 = Pi0 + vec3(1.0);\n\t\t  Pi0 = mod(Pi0, 289.0);\n\t\t  Pi1 = mod(Pi1, 289.0);\n\t\t  vec3 Pf0 = fract(P);\n\t\t  vec3 Pf1 = Pf0 - vec3(1.0);\n\t\t  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\t\t  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n\t\t  vec4 iz0 = Pi0.zzzz;\n\t\t  vec4 iz1 = Pi1.zzzz;\n\t\t  vec4 ixy = permute(permute(ix) + iy);\n\t\t  vec4 ixy0 = permute(ixy + iz0);\n\t\t  vec4 ixy1 = permute(ixy + iz1);\n\t\t  vec4 gx0 = ixy0 / 7.0;\n\t\t  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n\t\t  gx0 = fract(gx0);\n\t\t  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\t\t  vec4 sz0 = step(gz0, vec4(0.0));\n\t\t  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\t\t  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\t\t  vec4 gx1 = ixy1 / 7.0;\n\t\t  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n\t\t  gx1 = fract(gx1);\n\t\t  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\t\t  vec4 sz1 = step(gz1, vec4(0.0));\n\t\t  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\t\t  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\t\t  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\t\t  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\t\t  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\t\t  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\t\t  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\t\t  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\t\t  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\t\t  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\t\t  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\t\t  g000 *= norm0.x;\n\t\t  g010 *= norm0.y;\n\t\t  g100 *= norm0.z;\n\t\t  g110 *= norm0.w;\n\t\t  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\t\t  g001 *= norm1.x;\n\t\t  g011 *= norm1.y;\n\t\t  g101 *= norm1.z;\n\t\t  g111 *= norm1.w;\n\t\t  float n000 = dot(g000, Pf0);\n\t\t  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\t\t  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\t\t  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\t\t  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\t\t  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\t\t  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\t\t  float n111 = dot(g111, Pf1);\n\t\t  vec3 fade_xyz = fade(Pf0);\n\t\t  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\t\t  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\t\t  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n\t\t  return 2.2 * n_xyz;\n\t\t}",[r,s,u]),p=new aB("float hashwithoutsine13(vec3 p3)\n\t\t{\n\t\t\tp3  = fract(p3 * .1031);\n\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t}"),f=new aB("vec3 hashwithoutsine33(vec3 p3)\n\t\t{\n\t\t\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\n\t\t\tp3 += dot(p3, p3.yxz+33.33);\n\t\t\treturn fract((p3.xxy + p3.yxx)*p3.zyx);\n\t\t}"),m=new aB("float metric(in vec3 p)\n\t\t{\n\t\t\t// L2 \n\t\t\treturn length(p);\n\n\t\t\t// Chebyshev \n\t\t\t// vec3 a = abs(p);\n\t\t\t// return max(a.x, max(a.y, a.z));\n\t\t}"),g=new aB("float smin( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(b, a, h) - correction;\n\t\t}"),v=new aB("float smax( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(a, b, h) + correction;\n\t\t}"),y=new aB("float remap(float value, float input_min, float input_max, float output_min, float output_max) {\n\t\t\t// Compute width of each interval\n\t\t\tfloat input_width = input_max - input_min;\n\t\t\tfloat output_width = output_max - output_min;\n\t\t\n\t\t\t// Convert input range into a 0-1 range \n\t\t\tfloat scaled = (value - input_min) / input_width;\n\t\t\n\t\t\t// Convert the 0-1 range into a value in output range\n\t\t\treturn output_min + (scaled * output_width);\n\t\t}");return{simplexFast:e,simplexPrecise:n,simplexFractal:i,simplexAshima:a,fbm:h,perlin:d,voronoi:new aB('float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) \n\t\t{\n\t\t\t// Integer and fractional parts of this point\'s coordinates\n\t\t\tivec3 p = ivec3(floor(x));\n\t\t\tvec3 f = fract(x);\n\n\t\t\t// Different variables that we will use to construct noise:\n\t\t\t//\n\t\t\t// f1: distance to the closest feature point\n\t\t\t// f2: distance to the second closest feature point\n\t\t\t// e: distance to the closest edge (cell boundary)\n\t\t\t//\n\t\t\t// We also compute "smooth" versions of all of the above quantites, essentially\n\t\t\t// replacing "hard" minimums with "smooth" minimums (described by IQ)\n\t\t\tfloat f1_smooth = 8.0;\n\t\t\tfloat f1 = 8.0;\n\t\t\tfloat f2_smooth = 8.0;\n\t\t\tfloat f2 = 8.0;\n\t\t\tfloat e_smooth = 8.0;\n\t\t\tfloat e = 8.0;\n\n\t\t\t// Variables stored from closest cell\n\t\t\tivec3 mb;\n\t\t\tvec3 mr; \n\n\t\t\tint steps = quality;\n\t\t\t\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d = length(r);\n\t\t\t\t\n\t\t\t\tf1_smooth = smin(d, f1_smooth, smoothness);\n\n\t\t\t\t// Store un-smoothed distances too \n\t\t\t\tif (d < f1) \n\t\t\t\t{\n\t\t\t\t\tf2 = f1;\n\t\t\t\t\tf1 = d;\n\n\t\t\t\t\tmb = ivec3(x, y, z);\n\t\t\t\t\tmr = r;\n\t\t\t\t} \n\t\t\t\telse if (d < f2) \n\t\t\t\t{\n\t\t\t\t\tf2 = d;\n\t\t\t\t}\n\t\t\t}\t\n\t\t\t\n\t\t\t// Second pass for edge distance  \n\t\t\t// skip for styles don\'t need\n\t\t\tif (style != 0 &&  style != 5 && style != 7)\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\t// Start search at the cell that contains the closest point to "x" (found in 1st pass)\n\t\t\t\tivec3 b = mb + ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d1 = dot(0.5 * (mr + r), (r - mr)); \t\t\t\t// IQ normalizes "r - mr" but that breaks things for the smooth version?\n\t\t\t\tfloat d2 = dot(0.5 * (mr + r), normalize(r - mr));\n\n\t\t\t\te_smooth = smin(d1, e_smooth, smoothness);\n\n\t\t\t\te = min(e, d2);\n\n\t\t\t\t// Also compute a smooth version of F2 in this pass\n\t\t\t\t{\n\t\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\t\tif (b != mb) \n\t\t\t\t\t{\n\t\t\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\t\t\tfloat d = length(r);\n\n\t\t\t\t\t\tf2_smooth = smin(d, f2_smooth, smoothness);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Different visualization modes \n\t\t\tif (style == 0) \n\t\t\t{\n\t\t\t\treturn f1_smooth;\n\t\t\t}\n\t\t\tif (style == 1) \n\t\t\t{\n\t\t\t\treturn f2_smooth;\n\t\t\t}\n\t\t\tif (style == 2) \n\t\t\t{\n\t\t\t\treturn f2_smooth - f1_smooth;\n\t\t\t\t\n\t\t\t\t// "Pebbles" also cool\n\t\t\t\t//return step(0.2, f2_smooth - f1_smooth);\n\t\t\t}\n\t\t\tif (style == 3) \n\t\t\t{\n\t\t\t\t// This one is really good for rock / stone effects\n\t\t\t\tfloat a = f1; \n\t\t\t\tfloat b = f2;\n\t\t\t\tfloat k = 3.0;\n\t\t\t\tfloat h = max(k - abs(a - b), 0.0) / k;\n\t\t\t\tfloat final = min(a, b) - h * h * k * (1.0 / 4.0);\n\t\t\t\treturn final;\n\t\t\t}\n\t\t\tif (style == 4) \n\t\t\t{\n\t\t\t\t// Some random adjustments to make this style stand out more \n\t\t\t\treturn exp(5.0 * e_smooth);\n\t\t\t}\n\t\t\tif (style == 5) \n\t\t\t{\n\t\t\t\treturn pow(f1_smooth, 3.0);\n\t\t\t}\n\t\t\tif (style == 6) \n\t\t\t{\t\t\t\t\n\t\t\t\tconst float eps = 0.0125;\n\n\t\t\t\t// Thicker lines as the user increases the smoothness slider\n\t\t\t\tfloat thickness = smoothness * 0.25 + eps;\n\n\t\t\t\t// Blurrier lines as the user increases the smoothness slider\n\t\t\t\tfloat blur = pow(smoothness, 3.0) * 0.25 + eps;\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\tthickness - thickness * blur, \n\t\t\t\t\tthickness + thickness * blur, \n\t\t\t\t\te\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (style == 7) \n\t\t\t{\n\t\t\t\treturn hashwithoutsine13(vec3(p + mb) + seed);\n\t\t\t}\n\t\t}\n\t',[p,f,m,g,v,y])}}(),dF=class extends Jk{constructor(t,e,n,i,r,s,a,o,l,c,h,u,d,p,f,m,g,v,y){super("v3"),this.nodeType="Noise",this.scale=t,this.size=e,this.move=n,this.fA=i,this.fB=r,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=c,this.noiseType=u,this.voronoiStyle=p,this.highCut=f,this.lowCut=m,this.smoothness=g,this.seed=v,this.quality=y,this.isMask=d,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e,n,i,r){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let s=["simplexFast","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseType.value],a=new aB(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) \n\t\t\t{\n                // Prevent scale of zero \n\t\t\t\tscale = max(abs(scale), 0.001);\n\n\t\t\t\tvec3 st = position / size;\n\t\t\t\tst /= scale;\n\n\t\t\t\t${"voronoi"==s?`\n\t\tfloat v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);\n\n\t\t// Apply clipping to colors\n\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t// Note that the voronoi mode only uses colors "A" and "C" from the UI \n\t\tvec4 color = mix(colorA, colorC, v); \n\t\t`:`\n\t\tvec3 q = vec3(${s}(st),\n\t\t\t\t\t   ${s}(st + vec3(1.0)),\n\t\t\t\t\t   ${s}(st + vec3(1.0)));\n\t\tvec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),\n\t\t\t\t\t  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), \n\t\t\t\t\t  ${s}(st * q));\n\t\tfloat f = ${s}(st + r);\n\t\tvec4 color;\n\t\tcolor = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));\n\t\tcolor = mix(color, colorC, clamp(length(q), 0.0, 1.0));\n\t\tcolor = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));\n\t\t`}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t}`,[uF.simplexFast,uF.simplexFractal,uF.simplexAshima,uF.fbm,uF.perlin,uF.voronoi]),o=t.include(a),l=[];return l.push(this.scale.build(t,"f")),l.push(this.size.build(t,"v3")),l.push(this.move.build(t,"f")),l.push(this.fA.build(t,"v2")),l.push(this.fB.build(t,"v2")),l.push(this.distortion.build(t,"v2")),l.push(this.colorA.build(t,"v4")),l.push(this.colorB.build(t,"v4")),l.push(this.colorC.build(t,"v4")),l.push(this.colorD.build(t,"v4")),l.push(this.voronoiStyle.build(t,"i")),l.push(this.highCut.build(t,"f")),l.push(this.lowCut.build(t,"f")),l.push(this.smoothness.build(t,"f")),l.push(this.seed.build(t,"f")),l.push(this.quality.build(t,"i")),l.push(this.isMask.build(t,"b")),l.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),l.push(this.alpha.build(t,"f")),l.push(this.calpha),t.format(o+"("+l.join(",")+")",this.getType(t),e)}};dF.numOctaves=5;var pF=class extends Jk{constructor(t,e,n,i,r,s,a,o,l,c,h,u,d,p,f,m){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=t,this.contourColor=e,this.outlineWidth=n,this.contourWidth=i,this.contourThreshold=r,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=c,this.compensation=h,this.resolution=u,this.normalMap=d,this.depthMap=p,this.pixelRatio=f,this.alpha=m,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){let n=`g${this.uuid.toString().replace(/-/g,"")}`;if(t.require("vWorldViewDir"),t.require("worldNormal"),t.extensions.derivatives=!0,this.compensation.value&&t.define("OUTLINE_COMPENSATION",`${n}_offset`),this.firstTime){let e=this.outlineWidth.build(t,"f"),i=this.resolution.build(t,"v2"),r=this.compensation.build(t,"b"),s=this.pixelRatio.build(t,"f");t.addVertexParsVariable("randomColor","attribute vec3"),t.addVertexParsVariable("extrudeNormal","attribute vec3"),t.addVertexParsVariable(e,"uniform float"),t.addVertexParsVariable(i,"uniform vec2"),t.addVertexParsVariable(r,"uniform bool"),t.addVertexParsVariable(s,"uniform float"),t.addVertexParsVariable("vID","flat out float"),t.addFragmentParsVariable("vID","flat in float"),t.addVertexFinalCode(`\n                vID = randomColor.r;\n                vec2 ${n}_offset = vec2(0.0);\n                if (${r}) {\n                    vec4 ${n}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));\n                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the\n                    // normals face the camera directly. So we hackily fix this by offsetting the normal\n                    // by a tiny amount.\n                    vec3 ${n}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;\n                    ${n}_offset = normalize(${n}_clipNormal.xy) / ${i} * (${e} / 2.0) * ${n}_clipPosition.w * 2.0 * ${s};\n                    ${n}_clipPosition.xy += ${n}_offset;\n                    // TODO(MAX): To handle multiple outline layers, we only want to extrude\n                    // if this offset is the biggest of all the potential offsets\n                    gl_Position = ${n}_clipPosition;\n                }\n            `)}if(t.isShader("fragment")){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let n=t.include(pF.Nodes.outline),i=[];return i.push(this.outlineColor.build(t,"c")),i.push(this.contourColor.build(t,"c")),i.push(this.outlineWidth.build(t,"f")),i.push(this.contourWidth.build(t,"f")),i.push(this.contourThreshold.build(t,"f")),i.push(this.outlineThreshold.build(t,"f")),i.push(this.contourFrequency.build(t,"f")),i.push(this.outlineSmoothing.build(t,"f")),i.push(this.contourDirection.build(t,"v3")),i.push(this.positionalLines.build(t,"b")),i.push(this.resolution.build(t,"v2")),i.push(this.normalMap.getTexture(t,"t")),i.push(this.depthMap.getTexture(t,"t")),i.push(this.pixelRatio.build(t,"f")),i.push(this.compensation.build(t,"b")),i.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),i.push(this.alpha.build(t,"f")),i.push(this.calpha),this.firstTime=!this.firstTime,t.format(n+"("+i.join(",")+")",this.getType(t),e)}return console.warn("OutlineNode is not compatible with "+t.shader+" shader."),""}},fF=pF;fF.Nodes=function(){let t=new aB("\nfloat sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)\n{\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    vec2 texelSize = (vec2(1.0) / resolution);\n    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;\n\n    vec2 uvSamples[9];\n    vec4 normalSamples[9];\n\n\tuvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);\n\tuvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);\n\tuvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);\n\tuvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);\n\tuvSamples[4] = uv;\n\tuvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);\n\tuvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);\n\tuvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);\n\tuvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);\n\n\n    normalSamples[0] = texture2D(t, uvSamples[0]);\n    normalSamples[1] = texture2D(t, uvSamples[1]);\n    normalSamples[2] = texture2D(t, uvSamples[2]);\n    normalSamples[3] = texture2D(t, uvSamples[3]);\n    normalSamples[4] = texture2D(t, uvSamples[4]);\n    normalSamples[5] = texture2D(t, uvSamples[5]);\n    normalSamples[6] = texture2D(t, uvSamples[6]);\n    normalSamples[7] = texture2D(t, uvSamples[7]);\n    normalSamples[8] = texture2D(t, uvSamples[8]);\n\n    float depthBias = 0.0001;\n    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!\n    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n\n    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);\n  \tvec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);\n\n    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));\n    return edgeNormal;\n}\n");return{outline:new aB("vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {\n                vec3 result = outlineColor;\n                float resultAlpha = 0.0;\n\n                vec3 N = normalize(vWNormal);\n                vec2 nuv = (gl_FragCoord.xy / resolution);\n                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);\n                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);\n\n                //resultAlpha = 1.0;\n                //result = vec3(sobelSample);\n\n                float t = 1.0 - contourThreshold;\n                if(positionalLines) {\n                    vec3 NDir = position * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float f  = fract(NT * contourFrequency * 0.01);\n                    float df = fwidth(NT * contourFrequency);\n\n                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);\n                    if (g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0;\n                    }\n                 }\n                 else {\n                    vec3 NDir = N * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float df = fwidth(NT * contourThreshold);\n                    float f = sin(NT * 1.0 * contourFrequency);\n                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);\n\n                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0 - g;\n                    }\n                 }\n\n                 float lalpha = alpha * resultAlpha * mask;\n                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\t \n                 return result;\n             }",[t])}}();var mF=class extends Jk{constructor(t,e,n,i,r,s,a,o,l,c,h,u,d,p,f,m,g,v){super("v3"),this.nodeType="Pattern",this.style=t,this.projection=e,this.axis=n,this.blending=i,this.offset=r,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=c,this.smoothness=h,this.zigzag=u,this.rotation=d,this.vertical=p,this.horizontal=f,this.sides=m,this.isMask=v,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){let n;switch(t.require("position"),t.require("uv"),t.requires.uv=[!0],t.require("normal"),t.requires.normal=!0,t.addFragmentVariable(this.calpha,"float"),this.style.value){case 0:default:n="circle";break;case 1:n="ring";break;case 2:n="polygon";break;case 3:n="xcross";break;case 4:n="diamond";break;case 5:n="checkerboard";break;case 6:n="line";break;case 7:n="wave"}let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new aB("float hashwithoutsine12(vec2 p)\n\t\t\t\t{\n\t\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * .1031);\n\t\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t\t}"),s=new aB("vec2 rotate_uv(in vec2 uv, float a, bool repeat) \n\t\t\t\t{\n\t\t\t\t\tconst float mid = 0.5;\n\t\t\t\t\tfloat radians = a * (PI / 180.0);\n\t\t\t\t\tvec2 rotated = vec2(\n\t\t\t\t\t\tcos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,\n\t\t\t\t\t\tcos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid\n\t\t\t\t\t);\n\t\t\t\t\treturn repeat ? fract(rotated): rotated;\n\t\t\t\t}"),a="";if(4===this.projection.value){a=`\n\t\t\t\tvec3 p = position;\n\t\t\t\tfloat factor = 0.0125;\n\t\t\t\tvec2 uv0 = fract(p.xy * factor);\n\t\t\t\tvec2 uv1 = fract(p.zy * factor);\n\t\t\t\tvec2 uv2 = fract(p.xz * factor);\n\t\t\t\t\n\t\t\t\tuv0 = rotate_uv(uv0 + offset, rotation, true);\n\t\t\t\tuv1 = rotate_uv(uv1 + offset, rotation, true);\n\t\t\t\tuv2 = rotate_uv(uv2 + offset, rotation, true);\n\t\n\t\t\t\tfloat d0 = ${2===this.style.value?`${n}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${n}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\tfloat d1 = ${2===this.style.value?`${n}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${n}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\tfloat d2 = ${2===this.style.value?`${n}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${n}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`};\n\t\t\t\t\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\t\t\t\td0 *= weights.z;\n\t\t\t\td1 *= weights.x;\n\t\t\t\td2 *= weights.y;\n\t\t\t\tfloat draw = d0 + d1 + d2;\n\t\n\t\t\t\tvec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;\n\t\t\t\t`}else{let t=2===this.style.value?`${n}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${n}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,e="";0===this.axis.value?e="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.z);\n\t\t\t\t\tfloat phi = acos(p.x / radius);":1===this.axis.value?e="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.x, p.z);\n\t\t\t\t\tfloat phi = acos(p.y / radius);":(this.axis.value,e="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.x);\n\t\t\t\t\tfloat phi = acos(p.z / radius);");let i="";switch(this.projection.value){case 0:i="custom_uv = vUv.st;";break;case 1:case 3:default:break;case 2:i=`\n\t\t\t\t\t\t\tvec3 p = position;\n\t\t\t\t\t\t\t${e}\n\t\t\t\t\t\t\tcustom_uv = vec2(theta, phi);\n\t\t\t\t\t\t\tcustom_uv /= PI;\n\t\t\t\t\t\t\t`}a=`\n\t\t\t\tvec2 custom_uv;\n\t\t\t\t${i}\n\t\n\t\t\t\tcustom_uv += offset;\n\t\t\t\tcustom_uv = fract(custom_uv);\n\t\t\t\tcustom_uv = rotate_uv(custom_uv, rotation, true);\n\t\n\t\t\t\tfloat draw = ${t};\n\t\t\t\t`}let o=new aB(`vec3 ${i}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\t\tconst float TWO_PI = PI * 2.0;\n\t\t\t\t\tfloat smoothness_remapped = pow(smoothness, 5.0);\t\n\n\t\t\t\t\t${a}\n\n\t\t\t\t\t// Construct final output color\n\t\t\t\t\tvec4 color = mix(colorA, colorB, draw);\n\t\t\t\t\tcolor.a = clamp(color.a, 0.0, 1.0);\n\n\t\t\t\t\t// Apply cuts\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(vertical.x, custom_uv.y) * \n\t\t\t\t\t\tstep(custom_uv.y, vertical.y);\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(horizontal.x, abs(custom_uv.x)) * \n\t\t\t\t\t\tstep(abs(custom_uv.x), horizontal.y);\n\n\t\t\t\t\t// Accumulate alpha \n\t\t\t\t\tfloat lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t\t}`,[s,r,mF.DrawFunctions.circle,mF.DrawFunctions.ring,mF.DrawFunctions.polygon,mF.DrawFunctions.cross,mF.DrawFunctions.diamond,mF.DrawFunctions.checkerboard,mF.DrawFunctions.line,mF.DrawFunctions.wave]),l=t.include(o),c=[];return c.push("normal"),c.push(this.blending.build(t,"f")),c.push(this.style.build(t,"i")),c.push(this.offset.build(t,"v2")),c.push(this.colorA.build(t,"v4")),c.push(this.colorB.build(t,"v4")),c.push(this.frequency.build(t,"v2")),c.push(this.size.build(t,"f")),c.push(this.variation.build(t,"f")),c.push(this.smoothness.build(t,"f")),c.push(this.zigzag.build(t,"f")),c.push(this.rotation.build(t,"f")),c.push(this.vertical.build(t,"v2")),c.push(this.horizontal.build(t,"v2")),c.push(this.sides.build(t,"i")),c.push(this.isMask.build(t,"b")),c.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),c.push(this.alpha.build(t,"f")),c.push(this.calpha),t.format(l+"("+c.join(",")+")",this.getType(t),e)}return console.warn("PatterNode is not compatible with "+t.shader+" shader."),t.format("vec3(0.0)",this.getType(t),e)}},gF=mF;gF.DrawFunctions=function(){let t=new aB("float hashwithoutsine12(vec2 p) {\n\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * 0.1031);\n\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t}"),e=new aB("vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {\n                // Create tiles in UV-space\n                uv *= frequency;\n\n                // Integer coords\n                vec2 i = floor(uv);\n\n                // Offset every other row based on zigzag param, then compute fractional coords\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = fract(uv);\n\n\t\t\t\t// Rotate the tile itself:\n\t\t\t\t// const float mid = 0.5;\n\t\t\t\t// f = vec2(\n\t\t\t\t// \tcos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,\n\t\t\t\t// \tcos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid\n\t\t\t\t// );\n\t\t\t\t// f = fract(f);\n\n                f = f * 2.0 - 1.0;\n\n\t\t\t\t// Recompute integer coords after shifting - then, random value per tile \n\t\t\t\ti = floor(uv);\n\t\t\t\tfloat rand = (hashwithoutsine12(i) * 5.0 + 1.0);\n\t\t\t\tfloat jitter = mix(1.0, rand, variation);\n\t\t\t\tf *= jitter;\n\n                return f;\n            }",[t]);return{tileAndCenter:e,circle:new aB("float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(\n                    -smoothness, \n                     smoothness, \n                     length(f) - size\n                );\n            }",[e]),ring:new aB("float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\n\t\t\t\tfloat d = length(f);\n                const float inner_width = 0.5;\n\n                float outer = smoothstep(-smoothness, smoothness, d - size);\n                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);\n\t\t\t\treturn outer + (1.0 - inner);   \n            }",[e]),polygon:new aB("float sdf_ngon(in vec2 p, in float r, in int n) {\n                float an = (PI * 2.0) / float(n);\n                float he = r * tan(0.5 * an);\n                \n                // Rotate to first sector\n                p = -p.yx; \n                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);\n                vec2  cs = vec2(cos(bn), sin(bn));\n                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;\n            \n                // Side of polygon\n                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);\n            }\n            \n            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));\n            }",[e]),cross:new aB("float sdf_cross(in vec2 p, in vec2 b, float r ) {\n                p = abs(p); \n\t\t\t\tp = (p.y > p.x) ? p.yx : p.xy;\n                vec2  q = p - b;\n                float k = max(q.y, q.x);\n                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);\n                return sign(k) * length(max(w, 0.0)) + r;\n            }\n            \n            // Avoid namespace conflicts \n            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));\n            }",[e]),diamond:new aB("float ndot(vec2 a, vec2 b) { \n                return a.x*b.x - a.y*b.y; \n            }\n            \n            float sdf_diamond(in vec2 p, in vec2 b) {\n                p = abs(p);\n                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);\n                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));\n                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);\n            }\n\n            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\t            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));\n            }",[e]),checkerboard:new aB("float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                uv *= frequency;\n                vec2 i = floor(uv);\n\n                float offset = mod(i.y, 2.0);\n\n                uv.x += offset + zigzag * offset;\n                float x = floor(uv.x);\n                \n                return mod(x, 2.0);\n            }"),line:new aB("float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);\n\t\t\t\t\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat row = floor(uv * frequency).y;\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(row));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\ts - smoothness, \n\t\t\t\t\ts + smoothness, \n\t\t\t\t\tabs(f.y)\n\t\t\t\t);\n            }",[e]),wave:new aB("// Uses bisection \n            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {\n                // Convert all data to a primitive cosine wave\n                p = c * (p - vec2(d, a));\n                \n                const float TWO_PI = PI * 2.0;\n\n                // Reduce to principal half cycle\n                p.x = mod(p.x, TWO_PI); \n                if (p.x > PI) {\n                    p.x = TWO_PI - p.x;\n                }\n            \n                // Find zero of derivative (minimize distance)\n                float xa = 0.0;\n                float xb = TWO_PI;\n\n                // 24 bit precision\n                for (int i = 0; i < 24; i++) {\n                    float x = 0.5 * (xa + xb);\n                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));\n                    if (y < 0.0) xa = x; \n                    else xb = x;\n                }\n                float x = 0.5 * (xa + xb);\n                \n                // Compute distance    \n                vec2 q = vec2(x, b * c * cos(x));\n                return length(p - q) / c;\n            }\n\n            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                float repeat = frequency.x;\n                uv *= repeat;\n                vec2 i = floor(uv);\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = vec2(uv.x, fract(uv.y));\n\n                // Generalized cosine: y(x) = a + b * cos(cx + d)\n                const float amplitude = 0.125;\n                float wave_frequency = frequency.y * 0.1;\n                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);\n\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(i.y));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);\n            }")}}();var vF=class extends Jk{constructor(t,e,n,i,r,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=t,this.movement=e,this.wavelengths=n,this.noiseStrength=i,this.noiseScale=r,this.offset=s,this.isMask=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("vWorldViewDir"),t.require("worldNormal"),t.isShader("fragment")){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let n=t.include(vF.Nodes.rainbow),i=[];return i.push(this.filmThickness.build(t,"f")),i.push(this.movement.build(t,"f")),i.push(this.wavelengths.build(t,"v3")),i.push(this.noiseStrength.build(t,"f")),i.push(this.noiseScale.build(t,"f")),i.push(this.offset.build(t,"v3")),i.push(this.isMask.build(t,"b")),i.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),i.push(this.alpha.build(t,"f")),i.push(this.calpha),t.format(n+"("+i.join(",")+")",this.getType(t),e)}return console.warn("RainbowNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},yF=vF;yF.Nodes=function(){let t=new aB("vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {\n\t\t\t\tfloat f = 0.0;\n\t\t\t\t\n\t\t\t\tif (noiseStrength != 0.0) {\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\tfloat noise = simplexFast(1.6 * st + vec3(1.8, 1.5, 1.9) * simplexFast(st) + vec3(1.7, 9.2, 1.0));\n\t\t\t\t\tf = noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tvec3 waves = wavelengths * vec3(1.0, 0.8, 0.6) + 1.0;\n\t\t\t\tfloat angle = dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal));\n\n\t\t\t\tmediump vec3 color = cos((((filmThickness + f) / waves) * angle) + movement);\n\t\t\t\treturn .5 + .5 * color;\n\t\t\t }",[uF.simplexFast]);return{rainbow:new aB("vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tmediump vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);\n\n\t\t\t\tfloat rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);\n\n\t\t\t\tfloat lalpha = alpha * rainbowContribution * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn res;\n\t\t\t }",[t])}}();var xF=class extends Jk{constructor(t,e,n,i,r,s,a,o,l,c){super("v3"),this.nodeType="Toon",this.positioning=t,this.colors=e,this.steps=n,this.source=i,this.isWorldSpace=r,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("worldNormal"),t.require("worldPosition"),t.isShader("fragment")){t.define("COLORS_MAX",10),t.addFragmentVariable(this.calpha,"float");let n=t.include(xF.Nodes.toon),i=[];return i.push(this.positioning.build(t,"i")),i.push(this.colors.build(t,"v4[]")),i.push(this.steps.build(t,"f[]")),i.push(this.source.build(t,"v3")),i.push(this.isWorldSpace.build(t,"b")),i.push(this.noiseStrength.build(t,"f")),i.push(this.noiseScale.build(t,"f")),i.push(this.shadowColor.build(t,"v4")),i.push(this.offset.build(t,"v3")),i.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),i.push(this.alpha.build(t,"f")),i.push(this.calpha),t.format(n+"("+i.join(",")+")",this.getType(t),e)}return console.warn("ToonNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},bF=xF;bF.Nodes=function(){let t=new aB("float rand(float n) {\n\t\t\t\treturn fract(sin(n) * 43758.5453123);\n\t\t\t}"),e=new aB("float hash1(float p) { \n\t\t\t\tp = fract(p * 0.011); \n\t\t\t\tp *= p + 7.5; \n\t\t\t\tp *= p + p; \n\t\t\t\treturn fract(p); \n\t\t\t}"),n=new aB("float valueNoise(vec3 x) {\n\t\t\t\tconst vec3 step = vec3(110, 241, 171);\n\t\t\t\n\t\t\t\tvec3 i = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\t\t\t \n\t\t\t\t// For performance, compute the base input to a 1D hash from the integer part of the argument and the \n\t\t\t\t// incremental change to the 1D based on the 3D -> 1D wrapping\n\t\t\t\tfloat n = dot(i, step);\n\t\t\t\n\t\t\t\tvec3 u = f * f * (3.0 - 2.0 * f);\n\t\t\t\treturn mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),\n\t\t\t\t\t\t   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);\n\t\t\t}",[e]),i=new aB("vec3 hash3(vec3 x) {\n\t\t\t\tx = vec3(dot(x,vec3(127.1, 311.7, 74.7)),\n\t\t\t\t\t\t dot(x,vec3(269.5, 183.3, 246.1)),\n\t\t\t\t\t\t dot(x,vec3(113.5, 271.9, 124.6)));\n\t\t\t\n\t\t\t\treturn fract(sin(x)*43758.5453123);\n\t\t\t}"),r=new aB('vec3 voronoiNoise(in vec3 x)\n\t\t\t{\n\t\t\t\tvec3 p = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\n\t\t\t\tfloat id = 0.0;\n\t\t\t\tvec2 res = vec2(100.0);\n\n\t\t\t\tfor(int k=-1; k<=1; k++)\n\t\t\t\tfor(int j=-1; j<=1; j++)\n\t\t\t\tfor(int i=-1; i<=1; i++)\n\t\t\t\t{\n\t\t\t\t\tvec3 b = vec3(float(i), float(j), float(k));\n\n\t\t\t\t\t// Comment out the "+ hash(p + b);" part below to get "square" cells\n\t\t\t\t\tvec3 r = vec3(b) - f + hash3(p + b);\n\t\t\t\t\tfloat d = dot(r, r);\n\n\t\t\t\t\tif (d < res.x)\n\t\t\t\t\t{\n\t\t\t\t\t\tid = dot(p + b, vec3(1.0, 57.0, 113.0));\n\t\t\t\t\t\tres = vec2(d, res.x);\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\telse if (d < res.y)\n\t\t\t\t\t{\n\t\t\t\t\t\tres.y = d;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn vec3(sqrt(res), abs(id));\n\t\t\t}\n\t\t\t',[i]);return{toon:new aB('vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat t = 0.0;\n\t\t\t\tfloat shadow = 1.0;\n\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\t// Can\'t do this mode if lighting is "none"\n\t\t\t\t\t#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))\n\n\t\t\t\t\t\t// Algorithm from Chapter 10 of Graphics Shaders\n\t\t\t\t\t\tconst vec3 weights = vec3(0.2125, 0.7154, 0.0721);\n\t\t\t\t\t\tvec3 lpos;\n\t\t\t\t\t\tvec3 l;\n\t\t\t\t\t\tfloat dproduct;\n\n\t\t\t\t\t\t#if (NUM_POINT_LIGHTS > 0)\n\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tPointLightShadow pointLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Light positions are in view-space for some reason?\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// TODO: we want to use "intensity" but it isn\'t available in the shader code\n\t\t\t\t\t\t\t\t//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);\n\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tpointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getPointShadow( \n\t\t\t\t\t\t\t\t\t\t\tpointShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowRadius,\n\t\t\t\t\t\t\t\t\t\t\tvPointShadowCoord[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraNear, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraFar);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_DIR_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tDirectionalLightShadow directionalLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Use the direction vector for directional lights instead\n\t\t\t\t\t\t\t\tl = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;\n\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tdirectionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow( \n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tdirectionalShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tSpotLightShadow spotLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tspotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow(\n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tspotShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvSpotLightCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tt = clamp(t, 0.0, 1.0);\n\t\t\t\t\n\t\t\t\t\t#endif\n\n\t\t\t\t} else if (positioning == 1) {\n\t\t\t\t\t\n\t\t\t\t\tvec3 origin = mix(position, worldPosition, float(isWorldSpace));\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvec3 origin = worldPosition;\n\t\t\t\t\tvec3 source = cameraPosition - offset;\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\tif (noiseStrength > 0.0) {\n\t\t\t\t\t// Distort with noise\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\t\n\t\t\t\t\t// Voronoi "smooth" noise\n\t\t\t\t\tfloat noise = 1.0 - voronoiNoise(st).x;\n\n\t\t\t\t\t// Voronoi cellular noise\n\t\t\t\t\t//float noise = 1.0 - rand(voronoiNoise(st).z);\n\n\t\t\t\t\t// Position warp noise\n\t\t\t\t\t// vec3 offset = vec3(\n\t\t\t\t\t// \tsimplexFast(st),\n\t\t\t\t\t// \tsimplexFast(st + vec3(111.1, 143.89, 217.19)),\n\t\t\t\t\t// \tsimplexFast(st + vec3(171.1, 247.89, 117.23))\n\t\t\t\t\t// );\n\t\t\t\t\t// st += offset;\n\t\t\t\t\t// float noise = valueNoise(st);\n\n\t\t\t\t\tt += noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tt = clamp(t, 0.0, 1.0);\n\n\t\t\t\t// Compute ramp color\n\t\t\t\tfloat p;\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tfor (int i = 1; i < COLORS_MAX; i++) {\n\t\t\t\t\tp = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);\n\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t}\n\n\t\t\t\t// Incorporate custom shadow color\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\tvec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);\n\t\t\t\t\tcolor.rgb = mix(blendedShadow, color.rgb, shadow);\n\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\t// Accumulate alpha as usual\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color.xyz;\n\n            }',[uF.simplexFast,t,n,r])}}();var _F={textureBicubic:new aB("float w0( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n        }\n    \n        float w1( float a ) {\n            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n        }\n    \n        float w2( float a ){\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n        }\n    \n        float w3( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * a * a );\n        }\n    \n        // g0 and g1 are the two amplitude functions\n        float g0( float a ) {\n            return w0( a ) + w1( a );\n        }\n    \n        float g1( float a ) {\n            return w2( a ) + w3( a );\n        }\n    \n        // h0 and h1 are the two offset functions\n        float h0( float a ) {\n            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n        }\n    \n        float h1( float a ) {\n            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n        }\n    \n        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n            uv = uv * texelSize.zw + 0.5;\n    \n            vec2 iuv = floor( uv );\n            vec2 fuv = fract( uv );\n    \n            float g0x = g0( fuv.x );\n            float g1x = g1( fuv.x );\n            float h0x = h0( fuv.x );\n            float h1x = h1( fuv.x );\n            float h0y = h0( fuv.y );\n            float h1y = h1( fuv.y );\n    \n            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n    \n            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + \n                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n        }\n\n        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n            vec2 fLodSizeInv = 1.0 / fLodSize;\n            vec2 cLodSizeInv = 1.0 / cLodSize;\n            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n            return mix( fSample, cSample, fract( lod ) );\n        }")};var wF=class extends Jk{constructor(t,e,n,i,r,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=t,this.ior=e,this.roughness=n,this.transmissionSamplerSize=i,this.transmissionSamplerMap=r,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.extensions.shaderTextureLOD=!0,t.extensions.derivatives=!0,t.isShader("fragment")){t.define("NUM_SAMPLES",6),t.define("BLUR_SLOD",Math.pow(2,AF.transmissionLod.value)),t.require("worldPosition"),t.requires.worldNormal=!0,t.requires.modelMatrix=!0,t.requires.projectionMatrix=!0,t.addFragmentVariable(this.calpha,"float");let n=t.include(wF.Nodes.transmission),i=[];return i.push(this.thickness.build(t,"f")),i.push(this.ior.build(t,"f")),i.push(this.roughness.build(t,"f")),i.push(this.transmissionSamplerSize.build(t,"v2")),i.push(this.transmissionSamplerMap.getTexture(t,"t")),i.push(this.transmissionDepthMap.getTexture(t,"t")),i.push(this.aspectRatio.build(t,"v2")),i.push("normal"),i.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),i.push(this.alpha.build(t,"f")),i.push(this.calpha),t.format(n+"("+i.join(",")+")",this.getType(t),e)}return console.warn("TransmissionNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},SF=wF;SF.Nodes=function(){let t=new aB("vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {\n                // Slightly modified version of this:\n                // https://www.shadertoy.com/view/ltScRG\n\n\t\t\t\t// Special case for blur == 0.0\n\t\t\t\tif (lod == 0.0) {\n\t\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\t\treturn texture2DLodEXT( sp, U, 0.0).rgb;\n\t\t\t\t\t#else\n\t\t\t\t\treturn textureLod( sp, U, 0.0).rgb;\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec2 texelSize = vec2(1.0) / resolution;\n                vec2 halton = haltonSequence[frameIndex];\n                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n                float temporalAngle  = temporalOffset * PI2;\n\t\t\t\tvec3 res = vec3(0.0);\n                vec2 uv = vec2(0.0);\n                vec2 offset = vec2(0.0);\n                vec2 vogelSample = vec2(0.0);\n                for (int i = 0; i < NUM_SAMPLES; i++) {\n                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;\n                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20\n                    uv = U + offset;\n                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));\n                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {\n                        uv = unrefractedU;\n                        lod = lod > 4.0 ? lod : lod / 2.0;\n                    }\n                    res += textureLod(sp, uv, lod).rgb;\n                }\n                return res / float(NUM_SAMPLES);\n            }"),e=new aB("vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\t        // Direction of refracted light.\n\t\t        vec3 refractionVector = refract( -v,  n, 1.0 / ior );\n\t\t        \n\t\t\t\t// Compute rotation-independant scaling of the model matrix.\n\t\t        vec3 modelScale;\n\t\t        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\t        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\t        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\n\t\t        // The thickness is specified in local space\n\t\t        return normalize( refractionVector ) * thickness * modelScale;\n\t        }"),n=new aB("float applyIorToRoughness( float roughness, float ior ) {\n\t\t\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\t\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t\t\t}"),i=new aB('vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {\n\t\t\t\t// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see\n\t\t\t\t// also the code in convertTransmission.ts, which runs during export\n\t\t\t\t#ifdef IS_THREEJS_EXPORT\n\t\t\t\t\tfloat lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);\n\t\t\t\t\treturn textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;\n\t\t\t\t#else\n\t\t\t\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t\t\t\tfloat lod = applyIorToRoughness(roughness, ior);\n\t\t\t\t\treturn blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);\n\t\t\t\t#endif\n\t\t\t}',[_F.textureBicubic,n,t]),r=new aB("vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\n\t\t\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\n\t\t\t\tvec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );\n\t\t\t\tvec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;\n\t\t\t\tunrefractedCoords += 1.0;\n\t\t\t\tunrefractedCoords /= 2.0;\n\n\t\t\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\t\t\treturn getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );\n    \t\t}",[i,e]);return{transmission:new aB("vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {\n                vec3 v = vec3(0.);\n                if (isOrthographic) {\n                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n                } else {\n                    v = normalize(vWPosition - cameraPosition);\n                }\n                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );\n                \n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * alpha;\n\n\t\t\t\treturn transmission;\n            }",[r])}}();var MF=(t=>(t.NOISE="noise",t.MAP="map",t))(MF||{}),TF=class extends Jk{constructor(t,e,n,i,r,s,a,o,l,c,h){super("v3"),this.displacementTypeIndex=new FB(0),this.nodeType="VertexDisplacement",this.intensity=t,this.movementOrTexture=e,"map"===Object.values(MF)[this.displacementTypeIndex.value]&&(this.mat=new qB(this.movementOrTexture.value.matrix)),this.cropOrOffset=n,this.scale=c,this.noiseFunctionIndex=h,this.voronoiStyle=i,this.smoothness=r,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(t,e){if(t.isShader("vertex")){t.define("USE_LAYER_DISPLACE");let n,i=[];switch(i.push("displaced_position"),i.push("displaced_normal"),Object.values(MF)[this.displacementTypeIndex.value]){case"map":n=t.include(TF.Nodes.map),i.push(this.movementOrTexture.getTexture(t,"t")),i.push("uv"),i.push(this.cropOrOffset.build(t,"f")),this.mat&&i.push(this.mat.build(t,"mat3"));break;case"noise":{let e=["simplexPrecise","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseFunctionIndex.value],r=new aB("vec3 orthogonal(vec3 v) {\n\t\t\t\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t\t\t\t}"),s=new aB(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {\n\t\t\t\t\t\t\t${"voronoi"==e?`\n\t\t\t\t\tfloat v = ${e}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);\n\t\t\t\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\t\t\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\t\t\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t\t\t\treturn p + n * v * intensity;\n\t\t\t\t\t`:`\n\t\t\t\t\treturn p + n * ${e}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;\n\t\t\t\t\t`}\n\t\t\t\t\t\t}`,[uF.simplexPrecise,uF.simplexFractal,uF.simplexAshima,uF.fbm,uF.perlin,uF.voronoi]),a=new aB("vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {\n\t\t\t\t\t\t\tvec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 tangent1 = orthogonal(normal);\n\t\t\t\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\n                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.\n                            // This caused some small oval/circular visual artifacts in the lighting.\n                            // For now, simply using neighbors further away betters the problem,\n                            // but we should figure out the underlying cause when we have some time.\n                            // Maybe its related to how we calculate the tangent and bitangent?\n\t\t\t\t\t\t\tvec3 nearby1 = position + tangent1;\n\t\t\t\t\t\t\tvec3 nearby2 = position + tangent2;\n\t\t\t\t\t\t\tvec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\t\t\t\treturn displaced_position;\n\t\t\t\t\t\t}",[s,r]);n=t.include(a),i.push(this.scale.build(t,"f")),i.push(this.cropOrOffset.build(t,"v3")),i.push(this.movementOrTexture.build(t,"f")),i.push(this.voronoiStyle.build(t,"i")),i.push(this.smoothness.build(t,"f")),i.push(this.seed.build(t,"f")),i.push(this.highCut.build(t,"f")),i.push(this.lowCut.build(t,"f")),i.push(this.quality.build(t,"i"));break}}return i.push(this.intensity.build(t,"f")),i.push("displaced_normal"),t.format(n+"("+i.join(",")+")",this.getType(t),e)}return console.warn("VertexDisplacementNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},EF=TF;EF.Nodes=function(){let t=new aB("vec3 orthogonal(vec3 v) {\n\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t}"),e=new aB("float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {\n\t\t\t\tvec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;\n\t\t\t\tvec4 tmp = texture2D(tex, uvs);\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tif (crop > 0.5) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\treturn 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn col.r;\n\t\t\t}");return{map:new aB("vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {\n\t\t\t\tvec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;\n\t\t\t\tvec3 tangent1 = normalize(orthogonal(normal));\n\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\t\t\t\tvec3 nearby1 = position + tangent1 * 0.1;\n\t\t\t\tvec3 nearby2 = position + tangent2 * 0.1;\n\t\t\t\tvec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tvec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\treturn displaced_position;\n\t\t\t}",[t,e])}}();var AF={normalRenderTarget:new vB,normalRenderTargetDepth:new vB,transmissionRenderTarget:new vB,aspectRatio:new tB,transmissionSize:new tB(2048,2048),transmissionRenderTargetDepth:new vB,aoRenderTarget:new vB,aoEnabled:new VB,pixelRatioNode:new yB(1),resolution:new tB,penumbraSize:new jB(5,.5),frameIndex:new FB(0),transmissionLod:new FB(2)};for(let qq of Object.values(AF))qq.isRenderGlobal=!0;var CF,PF="https://unpkg.com/@splinetool/ui-wasm@1.9.69/build/ui.wasm",RF=class extends Yk{constructor(){super("basic"),this.nodeType="Basic",this.color=new BB(WD),this.shadingAlpha=new yB(1),this.shadingBlend=new FB(0),this.previousModelViewMatrix=new XB,this.previouseProjectionMatrix=new XB}get category(){return"phong"}generate(t){let e;if(t.isShader("vertex")){let n=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:AF.frameIndex}),t.mergeUniform({resolution:AF.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(ay.merge([Cy.fog])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>"].join("\n"));let i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];n&&i.push(n.code,n.result?"displaced_position = "+n.result+";":""),i.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","\tvNormal = transformedNormal;","#endif"),i.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=i.join("\n")}else{void 0===this.color&&(this.color=new BB(WD)),this.color.analyze(t,{slot:"color"}),this.alpha&&this.alpha.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"});let n=this.color.flow(t,"c",{slot:"color"}),i=this.alpha?this.alpha.flow(t,"f"):void 0,r=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0,s=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0;t.requires.transparent=void 0!==i,t.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join("\n"));let a=["#include <normal_fragment_begin>",n.code];i&&a.push(i.code,"#ifdef ALPHATEST"," if ( "+i.result+" <= ALPHATEST ) discard;","#endif"),s?a.push(s.code,`vec3 outgoingLight = ${n.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):a.push(`vec3 finalColor = ${n.result};`);let o="1.0";this.mask&&(this.mask.analyze(t),o=`luminance(${this.mask.flow(t,"v3").result})`),i?a.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${i.result} * ${o} );`):a.push("gl_FragColor = vec4("+n.result+", 1.0 );"),r&&a.push(`gl_FragColor.a *= ${r.result};`),a.push("#include <fog_fragment>","#include <dithering_fragment>"),e=a.join("\n")}return e}},OF=class extends Yk{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new BB(WD),this.emissive=new BB(0),this.emissiveIntensity=new yB(1),this.previousModelViewMatrix=new XB,this.previouseProjectionMatrix=new XB,this.shadingAlpha=new yB(1),this.shadingBlend=new FB(0),this.occlusion=new VB(!0)}get category(){return"lambert"}build(t){let e;if(t.define("LAMBERT"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let n=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:AF.frameIndex}),t.mergeUniform({resolution:AF.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(ay.merge([Cy.fog,Cy.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];n&&i.push(n.code,n.result?"displaced_position = "+n.result+";":""),i.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\n\t\t\t\t\tvec3 diffuse = vec3( 1.0 );\n\t\t\t\t\tGeometricContext geometry;\n\t\t\t\t\tgeometry.position = mvPosition.xyz;\n\t\t\t\t\tgeometry.normal = normalize( transformedNormal );\n\t\t\t\t\tgeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\t\t\t\t"),i.push("\n\t\t\t\t\tGeometricContext backGeometry;\n\t\t\t\t\tbackGeometry.position = geometry.position;\n\t\t\t\t\tbackGeometry.normal = -geometry.normal;\n\t\t\t\t\tbackGeometry.viewDir = geometry.viewDir;\n\t\t\t\t\tvLightFront = vec3( 0.0 );\n\t\t\t\t\tvIndirectFront = vec3( 0.0 );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvLightBack = vec3( 0.0 );\n\t\t\t\t\t\tvIndirectBack = vec3( 0.0 );\n\t\t\t\t\t#endif\n\t\t\t\t\tIncidentLight directLight;\n\t\t\t\t\tfloat dotNL;\n\t\t\t\t\tvec3 directLightColor_Diffuse;\n\t\t\t\t\tvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\tvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\t\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_POINT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_DIR_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_HEMI_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=i.join("\n")}else{t.mergeUniform({penumbraSize:AF.penumbraSize}),t.mergeUniform({frameIndex:AF.frameIndex}),t.mergeUniform({aoMap:AF.aoRenderTarget}),t.mergeUniform({aoEnabled:AF.aoEnabled}),void 0===this.color&&(this.color=new BB(WD)),this.color.analyze(t,{slot:"color"}),this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let n=this.color.flow(t,"c",{slot:"color"}),i=this.emissive.flow(t,"c",{slot:"emissive"}),r=this.emissiveIntensity.flow(t,"f",{slot:"emissive"}),s=this.occlusion.flow(t,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(t,"f"),o=this.shadingBlend.flow(t,"i"),l=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(t,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=void 0!==c,t.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let u=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx, viewdy));\n\t\t\t\tbool isFrontFacing = (dot(normal, faceNormal) >= 0.0);\n\t\t\t\t","#include <clipping_planes_fragment>"];u.push(n.code,"vec3 diffuseColor = "+n.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&u.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),u.push("#ifdef DOUBLE_SIDED","\treflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","\treflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","\treflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","\treflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),i&&u.push(i.code,"reflectedLight.directDiffuse += "+i.result+" * "+r.result+";"),u.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(t),d=`luminance(${this.mask.flow(t,"v3").result})`),u.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );\n\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),l&&u.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&u.push(`gl_FragColor.a *= ${h.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=u.join("\n")}return e}},DF={dHdxy:new aB("vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {\n\n            // Gradient of UVs w.r.t. X coordinate (in screen-space)\n            vec2 dSTdx = dFdx(bumpMapUv);\n\n            // Gradient of UVs w.r.t. Y coordinate (in screen-space)\n            vec2 dSTdy = dFdy(bumpMapUv);\n            \n            // Forward differencing\n            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);\n            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;\n            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;\n            \n            return vec2( dBx, dBy );\n        }"),perturbNormalArb:new aB("vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n            vec3 vSigmaX = dFdx( surf_pos.xyz );\n            vec3 vSigmaY = dFdy( surf_pos.xyz );\n            vec3 vN = surf_norm; // normalized\n            \n            vN = normalize(vN);\n\n            vec3 R1 = cross( vSigmaY, vN );\n            vec3 R2 = cross( vN, vSigmaX );\n\n            R1 = normalize(R1);\n            R2 = normalize(R2);\n    \n            float fDet = dot( vSigmaX, R1 ) * faceDirection;\n    \n            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n            return normalize( abs( fDet ) * vN - vGrad );\n        }")},LF=class extends Yk{constructor(){super("phong"),this.nodeType="Phong",this.color=new BB(WD),this.specular=new BB(1118481),this.shininess=new yB(30),this.previousModelViewMatrix=new XB,this.previouseProjectionMatrix=new XB,this.shadingAlpha=new yB(1),this.shadingBlend=new FB(0),this.occlusion=new VB(!0)}get category(){return"phong"}build(t){let e;if(t.define("PHONG"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let n=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:AF.frameIndex}),t.mergeUniform({resolution:AF.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(ay.merge([Cy.fog,Cy.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];n&&i.push(n.code,n.result?"displaced_position = "+n.result+";":""),i.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=i.join("\n")}else{t.mergeUniform({penumbraSize:AF.penumbraSize}),t.mergeUniform({frameIndex:AF.frameIndex}),t.mergeUniform({aoMap:AF.aoRenderTarget}),t.mergeUniform({aoEnabled:AF.aoEnabled}),void 0===this.color&&(this.color=new BB(WD)),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t);let n=this.occlusion.flow(t,"b",{slot:"occlusion"});this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let i=this.color.flow(t,"c",{slot:"color"}),r=this.specular.flow(t,"c"),s=this.shininess.flow(t,"f"),a=this.shadingAlpha.flow(t,"f"),o=this.shadingBlend.flow(t,"i"),l=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(t,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=void 0!==c,t.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let u=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tBlinnPhongMaterial material;"];if(this.bumpMap){t.include(DF.dHdxy),t.include(DF.perturbNormalArb);let e=this.bumpMap.texture.flow(t,"t"),n=this.bumpMap.flow(t,"v3"),i=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",r="";r=4===this.bumpMap.projection.value?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${e.result}, uv0, ${i});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${e.result}, uv1, ${i});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${e.result}, uv2, ${i});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${e.result}, bumpMapCachedUv, ${i});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,u.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${n.result};\n\t\t\t\t\t${r}\n\t\t\t\t\t`)}u.push(i.code,"\tvec3 diffuseColor = "+i.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","\tvec3 totalEmissiveRadiance = emissive;",r.code,"\tvec3 specular = "+r.result+";",s.code,"\tfloat shininess = max( 0.0001, "+s.result+" );","\tfloat specularStrength = 1.0;"),c&&u.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled && "+n.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(t),d=`luminance(${this.mask.flow(t,"v3").result})`),u.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),l&&u.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result});`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&u.push(`gl_FragColor.a *= ${h.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=u.join("\n")}return e}},IF=class extends Yk{constructor(){super("standard"),this.nodeType="Standard",this.color=new BB(WD),this.roughness=new yB(.3),this.metalness=new yB(0),this.reflectivity=new yB(.5),this.previousModelViewMatrix=new XB,this.previouseProjectionMatrix=new XB,this.shadingAlpha=new yB(1),this.shadingBlend=new FB(0),this.occlusion=new VB(!0)}get category(){return"physical"}build(t){let e;if(t.define("STANDARD"),t.requires.lights=!0,t.extensions.derivatives=!0,t.extensions.shaderTextureLOD=!0,t.isShader("vertex")){let n=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:AF.frameIndex}),t.mergeUniform({resolution:AF.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(ay.merge([Cy.fog,Cy.lights])),Cy.LTC_1&&(t.uniforms.ltc_1={value:void 0},t.uniforms.ltc_2={value:void 0}),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];n&&i.push(n.code,n.result?"displaced_position = "+n.result+";":""),i.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=i.join("\n")}else{t.mergeUniform({penumbraSize:AF.penumbraSize}),t.mergeUniform({frameIndex:AF.frameIndex}),t.mergeUniform({aoMap:AF.aoRenderTarget}),t.mergeUniform({aoEnabled:AF.aoEnabled});let n={gamma:!0};void 0===this.color&&(this.color=new BB(WD)),this.color.analyze(t,{slot:"color",context:n}),this.roughness.analyze(t),this.metalness.analyze(t);let i=this.occlusion.flow(t,"b",{slot:"occlusion"});this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t),this.reflectivity&&this.reflectivity.analyze(t);let r=this.color.flow(t,"c",{slot:"color",context:n}),s=this.roughness.flow(t,"f"),a=this.metalness.flow(t,"f"),o=this.shadingAlpha.flow(t,"f"),l=this.shadingBlend.flow(t,"i"),c=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(t,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(t,"f"):void 0;t.requires.transparent=void 0!==h,t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join("\n"));let p=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){t.include(DF.dHdxy),t.include(DF.perturbNormalArb);let e=this.bumpMap.texture.flow(t,"t"),n=this.bumpMap.flow(t,"v3"),i=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",r="";r=4===this.bumpMap.projection.value?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${e.result}, uv0, ${i});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${e.result}, uv1, ${i});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${e.result}, uv2, ${i});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${e.result}, bumpMapCachedUv, ${i});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${n.result};\n\t\t\t\t\t${r}\n\t\t\t\t\t`)}if(p.push(r.code,"\tvec3 diffuseColor = "+r.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"\tfloat metalnessFactor = "+a.result+";"),this.roughnessMap){let e=this.roughnessMap.texture.flow(t,"t"),n=this.roughnessMap.flow(t,"v3"),i="";i=4===this.roughnessMap.projection.value?`\n\t\t\t\t\tfloat roughnessChange = 1.0;\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tfloat r0 = luminance(texture(${e.result}, uv0).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r1 = luminance(texture(${e.result}, uv1).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r2 = luminance(texture(${e.result}, uv2).rgb) * roughnessScale;\n\n\t\t\t\t\t\troughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);\n\t\t\t\t\t}\n\t\t\t\t\tfloat roughnessFactor = roughnessChange * ${s.result};\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\n\t\t\t\t\tvec4 vals = texture(${e.result},  roughnessMapCachedUv);\n\t\t\t\t\tfloat roughnessFactor = luminance(vals.rgb) * ${s.result};\n\t\t\t\t\t`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${n.result};\n\n\t\t\t\t\tconst float roughnessScale = 1.0;\n\n\t\t\t\t\t${i}\n\t\t\t\t`)}else p.push(s.code,"\tfloat roughnessFactor = "+s.result+";");h&&p.push(h.code,"#ifdef ALPHATEST","\tif ( "+h.result+" <= ALPHATEST ) discard;","#endif"),p.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),p.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?p.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):p.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),p.push("#include <lights_fragment_begin>"),p.push("#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let f="1.0";this.mask&&(this.mask.analyze(t),f=`luminance(${this.mask.flow(t,"v3").result})`),p.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${f} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${f}, ${l.result} );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t`),c&&p.push(c.code,`outgoingLight = spe_blend(outgoingLight, ${c.result}, 1.0, SPE_BLENDING_NORMAL);`),h?p.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${h.result} );`):p.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&p.push(`gl_FragColor.a *= ${u.result};`),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=p.join("\n")}return e}},zF=class extends Yk{constructor(){super("toon"),this.nodeType="Toon",this.color=new BB(WD),this.specular=new BB(1118481),this.shininess=new yB(30),this.previousModelViewMatrix=new XB,this.previouseProjectionMatrix=new XB,this.shadingAlpha=new yB(1),this.shadingBlend=new FB(0)}get category(){return"toon"}build(t){let e;if(t.define("TOON"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let n=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:AF.frameIndex}),t.mergeUniform({resolution:AF.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(ay.merge([Cy.fog,Cy.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let i=["#include <beginnormal_vertex>","#include <morphnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];n&&i.push(n.code,n.result?"displaced_position = "+n.result+";":""),i.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),i.push("\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),i.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=i.join("\n")}else{t.mergeUniform({penumbraSize:AF.penumbraSize}),t.mergeUniform({frameIndex:AF.frameIndex}),t.mergeUniform({aoMap:AF.aoRenderTarget}),t.mergeUniform({aoEnabled:AF.aoEnabled}),void 0===this.color&&(this.color=new BB(WD)),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t),this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let n=this.color.flow(t,"c",{slot:"color"}),i=this.specular.flow(t,"c"),r=this.shininess.flow(t,"f"),s=this.shadingAlpha.flow(t,"f"),a=this.shadingBlend.flow(t,"i"),o=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(t,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=void 0!==l,t.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>","\n\t\t\t\t\tvarying vec3 vViewPosition;\n\t\t\t\t\tstruct ToonMaterial {\n\t\t\t\t\t\tvec3\tdiffuseColor;\n\t\t\t\t\t\tvec3\tspecularColor;\n\t\t\t\t\t\tfloat\tspecularShininess;\n\t\t\t\t\t\tfloat\tspecularStrength;\n\t\t\t\t\t};\n\t\t\t\t\tvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t\t\t\n\t\t\t\t\t\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\t\t\t\t\t}\n\t\t\t\t\tvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t}\n\t\t\t\t\t#define RE_Direct\t\t\t\tRE_Direct_Toon\n\t\t\t\t\t#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\t\t\t\t\t#define Material_LightProbeLOD( material )\t(0)\n\t\t\t\t\t","#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join("\n"));let h=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tToonMaterial material;"];if(this.bumpMap){t.include(DF.dHdxy),t.include(DF.perturbNormalArb);let e=this.bumpMap.texture.flow(t,"t"),n=this.bumpMap.flow(t,"v3"),i=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",r="";r=4===this.bumpMap.projection.value?`\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(${e.result}, uv0, ${i});\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(${e.result}, uv1, ${i});\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(${e.result}, uv2, ${i});\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t`:`\n\t\t\t\t\tvec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(${e.result}, bumpMapCachedUv, ${i});\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t${n.result};\n\t\t\t\t\t${r}\n\t\t\t\t\t`)}h.push(n.code,"\tvec3 diffuseColor = "+n.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",i.code,"\tvec3 specular = "+i.result+";",r.code,"\tfloat shininess = max( 0.0001, "+r.result+" );","\tfloat specularStrength = 1.0;"),l&&h.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let u="1.0";this.mask&&(this.mask.analyze(t),u=`luminance(${this.mask.flow(t,"v3").result})`),h.push(`\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${u} * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${u}, ${a.result} );\n\t\t\t\t}\n\t\t\t\t`),o&&h.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&h.push(`gl_FragColor.a *= ${c.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=h.join("\n")}return e}},NF=class{constructor(t=1e4){this.timeout=t,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...t){}remove(t){let e=this.cache.get(t);e&&(this.dispose(t,e.data),this.cache.delete(t),e.prev.next=e.next,e.next.prev=e.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout((()=>{this.hasClean=!1,this.log("cleaning");let t=Date.now(),e=this.head.next;for(;e.time<t-this.timeout;)this.dispose(e.src,e.data),this.cache.delete(e.src),e=e.next,e.prev=this.head,this.head.next=e;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")}),this.timeout+1e3))}has(t){return this.cache.get(t)?.data}load(t){let e=Date.now(),n=this.cache.get(t);return void 0===n?(n={data:this.create(t),src:t,time:e,next:null,prev:null},this.cache.set(t,n)):(n.time=e,n.prev.next=n.next,n.next.prev=n.prev),n.prev=this.tail.prev,n.next=this.tail,this.tail.prev.next=n,this.tail.prev=n,this.scheduleCleanup(),n.data}},UF=class extends NF{create(t){return URL.createObjectURL(new Blob([t]))}dispose(t,e){URL.revokeObjectURL(e)}};var kF=class{constructor(t,e){this.data=t,this.cache=e,this.refCount=0}deref(){this.refCount,this.refCount-=1,0===this.refCount&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount,0}},BF=class{constructor(){this.cache=new Map}remove(t){this.cache.delete(t.data),0}load(t){let e=this.cache.get(t);return void 0===e&&(e=this.create(t),this.cache.set(t,e)),e.refCount+=1,e}},FF=class extends kF{constructor(t,e){super(t,e.imageHolderCache),this.data=t,this.shared=e,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo="video"===t.type,this.isBuffer=!0===t.isWebGLRenderTarget,this.loadPromise=this.updateSrc(this.isBuffer?t:t.data)}async updateSrc(t){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let e=()=>{this.loaded=!0;for(let t of Object.values(this._cache))for(let e of Object.values(t))for(let t of Object.values(e))t&&(t.image=this.img,t.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=t,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,"string"!=typeof t){var n=new FileReader;let e;n.readAsDataURL(new Blob([t],{type:"video/mp4"})),await new Promise((t=>{n.onloadend=n=>{e=n.target?.result,t(null)}})),this.img.src=e}else this.img.src=t;this.img.onloadeddata=()=>{e()}}else this.img=new Image,this.img.src=function(t){return"string"==typeof t?t:(CF||(CF=new UF),CF.load(t))}(t),this.img.onload=e,await new Promise((t=>{this.img.onload=()=>{e(),t(null)}}))}getTexture(t,e=1008,n=1006){let i=this._cache[t]?.[e]?.[n];if(i)return i;{let i;return i=this.isBuffer?this.img.texture:this.isVideo?new W_(this.img,void 0,t,t):new Vm(this.img,void 0,t,t,n,e),this.loaded&&(i.needsUpdate=!0),void 0===this._cache[t]&&(this._cache[t]={}),void 0===this._cache[t][e]&&(this._cache[t][e]={}),this._cache[t][e][n]=i,i}}setNeedsUpdate(t){for(let e of Object.values(this._cache))for(let n of Object.values(e))for(let e of Object.values(n))e&&(e.needsUpdate=t)}disposeTextures(){for(let[t,e]of Object.entries(this._cache))for(let[n,i]of Object.entries(e))for(let[e,r]of Object.entries(i))r?.dispose(),void 0!==this._cache[t]&&void 0!==this._cache[t][n]&&(this._cache[t][n][e]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},VF=class extends FF{};function jF(t,e){return e.color(t)}function HF(t,e){switch(t.type){case"fresnel":return function(t,e){let{bias:n,scale:i,intensity:r,factor:s,color:a}=t;return{...WF(t,e),color:jF(a,e),bias:n,scale:i,intensity:r,factor:s}}(t,e);case"gradient":return function(t,e){let{gradientType:n,smooth:i,colors:r,steps:s,angle:a,offset:o,morph:l}=t;return{...WF(t,e),gradientType:n,smooth:i,colors:r.map((t=>new jm(t[0],t[1],t[2],t[3]))),num:r.length,steps:s,offset:new ym(...o),morph:new ym(...l),angle:a}}(t,e);case"depth":return function(t,e){let{gradientType:n,near:i,far:r,isVector:s,isWorldSpace:a,origin:o,direction:l,colors:c,steps:h,smooth:u}=t;return{...WF(t,e),gradientType:n,near:i,far:r,isVector:s,isWorldSpace:a,origin:new $m(...o),direction:l?new $m(...l):new $m(1,0,0),colors:c.map((t=>void 0!==t?new jm(t[0],t[1],t[2],t[3]):new jm(0,0,0,0))),steps:h.slice(0,c.length),smooth:u}}(t,e);case"normal":return function(t,e){let{cnormal:n}=t;return{...WF(t,e),cnormal:new $m(n[0],n[1],n[2])}}(t,e);case"noise":return function(t,e){return{...WF(t,e),scale:t.scale,move:t.move,fA:new ym(...t.fA),fB:new ym(...t.fB),size:new $m(...t.size),distortion:new ym(...t.distortion),colorA:jF(t.colorA,e),colorB:jF(t.colorB,e),colorC:jF(t.colorC,e),colorD:jF(t.colorD,e),noiseType:t.noiseType,voronoiStyle:t.voronoiStyle,highCut:t.highCut,lowCut:t.lowCut,smoothness:t.smoothness,seed:t.seed,quality:t.quality}}(t,e);case"rainbow":return function(t,e){return{...WF(t,e),filmThickness:t.filmThickness,movement:t.movement,wavelengths:new $m(...t.wavelengths),noiseStrength:t.noiseStrength,noiseScale:t.noiseScale,offset:new $m(...t.offset)}}(t,e);case"toon":return function(t,e){return{...WF(t,e),positioning:t.positioning,colors:t.colors.map((t=>new jm(t[0],t[1],t[2],t[3]))),num:t.colors.length,steps:t.steps,source:new $m(...t.source),isWorldSpace:t.isWorldSpace,noiseStrength:t.noiseStrength,noiseScale:t.noiseScale,shadowColor:jF(t.shadowColor,e),offset:new $m(...t.offset)}}(t,e);case"outline":return function(t,e){return{...WF(t,e),outlineColor:jF(t.outlineColor,e),contourColor:jF(t.contourColor,e),outlineWidth:t.outlineWidth,contourWidth:t.contourWidth,outlineThreshold:t.outlineThreshold,contourThreshold:t.contourThreshold,outlineSmoothing:t.outlineSmoothing,contourFrequency:t.contourFrequency,contourDirection:new $m(...t.contourDirection),positionalLines:t.positionalLines,compensation:t.compensation}}(t,e);case"transmission":return function(t,e){return{...WF(t,e),thickness:t.thickness,ior:t.ior,roughness:t.roughness}}(t,e);case"color":return function(t,e){return{...WF(t,e),color:jF(t.color,e)}}(t,e);case"pattern":return function(t,e){return{...WF(t,e),style:t.style,projection:t.projection,axis:t.axis,blending:t.blending,offset:new ym(...t.offset),colorA:jF(t.colorA,e),colorB:jF(t.colorB,e),frequency:new ym(...t.frequency),size:t.size,variation:t.variation,smoothness:t.smoothness,zigzag:t.zigzag,rotation:t.rotation,vertical:new ym(...t.vertical),horizontal:new ym(...t.horizontal),sides:t.sides}}(t,e)}}function GF(t){return{type:t.type}}function WF(t,e){let{alpha:n,mode:i,isMask:r}=t,s="string"==typeof n?(Number(e.getVariable(n))??100)/100:n;return{...GF(t),alpha:s,mode:i,isMask:r}}var qF=class extends nB{},XF={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},$F={depth:["colors"]};function YF(t,e,n){if("isMask"===e)return!0;let i=XF[t.type],r=$F[t.type];if(void 0!==r){let i=t.color;if(r.includes(e)){let t=i[e]?.value?.length;if(void 0!==t&&t!==n.length)return!0}}return void 0!==i&&i.includes(e)}function ZF(t,e,n){let i=n.uniforms[`f${n.id}_texture`];if(!i)return!1;let r=!1,s=t;if("image"in s){let t=s.image,n=e.image(t),r=i;r.image instanceof VF||r.image.deref(),r.image=n}if("video"in s){let t=s.video,n=e.video(t),r=i;r.image instanceof VF||r.image.deref(),r.image=n}if("wrapping"in s){i.wrap=s.wrapping}if("minFilter"in s){i.minFilter=s.minFilter}if("magFilter"in s){i.magFilter=s.magFilter}if("rotation"in s&&n.uniforms[`f${n.id}_rotation`])return n.uniforms[`f${n.id}_rotation`].value=(s.rotation??0)*vm.DEG2RAD,r;if("repeat"in s||"offset"in s||"rotation"in s){let t="mat",e=n.uniforms[`f${n.id}_${t}`];"repeat"in s&&(e.repeat=s.repeat),"offset"in s&&(e.offset=s.offset),"rotation"in s&&(e.rotation=s.rotation??0),e.updateMatrix()}return r}var KF=(t,e,n)=>Math.max(0,Math.min(1,Number(e.getVariable("number"==typeof t?100*t:t,n)??100)/100))??1,JF=class{constructor(t,e,n,i,r){this.id=t,this.uuid=e,this.data=n,this.uniforms={};for(let t in i)this.uniforms[`f${this.id}_${t}`]=i[t];for(let t in n)iV(t,this,n,r)}get type(){return this.data.type}static create(t,e,n,i){if("light"===n.type)return eV.createLightLayer(t,e,n,i);if("texture"===n.type||"video"===n.type){let r="texture"===n.type?i.uiBuffer(n.texture.image)??i.image(n.texture.image):i.video(n.texture.video),s=new WB(r,n.texture.wrapping,n.texture.minFilter??1008,n.texture.magFilter??1006),a=new GB(r),o=new YB(n.texture.repeat,n.texture.offset,n.texture.rotation??0),l=new yB(n.crop?1:0),c=new FB(n.projection??0),h=new FB(["x","y","z"].indexOf(n.axis)??0),u=new FB(n.side??0),d=new tB(n.size?new ym(n.size[0],n.size[1]):new ym(100,100)),p=new yB(n.blending??0),f=new yB(KF(n.alpha,i)),m=new FB(n.mode??0),g=new VB(n.isMask??!1),v=new iF(s,a,l,c,h,u,d,p,o,f,m,g),y=new gB(v.calpha,"f");return new QF(t,e,n,{texture:s,textureSize:a,crop:l,projection:c,axis:h,side:u,size:d,blending:p,mat:o,alpha:f,mode:m,isMask:g},v,m,y,g,i)}if("matcap"===n.type){let r=i.image(n.texture.image),s=new WB(r,n.texture.wrapping,n.texture.minFilter??1008,n.texture.magFilter??1006),a=new yB(KF(n.alpha,i)),o=new FB(n.mode??0),l=new VB(n.isMask??!1),c=new yB((n.texture.rotation??0)*vm.DEG2RAD),h=new hF(s,a,o,l,c),u=new gB(h.calpha,"f");return new QF(t,e,n,{texture:s,alpha:a,mode:o,isMask:l,rotation:c},h,o,u,l,i)}if("displace"===n.type){if("noise"===n.displacementType){let r=new eB(new $m(...n.offset)),s=new yB(n.scale??10),a=new yB(n.intensity??8),o=new yB(n.movement??1),l=new FB(n.noiseType??0),c=new FB(n.voronoiStyle??0),h=new yB(n.smoothness??.5),u=new yB(n.seed??0),d=new yB(n.highCut??1),p=new yB(n.lowCut??0),f=new FB(n.quality??1),m=new EF(a,o,r,c,h,u,d,p,f,s,l);return new tV(t,e,n,{offset:r,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:c,smoothness:h,seed:u,highCut:d,lowCut:p,quality:f},m,i)}throw new Error}return function(t,e,n,i){let r=HF(n,i);return function(t,e,n,i,r){switch(t.type){case"color":{let s=new BB(i.color??WD),a=nV(i),o=new QB(s,a.alpha),l=new gB(o.calpha,"f");return new QF(e,n,t,{color:s,...a},o,a.mode,l,a.isMask,r)}case"fresnel":{let s=new BB(i.color??16777215),a=new yB(i.bias??.1),o=new yB(i.scale??1),l=new yB(i.intensity??2),c=new yB(i.factor??1),h=nV(i),u=new aF(s,a,o,l,c,h.alpha,h.mode,h.isMask),d=new gB(u.calpha,"f");return new QF(e,n,t,{color:s,bias:a,scale:o,intensity:l,factor:c,...h},u,h.mode,d,h.isMask,r)}case"rainbow":{let s=new yB(i.filmThickness??30),a=new yB(i.movement??0),o=new eB(i.wavelengths??new $m(0,0,0)),l=new yB(i.noiseStrength??0),c=new yB(i.noiseScale??1),h=new eB(i.offset??new $m(0,0,0)),u=nV(i),d=new yF(s,a,o,l,c,h,u.alpha,u.isMask),p=new gB(d.calpha,"f");return new QF(e,n,t,{filmThickness:s,movement:a,wavelengths:o,noiseStrength:l,noiseScale:c,offset:h,...u},d,u.mode,p,u.isMask,r)}case"transmission":{let s=new yB(i.thickness??10),a=new yB(i.ior??1.5),o=new yB(i.roughness??.5),l=AF.transmissionSize,c=AF.transmissionRenderTarget,h=AF.transmissionRenderTargetDepth,u=window.innerWidth,d=window.innerHeight,p=u>=d?new tB(d/u,1):new tB(1,u/d),f=nV(i),m=new SF(s,a,o,l,c,h,p,f.alpha),g=new gB(m.calpha,"f");return new QF(e,n,t,{thickness:s,ior:a,roughness:o,aspectRatio:p,...f},m,f.mode,g,f.isMask,r)}case"toon":{let s,a,o=new FB(i.positioning??0);i.colors?s=new ZB(i.colors.length,i.colors):(s=new ZB(10,new jm(0,0,0,1)),s.value[1]=new jm(1,1,1,1)),i.steps?a=new jB(i.steps.length,i.steps):(a=new jB(10,1),a.value[0]=0);let l=new eB(i.source??new $m(0,0,0)),c=new VB(i.isWorldSpace??!0),h=new yB(i.noiseStrength??0),u=new yB(i.noiseScale??1),d=new iB(i.shadowColor),p=new eB(i.offset??new $m(0,0,0)),f=nV(i),m=new bF(o,s,a,l,c,h,u,d,p,f.alpha),g=new gB(m.calpha,"f");return new QF(e,n,t,{positioning:o,colors:s,steps:a,source:l,isWorldSpace:c,noiseStrength:h,noiseScale:u,shadowColor:d,offset:p,...f},m,f.mode,g,f.isMask,r)}case"outline":{let s=new BB(i.outlineColor??16777215),a=new BB(i.contourColor??16777215),o=new yB(i.outlineWidth??.1),l=new yB(i.contourWidth??.1),c=new yB(i.outlineThreshold??.1),h=new yB(i.contourThreshold??.1),u=new yB(i.outlineSmoothing??.1),d=new yB(i.contourFrequency??.1),p=new eB(i.contourDirection??new $m(0,1,0)),f=new VB(i.positionalLines??!1),m=new VB(i.compensation??!0),g=AF.normalRenderTarget,v=AF.normalRenderTargetDepth,y=AF.pixelRatioNode,x=AF.resolution,b=nV(i),_=new fF(s,a,o,l,c,h,u,d,p,f,m,x,g,v,y,b.alpha),w=new gB(_.calpha,"f");return new QF(e,n,t,{outlineColor:s,contourColor:a,outlineWidth:o,contourWidth:l,outlineThreshold:c,contourThreshold:h,outlineSmoothing:u,contourFrequency:d,contourDirection:p,positionalLines:f,compensation:m,...b},_,b.mode,w,b.isMask,r)}case"depth":{let s,a,o=new FB(i.gradientType??0),l=new VB(i.smooth??!1),c=new yB(i.near??50),h=new yB(i.far??200),u=new yB(i.isVector??1),d=new yB(i.isWorldSpace??0),p=new eB(i.origin??new $m),f=new eB(i.direction??new $m);i.colors?s=new ZB(i.colors.length,i.colors):(s=new ZB(2,new jm(0,0,0,1)),s.value[1]=new jm(1,1,1,1)),i.steps?a=new jB(i.steps.length,i.steps):(a=new jB(2,1),a.value[0]=0);let m=nV(i),g=new sF(o,l,c,h,u,d,p,f,s,a,m.alpha,m.isMask),v=new gB(g.calpha,"f");return new QF(e,n,t,{gradientType:o,smooth:l,near:c,far:h,isVector:u,isWorldSpace:d,origin:p,direction:f,colors:s,steps:a,...m},g,m.mode,v,m.isMask,r)}case"noise":{let s=new yB(i.scale??1),a=new eB(i.size??new $m(100,100,100)),o=new yB(i.move??1),l=new tB(i.fA??new ym(1.7,9.2)),c=new tB(i.fB??new ym(8.3,2.8)),h=new tB(i.distortion??new ym(1,1)),u=new iB(i.colorA),d=new iB(i.colorB),p=new iB(i.colorC),f=new iB(i.colorD),m=new FB(i.noiseType??0),g=new FB(i.voronoiStyle??0),v=new yB(i.highCut??1),y=new yB(i.lowCut??0),x=new yB(i.smoothness??.5),b=new yB(i.seed??.5),_=new FB(i.quality??1),w=nV(i),S=new dF(s,a,o,l,c,h,u,d,p,f,w.alpha,m,w.isMask,g,v,y,x,b,_),M=new gB(S.calpha,"f");return new QF(e,n,t,{scale:s,size:a,move:o,fA:l,fB:c,distortion:h,colorA:u,colorB:d,colorC:p,colorD:f,noiseType:m,...w,voronoiStyle:g,highCut:v,lowCut:y,smoothness:x,seed:b,quality:_},S,w.mode,M,w.isMask,r)}case"normal":{let s=new eB(i.cnormal??new $m(1,1,1)),a=nV(i),o=new eF(s,a.alpha),l=new gB(o.calpha,"f");return new QF(e,n,t,{cnormal:s,...a},o,a.mode,l,a.isMask,r)}case"gradient":{let s,a,o=new FB(i.gradientType??0),l=new VB(i.smooth??!1);i.colors?s=new ZB(i.colors.length,i.colors):(s=new ZB(10,new jm(0,0,0,1)),s.value[1]=new jm(1,1,1,1)),i.steps?a=new jB(i.steps.length,i.steps):(a=new jB(10,1),a.value[0]=0);let c=new tB(i.offset??new ym(0,0)),h=new tB(i.morph??new ym(0,0)),u=new yB(i.angle??0),d=nV(i),p=new lF(o,l,s,a,c,h,u,d.alpha,d.isMask),f=new gB(p.calpha,"f");return new QF(e,n,t,{gradientType:o,smooth:l,colors:s,steps:a,offset:c,morph:h,angle:u,...d},p,d.mode,f,d.isMask,r)}case"pattern":{let s=new FB(i.style??0),a=new FB(i.projection??0),o=new FB(["x","y","z"].indexOf(i.axis)??0),l=new yB(i.blending??0),c=new tB(i.offset??new ym(0,0)),h=new iB(i.colorA),u=new iB(i.colorB),d=new tB(i.frequency??new ym(10,10)),p=new yB(i.size??.5),f=new yB(i.variation??0),m=new yB(i.smoothness??.5),g=new yB(i.zigzag??0),v=new yB(i.rotation??0),y=new tB(i.vertical??new ym(0,1)),x=new tB(i.horizontal??new ym(0,1)),b=new FB(i.sides??6),_=nV(i),w=new gF(s,a,o,l,c,h,u,d,p,f,m,g,v,y,x,b,_.alpha,_.isMask),S=new gB(w.calpha,"f");return new QF(e,n,t,{style:s,projection:a,axis:o,blending:l,offset:c,colorA:h,colorB:u,frequency:d,size:p,variation:f,smoothness:m,zigzag:g,rotation:v,vertical:y,horizontal:x,sides:b,..._},w,_.mode,S,_.isMask,r)}default:{let s=new BB(1,0,0,1),a=nV(i),o=new QB(s,a.alpha),l=new gB(o.calpha,"f");return new QF(e,n,t,{color:s,...a},o,a.mode,l,a.isMask,r)}}}(n,t,e,r,i)}(t,e,n,i)}updateByOp(t,e,n){let i=t;if(void 0===i.path[0]){if(0===i.type)return"type"in i.props||"category"in i.props||"visible"in i.props||"noiseType"in i.props?(n.scene.markNeedsUpdateRendererDirty(),!0):function(t,e,n,i){let r=!1;for(let[s,a]of Object.entries(t)){if("bumpMap"===s||"roughnessMap"===s){r=!0;continue}if(!s||void 0===a)continue;if(iV(s,n,i,e)){"visible"===s&&"light"===n.type&&(r=!0);continue}n.visible=i.visible;let t=n.uniforms[`f${n.id}_${s}`];if(t&&!(t instanceof HB))switch(r=r||YF(n,s,a),t.constructor){case BB:if("string"==typeof a){let n=e.getColor(a);n&&(t.value=n);break}{let e=a;t.value instanceof qF?t.value=new nB(e.r,e.g,e.b,e.a):t.setRGBA(e);break}case iB:if("string"==typeof a){let n=e.getColor(a);n&&(t.value=n);break}{let e=a;t.value instanceof qF?t.value=new nB(e.r,e.g,e.b,e.a):t.value.setRGBA(e.r,e.g,e.b,e.a);break}case tB:{let e=a;t.value.setX(e[0]),t.value.setY(e[1]);break}case eB:{let e=a;t.value.setX(e[0]),t.value.setY(e[1]),t.value.setZ(e[2]);break}case vB:ZF(a,e,n);break;case ZB:t.value=a.map((t=>new jm(...t)));break;default:t.value=a}}return r}(i.props,n.shared,this,e)}else if("texture"===i.path[0])return!("texture"in e)&&!("video"in e)||ZF(i.props,n.shared,this);return!1}dispose(){if(function(t){let e=t instanceof JF?t.type:t;return"texture"===e||"video"===e||"displace_map"===e||"matcap"===e}(this)){let t=this.uniforms[`f${this.id}_texture`];if(!t)return!1;let e=t;e.image instanceof VF||e.image.deref()}}hasValueByKey(t){return void 0!==this.uniforms[t]}hasValue(t){return this.hasValueByKey(`f${this.id}_${t}`)}setValue(t,e){let n=`f${this.id}_${t}`;this.hasValueByKey(n)&&void 0!==e&&(this.uniforms[n].value=e)}getNode(t){let e=`f${this.id}_${t}`;if(this.hasValueByKey(e))return this.uniforms[e]}getValue(t){let e=`f${this.id}_${t}`;if(this.hasValueByKey(e))return this.uniforms[e].value}getName(t){let e=/f\d+_(.*)/.exec(t);if(e&&e.length>1)return e[1];console.log(`Layer.getName: error ${t}`)}getNames(){let t=[];for(let e in this.uniforms){let n=this.getName(e);n&&t.push(n)}return t}},QF=class extends JF{constructor(t,e,n,i,r,s,a,o,l){super(t,e,n,i,l),this.params=i,this.color=r,this.mode=s,this.alpha=a,this.isMask=o}},tV=class extends JF{constructor(t,e,n,i,r,s){super(t,e,n,i,s),this.position=r}},eV=class extends JF{constructor(t,e,n,i,r,s){super(t,e,n,r,s),this.node=i}static createLightLayer(t,e,n,i){let r,s,a=new yB(KF(n.alpha,i)),o=new FB(n.mode),l=new yB(n.bumpMapIntensity),c=new yB(KF(n.alphaOverride,i));if(n.visible)if("lambert"===n.category){r=new OF;let t=new BB(i.color(n.emissive)??0),e=new VB(n.occlusion??!0);s={emissive:t,occlusion:e},r.emissive=t,r.occlusion=e}else if("toon"===n.category){r=new zF;let t=new yB(n.shininess??30),e=new BB(i.color(n.specular)??1118481);s={shininess:t,specular:e},r.shininess=t,r.specular=e}else if("physical"===n.category){r=new IF;let t=new yB(n.roughness??.3),e=new yB(n.metalness??0),i=new yB(n.reflectivity??.5),a=new VB(n.occlusion??!0);s={roughness:t,metalness:e,reflectivity:i,occlusion:a},r.roughness=t,r.metalness=e,r.reflectivity=i,r.occlusion=a}else{r=new LF;let t=new yB(n.shininess??30),e=new BB(void 0!==n.specular?i.color(n.specular)??1118481:1118481),a=new VB(n.occlusion??!0);s={shininess:t,specular:e,occlusion:a},r.shininess=t,r.specular=e,r.occlusion=a}else r=new RF,s={};return r.alpha=new yB(1),r.shadingAlpha=a,r.shadingBlend=o,r.bumpMapIntensity=l,r.alphaOverride=c,s.alpha=r.shadingAlpha,s.mode=r.shadingBlend,s.bumpMapIntensity=r.bumpMapIntensity,s.alphaOverride=r.alphaOverride,new eV(t,e,n,r,s,i)}get category(){return this.node.category}};function nV(t){return{alpha:new yB(t.alpha??1),mode:new FB(t.mode??0),isMask:new VB(t.isMask??!1)}}function iV(t,e,n,i){if("displace"===n.type&&("intensity"===t||"visible"===t)){let t=e.uniforms[`f${e.id}_intensity`];return t?(t.value=n.intensity*(n.visible?1:0),t):void 0}if("displace"!==n.type&&("alpha"===t||"visible"===t)){let r=e.uniforms[`f${e.id}_alpha`];if(!r)return;if(r.value=KF(n.alpha,i)*(n.visible?1:0),"outline"===n.type&&"visible"===t){let t=e.uniforms[`f${e.id}_compensation`];t&&(t.value=n.compensation&&n.visible)}return r}}function rV(t,e){let n=0,i=t.layers.find((t=>"light"===t.data.type));if(i){let t=i.data,n=Number(e.getVariable(t.alphaOverride));if(("string"==typeof t.alphaOverride?n/100:t.alphaOverride)<1)return!0}for(let i of t.layers){if("displace"!==i.data.type&&i.data.isMask)return!0;if("displace"!==i.data.type&&"alpha"in i.data&&"light"!==i.data.type&&"fresnel"!==i.data.type&&"texture"!==i.data.type&&"matcap"!==i.data.type&&"rainbow"!==i.data.type&&"outline"!==i.data.type&&"pattern"!==i.data.type){let t=i.data.visible?i.data.alpha:0;if("string"==typeof t&&(t=Math.max(0,Math.min(1,Number(e.getVariable(t)??100)/100))),1===t&&"depth"===i.data.type||"gradient"===i.data.type){for(let e of i.data.colors)if(e[3]<1){t=e[3];break}}else if(1===t&&"noise"===i.data.type){let n=e.color(i.data.colorA).a,r=e.color(i.data.colorB).a,s=e.color(i.data.colorC).a,a=e.color(i.data.colorD).a,o=Math.min(n,Math.min(r,Math.min(s,a)));o<1&&(t=o)}n+=(1-n)*t}}return n<1}var sV=class extends oy{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.shadersPatchedForShapeBlend=!1,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},aV=class extends sV{constructor(t,e,n,i){super(),this.flatShading=t,this.side=e,this.wireframe=n,this.root=i}updateAfterBuild(){let t=this.root;this.lights=t.lights,this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader,Object.assign(this.defines,t.defines),Object.assign(this.uniforms,t.uniforms),this.extensions=t.extensions,this.transparent=t.transparent,this.cacheKey=t.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(t,e){this.root.onBeforeCompile(t)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(t,e,n,i){return this.root.getFlavor(t,e,n,i)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(t){return this.root.getLayersOfType(t)}getLayerByUuid(t){return this.root.getLayerByUuid(t)}updateByOp(t,e,n){this.root.updateByOp(t,e,n)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},oV=class extends sV{constructor(t,e,n=!0){super(),this.data=t,this.allowVariableSaves=n,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=e.shared.needsJitter,Yk.startContext(this),this.reset0(t,e),Yk.endContext(this)}get nodeMaterial(){return this}getFlavor(t,e,n,i){let r=n?6:(t?3:0)+e;if(r+=7*((i?.resolutionLevel??0)-(i?.useChildrenColors?4:0)),0===r)return this;void 0===this.flavors&&(this.flavors=[]),r-=1;let s=this.flavors[r];return void 0===s&&(s=new aV(t,e,n,this),s.needsJitter=this.needsJitter,this.flavors[r]=s,s.flatShading=t,s.side=e,s.updateAfterBuild(),i&&(s.defines.SHAPEBLEND=i.resolutionLevel,s.defines.SHAPEBLEND_C=i.useChildrenColors?1:0)),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){return this.lightLayer.getNode("occlusion")?.value??!1}reset(t,e,n=!1){Yk.startContext(this),(this.data!==t||n)&&this.reset0(t,e),Yk.endContext(this)}reset0(t,e){this.data=t;let n=t.layers??uL.defaultTwoLayerData("phong").layers;try{this.layers=n.map((t=>JF.create(this.layerIdGen++,t.id,t.data,e.shared)))}catch{this.layers=[]}this.layers.reverse(),this.name=t.name??"Untitled Material",this.onUpdate(e.shared),this.transparent=rV(t,e.shared),this.saveVariableLocations(e)}onVariableUpdate(t,e,n){if("alphaOverride"===t[0])this.transparent=rV(this.data,n.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(e)/100,1)));else if("layer"===t[0]){let i=t[1],r=t[2];if(i&&r){let t=this.layers.find((t=>t.uuid===i));t?.hasValue(r)&&("alpha"===r?(this.transparent=rV(this.data,n.shared),t.setValue(r,Math.max(0,Math.min(Number(e)/100,1)))):t.setValue(r,e))}}}saveVariableLocations(t){if(!this.allowVariableSaves)return;let e=this.data.layers.find((t=>"light"===t.data.type));e&&t.shared.getVariable(e.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach((e=>{"alpha"in e.data&&"string"==typeof e.data.alpha&&t.shared.getVariable(e.data.alpha,["material",this.uuid,"layer",e.id,"alpha"])}))}getLayersOfType(t){return this.layers.filter((e=>e.type===t))}getLayerByUuid(t){return this.layers.find((e=>e.uuid===t))}onUpdate(t){this.lightLayer=this.layers.find((t=>t instanceof eV)),void 0===this.lightLayer&&(this.lightLayer=new eV(0,"",{...hL.defaultData("light","phong"),visible:!1},new RF,{},t)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let t=this.layers.find((t=>t instanceof eV));if(!t)return;let e=t.data,n=e.bumpMap,i=e.roughnessMap;t.node.bumpMap=void 0,t.node.roughnessMap=void 0;for(let e=0;e<this.layers.length;++e){let r=this.layers[e];r instanceof QF&&r.color instanceof iF&&(r.uuid===n&&(t.node.bumpMap=r.color),r.uuid===i&&(t.node.roughnessMap=r.color))}}updateByOp(t,e,n){if(Yk.startContext(this),void 0!==e?this.data=e:e=this.data,this.transparent=rV(e,n.shared),"layers"===t.path[0]){let i=n.shared,r=t.path[1];if(void 0===r)n.scene.markNeedsUpdateRendererDirty(),this.reset0(e,n);else{0===t.type&&void 0!==t.props.occlusion&&n.scene.markNeedsUpdateRendererDirty();let s=this.layers.find((t=>t.uuid===r));if(s){let a,o=e.layers.data(r);0===t.type&&("alpha"in t.props||"alphaOverride"in t.props)&&(a="alpha"in t.props?{...t.props,alpha:KF(t.props.alpha,i,["material",this.uuid,"layer",r,"alpha"])}:{...t.props,alphaOverride:KF(t.props.alphaOverride,i,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...t,...a?{props:a}:{},path:t.path.slice(2)},o,n)&&this.reset0(e,n)}}}else this.reset0(e,n);Yk.endContext(this)}applyMasks(){for(let t=0;t<this.layers.length;++t){let e=this.layers[t];e instanceof QF?e.color.mask=void 0:e instanceof eV&&(e.node.mask=void 0)}for(let t=0;t<this.layers.length;++t){let e=this.layers[t];if(e instanceof QF&&e.isMask.value&&e.data.visible&&t>0){let n=t-1,i=this.layers[n];i instanceof eV?i.node.mask=new _B(e.color,e.alpha,_B.MUL):i instanceof QF&&(i.isMask.value||(i.color.mask=new _B(e.color,e.alpha,_B.MUL)))}}}blendColors(){let t=this.layers.findIndex((t=>t instanceof QF)),e=this.layers.findIndex((t=>t instanceof eV));if(-1!==t&&t<e){let n=this.layers[t].color;for(let i=t+1;i<e;++i){let t=this.layers[i];if(t instanceof QF){if(t.isMask.value)continue;n=new KB(n,t.color,t.alpha,t.mode)}}this.fragment.color=n}else this.fragment.color=void 0}blendAfterColors(){let t=new gB("outgoingLight","f"),e=this.layers.findIndex((t=>t instanceof eV));if(this.layers.length>e+1){for(let n=e+1;n<this.layers.length;++n){let e=this.layers[n];if(e instanceof QF){if(e.isMask.value)continue;t=new KB(t,e.color,e.alpha,e.mode)}}this.fragment.afterColor=t}else this.fragment.afterColor=void 0}blendPositions(){let t=this.layers.filter((t=>t instanceof tV));if(t.length>0){let e=t[0].position;for(let n=1;n<t.length;++n)t[n]&&(e=new _B(e,t[n].position,_B.ADD),e=new _B(e,new yB(.5).setReadonly(!0),_B.MUL));this.fragment.position=e}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(t){this.shapeBlendhack&&this.shapeBlendhack(this),t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.extensionDerivatives=!0===this.extensions.derivatives,t.extensionFragDepth=!0===this.extensions.fragDepth,t.extensionDrawBuffers=!0===this.extensions.drawBuffers,t.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}clampUniformsForPreview(t,e){let n=(t,e,n)=>Math.min(Math.max(t,e),n);for(let i of this.layers)if("displace"===i.type){let r=n(i.uniforms[`f${i.id}_intensity`].value,t,e);i.uniforms[`f${i.id}_intensity`].value=r}}updateFrame(t){for(let e=0;e<this.updaters.length;++e)t.updateNode(this.updaters[e])}build(){let t=new kB;t.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,t.build(this.fragment,this.fragment),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms=t.uniforms,this.extensions=t.extensions,this.updaters=t.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this.shadersPatchedForShapeBlend=!1,this}nodeMaterialDispose(){this.layers.forEach((t=>t.dispose())),super.dispose();for(let t of this.flavors)t&&t.dispose()}assetsLoaded(){for(let t of this.layers)if(t instanceof QF){let e=t.params.texture;if(e instanceof WB&&!e.image.loaded)return!1}return!0}};Object.defineProperties(sV.prototype,{properties:{get:function(){return this.fragment.properties}}});var lV=class extends oV{constructor(t,e,n){super(t,e,!1),this.uuid=n,this.allowVariableSaves=!0,this.saveVariableLocations(e)}},cV=new Map;function hV(t){if("string"==typeof t)return t;let e=cV.get(t);return e||(e={url:URL.createObjectURL(new Blob([t]))},cV.set(t,e)),e.url}var uV,dV=new Promise((t=>{t}));dV.then((t=>uV=t));var pV,fV,mV=class{constructor({src:t,volume:e,delay:n,loop:i}){let r;this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)},r="string"==typeof t?{src:t}:{src:hV(t),format:"wav"},this.sound=new uV.Howl(r),this.sound.on("end",this.onEnd),this.src=t,void 0!==e&&(this.volume=e),void 0!==n&&(this.delay=n),void 0!==i&&(this.loop=i)}get status(){return this._status}get volume(){return this._volume}set volume(t){this._volume=t,this.sound.volume(t)}get loop(){return this._loop}set loop(t){this._loop=t,this.loopsRemaining=t}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout((()=>{this.sound.play(),this.clearDelay()}),this.delay)}fade(t,e=1e3){t?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout((()=>{this.sound.fade(this._volume,0,e),this.clearFade()}),t)):this.sound.fade(this._volume,0,e)}on(t,e,n){this.sound.on(t,e,n)}off(t,e,n){this.sound.off(t,e,n)}play(){"playing"===this._status||this.sound.playing()||("paused"===this._status?(0===this.sound.seek()?this.replay():this.sound.play(),this._status="playing"):"stopped"===this._status&&(this.replay(),this._status="playing"))}pause(){"playing"===this._status&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(t=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},gV=class{constructor(){this.type="ShapePath",this.color=new pv,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new dw,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath?.lineTo(t,e),this}quadraticCurveTo(t,e,n,i){return this.currentPath?.quadraticCurveTo(t,e,n,i),this}bezierCurveTo(t,e,n,i,r,s){return this.currentPath?.bezierCurveTo(t,e,n,i,r,s),this}splineThru(t){return this.currentPath?.splineThru(t),this}toShapes(){let t=0,e=1,n=2,i=3,r=4,s=5,a=6,o={loc:t,t:0};function l(e,i,r,s){let a=e.x,l=i.x,h=r.x,u=s.x,d=e.y,p=i.y,f=r.y,m=s.y,g=(u-h)*(d-f)-(m-f)*(a-h),v=(m-f)*(l-a)-(u-h)*(p-d),y=g/v,x=((l-a)*(d-f)-(p-d)*(a-h))/v;if(0===v&&0!==g||y<=0||y>=1||x<0||x>1)return null;if(0===g&&0===v){for(let h=0;h<2;h++){if(c(0===h?r:s,e,i),o.loc===t){let t=0===h?r:s;return{x:t.x,y:t.y,t:o.t}}if(o.loc===n){return{x:+(a+o.t*(l-a)).toPrecision(10),y:+(d+o.t*(p-d)).toPrecision(10),t:o.t}}}return null}for(let n=0;n<2;n++)if(c(0===n?r:s,e,i),o.loc===t){let t=0===n?r:s;return{x:t.x,y:t.y,t:o.t}}return{x:+(a+y*(l-a)).toPrecision(10),y:+(d+y*(p-d)).toPrecision(10),t:y}}function c(l,c,h){let u,d=h.x-c.x,p=h.y-c.y,f=l.x-c.x,m=l.y-c.y,g=d*m-f*p;return l.x===c.x&&l.y===c.y?(o.loc=t,void(o.t=0)):l.x===h.x&&l.y===h.y?(o.loc=e,void(o.t=1)):void(g<-Number.EPSILON?o.loc=i:g>Number.EPSILON?o.loc=r:d*f<0||p*m<0?o.loc=s:Math.sqrt(d*d+p*p)<Math.sqrt(f*f+m*m)?o.loc=a:(u=0!==d?f/d:m/p,o.loc=n,o.t=u))}function h(t,e,n){let i=new ym;e.getCenter(i);let r=[];return n.forEach((e=>{e.boundingBox.containsPoint(i)&&function(t,e){let n=[],i=[];for(let r=1;r<t.length;r++){let s=t[r-1],a=t[r];for(let t=1;t<e.length;t++){let r=l(s,a,e[t-1],e[t]);null!==r&&void 0===n.find((t=>t.t<=r.t+Number.EPSILON&&t.t>=r.t-Number.EPSILON))&&(n.push(r),i.push(new ym(r.x,r.y)))}}return i}(t,e.points).forEach((t=>{r.push({identifier:e.identifier,isCW:e.isCW,point:t})}))})),r.sort(((t,e)=>t.point.x-e.point.x)),r}let u=0,d=999999999,p=-999999999,f=[];this.subPaths.forEach((t=>{let e=t.getPoints(),n=-999999999,i=999999999,r=-999999999,s=999999999;for(let t=0;t<e.length;t++){let a=e[t];a.y>n&&(n=a.y),a.y<i&&(i=a.y),a.x>r&&(r=a.x),a.x<s&&(s=a.x)}p<=r&&(p=r+1),d>=s&&(d=s-1),e.length&&f.push({curves:t.curves,points:e,isCW:Gw.isClockWise(e),identifier:u++,boundingBox:new eM(new ym(s,i),new ym(r,n))})}));let m=f.map((t=>function(t,e,n,i,r){(null==r||""===r)&&(r="nonzero");let s=new ym;t.boundingBox.getCenter(s);let a=h([new ym(n,s.y),new ym(i,s.y)],t.boundingBox,e);a.sort(((t,e)=>t.point.x-e.point.x));let o=[],l=[];a.forEach((e=>{e.identifier===t.identifier?o.push(e):l.push(e)}));let c=o[0].point.x,u=[],d=0;for(;d<l.length&&l[d].point.x<c;)u.length>0&&u[u.length-1]===l[d].identifier?u.pop():u.push(l[d].identifier),d++;if(u.push(t.identifier),"evenodd"===r){let e=u.length%2==0,n=u[u.length-2];return{identifier:t.identifier,isHole:e,for:n}}if("nonzero"===r){let n=!0,i=null,r=null;for(let t=0;t<u.length;t++){let s=u[t];e[s]&&(n?(r=e[s].isCW,n=!1,i=s):r!==e[s].isCW&&(r=e[s].isCW,n=!0))}return{identifier:t.identifier,isHole:n,for:i}}console.warn('fill-rule: "'+r+'" is currently not implemented.')}(t,f,d,p,this.userData?.style.fillRule))),g=[];return f.forEach((t=>{let e=m[t.identifier];if(e&&!e.isHole){let e=new yw;e.curves=t.curves,m.filter((e=>e?.isHole&&e.for===t.identifier)).forEach((t=>{if(t){let n=f[t.identifier],i=new dw;i.curves=n.curves,e.holes.push(i)}})),g.push(e)}})),g}},vV=!1,yV=new Promise((t=>{pV=t})),xV=!1;function bV(){if(vV=!0,!xV)return fV||(fV=async function(){let t=await n.e(104).then(n.bind(n,"../node_modules/@splinetool/loader/build/opentype.js"));pV(t),xV=!0}(),fV)}var _V=new class{async load(t,e,n=(()=>{})){let{load:i}=await yV;i(t,((t,i)=>{t||!i?n(t??"Something went wrong"):e(i)}))}async parse(t){let{parse:e,Bidi:n}=await yV;try{let i=e(t),r=new n,s=t=>i.charToGlyphIndex(t.char);return r.registerModifier("glyphIndex",null,s),r.applyFeatures(i,i.defaultRenderOptions.features),{font:i,bidi:r}}catch(t){console.error(t)}}};async function wV(t){let e,n,i=!1;if(t.url?(e=await async function(t){return await(await fetch(t)).arrayBuffer()}(t.url),n=t.url,i=t.url.startsWith("/")):t.data&&(e=t.data.buffer.slice(t.data.byteOffset,t.data.byteOffset+t.data.byteLength)),e){if(!vV)return{font:void 0,url:n,intercepted:i,arr:e,bidi:null};{let t=await _V.parse(e);if(t)return{font:t.font,url:n,intercepted:i,arr:e,bidi:t.bidi}}}}function SV(t,e){return e.state.glyphIndex===t||e.state.fina===t||e.state.medi===t||e.state.init===t}var MV=class{constructor(t){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=t.isUserFont??!1,this._loadingPromise=wV(t).then((t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)}))}update(t){this._isLoaded=!1,this._isUserFont=t.isUserFont??!1,this._loadingPromise=wV(t).then((t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)}))}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(t,e,n){if(!this._bidi)return[];let i=this._bidi;i.getTextGlyphs(e);let r=i.tokenizer.tokens,s=[],a=0,o=n.length===r.length;for(let i=0;i<n.length;i++){let l=n[i].index,c=String.fromCharCode(n[i].unicode),h=r[a];if(SV(l,h)||o)s.push({char:c,index:l,replacements:[h.state.glyphIndex],replacementChars:[h.char]}),a++;else{let n=h.char,i="",r=[h.state.glyphIndex],o=[],u=!1;for(;!u;)a++,i=e.charAt(a),n+=i,r.push(t.charToGlyphIndex(i)),o=t.stringToGlyphs(n),1===o.length&&o[0].index===l&&(u=!0),a>e.length&&(u=!0);s.push({char:c,index:l,replacements:r,replacementChars:Array.from(n)}),a++}}return s}generateShapes(t,e){if(!this._isLoaded)return;let n,i=this.font,r=e.fontSize/this.unitsPerEm,s=e.fontSize*e.lineHeight,a=t.map((t=>this.getTextWidth(t,e))),o=e.width,l=this.getCharWidth("\n",e),c=1===e.horizontalAlign?l:0,h=this.computeSpaceWidthForLine(t,0,e),u=this.getLineInitialOffsetX(a[0],o,e.horizontalAlign,t[0],l),d=this.getLineInitialOffsetY(s,t.length,e.height,r,e.verticalAlign),p=[],f=t.map((t=>[])),m=t.map((t=>[]));for(let g=0;g<t.length;g++){let v=t[g],y={features:{liga:!0}},x=[];try{x=i.stringToGlyphs(v,y)}catch(t){console.warn(t)}u=this.getLineInitialOffsetX(a[g],o,e.horizontalAlign,v,l);let b=[];try{b=this.reverseLigaturesTable(i,v,x)}catch(t){console.warn(t)}h=this.computeSpaceWidthForLine(t,g,e);for(let t=0;t<x.length;t++){let s=x[t],a=0===s.index?"\n":s.unicode?String.fromCharCode(s.unicode):void 0,o=b[t],l=0,v=0;0===t&&2===e.horizontalAlign&&void 0!==s.leftSideBearing&&(v=-s.leftSideBearing*r),n&&(l=i.getKerningValue(s,n)*r),u+=v+l;let y=0;if("\n"===a)y=c;else if(" "===a)y=h;else{let t=this.createPath(s,r,u,d,e);t&&(y=t.offsetX-(l+v),p.push(t.path))}if(1===o.replacements.length)m[g].push([u,d]),f[g].push(y);else{let t=o.replacements.map((t=>(i.glyphs.get(t).advanceWidth??0)*r)),e=t.reduce(((t,e)=>t+e),0),n=t.map((t=>t/e)),s=u;for(let t=0;t<n.length;t++){let e=y*n[t];m[g].push([s,d]),f[g].push(e),s+=e}}u+=y,n=s}d-=s}let g=[];for(let t=0,e=p.length;t<e;t++)g.push(...p[t].toShapes());return{shapes:g,charWidths:f,lineWidths:a,charCoords:m}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){return this.font?.ascender??0}get descender(){return this.font?.descender??0}get familyName(){return this.font?.names.fontFamily??""}get subfamilyName(){return this.font?.names.fontSubfamily??""}get unitsPerEm(){return this.font?.unitsPerEm??1}getLineInitialOffsetX(t,e,n,i,r){return(3===n||2===n)&&i.indexOf("\n")>=0&&(t-=r),3===n?.5*e-.5*t:2===n?e-t:0}getLineInitialOffsetY(t,e,n,i,r){let s=e*t,a=t-Math.abs(this.ascender-this.descender)*i,o=-this.ascender*i-a/2;return 3===r?-(n-s-o):2===r?-(.5*n-.5*s-o):o}createPath(t,e,n,i,r){let s=t.getPath(n,-i,r.fontSize,{kerning:!1,letterSpacing:r.letterSpacing});if(!s)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+this.familyName+".");let a=new gV,o=(t.advanceWidth??1)*e;if(t)for(let t of s.commands){let e=a.currentPath?.currentPoint;if(!e||"Z"===t.type||e.x!==t.x||-e.y!==t.y)switch(t.type){case"M":a.moveTo(t.x,-t.y);break;case"L":a.lineTo(t.x,-t.y);break;case"Q":a.quadraticCurveTo(t.x1,-t.y1,t.x,-t.y);break;case"C":a.bezierCurveTo(t.x1,-t.y1,t.x2,-t.y2,t.x,-t.y)}}return a.subPaths.forEach((t=>{let e=function(t){if(t.length){let e=t[0];if(e instanceof sw)return e.v1;if(e instanceof iw||e instanceof ow)return e.v0}}(t.curves);void 0!==e&&t.currentPoint.distanceTo(e)>0&&t.lineTo(e.x,e.y)})),{offsetX:o+r.fontSize*r.letterSpacing,path:a}}getCharWidth(t,e){return this.font?.getAdvanceWidth(t,e.fontSize,{kerning:!0,letterSpacing:e.letterSpacing})??0}getTextWidth(t,e){return this.font?.getAdvanceWidth(t,e.fontSize,{kerning:!0,letterSpacing:e.letterSpacing})??0}computeSpaceWidthForLine(t,e,n){let i=this.getCharWidth(" ",n),r=t[e];if(r){let s=this.countSpaces(r.trimEnd());if(4===n.horizontalAlign&&e<t.length-1&&s){return(n.width-(this.getTextWidth(r,n)-s*i))/s}}return i}countSpaces(t){return(t.match(/ /g)||[]).length}};var TV=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(t){return this.objects.get(t)}get size(){return this.objects.size}get(t,e,n){let i=this.objects.get(t);return void 0===i?(i=this.createObject(t,e,n),this.objects.set(t,i)):i.isShared=!0,i}forceDelete(t){let e=this.objects.get(t);e&&(this.disposeObject(e),this.objects.delete(t))}mutateIfUnique(t,e){let n=this.objects.get(t);if(n&&!0!==n.isShared)return this.objects.delete(t),this.objects.set(e,n),n}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(t,e){e===this.objects.get(t)&&this.unreachable.delete(t)}endGc(){this.unreachable.forEach((t=>{this.disposeObject(this.objects.get(t)),this.objects.delete(t)})),this.unreachable.clear()}dispose(){this.objects.forEach((t=>{this.disposeObject(t)})),this.objects.clear()}},EV=class extends TV{constructor(t){super(),this.flatShading=t}disposeObject(t){t.dispose()}createObject(t,e,n){let i=hk(t,e,this.flatShading,n);return i.computeBoundingSphere(),i}},AV={markNeedsUpdateRendererDirty:()=>{}},CV=1e3,PV=512e3;var RV="https://hooks.spline.design",OV=`${RV}/events?hashFile=`,DV=class{constructor(t,e){this.id=t,this.userWebhook=e,this.result=void 0,this._connected=!1,this.emitter=XU(),this.reconnectWaitFor=CV,this._onError=t=>{this.eventSource?.removeEventListener("message",this._onMessage),this.eventSource?.removeEventListener("error",this._onError),this.eventSource?.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=t=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=CV,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=CV,this._connected=!1},this._onMessage=t=>{let e,n=t.data;try{e=JSON.parse(n)}catch(t){console.error("Error parsing webhook message",t)}if(e){let t=!1;this.userWebhook.parametersSchemas.forEach((({data:n})=>{void 0!==e[n.name]&&function(t,e){let n=typeof t;return!!(("string"===e||"number"===e)&&n===e||"boolean"===e&&("true"===t||"false"===t||!0===t||!1===t)||"image"===e&&"string"===n&&t.startsWith("http"))}(e[n.name],n.type)&&(void 0===this.result&&(this.result={}),this.result[n.name]=e[n.name],t=!0)})),t&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(OV+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){this.eventSource?.removeEventListener("message",this._onMessage),this.eventSource?.removeEventListener("error",this._onError),this.eventSource?.removeEventListener("open",this._onConnected),this.eventSource?.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>PV&&(this.reconnectWaitFor=PV),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout((()=>{this.scheduledReconnectHandle=void 0,this.connect()}),this.reconnectWaitFor)}update(t){this.userWebhook=t}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}getParametersKeys(){return this.userWebhook.parametersSchemas.map((t=>t.data.name))}getParameterValue(t){if(this.getParametersKeys().includes(t)){if(this.result)return this.result?.[t];for(let e of this.userWebhook.parametersSchemas)if(e.data.name===t)return QL.defaultParameterValueByType(e.data.type)}}},LV=globalThis.atob,IV=globalThis.btoa,zV=class{static floatTo16BitPCM(t){let e=new ArrayBuffer(2*t.length),n=new DataView(e),i=0;for(let e=0;e<t.length;e++,i+=2){let r=Math.max(-1,Math.min(1,t[e]));n.setInt16(i,r<0?32768*r:32767*r,!0)}return e}static base64ToArrayBuffer(t){let e=LV(t),n=e.length,i=new Uint8Array(n);for(let t=0;t<n;t++)i[t]=e.charCodeAt(t);return i.buffer}static arrayBufferToBase64(t){t instanceof Float32Array?t=this.floatTo16BitPCM(t):t instanceof Int16Array&&(t=t.buffer);let e="",n=new Uint8Array(t);for(let t=0;t<n.length;t+=32768){let i=n.subarray(t,t+32768);e+=String.fromCharCode.apply(null,i)}return IV(e)}static mergeInt16Arrays(t,e){if(t instanceof ArrayBuffer&&(t=new Int16Array(t)),e instanceof ArrayBuffer&&(e=new Int16Array(e)),!(t instanceof Int16Array&&e instanceof Int16Array))throw new Error("Both items must be Int16Array");let n=new Int16Array(t.length+e.length);for(let e=0;e<t.length;e++)n[e]=t[e];for(let i=0;i<e.length;i++)n[t.length+i]=e[i];return n}static generateId(t,e=21){let n="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";return`${t}${Array(e-t.length).fill(0).map((t=>n[Math.floor(58*Math.random())])).join("")}`}},NV=t=>new Promise((e=>setTimeout((()=>e()),t))),UV=class{constructor(){this.eventHandlers={},this.nextEventHandlers={}}clearEventHandlers(){return this.eventHandlers={},this.nextEventHandlers={},!0}on(t,e){return this.eventHandlers[t]=this.eventHandlers[t]||[],this.eventHandlers[t].push(e),e}onNext(t,e){return this.nextEventHandlers[t]=this.nextEventHandlers[t]||[],this.nextEventHandlers[t].push(e),e}off(t,e){let n=this.eventHandlers[t]||[];if(e){let i=n.indexOf(e);if(-1===i)throw new Error(`Could not turn off specified event listener for "${t}": not found as a listener`);n.splice(i,1)}else delete this.eventHandlers[t];return!0}offNext(t,e){let n=this.nextEventHandlers[t]||[];if(e){let i=n.indexOf(e);if(-1===i)throw new Error(`Could not turn off specified next event listener for "${t}": not found as a listener`);n.splice(i,1)}else delete this.nextEventHandlers[t];return!0}async waitForNext(t,e=null){let n,i=Date.now();for(this.onNext(t,(t=>n=t));!n;){if(e&&Date.now()-i>e)return null;await NV(1)}return n}dispatch(t,e){let n=[].concat(this.eventHandlers[t]||[]);for(let t of n)t(e);let i=[].concat(this.nextEventHandlers[t]||[]);for(let t of i)t(e);return delete this.nextEventHandlers[t],!0}},kV=class extends UV{constructor({url:t,apiKey:e,dangerouslyAllowAPIKeyInBrowser:n,debug:i}={}){if(super(),this.defaultUrl="wss://api.openai.com/v1/realtime",this.url=t||this.defaultUrl,this.apiKey=e||null,this.debug=!!i,this.ws=null,globalThis.document&&this.apiKey&&!n)throw new Error('Can not provide API key in the browser without "dangerouslyAllowAPIKeyInBrowser" set to true')}isConnected(){return!!this.ws}log(...t){let e=[`[Websocket/${(new Date).toISOString()}]`].concat(t).map((t=>"object"==typeof t&&null!==t?JSON.stringify(t,null,2):t));return this.debug&&console.log(...e),!0}async connect({model:t}={model:"gpt-4o-realtime-preview-2024-10-01"}){if(!this.apiKey&&this.url===this.defaultUrl&&console.warn(`No apiKey provided for connection to "${this.url}"`),this.isConnected())throw new Error("Already connected");if(globalThis.document){this.apiKey&&console.warn("Warning: Connecting using API key in the browser, this is not recommended");let e=new(0,globalThis.WebSocket)(`${this.url}${t?`?model=${t}`:""}`,["realtime",`openai-insecure-api-key.${this.apiKey}`,"openai-beta.realtime-v1"]);return e.addEventListener("message",(t=>{let e=JSON.parse(t.data);this.receive(e.type,e)})),new Promise(((t,n)=>{let i=()=>{this.disconnect(e),n(new Error(`Could not connect to "${this.url}"`))};e.addEventListener("error",i),e.addEventListener("open",(()=>{this.log(`Connected to "${this.url}"`),e.removeEventListener("error",i),e.addEventListener("error",(()=>{this.disconnect(e),this.log(`Error, disconnected from "${this.url}"`),this.dispatch("close",{error:!0})})),e.addEventListener("close",(()=>{this.disconnect(e),this.log(`Disconnected from "${this.url}"`),this.dispatch("close",{error:!1})})),this.ws=e,t(!0)}))}))}}disconnect(t){if(!t||this.ws===t)return this.ws&&this.ws.close(),this.ws=null,!0}receive(t,e){return this.log("received:",t,e),this.dispatch(`server.${t}`,e),this.dispatch("server.*",e),!0}send(t,e){if(!this.isConnected())throw new Error("RealtimeAPI is not connected");if("object"!=typeof(e=e||{}))throw new Error("data must be an object");let n={event_id:zV.generateId("evt_"),type:t,...e};return this.dispatch(`client.${t}`,n),this.dispatch("client.*",n),this.log("sent:",t,n),this.ws.send(JSON.stringify(n)),!0}},BV=class{constructor(){$M(this,"defaultFrequency",24e3),$M(this,"EventProcessors",{"conversation.item.created":t=>{let{item:e}=t,n=JSON.parse(JSON.stringify(e));if(this.itemLookup[n.id]||(this.itemLookup[n.id]=n,this.items.push(n)),n.formatted={},n.formatted.audio=new Int16Array(0),n.formatted.text="",n.formatted.transcript="",this.queuedSpeechItems[n.id]&&(n.formatted.audio=this.queuedSpeechItems[n.id].audio,delete this.queuedSpeechItems[n.id]),n.content){let t=n.content.filter((t=>["text","input_text"].includes(t.type)));for(let e of t)n.formatted.text+=e.text}return this.queuedTranscriptItems[n.id]&&(n.formatted.transcript=this.queuedTranscriptItems.transcript,delete this.queuedTranscriptItems[n.id]),"message"===n.type?"user"===n.role?(n.status="completed",this.queuedInputAudio&&(n.formatted.audio=this.queuedInputAudio,this.queuedInputAudio=null)):n.status="in_progress":"function_call"===n.type?(n.formatted.tool={type:"function",name:n.name,call_id:n.call_id,arguments:""},n.status="in_progress"):"function_call_output"===n.type&&(n.status="completed",n.formatted.output=n.output),{item:n,delta:null}},"conversation.item.truncated":t=>{let{item_id:e,audio_end_ms:n}=t,i=this.itemLookup[e];if(!i)throw new Error(`item.truncated: Item "${e}" not found`);let r=Math.floor(n*this.defaultFrequency/1e3);return i.formatted.transcript="",i.formatted.audio=i.formatted.audio.slice(0,r),{item:i,delta:null}},"conversation.item.deleted":t=>{let{item_id:e}=t,n=this.itemLookup[e];if(!n)throw new Error(`item.deleted: Item "${e}" not found`);delete this.itemLookup[n.id];let i=this.items.indexOf(n);return i>-1&&this.items.splice(i,1),{item:n,delta:null}},"conversation.item.input_audio_transcription.completed":t=>{let{item_id:e,content_index:n,transcript:i}=t,r=this.itemLookup[e],s=i||" ";return r?(r.content[n].transcript=i,r.formatted.transcript=s,{item:r,delta:{transcript:i}}):(this.queuedTranscriptItems[e]={transcript:s},{item:null,delta:null})},"input_audio_buffer.speech_started":t=>{let{item_id:e,audio_start_ms:n}=t;return this.queuedSpeechItems[e]={audio_start_ms:n},{item:null,delta:null}},"input_audio_buffer.speech_stopped":(t,e)=>{let{item_id:n,audio_end_ms:i}=t;this.queuedSpeechItems[n]||(this.queuedSpeechItems[n]={audio_start_ms:i});let r=this.queuedSpeechItems[n];if(r.audio_end_ms=i,e){let t=Math.floor(r.audio_start_ms*this.defaultFrequency/1e3),n=Math.floor(r.audio_end_ms*this.defaultFrequency/1e3);r.audio=e.slice(t,n)}return{item:null,delta:null}},"response.created":t=>{let{response:e}=t;return this.responseLookup[e.id]||(this.responseLookup[e.id]=e,this.responses.push(e)),{item:null,delta:null}},"response.output_item.added":t=>{let{response_id:e,item:n}=t,i=this.responseLookup[e];if(!i)throw new Error(`response.output_item.added: Response "${e}" not found`);return i.output.push(n.id),{item:null,delta:null}},"response.output_item.done":t=>{let{item:e}=t;if(!e)throw new Error('response.output_item.done: Missing "item"');let n=this.itemLookup[e.id];if(!n)throw new Error(`response.output_item.done: Item "${e.id}" not found`);return n.status=e.status,{item:n,delta:null}},"response.content_part.added":t=>{let{item_id:e,part:n}=t,i=this.itemLookup[e];if(!i)throw new Error(`response.content_part.added: Item "${e}" not found`);return i.content.push(n),{item:i,delta:null}},"response.audio_transcript.delta":t=>{let{item_id:e,content_index:n,delta:i}=t,r=this.itemLookup[e];if(!r)throw new Error(`response.audio_transcript.delta: Item "${e}" not found`);return r.content[n].transcript+=i,r.formatted.transcript+=i,{item:r,delta:{transcript:i}}},"response.audio.delta":t=>{let{item_id:e,content_index:n,delta:i}=t,r=this.itemLookup[e];if(!r)throw new Error(`response.audio.delta: Item "${e}" not found`);let s=zV.base64ToArrayBuffer(i),a=new Int16Array(s);return r.formatted.audio=zV.mergeInt16Arrays(r.formatted.audio,a),{item:r,delta:{audio:a}}},"response.text.delta":t=>{let{item_id:e,content_index:n,delta:i}=t,r=this.itemLookup[e];if(!r)throw new Error(`response.text.delta: Item "${e}" not found`);return r.content[n].text+=i,r.formatted.text+=i,{item:r,delta:{text:i}}},"response.function_call_arguments.delta":t=>{let{item_id:e,delta:n}=t,i=this.itemLookup[e];if(!i)throw new Error(`response.function_call_arguments.delta: Item "${e}" not found`);return i.arguments+=n,i.formatted.tool.arguments+=n,{item:i,delta:{arguments:n}}}}),this.clear()}clear(){return this.itemLookup={},this.items=[],this.responseLookup={},this.responses=[],this.queuedSpeechItems={},this.queuedTranscriptItems={},this.queuedInputAudio=null,!0}queueInputAudio(t){return this.queuedInputAudio=t,t}processEvent(t,...e){if(!t.event_id)throw console.error(t),new Error('Missing "event_id" on event');if(!t.type)throw console.error(t),new Error('Missing "type" on event');let n=this.EventProcessors[t.type];if(!n)throw new Error(`Missing conversation event processor for "${t.type}"`);return n.call(this,t,...e)}getItem(t){return this.itemLookup[t]||null}getItems(){return this.items.slice()}},FV=class extends UV{constructor({url:t,apiKey:e,dangerouslyAllowAPIKeyInBrowser:n,debug:i}={}){super(),this.defaultSessionConfig={modalities:["text","audio"],instructions:"",voice:"alloy",input_audio_format:"pcm16",output_audio_format:"pcm16",input_audio_transcription:null,turn_detection:null,tools:[],tool_choice:"auto",temperature:.8,max_response_output_tokens:4096},this.sessionConfig={},this.transcriptionModels=[{model:"whisper-1"}],this.defaultServerVadConfig={type:"server_vad",threshold:.5,prefix_padding_ms:300,silence_duration_ms:200},this.realtime=new kV({url:t,apiKey:e,dangerouslyAllowAPIKeyInBrowser:n,debug:i}),this.conversation=new BV,this._resetConfig(),this._addAPIEventHandlers()}_resetConfig(){return this.sessionCreated=!1,this.tools={},this.sessionConfig=JSON.parse(JSON.stringify(this.defaultSessionConfig)),this.inputAudioBuffer=new Int16Array(0),!0}_addAPIEventHandlers(){this.realtime.on("client.*",(t=>{let e={time:(new Date).toISOString(),source:"client",event:t};this.dispatch("realtime.event",e)})),this.realtime.on("server.*",(t=>{let e={time:(new Date).toISOString(),source:"server",event:t};this.dispatch("realtime.event",e)})),this.realtime.on("server.session.created",(()=>this.sessionCreated=!0));let t=(t,...e)=>{let{item:n,delta:i}=this.conversation.processEvent(t,...e);return{item:n,delta:i}},e=(e,...n)=>{let{item:i,delta:r}=t(e,...n);return i&&this.dispatch("conversation.updated",{item:i,delta:r}),{item:i,delta:r}},n=async t=>{try{let e=JSON.parse(t.arguments),n=this.tools[t.name];if(!n)throw new Error(`Tool "${t.name}" has not been added`);let i=await n.handler(e);this.realtime.send("conversation.item.create",{item:{type:"function_call_output",call_id:t.call_id,output:JSON.stringify(i)}})}catch(e){this.realtime.send("conversation.item.create",{item:{type:"function_call_output",call_id:t.call_id,output:JSON.stringify({error:e.message})}})}this.createResponse()};return this.realtime.on("server.response.created",t),this.realtime.on("server.response.output_item.added",t),this.realtime.on("server.response.content_part.added",t),this.realtime.on("server.input_audio_buffer.speech_started",(e=>{t(e),this.dispatch("conversation.interrupted")})),this.realtime.on("server.input_audio_buffer.speech_stopped",(e=>t(e,this.inputAudioBuffer))),this.realtime.on("server.conversation.item.created",(t=>{let{item:n}=e(t);this.dispatch("conversation.item.appended",{item:n}),"completed"===n.status&&this.dispatch("conversation.item.completed",{item:n})})),this.realtime.on("server.conversation.item.truncated",e),this.realtime.on("server.conversation.item.deleted",e),this.realtime.on("server.conversation.item.input_audio_transcription.completed",e),this.realtime.on("server.response.audio_transcript.delta",e),this.realtime.on("server.response.audio.delta",e),this.realtime.on("server.response.text.delta",e),this.realtime.on("server.response.function_call_arguments.delta",e),this.realtime.on("server.response.output_item.done",(async t=>{let{item:i}=e(t);"completed"===i.status&&this.dispatch("conversation.item.completed",{item:i}),i.formatted.tool&&n(i.formatted.tool)})),!0}isConnected(){return this.realtime.isConnected()}reset(){return this.disconnect(),this.clearEventHandlers(),this.realtime.clearEventHandlers(),this._resetConfig(),this._addAPIEventHandlers(),!0}async connect(){if(this.isConnected())throw new Error("Already connected, use .disconnect() first");return await this.realtime.connect(),this.updateSession(),!0}async waitForSessionCreated(){if(!this.isConnected())throw new Error("Not connected, use .connect() first");for(;!this.sessionCreated;)await new Promise((t=>setTimeout((()=>t()),1)));return!0}disconnect(){this.sessionCreated=!1,this.realtime.isConnected()&&this.realtime.disconnect(),this.conversation.clear()}getTurnDetectionType(){return this.sessionConfig.turn_detection?.type||null}addTool(t,e){if(!t?.name)throw new Error("Missing tool name in definition");let n=t?.name;if(this.tools[n])throw new Error(`Tool "${n}" already added. Please use .removeTool("${n}") before trying to add again.`);if("function"!=typeof e)throw new Error(`Tool "${n}" handler must be a function`);return this.tools[n]={definition:t,handler:e},this.updateSession(),this.tools[n]}removeTool(t){if(!this.tools[t])throw new Error(`Tool "${t}" does not exist, can not be removed.`);return delete this.tools[t],!0}deleteItem(t){return this.realtime.send("conversation.item.delete",{item_id:t}),!0}updateSession({modalities:t,instructions:e,voice:n,input_audio_format:i,output_audio_format:r,input_audio_transcription:s,turn_detection:a,tools:o,tool_choice:l,temperature:c,max_response_output_tokens:h}={}){void 0!==t&&(this.sessionConfig.modalities=t),void 0!==e&&(this.sessionConfig.instructions=e),void 0!==n&&(this.sessionConfig.voice=n),void 0!==i&&(this.sessionConfig.input_audio_format=i),void 0!==r&&(this.sessionConfig.output_audio_format=r),void 0!==s&&(this.sessionConfig.input_audio_transcription=s),void 0!==a&&(this.sessionConfig.turn_detection=a),void 0!==o&&(this.sessionConfig.tools=o),void 0!==l&&(this.sessionConfig.tool_choice=l),void 0!==c&&(this.sessionConfig.temperature=c),void 0!==h&&(this.sessionConfig.max_response_output_tokens=h);let u=[].concat((o||[]).map((t=>{let e={type:"function",...t};if(this.tools[e?.name])throw new Error(`Tool "${e?.name}" has already been defined`);return e})),Object.keys(this.tools).map((t=>({type:"function",...this.tools[t].definition})))),d={...this.sessionConfig};return d.tools=u,this.realtime.isConnected()&&this.realtime.send("session.update",{session:d}),!0}sendUserMessageContent(t=[]){if(t.length){for(let e of t)"input_audio"===e.type&&(e.audio instanceof ArrayBuffer||e.audio instanceof Int16Array)&&(e.audio=zV.arrayBufferToBase64(e.audio));this.realtime.send("conversation.item.create",{item:{type:"message",role:"user",content:t}})}return this.createResponse(),!0}appendInputAudio(t){return t.byteLength>0&&(this.realtime.send("input_audio_buffer.append",{audio:zV.arrayBufferToBase64(t)}),this.inputAudioBuffer=zV.mergeInt16Arrays(this.inputAudioBuffer,t)),!0}createResponse(){return null===this.getTurnDetectionType()&&this.inputAudioBuffer.byteLength>0&&(this.realtime.send("input_audio_buffer.commit"),this.conversation.queueInputAudio(this.inputAudioBuffer),this.inputAudioBuffer=new Int16Array(0)),this.realtime.send("response.create"),!0}cancelResponse(t,e=0){if(!t)return this.realtime.send("response.cancel"),{item:null};if(t){let n=this.conversation.getItem(t);if(!n)throw new Error(`Could not find item "${t}"`);if("message"!==n.type)throw new Error('Can only cancelResponse messages with type "message"');if("assistant"!==n.role)throw new Error('Can only cancelResponse messages with role "assistant"');this.realtime.send("response.cancel");let i=n.content.findIndex((t=>"audio"===t.type));if(-1===i)throw new Error("Could not find audio on item to cancel");return this.realtime.send("conversation.item.truncate",{item_id:t,content_index:i,audio_end_ms:Math.floor(e/this.conversation.defaultFrequency*1e3)}),{item:n}}}async waitForNextItem(){let t=await this.waitForNext("conversation.item.appended"),{item:e}=t;return{item:e}}async waitForNextCompletedItem(){let t=await this.waitForNext("conversation.item.completed"),{item:e}=t;return{item:e}}},VV=new Blob(["\nclass AudioProcessor extends AudioWorkletProcessor {\n\n  constructor() {\n    super();\n    this.port.onmessage = this.receive.bind(this);\n    this.initialize();\n  }\n\n  initialize() {\n    this.foundAudio = false;\n    this.recording = false;\n    this.chunks = [];\n  }\n\n  /**\n   * Concatenates sampled chunks into channels\n   * Format is chunk[Left[], Right[]]\n   */\n  readChannelData(chunks, channel = -1, maxChannels = 9) {\n    let channelLimit;\n    if (channel !== -1) {\n      if (chunks[0] && chunks[0].length - 1 < channel) {\n        throw new Error(\n          `Channel ${channel} out of range: max ${chunks[0].length}`\n        );\n      }\n      channelLimit = channel + 1;\n    } else {\n      channel = 0;\n      channelLimit = Math.min(chunks[0] ? chunks[0].length : 1, maxChannels);\n    }\n    const channels = [];\n    for (let n = channel; n < channelLimit; n++) {\n      const length = chunks.reduce((sum, chunk) => {\n        return sum + chunk[n].length;\n      }, 0);\n      const buffers = chunks.map((chunk) => chunk[n]);\n      const result = new Float32Array(length);\n      let offset = 0;\n      for (let i = 0; i < buffers.length; i++) {\n        result.set(buffers[i], offset);\n        offset += buffers[i].length;\n      }\n      channels[n] = result;\n    }\n    return channels;\n  }\n\n  /**\n   * Combines parallel audio data into correct format,\n   * channels[Left[], Right[]] to float32Array[LRLRLRLR...]\n   */\n  formatAudioData(channels) {\n    if (channels.length === 1) {\n      // Simple case is only one channel\n      const float32Array = channels[0].slice();\n      const meanValues = channels[0].slice();\n      return { float32Array, meanValues };\n    } else {\n      const float32Array = new Float32Array(\n        channels[0].length * channels.length\n      );\n      const meanValues = new Float32Array(channels[0].length);\n      for (let i = 0; i < channels[0].length; i++) {\n        const offset = i * channels.length;\n        let meanValue = 0;\n        for (let n = 0; n < channels.length; n++) {\n          float32Array[offset + n] = channels[n][i];\n          meanValue += channels[n][i];\n        }\n        meanValues[i] = meanValue / channels.length;\n      }\n      return { float32Array, meanValues };\n    }\n  }\n\n  /**\n   * Converts 32-bit float data to 16-bit integers\n   */\n  floatTo16BitPCM(float32Array) {\n    const buffer = new ArrayBuffer(float32Array.length * 2);\n    const view = new DataView(buffer);\n    let offset = 0;\n    for (let i = 0; i < float32Array.length; i++, offset += 2) {\n      let s = Math.max(-1, Math.min(1, float32Array[i]));\n      view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);\n    }\n    return buffer;\n  }\n\n  /**\n   * Retrieves the most recent amplitude values from the audio stream\n   * @param {number} channel\n   */\n  getValues(channel = -1) {\n    const channels = this.readChannelData(this.chunks, channel);\n    const { meanValues } = this.formatAudioData(channels);\n    return { meanValues, channels };\n  }\n\n  /**\n   * Exports chunks as an audio/wav file\n   */\n  export() {\n    const channels = this.readChannelData(this.chunks);\n    const { float32Array, meanValues } = this.formatAudioData(channels);\n    const audioData = this.floatTo16BitPCM(float32Array);\n    return {\n      meanValues: meanValues,\n      audio: {\n        bitsPerSample: 16,\n        channels: channels,\n        data: audioData,\n      },\n    };\n  }\n\n  receive(e) {\n    const { event, id } = e.data;\n    let receiptData = {};\n    switch (event) {\n      case 'start':\n        this.recording = true;\n        break;\n      case 'stop':\n        this.recording = false;\n        break;\n      case 'clear':\n        this.initialize();\n        break;\n      case 'export':\n        receiptData = this.export();\n        break;\n      case 'read':\n        receiptData = this.getValues();\n        break;\n      default:\n        break;\n    }\n    // Always send back receipt\n    this.port.postMessage({ event: 'receipt', id, data: receiptData });\n  }\n\n  sendChunk(chunk) {\n    const channels = this.readChannelData([chunk]);\n    const { float32Array, meanValues } = this.formatAudioData(channels);\n    const rawAudioData = this.floatTo16BitPCM(float32Array);\n    const monoAudioData = this.floatTo16BitPCM(meanValues);\n    this.port.postMessage({\n      event: 'chunk',\n      data: {\n        mono: monoAudioData,\n        raw: rawAudioData,\n      },\n    });\n  }\n\n  process(inputList, outputList, parameters) {\n    // Copy input to output (e.g. speakers)\n    // Note that this creates choppy sounds with Mac products\n    const sourceLimit = Math.min(inputList.length, outputList.length);\n    for (let inputNum = 0; inputNum < sourceLimit; inputNum++) {\n      const input = inputList[inputNum];\n      const output = outputList[inputNum];\n      const channelCount = Math.min(input.length, output.length);\n      for (let channelNum = 0; channelNum < channelCount; channelNum++) {\n        input[channelNum].forEach((sample, i) => {\n          output[channelNum][i] = sample;\n        });\n      }\n    }\n    const inputs = inputList[0];\n    // There's latency at the beginning of a stream before recording starts\n    // Make sure we actually receive audio data before we start storing chunks\n    let sliceIndex = 0;\n    if (!this.foundAudio) {\n      for (const channel of inputs) {\n        sliceIndex = 0; // reset for each channel\n        if (this.foundAudio) {\n          break;\n        }\n        if (channel) {\n          for (const value of channel) {\n            if (value !== 0) {\n              // find only one non-zero entry in any channel\n              this.foundAudio = true;\n              break;\n            } else {\n              sliceIndex++;\n            }\n          }\n        }\n      }\n    }\n    if (inputs && inputs[0] && this.foundAudio && this.recording) {\n      // We need to copy the TypedArray, because the `process`\n      // internals will reuse the same buffer to hold each input\n      const chunk = inputs.map((input) => input.slice(sliceIndex));\n      this.chunks.push(chunk);\n      this.sendChunk(chunk);\n    }\n    return true;\n  }\n}\n\nregisterProcessor('audio_processor', AudioProcessor);\n"],{type:"application/javascript"}),jV=URL.createObjectURL(VV),HV=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],GV=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],WV=[],qV=[];for(let Xq=1;Xq<=8;Xq++)for(let $q=0;$q<HV.length;$q++){let Yq=HV[$q];WV.push(Yq/Math.pow(2,8-Xq)),qV.push(GV[$q]+Xq)}var XV=[32,2e3],$V=WV.filter(((t,e)=>WV[e]>XV[0]&&WV[e]<XV[1])),YV=qV.filter(((t,e)=>WV[e]>XV[0]&&WV[e]<XV[1])),ZV=class{static getFrequencies(t,e,n,i="frequency",r=-100,s=-30){n||(n=new Float32Array(t.frequencyBinCount),t.getFloatFrequencyData(n));let a,o,l,c=e/2,h=1/n.length*c;if("music"===i||"voice"===i){let t="voice"===i?$V:WV,e=Array(t.length).fill(r);for(let i=0;i<n.length;i++){let r=i*h,s=n[i];for(let n=t.length-1;n>=0;n--)if(r>t[n]){e[n]=Math.max(e[n],s);break}}a=e,o="voice"===i?$V:WV,l="voice"===i?YV:qV}else a=Array.from(n),o=a.map(((t,e)=>h*e)),l=o.map((t=>`${t.toFixed(2)} Hz`));let u=a.map((t=>Math.max(0,Math.min((t-r)/(s-r),1))));return{values:new Float32Array(u),frequencies:o,labels:l}}constructor(t,e=null){if(this.fftResults=[],e){let{length:n,sampleRate:i}=e,r=new OfflineAudioContext({length:n,sampleRate:i}),s=r.createBufferSource();s.buffer=e;let a=r.createAnalyser();a.fftSize=8192,a.smoothingTimeConstant=.1,s.connect(a);let o=1/60,l=n/i,c=t=>{let e=o*t;e<l&&r.suspend(e).then((()=>{let e=new Float32Array(a.frequencyBinCount);a.getFloatFrequencyData(e),this.fftResults.push(e),c(t+1)})),1===t?r.startRendering():r.resume()};s.start(0),c(1),this.audio=t,this.context=r,this.analyser=a,this.sampleRate=i,this.audioBuffer=e}else{let e=new AudioContext,n=e.createMediaElementSource(t),i=e.createAnalyser();i.fftSize=8192,i.smoothingTimeConstant=.1,n.connect(i),i.connect(e.destination),this.audio=t,this.context=e,this.analyser=i,this.sampleRate=this.context.sampleRate,this.audioBuffer=null}}getFrequencies(t="frequency",e=-100,n=-30){let i=null;if(this.audioBuffer&&this.fftResults.length){let t=this.audio.currentTime/this.audio.duration,e=Math.min(t*this.fftResults.length|0,this.fftResults.length-1);i=this.fftResults[e]}return ZV.getFrequencies(this.analyser,this.sampleRate,i,t,e,n)}async resumeIfSuspended(){return"suspended"===this.context.state&&await this.context.resume(),!0}},KV=class{static floatTo16BitPCM(t){let e=new ArrayBuffer(2*t.length),n=new DataView(e),i=0;for(let e=0;e<t.length;e++,i+=2){let r=Math.max(-1,Math.min(1,t[e]));n.setInt16(i,r<0?32768*r:32767*r,!0)}return e}static mergeBuffers(t,e){let n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n.buffer}_packData(t,e){return[new Uint8Array([e,e>>8]),new Uint8Array([e,e>>8,e>>16,e>>24])][t]}pack(t,e){if(!e?.bitsPerSample)throw new Error('Missing "bitsPerSample"');if(!e?.channels)throw new Error('Missing "channels"');if(!e?.data)throw new Error('Missing "data"');let{bitsPerSample:n,channels:i,data:r}=e,s=["RIFF",this._packData(1,52),"WAVE","fmt ",this._packData(1,16),this._packData(0,1),this._packData(0,i.length),this._packData(1,t),this._packData(1,t*i.length*n/8),this._packData(0,i.length*n/8),this._packData(0,n),"data",this._packData(1,i[0].length*i.length*n/8),r],a=new Blob(s,{type:"audio/mpeg"});return{blob:a,url:URL.createObjectURL(a),channelCount:i.length,sampleRate:t,duration:r.byteLength/(i.length*t*2)}}},JV=class{constructor({sampleRate:t=44100,outputToSpeakers:e=!1,debug:n=!1}={}){this.scriptSrc=jV,this.sampleRate=t,this.outputToSpeakers=e,this.debug=!!n,this._deviceChangeCallback=null,this._devices=[],this.stream=null,this.processor=null,this.source=null,this.node=null,this.recording=!1,this._lastEventId=0,this.eventReceipts={},this.eventTimeout=5e3,this._chunkProcessor=()=>{},this._chunkProcessorSize=void 0,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)}}static async decode(t,e=44100,n=-1){let i,r,s=new AudioContext({sampleRate:e});if(t instanceof Blob){if(-1!==n)throw new Error('Can not specify "fromSampleRate" when reading from Blob');r=t,i=await r.arrayBuffer()}else if(t instanceof ArrayBuffer){if(-1!==n)throw new Error('Can not specify "fromSampleRate" when reading from ArrayBuffer');i=t,r=new Blob([i],{type:"audio/wav"})}else{let e,s;if(t instanceof Int16Array){s=t,e=new Float32Array(t.length);for(let n=0;n<t.length;n++)e[n]=t[n]/32768}else if(t instanceof Float32Array)e=t;else{if(!(t instanceof Array))throw new Error('"audioData" must be one of: Blob, Float32Arrray, Int16Array, ArrayBuffer, Array<number>');e=new Float32Array(t)}if(-1===n)throw new Error('Must specify "fromSampleRate" when reading from Float32Array, In16Array or Array');if(n<3e3)throw new Error('Minimum "fromSampleRate" is 3000 (3kHz)');s||(s=KV.floatTo16BitPCM(e));let a={bitsPerSample:16,channels:[e],data:s};r=(new KV).pack(n,a).blob,i=await r.arrayBuffer()}let a=await s.decodeAudioData(i),o=a.getChannelData(0);return{blob:r,url:URL.createObjectURL(r),values:o,audioBuffer:a}}log(){return this.debug&&this.log(...arguments),!0}getSampleRate(){return this.sampleRate}getStatus(){return this.processor?this.recording?"recording":"paused":"ended"}async _event(t,e={},n=null){if(!(n=n||this.processor))throw new Error("Can not send events without recording first");let i={event:t,id:this._lastEventId++,data:e};n.port.postMessage(i);let r=(new Date).valueOf();for(;!this.eventReceipts[i.id];){if((new Date).valueOf()-r>this.eventTimeout)throw new Error(`Timeout waiting for "${t}" event`);await new Promise((t=>setTimeout((()=>t(!0)),1)))}let s=this.eventReceipts[i.id];return delete this.eventReceipts[i.id],s}listenForDeviceChange(t){if(null===t&&this._deviceChangeCallback)navigator.mediaDevices.removeEventListener("devicechange",this._deviceChangeCallback),this._deviceChangeCallback=null;else if(null!==t){let e=0,n=[],i=t=>t.map((t=>t.deviceId)).sort().join(","),r=async()=>{let r=++e,s=await this.listDevices();r===e&&i(n)!==i(s)&&(n=s,t(s.slice()))};navigator.mediaDevices.addEventListener("devicechange",r),r(),this._deviceChangeCallback=r}return!0}async requestPermission(){let t=await navigator.permissions.query({name:"microphone"});if("denied"===t.state)window.alert("You must grant microphone access to use this feature.");else if("prompt"===t.state)try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach((t=>t.stop()))}catch{window.alert("You must grant microphone access to use this feature.")}return!0}async listDevices(){if(!navigator.mediaDevices||!("enumerateDevices"in navigator.mediaDevices))throw new Error("Could not request user devices");await this.requestPermission();let t=(await navigator.mediaDevices.enumerateDevices()).filter((t=>"audioinput"===t.kind)),e=t.findIndex((t=>"default"===t.deviceId)),n=[];if(-1!==e){let i=t.splice(e,1)[0],r=t.findIndex((t=>t.groupId===i.groupId));-1!==r&&(i=t.splice(r,1)[0]),i.default=!0,n.push(i)}return n.concat(t)}async begin(t){if(this.processor)throw new Error("Already connected: please call .end() to start a new session");if(!navigator.mediaDevices||!("getUserMedia"in navigator.mediaDevices))throw new Error("Could not request user media");try{let e={audio:!0};t&&(e.audio={deviceId:{exact:t}}),this.stream=await navigator.mediaDevices.getUserMedia(e)}catch{throw new Error("Could not start media stream")}let e=new AudioContext({sampleRate:this.sampleRate}),n=e.createMediaStreamSource(this.stream);try{await e.audioWorklet.addModule(this.scriptSrc)}catch(t){throw console.error(t),new Error(`Could not add audioWorklet module: ${this.scriptSrc}`)}let i=new AudioWorkletNode(e,"audio_processor");i.port.onmessage=t=>{let{event:e,id:n,data:i}=t.data;if("receipt"===e)this.eventReceipts[n]=i;else if("chunk"===e)if(this._chunkProcessorSize){let t=this._chunkProcessorBuffer;this._chunkProcessorBuffer={raw:KV.mergeBuffers(t.raw,i.raw),mono:KV.mergeBuffers(t.mono,i.mono)},this._chunkProcessorBuffer.mono.byteLength>=this._chunkProcessorSize&&(this._chunkProcessor(this._chunkProcessorBuffer),this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)})}else this._chunkProcessor(i)};let r=n.connect(i),s=e.createAnalyser();return s.fftSize=8192,s.smoothingTimeConstant=.1,r.connect(s),this.outputToSpeakers&&(console.warn("Warning: Output to speakers may affect sound quality,\nespecially due to system audio feedback preventative measures.\nuse only for debugging"),s.connect(e.destination)),this.source=n,this.node=r,this.analyser=s,this.processor=i,!0}getFrequencies(t="frequency",e=-100,n=-30){if(!this.processor)throw new Error("Session ended: please call .begin() first");return ZV.getFrequencies(this.analyser,this.sampleRate,null,t,e,n)}async pause(){if(!this.processor)throw new Error("Session ended: please call .begin() first");if(!this.recording)throw new Error("Already paused: please call .record() first");return this._chunkProcessorBuffer.raw.byteLength&&this._chunkProcessor(this._chunkProcessorBuffer),this.log("Pausing ..."),await this._event("stop"),this.recording=!1,!0}async record(t=(()=>{}),e=8192){if(!this.processor)throw new Error("Session ended: please call .begin() first");if(this.recording)throw new Error("Already recording: please call .pause() first");if("function"!=typeof t)throw new Error("chunkProcessor must be a function");return this._chunkProcessor=t,this._chunkProcessorSize=e,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)},this.log("Recording ..."),await this._event("start"),this.recording=!0,!0}async clear(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return await this._event("clear"),!0}async read(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return this.log("Reading ..."),await this._event("read")}async save(t=!1){if(!this.processor)throw new Error("Session ended: please call .begin() first");if(!t&&this.recording)throw new Error("Currently recording: please call .pause() first, or call .save(true) to force");this.log("Exporting ...");let e=await this._event("export");return(new KV).pack(this.sampleRate,e.audio)}async end(){if(!this.processor)throw new Error("Session ended: please call .begin() first");let t=this.processor;this.log("Stopping ..."),await this._event("stop"),this.recording=!1,this.stream.getTracks().forEach((t=>t.stop())),this.log("Exporting ...");let e=await this._event("export",{},t);return this.processor.disconnect(),this.source.disconnect(),this.node.disconnect(),this.analyser.disconnect(),this.stream=null,this.processor=null,this.source=null,this.node=null,(new KV).pack(this.sampleRate,e.audio)}async quit(){return this.listenForDeviceChange(null),this.processor&&await this.end(),!0}},QV=new Blob(["\nclass StreamProcessor extends AudioWorkletProcessor {\n  constructor() {\n    super();\n    this.hasStarted = false;\n    this.hasInterrupted = false;\n    this.outputBuffers = [];\n    this.bufferLength = 128;\n    this.write = { buffer: new Float32Array(this.bufferLength), trackId: null };\n    this.writeOffset = 0;\n    this.trackSampleOffsets = {};\n    this.port.onmessage = (event) => {\n      if (event.data) {\n        const payload = event.data;\n        if (payload.event === 'write') {\n          const int16Array = payload.buffer;\n          const float32Array = new Float32Array(int16Array.length);\n          for (let i = 0; i < int16Array.length; i++) {\n            float32Array[i] = int16Array[i] / 0x8000; // Convert Int16 to Float32\n          }\n          this.writeData(float32Array, payload.trackId);\n        } else if (\n          payload.event === 'offset' ||\n          payload.event === 'interrupt'\n        ) {\n          const requestId = payload.requestId;\n          const trackId = this.write.trackId;\n          const offset = this.trackSampleOffsets[trackId] || 0;\n          this.port.postMessage({\n            event: 'offset',\n            requestId,\n            trackId,\n            offset,\n          });\n          if (payload.event === 'interrupt') {\n            this.hasInterrupted = true;\n          }\n        } else {\n          throw new Error(`Unhandled event \"${payload.event}\"`);\n        }\n      }\n    };\n  }\n\n  writeData(float32Array, trackId = null) {\n    let { buffer } = this.write;\n    let offset = this.writeOffset;\n    for (let i = 0; i < float32Array.length; i++) {\n      buffer[offset++] = float32Array[i];\n      if (offset >= buffer.length) {\n        this.outputBuffers.push(this.write);\n        this.write = { buffer: new Float32Array(this.bufferLength), trackId };\n        buffer = this.write.buffer;\n        offset = 0;\n      }\n    }\n    this.writeOffset = offset;\n    return true;\n  }\n\n  process(inputs, outputs, parameters) {\n    const output = outputs[0];\n    const outputChannelData = output[0];\n    const outputBuffers = this.outputBuffers;\n    if (this.hasInterrupted) {\n      this.port.postMessage({ event: 'stop' });\n      return false;\n    } else if (outputBuffers.length) {\n      this.hasStarted = true;\n      const { buffer, trackId } = outputBuffers.shift();\n      for (let i = 0; i < outputChannelData.length; i++) {\n        outputChannelData[i] = buffer[i] || 0;\n      }\n      if (trackId) {\n        this.trackSampleOffsets[trackId] =\n          this.trackSampleOffsets[trackId] || 0;\n        this.trackSampleOffsets[trackId] += buffer.length;\n      }\n      return true;\n    } else if (this.hasStarted) {\n      this.port.postMessage({ event: 'stop' });\n      return false;\n    } else {\n      return true;\n    }\n  }\n}\n\nregisterProcessor('stream_processor', StreamProcessor);\n"],{type:"application/javascript"}),tj=URL.createObjectURL(QV),ej=class{constructor({sampleRate:t=44100}={}){this.scriptSrc=tj,this.sampleRate=t,this.context=null,this.stream=null,this.analyser=null,this.trackSampleOffsets={},this.interruptedTrackIds={}}async connect(){this.context=new AudioContext({sampleRate:this.sampleRate}),"suspended"===this.context.state&&await this.context.resume();try{await this.context.audioWorklet.addModule(this.scriptSrc)}catch(t){throw console.error(t),new Error(`Could not add audioWorklet module: ${this.scriptSrc}`)}let t=this.context.createAnalyser();return t.fftSize=8192,t.smoothingTimeConstant=.1,this.analyser=t,!0}getFrequencies(t="frequency",e=-100,n=-30){if(!this.analyser)throw new Error("Not connected, please call .connect() first");return ZV.getFrequencies(this.analyser,this.sampleRate,null,t,e,n)}_start(){let t=new AudioWorkletNode(this.context,"stream_processor");return t.connect(this.context.destination),t.port.onmessage=e=>{let{event:n}=e.data;if("stop"===n)t.disconnect(),this.stream=null;else if("offset"===n){let{requestId:t,trackId:n,offset:i}=e.data,r=i/this.sampleRate;this.trackSampleOffsets[t]={trackId:n,offset:i,currentTime:r}}},this.analyser.disconnect(),t.connect(this.analyser),this.stream=t,!0}add16BitPCM(t,e="default"){if("string"!=typeof e)throw new Error("trackId must be a string");if(this.interruptedTrackIds[e])return;let n;if(this.stream||this._start(),t instanceof Int16Array)n=t;else{if(!(t instanceof ArrayBuffer))throw new Error("argument must be Int16Array or ArrayBuffer");n=new Int16Array(t)}return this.stream.port.postMessage({event:"write",buffer:n,trackId:e}),n}async getTrackSampleOffset(t=!1){if(!this.stream)return null;let e,n=crypto.randomUUID();for(this.stream.port.postMessage({event:t?"interrupt":"offset",requestId:n});!e;)e=this.trackSampleOffsets[n],await new Promise((t=>setTimeout((()=>t()),1)));let{trackId:i}=e;return t&&i&&(this.interruptedTrackIds[i]=!0),e}async interrupt(){return this.getTrackSampleOffset(!0)}},nj=class{constructor(t,e,n){this.data=t,this.id=e,this.shared=n,this.items=[],this.isConnected=!1,this.rafId=0,this.emitter=XU(),this.voice=0,this.frequencies=new Float32Array([0]),this.onRealTimeEvent=({time:t,source:e,event:n})=>{"server"===e&&"spline.ready"===n.type?this.onSessionCreated(n):"server"===e&&"session.created"===n.type&&(this.client.createResponse(),this.client.on("realtime.event",this.onRealTimeEvent))},this.onSessionCreated=async t=>{let e=Object.values(this.client.tools).map((t=>({type:"function",...t.definition})));this.client.realtime.send("spline.tools",{tools:e}),this.client.realtime.send("spline.connect",{}),await this.wavRecorder.record((t=>this.client.isConnected()&&this.client.appendInputAudio(t.mono)))},this.animate=()=>{if(this.rafId=requestAnimationFrame(this.animate),this.isConnected){let t=this.wavStreamPlayer.analyser?this.wavStreamPlayer.getFrequencies("voice"):{values:new Float32Array([0])},e=t.values.reduce(((t,e)=>t+e),0)/t.values.length;this.voice=e,this.frequencies=t.values,this.emitter.emit("voice",{value:e,frequencies:t.values})}},this.client=new FV({url:"https://relayserver.spline.design/?uuidfile="+t.integration.hash}),this.wavRecorder=new JV({sampleRate:24e3}),this.wavStreamPlayer=new ej({sampleRate:24e3})}update(t){this.data=t,this.client=new FV({url:"https://relayserver.spline.design/?uuidfile="+t.integration.hash})}setColorByName(t,e){let n=this.shared.getColorByName(t);if(n){let{id:t}=n,{r:i,g:r,b:s}=qU.hexStringToRgb(e)??{r:0,g:0,b:0};this.shared.updateColor(t,{r:i/255,g:r/255,b:s/255})}}connect(){if(this.isConnected)return;this.isConnected=!0,this.client.updateSession({turn_detection:{type:"server_vad"}}),this.client.addTool({name:"set_personality_color",description:"returns a color based on the voice personality of the ai assistant. This should be called by the voice assistant each time it is asks to speak differently. If a color cannot be associated to the personality, the color should be a neutral color.",parameters:{type:"object",properties:{color:{type:"string",description:"css hex color string, reflecting the personality"},personality:{type:"string",description:"the personality of the voice assistant"}},required:["color","personality"]}},(({color:t})=>{this.setColorByName("Voice Assistant Color",t)}));let t=this.shared.getVariablesNames().join(", ");this.client.addTool({name:"set_variable",description:"Sets a Spline variable value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the variable that needs to be set. Here's a list of available variables: ${t}. It the variable does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"The new value for this variable, should always be a string even for number and boolean variables, assume that the value will be cast to the proper type afterwards."}},required:["name","value","type"]}},(({name:t,value:e})=>{let n=this.shared.getVariableByName(t);if(n){let t,i=this.shared.getVariable(n.id);t="number"==typeof i?parseFloat(e):"boolean"==typeof i?"true"===e.toLowerCase():{textValue:e},this.shared.updateVariable(n.id,t)}}));let e=this.shared.getColorNames().join(", ");this.client.addTool({name:"set_color",description:"Sets a Spline color asset value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the color asset that needs to be set. Here's a list of available color assets: ${e}. It the color asset does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"css hex color string"}},required:["name","value"]}},(({name:t,value:e})=>{this.setColorByName(t,e)}));let n=this.shared.scene,i=[];n.traverseEntity((t=>{t.data.events.forEach((t=>{if("AIAssistantTrigger"===t.data.type){let{description:e}=t.data;i.push(e)}}))})),this.client.addTool({name:"trigger_event",description:"Trigger an event by name, here are the available events, please match what the user is asking for to one of these if it applies, otherwise don't call the function and warn the user.",parameters:{type:"object",properties:{description:{type:"string",description:`The name of the event that needs to be triggered. Here's a list of available events: ${JSON.stringify(i)}.`},direction:{type:"string",description:"default is forward, but can be forward or backward. Always set to forward unless the user ask to reverse or cancel the event, then set to backward."}},required:["description","direction"]}},(({description:t,direction:e})=>{this.emitter.emit("trigger_event",{description:t,direction:e})})),this.client.on("error",(t=>console.error(t))),this.client.on("conversation.interrupted",(async()=>{let t=await this.wavStreamPlayer.interrupt();if(t?.trackId){let{trackId:e,offset:n}=t;await this.client.cancelResponse(e,n)}})),this.client.on("conversation.updated",(async({item:t,delta:e})=>{let n=this.client.conversation.getItems();if(e?.audio&&this.wavStreamPlayer.add16BitPCM(e.audio,t.id),"completed"===t.status&&t.formatted.audio?.length){let e=await JV.decode(t.formatted.audio,24e3,24e3);t.formatted.file=e}this.items=n})),this.animate()}disconnect(){cancelAnimationFrame(this.rafId),this.voice=0,this.isConnected=!1}async start(){try{await this.wavRecorder.end()}catch{}await this.wavRecorder.begin(),this.client.on("realtime.event",this.onRealTimeEvent),await this.wavStreamPlayer.connect(),await this.client.connect()}async stop(){try{this.client.off("realtime.event",this.onRealTimeEvent)}catch(t){console.error(t)}this.client.disconnect(),await this.wavRecorder.end(),await this.wavStreamPlayer.interrupt()}computeAnalysisForListenerEvent(t){if("range"===t.analysis){let e=this.frequencies.slice(...t.analysisRange);return e.reduce(((t,e)=>t+e),0)/e.length}return"single"===t.analysis?this.frequencies[t.analysisSingle]:this.voice}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}};function ij(t){return"variable_"+t}var rj=class extends BF{constructor(t){super(),this.shared=t}create(t){return new FF(t,this.shared)}},sj=class{constructor(t,e={},n=!0,i=!1){if(this.data=t,this.needsJitter=n,this.enableLocalStorageForPersistentVariables=i,this.geometryCache=new EV(!0),this.geometryCache2=new EV(!1),this.imageHolderCache=new rj(this),this.thisContext={scene:AV,shared:this},this.deletedMaterial=new lV(uL.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new VF(PI.emptyImage,this),this.deletedVideo=new VF(eL.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},e.images)for(let[t,n]of Object.entries(e.images))this.addImage(t,n);if(e.videos)for(let[t,n]of Object.entries(e.videos))this.addVideo(t,n);if(e.audios)for(let[t,n]of Object.entries(e.audios))this.addAudio(t,n);if(e.particles)for(let[t,n]of Object.entries(e.particles))this.addParticle(t,n);this.reset(t)}setRequestRender(t){this._requestRender=t}getImageLoadPromises(){return Object.values(this.images).map((t=>t.loadPromise))}setEntityOpContext(t){this.entityOpContext=t}reset(t,e=!1){this.data=t,this.resetLib(t.lib);for(let{id:n,data:i}of t.variables)this.addVariableHolder(n,i),e&&this.updateVariableHolder(n,i);for(let[e,n]of Object.entries(t.userAPIs))this.addUserAPI(e,n);for(let[e,n]of Object.entries(t.userWebhooks))this.addUserWebhook(e,n);for(let[e,n]of Object.entries(t.images))this.addImage(e,n);for(let[e,n]of Object.entries(t.videos))this.addVideo(e,n);for(let[e,n]of Object.entries(t.colors))this.addColor(e,n);for(let[e,n]of Object.entries(t.materials))this.addMaterial(e,n);for(let[e,n]of Object.entries(t.audios))this.addAudio(e,n);for(let[e,n]of Object.entries(t.particles))this.addParticle(e,n);for(let[e,n]of Object.entries(t.fonts))this.addFont(e,n)}addMaterial(t,e){if(this.materials[t]){let n=this.materials[t];n.reset(e,this.thisContext),n.dispose()}else{let n=new lV(e,this.thisContext,t);this.materials[t]=n}}deleteMaterial(t){this.materials[t]&&(this.materials[t].nodeMaterialDispose(),delete this.materials[t])}getMaterial(t){return this.materials[t]}getMaterialOrDeletedPlaceholder(t){return this.materials[t]??this.deletedMaterial}material(t){return"string"==typeof t?this.getMaterialOrDeletedPlaceholder(t):null==t?(console.error("material is undefined or null"),this.deletedMaterial):new oV(t,this.thisContext)}getMaterials(){return this.materials}addImage(t,e){return this.images[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[t].updateSrc(e.data),!0):(this.images[t]=new VF(e,this),!1)}deleteImage(t){let e=this.images[t];e&&(e.dispose(),delete this.images[t])}getDefaultImage(){return this.images.image_0}getImage(t){return this.images[t]??this.deletedImage}image(t){return"string"==typeof t?this.getImage(t):this.imageHolderCache.load(t)}addUIBuffer(t,e){return this.uiBuffers[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[t].updateSrc(e),!0):(this.uiBuffers[t]=new VF(e,this),!1)}uiBuffer(t){return this.uiBuffers[t]}addVideo(t,e){return this.videos[t]?(this.videos[t].updateSrc(e.data),!0):(this.videos[t]=new VF(e,this),!1)}deleteVideo(t){let e=this.videos[t];e&&(e.dispose(),delete this.videos[t])}getVideo(t){return this.videos[t]??this.deletedVideo}video(t){return"string"==typeof t?this.getVideo(t):this.imageHolderCache.load(t)}addColor(t,e){return this.colors[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in e?this.colors[t].setRGBA(e.r,e.g,e.b,e.a):this.colors[t].setRGBA(e.r,e.g,e.b,1),!0):(this.colors[t]=new qF(e.r,e.g,e.b,"a"in e?e.a:1),!1)}updateColor(t,e){if(this.colors[t]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let n=this.colors[t];return this.colors[t].r=e.r??n.r,this.colors[t].g=e.g??n.g,this.colors[t].b=e.b??n.b,this.colors[t].a=e.a??n.a,!0}return!1}deleteColor(t){this.colors[t]&&delete this.colors[t]}getColor(t){return this.colors[t]}getColorNames(){return Object.values(this.data.colors).map((t=>t.name))}getColorByName(t){for(let e in this.data.colors)if(this.data.colors[e].name===t)return{color:this.colors[e],id:e}}color(t){let e;if("string"!=typeof t)return new nB(t.r,t.g,t.b,"a"in t?t.a:1);{let n=this.getColor(t);n?e=n:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),e=new nB(0,0,0,0))}return e}addAudio(t,e){this.audios[t]=e}getAudio(t){let e=this.audios[t];if(e instanceof mV)return e;{let n=new mV({src:e.data});return this.audios[t]=n,n}}addParticle(t,e){this.particles[t]=e}getParticle(t){return this.particles[t]}deleteParticle(t){this.particles[t]&&delete this.particles[t]}deleteAudio(t){let e=this.audios[t];e&&(e instanceof mV&&e.dispose(),delete this.audios[t])}addFont(t,e){this.fonts[t]=new MV(e),this.fonts[t].loadingPromise.then((()=>this.requestRender()))}getFont(t){return this.fonts[t]}deleteFont(t){this.fonts[t]&&delete this.fonts[t]}dispose(){Object.keys(this.materials).forEach((t=>this.deleteMaterial(t))),this._requestRender=void 0,Object.values(this.audios).forEach((t=>{t instanceof mV&&t.dispose()})),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(t,e){if(void 0===this.variables[t]){let n=e.value;if(this.enableLocalStorageForPersistentVariables&&e.persistent){let i=localStorage.getItem(ij(t));n=null!==i?JSON.parse(i):e.value}return this.variables[t]={value:n,locations:[],persistent:e.persistent},"dynamicVariableType"in e&&(this.variables[t].dynamicVariablePlayState="Playing",this.variables[t].dynamicVariableToggleIsForward=void 0),!0}return this.variables[t].value=e.value,!1}resetDynamicVariablePlayState(){for(let t in this.variables)void 0!==this.variables[t].dynamicVariablePlayState&&(this.variables[t].dynamicVariablePlayState="Playing",this.variables[t].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(t,e){this.updateVariable(t,e.value)}updateVariable(t,e){if(void 0===this.variables[t])return!1;this.variables[t].value=e,this.enableLocalStorageForPersistentVariables&&this.variables[t].persistent&&localStorage.setItem(ij(t),JSON.stringify(e));let n=e;for(;"string"==typeof n;)n=this.variables[n].value;let i=this.entityOpContext.scene;for(let e=this.variables[t].locations.length-1;e>=0;e--){let r=this.variables[t].locations[e];if("material"===r[0]){let t=r[1],e=n,s={scene:i,shared:this},a=r.slice(2);i.traverseMaterial((n=>{let i=n.root??n;i.uuid===t&&i.onVariableUpdate(a,e,s)}));let o=this.materials[t];o&&o.onVariableUpdate(a,e,s)}else{let s=i.find(r[0]);if(void 0===s){this.variables[t].locations.splice(e,1);continue}if("geometry"!==r[1]&&"particles"!==r[1]){for(let t=1;t<r.length-1;t++)s=s[r[t]];"rotation"===r[1]?s[r[r.length-1]]=n*vm.DEG2RAD:s[r[r.length-1]]=n}if(s=i.find(r[0]),"ParticleEmitter"===s.type&&s.updateVariableState(n,r),fz.is(s))if("position"===r[1]||"rotation"===r[1]||"scale"===r[1])s.onVariableUpdate();else if("geometry"===r[1]){let t=s;s.component&&(t=s.component);let e=t.dataPatched;t.chooseGeoemtryCache(this).forceDelete(e.geometry),t.createGeometryDelayed(this.entityOpContext),t.onVariableUpdate(!0),t.invalidateDownstreamBooleanData(),t.instances.forEach((t=>{let e=t.dataPatched;t.chooseGeoemtryCache(this).forceDelete(e.geometry),t.createGeometryDelayed(this.entityOpContext),t.onVariableUpdate(!0),t.invalidateDownstreamBooleanData()}))}else"morphTargetInfluences"===r[1]&&s.updateMorphInfluences(r[2],n)}}return this.requestRender(),!0}deleteVariable(t){this.variables[t]&&delete this.variables[t]}getVariable(t,e){if(Array.isArray(t)){if("mouse"===t[0])return this.mouseProperty?.[t[1]]??0;if("raycast"===t[0])return this.raycastProperty?.[t[1]]??0;let e=this.entityOpContext.scene.find(t[0]);if("width"===t[1]||"height"===t[1]||"depth"===t[1])return e.geometry.userData.parameters[t[1]];for(let n=1;n<t.length;n++)e=e[t[n]];return"rotation"===t[1]&&(e*=vm.RAD2DEG),e}for(let t in this.variables){if(void 0===e)break;let n=this.variables[t],i=n.locations?.findIndex((t=>jR.equal(t,e)));void 0!==i&&-1!==i&&n.locations.splice(i,1)}if("string"==typeof t){let n=t,i=t;do{if(i=n,void 0===this.variables[n])break;let t=this.variables[n].value;e&&void 0!==this.variables[i]&&this.variables[i].locations.push(e),n=t}while("string"==typeof n);return n}return t}getVariables(){return this.variables}getVariablesNames(){return this.data.variables.map((t=>t.data.name))}getVariableByName(t){for(let e of this.data.variables)if(e.data.name===t)return{variable:e.data,id:e.id}}getDynamicVariablePlayState(t){return this.variables[t]?.dynamicVariablePlayState}setDynamicVariablePlayState(t,e){void 0!==this.variables[t]&&(this.variables[t].dynamicVariablePlayState=e)}getDynamicVariableToggleIsForward(t){return this.variables[t]?.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(t,e){void 0!==this.variables[t]&&(this.variables[t].dynamicVariableToggleIsForward=e)}resetLib(t){for(let[e,n]of Object.entries(t.images))this.addImage(e,n.asset);for(let[e,n]of Object.entries(t.audios))this.addAudio(e,n.asset);for(let[e,n]of Object.entries(t.particles))this.addParticle(e,n.asset);for(let[e,n]of Object.entries(t.colors))this.addColor(e,n.asset);for(let[e,n]of Object.entries(t.fonts))this.addFont(e,n.asset);for(let[e,n]of Object.entries(t.materials))this.addMaterial(e,n.asset);for(let[e,n]of Object.entries(t.videos))this.addVideo(e,n.asset);for(let[e,n]of Object.entries(t.variables))this.addVariableHolder(e,n.asset)}updateLibByOp(t,e){"images"===t.path[0]?1===t.path.length&&1===t.type?this.addImage(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteImage(t.id):"videos"===t.path[0]?1===t.path.length&&1===t.type?this.addVideo(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteVideo(t.id):"audios"===t.path[0]?1===t.path.length&&1===t.type?this.addAudio(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteAudio(t.id):"particles"===t.path[0]?1===t.path.length&&1===t.type?this.addParticle(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteParticle(t.id):"colors"===t.path[0]?1===t.path.length&&1===t.type?this.addColor(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteColor(t.id):"materials"===t.path[0]?1===t.path.length&&1===t.type?this.addMaterial(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteMaterial(t.id):"fonts"===t.path[0]?1===t.path.length&&1===t.type?this.addFont(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteFont(t.id):"variables"===t.path[0]?1===t.path.length&&1===t.type?this.addVariableHolder(t.id,t.data.asset):1===t.path.length&&2===t.type&&this.deleteVariable(t.id):"components"===t.path[0]&&e.updateByLibOp(t,this)}updateByOp(t,e,n){if(this.data=e,"images"===t.path[0])2===t.path.length&&0===t.type?t.props.data&&this.getImage(t.path[1]).updateSrc(t.props.data):1===t.path.length&&1===t.type?this.addImage(t.id,t.data):1===t.path.length&&2===t.type&&this.deleteImage(t.id);else if("videos"===t.path[0])2===t.path.length&&0===t.type?t.props.data&&this.getVideo(t.path[1]).updateSrc(t.props.data):1===t.path.length&&1===t.type?this.addVideo(t.id,t.data):1===t.path.length&&2===t.type&&this.deleteVideo(t.id);else if("audios"===t.path[0])2===t.path.length&&0===t.type?t.props.data&&this.addAudio(t.path[1],e.audios[t.path[1]]):1===t.path.length&&1===t.type?this.addAudio(t.id,t.data):1===t.path.length&&2===t.type&&this.deleteAudio(t.id);else if("particles"===t.path[0])2===t.path.length&&0===t.type?t.props.data&&this.addParticle(t.path[1],e.particles[t.path[1]]):1===t.path.length&&1===t.type?this.addParticle(t.id,t.data):1===t.path.length&&2===t.type&&this.deleteParticle(t.id);else if("colors"===t.path[0])2===t.path.length&&0===t.type?this.updateColor(t.path[1],t.props):1===t.path.length&&1===t.type?this.addColor(t.id,t.data):1===t.path.length&&2===t.type&&this.deleteColor(t.id);else if("materials"===t.path[0])1===t.path.length&&1===t.type?this.addMaterial(t.id,t.data):1===t.path.length&&2===t.type?this.deleteMaterial(t.id):t.path.length>1&&this.getMaterial(t.path[1]).updateByOp(xR.drop(t,2),e.materials[t.path[1]],{shared:this,scene:n});else if("fonts"===t.path[0])2===t.path.length&&0===t.type?this.updateFont(t.path[1],t,n):1===t.path.length&&1===t.type?this.addFont(t.id,t.data):1===t.path.length&&2===t.type&&this.deleteFont(t.id);else if("variables"===t.path[0])2===t.path.length&&0===t.type?"value"in t.props?this.updateVariable(t.path[1],t.props.value):"persistent"in t.props&&(this.variables[t.path[1]].persistent=t.props.persistent):1===t.path.length&&4===t.type?this.addVariableHolder(t.id,t.data):1===t.path.length&&5===t.type&&this.deleteVariable(t.id);else if("userAPIs"===t.path[0]){if(1===t.path.length&&1===t.type)this.addUserAPI(t.id,t.data);else if(1===t.path.length&&2===t.type)this.deleteUserAPI(t.id);else if("string"==typeof t.path[1]){let n=e.userAPIs[t.path[1]];if(n){let e=0===t.type&&void 0===t.props.debounce,i=this.getUserAPI(t.path[1]);i instanceof nj?i.update(n):i?.update(n,this,e)}}}else if("userWebhooks"===t.path[0]){if(1===t.path.length&&1===t.type)this.addUserWebhook(t.id,t.data);else if(1===t.path.length&&2===t.type)this.deleteUserWebhook(t.id);else if("string"==typeof t.path[1]){let n=e.userWebhooks[t.path[1]];n&&this.getUserWebhook(t.path[1])?.update(n)}}else"lib"===t.path[0]&&this.updateLibByOp(xR.drop(t,1),n)}updateFont(t,e,n){if(e.props.url){let i=this.getFont(t),r={...this.data.fonts[t],url:e.props.url};i.update(r),i.loadingPromise.then((()=>this.requestRender())),n.updateFont(t,this)}}addUserAPI(t,e){return this.userAPIs[t]?(this.userAPIs[t].update(e,this),!0):this.openAIRealtime?.id===t?(this.openAIRealtime.update(e),!0):"VoiceAssistant"===e.integration?.type?(this.openAIRealtime=new nj(e,t,this),!1):(this.userAPIs[t]=new $U(t,e,this),!1)}getUserAPI(t){return this.openAIRealtime?.id===t?this.openAIRealtime:this.userAPIs[t]}getUserAPIs(){return this.userAPIs}deleteUserAPI(t){let e=this.userAPIs[t];e&&(e.dispose(),delete this.userAPIs[t])}addUserWebhook(t,e){return this.userWebhooks[t]?(this.userWebhooks[t].update(e),!0):(this.userWebhooks[t]=new DV(t,e),!1)}getUserWebhook(t){return this.userWebhooks[t]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(t){let e=this.userWebhooks[t];e&&(e.dispose(),delete this.userWebhooks[t])}get scene(){return this.entityOpContext.scene}},aj=new sj(aI.emptyData()),oj=class extends Xk{updateByPatchedOp(t,e,n){if(super.updateByPatchedOp(t,e,n),null!==function(t,e){let n=[];if(e.length!==t.length)return null;for(var i=0;i<t.length;){if("*"===e[i])n.push(t[i]);else if(t[i]!==e[i])return null;i+=1}return n}(t.path,["materials"])&&0===t.type&&Array.isArray(this.material))for(let[e,i]of Object.entries(t.props)){let t=n.shared.material(i);this.material[Number(e)]=t}else if($R(t.path,["material"])&&this.material instanceof sV)"material"in e&&"string"!=typeof e.material&&this.material.updateByOp(xR.drop(t,1),e.material,n);else if($R(t.path,["materials","*"])&&Array.isArray(this.material)){let i=t.path[1];if("materials"in e&&i<this.material.length){let r=e.materials[i];"string"!=typeof r&&this.material[i].updateByOp(xR.drop(t,2),r,n)}}}get needsAO(){return void 0!==this.material&&(Array.isArray(this.material)?this.material[0]:this.material).hasAO}updateState(t,e){super.updateState(t,e),void 0!==t.castShadow&&(this.castShadow=t.castShadow),void 0!==t.receiveShadow&&(this.receiveShadow=t.receiveShadow);let n,i=this.dataPatched;if("Mesh"===this.dataPatched.type&&this.dataPatched.geometry.shapeBlendNode&&this.layers.set(9),"Mesh"===this.dataPatched.type&&"ShapeBlendGeometry"===this.dataPatched.geometry.type&&(n={resolutionLevel:this.dataPatched.geometry.resolutionLevel,useChildrenColors:this.dataPatched.geometry.useChildrenColors}),"NonParametricGeometry"!==t.geometry?.type&&"material"in t&&void 0!==t.material&&(this.disposeMaterial(),this.material=e.shared.material(t.material).getFlavor(i.flatShading,i.side,i.wireframe,n),e.scene.markNeedsUpdateRendererDirty()),("NonParametricGeometry"===t.geometry?.type||"materials"in t)&&("materials"in t&&void 0!==t.materials?(this.disposeMaterial(),this.material=t.materials.map((t=>e.shared.material(t).getFlavor(i.flatShading,i.side,i.wireframe))),e.scene.markNeedsUpdateRendererDirty()):"material"in t&&void 0!==t.material&&(this.disposeMaterial(),this.material=[e.shared.material(t.material).getFlavor(i.flatShading,i.side,i.wireframe)],e.scene.markNeedsUpdateRendererDirty())),void 0!==t.flatShading||void 0!==t.wireframe||void 0!==t.side)if(Array.isArray(this.material))for(let t=0;t<this.material.length;t++)this.material[t]=this.material[t].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe,n)}disposeMaterial(){this.material&&nT(this.material).forEach((t=>{t instanceof sV&&(t instanceof lV||t.nodeMaterialDispose())}))}dispose(){this.disposeMaterial(),super.dispose()}},lj=new $m,cj=new jm,hj=new jm,uj=new $m,dj=new Mg,pj=class extends oj{constructor(t,e,n){super(t,e),this.data=e,this.isSkinnedMesh=!1,this.localGeometry=void 0,e.bindMode&&e.bindMatrix&&(this.bindMode=e.bindMode,this.bindMatrix=(new Mg).fromArray(e.bindMatrix),this.bindMatrixInverse=new Mg)}chooseGeoemtryCache(t){return t.geometryCache}markGeometryAsReachable(t){this.geometryCreateDeleyed instanceof Nv&&this.chooseGeoemtryCache(t).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(void 0!==this.localGeometry)return this.localGeometry;if(this.geometryCreateDeleyed instanceof sj){let t=this.geometryCreateDeleyed,e=this.chooseGeoemtryCache(t);this.geometryCreateDeleyed=e.get(this.dataPatched.geometry,t,this)}return this.geometryCreateDeleyed}set geometry(t){this.localGeometry=t}get is2DAndNoDepth(){let t=this.dataPatched.geometry;return yL.is2DParametricMesh(t.type)&&0===t.depth}get is2DType(){return yL.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return"NonParametricGeometry"===this.geometry.userData.type}updateByPatchedOp(t,e,n){super.updateByPatchedOp(t,e,n),$R(t.path,["geometry"])&&this.updateByPatchedOpGeometry(xR.drop(t,1),e.geometry,n)}removeInteractionGeometry(t){this.localGeometry?.dispose(),this.localGeometry=void 0}updateGeometryInteractions(t,e){this.invalidateDownstreamBooleanData();let n=this.data.geometry.type;if("NonParametricGeometry"===n||"SubdivGeometry"===n){let n,i,r,s=t;if(void 0===this.localGeometry){let t={...this.data.geometry,...s};this.localGeometry=hk(t,e,this.data.flatShading,this)}s.scaleBaked?[n,i,r]=s.scaleBaked:({width:n,height:i,depth:r}=s);let a=this.localGeometry.userData;void 0!==a.sxPrev&&dk(this.localGeometry.attributes,n/a.sxPrev,i/a.syPrev,r/a.szPrev),a.sxPrev=n,a.syPrev=i,a.szPrev=r}else{let n={...this.data.geometry,...t};this.localGeometry?.dispose(),this.localGeometry=hk(n,e,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let t of this.attachedSurfaceCloners)t.update()}refreshAttachedCloners(t){for(let e of this.attachedSurfaceCloners)t.scene.addPendingUpdateCloner(e.object)}refreshAttachedPaths(t){for(let e of this.attachedPaths)t.scene.addPendingCommand((()=>e.updateShape()))}createGeometryDelayed(t){this.geometryCreateDeleyed=t.shared,this.refreshAttachedCloners(t),this.refreshAttachedPaths(t)}updateByPatchedOpGeometry(t,e,n){let i=!1;0===t.type&&0===t.path.length&&Object.keys(t.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof xk&&this.chooseGeoemtryCache(n.shared).mutateIfUnique(this.geometryCreateDeleyed.data,e)===this.geometryCreateDeleyed&&(i=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(e,t.props.scaleBaked),this.refreshAttachedCloners(n),this.refreshAttachedPaths(n)),i||(n.scene?.markGeometryCacheDirty(),this.createGeometryDelayed(n)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(t,e){this.createGeometryDelayed(e)}updateState(t,e){void 0!==t.geometry&&this.updateGeometryOnStateUpdate(t.geometry,e);let n=t.morphTargetInfluences;if(n){this.updateMorphTargets(),this.geometry.morphTargetsRelative=!0;for(let{data:{name:t,value:i}}of n)this.updateMorphInfluences(t,e.shared.getVariable(i,[this.uuid,"morphTargetInfluences",t]))}super.updateState(t,e)}updateMorphInfluences(t,e){if(void 0===this.morphTargetDictionary)return;let n=this.morphTargetDictionary[t];void 0!==n&&(this.morphTargetInfluences[n]=e)}updateGeometryGroupsIfNeeded(){Array.isArray(this.material)&&0===this.geometry.groups.length&&this.geometry.addGroup(0,Math.max(this.geometry.getIndex()?.count??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(t,e){let n=this.geometry.userData.parameters;this.is2DType?t.set(0,0,.5*n.depth):this.isNonParametric?(t.setScalar(0),this.geometry.boundingSphere&&t.copy(this.geometry.boundingSphere.center),e.set(n.width,n.height,n.depth??0).multiplyScalar(.5)):n.centerOffset?t.fromArray(n.centerOffset):t.setScalar(0),e.set(n.width,n.height,n.depth??0).multiplyScalar(.5)}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(t,e){this.skeleton=t,this.isSkinnedMesh=!0,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(t){let e=new jm,n=this.geometry.attributes.skinWeight;for(let t=0,i=n.count;t<i;t++){e.fromBufferAttribute(n,t);let i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),n.setXYZW(t,e.x,e.y,e.z,e.w)}}boneTransform(t,e){let n=this.skeleton;if(void 0===n)return;let i=this.geometry;cj.fromBufferAttribute(i.attributes.skinIndex,t),hj.fromBufferAttribute(i.attributes.skinWeight,t),lj.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){let i=hj.getComponent(t);if(0!==i){let r=cj.getComponent(t);dj.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),e.addScaledVector(uj.copy(lj).applyMatrix4(dj),i)}}return e.applyMatrix4(this.bindMatrixInverse)}};function fj(t){if(Array.isArray(t.material)){for(let e of t.material)if(0===e.getLayersOfType("outline").length)return}else if(!(t.material instanceof sV)||0===t.material.getLayersOfType("outline").length)return;t instanceof pj&&t.is2DAndNoDepth?function(t){if(t.geometry.attributes.extrudeNormals||!t.geometry.attributes.position)return;let e=t.geometry.attributes.position.array,n=new Float32Array(e.length),i=new $m;for(let t=0;t<e.length;t+=3)i.set(e[t],e[t+1],e[t+2]).normalize(),n[t]=i.x,n[t+1]=i.y,n[t+2]=i.z;t.geometry.setAttribute("extrudeNormal",new Cv(n,3))}(t):function(t){if(t.geometry.attributes.extrudeNormal||!t.geometry.attributes.position||!t.geometry.attributes.normal)return;let e=new Map,n=t.geometry.attributes,i=n.position.array,r=n.normal.array,s=new Float32Array(i.length);for(let t=0;t<i.length;t+=3){let n=`${i[t]}_${i[t+1]}_${i[t+2]}`,s=new $m(r[t],r[t+1],r[t+2]);e.has(n)?e.get(n)?.normals.push(s):e.set(n,{normals:[s],result:new $m})}e.forEach(((t,e)=>{for(let e of t.normals)t.result.add(e);t.result.divideScalar(t.normals.length)}));for(let t=0;t<i.length;t+=3){let n=`${i[t]}_${i[t+1]}_${i[t+2]}`,r=e.get(n)?.result;r&&(s[t]=r.x,s[t+1]=r.y,s[t+2]=r.z)}t.geometry.setAttribute("extrudeNormal",new Cv(s,3))}(t)}function mj(t){if(!t.geometry.attributes.position)return;let e=t.geometry.attributes.position.array,n=new Float32Array(e.length),i=parseInt(t.uuid.replace(/\D/g,"")),r=[vm.seededRandom(i),vm.seededRandom(i+1e4),vm.seededRandom(i+2e4)];for(let t=0;t<e.length;t++)n[t]=r[t%3];t.geometry.setAttribute("randomColor",new Tv(n,3))}var gj=new Km,vj=new $m;function yj(t){let e=!1;return t.scene.objects.traverse(((t,n)=>{"Mesh"===n.type&&"SubdivGeometry"===n.geometry.type&&(e=!0)})),e}var xj=class extends pj{constructor(t,e,n){super(t,e,n),this.data=e,this.hiddenMatrixOld=new Mg,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(t){return this.dataPatched.flatShading?t.geometryCache:t.geometryCache2}get subdivPointerNew(){return void 0!==this.localGeometry?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return void 0!==this.localGeometry?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(t,e){let n=this.geometry.userData.parameters;t.copy(this.originalGeometryNew.boundingSphere.center),e.set(n.width,n.height,n.depth??0).multiplyScalar(.5)}createGeometryByControls(t){if(!0===this.skipReactionUpdate)return;let e=this.localGeometry?.uuid,{originalGeometry:n,subdividedGeometry:i,subdivPointer:r}=xk.build(t,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=r,void 0!==n&&(this.originalGeometry?.dispose(),this.originalGeometry=n),void 0!==i&&(this.subdividedGeometry?.dispose(),this.subdividedGeometry=i??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,fj(this),mj(this),this.calcBoundingBox(),e&&(this.localGeometry.uuid=e)}updateState(t,e){if(super.updateState(t,e),void 0!==t.flatShading){let n=this.material;this.material=Array.isArray(n)?n.map((t=>t.getFlavor(!1,t.side,t.wireframe))):n.getFlavor(!1,n.side,n.wireframe),this.smoothShading=!t.flatShading,this.createGeometryDelayed(e)}}updateMesh(t=!1){xk.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,t&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&xk.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,t&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=xk.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=xk.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(t,e){let n=this.localGeometry;this.localGeometry=this.originalGeometryNew,Xk.prototype.raycast.call(this,t,e),this.localGeometry=n}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let t=this.originalGeometry;null===t.boundingSphere&&(t.boundingSphere=new mg,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=t.boundingSphere));let e=t.attributes.position,n=t.boundingSphere.center;gj.setFromBufferAttribute(e),gj.getCenter(n),t.boundingSphere.radius=n.distanceTo(gj.max),isNaN(t.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),gj.getSize(vj),this.hasNonUniformScale&&vj.divide(this.scale);let i={width:vj.x,height:vj.y,depth:vj.z};return this.geometry.userData.parameters=i,i}updateBoundingSphere(t){let e=this.originalGeometry;gj.min.set(t[0],t[2],t[4]),gj.max.set(t[1],t[3],t[5]),this.hasNonUniformScale&&(gj.min.applyMatrix4(this.shearScaleInv),gj.max.applyMatrix4(this.shearScaleInv)),null===e.boundingSphere&&(e.boundingSphere=new mg);let n=e.boundingSphere.center;gj.getCenter(n),e.boundingSphere.radius=n.distanceTo(gj.max)}freeSubdivPointer(){this.subdivPointer&&(xk.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,this.originalGeometry?.dispose(),this.subdividedGeometry?.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(t,e,n){super.updateByPatchedOpGeometry(t,e,n),this.localGeometry&&this.createGeometryByControls(e)}},bj={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},_j={polygon_center:0,edge:1,vertex:2},wj=(t,e)=>(n,i)=>e&&0!==n&&0!==t?t*i/100:0,Sj=(t,e)=>{let n=Math.abs(e),i=-1*n;return(t- -1)*(n-i)/2+i},Mj=new $m,Tj=new $m,Ej=new $m,Aj=new $m;function Cj(t,e){let n=Ej.fromArray(t),i=Aj.fromArray(e);Tj.copy(i).sub(n);let r=Tj.length();return Tj.normalize().multiplyScalar(.5*r),Mj.copy(n).add(Tj).toArray()}var Pj=new lv,Rj=new $m,Oj=new $m,Dj=new $m;var Lj=t=>.5*(1-Math.cos(t*Math.PI)),Ij=class{constructor(){this.perlin=new Array(4096)}noise(t,e=0,n=0){if(null==this.perlin){this.perlin=new Array(4096);for(let t=0;t<4096;t++)this.perlin[t]=Math.random()}t<0&&(t=-t),e<0&&(e=-e),n<0&&(n=-n);let i,r,s,a,o,l=Math.floor(t),c=Math.floor(e),h=Math.floor(n),u=t-l,d=e-c,p=n-h,f=0,m=.5;for(let t=0;t<4;t++){let t=l+(c<<4)+(h<<8);i=Lj(u),r=Lj(d),s=this.perlin[4095&t],s+=i*(this.perlin[t+1&4095]-s),a=this.perlin[t+16&4095],a+=i*(this.perlin[t+16+1&4095]-a),s+=r*(a-s),t+=256,a=this.perlin[4095&t],a+=i*(this.perlin[t+1&4095]-a),o=this.perlin[t+16&4095],o+=i*(this.perlin[t+16+1&4095]-o),a+=r*(o-a),s+=Lj(p)*(a-s),f+=s*m,m*=.5,l<<=1,u*=2,c<<=1,d*=2,h<<=1,p*=2,u>=1&&(l++,u--),d>=1&&(c++,d--),p>=1&&(h++,p--)}return f}noiseSeed(t){let e=(()=>{let t,e;return{setSeed(n){e=t=(n??4294967296*Math.random())>>>0},getSeed:()=>t,rand:()=>(e=(1664525*e+1013904223)%4294967296,e/4294967296)}})();e.setSeed(t),this.perlin=new Array(4096);for(let t=0;t<4096;t++)this.perlin[t]=e.rand()}},zj=new $m,Nj=new Mg,Uj=new Sg;function kj(t){let e=!1;return t.scene.objects.traverse(((t,n)=>{"Mesh"===n.type&&("TextGeometry"===n.geometry.type||"InputGeometry"===n.geometry.type)&&(e=!0)})),e}var Bj,Fj,Vj,jj,Hj=class extends pj{constructor(t,e,n){super(t,e,n),this.data=e}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){let t=this.dataPatched;return this.font?.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,t.geometry.height,this.fontScale,t.geometry.verticalAlign)??0}get fontScale(){let t=this.dataPatched;return this.font?t.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){return(this.font?.ascender??1)*this.fontScale}get descender(){return(this.font?.descender??1)*this.fontScale}get lineHeight(){let t=this.dataPatched;return t.geometry.fontSize*t.geometry.lineHeight}raycast(t,e){let{matrixWorld:n}=this;if(!isNaN(t.ray.origin.x)&&0!==this.scale.x&&0!==this.scale.y&&0!==this.scale.z&&(Nj.copy(n).invert(),Uj.copy(t.ray).applyMatrix4(Nj),Uj.intersectBox(this.singleBBox,zj))){let i=zj.applyMatrix4(n),r=t.ray.origin.distanceTo(i);e.push({distance:r,point:i.clone(),object:this})}}},Gj=1e-4,Wj=new $m,qj=new $m;ak.then((t=>{Fj=[(Bj=t).get_face_center,Bj.get_edge_midpoint,Bj.get_vertex_position],Vj=[Bj.get_face_normal,Bj.get_edge_normal,Bj.get_vertex_normal],jj=[Bj.face_count,Bj.edge_count,Bj.vertex_count]}));var Xj=new Mg,$j=new Mg,Yj=new $m,Zj=new $m,Kj=new $m,Jj=new $m,Qj=new $m,tH=new $m,eH=class{constructor(t,e){this.data=t,this.is3D=e,this.perlin=new Ij,"perlin"===t.noiseType?(this.perlin.noiseSeed(t.seed),this.noise=e?(t,e,n)=>this.perlin.noise(t,e,n):t=>this.perlin.noise(t)):this.noise=e?function(t=Math.random){let e=az(t),n=new Float64Array(e).map((t=>sz[t%12*3])),i=new Float64Array(e).map((t=>sz[t%12*3+1])),r=new Float64Array(e).map((t=>sz[t%12*3+2]));return function(t,s,a){let o,l,c,h,u,d,p,f,m,g,v=(t+s+a)*ez,y=iz(t+v),x=iz(s+v),b=iz(a+v),_=(y+x+b)*nz,w=t-(y-_),S=s-(x-_),M=a-(b-_);w>=S?S>=M?(u=1,d=0,p=0,f=1,m=1,g=0):w>=M?(u=1,d=0,p=0,f=1,m=0,g=1):(u=0,d=0,p=1,f=1,m=0,g=1):S<M?(u=0,d=0,p=1,f=0,m=1,g=1):w<M?(u=0,d=1,p=0,f=0,m=1,g=1):(u=0,d=1,p=0,f=1,m=1,g=0);let T=w-u+nz,E=S-d+nz,A=M-p+nz,C=w-f+2*nz,P=S-m+2*nz,R=M-g+2*nz,O=w-1+.5,D=S-1+.5,L=M-1+.5,I=255&y,z=255&x,N=255&b,U=.6-w*w-S*S-M*M;if(U<0)o=0;else{let t=I+e[z+e[N]];U*=U,o=U*U*(n[t]*w+i[t]*S+r[t]*M)}let k=.6-T*T-E*E-A*A;if(k<0)l=0;else{let t=I+u+e[z+d+e[N+p]];k*=k,l=k*k*(n[t]*T+i[t]*E+r[t]*A)}let B=.6-C*C-P*P-R*R;if(B<0)c=0;else{let t=I+f+e[z+m+e[N+g]];B*=B,c=B*B*(n[t]*C+i[t]*P+r[t]*R)}let F=.6-O*O-D*D-L*L;if(F<0)h=0;else{let t=I+1+e[z+1+e[N+1]];F*=F,h=F*F*(n[t]*O+i[t]*D+r[t]*L)}return 32*(o+l+c+h)}}((0,JI.default)(t.seed)):function(t=Math.random){let e=az(t),n=new Float64Array(e).map((t=>rz[t%12*2])),i=new Float64Array(e).map((t=>rz[t%12*2+1]));return function(t,r){let s,a,o=0,l=0,c=0,h=(t+r)*QI,u=iz(t+h),d=iz(r+h),p=(u+d)*tz,f=t-(u-p),m=r-(d-p);f>m?(s=1,a=0):(s=0,a=1);let g=f-s+tz,v=m-a+tz,y=f-1+2*tz,x=m-1+2*tz,b=255&u,_=255&d,w=.5-f*f-m*m;if(w>=0){let t=b+e[_];w*=w,o=w*w*(n[t]*f+i[t]*m)}let S=.5-g*g-v*v;if(S>=0){let t=b+s+e[_+a];S*=S,l=S*S*(n[t]*g+i[t]*v)}let M=.5-y*y-x*x;if(M>=0){let t=b+1+e[_+1];M*=M,c=M*M*(n[t]*y+i[t]*x)}return 70*(o+l+c)}}((0,JI.default)(t.seed))}},nH=class extends(mz(Kg)){constructor(t,e){super(),this.parameters=e,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.random=null,this.object=t}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(t){if(null===this.parent)this.updateState(this.parameters,t);else for(let t of this.children)t instanceof vz&&t.expand()}invalidateTransform(t){this.matrixWorldNeedsUpdate=!0,this.traverse((e=>{e instanceof vz&&e.object===t&&(e.matrixWorldNeedsUpdate=!0)}))}onObjUpdateMatrix(){"toObject"!==this.parameters.type&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let t of this.children)t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD())}_updateCount(t){let e;if(e=void 0!==t?t:"grid"===this.parameters.type?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,"toObject"===this.parameters.type)if(this.parameters.toObject.object){if(void 0===t&&"random"!==this.parameters.toObject.spreadType)return}else e=0;if("toObject"===this.parameters.type&&this.objectForSample){let t=this.children;if(t.length===e)return;if(t.length<e)for(let n=0,i=e-t.length;n<i;++n){let t=new vz(this.object);t.expand(),this.add(t)}else for(let n=0,i=t.length-e;n<i;++n)this.remove(t[n])}else{if(this.children.length===e)return;if(this.children.length<e)for(let t=0,n=e-this.children.length;t<n;++t){let t=new vz(this.object);t.expand(),this.add(t)}else for(let t=0,n=this.children.length-e;t<n;++t)this.remove(this.children[t])}}getRandom(t,e=!1){return(null===this.random||this.random.data.seed!==t.seed||this.random.is3D!==e)&&(this.random=new eH(t,e)),this.random}_updateRadial(t){let e,n=t.radial,i=n.start*vm.DEG2RAD,r=i-n.end*vm.DEG2RAD,s=new Ig(n.rotation[0],n.rotation[1],n.rotation[2]);switch(n.axis){case"z":e=new $m(0,0,1);break;case"y":e=new $m(0,1,0);break;default:e=new $m(1,0,0)}let a=t.randomnessObject??VD.defaultData([1,1,1]).randomnessObject,o=this.getRandom(a),l=wj(a.strength,this.parameters.randomness);for(let[c,h]of this.children.entries()){let u=c*(a.freqScale/10)+a.movement,d=o.noise(u,u,u),p=c+1;h.scale.x=n.scale[0]+l(p,Sj(d,a.scale[0]))||Gj,h.scale.y=n.scale[1]+l(p,Sj(d,a.scale[1]))||Gj,h.scale.z=n.scale[2]+l(p,Sj(d,a.scale[2]))||Gj,h.position.setScalar(0);let f=r/t.count*c-i;switch(n.axis){case"x":h.rotation.set(0,f,0);break;case"y":h.rotation.set(0,0,f);break;case"z":h.rotation.set(f,0,0)}h.translateOnAxis(e,n.radius),h.position.x+=n.position[0]+l(p,Sj(d,a.position[0])),h.position.y+=n.position[1]+l(p,Sj(d,a.position[1])),h.position.z+=n.position[2]+l(p,Sj(d,a.position[2]));let m=l(p,Sj(d,a.rotation[0])),g=l(p,Sj(d,a.rotation[1])),v=l(p,Sj(d,a.rotation[2]));!0===n.alignment?(h.rotation.x+=s.x+m,h.rotation.y+=s.y+g,h.rotation.z+=s.z+v):h.rotation.set(s.x+m,s.y+g,s.z+v)}}_updateLinear(t){if("linear"!==t.type)throw new Error;let e=t.linear,n=new Ig(e.rotation[0],e.rotation[1],e.rotation[2]),i=t.randomnessObject??VD.defaultData([1,1,1]).randomnessObject,r=this.getRandom(i),s=wj(i.strength,this.parameters.randomness);for(let[t,a]of this.children.entries()){let o=t*(i.freqScale/10)+i.movement,l=r.noise(o,o,o),c=t+1,h=s(c,Sj(l,i.rotation[0])),u=s(c,Sj(l,i.rotation[1])),d=s(c,Sj(l,i.rotation[2]));a.scale.x=1+(e.scale[0]-1)*t+s(c,Sj(l,i.scale[0]))||Gj,a.scale.y=1+(e.scale[1]-1)*t+s(c,Sj(l,i.scale[1]))||Gj,a.scale.z=1+(e.scale[2]-1)*t+s(c,Sj(l,i.scale[2]))||Gj,a.rotation.x=n.x*t+h,a.rotation.y=n.y*t+u,a.rotation.z=n.z*t+d,a.position.x=e.position[0]*t+s(c,Sj(l,i.position[0])),a.position.y=e.position[1]*t+s(c,Sj(l,i.position[1])),a.position.z=e.position[2]*t+s(c,Sj(l,i.position[2]))}}_updateGrid(t){let e=0,n=t.grid,i=t.randomnessObject??VD.defaultData([1,1,1]).randomnessObject,r=this.getRandom(i,!0),s=wj(i.strength,this.parameters.randomness);if(!0===n.useCenter){let t={x:n.count[0]%2==0?2:1,y:n.count[1]%2==0?2:1,z:n.count[2]%2==0?2:1},a=new $m(n.size[0]*(n.count[0]-t.x)*.5,n.size[1]*(n.count[1]-t.y)*.5,n.size[2]*(n.count[2]-t.z)*.5);for(let t=0;t<n.count[0];t++)for(let o=0;o<n.count[1];o++)for(let l=0;l<n.count[2];l++){let c=r.noise((t+1)*(i.freqScale/10)+i.movement,(o+1)*(i.freqScale/10)+i.movement,(l+1)*(i.freqScale/10)+i.movement),h=this.children[e++];h.scale.x=1+s(e,Sj(c,i.scale[0]))||Gj,h.scale.y=1+s(e,Sj(c,i.scale[1]))||Gj,h.scale.z=1+s(e,Sj(c,i.scale[2]))||Gj;let u=s(e,Sj(c,i.rotation[0])),d=s(e,Sj(c,i.rotation[1])),p=s(e,Sj(c,i.rotation[2]));h.rotation.set(u,d,p),h.position.x=n.size[0]*t-a.x+s(e,Sj(c,i.position[0])),h.position.y=n.size[1]*o-a.y+s(e,Sj(c,i.position[1])),h.position.z=n.size[2]*l-a.z+s(e,Sj(c,i.position[2]))}}else for(let t=0;t<n.count[0];t++)for(let a=0;a<n.count[1];a++)for(let o=0;o<n.count[2];o++){let l=r.noise((t+1)*(i.freqScale/10)+i.movement,(a+1)*(i.freqScale/10)+i.movement,(o+1)*(i.freqScale/10)+i.movement),c=this.children[e++];c.scale.x=1+s(e,Sj(l,i.scale[0]))||Gj,c.scale.y=1+s(e,Sj(l,i.scale[1]))||Gj,c.scale.z=1+s(e,Sj(l,i.scale[2]))||Gj;let h=s(e,Sj(l,i.rotation[0])),u=s(e,Sj(l,i.rotation[1])),d=s(e,Sj(l,i.rotation[2]));c.rotation.set(h,u,d),c.position.x=n.size[0]*t+s(e,Sj(l,i.position[0])),c.position.y=-n.size[1]*a+s(e,Sj(l,i.position[1])),c.position.z=-n.size[2]*o+s(e,Sj(l,i.position[2]))}}_updateToObject(t){if("toObject"!==t.type)throw new Error;let{toObject:e}=t,n=new Ig(e.rotation[0],e.rotation[1],e.rotation[2]),i=t.randomnessObject??VD.defaultData([1,1,1]).randomnessObject,r=this.getRandom(i),s=wj(i.strength,this.parameters.randomness);if(!e.object){for(let[,t]of this.children.entries())t.position.set(0,0,0),t.scale.setScalar(1),t.rotation.set(0,0,0);return void(this.objectForSample=void 0)}if(!this.objectForSample)return;if(this.objectForSample instanceof Hj){if(!this.objectForSample.font?.isLoaded||void 0===this.objectForSample.geometry.attributes.position)return void(this._pendingMediaLoad=!0);this._pendingMediaLoad=!1}if(void 0===this.objectForSample.geometry&&this.objectForSample.isAncestorOf(this.object.uuid))return void console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);let a=this.getSubdivData();if(a.length>0){let t=Math.round(a.length*e.count/100);this._updateCount(t)}else{let t=this.objectForSample.geometry.getAttribute("position");if(!t||isNaN(t.count)||0===t.count)return void console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`)}this.objectForSample.updateMatrixWorld();let o=new cz(this.objectForSample).build(),l=bj[e.axis],c=this.children;o.setRandomGenerator((0,JI.default)(this.object.uuid+e.seed));for(let[t,h]of c.entries()){let c=t*(i.freqScale/10)+i.movement,u=r.noise(c,c,c),d=t+1,p=s(d,Sj(u,i.rotation[0])),f=s(d,Sj(u,i.rotation[1])),m=s(d,Sj(u,i.rotation[2]));"random"===e.spreadType?o.sample(Kj,Jj):(a.length&&(Kj.fromArray(a[t].pos),Jj.fromArray(a[t].norm)),this.objectForSample instanceof xj&&Kj.applyMatrix4(Xj.copy(this.objectForSample.matrixWorld).invert())),Kj.applyMatrix4(this.object.hiddenMatrix.clone().invert()),h.position.copy(Kj),Yj.fromArray(l);let g="normal"===e.align?Jj:this.object.getWorldDirection(tH),v=Zj.fromArray(e.position);Zj.x+=s(d,Sj(u,i.position[0])),Zj.y+=s(d,Sj(u,i.position[1])),Zj.z+=s(d,Sj(u,i.position[2]));let y=Math.acos(g.dot(Yj)),x=Qj.crossVectors(Yj,g).normalize(),b=$j.makeRotationAxis(x,y),_=g.clone().cross(this.object.up).normalize(),w=_.clone().cross(g).normalize(),S=(new Mg).makeBasis(_,g,w),M=new $m(Yj.y,Yj.z,Yj.x).normalize(),T=M.clone().cross(Yj).normalize(),E=(new Mg).makeBasis(M,Yj,T).invert(),A=(new Mg).multiplyMatrices(S,E);h.rotation.setFromRotationMatrix(A),v.applyMatrix4(b),h.position.add(v),h.rotation.x=h.rotation.x+n.x+p,h.rotation.y=h.rotation.y+n.y+f,h.rotation.z=h.rotation.z+n.z+m,h.scale.setScalar(1),h.scale.x=h.scale.x+e.scale[0]+s(d,Sj(u,i.scale[0]))||Gj,h.scale.y=h.scale.y+e.scale[1]+s(d,Sj(u,i.scale[1]))||Gj,h.scale.z=h.scale.z+e.scale[2]+s(d,Sj(u,i.scale[2]))||Gj,h.scale.multiply(this.object.scale),h.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let t=this.parameters.toObject.spreadType,e=new Map,n=(t,n)=>{let i=Math.round(1e4*t[0])+"_"+Math.round(1e4*t[1])+"_"+Math.round(1e4*t[2]),r=e.get(i);r?(r.pos[0]+=t[0],r.pos[1]+=t[1],r.pos[2]+=t[2],r.norm[0]+=n[0],r.norm[1]+=n[1],r.norm[2]+=n[2],r.count+=1):e.set(i,{pos:[...t],norm:[...n],count:1})};if("random"===t)return[];if(this.objectForSample instanceof xj){let e=this.objectForSample,i=_j[t],r=jj[i],s=Fj[i],a=Vj[i],o=r(e.subdivPointerNew);for(let t=0;t<=o-1;t++){let i=s(e.subdivPointerNew,t),r=a(e.subdivPointerNew,t);Wj.fromArray(i).applyMatrix4(e.matrixWorld),qj.fromArray(r),n(Wj.toArray(),qj.toArray())}}else(this.objectForSample.geometry.index?function(t){let e=[];for(let n=0;n<=t.index.count;n++)if(Rj.fromArray(t.index.array,3*n),Pj.setFromAttributeAndIndices(t.attributes.position,Rj.x,Rj.y,Rj.z),Pj.getNormal(Oj),Pj.getMidpoint(Dj),!(isNaN(Dj.x)||isNaN(Dj.y)||isNaN(Dj.z))){let{a:t,b:n,c:i}=Pj,r=t.toArray(),s=n.toArray(),a=i.toArray(),o=t.distanceTo(n),l=n.distanceTo(i),c=i.distanceTo(t),h=Cj(r,s),u=Cj(s,a),d=Cj(a,r),p=[o,l,c],f=Math.max(...p),m=p.filter((t=>Math.round(t)===Math.round(f))).length>1,g=[],v=Pj.getMidpoint(Dj).toArray();f===o&&!m&&(g=[u,d,d],v=h),f===l&&!m&&(g=[h,d,d],v=u),f===c&&!m&&(g=[h,u,u],v=d),m&&(g=[h,u,d]),e.push({vertices:[r,s,a],faceCenters:g,midpoint:v,norm:Pj.getNormal(Oj).toArray()})}return e}(this.objectForSample.geometry):function(t){let e=[],{position:n}=t.attributes;for(let t=0;t<n.count;t++){Pj.setFromAttributeAndIndices(n,3*t,3*t+1,3*t+2),Pj.getNormal(Oj),Pj.getMidpoint(Dj);let i=Pj.a.toArray(),r=Pj.b.toArray(),s=Pj.c.toArray();e.push({vertices:[i,r,s],faceCenters:[Cj(i,r),Cj(r,s),Cj(s,i)],midpoint:Dj.toArray(),norm:Oj.toArray()})}return e}(this.objectForSample.geometry)).forEach(((e,i)=>{"polygon_center"===t&&n(e.midpoint,e.norm),"vertex"===t&&(n(e.vertices[0],e.norm),n(e.vertices[1],e.norm),n(e.vertices[2],e.norm)),"edge"===t&&(n(e.faceCenters[0],e.norm),n(e.faceCenters[1],e.norm),n(e.faceCenters[2],e.norm))}));let i=Array.from(e.values());for(let t of i)t.pos[0]/=t.count,t.pos[1]/=t.count,t.pos[2]/=t.count,t.norm[0]/=t.count,t.norm[1]/=t.count,t.norm[2]/=t.count;return i}updateState(t,e){if(this.parameters=xP(t),"toObject"!==this.parameters.type)(null===this.parent||this.parent!==this.object)&&(this.removeFromParent(),this.object.parent?.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(null===this.parent||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let t=e.find(this.parameters.toObject.object);this.objectForSample=t instanceof Xk?t:void 0,this.matrix=new Mg,this.hiddenMatrix=new Mg,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,t&&t.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},iH=t=>{var e;return(e=class extends t{}).geometryHelper=new ny(30,30,30),e},rH=new Sg,sH=new mg,aH=new Mg,oH=(t,e,n,i,r=!1,s=t)=>{let a=e,o=s.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),sH.copy(a.boundingSphere),sH.applyMatrix4(o),!1===n.ray.intersectsSphere(sH)||(aH.copy(o).invert(),rH.copy(n.ray).applyMatrix4(aH),null!==a.boundingBox&&!1===rH.intersectsBox(a.boundingBox)))return;let l,c,h,u,d,p,f=a.index,m=a.attributes.position,g=a.drawRange;if(!1===r){for(d=Math.max(0,g.start),p=Math.min(f.count,g.start+g.count);d<p;d+=3)if(c=f.getX(d),h=f.getX(d+1),u=f.getX(d+2),l=v(t,n,rH,m,c,h,u),l)return l.faceIndex=Math.floor(d/3),void i.push(l)}else{let e=a.attributes.position,r=new $m,o=new $m,l=new $m,c=new $m,h=2,u=1/((s.scale.x+s.scale.y+s.scale.z)/3),d=u*u;for(let a=Math.max(0,g.start),u=Math.min(e.count,g.start+g.count)-1;a<u;a+=h){if(r.fromBufferAttribute(e,a),o.fromBufferAttribute(e,a+1),rH.distanceSqToSegment(r,o,c,l)>d)continue;c.applyMatrix4(s.matrixWorld);let h=n.ray.origin.distanceTo(c);h<n.near||h>n.far||i.push({distance:h,point:l.clone().applyMatrix4(s.matrixWorld),object:t})}}function v(t,e,n,i,r,s,a){let o=new $m,l=new $m,c=new $m,h=new $m,u=new $m;if(o.fromBufferAttribute(i,r),l.fromBufferAttribute(i,s),c.fromBufferAttribute(i,a),null===n.intersectTriangle(o,l,c,!1,h))return null;u.copy(h),u.applyMatrix4(t.matrixWorld);let d=e.ray.origin.distanceTo(u);return d<e.near||d>e.far?null:{faceIndex:1,distance:d,point:u.clone(),object:t}}},lH=new $m,cH=new ly,hH=class extends G_{constructor(t){let e=new Nv,n=new D_({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={},a=new pv(15711266),o=new pv(15711266),l=new pv(2857471);function c(t,e,n){h(t,n),h(e,n)}function h(t,e){i.push(0,0,0),r.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(i.length/3-1)}c("n1","n2",a),c("n2","n4",a),c("n4","n3",a),c("n3","n1",a),c("f1","f2",a),c("f2","f4",a),c("f4","f3",a),c("f3","f1",a),c("n1","f1",a),c("n2","f2",a),c("n3","f3",a),c("n4","f4",a),c("p","n1",o),c("p","n2",o),c("p","n3",o),c("p","n4",o),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l),e.setAttribute("position",new Cv(i,3)),e.setAttribute("color",new Cv(r,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let t=this.geometry,e=this.pointMap;cH.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let n=.8;uH("n1",e,t,cH,-1,-1,n),uH("n2",e,t,cH,1,-1,n),uH("n3",e,t,cH,-1,1,n),uH("n4",e,t,cH,1,1,n);let i=n;uH("f1",e,t,cH,-1,-1,i),uH("f2",e,t,cH,1,-1,i),uH("f3",e,t,cH,-1,1,i),uH("f4",e,t,cH,1,1,i);let r=i;uH("u1",e,t,cH,.35,1.1,r),uH("u2",e,t,cH,-.35,1.1,r),uH("u3",e,t,cH,0,1.55,r),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function uH(t,e,n,i,r,s,a){lH.set(r,s,a).unproject(i);let o=e[t];if(void 0!==o){let t=n.getAttribute("position");for(let e=0,n=o.length;e<n;e++)t.setXYZ(o[e],lH.x,lH.y,lH.z)}}var dH,pH=class extends(iH(hH)){constructor(t){super(t),this.object=t,this.object=t,this.name=`CombinedCameraHelper: ${t.uuid}`}updateMatrixWorld(t){super.updateMatrixWorld(t),this.updateTarget()}updateTarget(){let t=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(t)}raycast(t,e){oH(this.object,this.geometry,t,e,!0)}};(t=>{t.is=t=>"objectHelper"in t})(dH||(dH={}));var fH,mH=(t,e)=>class extends(Uz(t)){constructor(){super(...arguments),this.objectHelper=new e(this),this.gizmos={}}get geometryHelper(){return e.geometryHelper}raycast(t,e){this.objectHelper.raycast(t,e)}showGizmos(){for(let t in this.gizmos){let e=this.gizmos[t];e instanceof gM&&(e.visible=!0)}}updateEntityBoxSize(t,e){this.objectHelper.visible&&this.geometryHelper instanceof ny?(t.setScalar(0),e.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(t,e)}hideGizmos(){for(let t in this.gizmos){let e=this.gizmos[t];e instanceof gM&&(e.visible=!1)}}},gH=new $m,vH=new $m,yH=new Xm,xH=new $m,bH=new $m,_H=new $m,wH=class extends(mH(ly,pH)){constructor(t="",e={...kL.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=FD.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(t,e),this.previousProjectionMatrix=new Mg,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let n=this.width,i=this.height;this.orthoCamera=new By(-.5*n,.5*n,.5*i,-.5*i,-5e4,1e4),this.perspCamera=new dy(45,n/i,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return"PerspectiveCamera"===this.cameraType}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(t){this.perspCamera.fov=t}get fov(){return this.perspCamera.fov}setNear(t,e){"PerspectiveCamera"===t?this.perspCamera.near=e:this.orthoCamera.near=e}setZoom(t,e){e>=0&&("PerspectiveCamera"===t?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}set cameraType(t){"PerspectiveCamera"===t?this.toPerspective():"OrthographicCamera"===t&&this.toOrthographic()}get near(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.near:this.orthoCamera.near}set near(t){"PerspectiveCamera"===this._cameraType?this.perspCamera.near=t:this.orthoCamera.near=t}get zoom(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(t){t>=0&&("PerspectiveCamera"===this._cameraType?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}lookAt(t,e,n){"number"==typeof t&&(t=new $m(t,e,n)),super.lookAt(t),this.getWorldPosition(gH),this.targetOffset=gH.distanceTo(t)}getTarget(t=new $m){return this.getWorldDirection(vH),this.getWorldPosition(gH),vH.multiplyScalar(this.targetOffset),t.copy(gH).add(vH),t}getDistanceToTarget(){let t=this.getTarget();return this.getWorldPosition(gH),gH.distanceTo(t)}updateUp(){this.getWorldQuaternion(yH),xH.set(0,0,1).applyQuaternion(yH),bH.copy(Kg.DEFAULT_UP),this.isUpVectorFlipped&&bH.negate(),bH.applyQuaternion(yH),_H.copy(Kg.DEFAULT_UP).projectOnPlane(xH),this.angleOffsetFromUp=_H.angleTo(bH),this.angleOffsetFromUp*=_H.cross(bH).dot(xH)>=0?1:-1}updateTransformState(t,e){let n=super.updateTransformState(t,e);return void 0!==t.isUpVectorFlipped&&(this.isUpVectorFlipped=t.isUpVectorFlipped),this.updateUp(),n}getViewFrontToObject(t){let e=t.getWorldPosition(new $m),n=t.getWorldDirection(new $m).multiplyScalar(this.targetOffset);return{position:e.clone().add(n),target:e}}getViewToTarget(t){let e=this.getWorldDirection(new $m).multiplyScalar(this.targetOffset);return{position:t.clone().sub(e),target:t}}getViewToObject(t){let e=new $m;t.getWorldPosition(e);return this.getViewToTarget(e)}setViewplaneSize(t,e,n=!1){if(this.aspect=t/e,n){let n=t>e?this.aspect:1,i=t>e?1:this.aspect;this.left=-395*n,this.right=395*n,this.top=1/i*395,this.bottom=1/i*-395}else this.left=.5*-t,this.right=.5*t,this.top=.5*e,this.bottom=.5*-e;this.updateProjectionMatrix()}copyViewPlaneSize(t){this.aspect=t.aspect,this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(t){this.perspCamera.setFocalLength(t),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(t,e,n,i,r,s){"PerspectiveCamera"===this._cameraType?this.perspCamera.setViewOffset(t,e,n,i,r,s):this.orthoCamera.setViewOffset(t,e,n,i,r,s)}clearViewOffset(){"PerspectiveCamera"===this._cameraType?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){"PerspectiveCamera"===this._cameraType?this.toPerspective():"OrthographicCamera"===this._cameraType&&this.toOrthographic()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(t,e){return super.copy(t,e),this.parent=t.parent,this.orthoCamera.copy(t.orthoCamera),this.perspCamera.copy(t.perspCamera),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.far=t.far,this.view=null===t.view?null:Object.assign({},t.view),this._cameraType=t._cameraType,this.aspect=t.aspect,this.fov=t.fov,this.focus=t.focus,this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this.targetOffset=t.targetOffset,this.updateProjectionMatrix(),this}toCameraState(t=[]){let e={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return QP(e,t)}updateCameraSubtype(t,e){let n="perspective"===t?"PerspectiveCamera":"OrthographicCamera";void 0!==e.zoom&&this.setZoom(n,e.zoom),void 0!==e.near&&this.setNear(n,e.near),void 0!==e.fov&&"PerspectiveCamera"===n&&(this.fov=e.fov)}updateState(t,e){this.updateCameraState(t,e)}updateCameraState(t,e){this.updateState_Entity(t,e),void 0!==t.far&&(this.far=t.far),void 0!==t.orthographic&&this.updateCameraSubtype("orthographic",t.orthographic),void 0!==t.perspective&&this.updateCameraSubtype("perspective",t.perspective),void 0!==t.type&&(this.cameraType=t.type),void 0!==t.up&&this.up.fromArray(t.up),void 0!==t.targetOffset&&(this.targetOffset=t.targetOffset),void 0!==t.isUpVectorFlipped&&(this.isUpVectorFlipped=t.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(t,e,n){super.updateByPatchedOp(t,e,n),1===t.path.length&&0===t.type&&this.updateCameraSubtype(t.path[0],t.props)}toState(t){return{...super.toState(t),...this.toCameraState(t),type:this.cameraType}}},SH=new Mg,MH=new Mg,TH=class extends oj{constructor(t,e,n){super(t,e),this.data=e,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new Nv,this.onAfterRender=(t,e,n,i,r,s)=>{super.onAfterRender(t,e,n,i,r,s),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(t,e,n){super.updateByPatchedOp(t,e,n),1===t.path.length&&"geometry"===t.path[0]&&0===t.type&&void 0!==t.props.operation&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(t,e=!0){if(-1!==this.booleanMeshSetAddress&&!t)return;for(let n=0;n<this.children.length;n++){let i=this.children[n];i instanceof TH&&!0===i.dataPatched.visible&&i.recomputeBoolean(!0===t,e)}this.meshSetAddresses=[];for(let n=0;n<this.children.length;n++){let i=this.children[n];if(i instanceof Xk&&!0===i.dataPatched.visible&&i.geometry.attributes.position?.count>0&&i.geometry.drawRange.count>0&&0!==i.booleanMeshSetAddress){SH.multiplyMatrices(i.hiddenMatrix,i.matrix);try{if(-1===i.booleanMeshSetAddress){if((i.geometry.index??i.geometry.getAttribute("position")).count/3<15e5&&(i.booleanMeshSetAddress=Ak.getMeshSet(i.geometry,!0===t,e)),-1===i.booleanMeshSetAddress)return;Ak.transformMeshSet(i.booleanMeshSetAddress,SH),i.booleanMatrixInvOld.copy(SH).invert(),i.booleanWasTransformed=!1}else i instanceof TH&&!0===i.needsTransformForDownstream?(Ak.transformMeshSet(i.booleanMeshSetAddress,SH),i.needsTransformForDownstream=!1):!0===i.booleanWasTransformed&&(Ak.transformMeshSet(i.booleanMeshSetAddress,MH.multiplyMatrices(SH,i.booleanMatrixInvOld)),i.booleanMatrixInvOld.copy(SH).invert(),i.booleanWasTransformed=!1)}catch(t){console.error(t),i.booleanMeshSetAddress=0,i.geometry.userData.booleanOperationDidFail=!0;continue}!1===Ak.hasOpenEdges(i.booleanMeshSetAddress)||n===this.children.length-1&&2===this.booleanOp?(this.meshSetAddresses.push(i.booleanMeshSetAddress),i.geometry.userData.booleanOperationDidFail=!1):i.geometry.userData.booleanOperationDidFail="openEdges"}}if(0===this.meshSetAddresses.length)return this.geometry.setAttribute("position",new Cv([],0)),void this.geometry.setDrawRange(0,0);if(!0===t)return Ak.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let n=this.geometry;n.dispose(),this.geometry=new Nv,this.geometry.userData=n.userData,this.geometry.boundingSphere=n.boundingSphere;try{this.booleanMeshSetAddress=Ak.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(t){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(t)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,fj(this),mj(this)}dispose(){super.dispose(),this.geometry.dispose()}};(t=>{t.is=function(t){return fz.is(t)&&t instanceof MS}})(fH||(fH={}));var EH=(t,e)=>class extends(mH(t,e)){updateState_Light(t,e){this.updateState_Entity(t,e),void 0!==t.color&&(this.color=e.shared.color(t.color)),void 0!==t.intensity&&(this.intensity=t.intensity),void 0!==t.depth&&(this.shadow.camera.far=t.depth,this.shadow.needsUpdate=!0),void 0!==t.shadows&&(this.castShadow=t.shadows)}},AH=t=>t instanceof Xk,CH=t=>null!==t&&t instanceof TH,PH=t=>dH.is(t),RH=new $m(1,1,1),OH=new $m,DH=new $m,LH=new Xm,IH=class extends(iH(vM)){constructor(t,e=15){super(e),this.object=t,this.dummy=new i_,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${t.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(t,e){oH(this.object,IH.geometryHelper,t,e,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(t){this.object.matrixWorld.decompose(OH,LH,DH),this.matrix.compose(OH,LH,RH),super.updateMatrixWorld(t)}updateWorldMatrix(t,e){}},zH=class extends(mH(i_,IH)){constructor(t,e){super(),this.super_Entity(t,e),this.objectHelper.update()}updateState(t,e){this.updateState_Entity(t,e),"buffer"in t&&1===Object.keys(t).length&&e.scene.reloadSplats()}},NH=class extends(mH(i_,IH)){constructor(t,e,n){super(),this.super_Entity(t,e),this.context=n,this.objectHelper.update()}updateState(t,e){this.updateState_Entity(t,e)}},UH=Ay.lights_fragment_begin,kH=Ay.shadowmask_pars_fragment,BH=null,FH=class extends(iH(uM)){constructor(t,e=15,n=10066329){super(t,e,n),this.object=t,this.added=!1,this.name=`DirectionalLightHelper: ${t.uuid}`}raycast(t,e){oH(this.object,FH.geometryHelper,t,e)}},VH=class extends(iH(oM)){constructor(t,e=15,n=6710886){super(t,e,n),this.object=t,this.name=`PointLightHelper: ${t.uuid}`}raycast(t,e){oH(this.object,VH.geometryHelper,t,e)}},jH=class extends(iH(aM)){constructor(t,e=6710886){super(t,e),this.object=t,this.name=`SpotLightHelper: ${t.uuid}`}raycast(t,e){oH(this.object,jH.geometryHelper,t,e)}update(){if(void 0!==this.object){let t=jH._vector,e=this.object.distance?this.object.distance:1e3,n=e*Math.tan(this.object.angle);this.cone.scale.set(n,n,e),t.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(t);let i=void 0!==this.color?this.color:this.light.color;if(this.cone.material instanceof Array)for(let t=0,e=this.cone.material.length;t<e;t++)this.cone.material[t].color.set(i);else this.cone.material.color.set(i)}}},HH=jH;HH._vector=new $m;var GH,WH=class extends(EH(kS,FH)){constructor(t,e,n){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let i=this.shadow.camera;i.top=1250,i.bottom=-1250,i.right=1250,i.left=-1250,i.near=-1e4,i.far=2500;let r=new fM(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r}update(){this.shadow.camera.updateProjectionMatrix();for(let t in this.gizmos){let e=this.gizmos[t];e instanceof fM&&e.update()}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e);let n=void 0!==t.depth&&t.depth!==this.shadow.camera.far||void 0!==t.size&&t.size/2!==this.shadow.camera.right;void 0!==t.size&&function(t,e){t.shadow.camera.right=e/2,t.shadow.camera.left=-e/2,t.shadow.camera.top=e/2,t.shadow.camera.bottom=-e/2,t.shadow.needsUpdate=!0}(this,t.size),void 0!==t.shadowRadius&&(this.shadow.radius=t.shadowRadius),void 0!==t.shadowResolution&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),void 0!==t.penumbraSize&&e.scene.markPenumbraSizeDirty(),n&&this.update()}},qH=new $m,XH=new $m,$H=new Xm,YH=class extends(EH(OS,HH)){constructor(t,e,n){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let i=this.shadow.camera;i.fov=2*vm.RAD2DEG*this.angle,i.aspect=1,i.near=100,i.far=2500;let r=new fM(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let t in this.gizmos){let e=this.gizmos[t];e instanceof fM&&e.update()}}updateMatrixWorld(t){super.updateMatrixWorld(t),XH.setFromMatrixPosition(this.matrixWorld),$H.setFromRotationMatrix(this.matrixWorld),qH.copy(this.up).applyQuaternion($H).negate().multiplyScalar(this.distance),this.target.position.copy(XH).add(qH),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e),void 0!==t.distance&&(this.distance=t.distance),void 0!==t.decay&&(this.decay=t.decay),void 0!==t.angle&&(this.angle=t.angle),void 0!==t.penumbra&&(this.penumbra=t.penumbra),void 0!==t.shadowRadius&&(this.shadow.radius=t.shadowRadius),void 0!==t.penumbraSize&&e.scene.markPenumbraSizeDirty(),void 0!==t.shadowResolution&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function ZH(t,e){return[[t[0][0]*e[0][0]+t[0][1]*e[1][0],t[0][0]*e[0][1]+t[0][1]*e[1][1]],[t[1][0]*e[0][0]+t[1][1]*e[1][0],t[1][0]*e[0][1]+t[1][1]*e[1][1]]]}function KH(t){return[[t[0][0],t[1][0]],[t[0][1],t[1][1]]]}function JH(t){let[e,n,i]=function(t){let e=(t[0][0]+t[1][1])/2,n=(t[0][0]-t[1][1])/2,i=(t[1][0]+t[0][1])/2,r=(t[1][0]-t[0][1])/2,s=Math.sqrt(e*e+r*r),a=Math.sqrt(n*n+i*i),o=s+a,l=s-a,c=Math.atan2(i,n),h=Math.atan2(r,e),u=(h-c)/2,d=(h+c)/2,p=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]],f=[[o,0],[0,l]],m=[[Math.cos(u),Math.sin(u)],[-Math.sin(u),Math.cos(u)]];return p[0][0]*=-1,p[0][1]*=-1,m[0][0]*=-1,m[1][0]*=-1,[p,f,m]}(t),r=ZH(e,KH(i)),s=ZH(ZH(i,n),KH(i));return{rotation:Math.atan2(r[1][0],r[0][0]),scale:[s[0][0],s[1][1]],shear:[s[0][1]/s[1][1],s[1][0]/s[0][0]]}}(t=>{function e(t){return[t[0],t[3],t[1],t[4],t[2],t[5]]}t.identity=function(){return[1,0,0,0,1,0,0,0,1]},t.copy=function(e,n=t.identity()){for(let t=0,i=e.length;t<i;t++)n[t]=e[t];return n},t.create=function(e,n,i,r,s,a){return t.setAbcdef(t.identity(),e,n,i,r,s,a)},t.setAbcdef=function(t,e,n,i,r,s,a){return t[0]=e,t[1]=i,t[2]=s,t[3]=n,t[4]=r,t[5]=a,t},t.append=function(n,i){let[r,s,a,o,l,c]=e(n),[h,u,d,p,f,m]=e(i),g=h*r+u*a,v=h*s+u*o,y=d*r+p*a,x=d*s+p*o,b=f*r+m*a+l,_=f*s+m*o+c;return t.create(g,v,y,x,b,_)},t.prepend=function(n,i){let[r,s,a,o,l,c]=e(n),[h,u,d,p,f,m]=e(i),g=r,v=s,y=a,x=o;(1!==h||0!==u||0!==d||1!==p)&&(g=r*h+s*d,v=r*u+s*p,y=a*h+o*d,x=a*u+o*p);let b=l*h+c*d+f,_=l*u+c*p+m;return t.create(g,v,y,x,b,_)},t.getAbcdef=e,t.invert=function(e){let[n,i,r,s,a,o]=t.getAbcdef(e),l=n*s-i*r,c=s/l,h=-i/l,u=-r/l,d=n/l,p=(r*o-s*a)/l,f=-(n*o-i*a)/l;return t.create(c,h,u,d,p,f)},t.apply=function([e,n],i){let[r,s,a,o,l,c]=t.getAbcdef(i);return[r*e+a*n+l,s*e+o*n+c]},t.applyInverse=function(e,n){let[i,r,s,a,o,l]=t.getAbcdef(n),c=1/(i*a+s*-r),[h,u]=e;return[a*c*h+-s*c*u+(l*s-o*a)*c,i*c*u+-r*c*h+(-l*i+o*r)*c]},t.scale=function(e,n,i=n){let[r,s,a,o,l,c]=t.getAbcdef(e);return t.setAbcdef(e,r*n,s*i,a*n,o*i,l*n,c*i),e},t.rotate=function(e,n){let i=Math.cos(n),r=Math.sin(n),[s,a,o,l,c,h]=t.getAbcdef(e);return t.setAbcdef(e,s*i-a*r,s*r+a*i,o*i-l*r,o*r+l*i,c*i-h*r,c*r+h*i),e},t.rotateAround=function(e,n,i){let[r,s]=i,a=t.translate(e,-r,-s);return a=t.rotate(a,n),a=t.translate(a,r,s),a},t.translate=function(e,n,i){let[r,s,a,o,l,c]=t.getAbcdef(e);return t.setAbcdef(e,r,s,a,o,l+n,c+i),e},t.setTranslate=function(e,n,i){let[r,s,a,o]=t.getAbcdef(e);return t.setAbcdef(e,r,s,a,o,n,i),e},t.setPosition=function(e,n,i){let[r,s,a,o]=t.getAbcdef(e);return t.setAbcdef(e,r,s,a,o,n,i),e},t.getScale=function(e){let[n,i,r,s]=t.getAbcdef(e);return[Math.sqrt(n*n+i*i),Math.sqrt(r*r+s*s)]},t.getPosition=function(e){let[,,,,n,i]=t.getAbcdef(e);return[n,i]},t.getRotation=function(e,n){return t.decompose(e,n).rotation},t.decompose=function(e,n){let[i,r,s,a,o,l]=t.getAbcdef(e),{rotation:c,scale:h,shear:u}=JH([[i,s],[r,a]]);return{position:[o+(n[0]*i+n[1]*s)-n[0],l+(n[0]*r+n[1]*a)-n[1]],scale:h,rotation:c,shear:u,pivot:n}},t.compose=function(e,n,i,r,s=[0,0]){let[a,o]=e,[l,c]=r,[h,u,d,p]=function({rotation:t,scale:e,shear:n}){let i=Math.cos(t),r=Math.sin(t),s=ZH([[i,-r],[r,i]],[[e[0],n[0]*e[1]],[n[1]*e[0],e[1]]]);return[s[0][0],s[1][0],s[0][1],s[1][1]]}({rotation:i,scale:n,shear:s}),f=a-(l*h+c*d)+l,m=o-(l*u+c*p)+c;return t.create(h,u,d,p,f,m)}})(GH||(GH={}));var QH=Math.PI/180;Math.PI;var tG=class{constructor(t,e,n){this.uuid=t,this.data=e,this.localMatrix=GH.identity(),this.worldMatrix=GH.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new hG,this._recursiveBBox=new hG,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=XU(),this.dpr=n.dpr??1,this.dataPatched=e}project(t,e){let n=this.worldMatrix;return e&&(n=GH.append(e.worldMatrix,n)),GH.applyInverse(t,n)}intersects(t,e,n,i=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([t,e],n),i)}intersectsInLocalSpace(t,e,n=!1){let{min:i,max:r}=n?this.recursiveBBox:this.singleBBox;return t>=i[0]&&t<=r[0]&&e>=i[1]&&e<=r[1]}applyTransforms(t){t.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=GH.compose(this.position,this.scale,function(t){return t*QH}(this.rotation),qI.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(t,e,n){let i=this.parent;e&&null!=i&&i.updateWorldMatrix(t,!0,!1),t&&this.updateLocalMatrix(),this.parent?this.worldMatrix=GH.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=GH.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return qI.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors((t=>{t.resetBBoxNeedsUpdateSelf()}))}updateTransformState(t){let e=!1;void 0!==t.position&&(e=!0,this.position=t.position),void 0!==t.rotation&&(e=!0,this.rotation=t.rotation),void 0!==t.scale&&(e=!0,this.scale=t.scale),void 0!==t.shear&&(e=!0,this.shear=t.shear),e&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(t,e,n){0===t.type&&void 0!==t.props.visible&&(this.visible=t.props.visible),this.data=e,this.data=e;let i=t,r=$R(t.path,["states","*"]);if(null!==r){if(0===t.type){let[e]=r;if(this?.stateSelection===e){let e={...t.props};if(delete e.name,Object.values(t.props).some((t=>void 0===t))){let n=this.data;if(void 0!==n){let i=jR.zoom(n,t.path.slice(2));if(i)for(let n in t.props)void 0===t.props[n]&&n in i&&(e[n]=i[n])}}i={...t,props:e,path:t.path.slice(2)}}}}else if(0===t.type){let e=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==e){if(void 0!==t.props.name&&e.name){let{name:t,...n}=e;e=n}let n=jR.removeOverridden(t.path,t.props,e);i={...t,props:n}}}this.updateByPatchedOpBase(i,zI.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),n)}changeSelectedState(t,e,n=!1){if(0!==this.data.states.length||n){for(let t of this.data.states)zI.toOps(this.data,t.data).forEach((t=>{let n=yR.replaceProps(t,this.data);this.dataPatched=this.data,this.updateByPatchedOp(n,this.data,e)}));if(null!==t){let n=this.data.states.data(t);n&&(this.dataPatched=zI.patch(this.data,n),zI.toOps(this.data,n).forEach((t=>{this.updateByPatchedOp(t,this.dataPatched,e)})))}n&&this.updateTransformState(this.dataPatched),this.stateSelection=t}}updateState(t,e){void 0!==t.name&&(this.name=t.name),void 0!==t.visible&&(this.visible=t.visible),this.updateTransformState(t)}updateByPatchedOpBase(t,e,n){this.dataPatched=e,this.updateByPatchedOp(t,e,n)}updateByPatchedOp(t,e,n){0===t.path.length&&0===t.type&&this.updateState(t.props,n),this.requestRender()}traverseFrameAncestors(t){this.traverseAncestors((e=>{"frame2d"===e.data.type&&t(e)}))}traverseAncestors(t){let e=this.parent;for(;e;)t(e),e=e.parent}requestRender(){this.traverseFrameAncestors((t=>{t.requestRender()}))}clone(t){let e=new tG(this.uuid,this.data,t);return e.parent=void 0,e}addEventListener(t,e){this.emitter.on(t,e)}removeEventListener(t,e){this.emitter.off(t,e)}dispatchEvent(t){this.emitter.emit(t.type,{...t,target:t.target??this})}traverseSortNextHelper(){let t=this.parent;if(t){let e=t.children;if(e){let n=e.indexOf(this)+1;return e[n]?e[n]:t.traverseSortNextHelper()}}}sortNext(){let t=this.children;return t&&t.length>0&&t[0]?t[0]:this.traverseSortNextHelper()}isDescendantOf(t){t instanceof tG&&(t=t.uuid);let e=this;for(;e.parent;){if(e.parent.uuid===t)return!0;e=e.parent}return!1}},eG=class extends tG{constructor(t,e,n){super(t,e,n),this.uuid=t,this.data=e,this.context=n,this.children=[]}add(t){t.parent&&t.parent instanceof eG&&t.parent.remove(t),this.children.push(t),t.parent=this}remove(t){let e=this.children.indexOf(t);e>=0&&(this.children.splice(e,1),t.parent=void 0)}traverse(t){let e=t(this);if(!0!==e)for(let n of this.children)n instanceof eG?n.traverse(t):e=t(n)}intersectsChildrenHelper(t,e,n,i,r){for(let s of this.children)if(s.intersects(t,e,n,!1)&&(r.push(s),i)||s instanceof eG&&s.intersectsChildrenHelper(t,e,n,i,r))return!0;return!1}intersectsChildren(t,e,n,i=!1,r=[],s=!1){return this.intersectsChildrenHelper(t,e,n,i,r),r}intersectsChildrenHelperReverse(t,e,n,i,r){for(let s of this.children)if(s instanceof eG&&s.intersectsChildrenHelperReverse(t,e,n,i,r)||s.intersects(t,e,n,!1)&&(r.push(s),i))return!0;return!1}intersectsChildrenReverse(t,e,n,i=!1,r=[],s=!1){return this.intersectsChildrenHelperReverse(t,e,n,i,r),r}updateWorldMatrix(t,e,n){if(super.updateWorldMatrix(t,e,n),n&&this.children)for(let e of this.children)e.updateWorldMatrix(t,!1,!0)}find(t){let e;return this.traverse((n=>{n.uuid===t&&(e=n)})),e}innerDrawChildren(t){for(let e=this.children.length-1;e>=0;e--)this.children[e].draw(t)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse((t=>{t.resetBBoxNeedsUpdateSelf()}))}clone(t){let e=new eG(this.uuid,this.data,t);e.parent=void 0;for(let n of this.children)e.add(n.clone(t));return e}},nG=class extends eG{constructor(t,e,n){super(t,e,n),this.uuid=t,this.data=e,this.updateState(e,n)}draw(t){!this.visible||(t.save(),this.applyTransforms(t),this.innerDrawChildren(t),t.restore())}clone(t){let e=new nG(this.uuid,this.data,t);e.parent=void 0;for(let n of this.children)e.add(n.clone(t));return e}};function iG(t,e){let[[n,i],[r,s]]=t,[[a,o],[l,c]]=e,h=(n-r)*(o-c)-(i-s)*(a-l);if(0===h)return!1;let u=((n-a)*(o-c)-(i-o)*(a-l))/h,d=-((n-r)*(i-o)-(i-s)*(n-a))/h;return u>=0&&u<=1&&d>=0&&d<=1}var rG,sG,aG,oG,lG=[[-1,1],[-1,-1],[1,-1],[1,1]],cG=(t,e,n)=>{let i=t.getCenter(),r=t.getHalfSize(),s=GH.append(e,t.worldMatrix);0===r[0]&&0===r[1]?n.push(GH.apply(i,s)):lG.forEach((t=>{let e=[t[0]*r[0]+i[0],t[1]*r[1]+i[1]];n.push(GH.apply(e,s))}))},hG=class{constructor(){this.matrix=GH.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(t,e=!1){t.updateWorldMatrix(),this.makeEmpty(),GH.copy(t.worldMatrix,this.matrix);let n=GH.invert(t.worldMatrix);this.expandByObjectSize(t,n,e)}expandByObjectSize(t,e,n=!1){let i=[];!0===n&&t instanceof eG?t.traverse((t=>{t.visible&&cG(t,e,i)})):cG(t,e,i),this.setFromPoints(i)}setFromSize(t,e,n){this.makeEmpty(),GH.copy(n,this.matrix),this.expandBySize(t,e,n)}expandBySize(t,e,n){[GH.apply([0,0],n),GH.apply([0,e],n),GH.apply([t,e],n),GH.apply([t,0],n)].forEach((t=>this.expandByPoint(t)))}getCenter(){let[t,e]=this.min,[n,i]=this.getHalfSize();return GH.apply([t+n,e+i],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[.5*(this.max[0]-this.min[0]),.5*(this.max[1]-this.min[1])]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(t){this.makeEmpty();for(let e of t)this.expandByPoint(e)}expandByPoint(t){this.min=[Math.min(this.min[0],t[0]),Math.min(this.min[1],t[1])],this.max=[Math.max(this.max[0],t[0]),Math.max(this.max[1],t[1])]}computeVertices(){let[t,e]=this.getHalfSize(),n=this.getCenter(),[i,r,s,a]=GH.getAbcdef(this.matrix),o=GH.create(i,r,s,a,n[0],n[1]);this.vertices=lG.map((([n,i])=>GH.apply([n*t,i*e],o)))}computeEdges(){this.edges=[];for(let t=0,e=this.vertices.length;t<e;++t)this.edges.push([this.vertices[t],this.vertices[(t+1)%e]])}project(t,e){let n=this.matrix;return e&&(n=GH.append(e.worldMatrix,n)),GH.applyInverse(t,n)}intersects(t,e,n){return this.intersectsInLocalSpace(...this.project([t,e],n))}intersectsInLocalSpace(t,e){let{min:n,max:i}=this;return t>=n[0]&&t<=i[0]&&e>=n[1]&&e<=i[1]}containsPoint(t){let[e,n]=t,[i,r]=this.min,[s,a]=this.max;return e>=i&&e<=s&&n>=r&&n<=a}intersectsBBox2D(t){for(let e=0,n=this.edges.length;e<n;e++){let n=this.edges[e];for(let e=0,i=t.edges.length;e<i;e++){if(iG(n,t.edges[e]))return!0}}for(let e=0,n=t.vertices.length;e<n;e++){let n=t.vertices[e];if(this.containsPoint(n))return!0}return!1}ensureMinMax(){let t=this.min,e=this.max;this.min=[Math.min(t[0],e[0]),Math.min(t[1],e[1])],this.max=[Math.max(t[0],e[0]),Math.max(t[1],e[1])]}copy(t){this.min=[...t.min],this.max=[...t.max],GH.copy(t.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let t=new hG;return t.copy(this),t}},uG=new Promise((t=>{rG=t})),dG=!1;function pG(){if(!dG)return sG||(sG=async function(){let t=await n.e(958).then(n.bind(n,"../node_modules/@splinetool/loader/build/ui.js"));rG(t.default??t),dG=!0}(),sG)}function fG(t){let e=!1;return t.scene.objects.traverse(((t,n)=>{("Mesh"===n.type&&"UIGeometry"===n.geometry.type||"Page"===n.type&&void 0!==n.uiFrame)&&(e=!0)})),e}var mG=GH.identity(),gG=class{constructor(t,e=1){this.canvas=t,this._dpr=e,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=LD.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=LD.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let n=t.getBoundingClientRect();t.width=n.width*e,t.height=n.height*e}catch{console.log(t.width,e)}this._currentM3Transform=mG,this._currentTransform=new Float32Array(mG)}get dpr(){return this._dpr}set dpr(t){this._dpr=t,this._isSizeDirty=!0}async init(){if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await async function(t){let e=await uG;aG||(oG||(oG=e({locateFile:()=>t})),aG=await oG)}(this.wasmURL),this._surface=aG.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas(),this._paint=new aG.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(aG.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(aG.PaintStyle.Stroke),this.ctx?.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(t){this._currentM3Transform=t,this._currentTransform.set(t)}async loadFont(t,e){let n=await(await fetch(t)).arrayBuffer();this.registerFont(n,e)}registerFont(t,e){if(this._fonts.has(e))return;let n=aG.FontMgr.FromData(t);if(!n)throw new Error("Invalid font data for "+e);this._fonts.set(e,n)}get width(){return this._width}get height(){return this._height}set strokeColor(t){this._paintStroke&&this._paintStroke.setColor(yG(t),aG.ColorSpace.DISPLAY_P3)}set fillColor(t){this._paintFill&&this._paintFill.setColor(yG(t),aG.ColorSpace.DISPLAY_P3)}set lineWidth(t){this._paintStroke&&this._paintStroke.setStrokeWidth("center"===this._strokeMode?t:2*t)}set strokeMode(t){this._strokeMode=t}set dropShadowBlur(t){this._dropShadowBlur=t}set dropShadowColor(t){this._dropShadowColor=t}set dropShadowOffsetX(t){this._dropShadowOffsetX=t}set dropShadowOffsetY(t){this._dropShadowOffsetY=t}set innerShadowBlur(t){this._innerShadowBlur=t}set innerShadowColor(t){this._innerShadowColor=t}set innerShadowOffsetX(t){this._innerShadowOffsetX=t}set innerShadowOffsetY(t){this._innerShadowOffsetY=t}set innerShadowSpread(t){this._innerShadowSpread=t}set layerBlur(t){this._layerBlur=t}set backgroundBlur(t){this._backgroundBlur=t}clear(){this.ctx?.clear(aG.TRANSPARENT)}save(){this.ctx?.save()}restore(){this.ctx?.restore()}beginPath(){this._currentPath?.delete(),this._currentPath=new aG.Path}closePath(){let t=this._currentPath;if(t){if(t.isEmpty())return;let e=t.getBounds();(e[3]-e[1]||e[2]-e[0])&&t.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(t,e,n,i,r=0,s=0,a=0,o=0){let l=aG.XYWHRect(t,e,n,i);if(0===r&&0===s&&0===o&&0===a)this.ctx?.clipRect(l,aG.ClipOp.Intersect,!0);else{let t=aG.RRectXY(l,r,r);t[4]=t[5]=r,t[6]=t[7]=s,t[8]=t[9]=a,t[10]=t[11]=o,this.ctx?.clipRRect(t,aG.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let t=GH.invert(this.currentTransform);this.ctx.concat(t);let e=GH.translate(GH.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(e),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(t,e,n=!0){if(this.ctx&&this._currentPath){let i,r=!1;if(n&&this._hasDropShadow()){let n,i=t.copy();i.setColor(yG(this._dropShadowColor)),this._dropShadowBlur>0&&(n=aG.MaskFilter.MakeBlur(aG.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(this.camera?.scale??1),!1),i.setMaskFilter(n)),this.ctx.save(),this.ctx.clipPath(this._currentPath,aG.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),e(i),this.ctx.restore(),i.delete(),n?.delete()}if(this._backgroundBlur>0&&n){this.ctx.save(),this.ctx.clipPath(this._currentPath,aG.ClipOp.Intersect,!0);let e=aG.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,aG.TileMode.Clamp,null),n=t.copy();n.setImageFilter(e),n.setAlphaf(1);let i=this._currentPath.computeTightBounds();this.ctx.saveLayer(n,i,null,aG.SaveLayerInitWithPrevious),this.ctx.drawColor(t.getColor()),this.ctx.restore(),this.ctx.restore(),n.delete(),e.delete(),r=!0}if(this._layerBlur>0){let n=t.copy();i=aG.MaskFilter.MakeBlur(aG.BlurStyle.Normal,this._layerBlur*this.dpr*(this.camera?.scale??1),!1),n.setMaskFilter(i),e(n),n.delete(),i.delete(),r=!0}if(r||e(t),n&&this._hasInnerShadow()){let t,e=new aG.Paint;e.setAntiAlias(!0),e.setStyle(aG.PaintStyle.Fill),e.setColor(yG(this._innerShadowColor)),this._innerShadowBlur>0&&(t=aG.MaskFilter.MakeBlur(aG.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(this.camera?.scale??1),!1),e.setMaskFilter(t));let n=this._currentPath.computeTightBounds(),[i,r,s,a]=n,o=s-i,l=a-r;this.ctx.save(),this.ctx.clipPath(this._currentPath,aG.ClipOp.Intersect,!0),this.ctx.saveLayer(e,n,null,aG.SaveLayerInitWithPrevious),this.ctx?.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(aG.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+o+Math.abs(2*this._innerShadowOffsetX),2e3+l+Math.abs(2*this._innerShadowOffsetY)),e),e.setBlendMode(aG.BlendMode.Clear),this.ctx.drawPath(this._currentPath,e),this.ctx.restore(),this.ctx.restore(),e.delete(),t?.delete()}}}_paintInner(t,e=!0){if(this.ctx&&this._currentPath&&t){let n=this.ctx,i=this._currentPath;this._applyEffectsToPaint(t,(t=>{let r=!1;!e&&"center"!==this._strokeMode&&(n.save(),n.clipPath(i,"outside"===this._strokeMode?aG.ClipOp.Difference:aG.ClipOp.Intersect,!0),r=!0),n.drawPath(i,t),r&&n.restore()}),e)}}_hasDropShadow(){return this._dropShadowColor?.a>0}_hasInnerShadow(){return this._innerShadowColor?.a>0}path(t){this._currentPath?.addPath(aG.Path.MakeFromSVGString(t))}ellipse(t,e,n,i,r,s,a,o){if(!vG([t,e,n,i])||!this._currentPath)return;if(n<0||i<0)throw Error("radii cannot be negative");let l=aG.XYWHRect(t-n,e-i,2*n,2*i);this._currentPath?.addOval(l)}rect(t,e,n,i,r=0,s=0,a=0,o=0){let l=aG.XYWHRect(t,e,n,i);if(vG(l))if(0===r&&0===s&&0===o&&0===a)this._currentPath?.addRect(l);else{let t=aG.RRectXY(l,r,r);t[4]=t[5]=r,t[6]=t[7]=s,t[8]=t[9]=a,t[10]=t[11]=o,this._currentPath?.addRRect(t)}}getHorizontalAlign(t){switch(t){case 2:return aG.TextAlign.Right;case 3:return aG.TextAlign.Center;case 4:return aG.TextAlign.Justify;default:return aG.TextAlign.Left}}drawTextInner(t,e,n,[i,r,s,a],o,l,c=!0){let h=0,{ctx:u}=this;if(!u)return h;let d=l.copy(),p=l.copy();return p.setAlphaf(0),this._applyEffectsToPaint(d,(l=>{e.pushPaintStyle(n,l,p),e.addText(t);let c=e.build();c.layout(s);let d=r;2===o?d+=(a-c.getHeight())/2:3===o&&(d+=a-c.getHeight()),u.drawParagraph(c,i,d),h=c.getHeight(),e.reset(),c.delete()}),c),d.delete(),p.delete(),h}drawText(t,e){let n=0,i=this._fonts.get(e.font),{ctx:r,_paintFill:s,_paintStroke:a}=this;if(i&&r){let r=new aG.TextStyle({fontFamilies:[e.font],fontSize:e.fontSize,heightMultiplier:e.lineHeight,letterSpacing:e.letterSpacing}),o=new aG.ParagraphStyle({textStyle:r,textAlign:this.getHorizontalAlign(e.horizontalAlign)}),l=aG.XYWHRect(e.x,e.y,e.width,e.height),c=aG.ParagraphBuilder.Make(o,i);s&&(n=this.drawTextInner(t,c,r,l,e.verticalAlign,s,!0)),a&&(n=this.drawTextInner(t,c,r,l,e.verticalAlign,a,!1)),c.delete()}return{height:n}}render(){this._surface?.flush()}moveTo(t,e){this._currentPath?.moveTo(t,e)}lineTo(t,e){this._currentPath?.lineTo(t,e)}bezierCurveTo(t,e,n,i,r,s){this._currentPath?.cubicTo(t,e,n,i,r,s)}quadraticCurveTo(t,e,n,i){this._currentPath?.quadTo(t,e,n,i)}setTransform(t,e=!1){if(!this.ctx)return;let n=this.ctx.getTotalMatrix(),i=GH.invert(n);if(i&&this.ctx.concat(i),this.ctx?.scale(this.dpr,this.dpr),this.camera?.enabled&&(this.ctx?.concat(this.camera.worldMatrix),e)){let t=GH.getScale(this.camera.worldMatrix);this.ctx?.scale(1/t[0],1/t[1])}this.ctx?.concat(t),this.currentTransform=t}transform(t){this.ctx?.concat(t)}setSize(t,e){!this._isSizeDirty&&t===this._width&&e===this._height||(this._isSizeDirty=!1,this._width=t,this._height=e,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.canvas.width=t*this.dpr,this.canvas.height=e*this.dpr,this._surface&&(this._surface=aG.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas()))}};function vG(t){for(let e=0;e<t.length;e++)if(void 0!==t[e]&&!Number.isFinite(t[e]))return!1;return!0}function yG({r:t,g:e,b:n,a:i}){return aG.Color4f(t,e,n,i)}var xG,bG,_G,wG=class{constructor(t,e,n){this.uuid=t,this.data=e,this.enabled=!1,this.color=LD.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(e)}update(t){void 0!==t.color&&(this.color=t.color),void 0!==t.enabled&&(this.enabled=t.enabled),void 0!==t.blurRadius&&(this.blurRadius=t.blurRadius),void 0!==t.offset&&(this.offset=t.offset),void 0!==t.spread&&(this.spread=t.spread)}},SG=class{constructor(t,e,n){this.uuid=t,this.data=e,this.enabled=!1,this.radius=0,this.update(e)}update(t){void 0!==t.enabled&&(this.enabled=t.enabled),void 0!==t.radius&&(this.radius=t.radius)}},MG=class{constructor(t,e,n){this.uuid=t,this.data=e,this.enabled=!1,this.color=LD.transparent,this.update(e)}update(t){void 0!==t.enabled&&(this.enabled=t.enabled),void 0!==t.color&&(this.color=t.color)}},TG=class{constructor(t,e,n){this.uuid=t,this.data=e,this.enabled=!1,this.color=LD.transparent,this.thickness=0,this.mode="inside",this.update(e)}update(t){void 0!==t.enabled&&(this.enabled=t.enabled),void 0!==t.color&&(this.color=t.color),void 0!==t.thickness&&(this.thickness=t.thickness),void 0!==t.mode&&(this.mode=t.mode)}},EG=class extends tG{constructor(t,e,n){super(t,e,n),this.uuid=t,this.data=e,this.autoClose=!0,this.fill=new MG(t+"-fill",e.fill,n),this.stroke=new TG(t+"-stroke",e.stroke,n),this.dropShadow=new wG(t+"-dropShadow",e.dropShadow,n),this.innerShadow=new wG(t+"-innerShadow",e.innerShadow,n),this.backgroundBlur=new SG(t+"-backgroundBlur",e.backgroundBlur,n),this.layerBlur=new SG(t+"-layerBlur",e.layerBlur,n)}applyFillStroke(t){t.fillColor=this.fill.enabled?this.fill.color:LD.transparent,t.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:LD.transparent,t.strokeMode=this.stroke.mode,t.lineWidth=this.stroke.thickness}applyFilters(t){this.layerBlur.enabled?t.layerBlur=5*this.layerBlur.radius:t.layerBlur=0,this.backgroundBlur.enabled?t.backgroundBlur=5*this.backgroundBlur.radius:t.backgroundBlur=0,this.dropShadow.enabled?(t.dropShadowBlur=5*this.dropShadow.blurRadius,t.dropShadowColor=this.dropShadow.color,t.dropShadowOffsetX=this.dropShadow.offset[0],t.dropShadowOffsetY=this.dropShadow.offset[1]):t.dropShadowColor=LD.transparent,this.innerShadow.enabled?(t.innerShadowSpread=this.innerShadow.spread,t.innerShadowBlur=5*this.innerShadow.blurRadius,t.innerShadowColor=this.innerShadow.color,t.innerShadowOffsetX=this.innerShadow.offset[0],t.innerShadowOffsetY=this.innerShadow.offset[1]):t.innerShadowColor=LD.transparent}innerDraw(t){}draw(t){!this.visible||(t.save(),this.applyTransforms(t),this.applyFilters(t),this.applyFillStroke(t),t.beginPath(),this.innerDraw(t),this.autoClose&&t.closePath(),this.fill.enabled&&t.fill(),this.stroke.enabled&&t.stroke(),t.restore())}updateByPatchedOp(t,e,n){super.updateByPatchedOp(t,e,n),0===t.type&&($R(t.path,["fill"])?this.fill.update(t.props):$R(t.path,["stroke"])?this.stroke.update(t.props):$R(t.path,["dropShadow"])?this.dropShadow.update(t.props):$R(t.path,["innerShadow"])?this.innerShadow.update(t.props):$R(t.path,["layerBlur"])?this.layerBlur.update(t.props):$R(t.path,["backgroundBlur"])?this.backgroundBlur.update(t.props):this.resetBBoxNeedsUpdate())}updateState(t,e){super.updateState(t,e),void 0!==t.fill&&this.fill.update(t.fill),void 0!==t.stroke&&this.stroke.update(t.stroke),void 0!==t.dropShadow&&this.dropShadow.update(t.dropShadow),void 0!==t.innerShadow&&this.innerShadow.update(t.innerShadow),void 0!==t.layerBlur&&this.layerBlur.update(t.layerBlur),void 0!==t.backgroundBlur&&this.backgroundBlur.update(t.backgroundBlur)}clone(t){let e=new EG(this.uuid,this.data,t);return e.parent=void 0,e}},AG=class extends EG{constructor(t,e,n){super(t,e,n),this.uuid=t,this.data=e,this.width=0,this.height=0,this.updateState(e,n)}innerDraw(t){t.ellipse(.5*this.width,.5*this.height,.5*this.width,.5*this.height,0,0,2*Math.PI)}intersectsInLocalSpace(t,e){return function(t,e,n,i,r,s){let a=t-n,o=e-i;return a*a/(r*r)+o*o/(s*s)<=1}(t,e,.5*this.width,.5*this.height,.5*this.width,.5*this.height)}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateSizeState(t){let e=!1;void 0!==t.width&&(this.width="number"==typeof t.width?t.width:this.width,e=!0),void 0!==t.height&&(this.height="number"==typeof t.height?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateState(t,e){super.updateState(t,e),this.updateSizeState(t)}clone(t){let e=new AG(this.uuid,this.data,t);return e.parent=void 0,e}},CG=class extends EG{constructor(t,e,n){super(t,e,n),this.uuid=t,this.data=e,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(e,n)}innerDraw(t){t.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateCornerState(t){void 0!==t.cornerRadius&&(this.cornerRadius=t.cornerRadius)}updateSizeState(t){let e=!1;void 0!==t.width&&(this.width="number"==typeof t.width?t.width:this.width,e=!0),void 0!==t.height&&(this.height="number"==typeof t.height?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateState(t,e){super.updateState(t,e),this.updateSizeState(t),this.updateCornerState(t)}clone(t){let e=new CG(this.uuid,this.data,t);return e.parent=void 0,e}},PG=class extends EG{constructor(t,e,n){super(t,e,n),this.uuid=t,this.data=e,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(e,n)}get textHeight(){return this._textHeight}applyFillStroke(t){t.fillColor=this.fill.enabled?this.fill.color:LD.transparent,t.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:LD.transparent,t.strokeMode="center",t.lineWidth=this.stroke.thickness}innerDraw(t){this._fontHolder?.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&t.registerFont(this._fontHolder.arrayBuffer,this.data.font);let e=this.data.textTransform,n=this.data.text.textValue.toString(),i=2===e?n.toUpperCase():3===e?n.toLowerCase():n,{height:r}=t.drawText(i,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=r}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateSizeState(t){let e=!1;void 0!==t.width&&(this.width="number"==typeof t.width?t.width:this.width,e=!0),void 0!==t.height&&(this.height="number"==typeof t.height?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(t,{shared:e}){void 0!==t.font&&(this._fontHolder=e.getFont(t.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then((()=>{this.requestRender()})))}updateState(t,e){super.updateState(t,e),this.updateSizeState(t),this.updateFontState(t,e)}clone(t){let e=new PG(this.uuid,this.data,t);return e.parent=void 0,e}},RG=class extends EG{constructor(t,e,n){super(t,e,n),this.uuid=t,this.data=e,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(e,n)}computeExtremas(){0===this.curves.length&&this.computeCurves();let t=this.curves.map((t=>xG.extremas(t))),e=[1/0,1/0],n=[-1/0,-1/0];for(let i=0,r=t.length;i<r;i++){let r=t[i];r[0][0]<e[0]&&(e[0]=r[0][0]),r[0][1]<e[1]&&(e[1]=r[0][1]),r[1][0]>n[0]&&(n[0]=r[1][0]),r[1][1]>n[1]&&(n[1]=r[1][1])}return this.extremasBBox.min=[e[0],e[1]],this.extremasBBox.max=[n[0],n[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let t=1,e=this.data.points.length;t<e;t++){let e=this.data.points[t].data,n=this.data.points[t-1].data,i={start:n.position,cp1:n.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(i)}let t=this.data.points[0].data,e=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let n={start:e.position,cp1:e.controlNext.position,cp2:t.controlPrevious.position,end:t.position};this.curves.push(n)}}getCenter(){let[t,e]=this.extremasBBox.min,[n,i]=this.getHalfSize();return[t+n,e+i]}getHalfSize(){let{min:t,max:e}=this.extremasBBox;return[.5*(e[0]-t[0]),.5*(e[1]-t[1])]}innerDraw(t){for(let e=0,n=this.data.points.length;e<n;e++){let n=this.data.points[e].data;if(0===e){let[e,i]=n.position;t.moveTo(e,i)}else{let i=this.data.points[e-1].data,[r,s]=i.controlNext.position,[a,o]=n.controlPrevious.position,[l,c]=n.position,h={start:i.position,cp1:i.controlNext.position,cp2:n.controlPrevious.position,end:n.position};xG.derive(h),t.bezierCurveTo(r,s,a,o,l,c)}}let e=this.data.points[0].data,n=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[i,r]=n.controlNext.position,[s,a]=e.controlPrevious.position,[o,l]=e.position;t.bezierCurveTo(i,r,s,a,o,l)}}updateState(t,e){super.updateState(t,e),this.computeExtremas()}clone(t){let e=new RG(this.uuid,this.data,t);return e.parent=void 0,e}};(t=>{function e(t,e,n,i=!1){let r=t-2*e+n;if(0!==r){let i=-Math.sqrt(Math.abs(e*e-t*n)),s=-t+e;return[-(i+s)/r,-(-i+s)/r]}return e!==n&&0===r?[(2*e-n)/(2*(e-n))]:[]}t.derive=function(t){let e=t.start,n=t.cp1,i=t.cp2,r=t.end,s={start:[3*(n[0]-e[0]),3*(n[1]-e[1])],cp:[3*(i[0]-n[0]),3*(i[1]-n[1])],end:[3*(r[0]-i[0]),3*(r[1]-i[1])]};return t.derivative=s,s.derivative=bG.derive(s),s},t.droot=function(n){let i=n.derivative??t.derive(n),r=i.start,s=i.cp,a=i.end;return[e(r[0],s[0],a[0]),e(r[1],s[1],a[1])]},t.extremas=function(e){let[n,i]=t.droot(e),r=[e.start[0],e.end[0]],s=[e.start[1],e.end[1]];for(let i of n)r.push(t.compute(e,Math.min(1,Math.max(0,i)))[0]);for(let n of i)s.push(t.compute(e,Math.min(1,Math.max(0,n)))[1]);return r.sort(((t,e)=>t-e)),s.sort(((t,e)=>t-e)),[[r[0],s[0]],[r[r.length-1],s[s.length-1]]]},t.compute=function(t,e){if(0===e)return[...t.start];if(1===e)return[...t.end];let n=1-e,i=n*n,r=e*e,s=i*n,a=i*e*3,o=n*r*3,l=e*r;return[s*t.start[0]+a*t.cp1[0]+o*t.cp2[0]+l*t.end[0],s*t.start[1]+a*t.cp1[1]+o*t.cp2[1]+l*t.end[1]]}})(xG||(xG={})),(t=>{t.derive=function(t){let e=t.start,n=t.cp,i=t.end,r={start:[2*(n[0]-e[0]),2*(n[1]-e[1])],end:[2*(i[0]-n[0]),2*(i[1]-n[1])]};return r.derivative=_G.derive(r),t.derivative=r,r},t.droot=function(e){let n=e.derivative??t.derive(e),i=n.start,r=n.end;return[i[0]!==r[0]?i[0]/(i[0]-r[0]):0,i[1]!==r[1]?i[1]/(i[1]-r[1]):0]},t.compute=function(t,e){if(0===e)return[...t.start];if(1===e)return[...t.end];let n=1-e,i=n*n,r=n*e*2,s=e*e;return[i*t.start[0]+r*t.cp[0]+s*t.end[0],i*t.start[1]+r*t.cp[1]+s*t.end[1]]}})(bG||(bG={})),(t=>{t.derive=function(t){let e=t.start,n=t.end,i=[n[0]-e[0],n[1]-e[1]];return t.derivative=i,t.derivative},t.compute=function(t,e){if(0===e)return[...t.start];if(1===e)return[...t.end];let n=t.start,i=t.end;return[n[0]+(i[0]-n[0])*e,n[1]+(i[1]-n[1])*e]}})(_G||(_G={}));var OG=class extends eG{constructor(t,e,n){super(t,e,n),this.uuid=t,this.width=0,this.height=0,this.clipped=!0,this.background=new CG(t+"-background",FI.defaultData,n),this.background.parent=this,this.updateState(e,n)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(t){this.background.cornerRadius=t}updateLocalMatrix(){super.updateLocalMatrix(),this.background?.updateLocalMatrix()}updateWorldMatrix(t,e,n){super.updateWorldMatrix(t,e,n),this.background?.updateWorldMatrix(t,e,n)}draw(t){if(!this.visible)return;t.save();let e=this.width,n=this.height;this.applyTransforms(t),this.background.width=e,this.background.height=n,this.background.draw(t),this.clipped&&t.clipRect(0,0,e,n,...this.cornerRadius),this.innerDrawChildren(t),t.restore()}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateCornerState(t){void 0!==t.cornerRadius&&(this.cornerRadius=t.cornerRadius)}updateSizeState(t){let e=!1;void 0!==t.width&&(this.width="number"==typeof t.width?t.width:this.width,e=!0),void 0!==t.height&&(this.height="number"==typeof t.height?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateState(t,e){super.updateState(t,e),this.updateSizeState(t),this.updateCornerState(t),void 0!==t.fill&&this.fill.update(t.fill),void 0!==t.stroke&&this.stroke.update(t.stroke),void 0!==t.dropShadow&&this.dropShadow.update(t.dropShadow),void 0!==t.innerShadow&&this.innerShadow.update(t.innerShadow),void 0!==t.layerBlur&&this.layerBlur.update(t.layerBlur),void 0!==t.backgroundBlur&&this.backgroundBlur.update(t.backgroundBlur),void 0!==t.clipped&&(this.clipped=t.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(t,e,n){super.updateByPatchedOp(t,e,n),0===t.type&&($R(t.path,["fill"])?this.fill.update(t.props):$R(t.path,["stroke"])?this.stroke.update(t.props):$R(t.path,["dropShadow"])?this.dropShadow.update(t.props):$R(t.path,["innerShadow"])?this.innerShadow.update(t.props):$R(t.path,["layerBlur"])?this.layerBlur.update(t.props):$R(t.path,["backgroundBlur"])?this.backgroundBlur.update(t.props):this.resetBBoxNeedsUpdate())}clone(t){let e=new OG(this.uuid,this.data,t);e.parent=void 0;for(let n of this.children)e.add(n.clone(t));return e}},DG=XM(JM(),1),LG=class extends EG{constructor(t,e,n){super(t,e,n),this.uuid=t,this.data=e,this._pathBBox=new DOMRect,this.path="",this.updateState(e,n),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(t),e.setAttribute("d",this.path),t.appendChild(e),this._pathBBox=e.getBBox(),t.remove()}innerDraw(t){t.path(this.path)}intersectsInLocalSpace(t,e){return t>=this._pathBBox.x&&t<=this._pathBBox.x+this._pathBBox.width&&e>=this._pathBBox.y&&e<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(t,e){super.updateState(t,e),void 0!==t.path&&(this.path=t.path,this.computeSVGBBox())}clone(t){let e=new LG(this.uuid,this.data,t);return e.parent=void 0,e}};var IG=class{constructor(t,e,n){this.uuid=t,this.data=e,this.group=new nG(IG.GROUP_ID,{...GI.defaultData},n),this.createChildrenObjects(e.objects,this.group,n)}createObject(t,e,n,i,r,s){let a=function(t,e,n){switch(e.type){case"ellipse2d":return new AG(t,e,n);case"rectangle2d":return new CG(t,e,n);case"text2d":return new PG(t,e,n);case"vector2d":return new RG(t,e,n);case"path2d":return new LG(t,e,n);case"frame2d":return new OG(t,e,n);default:return new nG(t,e,n)}}(t,e,s);a&&(i.add(a),i.children.splice(r,0,i.children.pop()),a.updateWorldMatrix(),n.length>0&&(a instanceof nG||a instanceof OG)&&this.createChildrenObjects(n,a,s))}createChildrenObjects(t,e,n){let i=0;for(let r of t)this.createObject(r.id,r.data,r.children,e,i,n),i+=1}draw(t){this.group.draw(t)}updateEntityByOp(t,e,n,i){let r=this.find(t);if(r)try{r.updateByOp(e,n,{shared:i})}catch(t){console.error(t)}}updateTreeByOp(t,e){if(0===t.path.length&&7===t.type){let n=null===t.parent?this.group:this.find(t.parent);void 0!==n&&n instanceof eG&&(this.createObject(t.id,t.data,t.children,n,t.localIndex,e),n.requestRender())}else if(0===t.path.length&&8===t.type){let e=this.find(t.id);if(void 0!==e&&void 0!==e.parent&&e.parent instanceof eG){let t=e.parent;e.resetBBoxNeedsUpdate(),t?.remove(e),t?.requestRender()}}else if(0===t.path.length&&9===t.type){let e=this.find(t.id);if(void 0!==e){let n=e.parent,i=null===t.parent?this:this.find(t.parent);if(i instanceof eG||i===this){i.add(e);let r=t.localIndex;i.children.splice(r,0,i.children.pop()),e.updateWorldMatrix(!0,!1,!0),n?.requestRender(),e.requestRender()}e.resetBBoxNeedsUpdate()}}}add(t){this.group.add(t)}remove(t){this.group.remove(t)}traverse(t){this.group.traverse((e=>{e!==this.group&&t(e)}))}intersectsChildren(t,e,n,i=!1,r=[]){return this.group.intersectsChildren(t,e,n,i,r,!0)}intersectsChildrenReverse(t,e,n,i=!1,r=[]){return this.group.intersectsChildrenReverse(t,e,n,i,r,!0)}find(t){return this.group.find(t)}get children(){return this.group.children}project(t,e){return this.group.project(t,e)}getWithSortKey(t){let e=this.find(t);if(void 0===e)return;let n=[],i=e;for(;i!==this.group;){let t=i;i=i.parent;let e=i.children.indexOf(t);n.splice(0,0,e)}return{entity:e,sortKey:n}}getAllSorted(t){let e=[];for(let n of t){let t=this.getWithSortKey(n.id);void 0!==t&&e.push(t)}return e.sort(((t,e)=>iT(t.sortKey,e.sortKey))),e.map((t=>t.entity))}},zG=IG;function NG({constraints:t,newParentWidth:e,newParentHeight:n,initialParentWidth:i,initialParentHeight:r,objectInitialWidth:s,objectInitialHeight:a,objectInitialPosition:o}){let{horizontalConstraint:l,verticalConstraint:c}=t,h=e-i,u=n-r,d=s,p=a,f=o[0],m=o[1];if(0!==l)if(1===l)f+=h;else if(3===l)f+=h/2;else if(2===l)d=Math.max(1,d+h);else if(4===l){let t=e/i;d*=t,f*=t}if(0!==c)if(1===c)m+=u;else if(3===c)m+=u/2;else if(2===c)p=Math.max(1,p+u);else if(4===c){let t=n/r;p*=t,m*=t}return{width:d,height:p,position:[f,m]}}zG.GROUP_ID="scene2d";XM(JM(),1);var UG=new By(-1,1,1,-1,0,1),kG=new class extends Nv{constructor(){super(),this.setAttribute("position",new Cv([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Cv([0,2,0,0,2,0],2))}},BG=new oy({defines:{},uniforms:{tDiffuse:new $S(null)},vertexShader:"\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvUv = uv;\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t}",fragmentShader:"\n\tuniform sampler2D tDiffuse;\n\tvarying vec2 vUv;\n\tvoid main() {\n\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\tgl_FragColor = texel;\n\t}"}),FG=new class{constructor(t){this._mesh=new ty(kG,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,UG)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}(BG),VG=null,jG=null,HG=GH.identity(),GG=class{constructor(t,e,n,i){this.uuid=t,this.width=e,this.height=n,this.context=i,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let t=this.width,e=this.height,n=this.dpr;this.renderer.dpr=this.isScreenSpace?n:Math.floor(2048/Math.max(t,e)),this.renderer.setSize(t,e)},this.onFrameOverrideObjectEvent=t=>{if(void 0!==t.target?.uuid){let e=this.frameRoot?.find(t.target.uuid);e&&e.dispatchEvent({...t,target:e})}},this.scene2d=new zG(vm.generateUUID(),XI.defaultData,{dpr:window.devicePixelRatio,shared:i.shared}),this.canvas=(null===VG&&(VG=document.createElement("canvas")),VG),this.renderer=(t=>(null===jG&&(jG=new gG(t)),jG))(this.canvas),this.promise=this.init(),this.renderTarget=new Gm(1,1,{type:zp,stencilBuffer:!1,depthBuffer:!1}),i.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=i.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new q_(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof gG&&(this.renderer.wasmURL=PF),await this.renderer.init()}render(t){if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),this.frameOverride?.draw(this.renderer),this.renderer.render(),BG.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let e=t.getRenderTarget();t.setRenderTarget(this.renderTarget),t.clear(),FG.render(t),t.setRenderTarget(e),this.textureHolder?.setNeedsUpdate(!0)}}updateEntity2DByOp(t,e,n,i){this.scene2d.updateEntityByOp(t,e,n,i),this.applySize()}updateTreeByOp(t,e){this.scene2d.updateTreeByOp(t,e),this.applySize()}applyOverrides(t){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let e=t?.width??this.width,n=t?.height??this.height;this.frameOverride.width=e,this.frameOverride.height=n,this.frameOverride.localMatrix=HG,this.isScreenSpace&&(this.frameOverride.fill.color=LD.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:e,height:n},WG({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(t,e=window.devicePixelRatio){let n=Math.max(1,t?.width??this.width),i=Math.max(1,t?.height??this.height);this.dpr=e,this.width=n,this.height=i,this._innerApplySize();let r=1;(n*e<512||i*e<512)&&(r=Math.max(512/(n*e),512/(i*e))),this.renderTarget.setSize(n*e*r,i*e*r),this._canvasTexture?.dispose(),this._canvasTexture=void 0,this.applyOverrides(t),this.frameOverride?.requestRender()}applyFrame(t){let e=this.context.scene.find2D(t);if(e&&e instanceof OG)return this.disposeFrameOverride(),this.frameRoot=e,this.frameOverride=e.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),this.frame?.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse((t=>{t.addEventListener("beginState",this.onFrameOverrideObjectEvent)})),this.frameOverride.traverse((t=>{t.addEventListener("completeState",this.onFrameOverrideObjectEvent)})),this.frame?.requestRender(),e}get frame(){return this.frameOverride}get frameId(){return this.frame?.uuid}find(t){return this.scene2d.find(t)}get texture(){return this.textureHolder?.getTexture(1001)}disposeFrameOverride(){this.frameOverride?.removeEventListener("render",this.onRenderRequestedDownstream),this.frameOverride?.traverse((t=>{t.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)})),this.frameOverride?.traverse((t=>{t.removeEventListener("completeState",this.onFrameOverrideObjectEvent)})),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function WG({objectOverride:t,objectRoot:e,newParentWidth:n,newParentHeight:i,initialParentWidth:r,initialParentHeight:s}){if(t instanceof OG&&e instanceof OG||t instanceof nG&&e instanceof nG)for(let a=0,o=t.children.length;a<o;a++){let o=t.children[a],l=e.children[a];o&&l&&o.uuid===l.uuid&&qG({objectOverride:o,objectRoot:l,newParentWidth:n,newParentHeight:i,initialParentWidth:r,initialParentHeight:s})}}function qG({objectOverride:t,objectRoot:e,newParentWidth:n,newParentHeight:i,initialParentWidth:r,initialParentHeight:s}){let[a,o]=function(t){if($G(t))return[t.width,t.height];if(t instanceof LG){let[e,n]=t.getHalfSize();return[2*e,2*n]}if(t instanceof nG){let[e,n]=t.recursiveBBox.getHalfSize();return[2*e,2*n]}return[0,0]}(e),{width:l,height:c,position:h}=NG({constraints:t.data,newParentWidth:n,newParentHeight:i,initialParentWidth:r,initialParentHeight:s,objectInitialWidth:a,objectInitialHeight:o,objectInitialPosition:e.position});if(t.position=h,t.data={...t.data,position:h},t.states)for(let a in t.states)XG({stateId:a,objectOverride:t,objectRoot:e,newParentWidth:n,newParentHeight:i,initialParentWidth:r,initialParentHeight:s});if($G(t)||t instanceof nG)$G(t)&&(t.width=l,t.height=c,t.data={...t.data,width:l,height:c}),WG({objectOverride:t,objectRoot:e,newParentWidth:l,newParentHeight:c,initialParentWidth:a,initialParentHeight:o});else if(t instanceof LG){let n=e,i=0!==a?l/a:1,r=0!==o?c/o:1;t.path=function(t,e=1,n=1){if(e<=0||n<=0)return t;let i=(0,DG.parseSVG)(t).map((t=>{let i={...t};return"x"in i&&(i.x=i.x*e),"y"in i&&(i.y=i.y*n),"x1"in i&&(i.x1=i.x1*e),"x2"in i&&(i.x2=i.x2*e),"y1"in i&&(i.y1=i.y1*n),"y2"in i&&(i.y2=i.y2*n),"rx"in i&&(i.rx=i.rx*e),"ry"in i&&(i.ry=i.ry*n),i}));return function(t){let e,n=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"];return t.map((t=>{let i=[];n.forEach((e=>{if(e in t){let n=1*t[e];i.length&&n>=0&&i.push(","),i.push(n)}}));let r=(e===t.code?i[0]<0?"":",":t.code)+i.join("");return e=t.code,r})).join("")}(i)}(n.path,i,r),t.data={...t.data,path:t.path}}}function XG({stateId:t,objectOverride:e,objectRoot:n,newParentWidth:i,newParentHeight:r,initialParentWidth:s,initialParentHeight:a}){let o=e.states?.[t],l=n.states?.[t];if(o&&l){let{width:n,height:c,position:h}=NG({constraints:e.data,newParentWidth:i,newParentHeight:r,initialParentWidth:s,initialParentHeight:a,objectInitialWidth:qI.isResizeable(l)?l.width:0,objectInitialHeight:qI.isResizeable(l)?l.height:0,objectInitialPosition:l.position});Object.assign(e.states[t],{position:h}),qI.isResizeable(o)&&Object.assign(e.states[t],{width:n,height:c})}}function $G(t){return t instanceof CG||t instanceof OG||t instanceof AG||t instanceof PG}var YG=class extends(Uz(f_)){constructor(t,e,n){super(),this.data=e,this.bgColor=new nB(1,1,1,1),this.fog=null,this.backupFog=new p_(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new pv,this.penumbraSizeArrayCache=null,this.super_Entity(t,e),this.personalCamera=new wH(HD,{...kL.defaultData,...e.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new TS(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),e.uiScene?this.uiScene=new zG((Array.isArray(t)?t[0]:t)+"-ui",e.uiScene,{dpr:window.devicePixelRatio,shared:n.shared}):e.uiFrame&&this.createUICanvas(e.uiFrame,n)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){return this.uiCanvas?.frame}createUICanvas(t,e){this.uiCanvas=new GG(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,e),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then((()=>{this.uiCanvas?.applyFrame(t),this.uiCanvas?.applySize()}))}updateVisible(){}setBackgroundColor(t){this.bgColor=t,!0===this.fogUseBGColor&&(this.backupFog.color=t)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(t,e){void 0!==t.color&&(this.ambientLight.color=jF(t.color,e)),void 0!==t.intensity&&(this.ambientLight.intensity=t.intensity),void 0!==t.enabled&&(t.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(t){this.isActive=!0,t.fog=this.fog,this.traverseEntity((t=>{t instanceof TH&&t.recomputeBoolean()})),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity((t=>{if(t instanceof oj)if(Array.isArray(t.material))for(let e of t.material)e.needsUpdate=!0;else t.material.needsUpdate=!0,t.material.dispose()}))}updateShadow(t){void 0!==t.softShadowQuality&&this.isActive&&((t="medium")=>{if(BH===t)return!1;BH=t;let e=(t=>{switch(t){case"low":return 8;case"medium":default:return 16;case"high":return 32}})(t);Ay.shadowmap_pars_fragment=(t=>`\n\n// PCSS implementation based on:\n// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/\n// NOTE: This number affects how big the shadow blur can\n// possibly get. Bigger number == bigger blur, but less precise results\n\nconst float  gPenumbraFilterSize = 80.0;\nconst int   gPenumbraSamples = ${t};\nconst int gShadowSamples = ${t};\nconst float gShadowSamplesRpc = 1.0f / float(gShadowSamples);\n\n#ifdef USE_SHADOWMAP\n    #if NUM_DIR_LIGHT_SHADOWS > 0\n\n        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n        struct DirectionalLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_SPOT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n        struct SpotLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_POINT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n        struct PointLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n            float shadowCameraNear;\n            float shadowCameraFar;\n        };\n\n        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n    #endif\n\n    /*\n    #if NUM_RECT_AREA_LIGHTS > 0\n\n        // TODO (abelnation): create uniforms for area light shadows\n\n    #endif\n    */\n\nfloat computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)\n{\n    float penumbra = 1.0;\n    float blockerDepthAvg = 0.0;\n    float blockerCount = 0.0;\n\n    #pragma unroll_loop_start\n    for(int i = 0; i < gPenumbraSamples; i ++)\n    {\n        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;\n        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );\n\n        if(depth < compare + 0.0001)\n        {\n            blockerDepthAvg += depth;\n            blockerCount++;\n        }\n    }\n    #pragma unroll_loop_end\n\n    if (blockerCount > 0.0)\n    {\n        blockerDepthAvg /= blockerCount;\n\n        // Compute penumbra\n        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);\n        penumbra *= penumbra;\n        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows\n\n        return clamp(penumbra, 0.00, 1.0);\n    }\n    return 0.0;\n}\n\nfloat vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)\n{\n    float shadow         = 0.0f;\n\n    // NOTE: When using TAA, we should use screen space interleaved gradient noise\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);\n    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);\n    if (penumbra == -1.0) {\n        return 1.0;\n    }\n\n    #pragma unroll_loop_start\n    for (int i = 0; i < gShadowSamples; i++)\n    {\n        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n        // Overall blurring offset\n        vec2 offset = vogelSample * (shadowRadius * 2.);\n\n        // Penumbra offset\n        offset += vogelSample * (penumbra * texelScalar);\n\n        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );\n    }\n    #pragma unroll_loop_end\n\n    return shadow * gShadowSamplesRpc;\n}\n\n\n    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n    }\n\n    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n        return unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n    }\n\n    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n        float occlusion = 1.0;\n\n        vec2 distribution = texture2DDistribution( shadow, uv );\n\n        float hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n        if (hard_shadow != 1.0 ) {\n\n            float distance = compare - distribution.x ;\n            float variance = max( 0.00000, distribution.y * distribution.y );\n            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n        }\n        return occlusion;\n\n    }\n\n    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n        float shadow = 1.0;\n\n        shadowCoord.xyz /= shadowCoord.w;\n        shadowCoord.z += shadowBias;\n\n        // if ( something && something ) breaks ATI OpenGL shader compiler\n        // if ( all( something, something ) ) using this instead\n\n        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n        bool inFrustum = all( inFrustumVec );\n\n        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n        bool frustumTest = all( frustumTestVec );\n\n        if ( frustumTest ) {\n\n        #if defined( SHADOWMAP_TYPE_PCF )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            float dx = texelSize.x;\n            float dy = texelSize.y;\n\n            vec2 uv = shadowCoord.xy;\n            vec2 f = fract( uv * shadowMapSize + 0.5 );\n            uv -= f * texelSize;\n\n            shadow = (\n                texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n                          f.x ),\n                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n                          f.x ),\n                     f.y )\n            ) * ( 1.0 / 9.0 );\n\n        #elif defined( SHADOWMAP_TYPE_VSM )\n\n            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #else // no percentage-closer filtering:\n\n            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #endif\n\n        }\n\n        return shadow;\n\n    }\n\n    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n    // vector suitable for 2D texture mapping. This code uses the following layout for the\n    // 2D texture:\n    //\n    // xzXZ\n    //  y Y\n    //\n    // Y - Positive y direction\n    // y - Negative y direction\n    // X - Positive x direction\n    // x - Negative x direction\n    // Z - Positive z direction\n    // z - Negative z direction\n    //\n    // Source and test bed:\n    // https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n    vec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n        // Number of texels to avoid at the edge of each square\n\n        vec3 absV = abs( v );\n\n        // Intersect unit cube\n\n        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n        absV *= scaleToCube;\n\n        // Apply scale to avoid seams\n\n        // two texels less per square (one texel will do for NEAREST)\n        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n        // Unwrap\n\n        // space: -1 ... 1 range for each square\n        //\n        // #X##         dim    := ( 4 , 2 )\n        //  # #         center := ( 1 , 1 )\n\n        vec2 planar = v.xy;\n\n        float almostATexel = 1.5 * texelSizeY;\n        float almostOne = 1.0 - almostATexel;\n\n        if ( absV.z >= almostOne ) {\n\n            if ( v.z > 0.0 )\n                planar.x = 4.0 - v.x;\n\n        } else if ( absV.x >= almostOne ) {\n\n            float signX = sign( v.x );\n            planar.x = v.z * signX + 2.0 * signX;\n\n        } else if ( absV.y >= almostOne ) {\n\n            float signY = sign( v.y );\n            planar.x = v.x + 2.0 * signY + 2.0;\n            planar.y = v.z * signY - 2.0;\n\n        }\n\n        // Transform to UV space\n\n        // scale := 0.5 / dim\n        // translate := ( center + 0.5 ) / dim\n        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n    }\n\n    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n        float shadow = 1.0;\n        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n        // for point lights, the uniform @vShadowCoord is re-purposed to hold\n        // the vector from the light to the world-space position of the fragment.\n        vec3 lightToPosition = shadowCoord.xyz;\n\n        // dp = normalized distance from light to fragment position\n        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n        compare += shadowBias;\n\n        // bd3D = base direction 3D\n        vec3 bd3D = normalize( lightToPosition );\n\n        vec2 halton = haltonSequence[frameIndex];\n        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n        float temporalAngle  = temporalOffset * PI2;\n\n        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )\n            for (int i = 0; i < gShadowSamples; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                // NOTE: Removed for now\n                // Penumbra offset\n                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * gShadowSamplesRpc;\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n            for (int i = 0; i < 16; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * (1.0 / 16.0);\n        #else // no percentage-closer filtering\n\n            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );\n\n        #endif\n\n    }\n\n#endif\n`)(e);let n=UH.slice();n=n.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),n=n.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),Ay.lights_fragment_begin=n;let i=kH.slice();return i=i.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),Ay.shadowmask_pars_fragment=i,!0})(t.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(t,e){if(t.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){this.scene.fog=this.fog}this.fogUseBGColor=t.useBackgroundColor,t.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=jF(t.color,e),this.backupFog.near=t.near,this.backupFog.far=t.far}updateAo(t,e){void 0!==t.aoColor&&(this.aoColor=jF(t.aoColor,e))}updateByOp(t,e,n,i){let r=this.data.uiFrame;super.updateByOp(t,e,n,i);let s=e;$R(t.path,["fog"])?this.updateFog(s.fog,n.shared):$R(t.path,["ao"])?this.updateAo(s.ao,n.shared):$R(t.path,["ambient"])?this.updateAmbientLight(s.ambient,n.shared):$R(t.path,["shadow"])?this.updateShadow(s.shadow):0===t.type&&0===t.path.length&&(void 0!==t.props.uiFrame||r!==s.uiFrame)&&this.updateUIFrame(t.props.uiFrame,n)}updateUIFrame(t,e){t?(this.uiCanvas||this.createUICanvas(t,e),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(t)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(t,e){this.updateState_Entity(t,e),void 0!==t.backgroundColor&&this.setBackgroundColor(jF(t.backgroundColor,e.shared)),void 0!==t.fog&&this.updateFog(t.fog,e.shared),void 0!==t.ambient&&this.updateAmbientLight(t.ambient,e.shared),void 0!==t.ao&&this.updateAo(t.ao,e.shared),void 0!==t.shadow&&this.updateShadow(t.shadow)}createFrame(t,e){}raycast(t,e){super.raycast(t,e)}switchActiveCamera(t){t&&t.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=t,t.objectHelper.visible=!1)}get playCamera(){return this.scene?.find(this.data.publish.playCamera)??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return null===this.penumbraSizeArrayCache&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let t=0,e=0;this.traverseEntity((n=>{if(!n.visible)return!0;n instanceof WH&&n.visible&&t<3&&(this.penumbraSizeArrayCache[t]=n.data.penumbraSize??.5,t+=1),n instanceof YH&&n.visible&&t<2&&(this.penumbraSizeArrayCache[3+e]=n.data.penumbraSize??.5,e+=1)}))}raycastWithClones(t){let e=[],n=i=>{for(let r of i.children){let i=r.cloner;fz.is(r)&&(r.visible||i?.object.data.visible)&&((AH(r)||PH(r)&&this.scene.enableHelpers&&r.objectHelper.visible)&&(t.intersectObject(r,!1,e),BW(r,t,e,!0)),n(r))}};return n(this),e}updateEntity2DByOp(t,e,n,i){this.uiCanvas?.updateEntity2DByOp(t,e,n,i)}},ZG=class extends(EH(NS,VH)){constructor(t,e,n){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let i=this.shadow.camera;i.fov=90,i.aspect=1,i.near=100,i.far=2500;let r=new $m(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),s=new $m(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z),a=new Km(r,s),o=new gM(a,new pv(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let t in this.gizmos){let e=this.gizmos[t];if(e instanceof gM){let t=this.shadow.camera,n=new $m(-t.far+this.position.x,-t.far+this.position.y,-t.far+this.position.z),i=new $m(t.far+this.position.x,t.far+this.position.y,t.far+this.position.z);e.box.set(n,i),e.updateMatrixWorld(!0)}}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e),void 0!==t.distance&&(this.distance=t.distance),void 0!==t.decay&&(this.decay=t.decay),void 0!==t.shadowRadius&&(this.shadow.radius=t.shadowRadius),void 0!==t.shadowResolution&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},KG=class extends pj{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(t,e){let n=this.geometry.getAttribute("position");void 0!==n?Gk(n,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:n.count,t,e):super.updateEntityBoxSize(t,e)}},JG=class extends pj{constructor(t,e,n){super(t,e,n),this._shapeId=null,this._context=n}updateState(t,e){super.updateState(t,e),this.updateShape(),this.refreshAttachedCloners(e)}updateShape(){let t,e={...this.data.geometry.extrusion.shape};for(let t in e)"string"==typeof e[t]&&(e[t]=this._context.shared.getVariable(e[t],[this.uuid,"geometry","extrusion","shape",t]));if("Custom"===e.type){let n=e.shapeId;if(n!==this._shapeId&&this.detachShape(),n){this._shapeId=n;let e=this._context.scene.find(n);e?.data&&(e.attachedPaths.add(this),t=e.geometry.userData?.shape),t||this._context.scene.addPendingCommand((()=>this.updateShape()))}}else{let n;switch(e.type){case"Rectangle":n=HU;break;case"Ellipse":n=lU;break;case"Polygon":n=kU;break;case"Star":n=WU;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=n.create({parameters:e}).userData.shape}let n=this.geometry;t&&n.inputs&&(n.inputs.shapeData=t,n.build())}detachShape(){null!==this._shapeId&&this._context.scene.find(this._shapeId)?.attachedPaths.delete(this)}createGeometryDelayed(t){this.geometryCreateDeleyed=t.shared,this.updateShape(),this.refreshAttachedPaths(t)}updateTransformState(t,e){return super.updateTransformState(t,e)}updateGeometryInteractions(t,e){super.updateGeometryInteractions(t,e),this.updateShape()}updateEntityBoxSize(t,e){let n=this.geometry.getAttribute("position");void 0!==n?Gk(n,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:n.count,t,e):super.updateEntityBoxSize(t,e)}},QG=class extends Hj{constructor(t,e,n){super(t,e,n),this.data=e}},tW=class extends(mH(i_,IH)){constructor(t,e,n){super(),"Instance"===e.type&&"string"==typeof t&&(e=this.transformAssignData(e,n)),this.super_Entity(t,e),this.objectHelper.update()}get isComponentRoot(){return"Component"===this.data.type&&"string"==typeof this.identity}get isInstanceRoot(){return"Instance"===this.data.type&&"string"==typeof this.identity}transformAssignData(t,e){let n=CI.getComponentData({scene:e.scene.data,shared:e.shared.data},t.component);if(n){let e,i;for(let r of VL.rootOverrideProps)void 0===t[r]?(void 0===e&&(e={...t}),e[r]=n.data[r]):(void 0===i&&(i={}),i[r]=t[r],void 0===e&&(e={...t}),e[r]=vR.apply(n.data[r],t[r]));return this.overrideData=i,e}return{...DL.defaultData,...t,...rR(DL.defaultData,VL.rootOverrideProps)}}updateByOp(t,e,n,i){let r;if(this.isInstanceRoot&&!i)if(e=this.transformAssignData(e,n),0===t.type&&0===t.path.length&&this.component)for(let e of VL.rootOverrideProps)e in t.props&&void 0===t.props[e]&&(void 0===r&&(r={...t,props:{...t.props}}),r.props[e]=this.component.data[e]);else if(0===t.type&&t.path.length>0&&VL.rootOverrideProps.includes(t.path[0])){let n=t.path[0];void 0===r&&(r={...t,path:[],props:{[n]:e[n]}})}super.updateByOp(r??t,e,n,i)}updateState(t,e){this.updateState_Entity(t,e)}expandInstanceChildren(t){let e=this.data;if(void 0===this.component){let n=t.scene.find(e.component)??null,i=!1;if(n!==this.oldComponent){if(this.oldComponent){let e=0;for(let n of this.children){if(!fz.is(n))break;t.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),eW(n),e+=1}this.children.splice(0,e)}i=!0}if(n){let r={};iW(t,[this.uuid],e.overrides,this,n,n,0,i,r);for(let e of this.children)if(fz.is(e)){let n=e.data;"Empty"===n.type&&n.animations&&e.traverseEntity((e=>{let n=e.dataPatched;if(e instanceof pj&&n.bones&&n.boneInverses){let n=e.dataPatched;if(n.bones&&n.boneInverses){let i=n.bones.map((e=>t.scene.find(r[e]))),s=n.boneInverses.map((t=>(new Mg).fromArray(t))),a=new w_(i,s);e.bind(a,e.bindMatrix)}}else e.matrixAutoUpdate=!0}))}}this.oldComponent=this.component}}};function eW(t){if(t.component){let e=t.component.instances.indexOf(t);e>=0&&t.component.instances.splice(e,1);for(let e of t.children)fz.is(e)&&eW(e)}}function nW(t,e,n,i){return t.component===e&&YP(t.identity,i)?t.overrideData===n?2:1:0}function iW(t,e,n,i,r,s,a,o,l){if(a>50)return!1;if(i.component!==r){if(i.component){let t=i.component.instances.indexOf(i);t>=0&&i.component.instances.splice(t,1)}r.instances.find((t=>t===i))||r.instances.push(i),i.component=r}r instanceof tW&&r.isInstanceRoot&&r.expandInstanceChildren(t);let c=0;for(let h of r.children)if(fz.is(h)){let r=[...e,..."string"==typeof h.identity?[h.identity]:h.identity],u=FL.resolve(n,r,1);null==u||u instanceof _R||(Object.setPrototypeOf(u,_R.prototype),console.error("wrong prototype"));let d,p=null;if(!o){let e=i.children[c];if(p=fz.is(e)?e:null,null!==p){let t=nW(p,h,u,r);d=t>=1?p.stateSelection:void 0,2!==t&&(p=null)}if(null===p&&(p=t.scene.findInstance(r)??null,null!==p)){let e=nW(p,h,u,r);if(d=e>=1?p.stateSelection:void 0,2!==e)p=null;else{let e=p.parent.children.indexOf(p);p.parent.children.splice(e,1),i.children.splice(c,0,p),p.parent===i?e<=c&&console.error("not possible"):(p.parent=i,p.matrixWorldNeedsUpdate=!0,p.resetBBoxNeedsUpdate(),p.updateVisible(),t.pendingDeletes.delete(p))}}}if(null===p){let e=u?vR.apply(h.data,u):h.data;BD.is(e.type)&&(e={...e,type:"Empty"}),p=Ez.createEntity(r,e,t),p.overrideData=u,i.add(p),i.children.splice(i.children.length-1,1),i.children.splice(c,0,p),p.updateState(p.data,t),d&&p.changeSelectedState(d,t),t.scene.registerInstanceAndSetUuid(p)}if(p.isBone){l[p.identity[p.identity.length-1]]=p.uuid}c+=1,iW(t,e,n,p,h,s,a+1,o,l)}if(!o){let e=c;for(;;){let e=i.children[c];if(!fz.is(e))break;t.pendingDeletes.add(e),c+=1}i.children.splice(e,c-e)}return!0}var rW=class extends(mH(y_,IH)){constructor(t,e){super(),this.super_Entity(t,e),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(t,e){this.updateState_Entity(t,e)}},sW=class extends pj{constructor(t,e,n){super(t,e,n),this.onBeforeRender=t=>{this.uiCanvas.render(t)},this.uiCanvas=new GG(t+"-canvas",e.geometry.width,e.geometry.height,n),this.uiCanvas.promise.then((()=>{this.applyFrame(this.dataPatched.geometry.frame,n.shared)}))}updateByPatchedOpGeometry(t,e,n){super.updateByPatchedOpGeometry(t,e,n),0===t.type&&(void 0!==t.props.frame&&this.applyFrame(t.props.frame,n.shared),(void 0!==t.props.width||void 0!==t.props.height)&&this.applySize(t.props,n.shared))}applySize(t,e){let n=t?.width??this.dataPatched.geometry.width,i=t?.height??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:n,height:i}),this.applyGeometryParametersFromFrame(e)}applyFrame(t,e){this.uiCanvas.applyFrame(t),this.applyGeometryParametersFromFrame(e),this.applyMaterialParametersFromFrame({shared:e})}applyGeometryParametersFromFrame(t){let e=this.frame;e&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:e.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:e.cornerRadius,cornerType:0})}),this.localGeometry?.dispose(),this.localGeometry=hk(this.dataPatched.geometry,t,this.data.flatShading,this))}applyMaterialParametersFromFrame(t){let e=this.frame;if(e){let n=e.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:n.radius,alpha:n.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:n.radius,alpha:n.enabled?1:0}),this.material.reset(this.dataPatched.material,t,!0)}}updateEntity2DByOp(t,e,n,i){this.uiCanvas.updateEntity2DByOp(t,e,n,i),t===this.frameId&&0===e.type&&(void 0!==e.props.cornerRadius?this.applyGeometryParametersFromFrame(i):$R(e.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:i}))}get frame(){return this.uiCanvas.frame}get frameId(){return this.frame?.uuid}removeInteractionGeometry(t){super.removeInteractionGeometry(t),this.applySize({},t)}updateGeometryInteractions(t,e){super.updateGeometryInteractions(t,e),this.applySize({width:t.width,height:t.height},e)}};function aW(t,e){let n=t,i=new Float32Array(4*e*e);for(let t=0;t<e*e;t++)i[4*t]=n[3*t],i[4*t+1]=n[3*t+1],i[4*t+2]=n[3*t+2],i[4*t+3]=0;let r=new x_(i,e,e,jp,Ip);return r.needsUpdate=!0,r}var oW="\n\n  // Linear Fade In\n  float linearFadeIn(float t) {\n    return t;\n  }\n\n\n  // linear fade out\n  float linearFadeOut(float t) {\n    return 1.0 - t;\n  }\n  \n  float linearInOut(float t) {\n    return t < 0.5 ? t :  (1.0 - t);  \n  }\n\n    // lerp\n    float lerp(float a, float b, float t) {\n      return a + (b - a) * t;\n    }\n\n  // Ease In Out Quart\n  float exponentialInOut(float t) {\n    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :\n    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :\n    1.0;\n   }\n\n  // constant\n  float constant(float t) {\n    return 1.0;\n  } \n",lW=`\n  uniform sampler2D uPosition;\n  uniform float uSize;\n  uniform float uSizeEnd;\n  uniform vec3 uWorldOffset;\n  uniform vec4 uWorldQuaternion;\n  // Billboard Behavior - Currently at Zero, but we can change that\n  uniform float uRotation;\n  uniform float uRotationEnd;\n  uniform vec2 center;\n\n  // Randomness\n  uniform float uRandScaleFactor;\n  uniform float uRandRotationFactor;\n\n  attribute vec2 ref;\n\n  varying float v_LifeLeft;    // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  \n\nfloat rand(vec3 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n    \n  return acceleration;\n}\n\n  ${oW}\n`,cW="\n  uniform vec4 uColor;                // start color\n  uniform vec4 uColor2;               // end color\n  uniform sampler2D uTexture;         // texture\n  varying float v_LifeLeft;   // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  float random(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n  }\n  "+oW+"  \n  \nvec3 rgb2xyz (in vec3 rgb) {\n    float r = rgb.r;\n\tfloat g = rgb.g;\n\tfloat b = rgb.b;\n\n\tr = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);\n\tg = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);\n\tb = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);\n\n\tfloat x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);\n\tfloat y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);\n\tfloat z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);\n    \n    vec3 xyz = vec3(\n        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,\n        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,\n        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0\n    );\n    return(xyz);\n}\n\nvec3 xyz2lab (in vec3 xyz) {\n\tfloat x = xyz.x / 95.047;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 108.883;\n\n\tx = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);\n\ty = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);\n\tz = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);\n\n    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));\n    return(lab);\n}\n\nvec3 rgb2lab(in vec3 rgb) {\n    vec3 xyz = rgb2xyz(rgb);\n    vec3 lab = xyz2lab(xyz);\n    return(lab);\n}\n\nvec3 xyz2rgb (in vec3 xyz) {\n\tfloat x = xyz.x / 100.0;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 100.0;\n\t\n    \n\tfloat r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);\n\tfloat g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);\n\tfloat b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);\n\n\tr = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;\n\tg = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;\n\tb = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;\n\n\tr = min(max(0.0, r), 1.0);\n\tg = min(max(0.0, g), 1.0);\n\tb = min(max(0.0, b), 1.0);\n\n\treturn(vec3(r, g, b));\n}\n\nvec3 lab2xyz (in vec3 lab) {\n    float l = lab.x;\n\tfloat a = lab.y;\n\tfloat b = lab.z;\n\n  \tfloat y = (l + 16.0) / 116.0;\n\tfloat x = a / 500.0 + y;\n\tfloat z = y - b / 200.0;\n\n\tfloat y2 = pow(y, 3.0);\n\tfloat x2 = pow(x, 3.0);\n\tfloat z2 = pow(z, 3.0);\n\n  \ty = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;\n\tx = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;\n\tz = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;\n\n\tx *= 95.047;\n\ty *= 100.0;\n\tz *= 108.883;\n\n\treturn(vec3(x, y, z));\n}\nvec3 lab2rgb (in vec3 lab) {\n    vec3 xyz = lab2xyz(lab);\n    vec3 rgb = xyz2rgb(xyz);\n    return(rgb);\n}\n\n\n\n",hW=class extends oy{constructor(t,e){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(t,e),this.context=e}reset(){}init(t,e){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=t.ease,this.easeSize=t.easeSize,this.layers=[],Yk.startContext(Yk.globalContext),this.lightLayer=new eV(0,"",{...hL.defaultData("light","phong"),visible:!1},new RF,{},e.shared),Yk.endContext(Yk.globalContext),this.build()}updateState(t){void 0!==t.coloring&&(this.isColoringRandom="random"===t.coloring),void 0!==t.color&&(t.color instanceof Array?this.uniforms.uColor.value=t.color:this.uniforms.uColor.value=this.context.shared.color(t.color)),void 0!==t.color2&&(t.color2 instanceof Array?this.uniforms.uColor2.value=t.color2:this.uniforms.uColor2.value=this.context.shared.color(t.color2)),void 0!==t.size&&(this.uniforms.uSize.value=t.size[0],this.uniforms.uSizeEnd.value=t.size[1],t.size[0]!==t.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),void 0!==t.ease&&(this.easeOpacity=t.ease,this.build()),void 0!==t.easeSize&&(this.easeSize=t.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(t){this.build(),t.defines=this.defines,t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader}build(){let t=new kB;return t.needsJitter=this.needsJitter,t.addFragmentParsCode("\nlayout(location = 1) out vec4 gVelocity;\n"),t.buildShader("vertex",this.fragment),t.buildShader("fragment",this.fragment),t.addFragmentFinalCode("\n    // Discard fully transparent pixels \n    if (gl_FragColor.a <= 0.0) discard;\n\n    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);\n"),this.isColoringRandom&&t.define("USE_RANDOM_COLORING"),this.useSizeEnd&&t.define("USE_SIZE_END"),t.addVertexParsCode(lW),t.addFragmentParsCode(cW),t.addVertexFinalCode((({easeSize:t="linearFadeOut"})=>`\n  vUv = uv;  \n  vRef = ref;\n  // Normalized LifeTime 1 to 0\n  float lifeLeft = texture2D(uPosition, ref).w;\n  v_LifeLeft = lifeLeft;\n  // Position From DataTexture Simulation\n  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;\n  // Apply World Quaternion\n  pos = applyQuaternionToVector(uWorldQuaternion, pos);  \n            \n  #ifdef  USE_SIZE_END\n    // Scaled Over Time\n    float t = 1. - lifeLeft;\n    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd\n    vec3 scaledPosition = position * vec3(currentSize);\n  #else\n    // Change Size Behavior over LifeTime\n    float easeSize = ${t}(1. - lifeLeft);\n    // Scaled Over Time\n    vec3 scaledPosition = position * vec3(uSize * easeSize);\n  #endif\n\n  // Billboard Behavior\n  vec2 scale;\n  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    \n  // Randomness \n  float randRef = rand(ref);\n  scale *= (1.0 - (uRandScaleFactor * randRef));\n  // Rotation\n  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);\n  float originalRotation = (1.0 - uRotation) * 2.0 * PI;\n  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;\n  // OverTime\n  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);\n\n  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;\n  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;\n  \n  mat4 instanceMatrix = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 1.0, 0.0),\n    vec4(pos.x, pos.y, pos.z, 1.0)\n  );  \n\n  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n  mvPosition.xy += rotatedPosition;\n  gl_Position = projectionMatrix  * mvPosition;   \n`)({easeSize:this.easeSize})),t.addFragmentFinalCode((({easeOpacity:t="linearFadeOut"})=>`  \n  // if Particle is dead, hide it\n  if (v_LifeLeft <= 0.005 ) {\n    discard;\n  }\n\n  #ifdef USE_RANDOM_COLORING\n    float randVal = random(vRef); // Generate a random value based on the reference\n    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors\n  #else\n    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);\n  #endif\n\n  // Opacity over Life Time\n  float finalAlpha = ${t}(1. - v_LifeLeft);  \n  vec4 textureColor = texture2D(uTexture, vUv).rgba; \n  finalColor = textureColor.rgb * color.rgb;\n  finalAlpha = color.a * textureColor.a * finalAlpha;\n  \n  gl_FragColor = vec4(finalColor, finalAlpha);     \n\n`)({easeOpacity:this.easeOpacity})),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms={...t.uniforms,...this.uniforms},this.extensions=t.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach((t=>t.dispose())),super.dispose()}},uW=class{constructor(t,e,n,i){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=t,this.type=n,this.textureSize=function(t){let e=Math.ceil(Math.sqrt(t));return Math.max(e,1)}(e);this.targetMesh="Mesh"===i?.type&&i?i:this.getMesh(n,1);let{positions:r,dataTexture:s,dataTextureNormals:a}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(n,1));this.positionsTexture=s,this.positionsAttribute=r,this.directionsTexture=a}createPositions(t,e){let{positions:n,normals:i}=function(t,e){let n=new ty(t.geometry,t.material),i=[],r=[],s=new $m,a=new $m;null!==n.geometry.index&&(n.geometry=n.geometry.toNonIndexed());let o=new NM(n).build();for(let t=0;t<e;t++)o.sample(s,a),i.push(s.x,s.y,s.z),r.push(a.x,a.y,a.z);return{positions:new Float32Array(i),normals:new Float32Array(r)}}(e,t*t);return{dataTexture:aW(n,t),positions:n,dataTextureNormals:aW(i,t)}}getMesh(t,e){let n=null;switch(t){case"SphereEmitterShape":n=new Kw(.5*e,32,32);break;case"TorusEmitterShape":n=new Jw(.5*e,.3,15,40);break;case"ConeEmitterShape":n=new mw(e,e,15);break;case"BoxEmitterShape":n=new ny(e,e,e);break;case"PlaneEmitterShape":n=new Ey(e,e),n.rotateX(-Math.PI/2);break;default:n=new Kw(e,32,32)}return new ty(n,new vv({color:16711680}))}applyToShader(t,e){this.size=(new $m).fromArray(e.size),t.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function dW(t){let e={...t},n=YD.defaultData;e.forceFieldObjectId&&(e.colliderEntityId=e.forceFieldObjectId);let i={...n.shape,...e.shape},r={...n.renderMaterial,...e.renderMaterial};return{...n,...e,shape:i,renderMaterial:r}}var pW=class extends Kg{constructor(t,e){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new SS,this.currentWorldPosition=new $m,this.systemQuaternion=new Xm,this.worldGravity=new $m(0,0,0),this.directionAxis=new $m(0,0,0),this.colliderV3=new $m(0,0,0),this.colliderQuaternion=new Xm(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=t,this.system=e,this.shared=e.context.shared;let n=e.data;this.material=new hW(n.renderMaterial,e.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:n.renderMaterial.color},uColor2:{value:n.renderMaterial.color2},uPosition:{value:new $m(0,0,0)},uEmissionData:{value:new $m(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new $m(0,0,0)},uWorldQuaternion:{value:new jm(0,0,0,1)},uRandScaleFactor:{value:n.randomScale??0},uRandRotationFactor:{value:n.randomRotation??0},uRotation:{value:n.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:n.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,n.renderMaterial.texture),this.init(n)}setTexture(t,e){let n=e.data;if("string"==typeof e){let n=this.shared.image(e),i=new Vm(n.img);return i.needsUpdate=!0,void(t.uTexture.value=i)}if("string"!=typeof n){let e=new Image;e.onload=()=>{let n=new Vm(e);n.needsUpdate=!0,t.uTexture.value=n};let i=new Blob([n],{type:"image/*"}),r=URL.createObjectURL(i);e.src=r}}updateGeometryAttributes(t,e){let n=function(t){let e=new Float32Array(t*t*2);for(let n=0;n<t;n++)for(let i=0;i<t;i++){let r=n*t+i;e[2*r+0]=n/(t-1),e[2*r+1]=i/(t-1)}return e}(e);!this.emitterShape?.positionsAttribute||t.geometry.setAttribute("ref",new S_(n,2))}applyWorldSpace(){if(!(this.system.started&&this.worldSpace&&this.positionSimRT&&this.velocitySimRT))return;let t=this.system;t.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),t.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(t,e){if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset)return void this.reset();this.applyWorldSpace(),this.globalTime=t,this.positionSimRT.material.uniforms.uTime.value=t,this.emissionRateSimRT.material.uniforms.uTime.value=t;let n=1e3/e,i=this.targetFPS/n,r=this.previousRatio+(i-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=r,this.previousRatio=r;let s=this.isEmitting?this.GoEmitSomeParticles(t,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT)?.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let t=this.system.colliderEntities[0],e=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(t.destroyedInAction&&e&&this.init(dW({...this.system.data,colliderEntityId:null})),!t||t.destroyedInAction)return;t.getWorldPosition(this.colliderV3),0===this.colliderV3.y&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let n=t.data.size;this.colliderV3.fromArray(n),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),t.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(t){!this.velocitySimRT||!this.positionSimRT||(t.renderMaterial&&this.updateMaterialState(t.renderMaterial),this.updateParticleState(t))}updateVariableState(t,e){if(!this.velocitySimRT||!this.positionSimRT)return;"size"===e[2]&&this.material.updateState({size:[t,this.material.uniforms.uSizeEnd.value]}),"sizeEnd"===e[2]&&this.material.updateState({size:[this.material.uniforms.uSize.value,t]});let n=(t,e)=>{let n=[...this.system.data.shape.size];n[t]=e,this.updateParticleState({shape:{...this.system.data.shape,size:n}})};"shape_size_0"===e[2]&&n(0,t),"shape_size_1"===e[2]&&n(1,t),"shape_size_2"===e[2]&&n(2,t),"speed"===e[2]&&(this.velocitySimRT.material.uniforms.uSpeed.value=t/10),"gravity"===e[2]&&this.worldGravity.set(0,t/100,0),"noiseStrength"===e[2]&&(this.noiseStrength=t,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),"noiseScale"===e[2]&&(this.noiseScale=t,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),"direction_x"===e[2]&&(this.directionAxis=this.getDirectionAxis([Number(t),this.system.data.direction[1],this.system.data.direction[2]])),"direction_y"===e[2]&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(t),this.system.data.direction[2]])),"direction_z"===e[2]&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(t)]))}updateMaterialState(t){this.material.updateState({...t,size:t.size?[Number(this.shared.getVariable(t.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(t.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),t.texture&&(this.setTexture(this.material.uniforms,t.texture),this.material.needsUpdate=!0)}updateParticleState(t){if(this.positionSimRT&&this.velocitySimRT){if(this.shouldReInitGPUCompute(t)&&this.init(dW(this.system.data)),void 0!==t.life&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=t.life),void 0!==t.speed&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(t.speed,[this.uuid,"particles","speed"]))/10),void 0!==t.collisionBounce&&(this.velocitySimRT.material.uniforms.uBounce.value=t.collisionBounce),void 0!==t.noiseStrength&&(this.noiseStrength=Number(this.shared.getVariable(t.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),void 0!==t.noiseScale&&(this.noiseScale=Number(this.shared.getVariable(t.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),void 0!==t.noiseSeed&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=t.noiseSeed),void 0!==t.randomMass&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=t.randomMass),void 0!==t.renderMaterial?.size){let e=this.shared.getVariable(t.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(e)}if(void 0!==t.renderMaterial?.spriteRotation&&(this.material.uniforms.uRotation.value=t.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=t.renderMaterial.spriteRotation[1]),void 0!==t.shape){let e=t.shape.size??this.system.data.shape.size,n=[Number(this.shared.getVariable(e[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e[2],[this.uuid,"particles","shape_size_2"]))],i={...dW(this.system.data).shape,size:n};this.emitterShape?.applyToShader(this.positionSimRT.material.uniforms,i)}if(void 0!==t.gravity&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),void 0!==t.direction){let e=this.getDirectionFromVariable(t.direction);this.directionAxis=this.getDirectionAxis(e),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}void 0!==t.randomRotation&&(this.material.uniforms.uRandRotationFactor.value=t.randomRotation),void 0!==t.randomScale&&(this.material.uniforms.uRandScaleFactor.value=t.randomScale)}}updateForceFieldParameters(t){!this.velocitySimRT||(void 0!==t.forceIntensity&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=t.forceIntensity),void 0!==t.forceDambing&&(this.velocitySimRT.material.uniforms.uForceDamping.value=t.forceDambing))}getDirectionAxis(t){let e=[Number(t[0])*vm.DEG2RAD,Number(t[1])*vm.DEG2RAD,Number(t[2])*vm.DEG2RAD],n=new Ig(e[0],e[1],e[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(n).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(t){let{birthRatePerSec:e,rootObjectType:n,colliderEntityId:i,shape:r,emitTimeDuration:s,emitTimeCycle:a,life:o,directionMode:l,noiseType:c}=t;return void 0!==e||void 0!==n||i||null===i||void 0!==a||void 0!==r||void 0!==o||void 0!==s||void 0!==l||void 0!==c}init(t){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:t.birthRatePerSec,particleMaxLifeTime:t.life,loopDuration:"infinity"===t.emitTimeCycle?0:t.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(t.shape,this.particlesAmount);let e=setInterval((()=>{if(this.emitterShape){if(isNaN(this.emitterShape.positionsTexture.source.data.data[0]))return void this.init(t);clearInterval(e)}}),100);if(!this.emitterShape)return;let n=new RM(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),i=this.updateSimulationDefinition(t),r=n.addVariable("uCurrentPosition",i+"\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform float uTime;\nuniform float uSpeed;     // update speed of the particles\nuniform vec3 uWorldOffset;    \nuniform vec4 uWorldQuaternion;\nuniform float uMaxLifeTime;\nuniform vec3 uEmitterSize;\nuniform float uFPSRatio;     // 1  for 60 FPS\n\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy,\n        vec2(12.9898,78.233)))*\n        43758.5453123);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n    vec3 acceleration = force / mass;\n    \n    return acceleration;\n  }\n  \n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted\n    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);\n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided\n    float lifeTime = uMaxLifeTime;\n\n    // Calculate the position adjustment based on collision\n    //     if (collisionFlag > .5) {  \n    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0\n    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise\n    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);\n\n    // Update position based on collision or normal movement\n    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);\n    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);\n\n    // EMISSION RATE - BIRTH\n    // if (isSpawning == 1.0) {\n    // Better Approach to avoid If statement\n    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;\n    originalPosition = mix(originalPosition, newPosition, isSpawning);\n    position = mix(position, originalPosition, isSpawning);;\n    timeStart = mix(timeStart, uTime, isSpawning);\n\n    // Calculate timeLeft for life normalization\n    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);\n    float life_Normalize = timeLeft / lifeTime;\n\n    // Use isActive to blend between the calculated color and black\n    vec4 activeColor = vec4(position, life_Normalize);\n    // if (isActive == 1.0) {\n    gl_FragColor = mix(vec4(0.0), activeColor, isActive);\n\n}\n",this.emitterShape.positionsTexture),s=n.addVariable("uCurrentVelocity",i+"\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform sampler2D uDirections;     \nuniform vec3 uDirectionsAxis;\nuniform vec4 uWorldQuaternion;\nuniform vec3 uGravity;        \nuniform float uNoiseStrength;     // Variation of the noise\nuniform float uNoiseScale;        // Scale of the noise\nuniform float uNoiseSeed;         // Seed of the noise\nuniform float particleSize;\nuniform float uSpeed;     // update speed of the particles\nuniform float uRandomMassFactor;\n\n// COLLIDER\nuniform vec3 uColliderPos;                // Collider Position\nuniform vec3 uColliderSize;               // Collider Dimension\nuniform vec4 uColliderQuaternion;         // Collider Rotation\nuniform vec4 uColliderQuaternionInvert;   // Collider Rotation\nuniform float uBounce;                    // Bounce factor\nuniform float uForceDamping;\nuniform float uForceIntensity;\n\n\n\n\n    vec3 mod289(vec3 x) {\n      return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 mod289(vec4 x) {\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 permute(vec4 x) {\n        return mod289(((x*34.0)+1.0)*x);\n    }\n    \n    vec4 taylorInvSqrt(vec4 r)\n    {\n    return 1.79284291400159 - 0.85373472095314 * r;\n    }\n    \n    vec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n    float snoise(vec3 v)\n    {\n    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n    vec3 i  = floor(v + dot(v, C.yyy) );\n    vec3 x0 =   v - i + dot(i, C.xxx) ;\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min( g.xyz, l.zxy );\n    vec3 i2 = max( g.xyz, l.zxy );\n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n    \n    // Permutations\n    i = mod289(i);\n    vec4 p = permute( permute( permute(\n                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n    \n    // Gradients: 7x7 points over a square, mapped onto an octahedron.\n    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n    float n_ = 0.142857142857; // 1.0/7.0\n    vec3  ns = n_ * D.wyz - D.xzx;\n    \n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n    \n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n    \n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n    \n    vec4 b0 = vec4( x.xy, y.xy );\n    vec4 b1 = vec4( x.zw, y.zw );\n    \n    vec4 s0 = floor(b0)*2.0 + 1.0;\n    vec4 s1 = floor(b1)*2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n    \n    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n    \n    vec3 p0 = vec3(a0.xy,h.x);\n    vec3 p1 = vec3(a0.zw,h.y);\n    vec3 p2 = vec3(a1.xy,h.z);\n    vec3 p3 = vec3(a1.zw,h.w);\n    \n    //Normalise gradients\n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n    \n    // Mix final noise value\n    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                  dot(p2,x2), dot(p3,x3) ) );\n    }\n    \n    vec3 snoiseVec3( vec3 x ){\n    \n      float s  = snoise(vec3( x ));\n      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n      vec3 c = vec3( s , s1 , s2 );\n      return c;\n    \n    }\n    \n      \n    vec3 curlNoise( vec3 p, float seed){\n      p += seed;\n      const float e = .1;\n      vec3 dx = vec3( e   , 0.0 , 0.0 );\n      vec3 dy = vec3( 0.0 , e   , 0.0 );\n      vec3 dz = vec3( 0.0 , 0.0 , e   );\n    \n      vec3 p_x0 = snoiseVec3( p - dx );\n      vec3 p_x1 = snoiseVec3( p + dx );\n      vec3 p_y0 = snoiseVec3( p - dy );\n      vec3 p_y1 = snoiseVec3( p + dy );\n      vec3 p_z0 = snoiseVec3( p - dz );\n      vec3 p_z1 = snoiseVec3( p + dz );\n    \n      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n    \n      const float divisor = 1.0 / ( 2.0 * e );\n      return normalize( vec3( x , y , z ) * divisor );\n    \n    }\n\n\n// Classic Perlin noise\nfloat cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n  return 2.2 * n_xyz;\n}\n\n\nvec3 fbm_vec3(vec3 p, float frequency, float offset)\n{\n  return vec3(\n    cnoise((p+vec3(offset))*frequency),\n    cnoise((p+vec3(offset+20.0))*frequency),\n    cnoise((p+vec3(offset-30.0))*frequency)\n  );\n}\n\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n } \nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n  \n  return acceleration;\n}\n\nvec4 conjugate(vec4 q) {\n  return vec4(q.w, -q.x, -q.y, -q.z);\n}\n\n// Function to compute the normal of the ellipsoid at a given point\nvec3 ellipsoidNormal(vec3 p, vec3 radii) {\n  return normalize(p / (radii * radii));\n}\n\nfloat friction = .3;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    vec3 directions = texture2D( uDirections, vUv ).xyz;    \n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float mass = rand(originalPosition.xy) * 0.5 + 0.5;\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active\n    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision\n\n    // Randomness Mass\n    mass = (1.0 - (uRandomMassFactor * mass));\n    \n    if (isActive == 1.0) {\n      // **************************************************************\n      // FORCES NOISES\n      // **************************************************************\n      #ifdef USE_CURL_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {\n          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;\n        }\n      #endif\n      // **************************************************************\n      #ifdef USE_SIMPLEX_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {\n          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);\n        }\n      #endif\n      // ************************************************************** \n      #ifdef USE_FBM_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      \n          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;\n        }\n      #endif\n\n      // COLLIDER\n      \n  #ifdef USE_COLLIDER\n    float restitution = max(uBounce * 2., .01); // Energy Loss\n    // SPHERE COLLIDER\n    // **************************************************************\n    #ifdef USE_SPHERE_COLLIDER       \n      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n      vec3 radii = uColliderSize;\n      // Adjust position relative to collider\n      vec3 relPos = position - uColliderPos;\n      // Apply rotation of the collider to the relative position\n      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n      // Scale relative position by radii (for ellipsoid collision detection)\n      vec3 scaledPos = relPos / radii;\n      // Calculate ellipsoidal distance\n      float dist = length(scaledPos); // Distance in terms of ellipsoid\n      \n      // Check for collision\n      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {\n          // Compute the normal at the collision point, accounting for particle size\n        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          \n        // Compute the normal at the collision point\n        vec3 normal = ellipsoidNormal(adjustedPos, radii);\n        // Rotate the normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);\n        // Reflect the velocity vector off the normal\n        velocity = reflect(velocity, normal) * restitution;\n\n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif\n\n    // BOX COLLIDER or PLANE COLLIDER \n    // **************************************************************\n    #ifdef USE_BOX_COLLIDER\n      // Box dimensions and repulsion variables\n      vec3 boxHalfSize = uColliderSize / 2.0;\n      // Convert world position to box's local space\n      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n      // Collision detection\n      vec3 localDistance = abs(localPos) - boxHalfSize;\n      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    \n\n      // Collision Detected\n      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      \n        // Find the nearest face normal for bounce direction\n        vec3 normal;\n        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {\n            normal = vec3(sign(localPos.x), 0.0, 0.0);\n        } else if (localDistance.y > localDistance.z) {\n            normal = vec3(0.0, sign(localPos.y), 0.0);\n        } else {\n            normal = vec3(0.0, 0.0, sign(localPos.z));\n        }            \n        // Rotate normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);      \n        // Reflect velocity and apply repulsion force\n        velocity = reflect(velocity, normal) * restitution;\n        \n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif      \n  #endif      \n  // END COLLIDER    \n\n      // ATTRACTION\n      \n  #ifdef USE_ATTRACTOR\n\n      #ifdef USE_SPHERE_COLLIDER      \n        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n        vec3 radii = uColliderSize;\n        // Adjust position relative to collider\n        vec3 relPos = position - uColliderPos;\n        // Apply rotation of the collider to the relative position\n        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n        // Scale relative position by radii (for ellipsoid collision detection)\n        vec3 scaledPos = relPos / radii;\n        // Calculate ellipsoidal distance\n        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid\n        float insideCheck = 1.0;\n\n      #endif\n\n\n      #ifdef USE_BOX_COLLIDER\n        // Box dimensions\n        vec3 boxHalfSize = uColliderSize / 2.0;\n        // Convert world position to box's local space\n        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n        vec3 localDistance = abs(localPos) - boxHalfSize;\n        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n        float insideCheck = particleSize;\n      #endif      \n  \n      // Apply vortex force inside the Helper\n      #ifdef USE_FORCE_LOCAL_SPACE\n        if (distToSurface <= insideCheck ) {    \n            // Define parameters for the attractor field\n            #ifdef USE_SPHERE_COLLIDER      \n              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed\n            #endif\n\n            #ifdef USE_BOX_COLLIDER\n              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed\n              #endif\n\n            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)\n          \n            // Use the same radii calculation code as for the collider\n            vec3 attractorRadii = uColliderSize;\n            // Adjust position relative to attractor center\n            vec3 relPos = position - uColliderPos;\n            // Apply rotation of the collider to the relative position\n            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n            // Scale relative position by radii (for ellipsoid attraction)\n            vec3 scaledPos = relPos / attractorRadii;\n\n            // Calculate ellipsoidal distance as attractor radius\n            float attractorRadius = length(scaledPos);\n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * attractorStrength;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= attractorDamping;\n        }\n      #else \n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= uForceDamping;\n      #endif    \n  #endif      \n  \n      // VORTEX\n      \n  #ifdef USE_VORTEX\n    // Box dimensions\n    vec3 boxHalfSize = uColliderSize / 2.0;\n    // Convert world position to box's local space\n    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n    vec3 localDistance = abs(localPos) - boxHalfSize;\n    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n\n    // Apply vortex force inside the box\n    if (distToSurface <= particleSize) {\n      float vortexStrength = uForceIntensity;\n      vec3 localTopCenter = vec3(0.0, 0., 0.0);\n\n      // Transform the local top center to the world space\n      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);\n      // Calculate the vector from particle to vortex center\n      vec3 vortexVector = vortexCenter - position;\n\n      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector\n      // Note: important to add a tiny z component to the up vector to avoid instability\n      vec3 upVector = vec3(0.0, 1.0, 0.01);\n      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));\n      rotationAxis = normalize(rotationAxis);\n\n      // Add rotational component to velocity\n      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; \n\n      vec3 rotationVelocity = rotationAxis * rotationSpeed;\n      // velocity += rotationVelocity * 0.005 ;\n      velocity = rotationVelocity * 0.005 ;\n\n      // Calculate vortex force\n      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;\n      // Apply the vortex force to the particle\n      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);\n      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);\n    }\n  #endif      \n\n    } \n    // End isActive\n\n    // SPAWN BIRTH \n    // **************************************************************\n    // if (isSpawning == 1.)\n    #ifdef USE_NORMALS\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);\n    #else\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    \n    #endif\n    \n    // if (collisionFlag == 0.0)\n    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);\n\n    gl_FragColor = vec4(velocity, collisionFlag);\n}\n",this.emitterShape.directionsTexture),a=n.addVariable("uCurrentEmissionRate","\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\n\nuniform sampler2D uIndex; // Texture with corresponding index\nuniform float uLastIndexEmitted; // Last emitted index\nuniform float uParticlesToEmit; // Number of particles to emit on that frame\nuniform float uTime;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    float particleIndex = texture(uIndex, vUv).x;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;\n\n\n    // ********** Detect Colision to Create a flag and use it in position **********\n    // We are doing this here, so\n\n    // ********** Emit Particles **********\n    // X = isSpawning 0.0 or 1.0\n    // Y = isActive 0.0 or 1.0\n    // Check if the vertex index is between the first value and the last value\n    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {\n    //     // Emit a particle by writing 1 to the red channel of the color output\n    //     // r: 1. == emit the particle\n    //     // g: 1. == particle is now active\n    //     timeStart = uTime;\n    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);\n    // } else {\n    //     // The Particle is either already emitted or not in the range of the particles to emit\n    //     // Do not emit a particle by writing 0 to the red channel of the color output        \n    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);\n    // }\n    // Determine if the particle is within the emission range\n    float emitLowerBound = step(uLastIndexEmitted, particleIndex);\n    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);\n    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise\n\n    // Set timeStart and color\n    timeStart = mix(timeStart, uTime, emitParticle);\n    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);\n\n\n}\n",function(t){let e=new Float32Array(4*t*t);for(let n=0;n<t*t;n++)e[4*n]=0,e[4*n+1]=0,e[4*n+2]=0,e[4*n+3]=0;let n=new x_(e,t,t,jp,Ip);return n.needsUpdate=!0,n}(this.emitterShape.textureSize));n.setVariableDependencies(r,[r,s,a]),n.setVariableDependencies(s,[r,s,a]),n.setVariableDependencies(a,[r,s,a]);let o=function({size:t}){let e=new Float32Array(4*t*t);for(let n=0;n<t*t;n++)e[4*n]=n,e[4*n+1]=0,e[4*n+2]=0,e[4*n+3]=0;let n=new x_(e,t,t,jp,Ip);return n.needsUpdate=!0,n}({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new $m(0,0,0)},uWorldQuaternion:{value:new jm(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:t.life},uEmitterSize:{value:new $m(Number(this.shared.getVariable(t.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};r.material.uniforms=l;let c=this.getDirectionFromVariable(t.direction);this.directionAxis=this.getDirectionAxis(c),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(t.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(t.noiseScale,[this.uuid,"particles","noiseScale"]));let h=t.colliderEntityId&&this.system.getColliderData(t.colliderEntityId),u={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new jm(0,0,0,1)},uColliderPos:{value:new $m(0,0,0)},uColliderSize:{value:new $m(0,0,0)},uForceIntensity:{value:h?h.forceIntensity:0},uForceDamping:{value:h?h.forceDambing:0},uColliderQuaternion:{value:new jm(0,0,0,1)},uColliderQuaternionInvert:{value:new jm(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:t.noiseSeed},uRandomMassFactor:{value:t.randomMass},uBounce:{value:t.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(t.speed,[this.uuid,"particles","speed"]))/10}};s.material.uniforms=u;let d={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};a.material.uniforms=d;let p=[Number(this.shared.getVariable(t.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t.shape.size[2],[this.uuid,"particles","shape_size_2"]))],f={...dW(this.system.data).shape,size:p};this.emitterShape.applyToShader(r.material.uniforms,f),n.init(),this.gpuCompute=n,this.positionSimRT=r,this.velocitySimRT=s,this.emissionRateSimRT=a,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(t){return[Number(this.shared.getVariable(t[0],[this.uuid,"particles","direction_x"])),Number(this.shared.getVariable(t[1],[this.uuid,"particles","direction_y"])),Number(this.shared.getVariable(t[2],[this.uuid,"particles","direction_z"]))]}updateSimulationDefinition(t){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,t.colliderEntityId&&this.system.colliderEntities.length>0){let e=this.system.getColliderData(t.colliderEntityId);switch(e?.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0}let n=e?.colliderType;"sphere"===n&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),"box"===n&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),"helper"===e?.forceRange&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}"normals"===t.directionMode&&(this.simFeaturesDefinition.USE_NORMALS=!0),"curl"===t.noiseType&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),"simplex"===t.noiseType&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),"fbm"===t.noiseType&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let e="";for(let[t,n]of Object.entries(this.simFeaturesDefinition))n&&(e+=`#define ${t}\n`);return e}createShape(t,e){this.emitterShape&&this.emitterShape.dispose();let n=new $m(Number(this.shared.getVariable(t.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t.size[2],[this.uuid,"particles","shape_size_2"])));if("MeshEmitterShape"===t.type){let i=null;return this.system.context.scene.traverseEntity((e=>{e.uuid===t.fromMeshId&&(i=e)})),i?new uW(n,e,t.type,i):new uW(n,e,"SphereEmitterShape")}return new uW(n,e,t.type)}createPrimaryEmitter(t){let e,n=t*t;return e=new O_(new Ey(1,1,1),this.material,n),this.updateGeometryAttributes(e,t),this.material.needsUpdate=!0,e.onBeforeRender=()=>{this.applyWorldSpace()},e}getMaxParticlesAmount({birthRatePerSecond:t,particleMaxLifeTime:e,loopDuration:n=0}){return Math.ceil(t*(e+n))}dispose(){!this.gpuCompute||(this.rootObject?.parent?.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),this.emitterShape?.dispose())}GoEmitSomeParticles(t,e){let n=t-this.lastEmitTime,i=1/e;if(n>=i){let e=Math.max(1,Math.floor(n/i));return this.lastEmitTime=t,this.emittedParticlesAmount+e>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=e,e}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(dW(this.system.data))}startEmitting(t){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=t}stopEmitting(){this.isEmitting=!1}},fW=class extends Xk{constructor(t,e,n){super(t,e),this.type="ParticleSystem",this.geometry=new Nv,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=t=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(t))},this.context=n,this.data={...e,...dW(e)},this.geometry.setAttribute("position",new Cv([],3)),this.material=new vv({colorWrite:!1}),this.frustumCulled=!1}init(t){this.renderer=t,this.emitter=new pW(t,this),this.add(this.emitter),this.updateParticleState(this.data)}update(t){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=t,this.stopped||(this.currentLoopTime+=t);let e="one_time"===this.data.emitTimeCycle;if(("loop"===this.data.emitTimeCycle||e)&&this.currentLoopTime>1e3*this.data.emitTimeDuration&&(this.stopped||(this.stop(),e||this.start(1e3*this.data.emitTimeDelay))),this.emitter&&this.started){let e=this.actualTime/1e3;this.emitter.update(e,t)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(t){return this.colliderEntities.some((e=>e.identity===t))}getColliderData(t){let e=this.colliderEntities.find((e=>e.identity===t));return e?e.data:null}updateByPatchedOp(t,e,n){super.updateByPatchedOp(t,e,n),$R(t.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...xR.drop(t,1).props}}),$R(t.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...xR.drop(t,1).props}})}updateState(t,e){super.updateState(t,e),this.updateParticleState(t)}updateParticleState(t){if(this.emitter){if(void 0!==t.colliderEntityId&&null!==t.colliderEntityId){let e=this.context.scene.find(t.colliderEntityId);this.colliderEntities=e?[e]:[]}null===t.colliderEntityId&&(this.colliderEntities=[]),this.emitter.updateState(t),t.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(t){!this.emitter||(this.emitter.updateForceFieldParameters(t),this.stop(),this.start())}start(t=0){this.currentLoopTime=0,t?this.timeoutId=window.setTimeout((()=>{this.start(0)}),t):(this.started=!0,this.stopped=!1,this.isFrozen=!1,this.emitter?.startEmitting(this.actualTime/1e3))}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){this.stopped=!0,this.currentLoopTime=0,this.emitter?.stopEmitting(),clearTimeout(this.timeoutId)}reset(){this.started=!1,this.stopped=!1,this.emitter?.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};var mW=function(){try{let t=window.location.href;if(t.includes("reducesubdiv=")){let e=t.indexOf("reducesubdiv=")+13;return parseInt(t.slice(e,e+1))}}catch{}}();function gW(t,e,n){return console.assert(void 0!==e.type),"Mesh"===e.type?function(t,e,n){let i;return void 0!==mW&&(e?.geometry?.subdivisions??0)>mW&&(console.log("reducing subdivisions",e.name,e.geometry.subdivisions),e.geometry.subdivisions=mW),"TextGeometry"===e.geometry.type?new Hj(t,e,n):"InputGeometry"===e.geometry.type?new QG(t,e,n):(i="SubdivGeometry"===e.geometry.type?new xj(t,e,n):"PathGeometry"===e.geometry.type?new JG(t,e,n):"VectorGeometry"===e.geometry.type?new KG(t,e,n):"BooleanGeometry"===e.geometry.type?new TH(t,e,n):"ShapeBlendGeometry"===e.geometry.type?new SW(t,e,n):"UIGeometry"===e.geometry.type?new sW(t,e,n):new pj(t,e,n),i)}(t,e,n):"Empty"===e.type?new zH(t,e):"Particle"===e.type?new fW(t,e,n):"ParticleCollider"===e.type?new NH(t,e,n):"Splat"===e.type?new zH(t,e):"Bone"===e.type?new rW(t,e):"Page"===e.type?new YG(t,e,n):"PointLight"===e.type?new ZG(t,e,n):"SpotLight"===e.type?new YH(t,e,n):"DirectionalLight"===e.type?new WH(t,e,n):"Component"===e.type||"Instance"===e.type?new tW(t,e,n):BD.is(e.type)?new wH(t,e):(console.error(e),new zH(t,e))}Ez.createEntity=gW,Ez.changeEntityProptotype=function(t,e,n){let i=gW(t.identity,e,n),r=t.children,s=t.attachedPaths,a=t.parent,o=t.component,l=t.instances,c=t.overrideData,h=t.uuid,u=t.stateSelection;t.dispose();for(let e of Object.keys(t))delete t[e];Object.setPrototypeOf(t,Object.getPrototypeOf(i));for(let e of Object.keys(i))t[e]=i[e];t.children=[...t.children,...r],t.attachedPaths=s,t.parent=a,t.component=o,t.instances=l,t.uuid=h,t.overrideData=c,t.updateState(t.data,n),u&&t.changeSelectedState(u,n),t.resetBBoxNeedsUpdate()},Ez.Cloner=nH;var vW=new Nv;vW.setAttribute("position",new Tv(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),3));var yW=class extends tS{constructor(t){super({...t,depthTest:!1,depthWrite:!1,glslVersion:im,vertexShader:"\n\t\t\t\tprecision highp float;\n\t\t\t\tin vec3 position;\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_Position = vec4(position, 1);\n\t\t\t\t}\n\t\t\t"})}customProgramCacheKey(){return""}};var xW=new ly,bW=96,_W={shapeInput:()=>"\n\t\t\tconst float posRowCoord = 0.1;  // vec4: px py pz opType\n\t\t\tconst float quatRowCoord = 0.3;  // vec4: qx qy qz qw\n\t\t\tconst float param1RowCoord = 0.5;// vec4: type param1 param2 param3\n\t\t\tconst float param2RowCoord = 0.7;// vec4: blendRange roundness scale param4\n\t\t\tconst float colorRowCoord = 0.9; // vec4: r g b a\n\t\t\tuniform sampler2D shapesDataTexture;\n\t\t\tvec4 shapePos(float iin) { \n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, posRowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeQuat(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, quatRowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeParams1(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, param1RowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeParams2(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, param2RowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tvec4 shapeColor(float iin) {\n\t\t\t\tvec4 r = texture(shapesDataTexture, vec2(iin, colorRowCoord));\n\t\t\t\treturn r;\n\t\t\t}\n\t\t",getxyzi:"\n\t\t\t// this code must complement lookup\n\t\t\tfloat xi = mod(gl_FragCoord.x - 0.5, VOXEL_RESOLUTION);\n\t\t\tfloat yi = mod(gl_FragCoord.y - 0.5, VOXEL_RESOLUTION);\n\t\t\tfloat zi = floor((gl_FragCoord.x - 0.5) * INV_VOXEL_RESOLUTION) + floor((gl_FragCoord.y - 0.5) * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;\n\t\t",lookup:"\n\t\t\tuniform sampler2D potentialPassTexture;\n\t\t\tuniform sampler2D voxelPassTexture; // includes normal (in xyz) and key (in w)\n\t\t\t\n\t\t\t// box or marching cube lookup value in value texture, integer box coord inputs\n\t\t\t// this code must complement codebits.getxyzi\n\t\t\tvec4 look(float xi, float yi, float zi, sampler2D rt) {// range 0 .. numv etc\n\t\t\t\tvec2 uv = vec2(\n\t\t\t\t\tmod(zi, Z_LAYERS_PER_ROW) + (xi + 0.5) / VOXEL_RESOLUTION,\n\t\t\t\t\tfloor(zi / Z_LAYERS_PER_ROW) + (yi + 0.5) / VOXEL_RESOLUTION\n\t\t\t\t); \n\t\t\t\tuv /= Z_LAYERS_PER_ROW;\n\t\t\t\treturn texture(rt, uv);\n\t\t\t}\n\t\t",getpart:"\n\t\t\tfloat getpart(inout float a, float b) {\n\t\t\t\tfloat t = floor(a/b);\n\t\t\t\tfloat r = a - t*b;\n\t\t\t\ta = t;\n\t\t\t\treturn r;\n\t\t\t}\n\t\t",triTable:new Float32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,1,8,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,9,9,2,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,2,8,10,2,8,9,10,-1,-1,-1,-1,-1,-1,-1,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,0,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,1,11,9,1,11,8,9,-1,-1,-1,-1,-1,-1,-1,1,10,3,3,10,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,10,0,10,8,0,10,11,8,-1,-1,-1,-1,-1,-1,-1,0,9,3,9,11,3,9,10,11,-1,-1,-1,-1,-1,-1,-1,10,8,9,11,8,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,4,3,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,4,1,7,4,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,2,1,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,3,4,0,3,10,2,1,-1,-1,-1,-1,-1,-1,-1,10,2,9,2,0,9,7,4,8,-1,-1,-1,-1,-1,-1,-1,9,10,2,7,9,2,3,7,2,4,9,7,-1,-1,-1,-1,7,4,8,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,11,4,2,11,4,0,2,-1,-1,-1,-1,-1,-1,-1,1,0,9,7,4,8,11,3,2,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,9,2,11,9,1,2,9,-1,-1,-1,-1,1,10,3,10,11,3,4,8,7,-1,-1,-1,-1,-1,-1,-1,10,11,1,11,4,1,4,0,1,4,11,7,-1,-1,-1,-1,8,7,4,11,0,9,10,11,9,3,0,11,-1,-1,-1,-1,11,7,4,9,11,4,10,11,9,-1,-1,-1,-1,-1,-1,-1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,9,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,0,0,5,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,8,5,3,8,5,1,3,-1,-1,-1,-1,-1,-1,-1,10,2,1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,10,2,1,5,9,4,-1,-1,-1,-1,-1,-1,-1,10,2,5,2,4,5,2,0,4,-1,-1,-1,-1,-1,-1,-1,5,10,2,5,2,3,4,5,3,8,4,3,-1,-1,-1,-1,4,5,9,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,11,8,0,5,9,4,-1,-1,-1,-1,-1,-1,-1,4,5,0,5,1,0,11,3,2,-1,-1,-1,-1,-1,-1,-1,5,1,2,8,5,2,11,8,2,5,8,4,-1,-1,-1,-1,11,3,10,3,1,10,4,5,9,-1,-1,-1,-1,-1,-1,-1,5,9,4,1,8,0,1,10,8,10,11,8,-1,-1,-1,-1,0,4,5,11,0,5,10,11,5,3,0,11,-1,-1,-1,-1,8,4,5,10,8,5,11,8,10,-1,-1,-1,-1,-1,-1,-1,8,7,9,9,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,9,3,5,9,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,7,0,7,1,0,7,5,1,-1,-1,-1,-1,-1,-1,-1,3,5,1,7,5,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,9,7,5,9,2,1,10,-1,-1,-1,-1,-1,-1,-1,2,1,10,0,5,9,0,3,5,3,7,5,-1,-1,-1,-1,2,0,8,5,2,8,7,5,8,2,5,10,-1,-1,-1,-1,5,10,2,3,5,2,7,5,3,-1,-1,-1,-1,-1,-1,-1,5,9,7,9,8,7,2,11,3,-1,-1,-1,-1,-1,-1,-1,7,5,9,2,7,9,0,2,9,11,7,2,-1,-1,-1,-1,11,3,2,8,1,0,8,7,1,7,5,1,-1,-1,-1,-1,1,2,11,7,1,11,5,1,7,-1,-1,-1,-1,-1,-1,-1,8,5,9,7,5,8,3,1,10,11,3,10,-1,-1,-1,-1,0,7,5,9,0,5,0,11,7,10,0,1,0,10,11,-1,0,10,11,3,0,11,0,5,10,7,0,8,0,7,5,-1,5,10,11,5,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,9,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,8,9,1,6,10,5,-1,-1,-1,-1,-1,-1,-1,5,6,1,1,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,1,6,2,1,8,0,3,-1,-1,-1,-1,-1,-1,-1,5,6,9,6,0,9,6,2,0,-1,-1,-1,-1,-1,-1,-1,8,9,5,2,8,5,6,2,5,8,2,3,-1,-1,-1,-1,11,3,2,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,11,0,2,11,5,6,10,-1,-1,-1,-1,-1,-1,-1,9,1,0,11,3,2,6,10,5,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,9,1,2,11,9,11,8,9,-1,-1,-1,-1,11,3,6,3,5,6,3,1,5,-1,-1,-1,-1,-1,-1,-1,11,8,0,5,11,0,1,5,0,6,11,5,-1,-1,-1,-1,6,11,3,6,3,0,5,6,0,9,5,0,-1,-1,-1,-1,9,5,6,11,9,6,8,9,11,-1,-1,-1,-1,-1,-1,-1,6,10,5,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,3,7,4,10,5,6,-1,-1,-1,-1,-1,-1,-1,0,9,1,6,10,5,7,4,8,-1,-1,-1,-1,-1,-1,-1,5,6,10,7,9,1,3,7,1,4,9,7,-1,-1,-1,-1,2,1,6,1,5,6,8,7,4,-1,-1,-1,-1,-1,-1,-1,5,2,1,6,2,5,4,0,3,7,4,3,-1,-1,-1,-1,7,4,8,5,0,9,5,6,0,6,2,0,-1,-1,-1,-1,9,3,7,4,9,7,9,2,3,6,9,5,9,6,2,-1,2,11,3,4,8,7,5,6,10,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,7,4,0,2,4,11,7,2,-1,-1,-1,-1,9,1,0,8,7,4,11,3,2,6,10,5,-1,-1,-1,-1,1,2,9,2,11,9,11,4,9,4,11,7,6,10,5,-1,7,4,8,5,11,3,1,5,3,6,11,5,-1,-1,-1,-1,11,1,5,6,11,5,11,0,1,4,11,7,11,4,0,-1,9,5,0,5,6,0,6,3,0,3,6,11,7,4,8,-1,9,5,6,11,9,6,9,7,4,9,11,7,-1,-1,-1,-1,9,4,10,10,4,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,4,10,9,4,3,8,0,-1,-1,-1,-1,-1,-1,-1,1,0,10,0,6,10,0,4,6,-1,-1,-1,-1,-1,-1,-1,1,3,8,6,1,8,4,6,8,10,1,6,-1,-1,-1,-1,9,4,1,4,2,1,4,6,2,-1,-1,-1,-1,-1,-1,-1,8,0,3,9,2,1,9,4,2,4,6,2,-1,-1,-1,-1,4,2,0,6,2,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,4,2,8,6,2,4,-1,-1,-1,-1,-1,-1,-1,9,4,10,4,6,10,3,2,11,-1,-1,-1,-1,-1,-1,-1,2,8,0,11,8,2,10,9,4,6,10,4,-1,-1,-1,-1,2,11,3,6,1,0,4,6,0,10,1,6,-1,-1,-1,-1,1,4,6,10,1,6,1,8,4,11,1,2,1,11,8,-1,4,6,9,6,3,9,3,1,9,3,6,11,-1,-1,-1,-1,1,11,8,0,1,8,1,6,11,4,1,9,1,4,6,-1,6,11,3,0,6,3,4,6,0,-1,-1,-1,-1,-1,-1,-1,8,4,6,8,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,7,10,8,7,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,7,0,7,10,0,10,9,0,10,7,6,-1,-1,-1,-1,7,6,10,7,10,1,8,7,1,0,8,1,-1,-1,-1,-1,7,6,10,1,7,10,3,7,1,-1,-1,-1,-1,-1,-1,-1,6,2,1,8,6,1,9,8,1,7,6,8,-1,-1,-1,-1,9,6,2,1,9,2,9,7,6,3,9,0,9,3,7,-1,0,8,7,6,0,7,2,0,6,-1,-1,-1,-1,-1,-1,-1,2,3,7,2,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,3,2,8,6,10,9,8,10,7,6,8,-1,-1,-1,-1,7,0,2,11,7,2,7,9,0,10,7,6,7,10,9,-1,0,8,1,8,7,1,7,10,1,10,7,6,11,3,2,-1,1,2,11,7,1,11,1,6,10,1,7,6,-1,-1,-1,-1,6,9,8,7,6,8,6,1,9,3,6,11,6,3,1,-1,1,9,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,6,0,7,0,11,3,0,6,11,-1,-1,-1,-1,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,8,1,3,8,6,7,11,-1,-1,-1,-1,-1,-1,-1,2,1,10,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,8,0,3,7,11,6,-1,-1,-1,-1,-1,-1,-1,0,9,2,9,10,2,7,11,6,-1,-1,-1,-1,-1,-1,-1,7,11,6,3,10,2,3,8,10,8,9,10,-1,-1,-1,-1,3,2,7,7,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,7,0,6,7,0,2,6,-1,-1,-1,-1,-1,-1,-1,6,7,2,7,3,2,9,1,0,-1,-1,-1,-1,-1,-1,-1,2,6,1,6,8,1,8,9,1,6,7,8,-1,-1,-1,-1,6,7,10,7,1,10,7,3,1,-1,-1,-1,-1,-1,-1,-1,6,7,10,10,7,1,7,8,1,8,0,1,-1,-1,-1,-1,7,3,0,10,7,0,9,10,0,7,10,6,-1,-1,-1,-1,10,6,7,8,10,7,9,10,8,-1,-1,-1,-1,-1,-1,-1,4,8,6,6,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,3,6,0,3,6,4,0,-1,-1,-1,-1,-1,-1,-1,11,6,8,6,4,8,1,0,9,-1,-1,-1,-1,-1,-1,-1,6,4,9,3,6,9,1,3,9,6,3,11,-1,-1,-1,-1,4,8,6,8,11,6,1,10,2,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,0,3,11,6,0,6,4,0,-1,-1,-1,-1,8,11,4,11,6,4,9,2,0,9,10,2,-1,-1,-1,-1,3,9,10,2,3,10,3,4,9,6,3,11,3,6,4,-1,3,2,8,2,4,8,2,6,4,-1,-1,-1,-1,-1,-1,-1,2,4,0,2,6,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,4,3,2,6,4,2,8,3,4,-1,-1,-1,-1,4,9,1,2,4,1,6,4,2,-1,-1,-1,-1,-1,-1,-1,3,1,8,1,6,8,6,4,8,1,10,6,-1,-1,-1,-1,0,1,10,6,0,10,4,0,6,-1,-1,-1,-1,-1,-1,-1,3,6,4,8,3,4,3,10,6,9,3,0,3,9,10,-1,4,9,10,4,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,9,4,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,5,9,4,6,7,11,-1,-1,-1,-1,-1,-1,-1,1,0,5,0,4,5,11,6,7,-1,-1,-1,-1,-1,-1,-1,6,7,11,4,3,8,4,5,3,5,1,3,-1,-1,-1,-1,4,5,9,2,1,10,11,6,7,-1,-1,-1,-1,-1,-1,-1,7,11,6,10,2,1,3,8,0,5,9,4,-1,-1,-1,-1,11,6,7,10,4,5,10,2,4,2,0,4,-1,-1,-1,-1,8,4,3,4,5,3,5,2,3,2,5,10,6,7,11,-1,3,2,7,2,6,7,9,4,5,-1,-1,-1,-1,-1,-1,-1,4,5,9,6,8,0,2,6,0,7,8,6,-1,-1,-1,-1,2,6,3,6,7,3,0,5,1,0,4,5,-1,-1,-1,-1,8,2,6,7,8,6,8,1,2,5,8,4,8,5,1,-1,4,5,9,6,1,10,6,7,1,7,3,1,-1,-1,-1,-1,10,6,1,6,7,1,7,0,1,0,7,8,4,5,9,-1,10,0,4,5,10,4,10,3,0,7,10,6,10,7,3,-1,10,6,7,8,10,7,10,4,5,10,8,4,-1,-1,-1,-1,5,9,6,9,11,6,9,8,11,-1,-1,-1,-1,-1,-1,-1,11,6,3,3,6,0,6,5,0,5,9,0,-1,-1,-1,-1,8,11,0,11,5,0,5,1,0,11,6,5,-1,-1,-1,-1,3,11,6,5,3,6,1,3,5,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,5,9,8,11,9,6,5,11,-1,-1,-1,-1,3,11,0,11,6,0,6,9,0,9,6,5,10,2,1,-1,5,8,11,6,5,11,5,0,8,2,5,10,5,2,0,-1,3,11,6,5,3,6,3,10,2,3,5,10,-1,-1,-1,-1,9,8,5,8,2,5,2,6,5,2,8,3,-1,-1,-1,-1,6,5,9,0,6,9,2,6,0,-1,-1,-1,-1,-1,-1,-1,8,5,1,0,8,1,8,6,5,2,8,3,8,2,6,-1,6,5,1,6,1,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,3,1,10,6,1,6,8,3,9,6,5,6,9,8,-1,0,1,10,6,0,10,0,5,9,0,6,5,-1,-1,-1,-1,8,3,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,5,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,11,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,5,7,11,0,3,8,-1,-1,-1,-1,-1,-1,-1,7,11,5,11,10,5,0,9,1,-1,-1,-1,-1,-1,-1,-1,5,7,10,7,11,10,1,8,9,1,3,8,-1,-1,-1,-1,2,1,11,1,7,11,1,5,7,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,2,1,5,7,1,11,2,7,-1,-1,-1,-1,5,7,9,7,2,9,2,0,9,7,11,2,-1,-1,-1,-1,2,5,7,11,2,7,2,9,5,8,2,3,2,8,9,-1,10,5,2,5,3,2,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,2,8,2,5,8,5,7,8,5,2,10,-1,-1,-1,-1,1,0,9,3,10,5,7,3,5,2,10,3,-1,-1,-1,-1,2,8,9,1,2,9,2,7,8,5,2,10,2,5,7,-1,5,3,1,5,7,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,1,7,0,5,7,1,-1,-1,-1,-1,-1,-1,-1,3,0,9,5,3,9,7,3,5,-1,-1,-1,-1,-1,-1,-1,7,8,9,7,9,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,5,8,10,5,8,11,10,-1,-1,-1,-1,-1,-1,-1,4,0,5,0,11,5,11,10,5,0,3,11,-1,-1,-1,-1,9,1,0,10,4,8,11,10,8,5,4,10,-1,-1,-1,-1,4,11,10,5,4,10,4,3,11,1,4,9,4,1,3,-1,1,5,2,5,8,2,8,11,2,8,5,4,-1,-1,-1,-1,11,4,0,3,11,0,11,5,4,1,11,2,11,1,5,-1,5,2,0,9,5,0,5,11,2,8,5,4,5,8,11,-1,5,4,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,2,2,5,3,5,4,3,4,8,3,-1,-1,-1,-1,2,10,5,4,2,5,0,2,4,-1,-1,-1,-1,-1,-1,-1,2,10,3,10,5,3,5,8,3,8,5,4,9,1,0,-1,2,10,5,4,2,5,2,9,1,2,4,9,-1,-1,-1,-1,5,4,8,3,5,8,1,5,3,-1,-1,-1,-1,-1,-1,-1,5,4,0,5,0,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,4,8,3,5,8,5,0,9,5,3,0,-1,-1,-1,-1,5,4,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,11,4,11,9,4,11,10,9,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,9,4,7,11,9,11,10,9,-1,-1,-1,-1,11,10,1,4,11,1,0,4,1,11,4,7,-1,-1,-1,-1,4,1,3,8,4,3,4,10,1,11,4,7,4,11,10,-1,7,11,4,4,11,9,11,2,9,2,1,9,-1,-1,-1,-1,4,7,9,7,11,9,11,1,9,1,11,2,3,8,0,-1,4,7,11,2,4,11,0,4,2,-1,-1,-1,-1,-1,-1,-1,4,7,11,2,4,11,4,3,8,4,2,3,-1,-1,-1,-1,10,9,2,9,7,2,7,3,2,9,4,7,-1,-1,-1,-1,7,10,9,4,7,9,7,2,10,0,7,8,7,0,2,-1,10,7,3,2,10,3,10,4,7,0,10,1,10,0,4,-1,2,10,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,3,1,7,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,1,8,0,1,7,8,-1,-1,-1,-1,3,0,4,3,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,10,9,8,11,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,10,9,11,-1,-1,-1,-1,-1,-1,-1,10,1,0,8,10,0,11,10,8,-1,-1,-1,-1,-1,-1,-1,10,1,3,10,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,1,9,11,1,8,11,9,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,9,2,1,9,11,2,-1,-1,-1,-1,11,2,0,11,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,9,8,10,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,8,1,0,8,10,1,-1,-1,-1,-1,2,10,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),numTrisTable:new Float32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0])},wW=class extends pj{constructor(t,e,n){super(t,e,n),this.data=e,this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!1,this._npart=-1,this.spatialn=1,this.drawRangeNeedsForceUpdate=!0,this._resolutionLevel=-1,this.resolution=64,this.spatialDivisions=25,this.zLayersPerRow=8,this.basePyramidSize=512,this.pyramidTexture1Width=341,this.pyramidTexture1Height=256,this.pyramidTexture2Width=170,this.pyramidTexture2Height=128,this.numLevels=9,this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=0,this.bboxOffset=0,this.shapesDataTexture={value:void 0},this.spatialscene=new f_,this.potentialPassScene=new f_,this.voxelPassScene=new f_,this._spatialPassRenderTargets=[],this._potentialPassRenderTargets=[],this._voxelPassRenderTargets=[],this._pyramidRenderTargets=[],this.geometry=new Nv,this.geometry.drawRange.count=0,this.spatialPassUniforms={span:{value:-1},shapesDataTexture:this.shapesDataTexture,npart:{value:this.npart},spatialn:{value:this.spatialn}},this.spatialMesh=new ty(vW,this.spatialPassMaterial()),this.spatialMesh.frustumCulled=!1,this.spatialscene.add(this.spatialMesh);let i=new x_(_W.triTable,16,256,Xp,Ip);i.needsUpdate=!0;let r=new x_(_W.numTrisTable,256,1,Xp,Ip);r.needsUpdate=!0,this.voxelPassUniforms={potentialPassTexture:{value:void 0},numTrisTable:{value:r}},this.voxelMesh=new ty(vW,this.voxelPassMaterial()),this.voxelMesh.frustumCulled=!1,this.voxelPassScene.add(this.voxelMesh),this.potentialPassUniforms={shapesDataTexture:this.shapesDataTexture,spatialPassTexture:{value:void 0},npart:{value:this.npart},spatialn:{value:this.spatialn}},this.potentialMesh=new ty(vW,this.potentialPassMaterial()),this.potentialMesh.frustumCulled=!1,this.potentialPassScene.add(this.potentialMesh),this.marchPassUniforms={triTable:{value:i},potentialPassTexture:{value:void 0},voxelPassTexture:{value:void 0},pyramidTexture1:{value:void 0},pyramidTexture1Size:{value:void 0},pyramidTexture2:{value:void 0},pyramidTexture2Size:{value:void 0}},this.frustumCulled=!1,this.onBeforeShadowPass=t=>{if(DW.call(this),0===this.npart)return void(this.geometry.drawRange.count=0);let e=this.material.root;if(e.shadersPatchedForShapeBlend){if(this.customDepthMaterialNeedsUpdate){this.customDepthMaterialNeedsUpdate=!1,this.customDepthMaterial=new oy({vertexShader:e.vertexShader,fragmentShader:"\n\t\t\t\t\t\t#include <packing>\n\t\t\t\t\t\tvoid main()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n\t\t\t\t\t\t}\n\t\t\t\t\t",uniforms:e.uniforms,defines:this.material.defines}),this.isMeshDepthMaterial=!0,this.customDistanceMaterial=new oy({vertexShader:e.vertexShader,fragmentShader:"\n\t\t\t\t\t#include <common>\n\t\t\t\t\t#include <packing>\n\t\t\t\t\tuniform vec3 referencePosition;\n\t\t\t\t\tuniform float nearDistance;\n\t\t\t\t\tuniform float farDistance;\n\t\t\t\t\t// World-space position\n\t\t\t\t\tvarying vec3 vWPosition;\n\t\t\t\t\tvoid main()\n\t\t\t\t\t{\n\t\t\t\t\t\tfloat dist = length(vWPosition - referencePosition);\n\t\t\t\t\t\tdist = (dist - nearDistance) / (farDistance - nearDistance);\n\t\t\t\t\t\tdist = saturate(dist);\n\t\t\t\t\t\t// Required by Three.js for this to work\n\t\t\t\t\t\tgl_FragColor = packDepthToRGBA( dist );\n\t\t\t\t\t}",uniforms:{nearDistance:{value:0},farDistance:{value:0},referencePosition:{value:new $m},opacity:{value:0},...e.uniforms},defines:this.material.defines});let t=this.customDistanceMaterial;t.referencePosition=new $m,t.nearDistance=0,t.farDistance=0,t.opacity=1,t.isMeshDistanceMaterial=!0}}else this.patchVertexShaderForShapeBlend(e),e.shadersPatchedForShapeBlend=!0,this.customDepthMaterialNeedsUpdate=!0;if(this.spatialPassUniforms.npart.value=this.npart,this.spatialPassUniforms.spatialn.value=this.spatialn,this.potentialPassUniforms.npart.value=this.npart,this.potentialPassUniforms.spatialn.value=this.spatialn,this.needsRebuild){this.needsRebuild=!1,this.spatialMesh.material.defines.RES=this.resolutionLevel,this.spatialMesh.material.needsUpdate=!0,this.potentialMesh.material.defines.RES=this.resolutionLevel,this.potentialPassUniforms.spatialPassTexture.value=this.spatialPassRenderTarget.texture,this.potentialMesh.material.needsUpdate=!0,this.voxelMesh.material.defines.RES=this.resolutionLevel,this.voxelMesh.material.needsUpdate=!0,this.voxelPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.voxelPassTexture.value=this.voxelPassRenderTarget.texture[0],this.material.defines.RES=this.resolutionLevel,this.material.defines.LEVELS=this.pyramidLevelSizes.length,this.material.defines.LOOP=this.pyramidLevelSizes.length%2==0?this.pyramidLevelSizes.length-3:this.pyramidLevelSizes.length-2,this.material.defines.HALF=this.pyramidLevelSizes.length%2==0?1:0,this.material.needsUpdate=!0;let t=this.pyramidLevelSizes.length%2==0?0:1,e=this.pyramidLevelSizes.length%2==0?1:0;this.marchPassUniforms.pyramidTexture2.value=this.pyramidRenderTarget[t].texture,this.marchPassUniforms.pyramidTexture2Size.value=new ym(this.pyramidRenderTarget[t].width,this.pyramidRenderTarget[t].height),this.marchPassUniforms.pyramidTexture1.value=this.pyramidRenderTarget[e].texture,this.marchPassUniforms.pyramidTexture1Size.value=new ym(this.pyramidRenderTarget[e].width,this.pyramidRenderTarget[e].height),Object.assign(this.material.uniforms,this.marchPassUniforms)}let n=t.shadowMap.enabled;t.shadowMap.enabled=!1;let i=t.getRenderTarget();t.setRenderTarget(this.spatialPassRenderTarget),t.render(this.spatialscene,xW),t.setRenderTarget(this.potentialPassRenderTarget),t.render(this.potentialPassScene,xW),t.setRenderTarget(this.voxelPassRenderTarget),t.render(this.voxelPassScene,xW),wW.streamCompaction.renderPyramid(this.resolutionLevel,this.pyramidLevelSizes,t,this.voxelPassRenderTarget,this.pyramidRenderTarget).then((t=>{this.material.wireframe&&(3*t>this.geometry.attributes.position.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.dispose(),this.geometry=new Nv,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.geometry.attributes.position=new Tv(new Float32Array(3*t*2),3)),(3*t>this.geometry.drawRange.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.drawRange.count=3*Math.floor(1.2*t)),this.drawRangeNeedsForceUpdate=!1})),t.shadowMap.enabled=n,t.setRenderTarget(i)}}set npart(t){t!==this._npart&&(this.drawRangeNeedsForceUpdate=!0,this._npart=t,this.spatialn=Math.ceil(t/96))}get npart(){return this._npart}set resolutionLevel(t){let e=Math.min(8,Math.max(5,t));if(e!==this._resolutionLevel){switch(this._resolutionLevel=e,this.resolution=Math.pow(2,e),this.resolutionLevel){case 5:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192],this.bboxSize=496,this.bboxOffset=-8;break;case 6:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=504,this.bboxOffset=-4;break;case 7:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192,384,768,1536],this.bboxSize=508,this.bboxOffset=-2;break;case 8:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096],this.bboxSize=510,this.bboxOffset=-1}this.pyramidTexture1Width=0,this.pyramidTexture2Width=0,this.pyramidTexture1Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-2],this.pyramidTexture2Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-3];for(let t=this.pyramidLevelSizes.length-2;t>=0;t--)(this.pyramidLevelSizes.length-2)%2==t%2?this.pyramidTexture1Width+=this.pyramidLevelSizes[t]:this.pyramidTexture2Width+=this.pyramidLevelSizes[t];this.basePyramidSize=this.pyramidLevelSizes[this.pyramidLevelSizes.length-1],this.zLayersPerRow=this.basePyramidSize/this.resolution,this.numLevels=this.pyramidLevelSizes.length-1,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.needsRebuild=!0}}get resolutionLevel(){return this._resolutionLevel}get spatialPassRenderTarget(){let t=this._spatialPassRenderTargets[this.resolutionLevel];return t||(t=new Gm(this.spatialDivisions*this.spatialn,this.spatialDivisions**2,{format:jp,type:Ip,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:wp,magFilter:wp}),this._spatialPassRenderTargets[this.resolutionLevel]=t),t}get potentialPassRenderTarget(){let t=this._potentialPassRenderTargets[this.resolutionLevel];return t||(t=new Gm(this.basePyramidSize,this.basePyramidSize,{format:jp,type:Ip,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:wp,magFilter:wp}),this._potentialPassRenderTargets[this.resolutionLevel]=t),t}get voxelPassRenderTarget(){let t=this._voxelPassRenderTargets[this.resolutionLevel];return t||(t=new xM(this.basePyramidSize,this.basePyramidSize,2,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:wp,magFilter:wp}),t.texture[0].format=jp,t.texture[0].type=Ip,t.texture[1].format=Xp,t.texture[1].type=Ip,this._voxelPassRenderTargets[this.resolutionLevel]=t),t}get pyramidRenderTarget(){let t=this._pyramidRenderTargets[this.resolutionLevel];if(!t){t=[new Gm(this.pyramidTexture1Width,this.pyramidTexture1Height,{format:jp,type:Ip,stencilBuffer:!1,depthBuffer:!1,magFilter:wp,minFilter:wp}),new Gm(this.pyramidTexture2Width,this.pyramidTexture2Height,{format:jp,type:Ip,stencilBuffer:!1,depthBuffer:!1,magFilter:wp,minFilter:wp})],this._pyramidRenderTargets[this.resolutionLevel]=t}return t}updateState(t,e){let n=this.material;super.updateState(t,e),n!==this.material&&(this.needsRebuild=!0),t.geometry&&(this.resolutionLevel=t.geometry.resolutionLevel,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]}),t.wireframe&&!this.geometry.getAttribute("position")?this.geometry.setAttribute("position",new Tv(new Float32Array(3*this.geometry.drawRange.count),3)):!t.wireframe&&this.geometry.getAttribute("position")&&this.geometry.deleteAttribute("position")}spatialPassMaterial(){let t=`\n\t\t\tprecision highp float;\n\t\t\tout vec4 pc_FragColor;\n\t\t\tconst float spatialDivisions = ${this.spatialDivisions}.;\n\t\t\tuniform float span;\n\t\t\tuniform float npart;\n\t\t\tuniform float spatialn;\n\t\t\t${_W.shapeInput()}\n\n\t\t\tvec3 low, high;     // range of current div; subset of -1 .. 1 with span border\n\n\t\t\t// lookup one element/channel's worth of spheres for current division\n\t\t\t// stating with low sphere number lowi\n\t\t\t// gives a key to which spheres from lowi..lowi+23 are active within given div (low..high)\n\t\t\tfloat spatialKey(float lowi) {\n\t\t\t\tfloat t = 0.;\n\t\t\t\tfor (float ii = 23.; ii >= 0.; ii--) {\n\t\t\t\t\tfloat i = ii + lowi;\n\t\t\t\t\tfloat iin = (i + 0.5) / 96.;\n\t\t\t\t\tvec4 shape = shapePos(iin);\n\t\t\t\t\tvec3 d = shape.xyz;\n\t\t\t\t\tfloat op = shape.w;\n\t\n\t\t\t\t\tt *= 2.;\n\t\t\t\t\tt += (\n\t\t\t\t\t\tlow.x < d.x && d.x < high.x &&\n\t\t\t\t\t\tlow.y < d.y && d.y < high.y &&\n\t\t\t\t\t\tlow.z < d.z && d.z < high.z &&\n\t\t\t\t\t\ti < npart || op == -2. // always include if op is -2, which is the intersection operation\n\t\t\t\t\t) ? 1. : 0.;\n\t\t\t\t}\n\t\t\t\treturn t;\n\t\t\t}\n\n\t\t\t${_W.getpart}\n\n\t\t\tvoid main() {               // spatialial fragment shader\n\t\t\t\t// find active div\n\t\t\t\tvec3 div;                               // which div is current\n\t\t\t\t// out holds x=> x, lowi faster moving and y=> z, y faster moving\n\t\t\t\tfloat yz = float(gl_FragCoord.y - 0.5);     // contains  z, y faster moving\n\t\t\t\tdiv.y = getpart(yz, spatialDivisions);\n\t\t\t\tdiv.z = yz; // getpart(yz, spatialDivisions.z); // what's left, should be the same as getpart\n\n\t\t\t\tfloat lx = float(gl_FragCoord.x - 0.5);     // contains x, lowi faster moving\n\t\t\t\tfloat lowi = getpart(lx, spatialn) * 96.;\n\t\t\t\tdiv.x = lx;\n\n\t\t\t\tlow = div / spatialDivisions * 2. - 1. - span;\n\t\t\t\thigh = (div+1.) / spatialDivisions * 2. - 1. + span;\n\n\t\t\t\t// find active range of spheres\n\t\t\t\tpc_FragColor.x = spatialKey(lowi);\n\t\t\t\tpc_FragColor.y = spatialKey(lowi+24.);\n\t\t\t\tpc_FragColor.z = spatialKey(lowi+48.);\n\t\t\t\tpc_FragColor.w = spatialKey(lowi+72.);\n\t\t\t}\n\t\t`;return new yW({name:"Spatial Pass",fragmentShader:t,uniforms:this.spatialPassUniforms})}potentialPassMaterial(){let t=`\n\t\t\tprecision highp float;\n\t\t\tout vec4 pc_FragColor;\n\n\t\t\t${_W.shapeInput()}\n\t\t\tuniform sampler2D spatialPassTexture;\n\n\t\t\tconst float res = float(RES);\n\t\t\tconst float VOXEL_RESOLUTION = pow(2., res);\n\t\t\tconst float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));\n\t\t\tconst float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.;\n\t\t\tconst float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;\n\n\t\t\tuniform float npart;\n\t\t\tuniform float spatialn;\n\t\t\tconst float spatialDivisions = ${this.spatialDivisions}.;\n\t\t\tconst float spatialDivisions2 = spatialDivisions * spatialDivisions;\n\t\t\tconst float spatialDivisionsSub1 = spatialDivisions - 1.;\n\n\t\t\t${_W.getpart}\n\n\t\t\tvec3 packRGBAToVec3(vec4 color) {\n\t\t\t\tuint r = uint(color.r * 255.);\n\t\t\t\tuint g = uint(color.g * 255.);\n\t\t\t\tuint combined = (r << 8) | g; \n\t\t\t\treturn vec3(float(combined) * 0.00001525902, color.b, color.a); // 1/65535\n\t\t\t}\n\n\t\t\tvoid applyQuaternionToVector(in vec4 q, inout vec3 v) {\n\t\t\t\tv += 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * SDF functions (reference: https://iquilezles.org/articles/distfunctions/)\n\t\t\t */\n\n\t\t\t// branchless version of "Smooth Union, Subtraction and Intersection - bound, bound, bound" in above reference\n\t\t\tfloat smoothOperation(float op, float sdf, float d, float k) {\n\t\t\t  //        union: op =  1 => signSubtract =  1, signIntersection =  1\n\t\t\t  //     subtract: op = -1 => signSubtract = -1, signIntersection =  1\n\t\t\t\t// intersection: op = -2 => signSubtract = -1, signIntersection = -1\n\n\t\t\t\tfloat signSubtract = clamp(op, -1., 1.);\n\t\t\t\tfloat signIntersection = 2. * (op - signSubtract) + 1.;\n\t\t\t\tfloat h = clamp(\n\t\t\t\t\t0.5 + signSubtract * 0.5 * (sdf - signSubtract * signIntersection * d) / k,\n\t\t\t\t\t0.0,\n\t\t\t\t\t1.0\n\t\t\t\t);\n\t\t\t\treturn mix(sdf, signSubtract * signIntersection * d, h) - \n\t\t\t\t\t\t\t signSubtract * k * h * (1.0 - h);\n\t\t\t}\n\n\t\t\tfloat sdSphere( vec3 p, float s )\n\t\t\t{\n\t\t\t\treturn length(p)-s;\n\t\t\t}\n\n\t\t\tfloat sdEllipsoid( vec3 p, vec3 r )\n\t\t\t{\n\t\t\t\tfloat k0 = length(p/r);\n\t\t\t\tfloat k1 = length(p/(r*r));\n\t\t\t\treturn k0*(k0-1.0)/k1;\n\t\t\t}\n\n\t\t\tfloat sdBox( vec3 p, vec3 b )\n\t\t\t{\n\t\t\t\tvec3 q = abs(p) - b;\n\t\t\t\treturn length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);\n\t\t\t}\n\n\t\t\tfloat sdTorus( vec3 p, vec2 t )\n\t\t\t{\n\t\t\t\tvec2 q = vec2(length(p.xy)-t.x,p.z);\n\t\t\t\treturn length(q)-t.y;\n\t\t\t}\n\n\t\t\tfloat sdCappedTorus( vec3 p, vec2 sc, float ra, float rb)\n\t\t\t{\n\t\t\t\tp.x = abs(p.x);\n\t\t\t\tfloat k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);\n\t\t\t\treturn sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;\n\t\t\t}\n\n\t\t\tfloat dot2( in vec2 v ) { return dot(v,v); }\n\t\t\tfloat sdCappedCone( vec3 p, float h, float r1, float r2 )\n\t\t\t{\n\t\t\t\tvec2 q = vec2( length(p.xz), p.y );\n\t\t\t\tvec2 k1 = vec2(r2,h);\n\t\t\t\tvec2 k2 = vec2(r2-r1,2.0*h);\n\t\t\t\tvec2 ca = vec2(q.x-min(q.x,(q.y<0.0)?r1:r2), abs(q.y)-h);\n\t\t\t\tvec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );\n\t\t\t\tfloat s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0;\n\t\t\t\treturn s*sqrt( min(dot2(ca),dot2(cb)) );\n\t\t\t}\n\n\t\t\tfloat sdCappedCylinder( vec3 p, float h, float r )\n\t\t\t{\n\t\t\t\tvec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);\n\t\t\t\treturn min(max(d.x,d.y),0.0) + length(max(d,0.0));\n\t\t\t}\n\n\t\t\tfloat maxBlend = 0.0;\n\t\t\t// compute potential from A (=24) spheres, using the bit flags in 'activeKey'\n\t\t\t// to avoid lookup/compute for inactive spheres\n\t\t\t// return field potential, side effect updates track,\n\t\t\t// compute and return +ve and -ve values separately\n\t\t\tvoid fillSpatialInner(\n\t\t\t\tfloat ii,\n\t\t\t\tfloat activeKey,\n\t\t\t\tvec3 corner,\n\t\t\t\tinout float sdf,\n\t\t\t\tinout float colorDivisor,\n\t\t\t\tinout vec4 trackColor\n\t\t\t) {\n\t\t\t\tfor (float i = 0.; i < 24.; i++) {\n\t\t\t\t\tif (activeKey < 1.) break; // activeKey exhausted, no more active spheres\n\t\t\t\t\tactiveKey *= 0.5;\n\t\t\t\t\tif (fract(activeKey) < 0.5) continue;\n\n\t\t\t\t\tfloat iin = (i + ii + 0.5) * ${1/bW};\n\t\t\t\t\tvec4 shape = shapePos(iin);\n\t\t\t\t\tvec4 quat = shapeQuat(iin);\n\t\t\t\t\tvec4 params1 = shapeParams1(iin);\n\t\t\t\t\tvec4 params2 = shapeParams2(iin);\n\n\t\t\t\t\tvec3 p = corner - shape.xyz;\n\t\t\t\t\tapplyQuaternionToVector(quat, p);\n\t\t\t\t\tp /= params2.z; // scale\n\t\t\t\t\tfloat d; // d in -1..1 coordinates\n\t\t\t\t\tswitch (int(params1.x)) {\n\t\t\t\t\t\tcase 0: d = sdSphere(p, params1.y); break;\n\t\t\t\t\t\tcase 1: d = sdEllipsoid(p, params1.yzw); break;\n\t\t\t\t\t\tcase 2: d = sdBox(p, params1.yzw); break;\n\t\t\t\t\t\tcase 3: d = sdCappedCylinder(p, params1.y, params1.z); break;\n\t\t\t\t\t\tcase 4: d = sdCappedCone(p, params1.y, params1.z, params1.w); break;\n\t\t\t\t\t\tcase 5: d = sdTorus(p, params1.yz); break;\n\t\t\t\t\t\tcase 6: d = sdCappedTorus(p, params1.yz, params1.w, params2.w); break;\n\t\t\t\t\t}\n\t\t\t\t\td -= params2.y; // rounded edge\n\t\t\t\t\td *= params2.z; // scale\n\n\t\t\t\t\tfloat k = params2.x;\n\t\t\t\t\tfloat op = shape.w;\n\n\t\t\t\t\tsdf = smoothOperation(shape.w, sdf, d, k);\n\n\t\t\t\t\tfloat isNegativeOne = step(-1.5, op) * step(op, -0.5); // 1 when op == -1, 0 otherwise\n\t\t\t\t\tfloat colorCull = smoothstep(maxBlend, 0., -d);\n\t\t\t\t\tfloat cullFactor = mix(1.0, colorCull, isNegativeOne);\n\t\t\t\t\ttrackColor *= cullFactor;\n\t\t\t\t\tcolorDivisor *= cullFactor;\n\n\t\t\t\t\tmaxBlend = max(maxBlend, k);\n\n\t\t\t\t\tk += 2. * INV_VOXEL_RESOLUTION; // avoid division by zero, and other color artifacts with very small k\n\t\t\t\t\tfloat nearness = smoothstep(k, 0., d);\n\n\t\t\t\t\tvec4 color = shapeColor(iin);\n\t\t\t\t\tnearness *= float(color.a >= 0.);\n\n\t\t\t\t\tcolorDivisor += nearness;\n\t\t\t\t\ttrackColor += color * nearness;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvec3 div;\n\t\t\t// compute potential from all spheres; collect +ve and =ve values separately\n\t\t\t// work in blocks of A*4 (=96) spheres, using the bit flags in 4 float channel 'activeKey' values\n\t\t\t// TODO check if extra vec3 output useful, not really used at present\n\t\t\tfloat fillSpatial(vec3 corner, inout vec4 trackColor) {\n\t\t\t\tfloat sdf = 1e3; // hack: initialize to large value\n\t\t\t\tfloat colorDivisor = 0.;\n\t\t\t\t// spatialPassTexture holds x=> lowi, x faster moving and y=> z, y faster moving\n\t\t\t\tfloat divyz = (div.y + div.z * spatialDivisions + 0.5) / (spatialDivisions2);\n\t\t\t\tfor (float ii = 0.; ii < spatialn; ii++) {\n\t\t\t\t\tfloat i = ii * 96.;\n\n\t\t\t\t\tvec4 activeKey = texture(spatialPassTexture, vec2((div.x * spatialn + ii + 0.5)/(spatialn * spatialDivisions), divyz));\n\t\t\t\t\tfillSpatialInner(i, activeKey.x, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t\tfillSpatialInner(i+24., activeKey.y, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t\tfillSpatialInner(i+48., activeKey.z, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t\tfillSpatialInner(i+72., activeKey.w, corner, sdf, colorDivisor, trackColor);\n\t\t\t\t}\n\n\t\t\t\ttrackColor /= colorDivisor;\n\t\t\t\treturn mix(sdf, 0.0, step(1e20 - 0.1, sdf));\n\t\t\t}\n\n\t\t\tvoid main() {\n\t\t\t\t${_W.getxyzi}    // get xi yi zi from 2d position\n\n\t\t\t\tvec3 xyzi = vec3(xi,yi,zi);\n\t\t\t\tvec3 corner = xyzi / VOXEL_RESOLUTION_SUB1 * 2. - 1.;  // -1..1 coords\n\n\t\t\t\tdiv = floor(xyzi / VOXEL_RESOLUTION_SUB1 * spatialDivisionsSub1);\n\n\t\t\t\tvec4 c = vec4(0.);\n\t\t\t\tfloat t = fillSpatial(corner, c);\n\n\t\t\t\tpc_FragColor = vec4(t, packRGBAToVec3(c)); // RGB texture\n\t\t\t}\n\t\t`;return new yW({name:"PotentialPass",fragmentShader:t,uniforms:this.potentialPassUniforms})}voxelPassMaterial(){let t=`\n\t\t\tprecision highp float;\n\t\t\tlayout(location = 0) out vec4 pc_FragColor;\n\t\t\tlayout(location = 1) out vec4 numTris;\n\n\t\t\tconst float res = float(RES);\n\t\t\tconst float VOXEL_RESOLUTION = pow(2., res);\n\t\t\tconst float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.; \n\t\t\tconst float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));\n\t\t\tconst float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;\n\t\t\tuniform sampler2D numTrisTable; // 256 x 1\n\n\t\t\tfloat keyi(float f000, float f100, float f010, float f110, float f001, float f101, float f011, float f111) {\n\t\t\t\treturn (float(f000 < 0.) * 1.) +\n\t\t\t\t\t\t\t (float(f100 < 0.) * 2.) +\n\t\t\t\t\t\t\t (float(f010 < 0.) * 8.) +\n\t\t\t\t\t\t\t (float(f110 < 0.) * 4.) +\n\t\t\t\t\t\t\t (float(f001 < 0.) * 16.) +\n\t\t\t\t\t\t\t (float(f101 < 0.) * 32.) +\n\t\t\t\t\t\t\t (float(f011 < 0.) * 128.) +\n\t\t\t\t\t\t\t (float(f111 < 0.) * 64.);\n\t\t\t}\n\n\t\t\t${_W.lookup}\n\n\t\t\tvec3 compNormi(float xi, float yi, float zi) {\n\t\t\t\tfloat dx = look(xi + 1., yi, zi, potentialPassTexture).r - look(xi - 1., yi, zi, potentialPassTexture).r;\n\t\t\t\tfloat dy = look(xi, yi + 1., zi, potentialPassTexture).r - look(xi, yi - 1., zi, potentialPassTexture).r;\n\t\t\t\tfloat dz = look(xi, yi, zi + 1., potentialPassTexture).r - look(xi, yi, zi - 1., potentialPassTexture).r;\n\t\t\t\t// if we allow (common) 0,0,0 case through then NaN can spread\n\t\t\t\t// eg r = vec4(compNorm i(???), 1.) will pollute r.w\n\t\t\t\tif (dx == 0.0 && dy == 0.0 && dz == 0.0) {\n\t\t\t\t\treturn vec3(0.199, 0.299, 0.399);\n\t\t\t\t}\n\t\t\t\treturn normalize(vec3(dx, dy, dz));\n\t\t\t}\n\n\t\t\tvoid main() {\n\t\t\t\t${_W.getxyzi}    // get xi yi zi from 2d\n\n\t\t\t\tvec3 normal = compNormi(xi, yi, zi);  // even if our key is -1 this may be needed by a neighbouring voxel\n\n\t\t\t\tif (xi >= VOXEL_RESOLUTION_SUB1 || yi >= VOXEL_RESOLUTION_SUB1 || zi >= VOXEL_RESOLUTION_SUB1) {\n\t\t\t\t\tpc_FragColor = vec4(normal, 0.);\n\t\t\t\t\tnumTris = vec4(0.);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfloat\n\t\t\t\t\tf000 = look(xi, yi, zi, potentialPassTexture).r,\n\t\t\t\t\tf100 = look(xi+1., yi, zi, potentialPassTexture).r,\n\t\t\t\t\tf010 = look(xi, yi+1., zi, potentialPassTexture).r,\n\t\t\t\t\tf110 = look(xi+1., yi+1., zi, potentialPassTexture).r,\n\t\t\t\t\tf001 = look(xi, yi, zi+1., potentialPassTexture).r,\n\t\t\t\t\tf101 = look(xi+1., yi, zi+1., potentialPassTexture).r,\n\t\t\t\t\tf011 = look(xi, yi+1., zi+1., potentialPassTexture).r,\n\t\t\t\t\tf111 = look(xi+1., yi+1., zi+1., potentialPassTexture).r;\n\t\t\t\tfloat key = keyi(f000, f100, f010, f110, f001, f101, f011, f111);\n\n\t\t\t\tpc_FragColor = vec4(normal, key);\n\n\t\t\t\tnumTris = texture(numTrisTable, vec2((key + 0.5) / 256., 0.5));\n\t\t\t}\n\t\t`;return new yW({name:"VoxelPass",fragmentShader:t,uniforms:this.voxelPassUniforms})}patchVertexShaderForShapeBlend(t){let e=`\n\t\t#ifdef SHAPEBLEND \n\t\t\tprecision highp sampler2D;\n\n\t\t\tuniform float isol;\n\n\t\t\tuniform sampler2D triTable;     // 256 x 16\n\t\t\tuniform sampler2D pyramidTexture1;\n\t\t\tuniform vec2 pyramidTexture1Size;\n\t\t\tuniform sampler2D pyramidTexture2;\n\t\t\tuniform vec2 pyramidTexture2Size;\n\n\t\t\tconst vec2 halfPixelOffset = vec2(0.5, 0.5);\n\n\t\t\tconst vec2 rShift = vec2(0., 1.);\n\t\t\tconst vec2 gShift = vec2(1., 1.);\n\t\t\tconst vec2 bShift = vec2(1., 0.);\n\n\t\t\tconst float res = float(RES);\n\t\t\tconst float VOXEL_RESOLUTION = pow(2., res);\n\t\t\tconst float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));\n\t\t\tconst float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;\n\n\t\t\tconst float scale_factor = 2.;\n\n\t\t\t#if SHAPEBLEND == 5\n\t\t\t\tconst float levelShiftX[7] = float[7](4., 6., 12., 24., 48., 96., 192.);\n\t\t\t\tconst float scale = 8. * scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(16.);\n\t\t\t#elif SHAPEBLEND == 7\n\t\t\t\tconst float levelShiftX[10] = float[10](4., 6., 12., 24., 48., 96., 192., 384., 768., 1536.); \n\t\t\t\tconst float scale = 2. * scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(64.);\n\t\t\t#elif SHAPEBLEND == 8\n\t\t\t\tconst float levelShiftX[11] = float[11](4., 8., 16., 32., 64., 128., 256., 512., 1024., 2048., 4096.);\n\t\t\t\tconst float scale = scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(128.);\n\t\t\t#else\n\t\t\t\tconst float levelShiftX[8] = float[8](4., 8., 16., 32., 64., 128., 256., 512.);\n\t\t\t\tconst float scale = 4. * scale_factor;\n\t\t\t\tconst vec3 originOffset = vec3(32.);\n\t\t\t#endif\n\n\t\t\t${_W.lookup}\n\n\t\t\tconst vec3 offsets[24] = vec3[](\n\t\t\t\tvec3(0., 0., 0.), vec3(1., 0., 0.),\n\t\t\t\tvec3(1., 0., 0.), vec3(1., 1., 0.),\n\t\t\t\tvec3(0., 1., 0.), vec3(1., 1., 0.),\n\t\t\t\tvec3(0., 0., 0.), vec3(0., 1., 0.),\n\t\t\t\tvec3(0., 0., 1.), vec3(1., 0., 1.),\n\t\t\t\tvec3(1., 0., 1.), vec3(1., 1., 1.),\n\t\t\t\tvec3(0., 1., 1.), vec3(1., 1., 1.),\n\t\t\t\tvec3(0., 0., 1.), vec3(0., 1., 1.),\n\t\t\t\tvec3(0., 0., 0.), vec3(0., 0., 1.),\n\t\t\t\tvec3(1., 0., 0.), vec3(1., 0., 1.),\n\t\t\t\tvec3(1., 1., 0.), vec3(1., 1., 1.),\n\t\t\t\tvec3(0., 1., 0.), vec3(0., 1., 1.)\n\t\t\t);\n\n\t\t\tvec2 computeShiftedPosition1(vec2 xy, float levelOriginX) {\n\t\t\t\tvec2 xyShifted = xy;\n\t\t\t\txyShifted.x += levelOriginX;\n\t\t\t\treturn (xyShifted + halfPixelOffset) / pyramidTexture1Size;\n\t\t\t}\n\n\t\t\tvec2 computeShiftedPosition2(vec2 xy, float levelOriginX) {\n\t\t\t\tvec2 xyShifted = xy;\n\t\t\t\txyShifted.x += levelOriginX;\n\t\t\t\treturn (xyShifted + halfPixelOffset) / pyramidTexture2Size;\n\t\t\t}\n\n\t\t\tvec4 unpackVec3ToRGBA(vec3 vec) {\n\t\t\t\tuint combined = uint(vec.x * 65535.0 + 0.5); // Add 0.5 for rounding\n\t\t\t\tfloat g = float(combined & uint(0xFF)) * 0.00392156862; // 1/255\n\t\t\t\tfloat r = float((combined >> 8) & uint(0xFF)) * 0.00392156862; \n\t\t\n\t\t\t\treturn vec4(r, g, vec.y, vec.z);\n\t\t\t}\n\n\t\t\tout vec4 marchColor;\n\t\t\t// end of marchvertPre\n\t\t#endif\n\t\t`;t.vertexShader=e+t.vertexShader.replace("#include <project_vertex>","\n\t\t#ifdef SHAPEBLEND\n\t\t\tfloat triIndex = floor(float(gl_VertexID/3));\n\t\t\tfloat vertexIndex = float(gl_VertexID);\n\t\t\t\n\t\t\t// Initial pyramid lookup\n\t\t\tfloat levelOriginX1 = pyramidTexture1Size.x - 2.;\n\t\t\tfloat levelOriginX2 = pyramidTexture2Size.x - 1.;\n\t\t\tvec2 xy = vec2(0.);\n\t\t\tvec4 lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));\n\t\t\t\n\t\t\t// Early exit check\n\t\t\tif (triIndex >= lookUp.r) return;\n\t\t\t\n\t\t\t// Optimize loop variables\n\t\t\tfloat start = 0.;\n\t\t\tvec4 triIndexVec = vec4(triIndex);\n\t\t\t\n\t\t\t// Main position computation loop\n\t\t\tfor (int i = 0; i < LOOP;) {\n\t\t\t\t// Compute boundaries\n\t\t\t\tvec4 ends = lookUp + vec4(start);\n\t\t\t\tvec4 starts = vec4(ends.gba, start);\n\t\t\t\tvec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * \n\t\t\t\t\t\t\t\t\t\t\tvec4(lessThan(triIndexVec, ends));\n\t\t\t\t\n\t\t\t\t// Update position\n\t\t\t\txy *= 2.;\n\t\t\t\txy += check.r * rShift + check.g * gShift + check.b * bShift;\n\t\t\t\t\n\t\t\t\t// Update loop variables\n\t\t\t\tstart = dot(check, starts);\n\t\t\t\tlevelOriginX2 -= levelShiftX[i];\n\t\t\t\t\n\t\t\t\t// Update lookup\n\t\t\t\tlookUp = texture(pyramidTexture1, computeShiftedPosition1(xy, levelOriginX1));\n\t\t\t\ti++;\n\n\t\t\t\tends = lookUp + vec4(start);\n\t\t\t\tstarts = vec4(ends.gba, start);\n\t\t\t\tcheck = vec4(greaterThanEqual(triIndexVec, starts)) * \n\t\t\t\t\t\t\t\t\t\t\tvec4(lessThan(triIndexVec, ends));\n\t\t\t\t\n\t\t\t\t// Update position\n\t\t\t\txy *= 2.;\n\t\t\t\txy += check.r * rShift + check.g * gShift + check.b * bShift;\n\t\t\t\t\n\t\t\t\t// Update loop variables\n\t\t\t\tstart = dot(check, starts);\n\t\t\t\tlevelOriginX1 -= levelShiftX[i];\n\t\t\t\t\n\t\t\t\t// Update lookup\n\t\t\t\tlookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));\n\n\t\t\t\ti++;\n\t\t\t}\n\n\t\t\t#if HALF == 1\n\t\t\t\tvec4 ends = lookUp + vec4(start);\n\t\t\t\tvec4 starts = vec4(ends.gba, start);\n\t\t\t\tvec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * vec4(lessThan(triIndexVec, ends));\n\t\t\t\n\t\t\t\t// Update position\n\t\t\t\txy *= 2.;\n\t\t\t\txy += check.r * rShift + check.g * gShift + check.b * bShift;\n\t\t\t\n\t\t\t\t// Update loop variables\n\t\t\t\tstart = dot(check, starts);\n\t\t\t#endif\n\t\t\t\n\t\t\t// Compute final coordinates\n\t\t\tvec3 gridPos;\n\t\t\tgridPos.x = mod(xy.x, VOXEL_RESOLUTION);\n\t\t\tgridPos.y = mod(xy.y, VOXEL_RESOLUTION);\n\t\t\tgridPos.z = floor(xy.x * INV_VOXEL_RESOLUTION) + \n\t\t\t\t\t\t\t\t\tfloor(xy.y * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;\n\t\t\t\n\t\t\t// Vertex key computation\n\t\t\tvertexIndex -= start * 3.;\n\t\t\tfloat vk = vertexIndex * 0.0625 + 0.03125; // Optimized division by 16 and addition of 1/32\n\t\t\t\n\t\t\t// Voxel lookup and edge computation\n\t\t\tvec4 voxel = look(gridPos.x, gridPos.y, gridPos.z, voxelPassTexture);\n\t\t\tfloat key = (voxel.w + 0.5) * 0.00390625; // Optimized division by 256\n\t\t\t\n\t\t\t// Edge lookup and offset computation\n\t\t\tfloat edgeNum = texture(triTable, vec2(vk, key)).x;\n\t\t\tint edgeIndex = int(edgeNum) * 2;\n\t\t\t\n\t\t\t// Compute edge positions\n\t\t\tvec3 p1 = gridPos + offsets[edgeIndex];\n\t\t\tvec3 p2 = gridPos + offsets[edgeIndex + 1];\n\t\t\t\n\t\t\t// Compute potentials and normals\n\t\t\tvec4 potential1 = look(p1.x, p1.y, p1.z, potentialPassTexture);\n\t\t\tvec4 potential2 = look(p2.x, p2.y, p2.z, potentialPassTexture);\n\t\t\t\n\t\t\t// Final position and normal computation\n\t\t\tfloat mu = potential1.r / (potential1.r - potential2.r);\n\n\t\t\tmarchColor = mix(\n\t\t\t\tunpackVec3ToRGBA(potential1.gba),\n\t\t\t\tunpackVec3ToRGBA(potential2.gba),\n\t\t\t\tmu\n\t\t\t);\n\n\t\t\ttransformed = p1 + (p2 - p1) * mu;\n\t\t\ttransformed -= originOffset;\n\t\t\ttransformed *= scale;\n\t\t\tvec4 data1 = look(p1.x, p1.y, p1.z, voxelPassTexture);\n\t\t\tvec4 data2 = look(p2.x, p2.y, p2.z, voxelPassTexture);\n\t\t\tobjectNormal = normalize(mix(data1.xyz, data2.xyz, mu));\n\t\t\ttransformedNormal = normalMatrix * objectNormal;\n\t\t\t#ifndef FLAT_SHADED\n\t\t\t\tvNormal = transformedNormal;\n\t\t\t#endif\n\t\t#endif\n\t\t\n#include <project_vertex>");let n=t.fragmentShader.match(/vec3 diffuseColor[^\n]*\n/);if(!n)return;let i=`\n\t\t#ifdef SHAPEBLEND_C\n\t\t\t#if SHAPEBLEND_C == 1\n\t\t\t\t${n[0].replace(/nodeU0,/g,"marchColor.rgb,").replace(/nodeU\d+(?=,g_uid\d+_calpha\))/g,"marchColor.a")}\n\t\t\t#else\n\t\t\t\t${n[0]}\n\t\t\t#endif\n\t\t#else\n\t\t\t${n[0]}\n\t\t#endif\n\t\t`;t.fragmentShader="in vec4 marchColor;\n"+t.fragmentShader.replace(n[0],i),Object.assign(t.uniforms,this.marchPassUniforms)}initDebugPass(t){console.log("fboToDebug.width",t.width,t.height),this.geometry=new Ey(t.width,t.height),this.geometry.userData={parameters:{width:4,height:4}};let e={inputTexture:{value:Array.isArray(t.texture)?t.texture[1]:t.texture},pyramidTextureSize:{value:void 0}},n=t=>{t.vertexShader="\n\t\t\t\tprecision highp float;\n\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t\t\tvUv = uv;\n\t\t\t\t}\n\t\t\t",t.fragmentShader="\n\t\t\t\tlayout(location = 1) out vec4 gVelocity;\n\n\t\t\t\tprecision highp float;\n\t\t\t\t\n\t\t\t\tuniform sampler2D inputTexture;\n\t\t\t\tvarying vec2 vUv;\n\n\t\t\t\tuniform vec2 pyramidTextureSize;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\t\t// Sample the input texture using UV coordinates\n\t\t\t\t\t\tgl_FragColor = texture(inputTexture, vUv);\n\t\t\t\t\t\tgVelocity = vec4(0.0);\n\t\t\t\t}\n\t\t\t",e.pyramidTextureSize.value=new ym(this.pyramidRenderTarget.width,this.pyramidRenderTarget.height),Object.assign(t.uniforms,e)};this.material.shapeBlendhack=n,this.material.root.shapeBlendhack=n}},SW=wW;SW.streamCompaction=new class{constructor(){this.pyramidPassScene=new f_,this.pyramidPassMaterial=new yW({name:"PyramidPass"}),this.pyramidPassUniforms={inputTexture:{value:void 0},inputWidth:{value:0},inputHeight:{value:0},inputShiftX:{value:0},outputShiftX:{value:0}},this.pyramidTopLevelReadPixelBuffer=new Float32Array(4);this.pyramidPassMaterial.fragmentShader="\n\t\t\tprecision highp float;\n\t\t\tprecision highp sampler2D;\n\t\t\tlayout(location = 0) out vec4 pc_FragColor;\n\t\t\tuniform sampler2D inputTexture;\n\t\t\tuniform float inputWidth;\n\t\t\tuniform float inputHeight;\n\t\t\tuniform float inputShiftX;\n\t\t\tuniform float outputShiftX;\n\t\t\tconst vec2 half_unit_coord = vec2(0.5);\n\t\t\tconst vec4 one = vec4(1.0);\n\t\t\tvoid main() {\n\t\t\t\tvec2 inputSize = vec2(inputWidth, inputHeight);\n\t\t\t\tvec2 input_pixel_uv = 1. / inputSize;\n\t\t\t\tvec2 coord = gl_FragCoord.xy - half_unit_coord;\n\t\t\t\tcoord.x -= outputShiftX;\n\t\t\t\tcoord = coord * 2. + half_unit_coord;\n\t\t\t\tcoord.x += inputShiftX;\n\n\t\t\t\t// sample bottom left corner\n\t\t\t\tvec2 input_uv = coord / inputSize;\n\t\t\t\tfloat bl = texture(inputTexture, input_uv).r;\n\n\t\t\t\t// sample bottom right corner\n\t\t\t\tinput_uv.x += input_pixel_uv.x;\n\t\t\t\tfloat br = texture(inputTexture, input_uv).r;\n\n\t\t\t\t// sample top right corner\n\t\t\t\tinput_uv.y += input_pixel_uv.y;\n\t\t\t\tfloat tr = texture(inputTexture, input_uv).r;\n\n\t\t\t\t// sample top left corner\n\t\t\t\tinput_uv.x -= input_pixel_uv.x;\n\t\t\t\tfloat tl = texture(inputTexture, input_uv).r;\n\n\t\t\t\tpc_FragColor.a = bl;\n\t\t\t\tpc_FragColor.b = pc_FragColor.a + br;\n\t\t\t\tpc_FragColor.g = pc_FragColor.b + tr;\n\t\t\t\tpc_FragColor.r = pc_FragColor.g + tl; \n\t\t\t}\n\t\t",this.pyramidPassMaterial.uniforms=this.pyramidPassUniforms,this.pyramidPassMaterial.depthTest=!1,this.pyramidPassMaterial.depthWrite=!1;let t=new ty(vW,this.pyramidPassMaterial);t.frustumCulled=!1,this.pyramidPassScene.add(t)}renderPyramid(t,e,n,i,r){(new eM).min.setScalar(0);let s=e.length-1,a=new jm;n.getViewport(a),this.pyramidPassUniforms.inputShiftX.value=0,this.pyramidPassUniforms.outputShiftX.value=0;let o=s-1;for(let s=o;s>=0;s--){let a=s%2==o%2?r[0]:r[1],l=s===o?i:s%2==o%2?r[1]:r[0];this.pyramidPassUniforms.inputTexture.value=Array.isArray(l.texture)?l.texture[1]:l.texture,this.pyramidPassUniforms.inputWidth.value=l.width,this.pyramidPassUniforms.inputHeight.value=l.height,n.setRenderTarget(a);let c=e[s],h=n.getPixelRatio();n.setViewport(this.pyramidPassUniforms.outputShiftX.value/h,0,c/h,c/h),2===s&&t%2!=0&&n.setViewport(this.pyramidPassUniforms.outputShiftX.value/h,0,3/h,3/h),n.render(this.pyramidPassScene,xW);let u=this.pyramidPassUniforms.inputShiftX.value;this.pyramidPassUniforms.inputShiftX.value=this.pyramidPassUniforms.outputShiftX.value,this.pyramidPassUniforms.outputShiftX.value=u,s<o&&(this.pyramidPassUniforms.outputShiftX.value+=e[s+1])}n.setViewport(a);let l=e.length%2==0?0:1;return n.readRenderTargetPixelsAsync(r[l],r[l].width-1,0,1,1,this.pyramidTopLevelReadPixelBuffer).then((()=>this.pyramidTopLevelReadPixelBuffer[0]))}};var MW=new Mg,TW=new Mg,EW=new Xm,AW=new $m,CW=new $m,PW=new Xm;function RW(t,e=0){let n=this.children.length;for(;n--;){let i=this.children[n];oz.is(i)&&OW.call(i,t,e+1)}}function OW(t,e=0){if(!0!==t(this,e)){let n=this.children.length;for(;n--;){let i=this.children[n];oz.is(i)&&OW.call(i,t,e+1)}}}function DW(){if(void 0===this.shapesDataTexture.value){let t=new x_(new Float32Array(1920),bW,5,jp,Ip);this.shapesDataTexture.value=t}let t=this.shapesDataTexture.value,e=t.image.data;t.needsUpdate=!0;let n=0,i=this.data.geometry.blendRange,r=MW.copy(this.matrixWorld).invert(),s=0;RW.call(this,(t=>{if(!1===t.visible)return!0;let a;if(t instanceof nH)return;if(t instanceof NH||t instanceof fW)return;a=t instanceof vz?t.object:t;let o=t.data?.cloner;if(fz.is(t)&&o&&!o.hideBase&&"radial"!==o.type&&!0!==o.disabled||!(a instanceof pj))return;let l=a.geometry.userData.parameters,c=l.shapeBlendNode;if(void 0===c)return;if(TW.multiplyMatrices(r,t.matrixWorld).decompose(CW,EW,AW),"TorusGeometry"===l.type&&360!==l.arc){let t=l.arc*Math.PI/180;t/=4,EW.multiply(PW.set(0,0,Math.sin(t),Math.cos(t)))}let h=c.overrideGlobalBlend?c.blendRange:i;h=h/this.bboxSize*2,e[4*s]=(CW.x-this.bboxOffset)/this.bboxSize*2,e[4*s+1]=(CW.y-this.bboxOffset)/this.bboxSize*2,e[4*s+2]=(CW.z-this.bboxOffset)/this.bboxSize*2,e[4*s+3]=0===c.operation?1:2===c.operation?-1:-2,e[384+4*s]=-EW.x,e[384+4*s+1]=-EW.y,e[384+4*s+2]=-EW.z,e[384+4*s+3]=EW.w;let u=new Float32Array(4),d=0;if("SphereGeometry"===l.type)l.width===l.height&&l.width===l.depth?u[0]=0:u[0]=1,u[1]=l.width/this.bboxSize,u[2]=l.height/this.bboxSize,u[3]=l.depth/this.bboxSize,n=Math.max(n,u[1]*AW.x+h,u[2]*AW.x+h,u[3]*AW.x+h);else if("CubeGeometry"===l.type){d=l.cornerRadius;let t=l.width,e=l.height,i=l.depth;u[0]=2,u[1]=(t-2*d)/this.bboxSize,u[2]=(e-2*d)/this.bboxSize,u[3]=(i-2*d)/this.bboxSize,n=Math.max(n,Math.sqrt(t**2+e**2+i**2)/this.bboxSize*AW.x+h)}else if("CylinderGeometry"===l.type){d=l.cornerRadius;let t=l.height,e=l.radiusBottom,i=l.radiusTop;if(i>=e){let n=Math.atan2(i-e,t),r=(Math.PI/2-n)/2;i-=d/Math.tan(r),e-=d*Math.tan(r)}else if(e>i){let n=Math.atan2(e-i,t),r=(Math.PI/2-n)/2;i-=d*Math.tan(r),e-=d/Math.tan(r)}u[1]=(l.height-2*d)/this.bboxSize,e===i?(u[0]=3,u[2]=e/this.bboxSize*2):(u[0]=4,u[2]=e/this.bboxSize*2,u[3]=i/this.bboxSize*2),n=Math.max(n,4*u[1]*AW.x+h)}else if("TorusGeometry"===l.type){if(u[0]=5,u[1]=(l.width-l.depth)/this.bboxSize,u[2]=l.depth/this.bboxSize,360!==l.arc){u[0]=6,u[3]=u[1],e[1152+4*s+3]=u[2];let t=2*Math.atan2(u[2]/2,u[1]),n=l.arc*Math.PI/180/2-t;u[1]=Math.sin(n),u[2]=Math.cos(n)}n=Math.max(n,l.width*AW.x/this.bboxSize+h)}e.set(u,768+4*s),e[1152+4*s]=h,e[1152+4*s+1]=d/this.bboxSize*2,e[1152+4*s+2]=AW.x;let p=a.material,f=p.uniforms.nodeU0.node.value,m=p.uniforms.nodeU1.value;0!==c.operation&&!c.useColor&&(m=-1),e[1536+4*s]=f.r,e[1536+4*s+1]=f.g,e[1536+4*s+2]=f.b,e[1536+4*s+3]=m,m<1&&1===this.material.defines.SHAPEBLEND_C&&(this.material.transparent=!0),s++})),this.npart=s,this.spatialPassUniforms.span.value=1.4*n}var LW=512;function IW(t,e){let n=!1,i=t.layers.mask&LW,r=e.getLayersOfType("transmission"),s=e.getLayersOfType("outline");return s.length>0&&(t.layers.set(8),r.length>0&&t.layers.enable(3),n=!0,mj(t),fj(t)),0===r.length&&0===s.length&&t.layers.set(0),i&&t.layers.set(9),t instanceof oj&&t.needsAO&&t.layers.enable(5),n}function zW(t,e){if(!e.layers)return!1;let n=t.layers.mask&LW,i=!1,r=e.getLayersOfType("transmission").filter((t=>t.data.visible)),s=e.getLayersOfType("outline").filter((t=>t.data.visible));return r.length>0&&(t.layers.set(3),s.length>0&&t.layers.enable(8),i=!0),0===r.length&&0===s.length&&t.layers.set(0),n&&t.layers.set(9),t.needsAO&&t.layers.enable(5),i}var NW=new ZS,UW=new Mg,kW=new Sg;function BW(t,e,n,i=!1){let r=t.cloner;if(r)for(let s of r.children){let r=UW.copy(s.matrixWorld).invert(),a=kW.copy(e.ray).applyMatrix4(r),o=t.matrixWorld;a.applyMatrix4(o);let l=NW;l.set(a.origin,a.direction),l.near=e.near,l.far=e.far;let c=l.intersectObject(t,!1);c.length>0&&n.push({...c[0],object:i?s:t})}}var FW=class{constructor(){this._constraints=new Map}setConstraint(t,e){null===e?this._constraints.delete(t):this._constraints.set(t,e)}removeDependencies(t){this._constraints.delete(t)}applyConstraints(t){let e=new Set;this._constraints.forEach(((n,i)=>{let r=[i,n],s=n;for(;this._constraints.has(s);){if(s=this._constraints.get(s),r.includes(s)){console.warn(`circular dependency detected: ${r.join(" -> ")}`);break}e.has(s)||r.push(s)}for(let n=r.length-2;n>=0;n--)if(!e.has(r[n])){let i=t.find(r[n]);i?i.applyPathSnapping(t):console.warn(`missing entity ${r[n]}`),e.add(r[n])}}))}findDependency(t,e){let n=t;for(;this._constraints.has(n);)if(n=this._constraints.get(n),n===e)return!0;return!1}},VW=class{};function jW(t){let e,n,i,r,s,a,o,l,c,h,u,d,p,f,m,g;function v(t,e,a){let o=new Float32Array(h,s,3*n);i=0;let l=new Uint32Array(h,r,n);for(let n=0;n<a.length-1;n++){let r=e[n],s=t[n].elements,c=r.filter((t=>t.enabled&&"Include"===t.mode)).map((t=>"Box"===t.type?x(t):_(t))),h=r.filter((t=>t.enabled&&"Exclude"===t.mode)).map((t=>"Box"===t.type?x(t):_(t)));for(let t=a[n];t<a[n+1];t++){let e=p[3*t],n=p[3*t+1],r=p[3*t+2];if((0===c.length||y(e,n,r,c))&&(0===h.length||!y(e,n,r,h))){let a=1/(s[3]*e+s[7]*n+s[11]*r+s[15]);o[3*i]=(s[0]*e+s[4]*n+s[8]*r+s[12])*a,o[3*i+1]=(s[1]*e+s[5]*n+s[9]*r+s[13])*a,o[3*i+2]=(s[2]*e+s[6]*n+s[10]*r+s[14])*a,l[i]=t,i++}}}}function y(t,e,n,i,r){return i["Intersect"===r?"every":"some"]((i=>{let r=function(t,e,n,i,r){let s=t-r[0],a=e-r[1],o=n-r[2],l=1/(i[3]*s+i[7]*a+i[11]*o+i[15]);return{x:(i[0]*s+i[4]*a+i[8]*o+i[12])*l+r[0],y:(i[1]*s+i[5]*a+i[9]*o+i[13])*l+r[1],z:(i[2]*s+i[6]*a+i[10]*o+i[14])*l+r[2]}}(t,e,n,i.invRotationMatrix,i.cropCenter);return Array.isArray(i)?function(t,e,n,i){return t>=i[0]&&t<=i[3]&&e>=i[1]&&e<=i[4]&&n>=i[2]&&n<=i[5]}(r.x,r.y,r.z,i):function(t,e,n,i){let r=(t-i.cropCenter[0])*i.invRadiusX,s=(e-i.cropCenter[1])*i.invRadiusY,a=(n-i.cropCenter[2])*i.invRadiusZ;return r*r+s*s+a*a<=1}(r.x,r.y,r.z,i)}))}function x(t){let e=t.cropSize[0]/2,n=t.cropSize[1]/2,i=t.cropSize[2]/2,r=[t.cropCenter[0]-e,t.cropCenter[1]-n,t.cropCenter[2]-i,t.cropCenter[0]+e,t.cropCenter[1]+n,t.cropCenter[2]+i],s=b(t.cropRotation);return Object.assign(r,{invRotationMatrix:s,cropCenter:t.cropCenter})}function b(t){let e=[],n=t[0]*Math.PI/180,i=t[1]*Math.PI/180,r=t[2]*Math.PI/180,s=Math.cos(n),a=Math.sin(n),o=Math.cos(i),l=Math.sin(i),c=Math.cos(r),h=Math.sin(r),u=s*c,d=s*h,p=a*c,f=a*h;return e[0]=o*c,e[1]=-o*h,e[2]=l,e[4]=d+p*l,e[5]=u-f*l,e[6]=-a*o,e[8]=f-u*l,e[9]=p+d*l,e[10]=s*o,e[12]=0,e[13]=0,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1,e}function _(t){let e=2/t.cropSize[0],n=2/t.cropSize[1],i=2/t.cropSize[2],r=b(t.cropRotation);return{invRadiusX:e,invRadiusY:n,invRadiusZ:i,cropCenter:t.cropCenter,invRotationMatrix:r}}t.onmessage=b=>{if(b.data.getCroppedIndexes){let e=new Uint32Array(function(t,e){let n=[],i=e.filter((t=>t.enabled&&"Include"===t.mode)).map((t=>"Box"===t.type?x(t):_(t))),r=e.filter((t=>t.enabled&&"Exclude"===t.mode)).map((t=>"Box"===t.type?x(t):_(t))),s=t.length;for(let e=0;e<s;e+=3){let s=t[e],a=t[e+1],o=t[e+2];(0===i.length||y(s,a,o,i))&&(0===r.length||!y(s,a,o,r))||n.push(e/3)}return n}(new Float32Array(b.data.positions),b.data.crops)).buffer;t.postMessage({outOfBoundsIndexes:e},[e])}else if(b.data.positions)u=b.data.positions,p=new Float32Array(u),m=b.data.meshMatrixWorlds,g=b.data.cropsArray,f=b.data.meshIndexIntervals,v(m,g,f),t.postMessage({sortSetupComplete:!0});else if(b.data.sort||b.data.newMatrixWorlds||b.data.newCropsArray)(b.data.newMatrixWorlds||b.data.newCropsArray)&&(g=b.data.newCropsArray||g,m=b.data.newMatrixWorlds||m,v(m,g,f)),function(u){let p,f=new Float64Array(h,a,16);for(let t=0;t<16;t++)f[t]=u[t];if(i>1){e.exports.sortIndexes(r,s,c,a,o,l,d.DepthMapRange,i);let t=new Uint32Array(i);p=t.buffer,t.set(new Uint32Array(h,l,i))}else if(1===i){let t=new Uint32Array(i);t[0]=new Uint32Array(h,r,n)[0],p=t.buffer}else p=new ArrayBuffer(0);t.postMessage({sortDone:!0,indexesBuffer:p},[p])}(b.data.sort.view,b.data.sort.cameraPosition);else if(b.data.init){d=b.data.init.Constants,n=b.data.init.splatCount;let i=d.BytesPerInt,u=3*d.BytesPerFloat,p=new Uint8Array(b.data.init.sorterWasmBytes),f=n*(i+u)+(n*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2)+32*d.MemoryPageSize,m=Math.floor(f/d.MemoryPageSize)+1,g={module:{},env:{memory:new WebAssembly.Memory({initial:2*m,maximum:3*m,shared:!0})}};WebAssembly.compile(p).then((t=>WebAssembly.instantiate(t,g))).then((p=>{e=p,r=0,s=n*i,a=s+n*u,c=a+16*d.BytesPerFloat*2,o=c+n*d.BytesPerInt,l=o+d.DepthMapRange*d.BytesPerInt,h=g.env.memory.buffer,t.postMessage({sortSetupPhase1Complete:!0})}))}}}$M(VW,"DepthMapRange",65536),$M(VW,"MemoryPageSize",65536),$M(VW,"BytesPerFloat",4),$M(VW,"BytesPerInt",4);var HW=function(){let t=new Float32Array(1),e=new Int32Array(t.buffer);return function(n){return t[0]=n,e[0]}}(),GW=function(t,e,n,i){return t+(e<<8)+(n<<16)+(i<<24)},WW=new ym;function qW(t){let e=!1;return t.scene.objects.traverse(((t,n)=>{if(!1===n.visible)return!0;"Splat"===n.type&&(e=!0)})),e}var XW,$W,YW,ZW=class extends ty{constructor(t,e,n,i,r=!1,s=1,a,o){super(n,i),this.splatCount=e,this.meshIndexIntervals=a,this.meshMatrixWorlds=o,this.splatBuffers=t,this.geometry=n,this.material=i,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=r,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(t,e,n=!1,i=1,r,s){let a=ZW.buildGeomtery(e),o=ZW.buildMaterial(r);return new ZW(t,e,a,o,n,i,r,s)}static buildMaterial(t){let e={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:t},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new ym},viewport:{type:"v2",value:new ym},basisViewport:{type:"v2",value:new ym},debugColor:{type:"v3",value:new pv},covariancesTextureSize:{type:"v2",value:new ym(1024,1024)},centersColorsTextureSize:{type:"v2",value:new ym(1024,1024)},orthoZoom:{type:"f",value:-1}};return new oy({uniforms:e,vertexShader:"\n            precision highp float;\n            #include <common>\n\n            attribute uint splatIndex;\n\n            uniform highp sampler2D covariancesTexture;\n            uniform highp usampler2D centersColorsTexture;\n            uniform vec2 focal;\n            uniform vec2 viewport;\n            uniform vec2 basisViewport;\n            uniform vec2 covariancesTextureSize;\n            uniform vec2 centersColorsTextureSize;\n\t\t\t\t\t\tuniform highp sampler2D meshMatrixWorldsTexture;\n\t\t\t\t\t\tuniform uint meshIndexIntervals[257];\n\t\t\t\t\t\tuniform float orthoZoom;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\n            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\n            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));\n            const uvec4 shift4 = uvec4(0, 8, 16, 24);\n            vec4 uintToRGBAVec (uint u) {\n               uvec4 urgba = mask4 & u;\n               urgba = urgba >> shift4;\n               vec4 rgba = vec4(urgba) * encodeNorm4;\n               return rgba;\n            }\n\n            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {\n                vec2 samplerUV = vec2(0.0, 0.0);\n                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;\n                samplerUV.y = float(floor(d)) / dimensions.y;\n                samplerUV.x = fract(d);\n                return samplerUV;\n            }\n\n            void main () {\n                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));\n                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));\n                vColor = uintToRGBAVec(sampledCenterColor.r);\n\n                vPosition = position.xy * 2.0;\n\n\t\t\t\t\t\t\t\tuint meshIndex;\n\t\t\t\t\t\t\t\tfor (int i = 1; i < 257; i++) {\n\t\t\t\t\t\t\t\t\tif (splatIndex < meshIndexIntervals[i]) {\n\t\t\t\t\t\t\t\t\t\tmeshIndex = uint(i - 1);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfloat strideMulmeshIndex = float(4u*meshIndex);\n\t\t\t\t\t\t\t\tfloat meshMatrixWorldsTextureLength = float(256*4);\n\n\t\t\t\t\t\t\t\tmat4 modelMat = mat4(\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tmat4 modelViewMat = viewMatrix * modelMat;\n\t\t\t\t\t\t\t\tvec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); \n                vec4 clipCenter = projectionMatrix * viewCenter;\n\n                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;\n\n                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);\n                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);\n\n                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix\n                mat3 Vrk = mat3(\n                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,\n                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,\n                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z\n                );\n                float s = 1.0 / (viewCenter.z * viewCenter.z);\n\n                mat3 W = transpose(mat3(modelViewMat));\n                mat3 T = orthoZoom > 0.0 ? W : W * mat3(\n\t\t\t\t\t\t\t\t\tfocal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,\n\t\t\t\t\t\t\t\t\t0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,\n\t\t\t\t\t\t\t\t\t0., 0., 0.\n\t\t\t\t\t\t\t\t);\n                mat3 cov2Dm = transpose(T) * Vrk * T;\n                cov2Dm[0][0] += 0.3;\n                cov2Dm[1][1] += 0.3;\n\n                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because\n                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],\n                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't\n                // need cov2Dm[1][0] because it is a symetric matrix.\n                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);\n\n                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;\n\n                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix\n                // so that we can determine the 2D basis for the splat. This is done using the method described\n                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html\n                //\n                // This is a different approach than in the original work at INRIA. In that work they compute the\n                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle\n                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance\n                // matrix (called 'conic') to determine fragment opacity.\n                float a = cov2Dv.x;\n                float d = cov2Dv.z;\n                float b = cov2Dv.y;\n                float D = a * d - b * b;\n                float trace = a + d;\n                float traceOver2 = 0.5 * trace;\n                float term2 = sqrt(trace * trace / 4.0 - D);\n                float eigenValue1 = traceOver2 + term2;\n\t\t\t\t\t\t\t\tfloat eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value\n\n                const float maxSplatSize = 1024.0;\n                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));\n                // since the eigen vectors are orthogonal, we derive the second one from the first\n                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);\n                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);\n                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);\n\n                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;\n\n\t\t\t\t\t\t\t\tif (orthoZoom > 0.0) {\n\t\t\t\t\t\t\t\t\tndcOffset *= orthoZoom;\n\t\t\t\t\t\t\t\t}\n\n                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);\n            }",fragmentShader:"\n            precision highp float;\n            #include <common>\n\n            uniform vec3 debugColor;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\t\t\t\t\t\tlayout(location = 1) out vec4 gVelocity; \n\n            void main () {\n                // compute the negative squared distance from the center of the splat to the\n                // current fragment in the splat's local space.\n                float A = -dot(vPosition, vPosition);\n                if (A < -4.0) discard;\n                vec3 color = vColor.rgb;\n                A = exp(A) * vColor.a;\n                gl_FragColor = vec4(color.rgb, A);\n\t\t\t\t\t\t\t\tgVelocity = vec4(0.0); // so it is ignored by TAA\n            }",transparent:!0,alphaTest:1,blending:kd,depthTest:!0,depthWrite:!1,side:Ud})}static buildGeomtery(t){let e=new Nv;e.setIndex([0,1,2,0,2,3]);let n=new Float32Array(12),i=new Tv(n,3);e.setAttribute("position",i),i.setXYZ(0,-1,-1,0),i.setXYZ(1,-1,1,0),i.setXYZ(2,1,1,0),i.setXYZ(3,1,-1,0),i.needsUpdate=!0;let r=(new BS).copy(e),s=new Uint32Array(t),a=new S_(s,1,!1);return a.setUsage(nm),r.setAttribute("splatIndex",a),r.instanceCount=t,r}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach((t=>t.buildPreComputedBuffers())),this.covariances=new Float32Array(6*this.splatCount),this.colors=new Uint8Array(4*this.splatCount),this.centers=new Float32Array(3*this.splatCount);let t=0,e=0,n=0;for(let i of this.splatBuffers){let r=i.nsplats;this.colors.subarray(t,t+4*r).set(i.colorsA),t+=4*r,this.centers.subarray(e,e+3*r).set(i.decoded.xyz.denormDequant().data),e+=3*r,this.covariances.subarray(n,n+6*r).set(new Float32Array(i.precomputedCovarianceBufferData)),n+=6*r}}allocateAndStoreLocalSplatDataInTextures(){let t=this.splatCount,e=new ym(4096,1024);for(;e.x*e.y*2<6*t;)e.y*=2;let n,i,r=new ym(4096,1024);for(;r.x*r.y*4<4*t;)r.y*=2;if(this.halfPrecisionCovariancesOnGPU){i=new Uint16Array(e.x*e.y*2);for(let t=0;t<this.covariances.length;t++)i[t]=wv.toHalfFloat(this.covariances[t]);n=new x_(i,e.x,e.y,Yp,zp)}else i=new Float32Array(e.x*e.y*2),i.set(this.covariances),n=new x_(i,e.x,e.y,Yp,Ip);n.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=n,this.material.uniforms.covariancesTextureSize.value.copy(e);let s=new Uint32Array(r.x*r.y*4);for(let e=0;e<t;e++){let t=4*e,n=3*e,i=4*e;s[i]=GW(this.colors[t],this.colors[t+1],this.colors[t+2],this.colors[t+3]),s[i+1]=HW(this.centers[n]),s[i+2]=HW(this.centers[n+1]),s[i+3]=HW(this.centers[n+2])}let a=new x_(s,r.x,r.y,Kp,Lp);a.internalFormat="RGBA32UI",a.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=a,this.material.uniforms.centersColorsTextureSize.value.copy(r);let o=new Float32Array(4096);for(let t=0;t<this.meshMatrixWorlds.length;t++)o.set(this.meshMatrixWorlds[t].elements,16*t);let l=new x_(o,1024,1,jp,Ip);l.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=l,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:i,texture:n,size:e},centerColors:{data:s,texture:a,size:r},meshMatrixWorlds:{data:o,texture:l}}}updateIndexes(t){let e=this.geometry;e.attributes.splatIndex.set(t),e.attributes.splatIndex.needsUpdate=!0,e.instanceCount=t.length}updateUniforms(t,e,n,i){this.splatCount>0&&(WW.set(t.x*this.devicePixelRatio,t.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(WW),this.material.uniforms.basisViewport.value.set(2/WW.x,2/WW.y),this.material.uniforms.focal.value.set(e,n),this.material.uniforms.orthoZoom.value=i,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},KW=new Promise((t=>{XW=t})),JW=!1;function QW(){if(!JW)return $W||($W=async function(){let t=await n.e(853).then(n.bind(n,"../node_modules/@splinetool/loader/build/gaussian-splat-compression.js"));XW(t),JW=!0}(),$W)}KW.then((t=>YW=t));var tq=class{constructor(t={}){$M(this,"updateView",function(){let t=new Mg,e=[],n=new $m(0,0,-1),i=new $m(0,0,-1),r=new $m,s=new $m;return function(a=!1,o){let l=this.updateMatrixWorldsInWorkerIfNeeded(),c=this.cropsChanged();if(!a){i.set(0,0,-1).applyQuaternion(o.quaternion);let t=!1,e=!1;if(i.dot(n)<=.95&&(t=!0),s.copy(o.position).sub(r).length()>=1&&(e=!0),!(t||e||l||c||this.needsInitialRender))return}this.needsInitialRender=!1,r.copy(o.position),n.copy(i),t.copy(o.matrixWorld).invert(),t.premultiply(this.dummyPerspectiveMatrix),e[0]=o.position.x,e[1]=o.position.y,e[2]=o.position.z;let h={sort:{view:t.elements,cameraPosition:e,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...l?{newMatrixWorlds:this.meshMatrixWorlds}:{},...c?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=h:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(h))}}()),this.scene=t.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=(new Mg).makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(t,e){let n=new ym;null!==this.splatMesh&&this.splatMesh.getSplatCount()>0&&(t.getSize(n),this.cameraFocalLengthX=e.projectionMatrix.elements[0]*this.devicePixelRatio*n.x*.45,this.cameraFocalLengthY=e.projectionMatrix.elements[5]*this.devicePixelRatio*n.y*.45,this.splatMesh.updateUniforms(n,this.cameraFocalLengthX,this.cameraFocalLengthY,e.isPerspectiveCamera?-1:e.zoom*this.devicePixelRatio))}loadSplat(t={}){this.activePage=this.scene.activePage,t.position&&(t.position=(new $m).fromArray(t.position)),t.orientation&&(t.orientation=(new Xm).fromArray(t.orientation)),t.halfPrecisionCovariances=!!t.halfPrecisionCovariances;let e=[];if(this.splatEntries=e,this.activePage.traverseVisibleEntity((t=>{"Splat"===t.data.type&&e.push(t)})),this.splatMesh&&this.splatMesh.dispose(),0===e.length)return this.splatMesh=null,!1;this.meshMatrixWorlds=e.map((t=>t.matrixWorld)),this.meshMatrixWorldsOld=e.map((t=>t.matrixWorld.clone())),this.cropsArray=e.map((t=>t.data.crops.map((t=>t.data))));let n=e.map((t=>new YW.GSplineBuffer(new Uint8Array(t.data.buffer).buffer))),i=0,r=[0];for(let t of n)i+=t.getSplatCount(),r.push(i);return this.setupSplatMesh(n,i,t.position,t.orientation,t.halfPrecisionCovariances,this.devicePixelRatio,r,this.meshMatrixWorlds),this.setupSortWorker(i),!0}updateMatrixWorldsInWorkerIfNeeded(){let t=this.splatDataTextures.meshMatrixWorlds.data;for(let e=0;e<this.meshMatrixWorlds.length;e++)t.set(this.meshMatrixWorlds[e].elements,16*e);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,!this.meshMatrixWorlds.every(((t,e)=>t.equals(this.meshMatrixWorldsOld[e])))&&(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map((t=>t.clone())),!0)}cropsChanged(){let t=!1;return this.splatEntries.forEach(((e,n)=>{e.data.crops.forEach(((e,i)=>{void 0===this.cropsArray[n][i]?(t=!0,this.cropsArray[n][i]=e.data):Object.entries(e.data).forEach((([e,r])=>{(Array.isArray(r)&&r.some(((t,r)=>t!==this.cropsArray[n][i][e][r]))||r!==this.cropsArray[n][i]?.[e])&&(t=!0,this.cropsArray[n][i][e]=r)}))})),e.data.crops.length!==this.cropsArray[n]?.length&&(this.cropsArray[n].length=e.data.crops.length,t=!0)})),t}setupSplatMesh(t,e,n=new $m,i=new Xm,r=!1,s=1,a,o){this.splatMesh=ZW.buildMesh(t,e,r,s,a,o),this.splatMesh.position.copy(n),this.splatMesh.quaternion.copy(i),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=e,this.splatMesh.onBeforeRender=(t,e,n)=>this.update(t,n)}setupSortWorker(t){this.sortWorker=function(t){let e=new Worker(URL.createObjectURL(new Blob(["(",jW.toString(),")(self)"],{type:"application/javascript"}))),n=atob("AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL"),i=new Uint8Array(n.length);for(let t=0;t<n.length;t++)i[t]=n.charCodeAt(t);return e.postMessage({init:{sorterWasmBytes:i.buffer,splatCount:t,Constants:{BytesPerFloat:VW.BytesPerFloat,BytesPerInt:VW.BytesPerInt,DepthMapRange:VW.DepthMapRange,MemoryPageSize:VW.MemoryPageSize}}}),e}(t),this.sortWorker.onmessage=t=>{t.data.sortDone?(this.sortRunning=!1,this.splatMesh?.updateIndexes(new Uint32Array(t.data.indexesBuffer)),this.lastSortTime=t.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):t.data.sortCanceled?this.sortRunning=!1:t.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):t.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(t,e){null!==this.splatMesh&&(this.updateSplatMeshUniforms(t,e),this.updateView(!1,e))}getSplatMesh(){return this.splatMesh}};(new vv).wireframe=!0;var eq,nq=new $m,iq=class extends f_{constructor(t,e){super(),this.data=t,this.sharedAssets=e,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.shapeBlendIntances=[],this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new FW,this.invisibleObjects=new zH("jflkdsafjasdifjaslk",{...LL.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(t,e),this.matrixAutoUpdate=!1,this.errorPage=new YG("fdasfa",{...jL.defaultData,name:""},{shared:e,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=function(t){let e=!1;return t.traverseEntity((t=>{if(t instanceof oj)if(Array.isArray(t.material))for(let n=0;n<t.material.length;n++)zW(t,t.material[n])&&(e=!0);else zW(t,t.material)&&(e=!0)})),e}(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=function(t){let e=!1;return t.traverseEntity((t=>{if(t instanceof oj)if(Array.isArray(t.material))for(let n=0;n<t.material.length;n++)IW(t,t.material[n])&&(e=!0);else IW(t,t.material)&&(e=!0)})),e}(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(t){let e=t.identity.join("-"),n=this.entityIdentityToEntity[e];n&&(t.uuid=n.uuid),this.entityIdentityToEntity[e]=t,this.entityByUuid[t.uuid]=t}markPenumbraSizeDirty(){for(let t of this.children)t instanceof YG&&(t.penumbraSizeArrayCache=null)}findInstance(t){return this.entityIdentityToEntity[t.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(t){let e=this.find(t);if(void 0===e)return;let n=[],i=e;for(;i!==this;){let t=i;i=i.parent;let e=i.children.indexOf(t);n.splice(0,0,e)}return{entity:e,sortKey:n}}getAllSorted(t){let e=[];for(let n of t){let t=this.getWithSortKey(n.id);void 0!==t&&e.push(t)}return e.sort(((t,e)=>iT(t.sortKey,e.sortKey))),e.map((t=>t.entity))}nonExistOrDescendantOf(t,e){let n=this.find(t);if(void 0===n)return!0;for(;n;){if(n.uuid===e)return!0;n=n.parent}return!1}find(t){if(this.activePage&&this.activePage.personalCamera.parent){if("f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera"===t)return this.activePage.personalCamera;if(t===HD)return this.activePage.personalCamera}if(""===t||void 0===t)return;let e=this.entityByUuid[t];return void 0===e?this.getObjectByProperty("uuid",t):e}find2D(t){for(let e of this.children)if(e instanceof YG&&e.uiScene){let n=e.uiScene.find(t);if(n)return n}}findScene2DfromObject2D(t){for(let e of this.children)if(e instanceof YG&&e.uiScene&&e.uiScene.find(t))return e.uiScene}find2DInUIObjects(t){let e;return this.traverseEntity((n=>{void 0===e&&n instanceof sW&&(e=n.uiCanvas.find(t))})),e}traverse2D(t){for(let e of this.children)e instanceof YG&&e.uiScene&&e.uiScene.traverse(t)}debugEnsureEntity(t){let e=this.find(t);e?Array.isArray(e.identity)&&void 0===this.findInstance(e.identity)&&console.error("not found instance"):console.error("not found")}addPendingExpandCloner(t){this.toExpandCloner.add(t)}addPendingUpdateCloner(t){this.toUpdateCloner.add(t)}markToExpandCloner(t){this.toExpandCloner.add(t),t.traverseEntityAncestors((t=>{this.toExpandCloner.add(t)}))}doPendingExpandCloner(){this.toExpandCloner.forEach((t=>{t.expandCloner(this)})),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach((t=>{t.cloner?.update()})),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(t){this.pendingCommands.push(t)}applyPendingCommands(){this.pendingCommands.forEach((t=>t())),this.pendingCommands.length=0}updateByLibOp(t,e){1===t.path.length&&"components"===t.path[0]&&1===t.type&&this.createChildrenObjects([{...t.data.asset,id:t.id}],this.invisibleObjects,e)}updateTreeByOp(t,e){if(0===t.path.length&&7===t.type){let n=null===t.parent?this:this.find(t.parent);if(void 0===n)throw new Error("unexpected");let i=this.createObject(t.id,t.data,t.children,n,t.localIndex,e);i.updateVisible(this),i.resetBBoxNeedsUpdate(),AH(i)&&CH(i.parent)&&(i.invalidateUpstreamBooleanData(),i.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(i),this.markToExpandCloner(i),this.markPenumbraSizeDirty(),i.updatePathSnapping()}else if(0===t.path.length&&8===t.type){let e=this.find(t.id);if(void 0===e)throw new Error("unexpected");e.traverseEntity((t=>{t instanceof SW&&(this.shapeBlendIntances=this.shapeBlendIntances.filter((e=>e!==t)))})),this.markToExpandCloner(e),e.resetBBoxNeedsUpdate(),this.unregisterObject(e);let n=e.parent;this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(e),this.markPenumbraSizeDirty(),e.parent.remove(e),CH(e.parent)&&(e.parent.invalidateUpstreamBooleanData(),e.parent.invalidateDownstreamBooleanData().recomputeBoolean()),AH(e)&&(e.freeBooleanPointer(),n instanceof TH&&n.invalidateDownstreamBooleanData().recomputeBoolean()),e instanceof JG&&e.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(e),this.pathConstraints.removeDependencies(e.uuid),e.updatePathSnapping()}else if(0===t.path.length&&9===t.type){let e=this.find(t.id);if(void 0===e)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(e);let n=e.parent;this.markNeedsRecomputeInstancesForAncessors(n),e.cloner?.resetOnMove(),this.markToExpandCloner(e);let i=null===t.parent?this:this.find(t.parent);if(void 0===i)throw new Error("unexpected");i.add(e),this.markNeedsRecomputeInstancesForAncessors(i),this.markToExpandCloner(e),e.invalidateClonerTransform(e),e.updateVisible(this),e.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let r=t.localIndex;i.children.splice(r,0,i.children.pop()),AH(e)&&(e.invalidateUpstreamBooleanData(),CH(e.parent)?e.parent.invalidateDownstreamBooleanData().recomputeBoolean():n instanceof TH&&n.invalidateDownstreamBooleanData().recomputeBoolean()),e.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(t){this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let e of this.children)e instanceof YG&&(e.visible=e.uuid===t,e.visible&&(this.activePage=e,this.activePage.onActive(this)));this.activePage!==this.splatViewer?.activePage&&this.reloadSplats()}updateEntityByOp(t,e,n,i){if(0===e.type){if(("overrides"in e.props||"component"in e.props)&&this.markNeedsRecomputeInstances(),"visible"in e.props&&this.markPenumbraSizeDirty(),e.path.includes("overrides")&&"states"in e.props){let{rest:t}=e.props;e={...e,props:t},this.markNeedsRecomputeInstances()}"pathSnapping"===e.path[0]&&void 0!==e.props.pathId&&this.pathConstraints.setConstraint(t,e.props.pathId)}let r=this.find(t);if(r)try{(function(t,e,n,i){t.updateByOp(e,n,i,!1)})(r,e,n,{scene:this,shared:i}),r instanceof pj&&r.updateGeometryGroupsIfNeeded()}catch(t){console.error(t)}}updateEntity2DByOp(t,e,n,i,r,s=[]){t.updateEntityByOp(e,n,i,r),this.traverseEntity((t=>{(t instanceof sW||t instanceof YG)&&(s.includes(t.frameId??"")||t.frameId===e)&&t.updateEntity2DByOp(e,n,i,r)}))}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(t){this.activePage.switchActiveCamera(t)}isInvisibleObjects(t){return t===this.invisibleObjects||t.hasAnccestor(this.invisibleObjects)}init(t,e){let n=Object.entries(e.data.lib.components).map(((t,e)=>({data:t[1].asset.data,children:t[1].asset.children,id:t[0],fi:e})));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:e}),this.add(this.invisibleObjects),this.createChildrenObjects(n,this.invisibleObjects,e),this.createChildrenObjects(t.objects,this,e),this.updatePage(t.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(e,!0),this.traverseEntity((t=>{t instanceof wH&&t.updateUp()})),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(t){t.traverseEntity((t=>{("Component"===t.data.type||"Instance"===t.data.type)&&this.markNeedsRecomputeInstances()}))}markNeedsRecomputeInstancesForAncessors(t){fz.is(t)&&("Component"===t.data.type&&this.markNeedsRecomputeInstances(),t.traverseAncestors((t=>{fz.is(t)&&"Component"===t.data.type&&this.markNeedsRecomputeInstances()})))}relativeizeInner(t,e,n,i,r,s,a){if(t){let o=i.find(t);o&&o!==i&&r.forInstancesRec((i=>{i.data=qR(i.data,(r=>{let o=r.events.data(a.id),l=i.goUp(s);if(l){let i=[...nT(l.identity),t].join("-"),r=this.entityIdentityToEntity[i];if(r){let t=r.uuid;jR.zoom(o,e)[n]=t}else console.warn("cannot find instance")}})).data}))}}rewriteActions(t,e,n,i,r,s){t.forEach((t=>{"Transition"===t.data.type||"Animation"===t.data.type?this.relativeizeInner(t.data.object,[...e,t.id],"object",n,i,r,s):"Conditional"===t.data.type&&(this.rewriteActions(t.data.ifActions,[...e,t.id,"ifActions"],n,i,r,s),this.rewriteActions(t.data.elseActions,[...e,t.id,"elseActions"],n,i,r,s))}))}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity((t=>{if(t instanceof tW&&"string"==typeof t.identity&&"Component"===t.data.type)return t.traverseEntity(((e,n)=>{e.data.events.forEach((i=>{if("GameControl"===i.data.type){let r=!1;if(e.forInstancesRec((t=>{t.data=qR(t.data,(e=>{t.isInstanceRoot||(e.events.delete(i.id),r=!0)})).data})),!1===r)for(let r of oI.list)this.rewriteActions(i.data.gameActions[r],["gameActions",r],t,e,n,i)}else"Conditional"===i.data.type?("Distance"===i.data.condition.type?(this.relativeizeInner(i.data.condition.fromObject,["condition"],"fromObject",t,e,n,i),this.relativeizeInner(i.data.condition.toObject,["condition"],"toObject",t,e,n,i)):"State"===i.data.condition.type?this.relativeizeInner(i.data.condition.object,["condition"],"object",t,e,n,i):"Comparison"===i.data.condition.type&&("Property"===i.data.condition.lOperand.type&&this.relativeizeInner(i.data.condition.lOperand.value[0],["condition","lOperand","value"],0,t,e,n,i),"Property"===i.data.condition.rOperand.type&&this.relativeizeInner(i.data.condition.rOperand.value[0],["condition","rOperand","value"],0,t,e,n,i)),this.rewriteActions(i.data.inActions,["inActions"],t,e,n,i),this.rewriteActions(i.data.outActions,["outActions"],t,e,n,i)):"actions"in i.data&&this.rewriteActions(i.data.actions,["actions"],t,e,n,i)}))})),!0}))}expandInstances(t,e,n){let i=new Set;this.traverseEntity((r=>{if(r instanceof tW&&r.isInstanceRoot)return r.expandInstanceChildren({scene:this,shared:t,pendingDeletes:i}),e||r.resetBBoxNeedsUpdate(),n&&r.traverseEntity((t=>{n.addClip(t)})),!0}));for(let t of i)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(t),eW(t)}recomputeInstances(t,e){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity((t=>{t instanceof tW&&t.isInstanceRoot&&(t.component=void 0)})),this.expandInstances(t,!1,e))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(t){t.traverseEntity((t=>{let e="string"==typeof t.identity?t.identity:t.identity.join("-");this.entityIdentityToEntity[e]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[e]),t.dispose()}))}clearScene(){for(let t of this.children)fz.is(t)&&t.disposeRecursively();this.children.length=0}resetAfterClear(t,e){this.init(t,e)}raycast(t){return this.raycast1(t,!1)}raycast1(t,e){let n=[],i=r=>{for(let s of r.children){let r=s.cloner;if(fz.is(s)&&!s.raycastLock&&(s.visible||r?.object.data.visible))if(!0===e&&s.isInstanceRoot){let e=[];if(t.intersectObject(s,!0,e),e.length){let t=e[0];t.object=s,t.point.applyMatrix4(t.object.matrixWorld);let i=s.matrixWorld.clone().invert();t.point.applyMatrix4(i),n.push(t)}}else(AH(s)||PH(s)&&this.enableHelpers&&s.objectHelper.visible)&&(t.intersectObject(s,!1,n),BW(s,t,n)),i(s)}};return i(this.activePage),n}raycastWithClones(t){let e=[],n=i=>{for(let r of i.children){let i=r.cloner;fz.is(r)&&(r.visible||i?.object.data.visible)&&((AH(r)||PH(r)&&this.enableHelpers&&r.objectHelper.visible)&&(t.intersectObject(r,!1,e),BW(r,t,e,!0)),n(r))}};return n(this),e}forEachEntity(t){for(let e of this.children)fz.is(e)&&t(e)}traverseConcreteEntity(t){for(let e of this.children)fz.is(e)&&e.isConcreteEntity&&e.traverseEntity(t)}traverseEntity(t){for(let e of this.children)fz.is(e)&&e.traverseEntity(t)}updateFont(t,e){this.traverseEntity((n=>{if(n instanceof pj&&"Mesh"===n.data.type&&("TextGeometry"===n.data.geometry.type||"InputGeometry"===n.data.geometry.type)&&n.data.geometry.font===t){let i=n.geometry,r=n.data.geometry;i.updateFont(t,e).then((()=>{i.update(r);let t=n.invalidateDownstreamBooleanData();CH(t)&&t.recomputeBoolean()}))}}))}traverseObject(t){for(let e of this.children)oz.is(e)&&e.traverseObject(t)}traverseVisibleEntity(t){for(let e of this.children)fz.is(e)&&e.visible&&e.traverseVisibleEntity(t)}dispose(){this.clearScene()}createChildrenObjects(t,e,n){let i=0;for(let r of t)this.createObject(r.id,r.data,r.children,e,i,n),i+=1}registerObjectCreatedInLegacy(t){this.entityByUuid[t.uuid]=t}unregisterObject(t){delete this.entityByUuid[t.uuid];for(let e of t.children)this.unregisterObject(e)}createObject(t,e,n,i,r,s){let a={scene:this,shared:s},o=gW(t,e,a);return o instanceof SW&&this.shapeBlendIntances.push(o),o&&(this.entityByUuid[t]=o,i.add(o),i.children.splice(r,0,i.children.pop()),n.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(n,o,s)),o.updateState(e,a),o instanceof pj&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(this),o.cloner&&this.toExpandCloner.add(o),e.pathSnapping?.pathId&&this.pathConstraints.setConstraint(t,e.pathSnapping.pathId)),"Empty"===e.type&&e.animations&&o.traverseEntity((t=>{let e=t.dataPatched;if(t instanceof pj&&e.bones&&e.boneInverses){let n=e.bones.map((t=>this.find(t))),i=e.boneInverses.map((t=>(new Mg).fromArray(t))),r=new w_(n,i);t.bind(r,t.bindMatrix)}else t.matrixAutoUpdate=!0})),o}getCenter(t){let e=[];for(let n=0,i=t.length;n<i;++n){let{id:i,recursive:r}=t[n],s=this.find(i),a=r?s.recursiveBBox:s.singleBBox;e.push(...a.vertices)}let n=new Km;return n.setFromPoints(e),n.getCenter(nq),nq}copyMatrixWorld(t,e){if(null===t)return void e.identity();let n=this.find(t);n?e.copy(n.matrixWorld):e.identity()}copyParentMatrixWorld(t,e){if(null===t)return void e.identity();let n=this.find(t)?.parent;n?e.copy(n.matrixWorld):e.identity()}traverseMaterial(t){this.traverseEntity((e=>{if(e instanceof Xk)if(Array.isArray(e.material))for(let n=0;n<e.material.length;n++)e.material[n]instanceof sV&&t(e.material[n]);else e.material instanceof sV&&t(e.material)}))}updateViewPlaneSize(t,e,n=!1){this.traverseConcreteEntity((i=>{i instanceof wH&&i.setViewplaneSize(t,e,n)}))}initializeSplatViewer(){this.splatViewer=new tq({scene:this}),this.reloadSplats()}reloadSplats(){this.splatViewer?.loadSplat()}};async function rq(t){if(eq){let e,n={attributeIDs:eq.defaultAttributeIDs,attributeTypes:eq.defaultAttributeTypes,useUniqueIDs:!1};try{e=await eq.decodeGeometry(new Int8Array(t).buffer,n)}catch(t){console.error(t)}if(e)return{index:e.index?{array:e.index.array}:void 0,attributes:Object.entries(e.attributes).map((([t,e])=>({name:t,itemSize:e.itemSize,array:e.array})))}}return null}function sq(t){let e=new Set;return t.traverse((t=>{if(t instanceof oj)if(bT(t.material))t.material.forEach((t=>{let n=t;e.has(n)||e.add(n)}));else{let n=t.material;e.has(n)||e.add(n)}})),e.forEach((t=>{if(t instanceof Array)return;let e=t.onBeforeCompile.bind(t);if(function(t){return t.getLayersOfType("transmission").length>0}(t)){Object.assign(t,{isMeshStandardMaterial:!0,isMeshPhysicalMaterial:!0,transmission:1,attenuationColor:new pv,specularColor:new pv});let n=0;t.onBeforeCompile=(i,r)=>{e&&e(i,r),i.uniforms=Object.assign({},Py.physical.uniforms,i.uniforms),t.getLayersOfType("transmission").forEach((e=>{if(i.uniforms.transmissionSamplerMap.value){let n=e.color;n&&(n.transmissionSamplerMap.value=i.uniforms.transmissionSamplerMap.value,n.transmissionSamplerSize.value=i.uniforms.transmissionSamplerSize.value,n.aspectRatio.value=function(t,e){return t>=e?new ym(e/t,1):new ym(1,t/e)}(window.innerWidth,window.innerHeight),t.defines.IS_THREEJS_EXPORT=!0)}else n++,n<2&&(t.needsUpdate=!0)}))}}else(function(t){let e=0;for(let n of t.layers){if("displace"!==n.data.type&&n.data.isMask)return!0;if("light"!==n.type&&"fresnel"!==n.type){let t=n.uniforms["f"+n.id+"_alpha"];t&&(e+=(1-e)*t.value)}}return e<1})(t)||(t.onBeforeCompile=(n,i)=>{e&&e(n,i),t.transparent=!1})})),t}function aq(t){Object.values(t.shared.materials).forEach((t=>{oq(t)})),t.scene.objects.traverse(((t,e)=>{"material"in e?oq(e.material):"materials"in e&&e.materials.forEach((t=>{oq(t)}))}))}function oq(t){if("string"==typeof t)return;let e=[];t.layers.forEach(((t,n)=>{"outline"===t.type&&e.push(n)})),e.reverse().forEach((e=>{t.layers.delete(e)})),e.length&&console.warn("The Spline Loader currently does not support the outline layer.")}var lq=XM(QM(),1),cq="The SplineLoader only accepts .splinecode files that are generated from Spline export panel.",hq=class extends yS{load(t,e,n,i=console.error){let r=new _S(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),t.endsWith(".spline")?console.warn(cq+" The .spline files are only meant to be used by the Editor."):t.endsWith(".splinecode")||console.warn(cq),r.load(t,(async t=>{try{if("string"==typeof t)throw new Error("The .spline file is not binary!");let n=await this.parse(t);e(n)}catch(t){i(t)}}),n,i)}async parse(t){let e=await async function(t,e){let[n,i]=WR(pD.deserialize(new Uint8Array(t)));return KI(n),e&&e(n),i.result().data}(t,aq),n=function(t){let e=[];return t.scene.objects.traverse(((t,n)=>{"Mesh"===n.type&&"NonParametricGeometry"===n.geometry.type&&void 0!==n.geometry.data.draco&&e.push(n)})),e}(e);e.version&&(0,lq.default)(e.version,"1.9.69")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/loader to the latest version."),await Promise.allSettled([n.length&&(eq||(eq=new kM).setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload(),eq.decoderPending),yj(e)&&lk(),kj(e)&&bV(),fG(e)&&pG(),qW(e)&&QW()].filter(Boolean)),n.length&&await async function(t){for(let e of t){let t=await rq(e.geometry.data.draco);if(t){let n=e.geometry.data;t.index&&(n.index={array:t.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let i={};t.attributes.forEach((({name:t,array:e,itemSize:n})=>{i[t]={array:e,itemSize:n,type:"Float32Array",normalized:!1}})),n.attributes=i,n.draco=void 0}}}(n);let i=new sj(e.shared,{},!1);Object.values(i.getMaterials()).forEach((t=>Object.assign(t,{isAsset:!0})));let s=new iq(e.scene,i);qW(e)&&s.initializeSplatViewer();let a=s.activeCamera;return a&&Object.assign(a,{makeDefault:!0}),s=function(t){let e=[];return t.traverse((t=>{t instanceof nH&&e.push(t)})),e.forEach((e=>{let n=e.object,i=[...e.children.map((t=>{let e;if(t.updateMatrix(),void 0!==t.geometry)try{e=t.geometry.clone().applyMatrix4(t.matrix)}catch(t){console.error(t)}return void 0!==e&&t.matrix.determinant()<0&&function(t){let e;if(t.index)for(let n=0;n<t.index.array.length;n+=3)e=t.index.array[n],t.index.array[n]=t.index.array[n+2],t.index.array[n+2]=e}(e),e})).filter((t=>void 0!==t))];if(!e.parameters.hideBase&&n instanceof Xk&&i.unshift(n.geometry),i.length){let t=(0,r.mergeBufferGeometries)(i);n instanceof Xk&&(n.geometry=t)}e.removeFromParent(),n.setFromClonerState(null,{scene:t,shared:aj})})),t}(s),s=sq(s),s=function(t){return t.traverse((t=>{if("Camera"===t.type){let e=t;e.type=e.cameraType}})),t}(s),s=function(t){let e=[],n=(t,i=0)=>{let r=i>0?t+i:t;return e.includes(r)?n(t,i+1):r};return t.traverse((t=>{if(e.includes(t.name)){let e=t.name,i=n(t.name);if(t.name=i,t.isMesh){let n=t;n.material instanceof Array?n.material.forEach((t=>{t.name=t.name.replace(e,i)})):n.material.isAsset||(n.material.name=n.material.name.replace(e,i))}}e.push(t.name)})),t}(s),s=function(t){return t.traverse((t=>{t.matrixAutoUpdate=!0})),t}(s),s}};var uq=jQuery;window.blobVars={camera:null,scene:null,renderer:null,controls:null,blob:null,sphereMaterial:null,group:null},uq(document).on("ready",(function(){if(!document.getElementById("canvas3d"))return;const t=Cd?window.innerHeight:2*window.innerHeight;window.blobVars.camera=new By(window.innerWidth/-2,window.innerWidth/2,t/2,t/-2,-5e4,1e4),window.blobVars.camera.position.set(0,0,-30),window.blobVars.camera.quaternion.setFromEuler(new Ig(0,0,0)),window.blobVars.scene=new f_;let e=1;if(Cd){const t=1440,n=900,i=window.innerWidth,r=window.innerHeight,s=Math.sqrt(t*t+n*n),a=Math.sqrt(i*i+r*r);e=a/s}(new hq).load("/app/themes/lbh-boilerplate/resources/scripts/constants/scene.splinecode",(t=>{window.blobVars.group=new i_,window.blobVars.blob=t.children[0].children[1],window.blobVars.sphereMaterial=window.blobVars.blob.material;let n=window.blobVars.sphereMaterial.uniforms;n.nodeU37.value=.8;const i=new oy({defines:{BLUR_SLOD:4,NUM_SAMPLES:6,USE_LAYER_DISPLACE:1},uniforms:n,vertexShader:'#define GLSLIFY 1\n#ifdef TEXTURE_LOD_EXT\n\t#define texCube(a, b) textureCube(a, b)\n\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)\n\t#define tex2D(a, b) texture2D(a, b)\n\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)\n#else\n\t#define texCube(a, b) textureCube(a, b)\n\t#define texCubeBias(a, b, c) textureCube(a, b, c)\n\t#define tex2D(a, b) texture2D(a, b)\n\t#define tex2DBias(a, b, c) texture2D(a, b, c)\n#endif\n\n\t\t\t// NOTE: Include Spline\'s blending modes. This could be part of BlendNode\n\t\t\t#define SPE_BLENDING_NORMAL 0\n\t\t\t#define SPE_BLENDING_MULTIPLY 1\n\t\t\t#define SPE_BLENDING_SCREEN 2\n\t\t\t#define SPE_BLENDING_OVERLAY 3\n\n\t\t\tvec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, a * b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );\n\t\t\t\treturn mix( a, tmp, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );\n\t\t\t\treturn clamp( mix( a, tmp, alpha ), 0.0, 1.0 );\n\t\t\t}\n\n\t\t\tvec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {\n\t\t\t\tif ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );\n\t\t\t\treturn vec3( 1.0 );\n\t\t\t}\n\t\t\t\n#include <packing>\n#include <common>\nfloat neighbor_offset = 0.0001;\n\nuniform int frameIndex;\nuniform vec2 resolution;\nuniform mat4 previousModelViewMatrix;\nuniform mat4 previousProjectionMatrix;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n\nvarying vec3 vViewPosition;\nvarying vec3 vWPosition;\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\nvarying vec2 vUv;\nvarying vec3 vObjectNormal;\nvarying vec3 vWNormal;\nvarying vec3 vWorldViewDir;\n\nuniform float nodeU0;\nuniform vec3 nodeU1;\nuniform float nodeU2;\nuniform int nodeU3;\nuniform float nodeU4;\nuniform float nodeU5;\nuniform float nodeU6;\nuniform float nodeU7;\nuniform int nodeU8;\nuniform float nodeU9;\n\nconst float F3 = 0.3333333;\nconst float G3 = 0.1666667;\nconst int NUM_OCTAVES = 5;\n\nvec3 random3(vec3 c) {\n\t\t\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\t\t\tvec3 r;\n\t\t\tr.z = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.x = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.y = fract(512.0*j);\n\t\t\treturn r-0.5;\n\t\t}\nvec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\nvec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}\nfloat hashwithoutsine13(vec3 p3)\n\t\t{\n\t\t\tp3  = fract(p3 * .1031);\n\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t}\nvec3 hashwithoutsine33(vec3 p3)\n\t\t{\n\t\t\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\n\t\t\tp3 += dot(p3, p3.yxz+33.33);\n\t\t\treturn fract((p3.xxy + p3.yxx)*p3.zyx);\n\t\t}\nfloat metric(in vec3 p)\n\t\t{\n\t\t\t// L2 \n\t\t\treturn length(p);\n\n\t\t\t// Chebyshev \n\t\t\t// vec3 a = abs(p);\n\t\t\t// return max(a.x, max(a.y, a.z));\n\t\t}\nfloat smin( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(b, a, h) - correction;\n\t\t}\nfloat smax( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(a, b, h) + correction;\n\t\t}\nfloat remap(float value, float input_min, float input_max, float output_min, float output_max) {\n\t\t\t// Compute width of each interval\n\t\t\tfloat input_width = input_max - input_min;\n\t\t\tfloat output_width = output_max - output_min;\n\t\t\n\t\t\t// Convert input range into a 0-1 range \n\t\t\tfloat scaled = (value - input_min) / input_width;\n\t\t\n\t\t\t// Convert the 0-1 range into a value in output range\n\t\t\treturn output_min + (scaled * output_width);\n\t\t}\nvec3 orthogonal(vec3 v) {\n\t\t\t\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t\t\t\t}\nfloat simplex3d(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t \n\t\t\t vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t vec3 x1 = x - i1 + G3;\n\t\t\t vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(s), x);\n\t\t\t d.y = dot(random3(s + i1), x1);\n\t\t\t d.z = dot(random3(s + i2), x2);\n\t\t\t d.w = dot(random3(s + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\nfloat simplex3dFractal(vec3 m) {\n\t\t\tmat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);\n\t\t\tmat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);\n\t\t\tmat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);\n\t\t\treturn 0.5333333 * simplex3d(m * rot1)\n\t\t\t\t + 0.2666667 * simplex3d(2.0 * m * rot2)\n\t\t\t\t + 0.1333333 * simplex3d(4.0 * m * rot3)\n\t\t\t\t + 0.0666667 * simplex3d(8.0 * m);\n\t\t}\nfloat simplexAshima(vec3 v) {\n\t\t  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t  vec3 i  = floor(v + dot(v, C.yyy) );\n\t\t  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\t\t  vec3 g = step(x0.yzx, x0.xyz);\n\t\t  vec3 l = 1.0 - g;\n\t\t  vec3 i1 = min( g.xyz, l.zxy );\n\t\t  vec3 i2 = max( g.xyz, l.zxy );\n\t\t  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\t\t  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\t\t  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\t\t  i = mod(i, 289.0 ); \n\t\t  vec4 p = permute( permute( permute( \n\t\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n\t\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t  float n_ = 1.0/7.0; // N=7\n\t\t  vec3  ns = n_ * D.wyz - D.xzx;\n\t\t  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\t\t  vec4 x_ = floor(j * ns.z);\n\t\t  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\t\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t\t  vec4 h = 1.0 - abs(x) - abs(y);\n\t\t  vec4 b0 = vec4( x.xy, y.xy );\n\t\t  vec4 b1 = vec4( x.zw, y.zw );\n\t\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t  vec4 sh = -step(h, vec4(0.0));\n\t\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t  vec3 p0 = vec3(a0.xy,h.x);\n\t\t  vec3 p1 = vec3(a0.zw,h.y);\n\t\t  vec3 p2 = vec3(a1.xy,h.z);\n\t\t  vec3 p3 = vec3(a1.zw,h.w);\n\t\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t  p0 *= norm.x;\n\t\t  p1 *= norm.y;\n\t\t  p2 *= norm.z;\n\t\t  p3 *= norm.w;\n\t\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t  m = m * m;\n\t\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n\t\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t\t}\nfloat noise(vec3 p){\n\t\t\tvec3 a = floor(p);\n\t\t\tvec3 d = p - a;\n\t\t\td = d * d * (3.0 - 2.0 * d);\n\t\t\tvec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n\t\t\tvec4 k1 = perm(b.xyxy);\n\t\t\tvec4 k2 = perm(k1.xyxy + b.zzww);\n\t\t\tvec4 c = k2 + a.zzzz;\n\t\t\tvec4 k3 = perm(c);\n\t\t\tvec4 k4 = perm(c + 1.0);\n\t\t\tvec4 o1 = fract(k3 * (1.0 / 41.0));\n\t\t\tvec4 o2 = fract(k4 * (1.0 / 41.0));\n\t\t\tvec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n\t\t\tvec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\t\t\treturn o4.y * d.y + o4.x * (1.0 - d.y);\n\t\t}\nfloat fbm(vec3 x) {\n\t\t\tfloat v = 0.0;\n\t\t\tfloat a = 0.5;\n\t\t\tvec3 shift = vec3(100);\n\t\t\tfor (int i = 0; i < NUM_OCTAVES; ++i) {\n\t\t\t\tv += a * noise(x);\n\t\t\t\tx = x * 2.0 + shift;\n\t\t\t\ta *= 0.5;\n\t\t\t}\n\t\t\treturn v;\n\t\t}\nfloat perlin(vec3 P){\n\t\t  vec3 Pi0 = floor(P);\n\t\t  vec3 Pi1 = Pi0 + vec3(1.0);\n\t\t  Pi0 = mod(Pi0, 289.0);\n\t\t  Pi1 = mod(Pi1, 289.0);\n\t\t  vec3 Pf0 = fract(P);\n\t\t  vec3 Pf1 = Pf0 - vec3(1.0);\n\t\t  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\t\t  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n\t\t  vec4 iz0 = Pi0.zzzz;\n\t\t  vec4 iz1 = Pi1.zzzz;\n\t\t  vec4 ixy = permute(permute(ix) + iy);\n\t\t  vec4 ixy0 = permute(ixy + iz0);\n\t\t  vec4 ixy1 = permute(ixy + iz1);\n\t\t  vec4 gx0 = ixy0 / 7.0;\n\t\t  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n\t\t  gx0 = fract(gx0);\n\t\t  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\t\t  vec4 sz0 = step(gz0, vec4(0.0));\n\t\t  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\t\t  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\t\t  vec4 gx1 = ixy1 / 7.0;\n\t\t  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n\t\t  gx1 = fract(gx1);\n\t\t  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\t\t  vec4 sz1 = step(gz1, vec4(0.0));\n\t\t  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\t\t  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\t\t  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\t\t  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\t\t  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\t\t  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\t\t  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\t\t  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\t\t  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\t\t  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\t\t  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\t\t  g000 *= norm0.x;\n\t\t  g010 *= norm0.y;\n\t\t  g100 *= norm0.z;\n\t\t  g110 *= norm0.w;\n\t\t  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\t\t  g001 *= norm1.x;\n\t\t  g011 *= norm1.y;\n\t\t  g101 *= norm1.z;\n\t\t  g111 *= norm1.w;\n\t\t  float n000 = dot(g000, Pf0);\n\t\t  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\t\t  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\t\t  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\t\t  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\t\t  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\t\t  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\t\t  float n111 = dot(g111, Pf1);\n\t\t  vec3 fade_xyz = fade(Pf0);\n\t\t  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\t\t  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\t\t  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n\t\t  return 2.2 * n_xyz;\n\t\t}\nfloat voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) \n\t\t{\n\t\t\t// Integer and fractional parts of this point\'s coordinates\n\t\t\tivec3 p = ivec3(floor(x));\n\t\t\tvec3 f = fract(x);\n\n\t\t\t// Different variables that we will use to construct noise:\n\t\t\t//\n\t\t\t// f1: distance to the closest feature point\n\t\t\t// f2: distance to the second closest feature point\n\t\t\t// e: distance to the closest edge (cell boundary)\n\t\t\t//\n\t\t\t// We also compute "smooth" versions of all of the above quantites, essentially\n\t\t\t// replacing "hard" minimums with "smooth" minimums (described by IQ)\n\t\t\tfloat f1_smooth = 8.0;\n\t\t\tfloat f1 = 8.0;\n\t\t\tfloat f2_smooth = 8.0;\n\t\t\tfloat f2 = 8.0;\n\t\t\tfloat e_smooth = 8.0;\n\t\t\tfloat e = 8.0;\n\n\t\t\t// Variables stored from closest cell\n\t\t\tivec3 mb;\n\t\t\tvec3 mr; \n\n\t\t\tint steps = quality;\n\t\t\t\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d = length(r);\n\t\t\t\t\n\t\t\t\tf1_smooth = smin(d, f1_smooth, smoothness);\n\n\t\t\t\t// Store un-smoothed distances too \n\t\t\t\tif (d < f1) \n\t\t\t\t{\n\t\t\t\t\tf2 = f1;\n\t\t\t\t\tf1 = d;\n\n\t\t\t\t\tmb = ivec3(x, y, z);\n\t\t\t\t\tmr = r;\n\t\t\t\t} \n\t\t\t\telse if (d < f2) \n\t\t\t\t{\n\t\t\t\t\tf2 = d;\n\t\t\t\t}\n\t\t\t}\t\n\t\t\t\n\t\t\tfloat id = hashwithoutsine13(vec3(p + mb) + seed);\n\n\t\t\t// Second pass for edge distance  \n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\t// Start search at the cell that contains the closest point to "x" (found in 1st pass)\n\t\t\t\tivec3 b = mb + ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d1 = dot(0.5 * (mr + r), (r - mr)); \t\t\t\t// IQ normalizes "r - mr" but that breaks things for the smooth version?\n\t\t\t\tfloat d2 = dot(0.5 * (mr + r), normalize(r - mr));\n\n\t\t\t\te_smooth = smin(d1, e_smooth, smoothness);\n\n\t\t\t\te = min(e, d2);\n\n\t\t\t\t// Also compute a smooth version of F2 in this pass\n\t\t\t\t{\n\t\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\t\tif (b != mb) \n\t\t\t\t\t{\n\t\t\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\t\t\tfloat d = length(r);\n\n\t\t\t\t\t\tf2_smooth = smin(d, f2_smooth, smoothness);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Different visualization modes \n\t\t\tif (style == 0) \n\t\t\t{\n\t\t\t\treturn f1_smooth;\n\t\t\t}\n\t\t\tif (style == 1) \n\t\t\t{\n\t\t\t\treturn f2_smooth;\n\t\t\t}\n\t\t\tif (style == 2) \n\t\t\t{\n\t\t\t\treturn f2_smooth - f1_smooth;\n\t\t\t\t\n\t\t\t\t// "Pebbles" also cool\n\t\t\t\t//return step(0.2, f2_smooth - f1_smooth);\n\t\t\t}\n\t\t\tif (style == 3) \n\t\t\t{\n\t\t\t\t// This one is really good for rock / stone effects\n\t\t\t\tfloat a = f1; \n\t\t\t\tfloat b = f2;\n\t\t\t\tfloat k = 3.0;\n\t\t\t\tfloat h = max(k - abs(a - b), 0.0) / k;\n\t\t\t\tfloat final = min(a, b) - h * h * k * (1.0 / 4.0);\n\t\t\t\treturn final;\n\t\t\t}\n\t\t\tif (style == 4) \n\t\t\t{\n\t\t\t\t// Some random adjustments to make this style stand out more \n\t\t\t\treturn exp(5.0 * e_smooth);\n\t\t\t}\n\t\t\tif (style == 5) \n\t\t\t{\n\t\t\t\treturn pow(f1_smooth, 3.0);\n\t\t\t}\n\t\t\tif (style == 6) \n\t\t\t{\t\t\t\t\n\t\t\t\tconst float eps = 0.0125;\n\n\t\t\t\t// Thicker lines as the user increases the smoothness slider\n\t\t\t\tfloat thickness = smoothness * 0.25 + eps;\n\n\t\t\t\t// Blurrier lines as the user increases the smoothness slider\n\t\t\t\tfloat blur = pow(smoothness, 3.0) * 0.25 + eps;\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\tthickness - thickness * blur, \n\t\t\t\t\tthickness + thickness * blur, \n\t\t\t\t\te\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (style == 7) \n\t\t\t{\n\t\t\t\treturn hashwithoutsine13(vec3(p + mb) + seed);\n\t\t\t}\n\t\t}\n\t\nvec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {\n\t\t\t\t\t\t\t\n\t\t\t\t\treturn p + n * simplex3d((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;\n\t\t\t\t\t\n\t\t\t\t\t\t}\nvec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {\n\t\t\t\t\t\t\tvec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 tangent1 = orthogonal(normal);\n\t\t\t\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\n                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.\n                            // This caused some small oval/circular visual artifacts in the lighting.\n                            // For now, simply using neighbors further away betters the problem,\n                            // but we should figure out the underlying cause when we have some time.\n                            // Maybe its related to how we calculate the tangent and bitangent?\n\t\t\t\t\t\t\tvec3 nearby1 = position + tangent1;\n\t\t\t\t\t\t\tvec3 nearby2 = position + tangent2;\n\t\t\t\t\t\t\tvec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\t\t\t\treturn displaced_position;\n\t\t\t\t\t\t}\n\nvoid main() {\n\n#include <beginnormal_vertex>\n\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t\n#include <normal_vertex>\n\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t\n\ndisplaced_position = vertexDisplacementNoise(displaced_position,displaced_normal,nodeU0,nodeU1,nodeU2,nodeU3,nodeU4,nodeU5,nodeU6,nodeU7,nodeU8,nodeU9,displaced_normal);\ntransformed = displaced_position;\ntransformedNormal = normalMatrix * displaced_normal;\n#ifndef FLAT_SHADED\n\tvNormal = transformedNormal;\n#endif\n#include <project_vertex>\n#include <fog_vertex>\n#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n#include <worldpos_vertex>\nvWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;\nvUv = uv;\nvObjectNormal = normal;\nvWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;\nvWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );\n\n}',fragmentShader:'#define GLSLIFY 1\n#ifdef TEXTURE_LOD_EXT\n\t#define texCube(a, b) textureCube(a, b)\n\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)\n\t#define tex2D(a, b) texture2D(a, b)\n\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)\n#else\n\t#define texCube(a, b) textureCube(a, b)\n\t#define texCubeBias(a, b, c) textureCube(a, b, c)\n\t#define tex2D(a, b) texture2D(a, b)\n\t#define tex2DBias(a, b, c) texture2D(a, b, c)\n#endif\n\n\t\t\t// NOTE: Include Spline\'s blending modes. This could be part of BlendNode\n\t\t\t#define SPE_BLENDING_NORMAL 0\n\t\t\t#define SPE_BLENDING_MULTIPLY 1\n\t\t\t#define SPE_BLENDING_SCREEN 2\n\t\t\t#define SPE_BLENDING_OVERLAY 3\n\n\t\t\tvec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, a * b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );\n\t\t\t\treturn mix( a, tmp, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );\n\t\t\t\treturn clamp( mix( a, tmp, alpha ), 0.0, 1.0 );\n\t\t\t}\n\n\t\t\tvec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {\n\t\t\t\tif ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );\n\t\t\t\treturn vec3( 1.0 );\n\t\t\t}\n\t\t\t\n#include <packing>\n#include <common>\nfloat accumAlpha = 0.0;\nvoid accumulateAlpha(float alpha) {\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * alpha;\n\t\t\t\t}\n\nlayout(location = 1) out vec4 gVelocity;\n\nuniform int frameIndex;\nuniform vec2 resolution;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\nvec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {\n  const float goldenAngle = 2.399963f; // radians\n  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));\n  float theta = float(sampleIndex) * goldenAngle + angle;\n  float sine = sin(theta);\n  float cosine = cos(theta);\n  return vec2(cosine, sine) * r;\n}\n\n// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso\nfloat getNoiseInterleavedGradient(vec2 screenPos) {\n    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);\n    return fract(magic.z * fract(dot(screenPos, magic.xy)));\n}\n\nvarying vec3 vWPosition;\n#include <fog_pars_fragment>\n#include <dithering_pars_fragment>\nvarying vec3 vViewPosition;\n#include <normal_pars_fragment>\nvarying vec2 vUv;\nvarying vec3 vObjectNormal;\nuniform mat4 modelMatrix;\nuniform mat4 projectionMatrix;\nvarying vec3 vWNormal;\nvarying vec3 vWorldViewDir;\n\nuniform float nodeU10;\nuniform float nodeU11;\nuniform float nodeU12;\nuniform vec2 nodeU13;\nuniform sampler2D nodeU14;\nuniform sampler2D nodeU15;\nuniform vec2 nodeU16;\nuniform float nodeU17;\nuniform sampler2D nodeU18;\nuniform bool nodeU19;\nuniform float nodeU20;\nuniform int nodeU21;\nuniform float nodeU22;\nuniform sampler2D nodeU23;\nuniform bool nodeU24;\nuniform float nodeU25;\nuniform int nodeU26;\nuniform float nodeU27;\nuniform vec3 nodeU28;\nuniform float nodeU29;\nuniform float nodeU30;\nuniform float nodeU31;\nuniform float nodeU32;\nuniform bool nodeU33;\nuniform float nodeU34;\nuniform int nodeU35;\nuniform float nodeU36;\nuniform float nodeU37;\n\nfloat w0( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n        }\n    \n        float w1( float a ) {\n            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n        }\n    \n        float w2( float a ){\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n        }\n    \n        float w3( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * a * a );\n        }\n    \n        // g0 and g1 are the two amplitude functions\n        float g0( float a ) {\n            return w0( a ) + w1( a );\n        }\n    \n        float g1( float a ) {\n            return w2( a ) + w3( a );\n        }\n    \n        // h0 and h1 are the two offset functions\n        float h0( float a ) {\n            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n        }\n    \n        float h1( float a ) {\n            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n        }\n    \n        vec4 bicubic( sampler2D tex, vec2 vUv, vec4 texelSize, float lod ) {\n            vUv = vUv * texelSize.zw + 0.5;\n    \n            vec2 iuv = floor( vUv );\n            vec2 fuv = fract( vUv );\n    \n            float g0x = g0( fuv.x );\n            float g1x = g1( fuv.x );\n            float h0x = h0( fuv.x );\n            float h1x = h1( fuv.x );\n            float h0y = h0( fuv.y );\n            float h1y = h1( fuv.y );\n    \n            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n    \n            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + \n                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n        }\n\n        vec4 textureBicubic( sampler2D sampler, vec2 vUv, float lod ) {\n            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n            vec2 fLodSizeInv = 1.0 / fLodSize;\n            vec2 cLodSizeInv = 1.0 / cLodSize;\n            vec4 fSample = bicubic( sampler, vUv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n            vec4 cSample = bicubic( sampler, vUv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n            return mix( fSample, cSample, fract( lod ) );\n        }\nfloat applyIorToRoughness( float roughness, float ior ) {\n\t\t\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\t\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t\t\t}\nvec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {\n                // Slightly modified version of this:\n                // https://www.shadertoy.com/view/ltScRG\n\n\t\t\t\t// Special case for blur == 0.0\n\t\t\t\tif (lod == 0.0) {\n\t\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\t\treturn texture2DLodEXT( sp, U, 0.0).rgb;\n\t\t\t\t\t#else\n\t\t\t\t\treturn textureLod( sp, U, 0.0).rgb;\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec2 texelSize = vec2(1.0) / resolution;\n                vec2 halton = haltonSequence[frameIndex];\n                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n                float temporalAngle  = temporalOffset * PI2;\n\t\t\t\tvec3 res = vec3(0.0);\n                vec2 vUv = vec2(0.0);\n                vec2 offset = vec2(0.0);\n                vec2 vogelSample = vec2(0.0);\n                for (int i = 0; i < NUM_SAMPLES; i++) {\n                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;\n                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20\n                    vUv = U + offset;\n                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, vUv, lod));\n                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {\n                        vUv = unrefractedU;\n                        lod = lod > 4.0 ? lod : lod / 2.0;\n                    }\n                    res += textureLod(sp, vUv, lod).rgb;\n                }\n                return res / float(NUM_SAMPLES);\n            }\nvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\t        // Direction of refracted light.\n\t\t        vec3 refractionVector = refract( -v,  n, 1.0 / ior );\n\t\t        \n\t\t\t\t// Compute rotation-independant scaling of the model matrix.\n\t\t        vec3 modelScale;\n\t\t        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\t        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\t        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\n\t\t        // The thickness is specified in local space\n\t\t        return normalize( refractionVector ) * thickness * modelScale;\n\t        }\nvec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {\n    vec3 n = normalize(normal);\n\n    // Calculate view direction\n    vec3 viewDir = normalize(vViewPosition);\n\n    // Compute tangent space basis vectors\n    vec3 r = n; // Reflect view direction around the normal\n    float m = 0.55 + sqrt(\n        r.x * r.x +\n        r.y * r.y +\n        (r.z + 1.0) * (r.z + 1.0)\n    );\n    vec2 vUv = r.xy / m + 0.5;\n\n    // Apply rotation if needed\n    // vUv = mat2(cos(rotation), sin(rotation), -sin(rotation), cos(rotation)) * (vUv - 0.5) * 1.7 + 0.5;\n\n    // Ensure UVs are within the [0, 1] range to avoid sampling outside the texture\n    vUv = clamp(vUv, 0.0, 1.0);\n\n    // Sample the matcap texture\n    vec4 matcapColor = texture2D(matcapTex, vUv);\n\n    // Calculate alpha blending\n    float lalpha = alpha * mask;\n    calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n    accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n    return matcapColor.rgb;\n}\nvec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\t\t\t\t\tfloat fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );\n\n\t\t\t\t\tfloat lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn color;\n\t\t\t\t}\nvec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {\n\t\t\t\t// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see\n\t\t\t\t// also the code in convertTransmission.ts, which runs during export\n\t\t\t\t#ifdef IS_THREEJS_EXPORT\n\t\t\t\t\tfloat lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);\n\t\t\t\t\treturn textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;\n\t\t\t\t#else\n\t\t\t\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t\t\t\tfloat lod = applyIorToRoughness(roughness, ior);\n\t\t\t\t\treturn blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);\n\t\t\t\t#endif\n\t\t\t}\nvec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\n\t\t\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\n\t\t\t\tvec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );\n\t\t\t\tvec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;\n\t\t\t\tunrefractedCoords += 1.0;\n\t\t\t\tunrefractedCoords /= 2.0;\n\n\t\t\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\t\t\treturn getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );\n    \t\t}\nvec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {\n                vec3 v = vec3(0.);\n                if (isOrthographic) {\n                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n                } else {\n                    v = normalize(vWPosition - cameraPosition);\n                }\n                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );\n                \n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * alpha;\n\n\t\t\t\treturn transmission;\n            }\n\nvoid main() {\n\nfloat g_uid55_calpha;\nfloat g_uid46_calpha;\nfloat g_uid39_calpha;\nfloat g_uid19_calpha;\n\n#include <normal_fragment_begin>\n\n#ifdef ALPHATEST\n if ( nodeU36 <= ALPHATEST ) discard;\n#endif\nvec3 finalColor = spe_blend(spe_blend(spe_blend(transmission(nodeU10,nodeU11,nodeU12,nodeU13,nodeU14,nodeU15,nodeU16,normal,1.0,nodeU17,g_uid55_calpha),matcap(nodeU18,normal,nodeU19,1.0,nodeU20,nodeU21,g_uid46_calpha,nodeU22),( g_uid46_calpha ),nodeU21),matcap(nodeU23,normal,nodeU24,1.0,nodeU25,nodeU26,g_uid39_calpha,nodeU27),( g_uid39_calpha ),nodeU26),fresnel(nodeU28,nodeU29,nodeU30,nodeU31,nodeU32,nodeU33,1.0,nodeU34,nodeU35,g_uid19_calpha),( g_uid19_calpha ),nodeU35);\ngl_FragColor = vec4( finalColor, accumAlpha * nodeU36 * 1.0 );\ngl_FragColor.a *= nodeU37;\n#include <fog_fragment>\n#include <dithering_fragment>\n\n}',transparent:!0,depthWrite:!1,blending:kd,opacity:1});window.blobVars.blob.material?window.blobVars.blob.material=i:console.error("Material not found"),setTimeout((()=>{window.blobVars.group.add(window.blobVars.blob),window.blobVars.scene.add(window.blobVars.group),Cd&&window.blobVars.blob.scale.set(e,e,e),gsap.from(n.nodeU37,{value:0,duration:1,ease:"power2.out"});const t=new Event("blobInitialized");window.dispatchEvent(t)}),10)}));const n=document.getElementById("canvas3d");window.blobVars.renderer=new d_({canvas:n,antialias:!0}),Cd?window.blobVars.renderer.setSize(window.innerWidth,window.innerHeight):window.blobVars.renderer.setSize(window.innerWidth,2*window.innerHeight),window.blobVars.renderer.setAnimationLoop(o),window.blobVars.renderer.shadowMap.enabled=!0,window.blobVars.renderer.shadowMap.type=Dd,window.blobVars.renderer.setClearAlpha(0),window.blobVars.controls=new EM(window.blobVars.camera,window.blobVars.renderer.domElement),window.blobVars.controls.enableDamping=!0,window.blobVars.controls.dampingFactor=.125,window.blobVars.controls.enabled=!1,window.addEventListener("resize",(function(){const t=Cd?window.innerHeight:2*window.innerHeight;Cd&&(window.blobVars.camera.left=window.innerWidth/-2,window.blobVars.camera.right=window.innerWidth/2,window.blobVars.camera.top=t/2,window.blobVars.camera.bottom=t/-2,window.blobVars.camera.updateProjectionMatrix(),window.blobVars.renderer.setSize(window.innerWidth,t))}));let i=new Ig(0,0,0),r=new Ig(0,0,0),s=new $m(0,0,0),a=new $m;function o(){window.blobVars.sphereMaterial&&(window.blobVars.sphereMaterial.uniforms.nodeU2.value+=.08),window.blobVars.blob&&(r.x+=.03*(i.x-r.x),r.y+=.03*(i.y-r.y),window.blobVars.blob.rotation.x=r.x,window.blobVars.blob.rotation.y=r.y,a.x+=.03*(s.x-a.x),a.y+=.03*(s.y-a.y),window.blobVars.blob.position.x=a.x,window.blobVars.blob.position.y=a.y),window.blobVars.controls.update(),window.blobVars.renderer.render(window.blobVars.scene,window.blobVars.camera),window.blobVars.camera.updateProjectionMatrix()}uq(document).on("mousemove",(function(t){if(Cd&&t.clientX&&t.clientY){const e=t.clientX/window.innerWidth*2-1,n=-t.clientY/window.innerHeight*2+1,r=.5;i.x=n*Math.PI*r,i.y=e*Math.PI*r;const a=40;s.x=-e*a,s.y=n*a}})),uq("#get-values").on("click",(function(){console.log("Camera Position:",window.blobVars.camera.position),console.log("Camera Rotation:",window.blobVars.camera.rotation),console.log("Camera Quaternion:",window.blobVars.camera.quaternion),console.log("Orbit Controls Target:",window.blobVars.controls.target)})),o()}));function dq(t,e,n,i,r,s,a=1){nr.fromTo(window.blobVars.group.position,t,{scrollTrigger:{trigger:n,pin:!1,start:r,endTrigger:i,end:s,scrub:1,fastScrollEnd:!0},duration:a,...e,ease:"power2.inOut"})}$(document).on("ready",(function(){var t=$("#app").data("page");window.addEventListener("blobInitialized",(function(){switch(window.blobVars.group.position.x=0,window.blobVars.group.position.y=0,t){case"/":window.matchMedia(`(min-width: ${Ed}px)`).matches?(dq({x:0},{x:-700},".home-hero",".love-working","top top","top top"),dq({x:-700},{x:700},".love-working",".brand-logos","top top","top top"),dq({x:700},{x:-400},".brand-logos",".featured-work","top top","bottom bottom"),dq({x:-400},{x:500,y:-200},".featured-work","footer","bottom bottom","bottom bottom",1),window.blobVars.group.position.x=0,window.blobVars.group.position.y=0):(window.blobVars.group.position.x=0,window.blobVars.group.position.y=window.innerHeight/2,window.blobVars.camera.zoom=1);break;case"about":window.matchMedia(`(min-width: ${Ed}px)`).matches&&(dq({x:-400},{x:600},".about-hero",".brand-logos","bottom center+=400","top top"),dq({x:600},{x:-400,y:600},".brand-logos",".team","top top","top top"),dq({x:-400,y:600},{x:500,y:-200},".team","footer","top top","bottom bottom"),window.blobVars.group.position.x=-400,window.blobVars.group.position.y=0);break;case"our-method":case"services":window.matchMedia(`(min-width: ${Ed}px)`).matches&&(dq({x:-400,y:0},{x:-2e3,y:0},".text-hero",".text-hero","top top","bottom top"),dq({x:-1e3,y:0},{x:500,y:-200},".cta-section","footer","top bottom","bottom bottom"),window.blobVars.group.position.x=-400,window.blobVars.group.position.y=0);break;case"impact":window.matchMedia(`(min-width: ${Ed}px)`).matches&&(dq({x:-400,y:0},{x:500,y:-200},".text-hero","footer","top top","bottom bottom"),window.blobVars.group.position.x=-400,window.blobVars.group.position.y=0);break;case t.startsWith("impact/")&&t:window.matchMedia(`(min-width: ${Ed}px)`).matches?(dq({x:3e3,y:0},{x:3e3,y:0},".impact-hero",".impact-hero","top top","top top"),dq({x:1e3,y:0},{x:500,y:-200},"footer","footer","top bottom","bottom bottom")):$("canvas#canvas3d").hide();break;case"insights":window.matchMedia(`(min-width: ${Ed}px)`).matches?(dq({x:-400,y:0},{x:500,y:-200},".text-hero","footer","top top","bottom bottom"),window.blobVars.group.position.x=-400,window.blobVars.group.position.y=0):$("canvas#canvas3d").hide();break;case t.startsWith("insights/")&&t:window.matchMedia(`(min-width: ${Ed}px)`).matches?(dq({x:3e3,y:0},{x:3e3,y:0},".insight-hero",".insight-hero","top top","top top"),dq({x:-1e3,y:0},{x:-400,y:0},".insight-content",".insight-content","bottom bottom","bottom top"),dq({x:-400,y:0},{x:500,y:-200},".insight-content","footer","bottom top","bottom bottom"),window.blobVars.group.position.x=3e3,window.blobVars.group.position.y=0):$("canvas#canvas3d").hide();break;case"projects":window.matchMedia(`(min-width: ${Ed}px)`).matches?(dq({x:-400,y:-100},{x:500,y:-200},".text-hero","footer","top top","bottom bottom"),window.blobVars.group.position.x=-400,window.blobVars.group.position.y=-100):$("canvas#canvas3d").hide();break;case"floating-world":case t.startsWith("projects/")&&t:window.matchMedia(`(min-width: ${Ed}px)`).matches,$("canvas#canvas3d").hide();break;case"shop":window.matchMedia(`(min-width: ${Ed}px)`).matches?(dq({x:1e3,y:-200},{x:500,y:-200},".text-hero","footer","top top","bottom bottom"),window.blobVars.group.position.x=1e3,window.blobVars.group.position.y=-200):$("canvas#canvas3d").hide();break;case"careers":window.matchMedia(`(min-width: ${Ed}px)`).matches?(dq({x:-400,y:-100},{x:500,y:-200},".text-hero","footer","top top","bottom bottom"),window.blobVars.group.position.x=-400,window.blobVars.group.position.y=-100):(window.blobVars.group.position.x=0,window.blobVars.group.position.y=window.innerHeight/2,window.blobVars.camera.zoom=1);break;case t.startsWith("careers/")&&t:window.matchMedia(`(min-width: ${Ed}px)`).matches?(dq({x:-400,y:100},{x:500,y:-200},".text-hero","footer","top top","bottom bottom"),window.blobVars.group.position.x=-400,window.blobVars.group.position.y=100):$("canvas#canvas3d").hide();break;case"contact-us":window.matchMedia(`(min-width: ${Ed}px)`).matches?(dq({x:-400,y:-100},{x:500,y:-200},".text-hero","footer","top top","bottom bottom"),window.blobVars.group.position.x=-400,window.blobVars.group.position.y=-100):window.blobVars.group.position.y=200}document.body.classList.contains("error404")&&(window.blobVars.group.position.x=0,window.blobVars.group.position.y=0,$("canvas#canvas3d").show())}))}));var pq=window.Alpine,fq=jQuery;if(fq(".home-hero").length>0)if(window.matchMedia(`(min-width: ${Ed}px)`).matches){let Zq;const Kq=nr.timeline({scrollTrigger:{trigger:".home-hero",pin:!0,start:"top top",end:"+=800",scrub:1,onEnter:()=>{},onLeaveBack:()=>{},onLeave:()=>{pq.store("showreelMuted",!0),Zq=clearTimeout(Zq)},onUpdate:t=>{t.progress<=.03?fq(".home-hero .video-wrapper").removeClass("no-hover"):fq(".home-hero .video-wrapper").addClass("no-hover"),t.progress>=.75&&!t.trigger._executed?(fq(".home-hero .video-text, .home-hero .toggle-sound, .home-hero .video-overlay").addClass("show"),pq.store("showreelMuted",!1),fq(".home-hero .video-text, .home-hero .toggle-sound, .home-hero .video-overlay").hasClass("playing")&&pq.store("showreelMuted",!1),Zq||(Zq=setTimeout((()=>{fq(".home-hero .video-text, .home-hero .video-overlay").removeClass("show"),pq.store("showIsland",!1)}),3e3))):t.progress<.75&&(fq(".home-hero .video-text, .home-hero .toggle-sound, .home-hero .video-overlay").removeClass("show"),pq.store("showreelMuted",!0),Zq=clearTimeout(Zq))}}});window.matchMedia(`(min-width: ${Ed}px)`).matches&&Kq.fromTo(".home-hero .video-wrapper",{width:"219px",height:"131px",right:30,bottom:30,borderRadius:5},{width:"100%",height:"100%",right:0,bottom:0,borderRadius:0,ease:"expo.inOut",duration:.7},0),window.matchMedia(`(max-width: ${Ed-1}px)`).matches&&Kq.fromTo(".home-hero .video-wrapper",{width:0,height:0,right:30,bottom:30,borderRadius:5},{width:"100%",height:"100%",right:0,bottom:0,borderRadius:0,ease:"power4.out",duration:1},0),Kq.fromTo(".home-hero video",{borderRadius:5},{borderRadius:0,ease:"power4.out",duration:.9},0).fromTo(".home-hero .arrow",{rotate:0},{rotate:225,ease:"power4.out",duration:.3},0).fromTo(".home-hero .arrow",{x:0},{x:50,ease:"power4.out",duration:.5},.2)}else fq(".home-hero .video-text, .home-hero .toggle-sound").addClass("show");function mq(t,e="#212121",n=null){n||(n=t);const i=function(t){t=(t=t.replace(/\s+/g," ")).replace(/\n/g,"<br>");const e=document.createElement("textarea");return e.innerHTML=t,e.value}(t.innerHTML),r=[];i.split(" ").forEach((t=>{const e=t.split("");r.push([...e,"&nbsp;"])})),t.innerHTML=r.map((t=>`<div class="inline-block overflow-hidden align-top leading-tight">\n      ${t.map((t=>`<span class="inline-block letter will-change-transform leading-tight">${t}</span>`)).join("")}\n    </div>`)).join(""),nr.fromTo(t.querySelectorAll(".letter"),{color:"#AAA"},{color:e,ease:"expo.out",scrollTrigger:{trigger:n,start:"top top",duration:500,scrub:!0,pin:!0},stagger:1})}jQuery(".about-hero").length>0&&window.matchMedia(`(min-width: ${Ad}px)`).matches&&document.querySelectorAll(".about-hero #animated-paragraph").forEach((t=>{mq(t,"#212121",document.querySelector(".about-hero"))}));var gq=jQuery;function vq(t){nr.timeline({scrollTrigger:{trigger:t,start:"top bottom"}}).from(t.find(".main"),{padding:0,width:0,duration:.7},0).from(t.find(".text"),{opacity:0,duration:.5},.5).from(t.find(".icon-end"),{opacity:0,x:-69,ease:"elastic.out(1,0.5)",duration:3},.4)}gq(".animate-button").length>0&&gq(document).on("ready",(function(){gq(".animate-button").each((function(){const t=gq(this);gq("body").hasClass("single-work")?setTimeout((()=>{vq(t)}),1e3):vq(t)}))}));var yq=jQuery;yq(".values").length>0&&yq(document).ready((function(){if(window.matchMedia(`(min-width: ${Ed}px)`).matches){const t=document.querySelectorAll(".card-wrapper"),e=nr.timeline({scrollTrigger:{trigger:yq(".values"),start:"top center+=100",scrub:!1}});e.from(yq(t)[0],{y:-100,x:-300,opacity:0,rotate:20,duration:4,ease:"elastic.out(1.2,0.5)"},0),e.from(yq(t)[1],{y:-50,x:-300,opacity:0,rotate:30,duration:4,ease:"elastic.out(1.2,0.5)"},.4),e.from(yq(t)[2],{x:-300,y:-20,opacity:0,rotate:30,duration:4,ease:"elastic.out(1.2,0.5)"},.7),e.from(yq(t)[3],{y:-50,x:300,opacity:0,rotate:-30,duration:4,ease:"elastic.out(1.2,0.5)"},1),e.from(yq(t)[4],{y:-100,x:300,opacity:0,rotate:-20,duration:4,ease:"elastic.out(1.2,0.5)"},1.4)}}));var xq=jQuery;xq(".team").length>0&&xq(document).on("ready",(function(){xq(document).on("mousemove",".team .right-section",(function(t){if(window.innerWidth<Ad)return;document.querySelectorAll(".image-wrapper").forEach((e=>{e.style.transition="";const n=e.getBoundingClientRect(),i=t.clientX-n.left-n.width/2,r=t.clientY-n.top-n.height/2,s=-r/40,a=i/40;e.style.transform=`perspective(1000px) rotateX(${s}deg) rotateY(${a}deg)`;const o=e.querySelector("img");if(o){const t=-i/40,e=-r/40;o.style.transition="",o.style.transform=`translate(${t}px, ${e}px) scale(1.1)`}}))})),xq(document).on("mouseleave",".team .right-section",(function(){if(window.innerWidth<Ad)return;document.querySelectorAll(".image-wrapper").forEach((t=>{t.style.transition="transform 1s ease",t.style.transform="rotateX(0deg) rotateY(0deg)";const e=t.querySelector("img");e&&(e.style.transition="transform 1s ease",e.style.transform="translate(0px, 0px) scale(1.1)")}))}))}));var bq=jQuery;if(bq(".steps").length>0){var _q=nr.timeline({paused:!0});_q.fromTo(".steps .step",{opacity:0,z:-500},{opacity:1,z:0,duration:.5,ease:"linear",stagger:.2},0),_q.to(".steps .step",{y:window.innerHeight,duration:.3,ease:"power1.in",stagger:.2},.55),nr.fromTo(_q,{progress:1},{progress:0,scrollTrigger:{trigger:".steps",start:window.innerWidth<768?"center center+=100":"center center+=400",end:"+=1700",ease:"linear",pin:!0,pinSpacing:!1,scrub:.5,onUpdate:t=>{1===t.progress?bq(".steps").addClass("invisible"):bq(".steps").removeClass("invisible")}}})}var wq=jQuery;wq(".text-hero").length>0&&wq(document).on("ready",(function(){var t=nr.timeline({paused:!0});t.to(".text-hero h1",{x:"-20%",duration:1,ease:"linear"}),nr.fromTo(t,{progress:0},{progress:1,scrollTrigger:{trigger:".text-hero",start:"top top",end:"bottom top",scrub:!0}})}));class Sq extends Xw{constructor(t,e={}){const n=e.font;if(void 0===n)super();else{const i=n.generateShapes(t,e.size);void 0===e.depth&&void 0!==e.height&&console.warn("THREE.TextGeometry: .height is now depreciated. Please use .depth instead"),e.depth=void 0!==e.depth?e.depth:void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),super(i,e)}this.type="TextGeometry"}}class Mq extends yS{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new _S(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(t){const n=r.parse(JSON.parse(t));e&&e(n)}),n,i)}parse(t){return new Tq(t)}}class Tq{constructor(t){this.isFont=!0,this.type="Font",this.data=t}generateShapes(t,e=100){const n=[],i=function(t,e,n){const i=Array.from(t),r=e/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,a=[];let o=0,l=0;for(let t=0;t<i.length;t++){const e=i[t];if("\n"===e)o=0,l-=s;else{const t=Eq(e,r,o,l,n);o+=t.offsetX,a.push(t.path)}}return a}(t,e,this.data);for(let t=0,e=i.length;t<e;t++)n.push(...i[t].toShapes());return n}}function Eq(t,e,n,i,r){const s=r.glyphs[t]||r.glyphs["?"];if(!s)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+r.familyName+".");const a=new yM;let o,l,c,h,u,d,p,f;if(s.o){const t=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let r=0,s=t.length;r<s;){switch(t[r++]){case"m":o=t[r++]*e+n,l=t[r++]*e+i,a.moveTo(o,l);break;case"l":o=t[r++]*e+n,l=t[r++]*e+i,a.lineTo(o,l);break;case"q":c=t[r++]*e+n,h=t[r++]*e+i,u=t[r++]*e+n,d=t[r++]*e+i,a.quadraticCurveTo(u,d,c,h);break;case"b":c=t[r++]*e+n,h=t[r++]*e+i,u=t[r++]*e+n,d=t[r++]*e+i,p=t[r++]*e+n,f=t[r++]*e+i,a.bezierCurveTo(u,d,p,f,c,h)}}}return{offsetX:s.ha*e,path:a}}var Aq=window.Alpine,Cq=jQuery;if(Cq(".impact-hero").length>0){if(window.matchMedia(`(min-width: ${Ed}px)`).matches){const mX=nr.timeline({scrollTrigger:{trigger:".impact-hero",pin:!0,start:"top top",end:"+=1500",scrub:1,onEnter:()=>{},onLeaveBack:()=>{},onLeave:()=>{Aq.store("showreelMuted",!0)},onUpdate:t=>{t.progress<=.03?Cq(".impact-hero .video-wrapper").removeClass("no-hover"):Cq(".impact-hero .video-wrapper").addClass("no-hover"),t.progress>=.75&&!t.trigger._executed?(Cq(".impact-hero .video-text, .impact-hero .toggle-sound").addClass("show"),Cq(".impact-hero .video-text, .impact-hero .toggle-sound").hasClass("playing")&&Aq.store("showreelMuted",!1)):t.progress<.75&&(Cq(".impact-hero .video-text, .impact-hero .toggle-sound").removeClass("show"),Aq.store("showreelMuted",!0))}}});window.matchMedia(`(min-width: ${Ed}px)`).matches&&mX.fromTo(".impact-hero .video-wrapper",{width:"219px",height:"131px",right:30,bottom:30,borderRadius:5},{width:"100%",height:"100%",right:0,bottom:0,borderRadius:0,ease:"power4.out",duration:1},0),window.matchMedia(`(max-width: ${Ed-1}px)`).matches&&mX.fromTo(".impact-hero .video-wrapper",{width:0,height:0,right:30,bottom:30,borderRadius:5},{width:"100%",height:"100%",right:0,bottom:0,borderRadius:0,ease:"power4.out",duration:1},0),mX.fromTo(".impact-hero video",{borderRadius:5},{borderRadius:0,ease:"power4.out",duration:.9},0).fromTo(".impact-hero .arrow",{rotate:0},{rotate:225,ease:"power4.out",duration:.3},0).fromTo(".impact-hero .arrow",{x:0},{x:50,ease:"power4.out",duration:.5},.2)}else Cq(".impact-hero .video-text, .impact-hero .toggle-sound").addClass("show");const Jq=.1,Qq=1e4,tX=new f_,eX=new dy(75,window.innerWidth/window.innerHeight,Jq,Qq);eX.position.z=500;const nX=new d_({antialias:!0,alpha:!0});nX.setClearColor(0,0),nX.setPixelRatio(window.devicePixelRatio),nX.setSize(window.innerWidth,window.innerHeight),document.querySelector(".impact-hero .canvas-wrapper").appendChild(nX.domElement),window.addEventListener("resize",(()=>{eX.aspect=window.innerWidth/window.innerHeight,eX.updateProjectionMatrix(),nX.setSize(window.innerWidth,window.innerHeight)}));const iX=new SS,rX=[],sX=[];let aX=[];aX=window.matchMedia(`(min-width: ${Ed}px)`).matches?[{x:-500,y:300,z:-100},{x:300,y:200,z:100},{x:-300,y:-100,z:100},{x:400,y:-200,z:-200},{x:0,y:-100,z:0},{x:300,y:-100,z:0}]:[{x:-150,y:200,z:-100},{x:75,y:200,z:70},{x:-70,y:-170,z:100},{x:140,y:-230,z:-200},{x:0,y:-100,z:0},{x:300,y:-100,z:0}],aX.forEach((t=>{sX.push({...t})}));const oX=new i_;tX.add(oX);const lX=new Mq,cX=new ty,hX=t=>{const e=Cq(".impact-hero .section-title").text(),n=Cq(".impact-hero .subtitle").text(),i=new Sq(e,{font:t,size:65,depth:0});i.computeBoundingBox();const r=i.boundingBox,s=r.max.x-r.min.x,a=r.max.y-r.min.y,o=new vv({color:2171169});cX.geometry=i,cX.material=o;const l=new Sq(n,{font:t,size:12,depth:0});l.computeBoundingBox();const c=l.boundingBox,h=c.max.x-c.min.x,u=new vv({color:22527}),d=new ty(l,u),p=new i_;p.add(cX),p.add(d),cX.position.x=-s/2,cX.position.y=0,d.position.x=-h/2,d.position.y=30-a,p.position.x=0,p.position.y=0,p.position.z=0,window.matchMedia(`(min-width: ${Ed}px)`).matches&&tX.add(p),window.impactHeroImages.forEach(((t,e)=>{iX.load(t,(t=>{t.colorSpace=kf;const n=t.image.width/t.image.height,i=window.innerWidth<Ed?150:200,r=new Ey(i,i/n),s=new vv({map:t}),a=new ty(r,s),o=new i_;o.add(a),o.position.set(0,0,0),o.scale.set(0,0,0),oX.add(o),rX.push({group:o,mesh:a}),aX[e]&&(nr.to(o.position,{x:aX[e].x,y:aX[e].y,z:aX[e].z,duration:5,ease:"elastic.out(0.75, 0.5)",onComplete:()=>{o.userData.initialAnimationComplete=!0}}),nr.to(o.scale,{x:1,y:1,z:1,duration:5,ease:"elastic.out(0.75, 0.5)"}))}))}))};lX.load("/app/themes/lbh-boilerplate/resources/scripts/constants/tt_norms_pro.json",hX);let uX=0,dX=0;const pX={windowHalfX:window.innerWidth/2,windowHalfY:window.innerHeight/2,coordinates:function(t,e){uX=.05*(t-pX.windowHalfX),dX=.05*(e-pX.windowHalfY)},onMouseMove:function(t){pX.coordinates(t.clientX,t.clientY)},onTouchMove:function(t){pX.coordinates(t.changedTouches[0].clientX,t.changedTouches[0].clientY)}};document.addEventListener("mousemove",pX.onMouseMove,!1),document.addEventListener("touchmove",pX.onTouchMove,!1);const fX=()=>{requestAnimationFrame(fX);const t=.02*(uX-oX.position.x),e=.02*(-1*dX-oX.position.y);oX.position.x+=t,oX.position.y+=e;const n=.001*Date.now();rX.forEach((({mesh:t},e)=>{const i=.01;t.position.x+=(10*Math.sin(n+e)-t.position.x)*i,t.position.y+=(10*Math.sin(.5*n+e)-t.position.y)*i,t.position.z+=(10*Math.sin(.3*n+e)-t.position.z)*i})),nX.render(tX,eX)};fX()}var Pq=jQuery;Pq(".more-impact").length>0&&Pq(document).on("ready",(function(){const t=Pq(".more-impact .impact");let e=0;setInterval((function(){const n=t.eq(e),i=(e+1)%t.length,r=t.eq(i),s=(e+2)%t.length,a=t.eq(s);nr.timeline().to(n,{duration:.5,y:"-5.5rem",scale:.9,opacity:0}).to(n,{duration:.5,opacity:.2,scale:.9,y:"5.5rem",zIndex:10,onStart:()=>{n.css("z-index",10)}}),nr.to(r,{duration:.5,opacity:1,scale:1,y:0,zIndex:20}),nr.to(a,{duration:.5,opacity:.4,scale:.95,y:"2.75rem",zIndex:15}),e=i}),3e3)}));var Rq=jQuery;Rq(".work-archive").length>0&&Rq(document).on("ready",(function(){}));const Oq={name:"BokehShader",uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:0},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new ym}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\n\t\tvarying vec2 vUv;\n\n\t\tuniform sampler2D tColor;\n\t\tuniform sampler2D tDepth;\n\t\tuniform float textureWidth;\n\t\tuniform float textureHeight;\n\n\t\tuniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below\n\t\tuniform float focalLength; //focal length in mm\n\t\tuniform float fstop; //f-stop value\n\t\tuniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)\n\n\t\t/*\n\t\tmake sure that these two values are the same for your camera, otherwise distances will be wrong.\n\t\t*/\n\n\t\tuniform float znear; // camera clipping start\n\t\tuniform float zfar; // camera clipping end\n\n\t\t//------------------------------------------\n\t\t//user variables\n\n\t\tconst int samples = SAMPLES; //samples on the first ring\n\t\tconst int rings = RINGS; //ring count\n\n\t\tconst int maxringsamples = rings * samples;\n\n\t\tuniform bool manualdof; // manual dof calculation\n\t\tfloat ndofstart = 1.0; // near dof blur start\n\t\tfloat ndofdist = 2.0; // near dof blur falloff distance\n\t\tfloat fdofstart = 1.0; // far dof blur start\n\t\tfloat fdofdist = 3.0; // far dof blur falloff distance\n\n\t\tfloat CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)\n\n\t\tuniform bool vignetting; // use optical lens vignetting\n\n\t\tfloat vignout = 1.3; // vignetting outer border\n\t\tfloat vignin = 0.0; // vignetting inner border\n\t\tfloat vignfade = 22.0; // f-stops till vignete fades\n\n\t\tuniform bool shaderFocus;\n\t\t// disable if you use external focalDepth value\n\n\t\tuniform vec2 focusCoords;\n\t\t// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)\n\t\t// if center of screen use vec2(0.5, 0.5);\n\n\t\tuniform float maxblur;\n\t\t//clamp value of max blur (0.0 = no blur, 1.0 default)\n\n\t\tuniform float threshold; // highlight threshold;\n\t\tuniform float gain; // highlight gain;\n\n\t\tuniform float bias; // bokeh edge bias\n\t\tuniform float fringe; // bokeh chromatic aberration / fringing\n\n\t\tuniform bool noise; //use noise instead of pattern for sample dithering\n\n\t\tuniform float dithering;\n\n\t\tuniform bool depthblur; // blur the depth buffer\n\t\tfloat dbsize = 1.25; // depth blur size\n\n\t\t/*\n\t\tnext part is experimental\n\t\tnot looking good with small sample and ring count\n\t\tlooks okay starting from samples = 4, rings = 4\n\t\t*/\n\n\t\tuniform bool pentagon; //use pentagon as bokeh shape?\n\t\tfloat feather = 0.4; //pentagon shape feather\n\n\t\t//------------------------------------------\n\n\t\tfloat penta(vec2 coords) {\n\t\t\t//pentagonal shape\n\t\t\tfloat scale = float(rings) - 1.3;\n\t\t\tvec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);\n\t\t\tvec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);\n\t\t\tvec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);\n\t\t\tvec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);\n\t\t\tvec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);\n\t\t\tvec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);\n\n\t\t\tvec4  one = vec4( 1.0 );\n\n\t\t\tvec4 P = vec4((coords),vec2(scale, scale));\n\n\t\t\tvec4 dist = vec4(0.0);\n\t\t\tfloat inorout = -4.0;\n\n\t\t\tdist.x = dot( P, HS0 );\n\t\t\tdist.y = dot( P, HS1 );\n\t\t\tdist.z = dot( P, HS2 );\n\t\t\tdist.w = dot( P, HS3 );\n\n\t\t\tdist = smoothstep( -feather, feather, dist );\n\n\t\t\tinorout += dot( dist, one );\n\n\t\t\tdist.x = dot( P, HS4 );\n\t\t\tdist.y = HS5.w - abs( P.z );\n\n\t\t\tdist = smoothstep( -feather, feather, dist );\n\t\t\tinorout += dist.x;\n\n\t\t\treturn clamp( inorout, 0.0, 1.0 );\n\t\t}\n\n\t\tfloat bdepth(vec2 coords) {\n\t\t\t// Depth buffer blur\n\t\t\tfloat d = 0.0;\n\t\t\tfloat kernel[9];\n\t\t\tvec2 offset[9];\n\n\t\t\tvec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;\n\n\t\t\toffset[0] = vec2(-wh.x,-wh.y);\n\t\t\toffset[1] = vec2( 0.0, -wh.y);\n\t\t\toffset[2] = vec2( wh.x -wh.y);\n\n\t\t\toffset[3] = vec2(-wh.x,  0.0);\n\t\t\toffset[4] = vec2( 0.0,   0.0);\n\t\t\toffset[5] = vec2( wh.x,  0.0);\n\n\t\t\toffset[6] = vec2(-wh.x, wh.y);\n\t\t\toffset[7] = vec2( 0.0,  wh.y);\n\t\t\toffset[8] = vec2( wh.x, wh.y);\n\n\t\t\tkernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;\n\t\t\tkernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;\n\t\t\tkernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;\n\n\n\t\t\tfor( int i=0; i<9; i++ ) {\n\t\t\t\tfloat tmp = texture2D(tDepth, coords + offset[i]).r;\n\t\t\t\td += tmp * kernel[i];\n\t\t\t}\n\n\t\t\treturn d;\n\t\t}\n\n\n\t\tvec3 color(vec2 coords,float blur) {\n\t\t\t//processing the sample\n\n\t\t\tvec3 col = vec3(0.0);\n\t\t\tvec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);\n\n\t\t\tcol.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;\n\t\t\tcol.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;\n\t\t\tcol.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;\n\n\t\t\tvec3 lumcoeff = vec3(0.299,0.587,0.114);\n\t\t\tfloat lum = dot(col.rgb, lumcoeff);\n\t\t\tfloat thresh = max((lum-threshold)*gain, 0.0);\n\t\t\treturn col+mix(vec3(0.0),col,thresh*blur);\n\t\t}\n\n\t\tvec3 debugFocus(vec3 col, float blur, float depth) {\n\t\t\tfloat edge = 0.002*depth; //distance based edge smoothing\n\t\t\tfloat m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);\n\t\t\tfloat e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);\n\n\t\t\tcol = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);\n\t\t\tcol = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);\n\n\t\t\treturn col;\n\t\t}\n\n\t\tfloat linearize(float depth) {\n\t\t\treturn -zfar * znear / (depth * (zfar - znear) - zfar);\n\t\t}\n\n\t\tfloat vignette() {\n\t\t\tfloat dist = distance(vUv.xy, vec2(0.5,0.5));\n\t\t\tdist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);\n\t\t\treturn clamp(dist,0.0,1.0);\n\t\t}\n\n\t\tfloat gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {\n\t\t\tfloat rings2 = float(rings);\n\t\t\tfloat step = PI*2.0 / float(ringsamples);\n\t\t\tfloat pw = cos(j*step)*i;\n\t\t\tfloat ph = sin(j*step)*i;\n\t\t\tfloat p = 1.0;\n\t\t\tif (pentagon) {\n\t\t\t\tp = penta(vec2(pw,ph));\n\t\t\t}\n\t\t\tcol += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;\n\t\t\treturn 1.0 * mix(1.0, i /rings2, bias) * p;\n\t\t}\n\n\t\tvoid main() {\n\t\t\t//scene depth calculation\n\n\t\t\tfloat depth = linearize(texture2D(tDepth,vUv.xy).x);\n\n\t\t\t// Blur depth?\n\t\t\tif ( depthblur ) {\n\t\t\t\tdepth = linearize(bdepth(vUv.xy));\n\t\t\t}\n\n\t\t\t//focal plane calculation\n\n\t\t\tfloat fDepth = focalDepth;\n\n\t\t\tif (shaderFocus) {\n\n\t\t\t\tfDepth = linearize(texture2D(tDepth,focusCoords).x);\n\n\t\t\t}\n\n\t\t\t// dof blur factor calculation\n\n\t\t\tfloat blur = 0.0;\n\n\t\t\tif (manualdof) {\n\t\t\t\tfloat a = depth-fDepth; // Focal plane\n\t\t\t\tfloat b = (a-fdofstart)/fdofdist; // Far DoF\n\t\t\t\tfloat c = (-a-ndofstart)/ndofdist; // Near Dof\n\t\t\t\tblur = (a>0.0) ? b : c;\n\t\t\t} else {\n\t\t\t\tfloat f = focalLength; // focal length in mm\n\t\t\t\tfloat d = fDepth*1000.0; // focal plane in mm\n\t\t\t\tfloat o = depth*1000.0; // depth in mm\n\n\t\t\t\tfloat a = (o*f)/(o-f);\n\t\t\t\tfloat b = (d*f)/(d-f);\n\t\t\t\tfloat c = (d-f)/(d*fstop*CoC);\n\n\t\t\t\tblur = abs(a-b)*c;\n\t\t\t}\n\n\t\t\tblur = clamp(blur,0.0,1.0);\n\n\t\t\t// calculation of pattern for dithering\n\n\t\t\tvec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;\n\n\t\t\t// getting blur x and y step factor\n\n\t\t\tfloat w = (1.0/textureWidth)*blur*maxblur+noise.x;\n\t\t\tfloat h = (1.0/textureHeight)*blur*maxblur+noise.y;\n\n\t\t\t// calculation of final color\n\n\t\t\tvec3 col = vec3(0.0);\n\n\t\t\tif(blur < 0.05) {\n\t\t\t\t//some optimization thingy\n\t\t\t\tcol = texture2D(tColor, vUv.xy).rgb;\n\t\t\t} else {\n\t\t\t\tcol = texture2D(tColor, vUv.xy).rgb;\n\t\t\t\tfloat s = 1.0;\n\t\t\t\tint ringsamples;\n\n\t\t\t\tfor (int i = 1; i <= rings; i++) {\n\t\t\t\t\t/*unboxstart*/\n\t\t\t\t\tringsamples = i * samples;\n\n\t\t\t\t\tfor (int j = 0 ; j < maxringsamples ; j++) {\n\t\t\t\t\t\tif (j >= ringsamples) break;\n\t\t\t\t\t\ts += gather(float(i), float(j), ringsamples, col, w, h, blur);\n\t\t\t\t\t}\n\t\t\t\t\t/*unboxend*/\n\t\t\t\t}\n\n\t\t\t\tcol /= s; //divide by sample count\n\t\t\t}\n\n\t\t\tif (showFocus) {\n\t\t\t\tcol = debugFocus(col, blur, depth);\n\t\t\t}\n\n\t\t\tif (vignetting) {\n\t\t\t\tcol *= vignette();\n\t\t\t}\n\n\t\t\tgl_FragColor.rgb = col;\n\t\t\tgl_FragColor.a = 1.0;\n\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <colorspace_fragment>\n\t\t}"},Dq={name:"BokehDepthShader",uniforms:{mNear:{value:1},mFar:{value:1e3}},vertexShader:"\n\n\t\tvarying float vViewZDepth;\n\n\t\tvoid main() {\n\n\t\t\t#include <begin_vertex>\n\t\t\t#include <project_vertex>\n\n\t\t\tvViewZDepth = - mvPosition.z;\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float mNear;\n\t\tuniform float mFar;\n\n\t\tvarying float vViewZDepth;\n\n\t\tvoid main() {\n\n\t\t\tfloat color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );\n\t\t\tgl_FragColor = vec4( vec3( color ), 1.0 );\n\n\t\t}"};var Lq=jQuery;let Iq=!1;function zq(t=!0,e=!1){Iq=e,t&&Lq("html, body").addClass("freeze");const n=new f_,i=new dy(75,window.innerWidth/window.innerHeight,.1,1e4);i.position.z=2e3;const r=new d_({antialias:!0,alpha:!0});r.setClearColor(0,0),r.setPixelRatio(window.devicePixelRatio),r.setSize(window.innerWidth,window.innerHeight),document.querySelector(".floating-world .canvas-wrapper").appendChild(r.domElement);const s=document.querySelectorAll(".floating-world .projects .project"),a=100*s.length;let o=0;s.forEach(((t,e)=>{const i=t.getAttribute("data-featured-media"),r=t.getAttribute("data-url");if(i){let s,a;if(i.endsWith(".mp4")){const _=document.createElement("video");_.src=i,_.loop=!0,_.muted=!0,_.play(),_.addEventListener("loadedmetadata",(()=>{s=new W_(_),s.minFilter=Tp,s.magFilter=Tp,s.format=Vp,s.colorSpace=kf,a=_.videoWidth/_.videoHeight,y(s,a),v.map=s,v.needsUpdate=!0}))}else s=(new SS).load(i,(t=>{a=t.image.width/t.image.height,t.colorSpace=kf,y(t,a)}));const o=309/380,l=200*o,c=200,h=5,u=new yw,d=l/2,p=c/2;u.moveTo(-d+h,-p),u.lineTo(d-h,-p),u.absarc(d-h,-p+h,h,-Math.PI/2,0,!1),u.lineTo(d,p-h),u.absarc(d-h,p-h,h,0,Math.PI/2,!1),u.lineTo(-d+h,p),u.absarc(-d+h,p-h,h,Math.PI/2,Math.PI,!1),u.lineTo(-d,-p+h),u.absarc(-d+h,-p+h,h,Math.PI,1.5*Math.PI,!1);const f=new Zw(u,8);f.computeBoundingBox();const m=f.attributes.position,g=f.attributes.uv;for(let w=0;w<m.count;w++){const S=m.getX(w)+l/2,M=m.getY(w)+c/2;g.setXY(w,S/l,M/c)}g.needsUpdate=!0;const v=new vv({map:s,transparent:!0,opacity:1});function y(t,e){t.wrapS=bp,t.wrapT=bp;let n=1,i=1;o>e?i=e/o:n=o/e,t.repeat.set(n,i),t.offset.set((1-n)/2,(1-i)/2)}const x=new ty(f,v),b=new $m(400*(Math.random()-.5)*2,400*(Math.random()-.5),100*-e);x.position.copy(b),n.add(x),x.userData={url:r},x.callback=()=>{window.location.href=x.userData.url},t.mesh=x,t.targetPosition=b}}));const l=new ZS;l.far=1e4;const c=new ym;let h=null;window.addEventListener("mousemove",(function(t){if(!Iq)return;c.x=t.clientX/window.innerWidth*2-1,c.y=-t.clientY/window.innerHeight*2+1,l.setFromCamera(c,i);const e=l.intersectObjects(n.children);if(e.length>0){const t=e[0].object;h!==t&&(h&&(nr.to(h.scale,{duration:.5,x:1,y:1,z:1}),document.body.style.cursor="default"),h=t,h.userData.isText||(nr.to(h.scale,{duration:.5,x:1.1,y:1.1,z:1.1}),document.body.style.cursor="pointer"))}else h&&(nr.to(h.scale,{duration:.5,x:1,y:1,z:1}),h=null,document.body.style.cursor="default")}),!1),window.addEventListener("click",(function(t){if(!Iq)return;c.x=t.clientX/window.innerWidth*2-1,c.y=-t.clientY/window.innerHeight*2+1,l.setFromCamera(c,i);const e=l.intersectObjects(n.children);if(e.length>0){const t=e[0].object;t.callback&&t.callback()}}),!1);s.length;let u=150,d=o;window.addEventListener("wheel",(t=>{if(!Iq)return;const e=-.5*t.deltaY;u=u+e,d+=e,Array.from(s).forEach((t=>{t.mesh&&(o>t.mesh.position.z+200&&(t.mesh.position.z=t.mesh.position.z+a),o<t.mesh.position.z-200&&(t.mesh.position.z=t.mesh.position.z-a))}))}));const p={enabled:!1},f=3,m=4,g=new oy({uniforms:Dq.uniforms,vertexShader:Dq.vertexShader,fragmentShader:Dq.fragmentShader});g.uniforms.mNear.value=i.near,g.uniforms.mFar.value=i.far,function(){p.scene=new f_,p.camera=new By(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,-1e4,1e4),p.camera.position.z=0,p.scene.add(p.camera),p.rtTextureDepth=new Gm(window.innerWidth,window.innerHeight,{type:zp}),p.rtTextureColor=new Gm(window.innerWidth,window.innerHeight,{type:zp});const t=Oq;p.bokeh_uniforms=ay.clone(t.uniforms),p.bokeh_uniforms.tColor.value=p.rtTextureColor.texture,p.bokeh_uniforms.tDepth.value=p.rtTextureDepth.texture,p.bokeh_uniforms.textureWidth.value=window.innerWidth,p.bokeh_uniforms.textureHeight.value=window.innerHeight,p.bokeh_uniforms.focalDepth.value=500,p.bokeh_uniforms.maxblur.value=.5,p.materialBokeh=new oy({uniforms:p.bokeh_uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,defines:{RINGS:f,SAMPLES:m}}),p.quad=new ty(new Ey(window.innerWidth,window.innerHeight),p.materialBokeh),p.quad.position.z=0,p.scene.add(p.quad)}();const v=new i_;(new Mq).load("/app/themes/lbh-boilerplate/resources/scripts/constants/tt_norms_pro.json",(t=>{const e=Lq(".floating-world .section-title").text(),i=new Sq(e,{font:t,size:180,depth:0}),r=new vv({color:16777215}),s=new ty(i,r);s.userData={isText:!0},i.computeBoundingBox();const a=i.boundingBox;s.position.x=-a.max.x/2,s.position.y=0,v.add(s),v.position.x=-window.innerWidth/7,v.position.y=120,v.position.z=-100,n.add(v)}));let y=0,x=0;const b={windowHalfX:window.innerWidth/2,windowHalfY:window.innerHeight/2,coordinates:function(t,e){y=.05*(t-b.windowHalfX),x=.05*(e-b.windowHalfY)},onMouseMove:function(t){b.coordinates(t.clientX,t.clientY)},onTouchMove:function(t){b.coordinates(t.changedTouches[0].clientX,t.changedTouches[0].clientY)}};document.addEventListener("mousemove",b.onMouseMove,!1),document.addEventListener("touchmove",b.onTouchMove,!1);const _=function(t,e,n){return t*(1-n)+e*n},w=()=>{requestAnimationFrame(w);const t=.03,e=1*(y-i.position.x),a=1*(-1*x-i.position.y);i.position.x=_(i.position.x,e,t),i.position.y=_(i.position.y,a,t),i.rotation.x=_(i.rotation.x,.005*a,t),i.rotation.y=_(i.rotation.y,-.005*e,t),v.position.x=_(v.position.x,e-window.innerWidth/7,t),v.position.y=_(v.position.y,a+120,t),i.position.z=_(i.position.z,u,t),o=_(o,d,t),Array.from(s).forEach(((t,e)=>{if(t.mesh){const e=i.position.distanceTo(t.mesh.position),n=150,r=1500;t.mesh.material.opacity=e<n?nr.utils.mapRange(n,50,1,0,e):nr.utils.mapRange(700,r,1,0,e)}})),v.position.z=i.position.z-500,r.clear(),p.enabled?(r.setRenderTarget(p.rtTextureColor),r.clear(),r.render(n,i),n.overrideMaterial=g,r.setRenderTarget(p.rtTextureDepth),r.clear(),r.render(n,i),n.overrideMaterial=null,r.setRenderTarget(null),r.render(p.scene,p.camera)):(r.setRenderTarget(null),r.clear(),r.render(n,i))};w()}Lq(".floating-world").length>0&&zq(!0,!0);var Nq=jQuery;Nq(".eyeballs").length>0&&Nq(document).on("ready",(function(){Nq(document).on("mousemove",(function(t){const e=document.getElementById("eyeball1"),n=document.getElementById("eyeball2"),i=document.querySelector(".head");[e,n].forEach((e=>{const n=e.getBoundingClientRect(),i=n.left+n.width/2,r=n.top+n.height/2,s=t.clientX-i,a=t.clientY-r,o=Math.atan2(a,s),l=Math.min(8,Math.sqrt(s*s+a*a)/3);e.style.transform=`translate(${Math.cos(o)*l}px, ${Math.sin(o)*l}px)`}));const r=i.getBoundingClientRect(),s=r.left+r.width/2,a=r.top+r.height/2,o=t.clientX-s,l=t.clientY-a,c=Math.atan2(l,o),h=Math.sqrt(o*o+l*l)/30;i.style.transform=`translate(${Math.cos(c)*h}px, ${Math.sin(c)*h}px)`}))}));var Uq=jQuery;Uq(".hole-in-space").length>0&&Uq(document).on("ready",(function(){let t=!1;const e=document.querySelector(".hole-in-space"),n=document.querySelector(".hole-in-space .preview");Uq(document).on("mousemove",(function(i){if(!t){const t=e.getBoundingClientRect(),r=t.left+t.width/2,s=t.top+t.height/2,a=i.clientX-r,o=i.clientY-s,l=Math.atan2(o,a),c=Math.sqrt(a*a+o*o)/30;e.style.transform=`translate(${Math.cos(l)*c}px, ${Math.sin(l)*c}px)`,n.style.transform=`scale(1.5) translate(${-Math.cos(l)*c}px, ${-Math.sin(l)*c}px)`}}));const i=Uq(".hole-in-space").attr("href");let r="";fetch(i).then((t=>{if(t.ok)return t.text();throw new Error("Network response was not ok.")})).then((t=>{r=t;const n=document.createElement("div");n.innerHTML=r;const i=n.querySelector(".floating-world").outerHTML;Uq(".place-floating-world-here").html(i),zq(!1,!1),Uq(".floating-world canvas").css("transform","scale(0.09)"),Uq(".back-to-cards").css("opacity","0"),gsap.to(e,{opacity:1,duration:1.5,ease:"expo.inOut"})})).catch((t=>{console.error("There was a problem with the fetch operation:",t)})),window.addEventListener("popstate",(function(t){window.location.reload()})),Uq(".hole-in-space").on("click",(function(e){const i=Uq(this).attr("href");window.history.pushState({},"",i),Alpine.store("showFloatingWorld",!0),t=!0,Uq(this).css("transform",""),Uq("html, body").addClass("freeze");Uq(".hole-in-space .rotating-text");Uq(n).addClass("open");let r=gsap.timeline();const s=Uq(this)[0].getBoundingClientRect(),a=s.right-window.innerWidth,o=s.top;r.to(Uq(this),{x:-a,y:-o,width:"100vw",height:"100vh",duration:1.5,ease:"expo.inOut"}),r.to(".floating-world canvas, .hole-in-space .preview",{scale:1,duration:1.5,ease:"expo.inOut"},"<").then((()=>{Iq=!0,gsap.to(".back-to-cards",{opacity:1,duration:1.5,ease:"expo.inOut"})}))}))}));var kq=jQuery;kq(".featured-insights").length>0&&kq(document).on("ready",(function(){nr.to(".featured-insights .inner-strip",{x:-600,scrollTrigger:{trigger:".featured-insights",start:"top bottom",end:"bottom top",scrub:!0}})})),jQuery(".brand-logos").length,nr.registerPlugin(lo);var Bq=jQuery;function Fq(t){const e=t===t.toLowerCase()?"abcdefghijklmnopqrstuvwxyz":"ABCDEFGHIJKLMNOPQRSTUVWXYZ";return e.charAt(Math.floor(Math.random()*e.length))}function Vq(t,e=1){var n=$(t).text(),i=$(t);const r=i.height();i.css("height",r);const s=i.width();i.css("width",s),i.css("overflow","hidden"),i.css("vertical-align","bottom"),i.css("white-space","pre-line");const a=Math.floor(1e3*e/50);let o=0;const l=setInterval((()=>{if(o<a){let e="";const i=n.split("\n");i.forEach(((t,n)=>{for(let n=0;n<t.length;n++){var r=t[n];"&nbsp;"===r?e+="&nbsp;":/[a-zA-Z]/.test(r)?e+=Fq(r):e+=r}n<i.length-1&&(e+="\n")})),$(t).text(e),o++}else clearInterval(l),$(t).text(n),i.css("height",""),i.css("width",""),i.css("overflow",""),i.css("vertical-align",""),i.css("white-space","pre-line")}),50)}document.body.classList.contains("single-work")&&(Bq(".island").hide(),Alpine.store("showIsland",!1),Bq(document).on("ready",(function(){document.querySelector(".content").querySelectorAll("video[controls]").forEach((t=>{t.removeAttribute("controls");const e=document.createElement("div");e.className="relative",t.parentNode.insertBefore(e,t),e.appendChild(t);const n=document.createElement("button");n.className="toggle-sound [&.show]:translate-y-0 show [&.show]:opacity-100 [&.show]:pointer-events-auto pointer-events-none translate-y-4 opacity-0 aspect-square p-4 border border-white absolute top-5 md:top-auto md:bottom-10 right-5 md:right-10 rounded-full transition duration-500 hover:-translate-y-px hover:shadow-lg active:scale-95",n.innerHTML='<svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M7.71428 12.8572H3.85713C3.17515 12.8572 2.5211 13.1281 2.03886 13.6103C1.55662 14.0926 1.28571 14.7466 1.28571 15.4286V20.5715C1.28571 21.2534 1.55662 21.9075 2.03886 22.3897C2.5211 22.872 3.17515 23.1429 3.85713 23.1429H7.71428V12.8572Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M7.71426 23.1429L17.7686 30.3686C18.1411 30.6263 18.5751 30.7811 19.0266 30.8172C19.4781 30.8534 19.9312 30.7696 20.34 30.5743C20.7833 30.3752 21.1611 30.0545 21.4296 29.6495C21.6981 29.2444 21.8463 28.7716 21.8571 28.2857V7.7143C21.8681 7.25253 21.7545 6.79631 21.5283 6.3936C21.302 5.99089 20.9715 5.65656 20.5714 5.42573C20.1627 5.23049 19.7096 5.14669 19.258 5.18281C18.8065 5.21894 18.3725 5.3737 18 5.63145L7.71426 12.8572" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M32.1429 10.2857C33.9307 12.4472 34.8477 15.1981 34.7143 18C34.6757 21.1757 33.7878 24.2832 32.1429 27" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>\n        <path d="M27 14.1429C27.8939 15.2236 28.3524 16.5991 28.2857 18C28.3524 19.401 27.8939 20.7764 27 21.8572" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>\n      </svg>',n.addEventListener("click",(()=>{t.muted=!t.muted,n.classList.toggle("text-white"),n.classList.toggle("bg-white"),n.classList.toggle("text-black"),n.classList.toggle("playing")})),t.muted?n.classList.add("text-white"):n.classList.add("bg-white","text-black","playing"),e.appendChild(n)})),Bq("html").addClass("no-smooth-scroll"),Bq("html").css("scroll-behavior","auto");var t=!1,e=!1,n=!1,i=Bq(".next-project").data("url");t||(t=!0,Bq.get(i,(function(t){var n=Bq(t).find("main#main").html(),i=Bq(t).filter("title").text();e={mainContent:n,newTitle:i}}))),nr.to(".work-hero:not(.hero-next-project) img",{scrollTrigger:{trigger:".work-hero:not(.hero-next-project)",start:"top top",end:"bottom top",scrub:!0},y:200,ease:"none",duration:1}),window.lenis.on("scroll",(function(t){const r=t.animatedScroll,s=t.dimensions.height,a=t.dimensions.scrollHeight,o=window.innerWidth<=768;!n&&!o&&r+s>=a-0&&(n=!0,history.pushState({page:i},"",i),function(t,e=!1){if(Bq(".hero.hero-next-project").addClass("animate-pulse"),e){var n=Bq("main#main").find(".hero-next-project").detach();Bq("main#main").html(e.mainContent),Bq("main#main").find(".work-hero:not(.hero-next-project)").remove(),n.removeClass("hero-next-project"),nr.killTweensOf(n),Bq("main#main").prepend(n),document.title=e.newTitle,window.lenis.scrollTo(0,{immediate:!0,force:!0,lock:!0}),window.lenis.stop(),Bq(document).trigger("ready"),setTimeout((()=>{window.lenis.start()}),100)}else Bq("main#main").load(t+" main#main > *",!1,(function(){Bq.get(t,(function(t){var e=Bq(t).filter("title").text();document.title=e})),window.lenis.scrollTo(0,{immediate:!0,force:!0,lock:!0}),Bq(document).trigger("ready")}))}(i,e))})),setTimeout((()=>{window.innerWidth>768&&nr.from(".hero-next-project",{borderRadius:"5px",width:"75vw",scrollTrigger:{trigger:".hero-next-project",start:"top bottom",end:"bottom bottom",scrub:!0}}),nr.from(".next-project-line",{width:0,scrollTrigger:{trigger:".next-project-line",start:"top bottom",end:"bottom top",scrub:!0,ease:"linear"}})}),10),Bq(".hero-next-project").on("click",(function(t){window.innerWidth<=768&&(t.preventDefault(),window.location.href=i)}))}))),Bq.fn.isInViewport=function(){var t=Bq(this).offset().top,e=t+Bq(this).outerHeight(),n=Bq(window).scrollTop(),i=n+Bq(window).height();return e>n&&t<i},window.$=jQuery,nr.registerPlugin(lo),document.body.classList.contains("stop-common")||$("[animate-distort]").each((function(){$(this).css("opacity",0),nr.to($(this),{opacity:1,duration:1,ease:"power2.out",scrollTrigger:{trigger:$(this),start:"top bottom-=100",onEnter:()=>{Vq($(this))}}})})),nr.registerPlugin(lo);var jq=jQuery;document.body.classList.contains("home")&&(jq("html, body").addClass("freeze"),jq(document).on("ready",(function(){0===jq(window).scrollTop()?(jq("html, body").addClass("freeze"),window.addEventListener("blobInitialized",(function(){jq(".home-hero h1, .home-hero h2, .home-hero .button-wrapper, header .home-link, .home-hero .video-wrapper").removeClass("invisible");const t=nr.timeline();t.from(window.blobVars.camera,{zoom:0,duration:2,ease:"power4.out",onComplete:()=>{jq("html, body").removeClass("freeze")}}),t.to("header .title-mask",{y:"-150%",duration:2,ease:"expo.inOut"},"<"),t.from("header .site-title",{y:30,duration:2,ease:"expo.inOut"},"<"),t.from(".home-hero h1, .home-hero h2",{opacity:0,duration:1,ease:"power4.out"},"<1"),t.add((()=>{Vq(jq(".home-hero h1"))}),"<"),t.add((()=>{Vq(jq(".home-hero h2"))}),"<"),t.from(".home-hero .button-wrapper",{opacity:0,duration:1,ease:"power4.out"},"<0.3"),t.add((()=>{vq(jq(".home-hero .button-wrapper"))}),"<"),window.matchMedia(`(min-width: ${Ed}px)`).matches&&t.from(".home-hero .video-wrapper",{opacity:0,x:500,duration:2,delay:.5,ease:"power4.out"},"<"),t.add((()=>{jq(".island-inner").removeClass("invisible")}),"<"),t.from(".island-inner",{y:100,opacity:0,duration:1,ease:"power4.out",clearProps:"all"},"<"),t.from(".cky-consent-bar",{x:-50,opacity:0,duration:2.5,ease:"power4.out"},"<2"),jq(".cky-consent-bar").css("display","block")}))):(jq("html, body").removeClass("freeze"),jq("header .title-mask").remove(),window.addEventListener("blobInitialized",(function(){jq(".home-hero h1, .home-hero h2, .home-hero .button-wrapper, header .home-link, .home-hero .video-wrapper, .island-inner").removeClass("invisible"),jq(".cky-consent-bar").show()})));const t=document.querySelector("header.banner");if(t){nr.timeline({scrollTrigger:{trigger:t,start:"top top",end:"+=800vh",scrub:1,toggleActions:"play play play reverse"}}).to(t,{zIndex:30,duration:0},.35).to(jq(t).find(".site-title"),{fontSize:"1.25rem",letterSpacing:"-0.05rem",duration:.7,ease:"expo.inOut"},0).to(jq(t).find(".site-title"),{color:"#0057ff",duration:.7,ease:"expo.inOut"},.15).to(jq(t).find(".site-title"),{y:-200,duration:.7,ease:"expo.inOut"})}}))),s((async()=>{}))}},t=>{var e=e=>t(t.s=e);e("./scripts/app.js"),e("./styles/app.scss")}]);